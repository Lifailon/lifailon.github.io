<!doctype html><html data-theme=dark lang=en xmlns=http://www.w3.org/1999/xhtml><head><meta charset=UTF-8><meta content="Web version for PowerShell notes in Russian language (Сheat Sheet & Documentation) and RuDocs (node.js)" name=description><meta content="width=device-width,initial-scale=1" name=viewport><meta content=#ff7800 name=theme-color><meta content=#ffa348 media=(prefers-color-scheme:dark) name=theme-color><meta content="default-src 'none';font-src 'self';img-src 'self' https: data:;media-src 'self' https:;style-src 'self' 'unsafe-inline';frame-src https://player.vimeo.com https://www.youtube-nocookie.com https://toot.community;frame-ancestors 'none';base-uri 'none';form-action 'none';connect-src 'self' https://toot.community;script-src 'self' 'self'" http-equiv=content-security-policy><title>PowerShell Commands / RuDocs</title><link href=https://lifailon.github.io/docker/ rel=canonical><link href=https://lifailon.github.io/favicon.png rel=icon type=image/png><link href=https://lifailon.github.io/apple-touch-icon.png rel=apple-touch-icon sizes=180x180 type=image/png><link title="PowerShell Commands / RuDocs - RSS Feed" href=https://lifailon.github.io/rss.xml rel=alternate type=application/rss+xml><link title="PowerShell Commands / RuDocs - Atom Feed" href=https://lifailon.github.io/atom.xml rel=alternate type=application/atom+xml><style>:root{--accent-color:#ff7800;--contrast-color:#000c}[data-theme=dark]{--accent-color:#ffa348}@media (prefers-color-scheme:dark){:root:not([data-theme=light]){--accent-color:#ffa348}}[data-theme=dark]{--contrast-color:#000c}@media (prefers-color-scheme:dark){:root:not([data-theme=light]){--contrast-color:#000c}}</style><link href=https://lifailon.github.io/style.css rel=stylesheet><link media="(prefers-color-scheme: light)" href=https://lifailon.github.io/syntax-theme-light.css rel=stylesheet><link media="(prefers-color-scheme: dark)" href=https://lifailon.github.io/syntax-theme-dark.css rel=stylesheet><script defer src=https://lifailon.github.io/closable.js></script><script defer src=https://lifailon.github.io/copy-button.js></script><script defer src=https://lifailon.github.io/fuse.js></script><script defer src=https://lifailon.github.io/search-fuse.js></script><script defer src=https://lifailon.github.io/theme-switcher.js></script><meta content="PowerShell Commands / RuDocs" property=og:site_name><meta content="PowerShell Commands / RuDocs" property=og:title><meta content=https://lifailon.github.io/docker/ property=og:url><meta content="Web version for PowerShell notes in Russian language (Сheat Sheet & Documentation) and RuDocs (node.js)" property=og:description><meta content=https://lifailon.github.io/card.png property=og:image><meta content=en_US property=og:locale><body><div id=handle></div><header id=site-nav><nav><a href=#main-content tabindex=0> Skip to Main Content </a><ul><li id=home><a href=https://lifailon.github.io> <i class=icon></i>PowerShell Commands / RuDocs</a><li class=divider><li><a href=https://lifailon.github.io/powershell/>PowerShell</a><li><a href=https://lifailon.github.io/linux/>Linux</a><li><a class=active href=https://lifailon.github.io/docker/>Docker</a><li><a href=https://lifailon.github.io/windowsserver/>Windows Server</a><li><a href=https://lifailon.github.io/database/>Database</a><li><a href=https://lifailon.github.io/devops/>DevOps</a><li><a href=https://lifailon.github.io/node-js/>Node.js</a><li id=search><button class=circle id=search-toggle title=Search><i class=icon></i></button><li id=theme-switcher><details class=closable><summary class=circle title=Theme><i class=icon></i></summary> <ul><li><button title="Switch to Light Theme" class=circle id=theme-light><i class=icon></i></button><li><button title="Switch to Dark Theme" class=circle id=theme-dark><i class=icon></i></button><li><button title="Use System Theme" class=circle id=theme-system><i class=icon></i></button></ul></details><li id=repo><a class=circle href=https://github.com/Lifailon/PS-Commands title=Repository> <i class=icon></i> </a></ul></nav><div id=search-container><label class=visually-hidden for=search-bar>Search</label><input placeholder="Search for…" autocomplete=off disabled id=search-bar type=search><div id=search-results-container><div id=search-results></div></div></div></header><main id=main-content><h1></h1><p align=center><a href=https://github.com/Lifailon/PS-Commands/blob/rsa/posh.md/#docker><img title="Dpcler Commands Logo" src=Docker-Commands-Logo.png></a><hr><ul><li><a href=https://lifailon.github.io/docker/#wsl>WSL</a><li><a href=https://lifailon.github.io/docker/#install>Install</a><li><a href=https://lifailon.github.io/docker/#mirror>Mirror</a><li><a href=https://lifailon.github.io/docker/#proxy>Proxy</a><li><a href=https://lifailon.github.io/docker/#run>Run</a><li><a href=https://lifailon.github.io/docker/#update>Update</a><li><a href=https://lifailon.github.io/docker/#stats>Stats</a><li><a href=https://lifailon.github.io/docker/#logs>Logs</a><li><a href=https://lifailon.github.io/docker/#volume>Volume</a><li><a href=https://lifailon.github.io/docker/#network>Network</a><li><a href=https://lifailon.github.io/docker/#inspect>Inspect</a><li><a href=https://lifailon.github.io/docker/#exec>Exec</a><li><a href=https://lifailon.github.io/docker/#prune>Prune</a><li><a href=https://lifailon.github.io/docker/#remove>Remove</a><li><a href=https://lifailon.github.io/docker/#docker-socket-api>Docker Socket API</a><li><a href=https://lifailon.github.io/docker/#docker-tcp-api>Docker TCP API</a><li><a href=https://lifailon.github.io/docker/#context>Context</a><li><a href=https://lifailon.github.io/docker/#ctop>ctop</a><li><a href=https://lifailon.github.io/docker/#lazydocker>LazyDocker</a><li><a href=https://lifailon.github.io/docker/#dockerfile>Dockerfile</a><li><a href=https://lifailon.github.io/docker/#push>Push</a><li><a href=https://lifailon.github.io/docker/#docker-compose>Docker-Compose</a><li><a href=https://lifailon.github.io/docker/#uptime-kuma>Uptime-Kuma</a><li><a href=https://lifailon.github.io/docker/#uptime-kuma-api>Uptime-Kuma-Api</a><li><a href=https://lifailon.github.io/docker/#swarm>Swarm</a><li><a href=https://lifailon.github.io/docker/#dozzle>Dozzle</a><li><a href=https://lifailon.github.io/docker/#dozzle-auth>Dozzle-Auth</a><li><a href=https://lifailon.github.io/docker/#portainer>Portainer</a><li><a href=https://lifailon.github.io/docker/#docker-dotnet>Docker DotNet</a></ul><hr><h2 id=wsl><a aria-label="Anchor link for: wsl" class=zola-anchor href=#wsl><i class=icon></i></a> WSL</h2><p><code>wsl --list</code> список установленных дистрибутивов Linux <br> <code>wsl --list --online</code> список доступных дистрибутивов <br> <code>wsl --install -d Ubuntu</code> установить Ubuntu в Windows Subsystem for Linux <br> <code>wsl --status</code> <br> <code>wsl --exec "htop"</code> выполнить команду в подсистеме Linux по умолчанию <br> <code>wsl -e bash -c "docker -v"</code> <br> <code>wsl -e bash -c "systemctl status docker"</code><h2 id=install><a aria-label="Anchor link for: install" class=zola-anchor href=#install><i class=icon></i></a> Install</h2><p><code>apt update && apt upgrade -y</code> <br> <code>apt install docker.io</code> <br> <code>systemctl status docker</code> <br> <code>systemctl start docker</code> <br> <code>systemctl enable docker</code> <br> <code>iptables -t nat -N DOCKER</code> <br> <code>docker -v</code> <br> <code>docker -h</code> <br> <code>curl https://registry-1.docker.io/v2/</code> проверить доступ к Docker Hub <br> <code>curl -s -X POST -H "Content-Type: application/json" -d '{"username": "lifailon", "password": "password"}' https://hub.docker.com/v2/users/login | jq -r .token > dockerToken.txt</code> получить временный токен доступа для авторизации <br> <code>sudo docker login</code> вход в реестр репозитория hub.docker.com <br> <code>cat dockerToken.txt | sudo docker login --username lifailon --password-stdin</code> передать токен авторизации (https://hub.docker.com/settings/security) из файла через stdin <br> <code>cat /root/.docker/config.json | jq -r .auths[].auth</code> место хранения токена авторизации в системе <br> <code>cat /root/.docker/config.json | python3 -m json.tool</code><h2 id=mirror><a aria-label="Anchor link for: mirror" class=zola-anchor href=#mirror><i class=icon></i></a> Mirror</h2><p><code>echo '{ "registry-mirrors": ["https://dockerhub.timeweb.cloud"] }' > "/etc/docker/daemon.json"</code> <br> <code>echo '{ "registry-mirrors": ["https://huecker.io"] }' > "/etc/docker/daemon.json"</code> <br> <code>echo '{ "registry-mirrors": ["https://mirror.gcr.io"] }' > "/etc/docker/daemon.json"</code> <br> <code>echo '{ "registry-mirrors": ["https://daocloud.io"] }' > "/etc/docker/daemon.json"</code> <br> <code>echo '{ "registry-mirrors": ["https://c.163.com"] }' > "/etc/docker/daemon.json"</code><p><code>systemctl restart docker</code><h2 id=proxy><a aria-label="Anchor link for: proxy" class=zola-anchor href=#proxy><i class=icon></i></a> Proxy</h2><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">mkdir</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span> /etc/systemd/system/docker.service.d</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell"><span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>[Service]
</span></span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell"><span class="z-string z-quoted z-single z-shell">Environment="HTTP_PROXY=http://docker:password@192.168.3.100:9090"
</span></span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell"><span class="z-string z-quoted z-single z-shell">Environment="HTTPS_PROXY=http://docker:password@192.168.3.100:9090"<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-keyword z-operator z-assignment z-redirection z-shell">></span> /etc/systemd/system/docker.service.d/http-proxy.conf</span>
</span></code></pre><p><code>systemctl daemon-reload</code> <br> <code>systemctl restart docker</code><h2 id=run><a aria-label="Anchor link for: run" class=zola-anchor href=#run><i class=icon></i></a> Run</h2><p>Commands: <code>search/pull/images/creat/start/ps/restart/pause/unpause/rename/stop/kill/rm/rmi</code><p><code>docker search speedtest</code> поиск образа в реестре <br> <code>docker pull adolfintel/speedtest</code> скачать образ LibreSpeed из реестра Docker Hub (https://hub.docker.com/r/adolfintel/speedtest) <br> <code>docker images (docker image ls)</code> отобразить все локальные (уже загруженные) образы docker (image ls) <br> <code>docker images --format "table {{.ID}}\t{{.Repository}}\t{{.Tag}}"</code> отфильтровать вывод (json-формат) <br> <code>docker create -it --name speedtest -p 8080:80 adolfintel/speedtest</code> создать контейнер из образа adolfintel/speedtest с именем speedtest и проброс 80 порта контейнера на 8080 порт хоста <br> <code>docker start speedtest</code> запустить созданный контейнер <br> <code>ss -ltp | grep 8080</code> проверить, что порт открыт <br> <code>docker ps</code> отобразить все запущенные докер контейнеры <br> <code>docker ps -a</code> список всех существующих контейнеров (для их запуска/удаления по NAMES/ID и код выхода Exited 0 - успешная остановка) <br> <code>docker ps -s</code> размер контейнеров (–size) <br> <code>docker restart speedtest</code> перезапустить контейнер <br> <code>docker pause speedtest</code> приостановить контейнер <br> <code>docker unpause uptime-kuma</code> возобновить работу контейнера <br> <code>docker rename speedtest speedtest-2</code> переименоввать контейнер (docker rename old_name new_name) <br> <code>docker stop speedtest-2</code> остановить работающий контейнер с отправкой главному процессу контейнера сигнал SIGTERM, и через время SIGKILL <br> <code>docker kill uptime-kuma</code> остановить работающий контейнер с отправкой главному процессу контейнера сигнал SIGKILL <br> <code>docker kill $(docker ps -q)</code> остановить все контейнеры <br> <code>docker rm speedtest-2</code> удалить контейнер <br> <code>docker rmi adolfintel/speedtest</code> удалить образ <br> <code>docker run -d --restart=unless-stopped --name openspeedtest -p 3000:3000 -p 3001:3001 openspeedtest/latest</code> загрузить образ OpenSpeedTest (https://hub.docker.com/r/openspeedtest/latest), создать контейнер и запустить в одну команду в фоновом режиме (-d/–detach, терминал возвращает контроль сразу после запуска контейнера, если не используется, можно видеть логи, но придется остановить контейнер для выхода) <br> <code>docker rm openspeedtest && docker rmi openspeedtest/latest</code> удаляем контейнер и образ в одну команду <br> <code>docker run --name pg1 -p 5433:5432 -e POSTGRES_PASSWORD=PassWord -d postgres</code> создать контейнер postgres (https://hub.docker.com/_/postgres) с параметрами (-e) <br> <code>docker run -d --restart=always --name uptime-kuma -p 8080:3001 louislam/uptime-kuma:1</code> создать и запустить контейнер Uptime-Kuma (https://hub.docker.com/r/elestio/uptime-kuma) в режиме always, при котором контейнер должен перезапускаться автоматически, если он остановится или если перезапустится Docker (например, после перезагрузки хоста)<h2 id=update><a aria-label="Anchor link for: update" class=zola-anchor href=#update><i class=icon></i></a> Update</h2><p><code>docker update --restart unless-stopped uptime-kuma</code> изменить режим перезапуска контейнера после его остановки на unless-stopped (режим аналогичен always, но контейнер не будет перезапущен, если он был остановлен вручную с помощью docker stop) <br> <code>docker update --restart on-failure uptime-kuma</code> контейнер будет перезапущен только в случае его завершения с ошибкой, когда код завершения отличается от 0, через двоеточие можно указать количество попыток перезапуска (например, on-failure:3) <br> <code>docker update --cpu-shares 512 --memory 500M uptime-kuma</code> задать ограничения по CPU, контейнер будет иметь доступ к указанной доле процессорного времени в диапазоне от 2 до 262,144 (2^18) или –cpus (количество процессоров), –memory/–memory-swap и –blkio-weight для IOps (относительный вес от 10 до 1000)<h2 id=stats><a aria-label="Anchor link for: stats" class=zola-anchor href=#stats><i class=icon></i></a> Stats</h2><p><code>docker stats</code> посмотреть статистику потребляемых ресурсов запущенными контейнерами (top) <br> <code>docker stats --no-stream --format json</code> вывести результат один раз в формате json<h2 id=logs><a aria-label="Anchor link for: logs" class=zola-anchor href=#logs><i class=icon></i></a> Logs</h2><p><code>docker logs uptime-kuma --tail 100</code> показать логи конкретного запущенного контейнера в терминале (последние 100 строк) <br> <code>docker system events</code> предоставляют события от демона dockerd в реальном времени <br> <code>journalctl -xeu docker.service</code> <br> <code>docker system df</code> отобразить сводную информацию занятого пространства образами и контейнерами <br> <code>du -h --max-depth=1 /var/lib/docker</code> <br> <code>du -h --max-depth=2 /var/lib/docker/containers</code><h2 id=volume><a aria-label="Anchor link for: volume" class=zola-anchor href=#volume><i class=icon></i></a> Volume</h2><p><code>docker volume ls</code> показывает список томов и место хранения (механизмы хранения постояннымх данных контейнера на хостовой машине, которые сохраняются между перезапусками или пересозданиями контейнеров) <br> <code>docker volume inspect uptime-kuma</code> подробная информация конфигурации тома (отображает локальный путь к данным в системе, Mountpoint: /var/lib/docker/volumes/uptime-kuma/_data) <br> <code>docker volume create test</code> создать том <br> <code>docker volume rm test</code> удалить том <br> <code>docker run -d --restart=always --name uptime-kuma -p 8080:3001 -v uptime-kuma:/app/data louislam/uptime-kuma:1</code> создать и запустить контейнер на указанном томе (том создается автоматически, в дальнейшем его можно указывать при создании контейнера, если необходимо загружать из него сохраненные данные)<h2 id=network><a aria-label="Anchor link for: network" class=zola-anchor href=#network><i class=icon></i></a> Network</h2><p><code>docker network ls</code> список сетей <br> <code>docker network inspect bridge</code> подробная информация о сети bridge <br> <code>docker inspect uptime-kuma | jq .[].NetworkSettings.Networks</code> узнать наименование сетевого адаптера указанного контейнера <br> <code>docker run -d --name uptime-kuma --network host nginx louislam/uptime-kuma:1</code> запуск контейнера с использованием host сети, которая позволяет контейнеру использовать сеть хостовой машины <br> <code>docker network create network_test</code> создать новую сеть <br> <code>docker network connect network_test uptime-kuma</code> подключить работающий контейнер к указанной сети <br> <code>docker network disconnect network_test uptime-kuma</code> отключить от сети<h2 id=inspect><a aria-label="Anchor link for: inspect" class=zola-anchor href=#inspect><i class=icon></i></a> Inspect</h2><p><code>docker inspect uptime-kuma</code> подробная информация о контейнере (например, конфигурация NetworkSettings) <br> <code>docker inspect uptime-kuma --format='{{.LogPath}}'</code> показать, где хранятся логи для конкретного контейнера в локальной системе <br> <code>docker inspect uptime-kuma | grep LogPath</code> <br> <code>docker inspect $(docker ps -q) --format='{{.NetworkSettings.Ports}}'</code> отобразить TCP порты всех запущенных контейнеров <br> <code>docker inspect $(docker ps -q) --format='{{.NetworkSettings.Ports}}' | grep -Po "[0-9]+(?=}])"</code> отобразить порты хоста (внешние) <br> <code>docker port uptime-kuma</code> отобразить проброшенные порты контейнера <br> <code>for ps in $(docker ps -q); do docker port $ps | sed -n 2p | awk -F ":" '{print $NF}'; done</code> отобразить внешние порты всех запущенных контейнеров <br> <code>id=$(docker inspect uptime-kuma | jq -r .[].Id)</code> узнать ID контейнера по его имени в конфигурации <br> <code>cat /var/lib/docker/containers/$id/config.v2.json | jq .</code> прочитать конфигурационный файл контейнера<h2 id=exec><a aria-label="Anchor link for: exec" class=zola-anchor href=#exec><i class=icon></i></a> Exec</h2><p><code>docker exec -it uptime-kuma /bin/bash</code> подключиться к работающему контейнеру (при выходе из оболочки, контейнер будет работать), используя интерпритатор bash <br> <code>docker top uptime-kuma</code> отобразить работающие процессы контейнера <br> <code>docker exec -it --user root uptime-kuma bash apt-get install -y procps</code> авторизоваться под пользователем root и установить procps <br> <code>docker exec -it uptime-kuma ps -aux</code> отобразить работающие процессы внутри контейнера <br> <code>docker exec uptime-kuma kill -9 25055</code> убить процесс внутри контейнера <br> <code>docker exec -it uptime-kuma ping 8.8.8.8</code> <br> <code>docker exec -it uptime-kuma pwd</code> <br> <code>docker cp ./Console-Performance.sh uptime-kuma:/app</code> скопировать из локальной системы в контейнер <br> <code>docker exec -it uptime-kuma ls</code> <br> <code>docker cp uptime-kuma:/app/db/ backup/db</code> сокпировать из контейнера в локальную систему <br> <code>ls backup/db</code><h2 id=prune><a aria-label="Anchor link for: prune" class=zola-anchor href=#prune><i class=icon></i></a> Prune</h2><p><code>docker network prune && docker image prune && docker volume prune && docker container prune</code> удалить все неиспользуемые сети, висящие образа, остановленные контейнеры, все неиспользуемые тома <br> <code>system prune –volumes</code> заменяет все четыре команды для очистки и дополнительно очищает кеш сборки<h2 id=remove><a aria-label="Anchor link for: remove" class=zola-anchor href=#remove><i class=icon></i></a> Remove</h2><p><code>systemctl stop docker.service</code> <br> <code>systemctl stop docker.socket</code> <br> <code>pkill -f docker</code> <br> <code>pkill -f containerd</code> <br> <code>apt purge docker.io -y || dpkg --purge docker.io</code> <br> <code>dpkg -l | grep docker</code> <br> <code>rm -rf /var/lib/docker</code> <br> <code>rm -rf /run/docker</code> <br> <code>rm -rf /run/docker.sock</code><h2 id=docker-socket-api><a aria-label="Anchor link for: docker-socket-api" class=zola-anchor href=#docker-socket-api><i class=icon></i></a> Docker Socket API</h2><p><code>curl --silent -XGET --unix-socket /run/docker.sock http://localhost/version | jq .</code> использовать локальный сокет (/run/docker.sock) для взаимодействия с Docker daemon через его API <br> <code>curl --silent -XGET --unix-socket /run/docker.sock http://localhost/info | jq .</code> количество образов, запущенных и остановленных контейнеров и остальные метрики ОС <br> <code>curl --silent -XGET --unix-socket /run/docker.sock http://localhost/events</code> логи Docker daemon <br> <code>curl --silent -XGET --unix-socket /run/docker.sock -H "Content-Type: application/json" http://localhost/containers/json | jq .</code> список работающих контейнеров и их параметры конфигурации <br> <code>curl --silent -XGET --unix-socket /run/docker.sock http://localhost/containers/uptime-kuma/json | jq .</code> подробные сведения (конфигурация) контейнера <br> <code>curl --silent -XPOST --unix-socket /run/docker.sock -d "{"Image":"nginx:latest"}" http://localhost/containers/create?name=nginx</code> создать контейнер с указанным образом в теле запроса (должен уже присутствовать образ) <br> <code>curl --silent -XPOST --unix-socket /run/docker.sock http://localhost/containers/17fab06a820debf452fe685d1522a9dd1611daa3a5087ff006c2dabbe25e52a1/start</code> запустить контейнер по Id <br> <code>curl --silent -XPOST --unix-socket /run/docker.sock http://localhost/containers/17fab06a820debf452fe685d1522a9dd1611daa3a5087ff006c2dabbe25e52a1/stop</code> остановить контейнер <br> <code>curl --silent -XDELETE --unix-socket /run/docker.sock http://localhost/containers/17fab06a820debf452fe685d1522a9dd1611daa3a5087ff006c2dabbe25e52a1</code> удалить контейнер<h2 id=docker-tcp-api><a aria-label="Anchor link for: docker-tcp-api" class=zola-anchor href=#docker-tcp-api><i class=icon></i></a> Docker TCP API</h2><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>{
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">    "hosts": ["tcp://0.0.0.0:2375", "unix:///var/run/docker.sock"]
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">}<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">></span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>/etc/docker/daemon.json<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">service</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">cat</span></span><span class="z-meta z-function-call z-arguments z-shell"> /lib/systemd/system/docker.service</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sed</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>s/ -H fd:\/\///<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-printf z-shell">printf</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>%s\n<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">service</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">></span> /lib/systemd/system/docker.service</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">systemctl</span></span><span class="z-meta z-function-call z-arguments z-shell"> daemon-reload</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">systemctl</span></span><span class="z-meta z-function-call z-arguments z-shell"> restart docker</span>
</span></code></pre><p>curl –silent -XGET http://192.168.3.102:2375/version | jq .<h2 id=context><a aria-label="Anchor link for: context" class=zola-anchor href=#context><i class=icon></i></a> Context</h2><p><code>docker context create devops-01 --docker "host=tcp://192.168.3.101:2375"</code> подключиться к удаленному сокету <br> <code>docker context ls</code> список контекстов <br> <code>docker context inspect devops-01</code> конфигурация указанного контекста <br> <code>docker context use devops-01</code> использовать выбранный контекст по умолчанию (возможно на прямую взаимосдействовать с удаленным Docker Engine через cli) <br> <code>docker context rm devops-01</code> удалить контекст<h2 id=ctop><a aria-label="Anchor link for: ctop" class=zola-anchor href=#ctop><i class=icon></i></a> ctop</h2><p><code>scoop install ctop</code> установка в Windows (https://github.com/bcicen/ctop)<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">wget</span></span><span class="z-meta z-function-call z-arguments z-shell"> https://github.com/bcicen/ctop/releases/download/v0.7.7/ctop-0.7.7-linux-amd64<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>O</span> /usr/local/bin/ctop</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">chmod</span></span><span class="z-meta z-function-call z-arguments z-shell"> +x /usr/local/bin/ctop</span>
</span></code></pre><p><code>ctop</code> отображает сводную таблицу (top) CPU, MEM, NET RX/TX, IO R/W <br> <code>o</code> - графики <br> <code>l</code> - логи контейнера в реальном времени <br> <code>s</code> - stop/start <br> <code>R</code> - remove после stop <br> <code>p</code> - pause/unpause <br> <code>r</code> - restart <br> <code>e</code> - exec shell<h2 id=lazydocker><a aria-label="Anchor link for: lazydocker" class=zola-anchor href=#lazydocker><i class=icon></i></a> LazyDocker</h2><p><code>scoop install lazydocker || choco install lazydocker</code> установка в Windows (https://github.com/jesseduffield/lazydocker)<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">wget</span></span><span class="z-meta z-function-call z-arguments z-shell"> https://github.com/jesseduffield/lazydocker/releases/download/v0.23.1/lazydocker_0.23.1_Linux_x86.tar.gz<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>O</span> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>/lazydocker.tar.gz</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">tar</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>xzf</span> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>/lazydocker.tar.gz lazydocker</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">rm</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>/lazydocker.tar.gz</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">mv</span></span><span class="z-meta z-function-call z-arguments z-shell"> lazydocker /usr/local/bin/lazydocker</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">chmod</span></span><span class="z-meta z-function-call z-arguments z-shell"> +x /usr/local/bin/lazydocker</span>
</span></code></pre><p>lazydocker<h2 id=dockerfile><a aria-label="Anchor link for: dockerfile" class=zola-anchor href=#dockerfile><i class=icon></i></a> Dockerfile</h2><p><code>FROM</code> указывает базовый образ, на основе которого будет создаваться новый образ <br> <code>LABEL</code> добавляет метаданные к образу в формате ключ-значение <br> <code>ENV</code> устанавливает переменные окружения, которые будут доступны внутри контейнера <br> <code>RUN</code> выполняет команды в контейнере во время сборки образа <br> <code>COPY</code> копирует файлы и каталоги из указанного источника на локальной машине в файловую систему контейнера <br> <code>ADD</code> копирует файлы и каталоги в контейнер, поддерживает URL и автоматическое извлечение архивов <br> <code>CMD</code> определяет команду, которая будет выполняться при запуске контейнера, может быть переопределена при запуске <br> <code>ENTRYPOINT</code> задает основную команду, которая будет выполняться при запуске контейнера <br> <code>WORKDIR</code> устанавливает рабочий каталог внутри контейнера для последующих команд <br> <code>ARG</code> определяет переменные, которые могут быть переданы на этапе сборки образа <br> <code>VOLUME</code> создает точку монтирования для хранения данных, сохраняемых вне контейнера <br> <code>EXPOSE</code> указывает, какие порты контейнера будут доступны извне <br> <code>USER</code> устанавливает пользователя, от имени которого будут выполняться следующие команды <br> <code>HEALTHCHECK</code> определяет команду для проверки состояния работающего контейнера <br> <code>ONBUILD</code> задает команды, которые будут автоматически выполнены при сборке дочерних образов <br> <code>STOPSIGNAL</code> определяет сигнал, который будет отправлен контейнеру для его остановки <br> <code>SHELL</code> задает командную оболочку, которая будет использоваться для исполнения команд RUN, CMD, ENTRYPOINT и т.д.<p><code>git clone https://github.com/Lifailon/TorAPI</code> <br> <code>cd TorAPI</code> <br> <code>nano Dockerfile</code><pre class="language-Dockerfile z-code" data-lang=Dockerfile><code class=language-Dockerfile data-lang=Dockerfile><span class="z-source z-dockerfile"><span class="z-comment z-dockerfile"><span class="z-punctuation z-definition z-comment z-dockerfile">#</span> Указать базовый образ, который содержит последнюю версию Node.js и npm для создания контейнера
</span></span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">FROM</span> node:<span class="z-entity z-name z-enum z-tag-digest">latest</span>
</span><span class="z-source z-dockerfile"><span class="z-comment z-dockerfile"><span class="z-punctuation z-definition z-comment z-dockerfile">#</span> Установить рабочую директорию для контейнера (все последующие команды будут выполняться относительно этой директории)
</span></span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">WORKDIR </span>/torapi
</span><span class="z-source z-dockerfile"><span class="z-comment z-dockerfile"><span class="z-punctuation z-definition z-comment z-dockerfile">#</span> Копирует файл package.json из текущей директории на хосте в рабочую директорию контейнера
</span></span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">COPY</span> package.json ./
</span><span class="z-source z-dockerfile"><span class="z-comment z-dockerfile"><span class="z-punctuation z-definition z-comment z-dockerfile">#</span> Запускает команду (используя оболочку по умолчанию) для установки зависимостей, указанных в package.json
</span></span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">RUN </span>npm install
</span><span class="z-source z-dockerfile"><span class="z-comment z-dockerfile"><span class="z-punctuation z-definition z-comment z-dockerfile">#</span> Копирует все файлы из текущей директории на хосте в рабочую директорию контейнера
</span></span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">COPY</span> . .
</span><span class="z-source z-dockerfile"><span class="z-comment z-dockerfile"><span class="z-punctuation z-definition z-comment z-dockerfile">#</span> Определяем переменные окружения по умолчанию
</span></span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">ENV </span>PORT=8443
</span><span class="z-source z-dockerfile"><span class="z-comment z-dockerfile"><span class="z-punctuation z-definition z-comment z-dockerfile">#</span> Открывает порт 8443 для доступа к приложению из контейнера
</span></span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">EXPOSE </span>$PORT
</span><span class="z-source z-dockerfile"><span class="z-comment z-dockerfile"><span class="z-punctuation z-definition z-comment z-dockerfile">#</span> Устанавливает команду по умолчанию для запуска при старте контейнера, которая запускает приложение с помощью npm start
</span></span><span class="z-source z-dockerfile"><span class="z-keyword z-operator z-dockerfile">CMD </span>[<span class="z-string z-quoted z-double z-dockerfile"><span class="z-punctuation z-definition z-string z-begin z-dockerfile">"</span>npm<span class="z-punctuation z-definition z-string z-end z-dockerfile">"</span></span>, <span class="z-string z-quoted z-double z-dockerfile"><span class="z-punctuation z-definition z-string z-begin z-dockerfile">"</span>start<span class="z-punctuation z-definition z-string z-end z-dockerfile">"</span></span>]
</span></code></pre><p><code>docker build -t torapi .</code> собрать образ из dockerfile <br> <code>docker run -d --name TorAPI -p 8443:8443 torapi</code><h2 id=push><a aria-label="Anchor link for: push" class=zola-anchor href=#push><i class=icon></i></a> Push</h2><p><code>docker login</code> <br> <code>git clone https://github.com/Lifailon/TorAPI</code> <br> <code>cd TorAPI</code> <br> <code>docker build -t lifailon/torapi .</code> собрать образ для публикации на Docker Hub <br> <code>docker push lifailon/torapi</code> загрузить образ на Docker Hub<p><code>docker pull lifailon/torapi:latest</code> загрузить образ из Docker Hub <br> <code>docker run -d --name TorAPI -p 8443:8443 lifailon/torapi:latest</code> загрузить образ и создать контейнер<h2 id=docker-compose><a aria-label="Anchor link for: docker-compose" class=zola-anchor href=#docker-compose><i class=icon></i></a> Docker-Compose</h2><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">curl</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>L</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>https://github.com/docker/compose/releases/download/1.27.0/docker-compose-<span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">uname</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>s</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span>-<span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">uname</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>m</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>o</span> /usr/local/bin/docker-compose</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">chmod</span></span><span class="z-meta z-function-call z-arguments z-shell"> +x /usr/local/bin/docker-compose</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker-compose</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>version</span></span>
</span></code></pre><p><code>nano docker-compose.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">version</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>3.8<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">services</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">torapi</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">image</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">lifailon/torapi:latest</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">container_name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">TorAPI</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">volumes</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">torapi:/rotapi</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ports</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>8443:8443<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">restart</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">unless-stopped</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">volumes</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">torapi</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span></code></pre><p><code>docker-compose up -d</code> при повторном запуске пересоздаст контейнер с изменениями<h2 id=uptime-kuma><a aria-label="Anchor link for: uptime-kuma" class=zola-anchor href=#uptime-kuma><i class=icon></i></a> Uptime-Kuma</h2><p><code>nano docker-compose.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">version</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>3.8<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">services</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">uptime-kuma</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">image</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">louislam/uptime-kuma:1</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">container_name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">uptime-kuma</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">volumes</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">uptime-kuma:/app/data</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ports</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>8080:3001<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">restart</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">unless-stopped</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">volumes</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">uptime-kuma</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span></code></pre><p><code>docker-compose up -d</code><h2 id=uptime-kuma-api><a aria-label="Anchor link for: uptime-kuma-api" class=zola-anchor href=#uptime-kuma-api><i class=icon></i></a> Uptime-Kuma-Api</h2><p><code>nano docker-compose.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">version</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>3.9<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">services</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">kuma</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">container_name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">uptime-kuma-frontend</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">image</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">louislam/uptime-kuma:latest</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ports</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>8080:3001<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">restart</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">unless-stopped</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">volumes</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">uptime-kuma:/app/data</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">api</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">container_name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">uptime-kuma-backend-api</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">image</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">medaziz11/uptimekuma_restapi</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">volumes</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">api:/db</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">restart</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">unless-stopped</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">environment</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">KUMA_SERVER=http://kuma:3001</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">KUMA_USERNAME=admin</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">KUMA_PASSWORD=KumaAdmin</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ADMIN_PASSWORD=KumaApiAdmin</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">depends_on</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">kuma</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ports</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>8081:8000<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">volumes</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">uptime-kuma</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">api</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span></code></pre><p><code>docker-compose up -d</code><p>OpenAPI doc: http://192.168.3.102:8081/docs <br> <code>TOKEN=$(curl -s -X POST http://192.168.3.102:8081/login/access-token --data "username=admin" --data "password=KumaApiAdmin" | jq -r .access_token)</code> <br> <code>curl -s -X GET -H "Authorization: Bearer ${TOKEN}" http://127.0.0.1:8081/monitors | jq .</code> <br> <code>curl -s -X GET -H "Authorization: Bearer ${TOKEN}" http://127.0.0.1:8081/monitors/1 | jq '.monitor | "\(.name) - \(.active)"'</code><h2 id=swarm><a aria-label="Anchor link for: swarm" class=zola-anchor href=#swarm><i class=icon></i></a> Swarm</h2><p><code>docker swarm init</code> инициализировать manager node и получить токен для подключения worker node (сервер) <br> <code>docker swarm join-token manager</code> узнать токен подключения <br> <code>docker swarm join --token SWMTKN-1-1a078rm7vuenefp6me84t4swqtvdoveu6dh2pw34xjcf2gyw33-81f8r32jt3kkpk4dqnt0oort9 192.168.3.101:2377</code> подключение на worker node (клиент) <br> <code>docker node ls</code> отобразить список node на manager node <br> <code>docker node inspect u4u897mxb1oo39pbj5oezd3um</code> подробная информация (конфигурация) о node по id <br> <code>docker swarm leave --force</code> выйти из кластера на worker node (на manager node изменится статус с Ready на Down) <br> <code>docker node rm u4u897mxb1oo39pbj5oezd3um</code> удалить node (со статусом Down) на manager node <br> <code>docker pull lifailon/torapi:latest</code> <br> <code>nano docker-compose-stack.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">version</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>3.8<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">services</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">torapi</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">image</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">lifailon/torapi:latest</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">deploy</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">replicas</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">2</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">restart_policy</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">condition</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">on-failure</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">update_config</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">order</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">start-first</span>
</span><span class="z-source z-yaml">      <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Режим виртуального IP для балансировки нагрузки
</span></span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">endpoint_mode</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">vip</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">volumes</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">torapi:/rotapi</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ports</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Порт внутри контейнера
</span></span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">target</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">8443</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">published</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">8443</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">protocol</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">tcp</span>
</span><span class="z-source z-yaml">        <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Режим балансировки нагрузки по умолчанию
</span></span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">mode</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ingress</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">volumes</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">torapi</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span></code></pre><p><code>docker stack deploy -c docker-compose-stack.yml TorAPI</code> собрать стэк сервисов, определенных в docker-compose (на worker node появится контейнер TorAPI_torapi.1.ug5ngdlqkl76dt) <br> <code>docker stack ls</code> отобразить список стэков <br> <code>docker service ls</code> список сервисов всех стэков <br> <code>docker stack ps TorAPI</code> список задач в стеке <br> <code>docker stack services TorAPI</code> список сервисов внутри стэка указанного стэка по имени <br> <code>docker service ps TorAPI_torapi</code> подробная информация о сервисе по его имени (TorAPI имя стэка и _torapi имя сервиса) <br> <code>docker service inspect --pretty TorAPI_torapi</code> конфигурация сервиса <br> <code>docker service inspect TorAPI_torapi</code> конфигурация сервиса в формате JSON <br> <code>docker service logs TorAPI_torapi</code> журнала конкретного сервиса по всем серверам кластера <br> <code>docker service scale TorAPI_torapi=3</code> масштабирует сервис до указанного числа реплик <br> <code>docker stack rm TorAPI</code> удалить стэк (не требует остановки контейнеров)<h2 id=dozzle><a aria-label="Anchor link for: dozzle" class=zola-anchor href=#dozzle><i class=icon></i></a> Dozzle</h2><p><code>docker run -d --name dozzle -v /var/run/docker.sock:/var/run/docker.sock -p 9999:8080 amir20/dozzle:latest</code> <br> <code>docker run -d --name dozzle -v /var/run/docker.sock:/var/run/docker.sock -p 9999:8080 amir20/dozzle:latest --remote-host tcp://192.168.3.102:2375|mon-01</code> доступ к удаленному хосту через Docker-tcp-api <br> http://192.168.3.102:9999<h2 id=dozzle-auth><a aria-label="Anchor link for: dozzle-auth" class=zola-anchor href=#dozzle-auth><i class=icon></i></a> Dozzle-Auth</h2><p><code>echo -n DozzleAdmin | shasum -a 256</code> получить пароль в формате sha-256 <br> <code>mkdir dozzle && nano ./dozzle/users.yml</code> создать авторизационный файл<pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">users</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">admin</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>admin<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">password</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>a800c3ee4dac5102ed13ba673589077cf0a87a7ddaff59882bb3c08f275a516e<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span></code></pre><p><code>nano docker-compose.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">version</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>3.8<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">services</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">dozzle</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">image</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">amir20/dozzle:latest</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">container_name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">dozzle</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">volumes</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">/var/run/docker.sock:/var/run/docker.sock</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">./dozzle:/data</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ports</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">9999:8080</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">environment</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">DOZZLE_AUTH_PROVIDER</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">simple</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">DOZZLE_HOSTNAME</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">dozzle</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">DOZZLE_REMOTE_HOST</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">tcp://192.168.3.102:2375|mon-01</span>
</span></code></pre><p><code>docker-compose up -d</code><h2 id=portainer><a aria-label="Anchor link for: portainer" class=zola-anchor href=#portainer><i class=icon></i></a> Portainer</h2><p><code>curl -L https://downloads.portainer.io/portainer-agent-stack.yml -o portainer-agent-stack.yml</code> скачать yaml файл <br> <code>version_update=$(cat portainer-agent-stack.yml | sed "s/2.11.1/latest/g")</code> <br> <code>printf "%s\n" "$version_update" > portainer-agent-stack.yml</code> обновить версию в yaml файле на последнюю доступную в Docker Hub (2.19.5) <br> <code>docker stack deploy -c portainer-agent-stack.yml portainer</code> развернуть в кластере swarm (на каждом node будет установлен агент, который будет собирать данные, а на manager будет установлен сервер с web панелью) <br> https://192.168.3.101:9443<p><code>docker run -d --name portainer_agent -p 9001:9001 --restart=always -v /var/run/docker.sock:/var/run/docker.sock -v /var/lib/docker/volumes:/var/lib/docker/volumes portainer/agent:2.19.5</code> установить агент на удаленный хост <br> https://192.168.3.101:9443/#!/endpoints добавить удаленный хост по URL 192.168.3.102:9001<p><code>docker volume create portainer_data</code> создать volume для установки локального контейнера (не в кластер swarm) <br> <code>docker create -it --name=portainer -p 9000:9000 --restart=always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer</code> создать локальный контейнер <br> <code>docker start portainer</code> <br> http://192.168.3.101:9000<h2 id=docker-dotnet><a aria-label="Anchor link for: docker-dotnet" class=zola-anchor href=#docker-dotnet><i class=icon></i></a> Docker DotNet</h2><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Импорт библиотеки Docker.DotNet (https://nuget.info/packages/Docker.DotNet/3.125.15)<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Add-Type</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Path <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Documents\Docker.DotNet-3.125.15\lib\netstandard2.1\Docker.DotNet.dll<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Указываем адрес удаленного сервера Docker, на котором слушает сокет Docker API<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>config</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">Docker.DotNet.DockerClientConfiguration</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::new<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>http://192.168.3.102:2375<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Подключаемся клиентом<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>client</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>config<span class="z-variable z-other z-member z-powershell">.CreateClient</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Получить список методов класса клиента<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>client</span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-support z-function z-powershell">Get-Member</span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Выводим список контейнеров<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>containers</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>client<span class="z-variable z-other z-member z-powershell">.Containers.ListContainersAsync</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">Docker.DotNet.Models.ContainersListParameters</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::new<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.GetAwaiter<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.GetResult<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Забираем id по имени<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>kuma_id</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-group z-complex z-subexpression z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>containers</span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-support z-function z-powershell">Where-Object</span> names <span class="z-keyword z-operator z-comparison z-powershell">-match</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>uptime-kuma-front<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span>.id
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Получить список дочерних методов<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>client<span class="z-variable z-other z-member z-powershell">.Containers</span></span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-support z-function z-powershell">Get-Member</span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Остановить контейнер по его id<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>StopParameters</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">Docker.DotNet.Models.ContainerStopParameters</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::new<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>client<span class="z-variable z-other z-member z-powershell">.Containers.StopContainerAsync</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>kuma_id</span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>StopParameters</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Запустить контейнер<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>StartParameters</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">Docker.DotNet.Models.ContainerStartParameters</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::new<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>client<span class="z-variable z-other z-member z-powershell">.Containers.StartContainerAsync</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>kuma_id</span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>StartParameters</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></code></pre><span class=hidden id=copy-code-text>Copy Code</span><span class=hidden id=search-index>https://lifailon.github.io/search_index.en.json</span><span class=hidden id=more-matches-text>$MATCHES more matches</span></main><footer id=site-footer><nav><ul><li><a href=https://lifailon.github.io/powershell/>PowerShell</a><li><a href=https://lifailon.github.io/linux/>Linux</a><li><a class=active href=https://lifailon.github.io/docker/>Docker</a><li><a href=https://lifailon.github.io/windowsserver/>Windows Server</a><li><a href=https://lifailon.github.io/database/>Database</a><li><a href=https://lifailon.github.io/devops/>DevOps</a><li><a href=https://lifailon.github.io/node-js/>Node.js</a></ul></nav><p>© <strong>2023-2024</strong> <code>Lifailon</code><p><a class=external href=https://github.com/Lifailon/PS-Commands>Website source</a><p><small>Powered by <a class="link external" href=https://www.getzola.org>Zola</a> and <a class="link external" href=https://duckquill.daudix.one>Duckquill</a> </small><ul id=socials><li><a rel=" me" href=https://github.com/lifailon/PS-Commands title=GitHub> <i style="--icon:url(&#34data:image/svg+xml,%3Csvg role='img' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Ctitle%3EGitHub%3C/title%3E%3Cpath d='M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12'/%3E%3C/svg%3E&#34)" class=icon></i> <span>GitHub</span> </a><li><a rel=" me" href=https://www.nuget.org/profiles/Lifailon title=NuGet> <i style="--icon:url(&#34data:image/svg+xml,%3Csvg role='img' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Ctitle%3ENUGet%3C/title%3E%3Cpath d='M1.57 0A1.57 1.57 0 000 1.57v20.86A1.57 1.57 0 001.57 24h20.86A1.57 1.57 0 0024 22.43V1.57A1.57 1.57 0 0022.43 0zM7.5 1.5A2.5 2.5 0 0110 4a2.5 2.5 0 01-2.5 2.5A2.5 2.5 0 015 4a2.5 2.5 0 012.5-2.5zM12 6h9v12h-1.5a3.76 3.76 0 00-2.81-1.25A3.76 3.76 0 0012.5 20a3.76 3.76 0 002.19 3.25A3.76 3.76 0 0018.5 24H21V6z'/%3E%3C/svg%3E&#34)" class=icon></i> <span>NuGet</span> </a></ul></footer>