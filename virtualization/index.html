<!DOCTYPE html>
<html lang="en-us">
    <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="generator" content="Hugo 0.123.8">

    

    

    
        
            <meta
                name="description"
                content="Large base of PowerShell notes in Russian language" />
        

        
            <meta
                name="keywords"
                content="PowerShell" />
        

        
            <meta name="author" content="Lifailon" />
        

    


    <title>
        
            Virtualization |
            Lifailon.GitHub.io
        
    </title>

    


    
    

    
    


    
    


    
    


    
    

    


    
    

    

    

        
        


        
        


        <link
            rel="stylesheet"
            href="/css/index_d751713.min.912d03bce61461ecbc3ca083479e1ed814bba94df76d0bdc6aa88fdca33621b9bb410dc2c81af31e8101fec62decfa5f6e48901ad673bc5056d2f1d1f2368a34.css"
            integrity="sha512-kS0DvOYUYey8PKCDR54e2BS7qU33bQvcaqiP3KM2Ibm7QQ3CyBrzHoEB/sYt7PpfbkiQGtZzvFBW0vHR8jaKNA==" />
    


    
    

    

    

    

    
</head>



    <body>
        <header class="header">
    <div class="header_left">
        
    </div>

    <div class="header_middle">
        
            Virtualization -
            Lifailon.GitHub.io
        
    </div>
</header>



        <main>
            <aside class="sidebar">
    



    
    

    
    


    <ul class="section-tree">
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/powershell/" title="./powershell/">
                        PowerShell
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/dotnet/" title="./dotnet/">
                        .NET
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/activedirectory/" title="./activedirectory/">
                        Active Directory
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/ansible/" title="./ansible/">
                        Ansible
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/apps/" title="./apps/">
                        Apps
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/com/" title="./com/">
                        Component Object Model
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/git/" title="./git/">
                        Git
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/html/" title="./html/">
                        HTML
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/influxdb/" title="./influxdb/">
                        InfluxDB
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/exchange/" title="./exchange/">
                        MS Exchange
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/mssql/" title="./mssql/">
                        MS SQL
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/mysql/" title="./mysql/">
                        MySQL
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/network/" title="./network/">
                        Network
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/api/" title="./api/">
                        REST API
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/virtualization/" title="./virtualization/">
                        Virtualization
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/wmi/" title="./wmi/">
                        WMI
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/zabbix/" title="./zabbix/">
                        Zabbix
                    </a>
                </li>
            
        
    </ul>


</aside>
<aside class="exapandable"></aside>


            
    <article class="main">
        <button
    class="sidebar-toggle-btn"
    type="menu"
    aria-expanded="false"
    aria-haspopup="true">
    <i class="bi bi-list"></i>
</button>



        <div class="title">
            <h1 class="title-header">
                Virtualization
            </h1>

            <div class="author-date-readtime">
                

                    
                        <div class="author" title="Author">
                            <i class="bi bi-person"></i>
                            <a
                                href="/author/lifailon/"
                                class="cat-btn">
                                Lifailon
                            </a>
                        </div>
                    

                

                
                    <div class="date" title="Date">
                        <i class="bi bi-calendar3"></i>
                        <time
                            datetime="Mar 14 2024"
                            >Mar 14 2024
                        </time>
                    </div>
                

                
                    <div
                        class="readtime"
                        title="Time to Read">
                        <i class="bi bi-clock"></i>
                        4 mins to read
                    </div>
                
            </div>
        </div>

        <div class="article-meta">
            

            

            
                <div class="breadcumb">
                    <i class="bi bi-folder"></i>
                    
    




<a href="https://lifailon.github.io/" class="bread-btn">
    
        <i class="bi bi-house-fill"></i>
    

    
        Home
    
</a>




    /



<a href="https://lifailon.github.io/virtualization/" class="bread-btn">
    

    
        Virtualization
    
</a>

                </div>
            

            
        </div>

        
            <nav id="TableOfContents">
  <ul>
    <li><a href="#vmware">VMWare</a></li>
    <li><a href="#hyper-v">Hyper-V</a></li>
  </ul>
</nav>
        


        <div class="content">
            
                <h2 id="vmware">VMWare</h2>
<p><code>Install-Module -Name VMware.PowerCLI # -AllowClobber</code> установить модуль (PackageProvider: nuget) <br>
<code>Get-Module -ListAvailable VMware* | Select Name,Version</code> <br>
<code>Import-Module VMware.VimAutomation.Core</code> импортировать в сессию <br>
<code>Get-PSProvider | format-list Name,PSSnapIn,ModuleName</code> список оснасток Windows PowerShell</p>
<p><code>Get-PowerCLIConfiguration</code> конфигурация подключения <br>
<code>Set-PowerCLIConfiguration -Scope AllUsers -InvalidCertificateAction ignore -confirm:$false</code> eсли используется самоподписанный сертификат, изменить значение параметра InvalidCertificateAction с Unset на Ignore/Warn <br>
<code>Set-PowerCLIConfiguration -Scope AllUsers -ParticipateInCeip $false</code> отключить уведомление сбора данных через VMware Customer Experience Improvement Program (CEIP)</p>
<p><code>Read-Host –AsSecureString | ConvertFrom-SecureString | Out-File &quot;$home\Documents\vcsa_password.txt&quot;</code> зашифровать пароль и сохранить в файл <br>
<code>$esxi = &quot;vcsa.domain.local&quot;</code> <br>
<code>$user = &quot;administrator@vsphere.local&quot;</code> <br>
<code>$pass = Get-Content &quot;$home\Documents\vcsa_password.txt&quot; | ConvertTo-SecureString</code> прочитать пароль <br>
<code>$pass = &quot;password&quot;</code> <br>
<code>$Cred = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList $user ,$pass</code> <br>
<code>Connect-VIServer $esxi -User $Cred.Username -Password $Cred.GetNetworkCredential().password</code> подключиться, используя PSCredential ($Cred) <br>
<code>Connect-VIServer $esxi -User $user -Password $pass</code> подключиться, используя логин и пароль</p>
<p><code>Get-Command –Module *vmware*</code> <br>
<code>Get-Command –Module *vmware* -name *get*iscsi*</code> <br>
<code>Get-IScsiHbaTarget</code> <br>
<code>Get-Datacenter</code> <br>
<code>Get-Cluster</code> <br>
<code>Get-VMHost</code> <br>
<code>Get-VMHost | select Name,Model,ProcessorType,MaxEVCMode,NumCpu,CpuTotalMhz,CpuUsageMhz,MemoryTotalGB,MemoryUsageGB</code> <br>
<code>Get-VMHostDisk | select VMHost,ScsiLun,TotalSectors</code></p>
<p><code>Get-Datastore</code> <br>
<code>Get-Datastore TNAS-vmfs-4tb-01</code> <br>
<code>Get-Datastore TNAS-vmfs-4tb-01 | get-vm</code> <br>
<code>Get-Datastore -RelatedObject vm-01</code> <br>
<code>(Get-Datastore TNAS-vmfs-4tb-01).ExtensionData.Info.GetType()</code> <br>
<code>(Get-Datastore TNAS-vmfs-4tb-01).ExtensionData.Info.Vmfs.Extent</code></p>
<p><code>Get-Command –Module *vmware* -name *disk*</code> <br>
<code>Get-VM vm-01 | Get-Datastore</code> <br>
<code>Get-VM vm-01 | Get-HardDisk</code> <br>
<code>Get-VM | Get-HardDisk | select Parent,Name,CapacityGB,StorageFormat,FileName | ft</code> <br>
<code>Copy-HardDisk</code> <br>
<code>Get-VM | Get-Snapshot</code> <br>
<code>Get-VM | where {$_.Powerstate -eq &quot;PoweredOn&quot;}</code> <br>
<code>Get-VMHost esxi-05 | Get-VM | where {$_.Powerstate -eq &quot;PoweredOff&quot;} | Move-VM –Destination (Get-VMHost esxi-06)</code></p>
<p><code>Get-VM | select Name,VMHost,PowerState,NumCpu,MemoryGB,</code> <br>
<code>@{Name=&quot;UsedSpaceGB&quot;; Expression={[int32]($_.UsedSpaceGB)}},@{Name=&quot;ProvisionedSpaceGB&quot;; Expression={[int32]($_.ProvisionedSpaceGB)}},</code> <br>
<code>CreateDate,CpuHotAddEnabled,MemoryHotAddEnabled,CpuHotRemoveEnabled,Notes</code></p>
<p><code>Get-VMGuest vm-01 | Update-Tools</code> <br>
<code>Get-VMGuest vm-01 | select OSFullName,IPAddress,HostName,State,Disks,Nics,ToolsVersion</code> <br>
<code>Get-VMGuest * | select -ExpandProperty IPAddress</code> <br>
<code>Restart-VMGuest -vm vm-01 -Confirm:$False</code> <br>
<code>Start-VM -vm vm-01 -Confirm:$False</code> <br>
<code>Shutdown-VMGuest -vm vm-01 -Confirm:$false</code></p>
<p><code>New-VM –Name vm-01 -VMHost esxi-06 –ResourcePool Production –DiskGB 60 –DiskStorageFormat Thin –Datastore TNAS-vmfs-4tb-01</code> <br>
<code>Get-VM vm-01 | Copy-VMGuestFile -Source &quot;\\$srv\Install\Soft\Btest.exe&quot; -Destination &quot;C:\Install\&quot; -LocalToGuest -GuestUser USER -GuestPassword PASS -force</code></p>
<p><code>Get-VM -name vm-01 | Export-VApp -Destination C:\Install -Format OVF</code> Export template (.ovf, .vmdk, .mf) <br>
<code>Get-VM -name vm-01 | Export-VApp -Destination C:\Install -Format OVA</code></p>
<p><code>Get-VMHostNetworkAdapter | select VMHost,Name,Mac,IP,@{Label=&quot;Port Group&quot;; Expression={$_.ExtensionData.Portgroup}} | ft</code> <br>
<code>Get-VM | Get-NetworkAdapter | select Parent,Name,Id,Type,MacAddress,ConnectionState,WakeOnLanEnabled | ft</code></p>
<p><code>Get-Command –Module *vmware* -name *event*</code> <br>
<code>Get-VIEvent -MaxSamples 1000 | where {($_.FullFormattedMessage -match &quot;power&quot;)} | select username,CreatedTime,FullFormattedMessage</code> <br>
<code>Get-logtype | select Key,SourceEntityId,Filename,Creator,Info</code> <br>
<code>(Get-Log vpxd:vpxd.log).Entries | select -Last 50</code></p>
<p><code>Get-Command –Module *vmware* -name *syslog*</code> <br>
<code>Set-VMHostSysLogServer -VMHost esxi-05 -SysLogServer &quot;tcp://192.168.3.100&quot; -SysLogServerPort 3515</code> <br>
<code>Get-VMHostSysLogServer -VMHost esxi-05</code></p>
<h2 id="hyper-v">Hyper-V</h2>
<p><code>Install-WindowsFeature -Name Hyper-V -IncludeManagementTools -Restart</code> установить роль на Windows Server <br>
<code>Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Hyper-V –All</code> установить роль на  Windows Desktop <br>
<code>Get-Command -Module hyper-v</code> <br>
<code>Get-VMHost</code></p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="New-VMSwitch%20-name%20NAT%20-SwitchType%20Internal%20#%20%d1%81%d0%be%d0%b7%d0%b4%d0%b0%d1%82%d1%8c%20%d0%b2%d0%b8%d1%80%d1%82%d1%83%d0%b0%d0%bb%d1%8c%d0%bd%d1%8b%d0%b9%20%d0%ba%d0%be%d0%bc%d0%bc%d1%83%d1%82%d0%b0%d1%82%d0%be%d1%80%20%d0%b8%20%d0%b0%d0%b4%d0%b0%d0%bf%d1%82%d0%b5%d1%80%20%d0%b4%d0%bb%d1%8f%20%d0%bd%d0%b5%d0%b3%d0%be%0d%0aGet-NetAdapter%20%7c%20where%20InterfaceDescription%20-match%20Hyper-V%20#%20%d1%81%d0%bf%d0%b8%d1%81%d0%be%d0%ba%20%d1%81%d0%b5%d1%82%d0%b5%d0%b2%d1%8b%d1%85%20%d0%b0%d0%b4%d0%b0%d0%bf%d1%82%d0%b5%d1%80%d0%be%d0%b2%0d%0aNew-NetNat%20-Name%20LocalNat%20-InternalIPInterfaceAddressPrefix%20%22192.168.3.0/24%22%20#%20%d0%b7%d0%b0%d0%b4%d0%b0%d1%82%d1%8c%20%d1%81%d0%b5%d1%82%d1%8c%0d%0aGet-NetAdapter%20%22vEthernet%20%28NAT%29%22%20%7c%20New-NetIPAddress%20-IPAddress%20192.168.3.200%20-AddressFamily%20IPv4%20-PrefixLength%2024%20#%20%d0%bf%d1%80%d0%b8%d1%81%d0%b2%d0%be%d0%b8%d1%82%d1%8c%20%d0%b0%d0%b4%d1%80%d0%b5%d1%81,%20%d0%bd%d0%b5%d0%be%d0%b1%d1%85%d0%be%d0%b4%d0%b8%d0%bc%d0%be%20%d0%bd%d0%b0%20%d0%92%d0%9c%20%d1%83%d0%ba%d0%b0%d0%b7%d0%b0%d1%82%d1%8c%20%d1%88%d0%bb%d1%8e%d0%b7%20192.168.3.200,%20%d1%87%d1%82%d0%be%20%d0%b1%d1%8b%20%d0%bd%d0%b0%d1%85%d0%be%d0%b4%d0%b8%d1%82%d1%8c%d1%81%d1%8f%20%d0%b7%d0%b0%20NAT,%20%d0%b8%d0%bb%d0%b8%20%d0%b2%20%d0%bd%d0%b0%d1%81%d1%82%d1%80%d0%be%d0%b9%d0%ba%d0%b0%20%d0%92%d0%9c%20%d1%83%d0%ba%d0%b0%d0%b7%d0%b0%d1%82%d1%8c%20%d1%81%d0%be%d0%be%d1%82%d0%b2%d0%b5%d1%82%d1%81%d1%82%d0%b2%d1%83%d1%8e%d1%89%d0%b8%d0%b9%20%d0%b0%d0%b4%d0%b0%d0%bf%d1%82%d0%b5%d1%80%0d%0aAdd-NetNatStaticMapping%20-NatName%20LocalNat%20-Protocol%20TCP%20-ExternalIPAddress%200.0.0.0%20-ExternalPort%202222%20-InternalIPAddress%20192.168.3.103%20-InternalPort%202121%20#%20%d0%bf%d1%80%d0%be%d0%b1%d1%80%d0%be%d1%81,%20%d0%b2%d0%b5%d1%81%d1%82%20%d1%82%d1%80%d0%b0%d1%84%d0%b8%d0%ba%20%d0%ba%d0%be%d1%82%d0%be%d1%80%d1%8b%d0%b9%20%d0%bf%d1%80%d0%b8%d1%85%d0%be%d0%b4%d0%b8%d1%82%20%d0%bd%d0%b0%20%d1%85%d0%be%d1%81%d1%82%20Hyper-V%20TCP/2222,%20%d0%b1%d1%83%d0%b4%d0%b5%d1%82%20%d0%bf%d0%b5%d1%80%d0%b5%d0%bd%d0%b0%d0%bf%d1%80%d0%b0%d0%b2%d0%bb%d1%8f%d1%82%d1%8c%d1%81%d1%8f%20%d0%bd%d0%b0%20%d1%81%d0%be%d0%be%d1%82%d0%b2%d0%b5%d1%82%d1%81%d1%82%d0%b2%d1%83%d1%8e%d1%89%d0%b8%d0%b9%20%d0%bf%d0%be%d1%80%d1%82%20%d0%b2%d0%b8%d1%80%d1%82%d1%83%d0%b0%d0%bb%d1%8c%d0%bd%d0%be%d0%b9%20%d0%bc%d0%b0%d1%88%d0%b8%d0%bd%d1%8b%20%d0%b7%d0%b0%20NAT.%0d%0a%28Get-NetAdapter%20%7c%20where%20Name%20-match%20NAT%29.Status">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>New-VMSwitch -name NAT -SwitchType Internal <span style="color:#75715e"># создать виртуальный коммутатор и адаптер для него</span>
</span></span><span style="display:flex;"><span>Get-NetAdapter | where InterfaceDescription <span style="color:#f92672">-match</span> Hyper-V <span style="color:#75715e"># список сетевых адаптеров</span>
</span></span><span style="display:flex;"><span>New-NetNat -Name LocalNat -InternalIPInterfaceAddressPrefix <span style="color:#e6db74">&#34;192.168.3.0/24&#34;</span> <span style="color:#75715e"># задать сеть</span>
</span></span><span style="display:flex;"><span>Get-NetAdapter <span style="color:#e6db74">&#34;vEthernet (NAT)&#34;</span> | New-NetIPAddress -IPAddress <span style="color:#ae81ff">192.168</span>.3.200 -AddressFamily IPv4 -PrefixLength <span style="color:#ae81ff">24</span> <span style="color:#75715e"># присвоить адрес, необходимо на ВМ указать шлюз 192.168.3.200, что бы находиться за NAT, или в настройка ВМ указать соответствующий адаптер</span>
</span></span><span style="display:flex;"><span>Add-NetNatStaticMapping -NatName LocalNat -Protocol TCP -ExternalIPAddress <span style="color:#ae81ff">0.0</span>.0.0 -ExternalPort <span style="color:#ae81ff">2222</span> -InternalIPAddress <span style="color:#ae81ff">192.168</span>.3.103 -InternalPort <span style="color:#ae81ff">2121</span> <span style="color:#75715e"># проброс, вест трафик который приходит на хост Hyper-V TCP/2222, будет перенаправляться на соответствующий порт виртуальной машины за NAT.</span>
</span></span><span style="display:flex;"><span>(Get-NetAdapter | where Name <span style="color:#f92672">-match</span> NAT).Status</span></span></code></pre></div>
    
</div>
<p><code>Get-NetNatStaticMapping</code> отобразить пробросы (NAT) <br>
<code>Get-NetNat</code> список сетей <br>
<code>Remove-NetNatStaticMapping -StaticMappingID 0</code> удалить проброс <br>
<code>Remove-NetNat -Name LocalNat</code> удалить сеть</p>
<p><code>New-VMSwitch -Name Local -AllowManagementOS $True -NetAdapterName &quot;Ethernet 4&quot; -SwitchType External</code> создать вшений (External) виртуальный коммутатор <br>
<code>$VMName = &quot;hv-dc-01&quot;</code></p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>$VM = @{
</span></span><span style="display:flex;"><span>Name = $VMName
</span></span><span style="display:flex;"><span>MemoryStartupBytes = <span style="color:#ae81ff">4</span>Gb
</span></span><span style="display:flex;"><span>Generation = <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>NewVHDPath = <span style="color:#e6db74">&#34;D:\VM\</span>$VMName<span style="color:#e6db74">\</span>$VMName<span style="color:#e6db74">.vhdx&#34;</span>
</span></span><span style="display:flex;"><span>NewVHDSizeBytes = <span style="color:#ae81ff">50</span>Gb
</span></span><span style="display:flex;"><span>BootDevice = <span style="color:#e6db74">&#34;VHD&#34;</span>
</span></span><span style="display:flex;"><span>Path = <span style="color:#e6db74">&#34;D:\VM\</span>$VMName<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>SwitchName = <span style="color:#e6db74">&#34;NAT&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>New-VM @VM</span></span></code></pre></div>
    
</div>
<p><code>Set-VMDvdDrive -VMName $VMName -Path &quot;C:\Users\Lifailon\Documents\WS-2016.iso&quot;</code> <br>
<code>New-VHD -Path &quot;D:\VM\$VMName\disk_d.vhdx&quot; -SizeBytes 10GB</code> создать VHDX диск <br>
<code>Add-VMHardDiskDrive -VMName $VMName -Path &quot;D:\VM\$VMName\disk_d.vhdx&quot;</code> примонтировать диск <br>
<code>Get-VM –VMname $VMName | Set-VM –AutomaticStartAction Start</code> автозапуск <br>
<code>Get-VM -Name $VMName | Set-VMMemory -StartupBytes 8Gb</code> <br>
<code>Set-VMProcessor $VMName -Count 2</code> <br>
<code>Get-VM -Name $VMName | Checkpoint-VM -SnapshotName &quot;Snapshot-1&quot;</code> <br>
<code>Restore-VMCheckpoint -Name Snapshot-1&quot; -VMName $VMName -Confirm:$false</code> <br>
<code>Get-VM | Select -ExpandProperty NetworkAdapters | Select VMName,IPAddresses,Status</code> получить IP адрес всех ВМ <br>
<code>vmconnect.exe localhost $VMHost</code></p>
<p><code>Get-NetTCPConnection -State Established,Listen | Where-Object LocalPort -Match 2179</code> найти порт слушателя
<code>Get-Process -Id (Get-NetTCPConnection -State Established,Listen | Where-Object LocalPort -Match 2179).OwningProcess</code> найти процесс по ID (vmms/VMConnect) <br>
<code>New-NetFirewallRule -Name &quot;Hyper-V&quot; -DisplayName &quot;Hyper-V&quot; -Group &quot;Hyper-V&quot; -Direction Inbound -Protocol TCP -LocalPort 2179 -Action Allow -Profile Public</code> <br>
<code>Get-LocalGroupMember -Group &quot;Администраторы Hyper-V&quot;</code> или &ldquo;Hyper-V Administrators&rdquo; <br>
<code>Add-LocalGroupMember -Group &quot;Администраторы Hyper-V&quot; -Member &quot;lifailon&quot;</code> <br>
<code>Get-VM * | select name,ID</code> добавить id в RDCMan для подключения <br>
<code>Grant-VMConnectAccess -ComputerName plex-01 -VMName hv-devops-01 -UserName lifailon</code> дать доступ на подключение не администратору <br>
<code>Grant-VMConnectAccess -ComputerName huawei-book -VMName hv-devops-01 -UserName lifailon</code> <br>
<code>Get-VMConnectAccess</code> <br>
<code>Revoke-VMConnectAccess -VMName hv-devops-01 -UserName lifailon</code></p>
<p>Error: <code>Unknown disconnection reason 3848</code> - добавить ключи реестра на стороне клиента</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>New-ItemProperty -Path HKLM<span style="color:#960050;background-color:#1e0010">:</span>\SYSTEM\CurrentControlSet\Control\Lsa\Credssp\PolicyDefaults\AllowFreshCredentialsDomain -Name Hyper-V -PropertyType String -Value <span style="color:#e6db74">&#34;Microsoft Virtual Console Service/*&#34;</span> -Force
</span></span><span style="display:flex;"><span>New-ItemProperty -Path HKLM<span style="color:#960050;background-color:#1e0010">:</span>\SYSTEM\CurrentControlSet\Control\Lsa\Credssp\PolicyDefaults\AllowDefaultCredentials -Name Hyper-V -PropertyType String -Value <span style="color:#e6db74">&#34;Microsoft Virtual Console Service/*&#34;</span> -Force
</span></span><span style="display:flex;"><span>New-ItemProperty -Path HKLM<span style="color:#960050;background-color:#1e0010">:</span>\SYSTEM\CurrentControlSet\Control\Lsa\Credssp\PolicyDefaults\AllowFreshCredentialsWhenNTLMOnlyDomain -Name Hyper-V -PropertyType String -Value <span style="color:#e6db74">&#34;Microsoft Virtual Console Service/*&#34;</span> -Force
</span></span><span style="display:flex;"><span>ItemProperty -Path HKLM<span style="color:#960050;background-color:#1e0010">:</span>\SYSTEM\CurrentControlSet\Control\Lsa\Credssp\PolicyDefaults\AllowDefaultCredentialsDomain -Name Hyper-V -PropertyType String -Value <span style="color:#e6db74">&#34;Microsoft Virtual Console Service/*&#34;</span> -Force
</span></span><span style="display:flex;"><span>New-ItemProperty -Path HKLM<span style="color:#960050;background-color:#1e0010">:</span>\SYSTEM\CurrentControlSet\Control\Lsa\Credssp\PolicyDefaults\AllowFreshCredentials -Name Hyper-V -PropertyType String -Value <span style="color:#e6db74">&#34;Microsoft Virtual Console Service/*&#34;</span> -Force
</span></span><span style="display:flex;"><span>New-ItemProperty -Path HKLM<span style="color:#960050;background-color:#1e0010">:</span>\SYSTEM\CurrentControlSet\Control\Lsa\Credssp\PolicyDefaults\AllowFreshCredentialsWhenNTLMOnly -Name Hyper-V -PropertyType String -Value <span style="color:#e6db74">&#34;Microsoft Virtual Console Service/*&#34;</span> -Force
</span></span><span style="display:flex;"><span>New-ItemProperty -Path HKLM<span style="color:#960050;background-color:#1e0010">:</span>\SYSTEM\CurrentControlSet\Control\Lsa\Credssp\PolicyDefaults\AllowSavedCredentialsWhenNTLMOnly -Name Hyper-V -PropertyType String -Value <span style="color:#e6db74">&#34;Microsoft Virtual Console Service/*&#34;</span> -Force
</span></span><span style="display:flex;"><span>New-ItemProperty -Path HKLM<span style="color:#960050;background-color:#1e0010">:</span>\SYSTEM\CurrentControlSet\Control\Lsa\Credssp\PolicyDefaults\AllowSavedCredentials -Name Hyper-V -PropertyType String -Value <span style="color:#e6db74">&#34;Microsoft Virtual Console Service/*&#34;</span> -Force
</span></span><span style="display:flex;"><span>New-ItemProperty -Path HKLM<span style="color:#960050;background-color:#1e0010">:</span>\SYSTEM\CurrentControlSet\Control\Lsa\Credssp\PolicyDefaults\AllowSavedCredentialsDomain -Name Hyper-V -PropertyType String -Value <span style="color:#e6db74">&#34;Microsoft Virtual Console Service/*&#34;</span> -Force</span></span></code></pre></div>
    
</div>

            
        </div>
    </article>

        </main>

        <footer class="footer">
    <div class="footer-left">
        <ul class="social">
            
                <li>GitHub</li>
            

            
                <li>Lifailon</li>
            

            
                
            
                
            
                
                    <li>
                        
                            <a href="https://github.com/Lifailon" target="_blank">
                                <i class="bi-github"></i>
                            </a>
                        

                    </li>
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
        </ul>
    </div>

    <div class="footer-right">
        <ul class="control status clearfix">
            

            
            

            

            
                <li>
                    <a href="https://gohugo.io" class="btn" target="_blank"
                        >Hugo: 0.123.8</a
                    >
                </li>
            

            
                <li>
                    <a
                        href="https://github.com/JingWangTW/dark-theme-editor"
                        class="btn"
                        target="_blank"
                        >Theme: dark-theme-editor</a
                    >
                </li>
            

            
                <li>
                    
                        Last modified: &nbsp;
                        <time>
                            Mar 14 2024
                        </time>
                    
                </li>
            

            
        </ul>
    </div>
</footer>

    </body>

    























    
    


    
    


    <script
        type="text/javascript"
        src="/js/index_d751713.min.5eeb120f16ea146352725c420364f87befead45f678142b8f0ffbef024646931fbc06bff07a7bd6cb57fa2f8cd8a21ba6a4ee5a278ec32303a378bc1cd17f246.js"
        integrity="sha512-XusSDxbqFGNSclxCA2T4e&#43;/q1F9ngUK48P&#43;&#43;8CRkaTH7wGv/B6e9bLV/ovjNiiG6ak7lonjsMjA6N4vBzRfyRg=="></script>














<link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" />




</html>
