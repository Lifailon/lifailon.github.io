<!doctype html><html data-theme=dark lang=en xmlns=http://www.w3.org/1999/xhtml><head><meta charset=UTF-8><meta content="Web version for PowerShell notes in Russian language (Сheat Sheet & Documentation), Linux commands and RuDocs for Node.js" name=description><meta content="width=device-width,initial-scale=1" name=viewport><meta content=#ff7800 name=theme-color><meta content=#ffa348 media=(prefers-color-scheme:dark) name=theme-color><meta content="default-src 'none';font-src 'self';img-src 'self' https: data:;media-src 'self' https:;style-src 'self' 'unsafe-inline';frame-src https://player.vimeo.com https://www.youtube-nocookie.com https://toot.community;frame-ancestors 'none';base-uri 'none';form-action 'none';connect-src 'self' https://toot.community;script-src 'self' 'self'" http-equiv=content-security-policy><title>Database - PowerShell Commands</title><link href=https://lifailon.github.io/database/ rel=canonical><link href=https://lifailon.github.io/favicon.png rel=icon type=image/png><link href=https://lifailon.github.io/apple-touch-icon.png rel=apple-touch-icon sizes=180x180 type=image/png><link title="PowerShell Commands - RSS Feed" href=https://lifailon.github.io/rss.xml rel=alternate type=application/rss+xml><link title="PowerShell Commands - Atom Feed" href=https://lifailon.github.io/atom.xml rel=alternate type=application/atom+xml><style>:root{--accent-color:#ff7800}[data-theme=dark]{--accent-color:#ffa348}@media (prefers-color-scheme:dark){:root:not([data-theme=light]){--accent-color:#ffa348}}</style><link href=https://lifailon.github.io/style.css rel=stylesheet><link media="(prefers-color-scheme: light)" href=https://lifailon.github.io/syntax-theme-light.css rel=stylesheet><link media="(prefers-color-scheme: dark)" href=https://lifailon.github.io/syntax-theme-dark.css rel=stylesheet><script defer src=https://lifailon.github.io/closable.js></script><script defer src=https://lifailon.github.io/copy-button.js></script><script defer src=https://lifailon.github.io/fuse.js></script><script defer src=https://lifailon.github.io/search-fuse.js></script><script defer src=https://lifailon.github.io/theme-switcher.js></script><meta content="PowerShell Commands" property=og:site_name><meta content="Database - PowerShell Commands" property=og:title><meta content=https://lifailon.github.io/database/ property=og:url><meta content="Web version for PowerShell notes in Russian language (Сheat Sheet & Documentation), Linux commands and RuDocs for Node.js" property=og:description><meta content=https://lifailon.github.io/card.png property=og:image><meta content=en_US property=og:locale><body><div id=handle></div><header id=site-nav><nav><a href=#main-content tabindex=0> Skip to Main Content </a><ul><li id=home><a href=https://lifailon.github.io> <i class=icon></i>PowerShell Commands</a><li class=divider><li><a href=https://lifailon.github.io/powershell/>PowerShell</a><li><a href=https://lifailon.github.io/linux/>Linux</a><li><a href=https://lifailon.github.io/golang/>GoLang</a><li><a href=https://lifailon.github.io/node-js/>Node.js</a><li><a href=https://lifailon.github.io/docker/>Docker</a><li><a href=https://lifailon.github.io/network/>Network</a><li><a href=https://lifailon.github.io/windowsserver/>Windows Server</a><li><a class=active href=https://lifailon.github.io/database/>Database</a><li><a href=https://lifailon.github.io/api/>API</a><li><a href=https://lifailon.github.io/jenkins/>Jenkins</a><li><a href=https://lifailon.github.io/devops/>DevOps</a><li id=search><button class=circle id=search-toggle title=Search><i class=icon></i></button><li id=theme-switcher><details class=closable><summary class=circle title=Theme><i class=icon></i></summary> <ul><li><button title="Switch to Light Theme" class=circle id=theme-light><i class=icon></i></button><li><button title="Switch to Dark Theme" class=circle id=theme-dark><i class=icon></i></button><li><button title="Use System Theme" class=circle id=theme-system><i class=icon></i></button></ul></details><li id=repo><a class=circle href=https://github.com/Lifailon/PS-Commands title=Repository> <i class=icon></i> </a></ul></nav><div id=search-container><label class=visually-hidden for=search-bar>Search</label><input placeholder="Search for…" autocomplete=off disabled id=search-bar type=search><div id=search-results-container><div id=search-results></div></div></div></header><div id=sidebar><div><h2>Table of Contents</h2><ul><li><a href=https://lifailon.github.io/database/#sqlite>SQLite</a><ul><li><a href=https://lifailon.github.io/database/#database-password>Database password</a></ul><li><a href=https://lifailon.github.io/database/#keepass>KeePass</a><li><a href=https://lifailon.github.io/database/#mysql>MySQL</a><ul><li><a href=https://lifailon.github.io/database/#data-type>DATA TYPE</a><li><a href=https://lifailon.github.io/database/#database>DATABASE</a><li><a href=https://lifailon.github.io/database/#user>USER</a><li><a href=https://lifailon.github.io/database/#table>TABLE</a><li><a href=https://lifailon.github.io/database/#column>COLUMN</a><li><a href=https://lifailon.github.io/database/#insert>INSERT</a><li><a href=https://lifailon.github.io/database/#select>SELECT</a><li><a href=https://lifailon.github.io/database/#where>WHERE</a><li><a href=https://lifailon.github.io/database/#delete>DELETE</a><li><a href=https://lifailon.github.io/database/#update>UPDATE</a><li><a href=https://lifailon.github.io/database/#check>CHECK</a><li><a href=https://lifailon.github.io/database/#dump>DUMP</a><li><a href=https://lifailon.github.io/database/#innodb-force-recovery>innodb force recovery</a><li><a href=https://lifailon.github.io/database/#mysql-connector-net>MySQL Connector NET</a><li><a href=https://lifailon.github.io/database/#add-aduser>Add-ADUser</a><li><a href=https://lifailon.github.io/database/#get-aduser>Get-ADUser</a></ul><li><a href=https://lifailon.github.io/database/#mssql>MSSQL</a><ul><li><a href=https://lifailon.github.io/database/#system-data-sqlclient>System Data SqlClient</a><li><a href=https://lifailon.github.io/database/#sqlclient-insert>SqlClient INSERT</a><li><a href=https://lifailon.github.io/database/#ssms-insert>SSMS INSERT</a><li><a href=https://lifailon.github.io/database/#t-sql>T-SQL</a><li><a href=https://lifailon.github.io/database/#backup-type>Backup type</a><li><a href=https://lifailon.github.io/database/#recovery-models>Recovery Models</a><li><a href=https://lifailon.github.io/database/#system-databases>System databases</a><li><a href=https://lifailon.github.io/database/#regulatory-operations>Regulatory operations</a></ul><li><a href=https://lifailon.github.io/database/#influxdb>InfluxDB</a><ul><li><a href=https://lifailon.github.io/database/#install-windows>Install Windows</a><li><a href=https://lifailon.github.io/database/#install-ubuntu>Install Ubuntu</a><li><a href=https://lifailon.github.io/database/#api>API</a><li><a href=https://lifailon.github.io/database/#chronograf>Chronograf</a><li><a href=https://lifailon.github.io/database/#grafana>Grafana</a><li><a href=https://lifailon.github.io/database/#cli-client>CLI Client</a><li><a href=https://lifailon.github.io/database/#users>USERS</a><li><a href=https://lifailon.github.io/database/#database-1>DATABASE</a><li><a href=https://lifailon.github.io/database/#measurement>MEASUREMENT</a><li><a href=https://lifailon.github.io/database/#select-and-where>SELECT and WHERE</a><li><a href=https://lifailon.github.io/database/#regex>REGEX</a><li><a href=https://lifailon.github.io/database/#group-by-tag-key>GROUP BY tag key</a><li><a href=https://lifailon.github.io/database/#functions>Functions</a><li><a href=https://lifailon.github.io/database/#policy>POLICY</a></ul><li><a href=https://lifailon.github.io/database/#influxdb-api>InfluxDB-api</a><ul><li><a href=https://lifailon.github.io/database/#api-post>API POST</a><li><a href=https://lifailon.github.io/database/#api-get>API GET</a><li><a href=https://lifailon.github.io/database/#endpoints>Endpoints</a><li><a href=https://lifailon.github.io/database/#pingto-influxdb>PingTo-InfluxDB</a><li><a href=https://lifailon.github.io/database/#performanceto-influxdb>PerformanceTo-InfluxDB</a><li><a href=https://lifailon.github.io/database/#service>Service</a><li><a href=https://lifailon.github.io/database/#psinfluxdb>PSInfluxDB</a></ul><li><a href=https://lifailon.github.io/database/#telegraf>Telegraf</a><li><a href=https://lifailon.github.io/database/#elasticsearch>Elasticsearch</a><li><a href=https://lifailon.github.io/database/#cdata>CData</a><ul><li><a href=https://lifailon.github.io/database/#ado-net-assembly>ADO NET Assembly</a><li><a href=https://lifailon.github.io/database/#update-1>UPDATE</a><li><a href=https://lifailon.github.io/database/#insert-1>INSERT</a><li><a href=https://lifailon.github.io/database/#delete-1>DELETE</a></ul><li><a href=https://lifailon.github.io/database/#odbc>ODBC</a><li><a href=https://lifailon.github.io/database/#postgresql>PostgreSQL</a><ul><li><a href=https://lifailon.github.io/database/#odbc-driver>ODBC Driver</a><li><a href=https://lifailon.github.io/database/#npgsql>npgsql</a></ul></ul></div></div><main id=main-content><h1>Database</h1><p>Заметки по работе с различными базами данных через <code>PowerShell</code>.<hr><h1 id=sqlite><a aria-label="Anchor link for: sqlite" class=zola-anchor href=#sqlite><i class=icon></i></a> SQLite</h1><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Documents\Get-Service.db<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Module</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">Get-Module</span> MySQLite
</span><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">if</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Module</span> <span class="z-keyword z-operator z-comparison z-powershell">-eq</span> <span class="z-constant z-language z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>null</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-support z-function z-powershell">Install-Module</span> MySQLite <span class="z-keyword z-operator z-assignment z-powershell">-</span>Repository PSGallery <span class="z-keyword z-operator z-assignment z-powershell">-</span>Scope CurrentUser
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Import-Module</span> MySQLite
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">New-MySQLiteDB</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Path <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path</span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> создать БД<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Invoke-MySQLiteQuery</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Path <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Query <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>CREATE TABLE Service (Name TEXT NOT NULL, DisplayName TEXT NOT NULL, Status TEXT NOT NULL);<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> создать таблицу<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Service</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">Get-Service</span> <span class="z-keyword z-operator z-other z-powershell">|</span> select Name<span class="z-keyword z-operator z-other z-powershell">,</span>DisplayName<span class="z-keyword z-operator z-other z-powershell">,</span>Status
</span><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">foreach</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>S</span> <span class="z-keyword z-control z-powershell">in</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Service</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Name</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>S<span class="z-variable z-other z-member z-powershell">.Name</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>DName</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>S<span class="z-variable z-other z-member z-powershell">.DisplayName</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Status</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>S<span class="z-variable z-other z-member z-powershell">.Status</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-support z-function z-powershell">Invoke-MySQLiteQuery</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Path <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Query <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>INSERT INTO Service (Name, DisplayName, Status) VALUES ('<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Name</span>', '<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>DName</span>', '<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Status</span>');<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></code></pre><p><code>(Get-MySQLiteDB $path).Tables</code> список таблиц в базе <br> <code>Invoke-MySQLiteQuery -Path $path -Query "SELECT name FROM sqlite_master WHERE type='table';"</code> список таблиц в базе <br> <code>Invoke-MySQLiteQuery -Path $path -Query "DROP TABLE Service;"</code> удалить таблицу<pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>TableName</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Service<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Invoke-MySQLiteQuery</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Path <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Query <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>SELECT * FROM <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>TableName</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> прочитать содержимое таблицы (в формате объекта)<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></code></pre><p><code>Get-Service | select  Name,DisplayName,Status | ConvertTo-MySQLiteDB -Path $path -TableName Service -force</code> конвертировать объект в таблицу<h3 id=database-password><a aria-label="Anchor link for: database-password" class=zola-anchor href=#database-password><i class=icon></i></a> Database password</h3><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Connection</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-SQLiteConnection</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>DataSource <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Connection<span class="z-variable z-other z-member z-powershell">.ChangePassword</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>password<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Connection<span class="z-variable z-other z-member z-powershell">.Close</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Invoke-SqliteQuery</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Query <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>SELECT * FROM Service<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>DataSource <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path</span>;Password=password<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></code></pre><h1 id=keepass><a aria-label="Anchor link for: keepass" class=zola-anchor href=#keepass><i class=icon></i></a> KeePass</h1><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Определяем переменные до исполняемого файла, базы и пароль<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>KeePassExecPath</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>C:\Program Files\KeePass Password Safe 2\KeePass.exe<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>basePath</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Documents\KeePass\base.kdbx<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>basePass</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>12345<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Загружаем сборку<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">System.Reflection.Assembly</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::LoadFrom<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>KeePassExecPath</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-support z-function z-powershell">Out-Null</span>
</span><span class="z-source z-powershell"><span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">KeePass.Program</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::CommonInitialize<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Открываем базу<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>IOConnectionInfo</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">KeePassLib.Serialization.IOConnectionInfo</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::FromPath<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>basePath</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>CompositeKey</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> KeePassLib.Keys.CompositeKey
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>KcpPassword</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> KeePassLib.Keys.KcpPassword <span class="z-meta z-group z-array-expression z-powershell"><span class="z-keyword z-other z-array z-begin z-powershell">@</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>basePass</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>CompositeKey<span class="z-variable z-other z-member z-powershell">.AddUserKey</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>KcpPassword</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>PwDatabase</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> KeePassLib.PwDatabase
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>PwDatabase<span class="z-variable z-other z-member z-powershell">.Open</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>IOConnectionInfo</span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>CompositeKey</span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-constant z-language z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>null</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Поиск в базе по частичному совпадению (фильтрация)<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SearchParameters</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> KeePassLib.SearchParameters
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SearchParameters<span class="z-variable z-other z-member z-powershell">.SearchString</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-single z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">'</span>test<span class="z-punctuation z-definition z-string z-end z-powershell">'</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>PwObjectList</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> KeePassLib.Collections.PwObjectList<span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">KeePassLib.PwEntry</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>PwDatabase<span class="z-variable z-other z-member z-powershell">.RootGroup.SearchEntries</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SearchParameters</span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>PwObjectList</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>ucount</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>PwObjectList<span class="z-variable z-other z-member z-powershell">.UCount</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span> <span class="z-constant z-numeric z-integer z-powershell">1</span>
</span><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">if</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>ucount</span> <span class="z-keyword z-operator z-comparison z-powershell">-ne</span> <span class="z-constant z-numeric z-integer z-powershell">0</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-keyword z-control z-powershell">foreach</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>index</span> <span class="z-keyword z-control z-powershell">in</span> <span class="z-meta z-group z-complex z-subexpression z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-constant z-numeric z-integer z-powershell">0</span><span class="z-keyword z-operator z-range z-powershell">..</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>ucount</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>PwObjectList<span class="z-variable z-other z-member z-powershell">.GetAt</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>index</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.Strings.ReadSafe<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">KeePassLib.PwDefs</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::UserNameField</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Получаем список групп<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Groups</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>PwDatabase<span class="z-variable z-other z-member z-powershell">.RootGroup.Groups</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>groupCollections</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> System.Collections.Generic.List<span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">System.Object</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Проходим по группам<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">foreach</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Group</span> <span class="z-keyword z-control z-powershell">in</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Groups</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>entryCollections</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> System.Collections.Generic.List<span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">System.Object</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Проходим по записям группы и добавляем во временную коллекцию<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">	<span class="z-keyword z-control z-powershell">foreach</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>entry</span> <span class="z-keyword z-control z-powershell">in</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Group<span class="z-variable z-other z-member z-powershell">.Entries</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>entryCollections<span class="z-variable z-other z-member z-powershell">.Add</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">PSCustomObject</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span><span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-interpolated z-simple z-source z-powershell"><span class="z-meta z-hashtable z-powershell">            <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">Title</span>    <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>entry<span class="z-variable z-other z-member z-powershell">.Strings.Get</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Title<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.ReadString<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-interpolated z-simple z-source z-powershell"><span class="z-meta z-hashtable z-powershell">            <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">Login</span>    <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>entry<span class="z-variable z-other z-member z-powershell">.Strings.Get</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>UserName<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.ReadString<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-interpolated z-simple z-source z-powershell"><span class="z-meta z-hashtable z-powershell">            <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">Password</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>entry<span class="z-variable z-other z-member z-powershell">.Strings.Get</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Password<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.ReadString<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-interpolated z-simple z-source z-powershell"><span class="z-meta z-hashtable z-powershell">            <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">Url</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>entry<span class="z-variable z-other z-member z-powershell">.Strings.Get</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>URL<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.ReadString<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-interpolated z-simple z-source z-powershell"><span class="z-meta z-hashtable z-powershell">            <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">Description</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>entry<span class="z-variable z-other z-member z-powershell">.Strings.Get</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Notes<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.ReadString<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-interpolated z-simple z-source z-powershell"><span class="z-meta z-hashtable z-powershell">        <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Добавляем запись в основную коллекцию групп (название группы используется как ключ)<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>groupCollections</span> <span class="z-keyword z-operator z-assignment z-powershell">+=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">PSCustomObject</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span><span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-hashtable z-powershell">        <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> ($Group.Name) = $entryCollections<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-hashtable z-powershell">		<span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">Group</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Group<span class="z-variable z-other z-member z-powershell">.Name</span></span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-hashtable z-powershell">		<span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">Modification</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Group<span class="z-variable z-other z-member z-powershell">.LastAccessTime.ToString</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-hashtable z-powershell">        <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">Entries</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>entryCollections</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Преобразуем структуру в JSON<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>jsonData</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>groupCollections</span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-support z-function z-powershell">ConvertTo-Json</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Depth <span class="z-constant z-numeric z-integer z-powershell">3</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>jsonData</span>
</span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Закрываем базу<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>PwDatabase<span class="z-variable z-other z-member z-powershell">.Close</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></code></pre><h1 id=mysql><a aria-label="Anchor link for: mysql" class=zola-anchor href=#mysql><i class=icon></i></a> MySQL</h1><p><code>apt -y install mysql-server mysql-client</code> <br> <code>mysql -V</code> <br> <code>systemctl status mysql</code> <br> <code>mysqladmin -u root password</code> задать пароль root<p><code>nano /etc/mysql/mysql.conf.d/mysqld.cnf</code><pre class=z-code><code><span class="z-text z-plain">[mysqld]
</span><span class="z-text z-plain">user                    = mysql
</span><span class="z-text z-plain"># pid-file              = /var/run/mysqld/mysqld.pid
</span><span class="z-text z-plain"># socket                = /var/run/mysqld/mysqld.sock
</span><span class="z-text z-plain"># port                  = 3306
</span><span class="z-text z-plain"># datadir               = /var/lib/mysql
</span><span class="z-text z-plain"># tmpdir                = /tmp
</span><span class="z-text z-plain">bind-address            = 0.0.0.0
</span><span class="z-text z-plain">mysqlx-bind-address     = 0.0.0.0
</span><span class="z-text z-plain">log_error = /var/log/mysql/error.log
</span></code></pre><p><code>systemctl restart mysql</code> <br> <code>ss -tulnp | grep 3306</code> <br> <code>ufw allow 3306/tcp</code> <br> <code>nc -zv 192.168.1.253 3306</code> <br> <code>tnc 192.168.1.253 -p 3306</code><p><code>mysql -u root -p</code> <br> <code>SELECT user(), now(), version();</code> <br> <code>quit;</code><p><code>mysql -u root -p -e 'SHOW TABLES FROM db_aduser;'</code> отобразить список таблиц без подключения к консоли MySQL<p><code>CREATE</code> создать БД, пользователя, таблицу <br> <code>ALTER</code> управление столбцами таблице <br> <code>DROP</code> удалить БД, пользователя, таблицу <br> <code>USE</code> выбрать БД <br> <code>SHOW</code> вывесли список БД, прав доступа пользователя (GRANTS), названия столбцов и их свойства <br> <code>GRANT</code> дать доступ пользователю к БД <br> <code>REVOKE</code> удалить доступ пользователя к БД <br> <code>UPDATE</code> изменить права доступа, значения с таблице <br> <code>FLUSH</code> обновить права доступа <br> <code>SELECT</code> отобразить выбранную БД, вывести список пользователей, выборка данных в таблице <br> <code>INSERT</code> внести данные <br> <code>DELETE</code> удалить данные в (FROM) таблице<h3 id=data-type><a aria-label="Anchor link for: data-type" class=zola-anchor href=#data-type><i class=icon></i></a> DATA TYPE</h3><p><code>VARCHAR(N)</code> строка переменной длины, в формате ASCII, где один символ занимает 1 байт, числом N указывается максимальная возможная длина строки <br> <code>NVARCHAR(N)</code> строка переменной длины, в формате Unicode, где один символ занимает 2 байта <br> <code>CHAR(N)/nchar(N)</code> строка фиксированной длины, которая всегда дополняется справа пробелами до длины N и в базе данных она занимает ровно N символов <br> <code>INT</code> целое число, от -2147483648 до 2147483647, занимает 4 байта <br> <code>FLOAT</code> число, в котором может присутствовать десятичная точка (запятая) <br> <code>BIT</code> флаг, Да - 1 или Нет - 0 <br> <code>DATE</code> формат даты, например 25.05.2023 <br> <code>TIME</code> 23:30:55.1234567 <br> <code>DATETIME</code> 25.05.2023 23:30:55.1234567<h3 id=database><a aria-label="Anchor link for: database" class=zola-anchor href=#database><i class=icon></i></a> DATABASE</h3><pre class=z-code><code><span class="z-text z-plain">SHOW databases;                                                                     # вывести список БД
</span><span class="z-text z-plain">CREATE DATABASE db_aduser;                                                          # создать БД
</span><span class="z-text z-plain">CREATE DATABASE db_rep DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;  # создать БД с кодировкой UTF-8
</span><span class="z-text z-plain">DROP DATABASE db_rep;                                                               # удалить БД
</span><span class="z-text z-plain">USE db_aduser;                                                                      # выбрать/переключиться на выбранную БД
</span><span class="z-text z-plain">SELECT database();                                                                  # отобразить выбранную БД
</span></code></pre><h3 id=user><a aria-label="Anchor link for: user" class=zola-anchor href=#user><i class=icon></i></a> USER</h3><pre class=z-code><code><span class="z-text z-plain">SELECT USER,HOST FROM mysql.user;                                     # вывести список УЗ
</span><span class="z-text z-plain">CREATE USER posh@localhost IDENTIFIED BY '1qaz!QAZ';                  # создать УЗ, которая будет подключаться с локального сервера
</span><span class="z-text z-plain">CREATE USER posh@localhost IDENTIFIED BY '1qaz!QAZ';                  # создать УЗ, которая будет подключаться с указанного сервера
</span><span class="z-text z-plain">CREATE USER posh@'192.168.3.99' IDENTIFIED BY '1qaz!QAZ';             # УЗ для доступа с конкретного сервера
</span><span class="z-text z-plain">CREATE USER 'admin'@'%' IDENTIFIED BY 'Admin12#';                     # УЗ для доступа с любого сервера (% - wildcard)
</span><span class="z-text z-plain">DROP USER posh@localhost;                                             # удалить пользователя
</span><span class="z-text z-plain">SHOW GRANTS FOR posh@'%';                                             # отобразить права доступа пользователя
</span><span class="z-text z-plain">GRANT ALL PRIVILEGES ON db_aduser.* TO posh@'192.168.3.99';           # полный доступ для posh к БД db_aduser
</span><span class="z-text z-plain">GRANT ALL PRIVILEGES ON *.* TO posh@'%';                              # доступ к всем БД c любого клиентского хоста
</span><span class="z-text z-plain">GRANT SELECT,DELETE ON mysql.* TO posh@'%';                           # права SELECT и DELETE на встроенную БД mysql
</span><span class="z-text z-plain">REVOKE DELETE ON mysql.* FROM posh@'%';                               # удалить доступ DELETE
</span><span class="z-text z-plain">UPDATE mysql.user SET super_priv='Y' WHERE USER='posh' AND host='%';  # изменить привелегии для пользователя
</span><span class="z-text z-plain">SELECT USER,HOST,super_priv FROM mysql.user;                          # список УЗ и таблица с правами SUPER privilege
</span><span class="z-text z-plain">FLUSH PRIVILEGES;                                                     # обновить права доступа
</span></code></pre><h3 id=table><a aria-label="Anchor link for: table" class=zola-anchor href=#table><i class=icon></i></a> TABLE</h3><pre class=z-code><code><span class="z-text z-plain">SHOW TABLES;               # отобразить список всех таблиц
</span><span class="z-text z-plain">SHOW TABLES LIKE '%user';  # поиск таблицы по wildcard-имени
</span><span class="z-text z-plain">CREATE TABLE table_aduser (id INT NOT NULL AUTO_INCREMENT, Name VARCHAR(100), email VARCHAR(100), PRIMARY KEY (ID));  # создать таблицу
</span><span class="z-text z-plain">DROP TABLE table_aduser;   # удалить таблицу
</span></code></pre><h3 id=column><a aria-label="Anchor link for: column" class=zola-anchor href=#column><i class=icon></i></a> COLUMN</h3><pre class=z-code><code><span class="z-text z-plain">SHOW COLUMNS FROM table_aduser;                                                         # отобразить название стобцов и их свойства
</span><span class="z-text z-plain">ALTER TABLE table_aduser DROP COLUMN id;                                                # удалить столбец id
</span><span class="z-text z-plain">ALTER TABLE table_aduser ADD COLUMN info VARCHAR(10);                                   # добавить столбец info
</span><span class="z-text z-plain">ALTER TABLE table_aduser CHANGE info new_info VARCHAR(100);                             # изменить имя столбца info на new_info и его тип данных
</span><span class="z-text z-plain">ALTER TABLE table_aduser ADD COLUMN (id INT NOT NULL AUTO_INCREMENT, PRIMARY KEY (ID)); # добавить столбец id
</span></code></pre><h3 id=insert><a aria-label="Anchor link for: insert" class=zola-anchor href=#insert><i class=icon></i></a> INSERT</h3><pre class=z-code><code><span class="z-text z-plain">INSERT table_aduser (Name,email) VALUES ('Alex','no-email');
</span><span class="z-text z-plain">INSERT table_aduser (Name,email) VALUES ('Alex','no-email');
</span><span class="z-text z-plain">INSERT table_aduser (Name) VALUES ('Support');
</span><span class="z-text z-plain">INSERT table_aduser (Name) VALUES ('Jack');
</span></code></pre><h3 id=select><a aria-label="Anchor link for: select" class=zola-anchor href=#select><i class=icon></i></a> SELECT</h3><pre class=z-code><code><span class="z-text z-plain">SELECT * FROM table_aduser;                     # содержимое всех стобцов в выбранной (FROM) таблице
</span><span class="z-text z-plain">SELECT Name,email FROM table_aduser;            # содержимое указанных стобцов
</span><span class="z-text z-plain">SELECT DISTINCT Name,Email FROM table_aduser;   # отобразить уникальные записи (без повторений)
</span><span class="z-text z-plain">SELECT * FROM table_aduser ORDER BY Name;       # отсортировать по Name
</span><span class="z-text z-plain">SELECT * FROM table_aduser ORDER BY Name DESC;  # обратная сортировка
</span><span class="z-text z-plain">SELECT COUNT(*) FROM table_aduser;              # количество строк в таблице
</span><span class="z-text z-plain">SELECT COUNT(new_info) FROM table_aduser;       # количество строк в столбце
</span></code></pre><h3 id=where><a aria-label="Anchor link for: where" class=zola-anchor href=#where><i class=icon></i></a> WHERE</h3><pre class=z-code><code><span class="z-text z-plain">NOT; AND; OR                                                  # по приоритетам условий
</span><span class="z-text z-plain">SELECT * FROM table_aduser WHERE Name = 'Alex';               # поиск по содержимому
</span><span class="z-text z-plain">SELECT * FROM table_aduser WHERE NOT Name != 'Alex';          # условие NOT где Name не равен значению
</span><span class="z-text z-plain">SELECT * FROM table_aduser WHERE email != '';                 # вывести строки, где содержимое email не рано null
</span><span class="z-text z-plain">SELECT * FROM table_aduser WHERE email != '' OR id > 1000;    # или id выше 1000
</span><span class="z-text z-plain">SELECT * FROM table_aduser WHERE Name RLIKE "support";        # регистронезависемый (RLIKE) поиск
</span><span class="z-text z-plain">SELECT * FROM table_aduser WHERE Name RLIKE "^support";       # начинаются только с этого словосочетания
</span></code></pre><h3 id=delete><a aria-label="Anchor link for: delete" class=zola-anchor href=#delete><i class=icon></i></a> DELETE</h3><pre class=z-code><code><span class="z-text z-plain">SELECT * FROM table_aduser WHERE Name RLIKE "alex";   # найти и проверить значения перед удалением
</span><span class="z-text z-plain">DELETE FROM table_aduser WHERE Name RLIKE "alex";     # Query OK, 2 rows affected # удалено две строки
</span><span class="z-text z-plain">DELETE FROM table_aduser;                             # удалить ВСЕ значения
</span></code></pre><h3 id=update><a aria-label="Anchor link for: update" class=zola-anchor href=#update><i class=icon></i></a> UPDATE</h3><pre class=z-code><code><span class="z-text z-plain">SELECT * FROM table_aduser WHERE Name = 'Jack';             # найти и проверить значение перед изменением
</span><span class="z-text z-plain">UPDATE table_aduser SET Name = 'Alex' WHERE Name = 'Jack';  # изменить значение 'Jack' на 'Alex'
</span><span class="z-text z-plain">UPDATE db_aduser.table_aduser SET Name='BCA' WHERE id=1;    # изменить значение в строке с ID 1
</span></code></pre><h3 id=check><a aria-label="Anchor link for: check" class=zola-anchor href=#check><i class=icon></i></a> CHECK</h3><pre class=z-code><code><span class="z-text z-plain">CHECK TABLE db_aduser.table_aduser;     # проверить
</span><span class="z-text z-plain">ANALYZE TABLE db_aduser.table_aduser;   # анализировать
</span><span class="z-text z-plain">OPTIMIZE TABLE db_aduser.table_aduser;  # оптимизировать
</span><span class="z-text z-plain">REPAIR TABLE db_aduser.table_aduser;    # восстановить
</span><span class="z-text z-plain">TRUNCATE TABLE db_aduser.table_aduser;  # очистить
</span></code></pre><h3 id=dump><a aria-label="Anchor link for: dump" class=zola-anchor href=#dump><i class=icon></i></a> DUMP</h3><pre class=z-code><code><span class="z-text z-plain">mysqldump -u root -p --databases db_aduser > /bak/db_aduser.sql
</span><span class="z-text z-plain">mysql -u root -p db_aduser < /bak/db_aduser.sql
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">crontab -e
</span><span class="z-text z-plain">00 22 * * * /usr/bin/mysqldump -uroot -p1qaz!QAZ db_zabbix | /bin/bzip2 > `date +/dump/zabbix/zabbix-\%d-\%m-\%Y-\%H:\%M.bz2`
</span><span class="z-text z-plain">00 23 * * * /usr/bin/mysqldump -uroot -p1qaz!QAZ db_zabbix > `date +/dump/smb/zabbix-\%d-\%m-\%Y-\%H:\%M.sql`
</span><span class="z-text z-plain">0 0 * * * find /dump/zabbix -mtime +7 -exec rm {} \;
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">mysqldump -u root --single-transaction db_zabbix > /dump/zabbix/db_zabbix.sql
</span><span class="z-text z-plain">mysql -u user_zabbix -p -e 'CREATE DATABASE db_zabbix;'
</span><span class="z-text z-plain">mysql -u user_zabbix -p db_zabbix < /root/db_zabbix.sql
</span></code></pre><h3 id=innodb-force-recovery><a aria-label="Anchor link for: innodb-force-recovery" class=zola-anchor href=#innodb-force-recovery><i class=icon></i></a> innodb force recovery</h3><pre class=z-code><code><span class="z-text z-plain">sed -i '/innodb_force_recovery/d' /etc/mysql/my.cnf # удалить
</span><span class="z-text z-plain">mode=6; sed -i "/^\[mysqld\]/{N;s/$/\ninnodb_force_recovery=$mode/}" /etc/mysql/my.cnf # добавить mode 6
</span><span class="z-text z-plain">systemctl restart mysql
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[mysqld]
</span><span class="z-text z-plain">innodb_force_recovery=1 # сервер пытается начать работу независимо от того, есть ли поврежденные данные InnoDB или нет
</span><span class="z-text z-plain">innodb_force_recovery=2 # удается восстановить работу за счет остановки потока команд, которые были частично выполнены или не выполнены (не запускает фоновые операции)
</span><span class="z-text z-plain">innodb_force_recovery=3 # отменяет откат после восстановления поврежденных файлов (не пытается откатить транзакции)
</span><span class="z-text z-plain">innodb_force_recovery=6 # запуск СУБД в режиме read only
</span></code></pre><h3 id=mysql-connector-net><a aria-label="Anchor link for: mysql-connector-net" class=zola-anchor href=#mysql-connector-net><i class=icon></i></a> MySQL Connector NET</h3><h3 id=add-aduser><a aria-label="Anchor link for: add-aduser" class=zola-anchor href=#add-aduser><i class=icon></i></a> Add-ADUser</h3><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>ip</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>192.168.1.253<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>user</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>posh<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>pass</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>1qaz!QAZ<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>db</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>db_aduser<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Add-Type</span> –Path <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Documents\MySQL-Connector-NET\8.0.31-4.8\MySql.Data.dll<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Connection</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">MySql.Data.MySqlClient.MySqlConnection</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span><span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">ConnectionString</span><span class="z-keyword z-operator z-assignment z-powershell">=</span></span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>server=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>ip</span>;uid=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>user</span>;pwd=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>pass</span>;database=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>db</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Connection<span class="z-variable z-other z-member z-powershell">.Open</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Command</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> MySql.Data.MySqlClient.MySqlCommand
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Command<span class="z-variable z-other z-member z-powershell">.Connection</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Connection</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>UserList</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">Get-ADUser</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>filter <span class="z-keyword z-operator z-assignment z-powershell">*</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>properties name<span class="z-keyword z-operator z-other z-powershell">,</span>EmailAddress
</span><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">foreach</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>user</span> <span class="z-keyword z-control z-powershell">in</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>UserList</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>uname</span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>user<span class="z-variable z-other z-member z-powershell">.Name</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>uemail</span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>user<span class="z-variable z-other z-member z-powershell">.EmailAddress</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Command<span class="z-variable z-other z-member z-powershell">.CommandText</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>INSERT INTO table_aduser (Name,Email) VALUES ('<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>uname</span>','<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>uemail</span>')<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Command<span class="z-variable z-other z-member z-powershell">.ExecuteNonQuery</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Connection<span class="z-variable z-other z-member z-powershell">.Close</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></code></pre><h3 id=get-aduser><a aria-label="Anchor link for: get-aduser" class=zola-anchor href=#get-aduser><i class=icon></i></a> Get-ADUser</h3><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>ip</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>192.168.1.253<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>user</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>posh<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>pass</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>1qaz!QAZ<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>db</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>db_aduser<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Add-Type</span> –Path <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Documents\MySQL-Connector-NET\8.0.31-4.8\MySql.Data.dll<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Connection</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">MySql.Data.MySqlClient.MySqlConnection</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span><span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">ConnectionString</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>server=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>ip</span>;uid=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>user</span>;pwd=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>pass</span>;database=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>db</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Connection<span class="z-variable z-other z-member z-powershell">.Open</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Command</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> MySql.Data.MySqlClient.MySqlCommand
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Command<span class="z-variable z-other z-member z-powershell">.Connection</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Connection</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>MYSQLDataAdapter</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> MySql.Data.MySqlClient.MySqlDataAdapter
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>MYSQLDataSet</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> System.Data.DataSet
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Command<span class="z-variable z-other z-member z-powershell">.CommandText</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>SELECT * FROM table_aduser<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>MYSQLDataAdapter<span class="z-variable z-other z-member z-powershell">.SelectCommand</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Command</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>NumberOfDataSets</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>MYSQLDataAdapter<span class="z-variable z-other z-member z-powershell">.Fill</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>MYSQLDataSet</span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>data<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Collections</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> System.Collections.Generic.List<span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">System.Object</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>
</span><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">foreach</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>DataSet</span> <span class="z-keyword z-control z-powershell">in</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>MYSQLDataSet<span class="z-variable z-other z-member z-powershell">.tables</span></span><span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-constant z-numeric z-integer z-powershell">0</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Collections<span class="z-variable z-other z-member z-powershell">.Add</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">PSCustomObject</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span><span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-interpolated z-simple z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">Name</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>DataSet<span class="z-variable z-other z-member z-powershell">.name</span></span><span class="z-punctuation z-terminator z-statement z-powershell">;</span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-interpolated z-simple z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">Mail</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>DataSet<span class="z-variable z-other z-member z-powershell">.email</span></span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-interpolated z-simple z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Connection<span class="z-variable z-other z-member z-powershell">.Close</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Collections</span>
</span></code></pre><h1 id=mssql><a aria-label="Anchor link for: mssql" class=zola-anchor href=#mssql><i class=icon></i></a> MSSQL</h1><p><code>wget -qO- https://packages.microsoft.com/keys/microsoft.asc | apt-key add -</code> импортировать GPG-ключ для репозитория <br> <code>https://packages.microsoft.com/config/ubuntu/</code> выбрать репозиторий и скопировать URL <br> <code>add-apt-repository "$(wget -qO- https://packages.microsoft.com/config/ubuntu/20.04/mssql-server-2019.list)"</code> <br> <code>apt-get update</code> обновить список пакетов <br> <code>apt-get install mssql-server</code> <br> <code>/opt/mssql/bin/mssql-conf setup</code> скрипт начальной конфигурации (выбрать редакцию, 3 - express и русский язык 9 из 11) <br> <code>systemctl status mssql-server</code> <br> <code>curl https://packages.microsoft.com/keys/microsoft.asc | apt-key add -</code> установить клиент <br> <code>curl https://packages.microsoft.com/config/ubuntu/20.04/prod.list | tee /etc/apt/sources.list.d/msprod.list</code> <br> <code>apt-get update</code> <br> <code>apt-get install mssql-tools</code> <br> <code>echo 'export PATH="$PATH:/opt/mssql-tools/bin"' >> ~/.bashrc</code> добавить в домашний каталог файла bashrc, что бы не писать путь к исполняемому файлу <br> <code>export PATH="$PATH:/opt/mssql-tools/bin"</code> <br> <code>iptables -I INPUT 1 -p tcp --dport 1433 -j ACCEPT</code><pre class=z-code><code><span class="z-text z-plain">sqlcmd -S localhost -U SA
</span><span class="z-text z-plain">CREATE DATABASE itinvent
</span><span class="z-text z-plain">go
</span><span class="z-text z-plain">SELECT name FROM master.dbo.sysdatabases
</span><span class="z-text z-plain">go
</span></code></pre><h3 id=system-data-sqlclient><a aria-label="Anchor link for: system-data-sqlclient" class=zola-anchor href=#system-data-sqlclient><i class=icon></i></a> System Data SqlClient</h3><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>user</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>itinvent<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>pass</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>itinvent<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>db</span>   <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>itinvent<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>srv</span>  <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>192.168.3.103<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlConnection</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> System.Data.SqlClient.SqlConnection
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlConnection<span class="z-variable z-other z-member z-powershell">.ConnectionString</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>server=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>srv</span>;database=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>db</span>;user id=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>user</span>;password=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>pass</span>;Integrated Security=false<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlCommand</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> System.Data.SqlClient.SqlCommand<span class="z-keyword z-operator z-other z-powershell">`</span> класс формата команды
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlCommand<span class="z-variable z-other z-member z-powershell">.CommandText</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>SELECT * FROM ITINVENT.dbo.USERS<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-other z-powershell">`</span> отобразить содержимое таблицы
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span>$SqlCommand.CommandText = "SELECT LICENCE_DATE,DESCR,MODEL_NO,TYPE_NO FROM ITINVENT.dbo.ITEMS where LICENCE_DATE IS NOT NULL"<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlCommand<span class="z-variable z-other z-member z-powershell">.Connection</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlConnection</span><span class="z-keyword z-operator z-other z-powershell">`</span> передать формат подключения
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlAdapter</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> System.Data.SqlClient.SqlDataAdapter<span class="z-keyword z-operator z-other z-powershell">`</span> создать адаптер подключения для выполнения SELECT запросов к БД
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlAdapter<span class="z-variable z-other z-member z-powershell">.SelectCommand</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlCommand</span><span class="z-keyword z-operator z-other z-powershell">`</span> передать команду
</span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>DataSet</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> System.Data.DataSet<span class="z-keyword z-operator z-other z-powershell">`</span> создать объект приема данных формата XML
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlAdapter<span class="z-variable z-other z-member z-powershell">.Fill</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>DataSet</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span><span class="z-keyword z-operator z-other z-powershell">`</span> заполнить данными полученные от адаптера <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell">возвращает кол<span class="z-keyword z-operator z-assignment z-powershell">-</span>во объектов</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlConnection<span class="z-variable z-other z-member z-powershell">.Close</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Data</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>DataSet<span class="z-variable z-other z-member z-powershell">.Tables</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Data</span><span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-constant z-numeric z-integer z-powershell">0</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span> <span class="z-keyword z-operator z-other z-powershell">|</span> ft
</span></code></pre><h3 id=sqlclient-insert><a aria-label="Anchor link for: sqlclient-insert" class=zola-anchor href=#sqlclient-insert><i class=icon></i></a> SqlClient INSERT</h3><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>user</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>itinvent<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>pass</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>itinvent<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>db</span>   <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>db_test<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>srv</span>  <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>192.168.3.103<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>sql</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>INSERT INTO table_test (column_user) VALUES ('lifailon')<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-other z-powershell">`</span> добавить данные в таблицу table_test в колонку column_user
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlConnection</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> System.Data.SqlClient.SqlConnection
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlConnection<span class="z-variable z-other z-member z-powershell">.ConnectionString</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>server=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>srv</span>;database=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>db</span>;user id=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>user</span>;password=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>pass</span>;Integrated Security=false<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlCommand</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> System.Data.SqlClient.SqlCommand
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlCommand<span class="z-variable z-other z-member z-powershell">.CommandText</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>sql</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlCommand<span class="z-variable z-other z-member z-powershell">.Connection</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlConnection</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlConnection<span class="z-variable z-other z-member z-powershell">.Open</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>rowsAffected</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlCommand<span class="z-variable z-other z-member z-powershell">.ExecuteNonQuery</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span><span class="z-punctuation z-terminator z-statement z-powershell">;</span><span class="z-keyword z-operator z-other z-powershell">`</span> для запросов INSERT<span class="z-keyword z-operator z-assignment z-powershell">/</span>UPDATE<span class="z-keyword z-operator z-assignment z-powershell">/</span>DELETE не используется SqlDataAdapter
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlConnection<span class="z-variable z-other z-member z-powershell">.Close</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></code></pre><h3 id=ssms-insert><a aria-label="Anchor link for: ssms-insert" class=zola-anchor href=#ssms-insert><i class=icon></i></a> SSMS INSERT</h3><pre class=z-code><code><span class="z-text z-plain">USE [db_test]
</span><span class="z-text z-plain">GO
</span><span class="z-text z-plain">INSERT INTO [dbo].[table_test]
</span><span class="z-text z-plain">           ([column_user])
</span><span class="z-text z-plain">     VALUES
</span><span class="z-text z-plain">           ('lifailon')
</span><span class="z-text z-plain">GO
</span><span class="z-text z-plain">SELECT TOP (1000) [column_user]
</span><span class="z-text z-plain">FROM [db_test].[dbo].[table_test]
</span></code></pre><h3 id=t-sql><a aria-label="Anchor link for: t-sql" class=zola-anchor href=#t-sql><i class=icon></i></a> T-SQL</h3><ul><li><p>DDL (Data Definition Language / Язык определения данных). К этому типу относятся команды, которые создают базу данных, таблицы, индексы, хранимые процедуры. <br> <code>CREATE</code> создает объекты базы данных (саму базу даных, таблицы, индексы и т.д.) <br> <code>ALTER</code> изменяет объекты базы данных <br> <code>DROP</code> удаляет объекты базы данных <br> <code>TRUNCATE</code> удаляет все данные из таблиц</p><li><p>DML (Data Manipulation Language / Язык манипуляции данными). К этому типу относят команды по выбору, обновлению, добавлению и удалению данных. <br> <code>SELECT</code> извлекает данные из БД <br> <code>UPDATE</code> обновляет данные <br> <code>INSERT</code> добавляет новые данные <br> <code>DELETE</code> удаляет данные</p><li><p>DCL (Data Control Language / Язык управления доступа к данным). К этому типу относят команды, которые управляют правами по доступу к данным. <br> <code>GRANT</code> предоставляет права для доступа к данным <br> <code>REVOKE</code> отзывает права на доступ к данным</p></ul><pre class=z-code><code><span class="z-text z-plain">-- Переменные
</span><span class="z-text z-plain">DECLARE @text NVARCHAR(20), @int INT;
</span><span class="z-text z-plain">SET @text='Test';
</span><span class="z-text z-plain">SET @int = 21;
</span><span class="z-text z-plain">select @text,@int
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">-- Имена сервера и экземпляра 
</span><span class="z-text z-plain">Select @@SERVERNAME as [Server\Instance]; 
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">-- версия SQL Server 
</span><span class="z-text z-plain">Select @@VERSION as SQLServerVersion; 
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">-- Текущая БД (БД, в контексте которой выполняется запрос)
</span><span class="z-text z-plain">Select DB_NAME() AS CurrentDB_Name;
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">-- Время работы с момента запуска сервера
</span><span class="z-text z-plain">SELECT  @@Servername AS ServerName ,
</span><span class="z-text z-plain">        create_date AS  ServerStarted ,
</span><span class="z-text z-plain">        DATEDIFF(s, create_date, GETDATE()) / 86400.0 AS DaysRunning ,
</span><span class="z-text z-plain">        DATEDIFF(s, create_date, GETDATE()) AS SecondsRunnig
</span><span class="z-text z-plain">FROM    sys.databases
</span><span class="z-text z-plain">WHERE   name = 'tempdb';
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">-- Количество активных соединений
</span><span class="z-text z-plain">SELECT  @@Servername AS Server ,
</span><span class="z-text z-plain">        DB_NAME(database_id) AS DatabaseName ,
</span><span class="z-text z-plain">        COUNT(database_id) AS Connections ,
</span><span class="z-text z-plain">        Login_name AS  LoginName ,
</span><span class="z-text z-plain">        MIN(Login_Time) AS Login_Time ,
</span><span class="z-text z-plain">        MIN(COALESCE(last_request_end_time, last_request_start_time))
</span><span class="z-text z-plain">                                                         AS  Last_Batch
</span><span class="z-text z-plain">FROM    sys.dm_exec_sessions
</span><span class="z-text z-plain">WHERE   database_id > 0
</span><span class="z-text z-plain">        AND DB_NAME(database_id) NOT IN ( 'master', 'msdb' )
</span><span class="z-text z-plain">GROUP BY database_id ,
</span><span class="z-text z-plain">         login_name
</span><span class="z-text z-plain">ORDER BY DatabaseName;
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">-- Статус Backup
</span><span class="z-text z-plain">SELECT  @@Servername AS ServerName ,
</span><span class="z-text z-plain">        d.Name AS DBName ,
</span><span class="z-text z-plain">        MAX(b.backup_finish_date) AS LastBackupCompleted
</span><span class="z-text z-plain">FROM    sys.databases d
</span><span class="z-text z-plain">        LEFT OUTER JOIN msdb..backupset b
</span><span class="z-text z-plain">                    ON b.database_name = d.name
</span><span class="z-text z-plain">                       AND b.[type] = 'D'
</span><span class="z-text z-plain">GROUP BY d.Name
</span><span class="z-text z-plain">ORDER BY d.Name;
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">-- Путь к Backup
</span><span class="z-text z-plain">SELECT  @@Servername AS ServerName ,
</span><span class="z-text z-plain">        d.Name AS DBName ,
</span><span class="z-text z-plain">        b.Backup_finish_date ,
</span><span class="z-text z-plain">        bmf.Physical_Device_name
</span><span class="z-text z-plain">FROM    sys.databases d
</span><span class="z-text z-plain">        INNER JOIN msdb..backupset b ON b.database_name = d.name
</span><span class="z-text z-plain">                                        AND b.[type] = 'D'
</span><span class="z-text z-plain">        INNER JOIN msdb.dbo.backupmediafamily bmf ON b.media_set_id = bmf.media_set_id
</span><span class="z-text z-plain">ORDER BY d.NAME ,
</span><span class="z-text z-plain">        b.Backup_finish_date DESC; 
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">-- Вывести список всех БД, модели восстановления и путь к mdf/ldf
</span><span class="z-text z-plain">EXEC sp_helpdb; 
</span><span class="z-text z-plain">SELECT  @@SERVERNAME AS Server ,
</span><span class="z-text z-plain">        d.name AS DBName ,
</span><span class="z-text z-plain">        create_date ,
</span><span class="z-text z-plain">        recovery_model_Desc AS RecoveryModel ,
</span><span class="z-text z-plain">        m.physical_name AS FileName
</span><span class="z-text z-plain">FROM    sys.databases d
</span><span class="z-text z-plain">        JOIN sys.master_files m ON d.database_id = m.database_id
</span><span class="z-text z-plain">ORDER BY d.name;
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">-- Размер БД
</span><span class="z-text z-plain">with fs
</span><span class="z-text z-plain">as
</span><span class="z-text z-plain">(
</span><span class="z-text z-plain">    select database_id, type, size * 8.0 / 1024 size
</span><span class="z-text z-plain">    from sys.master_files
</span><span class="z-text z-plain">)
</span><span class="z-text z-plain">select 
</span><span class="z-text z-plain">    name,
</span><span class="z-text z-plain">    (select sum(size) from fs where type = 0 and fs.database_id = db.database_id) DataFileSizeMB,
</span><span class="z-text z-plain">    (select sum(size) from fs where type = 1 and fs.database_id = db.database_id) LogFileSizeMB
</span><span class="z-text z-plain">from sys.databases 
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">-- Поиск таблицы по маске имени (вывод: названия схемы где распологается объект, тип объекта, дата создания и последней модификации):
</span><span class="z-text z-plain">select [object_id], [schema_id],
</span><span class="z-text z-plain">	   schema_name([schema_id]) as [schema_name], 
</span><span class="z-text z-plain">	   [name], 
</span><span class="z-text z-plain">	   [type], 
</span><span class="z-text z-plain">	   [type_desc], 
</span><span class="z-text z-plain">	   [create_date], 
</span><span class="z-text z-plain">	   [modify_date]
</span><span class="z-text z-plain">from sys.all_objects
</span><span class="z-text z-plain">-- where [name]='INVENT';
</span><span class="z-text z-plain">where [name] like '%INVENT%';
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">-- Кол-во строк в таблицах
</span><span class="z-text z-plain">SELECT  @@ServerName AS Server ,
</span><span class="z-text z-plain">        DB_NAME() AS DBName ,
</span><span class="z-text z-plain">        OBJECT_SCHEMA_NAME(p.object_id) AS SchemaName ,
</span><span class="z-text z-plain">        OBJECT_NAME(p.object_id) AS TableName ,
</span><span class="z-text z-plain">        i.Type_Desc ,
</span><span class="z-text z-plain">        i.Name AS IndexUsedForCounts ,
</span><span class="z-text z-plain">        SUM(p.Rows) AS Rows
</span><span class="z-text z-plain">FROM    sys.partitions p
</span><span class="z-text z-plain">        JOIN sys.indexes i ON i.object_id = p.object_id
</span><span class="z-text z-plain">                              AND i.index_id = p.index_id
</span><span class="z-text z-plain">WHERE   i.type_desc IN ( 'CLUSTERED', 'HEAP' )
</span><span class="z-text z-plain">                             -- This is key (1 index per table) 
</span><span class="z-text z-plain">        AND OBJECT_SCHEMA_NAME(p.object_id) <> 'sys'
</span><span class="z-text z-plain">GROUP BY p.object_id ,
</span><span class="z-text z-plain">        i.type_desc ,
</span><span class="z-text z-plain">        i.Name
</span><span class="z-text z-plain">ORDER BY SchemaName ,
</span><span class="z-text z-plain">        TableName; 
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">-- Найти строковое (nvarchar) значение 2023 по всем таблицам базы данных
</span><span class="z-text z-plain">-- Отображается в какой таблице и столбце хранится значение, а также количество найденных пары таблица-колонка
</span><span class="z-text z-plain">set nocount on
</span><span class="z-text z-plain">declare @name varchar(128), @substr nvarchar(4000), @column varchar(128)
</span><span class="z-text z-plain">set @substr = '%2023%'
</span><span class="z-text z-plain">declare @sql nvarchar(max);
</span><span class="z-text z-plain">create table`rslt 
</span><span class="z-text z-plain">(table_name varchar(128), field_name varchar(128), [value] nvarchar(max))
</span><span class="z-text z-plain">declare s cursor for select table_name as table_name from information_schema.tables where table_type = 'BASE TABLE' order by table_name
</span><span class="z-text z-plain">open s
</span><span class="z-text z-plain">fetch next from s into @name
</span><span class="z-text z-plain">while @@fetch_status = 0
</span><span class="z-text z-plain">begin
</span><span class="z-text z-plain">declare c cursor for 
</span><span class="z-text z-plain">select quotename(column_name) as column_name from information_schema.columns 
</span><span class="z-text z-plain">where data_type in ('text', 'ntext', 'varchar', 'char', 'nvarchar', 'char', 'sysname', 'int', 'tinyint') and table_name  = @name
</span><span class="z-text z-plain">set @name = quotename(@name)
</span><span class="z-text z-plain">open c
</span><span class="z-text z-plain">fetch next from c into @column
</span><span class="z-text z-plain">while @@fetch_status = 0
</span><span class="z-text z-plain">begin
</span><span class="z-text z-plain">--print 'Processing table - ' + @name + ', column - ' + @column
</span><span class="z-text z-plain">set @sql='insert into`rslt select ''' + @name + ''' as Table_name, ''' + @column + ''', cast(' + @column + 
</span><span class="z-text z-plain">' as nvarchar(max)) from' + @name + ' where cast(' + @column + ' as nvarchar(max)) like ''' + @substr + '''';
</span><span class="z-text z-plain">print @sql;
</span><span class="z-text z-plain">exec(@sql);
</span><span class="z-text z-plain">fetch next from c into @column;
</span><span class="z-text z-plain">end
</span><span class="z-text z-plain">close c
</span><span class="z-text z-plain">deallocate c
</span><span class="z-text z-plain">fetch next from s into @name
</span><span class="z-text z-plain">end
</span><span class="z-text z-plain">select table_name as [Table Name], field_name as [Field Name], count(*) as [Found Mathes] from`rslt
</span><span class="z-text z-plain">group by table_name, field_name
</span><span class="z-text z-plain">order by table_name, field_name
</span><span class="z-text z-plain">drop table`rslt
</span><span class="z-text z-plain">close s
</span><span class="z-text z-plain">deallocate s
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">-- Поиск в таблице [CI_HISTORY] и столбцу [HIST_ID]:
</span><span class="z-text z-plain">SELECT * FROM ITINVENT.dbo.CI_HISTORY where [HIST_ID] like '%2023%';
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">-- Узнать фрагментацию индексов
</span><span class="z-text z-plain">DECLARE @db_id SMALLINT;
</span><span class="z-text z-plain">SET @db_id = DB_ID(N'itinvent');
</span><span class="z-text z-plain">IF @db_id IS NULL
</span><span class="z-text z-plain">BEGIN;
</span><span class="z-text z-plain">    PRINT N'Неправильное имя базы';
</span><span class="z-text z-plain">END;
</span><span class="z-text z-plain">ELSE
</span><span class="z-text z-plain">BEGIN;
</span><span class="z-text z-plain">	SELECT
</span><span class="z-text z-plain">		object_id AS [ID объекта],
</span><span class="z-text z-plain">		index_id AS [ID индекса],
</span><span class="z-text z-plain">		index_type_desc AS [Тип индекса],
</span><span class="z-text z-plain">		avg_fragmentation_in_percent AS [Фрагментация в %]
</span><span class="z-text z-plain">		
</span><span class="z-text z-plain">	FROM sys.dm_db_index_physical_stats(@db_id, NULL, NULL, NULL , 'LIMITED')
</span><span class="z-text z-plain">	 
</span><span class="z-text z-plain">	ORDER BY [avg_fragmentation_in_percent] DESC;
</span><span class="z-text z-plain">END;
</span><span class="z-text z-plain">GO
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">-- TempDB
</span><span class="z-text z-plain">-- Initial size - начальный/минимальный размер БД (1024 MB)
</span><span class="z-text z-plain">-- Autogrowh - прирост (512MB)
</span><span class="z-text z-plain">-- По умолчанию tempdb настроена на авто-расширение (Autogrow) и при каждой перезагрузке SQL Server пересоздаёт файлы этой БД с минимальным размером инициализации.
</span><span class="z-text z-plain">-- Увеличив размер инициализации файлов tempdb, можно свести к минимуму затраты системных ресурсов на операции авто-расширения.
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">-- Изменить путь к БД:
</span><span class="z-text z-plain">USE master;
</span><span class="z-text z-plain">GO
</span><span class="z-text z-plain">ALTER DATABASE tempdb
</span><span class="z-text z-plain">MODIFY FILE (NAME = tempdev, FILENAME = 'F:\tempdb.mdf');
</span><span class="z-text z-plain">GO
</span><span class="z-text z-plain">ALTER DATABASE tempdb
</span><span class="z-text z-plain">MODIFY FILE (NAME = temp2, FILENAME = 'F:\tempdb_mssql_2.ndf');
</span><span class="z-text z-plain">GO
</span><span class="z-text z-plain">ALTER DATABASE tempdb
</span><span class="z-text z-plain">MODIFY FILE (NAME = temp3, FILENAME = 'F:\tempdb_mssql_3.ndf');
</span><span class="z-text z-plain">GO
</span><span class="z-text z-plain">ALTER DATABASE tempdb
</span><span class="z-text z-plain">MODIFY FILE (NAME = temp4, FILENAME = 'F:\tempdb_mssql_4.ndf');
</span><span class="z-text z-plain">GO
</span><span class="z-text z-plain">ALTER DATABASE tempdb
</span><span class="z-text z-plain">MODIFY FILE (NAME = temp5, FILENAME = 'F:\tempdb_mssql_5.ndf');
</span><span class="z-text z-plain">GO
</span><span class="z-text z-plain">ALTER DATABASE tempdb
</span><span class="z-text z-plain">MODIFY FILE (NAME = temp6, FILENAME = 'F:\tempdb_mssql_6.ndf');
</span><span class="z-text z-plain">GO
</span><span class="z-text z-plain">ALTER DATABASE tempdb
</span><span class="z-text z-plain">MODIFY FILE (NAME = temp7, FILENAME = 'F:\tempdb_mssql_7.ndf');
</span><span class="z-text z-plain">GO
</span><span class="z-text z-plain">ALTER DATABASE tempdb
</span><span class="z-text z-plain">MODIFY FILE (NAME = temp8, FILENAME = 'F:\tempdb_mssql_8.ndf');
</span><span class="z-text z-plain">GO
</span><span class="z-text z-plain">ALTER DATABASE tempdb
</span><span class="z-text z-plain">MODIFY FILE (NAME = templog, FILENAME = 'F:\templog.ldf');
</span><span class="z-text z-plain">GO
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">-- Указать размер файла:
</span><span class="z-text z-plain">MODIFY FILE (NAME = temp2, FILENAME = 'F:\tempdb_mssql_2.ndf' , SIZE = 1048576KB , FILEGROWTH = 524288KB);
</span></code></pre><h3 id=backup-type><a aria-label="Anchor link for: backup-type" class=zola-anchor href=#backup-type><i class=icon></i></a> Backup type</h3><ul><li>Full (Полная копия). Когда стартует полное резервирование, записывается Log Sequence Number (LSN - последовательный номер журнала), а так же LSN записывается и при завершении полного резервирования. Этот LSN является механизмом, используемым SQL Server, чтобы знать, в каком порядке выполнялись операторы INSERT, UPDATE или DELETE. При этом наличие записанных LSN начала и окончания, как части полного бэкапа, обеспечивает согласованное с точки зрения транзакций резервное копирование, поскольку при полном резервном копировании учитываются изменения, произошедшие во время резервного копирования. Это обеспечивает обработку таких транзакций в процессе восстановления бэкапа.<li>Differential (дифференциальная/разностная копия). Хранит данных, изменившиеся с момента последней Полной резервной копии. При восстановлении нужно сначала восстановить Полную резервную копию в режиме NORECOVERY, потом можно применить любую из последующих Разностных копий, без предыдущей Полной резервной копии Разностная копия бесполезна. Каждая последующая Разностная копия будет хранить все данные, входящие в предыдущую Разностную резервную копию, сделанную после предыдущей Полной копии.<li>Incremental (инкрементальная/копия журналов транзакций). Резервное копирования журнала транзакций копирует все транзакции, которые произошли с момента последнего резервного копирования, а затем урезает журнал транзакций для освобождения дискового пространства. Транзакции происходят в определенном порядке (LSN), бэкап журнала поддерживает этот порядок транзакций. Бэкапы журналов транзакций должны восстанавливаться по порядку. Для восстановления базы данных потребуется вся цепочка резервных копий: полная и все последующие инкрементальные журнала транзакций.</ul><h3 id=recovery-models><a aria-label="Anchor link for: recovery-models" class=zola-anchor href=#recovery-models><i class=icon></i></a> Recovery Models</h3><ul><li>Simple (Простая). Хранится только необходимый для жизни остаток журнала транзакций. Журнал транзакций (лог) автоматически очищается. Создание резервных копий журнала транзакций невозможна, поэтому остается самое ограниченное число опций по восстановлению. Недоступен функционал: Always On, Point-In-Time восстановление, Резервные копии журнала транзакций.<li>Full (Полная). Хранится журнал транзакций всех изменений в БД с момента последнего резервного копирования журнала транзакций. Журнал транзакций не будет очищаться до тех пор, пока не будет сделана резервная копия журнала транзакций.<li>Bulk logged (С неполным протоколированием). Идентична Full, за исключение: SELECT INTO, BULK INSERT и BCP, INSERT INTO SELECT, операции с индексами (CREATE INDEX, ALTER INDEX REBUILD, DROP INDEX)</ul><h3 id=system-databases><a aria-label="Anchor link for: system-databases" class=zola-anchor href=#system-databases><i class=icon></i></a> System databases</h3><ul><li>master. Хранятся все данные системного уровня (конфигурация системы, сведенья об учетных записях входа, информация обо всех других базах данных) для экземпляра SQL Server.<li>tempdb. Рабочее пространство для временных объектов, таких как глобальные или локальные временные таблицы, временные хранимые процедуры, табличные переменные и курсоры. Пересоздаётся при каждом запуске SQL Server.<li>model. Используется в качестве шаблона для всех баз данных, создаваемых в экземпляре SQL Server, все содержимое базы данных model, включая параметры базы данных, копируется в создаваемую базу данных. Так как база данных tempdb создается каждый раз при запуске SQL Server, база данных model всегда должна существовать в системе SQL Server.<li>msdb. Используется агентом SQL Server для создания расписания предупреждений (оператор) и выполнение заданий, а также другими компонентами. SQL Server хранит полный журнал резервного копирования и восстановления в базе данных msdb. Для отправки почты оператору используется: USE [msdb].<li>resource. Доступная только для чтения база данных, которая содержит все системные объекты, например sys.objects, физически хранятся в базе данных resource, но логически присутствуют в схеме sys каждой базы данных.</ul><h3 id=regulatory-operations><a aria-label="Anchor link for: regulatory-operations" class=zola-anchor href=#regulatory-operations><i class=icon></i></a> Regulatory operations</h3><ul><li>Проверка целостности базы данных</ul><p><code>DBCC CHECKDB</code><ul><li><p>Индексы. Индексы используются для быстрого поиска данных без необходимости поиска/просмотра всех строк в таблице базы данных при каждом обращении к таблице базы данных. Индекс ускоряет процесс запроса, предоставляя быстрый доступ к строкам данных в таблице, аналогично тому, как указатель в книге помогает вам быстро найти необходимую информацию. Индексы предоставляют путь для быстрого поиска данных на основе значений в этих столбцах. Для каждого индекса обязательно хранится его статистика. MS SQL Server самостоятельно создает и изменяет индексы при работе с базой. С течением времени данные в индексе становятся фрагментированными, т.е. разбросанными по базе данных, что серьезно снижает производительность запросов. Если фрагментация составляет от 5 до 30% (стандартно в задании 15%), то рекомендуется ее устранить с помощью реорганизации, при фрагментации выше 30% (по умолчанию в задаче > 30% фрагментации и число страниц > 1000) необходимо полное перестроение индексов. После перестроения планово используется только реорганизация.</p><li><p>Реорганизация (Reorganize) или дефрагментация индекса — это серия небольших локальных перемещений страниц так, чтобы индекс не был фрагментирован. После реорганизации статистика не обновляется. Во время выполнения почти все данные доступны, пользователи смогут работать.</p></ul><p><code>sp_msforeachtable N'DBCC INDEXDEFRAG (<имя базы данных>, ''?'')'</code><ul><li>Перестроение (Rebuild) индексов (или задача в мастере планов обслуживания: Восстановить индекс) запускает процесс полного построения индексов. В версии MS SQL Server Standard происходит отключение всех клиентов от базы на время выполнения операции. После перестроения обязательно обновляется статистика.</ul><p><code>sp_msforeachtable N'DBCC DBREINDEX (''?'')'</code><ul><li>Обновление статистики. Статистика — небольшая таблица (обычно до 200 строк), в которой хранится обобщенная информация о том, какие значения и как часто встречаются в таблице. На основании статистики сервер принимает решение, как лучше построить запрос. Когда происходят запросы к БД (например, SELECT) вы получаете данные, но не описываете то, как эти данные должны быть извлечены. В получении и обработке данных помогает статистика. Во время выполнения процедуры обновления статистики данные не блокируются.</ul><p><code>exec sp_msforeachtable N'UPDATE STATISTICS ? WITH FULLSCAN'</code><ul><li>Очистка процедурного кэша, выполняется после обновления статистики. Оптимизатор MS SQL Server кэширует планы запросов для их повторного выполнения. Это делается для того, чтобы экономить время, затрачиваемое на компиляцию запроса в том случае, если такой же запрос уже выполнялся и его план известен. После обновия статистики, не будет очищен процедурный кэш, то SQL Server может выбрать старый (неоптимальный) план запроса из кэша вместо того, чтобы построить новый (более оптимальный) план.</ul><p><code>DBCC FREEPROCCACHE</code><h1 id=influxdb><a aria-label="Anchor link for: influxdb" class=zola-anchor href=#influxdb><i class=icon></i></a> InfluxDB</h1><p><a href=https://www.influxdata.com/downloads>Download InfluxDB 1.x Open Source</a> <a href=https://github.com/CymaticLabs/InfluxDBStudio>InfluxDB-Studio</a><h3 id=install-windows><a aria-label="Anchor link for: install-windows" class=zola-anchor href=#install-windows><i class=icon></i></a> Install Windows</h3><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>https://dl.influxdata.com/influxdb/releases/influxdb-1.8.10_windows_amd64.zip<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>OutFile <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Downloads\influxdb-1.8.10_windows_amd64.zip<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Expand-Archive</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Downloads\influxdb-1.8.10_windows_amd64.zip<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>DestinationPath <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Documents\<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Remove-Item</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Downloads\influxdb-1.8.10_windows_amd64.zip<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-keyword z-operator z-other z-powershell">&</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Downloads\influxdb-1.8.10-1\influxd.exe<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></code></pre><h3 id=install-ubuntu><a aria-label="Anchor link for: install-ubuntu" class=zola-anchor href=#install-ubuntu><i class=icon></i></a> Install Ubuntu</h3><pre class="language-Bash z-code" data-lang=Bash><code class=language-Bash data-lang=Bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">wget</span></span><span class="z-meta z-function-call z-arguments z-shell"> https://dl.influxdata.com/influxdb/releases/influxdb_1.8.10_amd64.deb</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> dpkg<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>i</span> influxdb_1.8.10_amd64.deb</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">systemctl</span></span><span class="z-meta z-function-call z-arguments z-shell"> start influxdb</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">systemctl</span></span><span class="z-meta z-function-call z-arguments z-shell"> status influxdb</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ps</span></span><span class="z-meta z-function-call z-arguments z-shell"> aux</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">grep</span></span><span class="z-meta z-function-call z-arguments z-shell"> influxdb</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">grep</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>Ev</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>grep<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">netstat</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>natpl</span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">grep</span></span><span class="z-meta z-function-call z-arguments z-shell"> 80<span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>8<span class="z-keyword z-operator z-word z-shell">-</span>9<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span><span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>3<span class="z-keyword z-operator z-word z-shell">-</span>9<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span></span>
</span></code></pre><h3 id=api><a aria-label="Anchor link for: api" class=zola-anchor href=#api><i class=icon></i></a> API</h3><pre class="language-Bash z-code" data-lang=Bash><code class=language-Bash data-lang=Bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">nano</span></span><span class="z-meta z-function-call z-arguments z-shell"> /etc/influxdb/influxdb.conf</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[http]</span></span>
</span><span class="z-source z-shell z-bash">  <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">enabled</span></span><span class="z-meta z-function-call z-arguments z-shell"> = true</span>
</span><span class="z-source z-shell z-bash">  <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">bind-address</span></span><span class="z-meta z-function-call z-arguments z-shell"> = <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>:8086<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash">  <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">auth-enabled</span></span><span class="z-meta z-function-call z-arguments z-shell"> = false</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">systemctl</span></span><span class="z-meta z-function-call z-arguments z-shell"> restart influxdb</span>
</span></code></pre><h3 id=chronograf><a aria-label="Anchor link for: chronograf" class=zola-anchor href=#chronograf><i class=icon></i></a> Chronograf</h3><pre class=z-code><code><span class="z-text z-plain">wget https://dl.influxdata.com/chronograf/releases/chronograf-1.10.2_windows_amd64.zip -UseBasicParsing -OutFile chronograf-1.10.2_windows_amd64.zip
</span><span class="z-text z-plain">Expand-Archive .\chronograf-1.10.2_windows_amd64.zip -DestinationPath 'C:\Program Files\InfluxData\chronograf\'
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">wget https://dl.influxdata.com/chronograf/releases/chronograf_1.10.2_amd64.deb
</span><span class="z-text z-plain">sudo dpkg -i chronograf_1.10.2_amd64.deb
</span><span class="z-text z-plain">systemctl status influxdb
</span><span class="z-text z-plain">http://192.168.3.102:8888
</span></code></pre><h3 id=grafana><a aria-label="Anchor link for: grafana" class=zola-anchor href=#grafana><i class=icon></i></a> Grafana</h3><p><a href=https://grafana.com/grafana/download>Download</a><p><code>invoke-RestMethod https://dl.grafana.com/enterprise/release/grafana-enterprise-10.3.1.windows-amd64.msi -OutFile "$home\Download\grafana.msi"</code><pre class="language-Bash z-code" data-lang=Bash><code class=language-Bash data-lang=Bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">apt-get</span></span><span class="z-meta z-function-call z-arguments z-shell"> install<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>y</span> adduser libfontconfig1 musl</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">wget</span></span><span class="z-meta z-function-call z-arguments z-shell"> https://dl.grafana.com/enterprise/release/grafana-enterprise_10.3.1_amd64.deb</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">dpkg</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>i</span> grafana-enterprise_10.3.1_amd64.deb</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">systemctl</span></span><span class="z-meta z-function-call z-arguments z-shell"> start grafana-server</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">systemctl</span></span><span class="z-meta z-function-call z-arguments z-shell"> status grafana-server</span>
</span></code></pre><h3 id=cli-client><a aria-label="Anchor link for: cli-client" class=zola-anchor href=#cli-client><i class=icon></i></a> CLI Client</h3><p><code>apt install influxdb-client</code> <br> <code>influx</code> <br> <code>influx --host 192.168.3.102 --username admin --password password</code><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>influx_client_exec</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Documents\influxdb-1.8.10-1\influx.exe<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-keyword z-operator z-other z-powershell">&</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>influx_client_exec</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>host <span class="z-constant z-numeric z-integer z-powershell">192.168</span>.<span class="z-constant z-numeric z-integer z-powershell">3.102</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>port <span class="z-constant z-numeric z-integer z-powershell">8086</span>
</span><span class="z-source z-powershell">help
</span><span class="z-source z-powershell">show databases
</span><span class="z-source z-powershell">use PowerShell
</span><span class="z-source z-powershell">SELECT <span class="z-keyword z-operator z-assignment z-powershell">*</span> <span class="z-keyword z-control z-powershell">FROM</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>HardwareMonitor<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-control z-powershell">WHERE</span> time <span class="z-keyword z-operator z-redirection z-powershell">></span> now<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span> <span class="z-constant z-numeric z-integer z-powershell">5m</span>
</span></code></pre><h3 id=users><a aria-label="Anchor link for: users" class=zola-anchor href=#users><i class=icon></i></a> USERS</h3><p><code>SHOW USERS</code> отобразить пользователей и их права доступа <br> <code>CREATE USER admin WITH PASSWORD 'password' WITH ALL PRIVILEGES</code> создать пользователя <br> <code>GRANT ALL PRIVILEGES TO "admin"</code> предоставить права доступа <br> <code>GRANT READ ON "database" TO "admin"</code> доступ на чтение для БД или запись (WRITE) <br> <code>REVOKE ALL PRIVILEGES FROM "admin"</code> отозвать права доступа <br> <code>SHOW GRANTS FOR "admin"</code> БД и привелегии доступа для указанного пользователя <br> <code>SET PASSWORD FOR "admin" = 'new_password'</code> изменить пароль <br> <code>DROP USER "admin"</code> удалить пользователя<h3 id=database-1><a aria-label="Anchor link for: database-1" class=zola-anchor href=#database-1><i class=icon></i></a> DATABASE</h3><p><code>CREATE DATABASE powershell</code> создать БД <br> <code>SHOW DATABASES</code> отобразить список БД <br> <code>DROP DATABASE powershell</code> удалить БД <br> <code>USE powershell</code> <br> <code>SHOW measurements</code> отобразить все таблицы <br> <code>INSERT performance,host=console,counter=CPU value=0.88</code> записать данные в таблицу performance<h3 id=measurement><a aria-label="Anchor link for: measurement" class=zola-anchor href=#measurement><i class=icon></i></a> MEASUREMENT</h3><p><code>SHOW TAG KEYS FROM "HardwareMonitor"</code> отобразить все тэги в таблице <br> <code>SHOW TAG VALUES FROM "HardwareMonitor" WITH KEY = "HardwareName"</code> отобразить все значения указанного тэга <br> <code>SHOW FIELD KEYS FROM "HardwareMonitor"</code> отобразить все Field Tags и их тип данных <br> <code>SHOW SERIES FROM "HardwareMonitor"</code> отобразить список всех уникальных серий в указанной таблице. Серия - это набор точек данных, которые имеют одинаковые значения для всех тегов, за исключением времени. <br> <code>DROP SERIES FROM "HardwareMonitor"</code> очистить все данные в таблице <br> <code>DROP MEASUREMENT "HardwareMonitor"</code> удалить таблицу<h3 id=select-and-where><a aria-label="Anchor link for: select-and-where" class=zola-anchor href=#select-and-where><i class=icon></i></a> SELECT and WHERE</h3><p><code>SELECT * FROM performance</code> отобразить все данные в таблице <br> <code>SELECT value FROM performance</code> отфильтровать по столбцу value (только Field Keys) <br> <code>SELECT * FROM performance limit 10</code> отобразить 10 единиц данных <br> <code>SELECT * FROM performance WHERE time > now() -2d</code> отобразить данные за последние 2 дня <br> <code>SELECT * FROM performance WHERE time > now() +3h -5m</code> данные за последние 5 минут (+3 часа от текущего времени по UTC 0 -5 минут) <br> <code>SELECT * FROM performance WHERE counter = 'CPU'</code> выборка по тэгу <br> <code>SELECT upload/1000 FROM speedtest WHERE upload/1000 <= 250</code> выборка по столбцу upload и разделить вывод на 1000, вывести upload меньше 250 <br> <code>DELETE FROM performance WHERE time > now() -1h</code> удалить данные за последние 1/4 часа <br> <code>DELETE FROM performance WHERE time < now() -24h</code> удалить данные старше 24 часов<h3 id=regex><a aria-label="Anchor link for: regex" class=zola-anchor href=#regex><i class=icon></i></a> REGEX</h3><p><code>SELECT * FROM "win_pdisk" WHERE instance =~/.*C:/ and time > now() - 5m</code> и <br> <code>SELECT * FROM "win_pdisk" WHERE instance =~/.*E:/ or instance =~ /.*F:/</code> или <br> <code>SELECT * FROM "win_pdisk" WHERE instance !~ /.*Total/</code> не равно (исключить) <br> <code>SELECT * FROM "HardwareMonitor" WHERE time > now() - 5m and HardwareName =~ /Intel/</code> приблизительно равно <br> <code>SELECT * FROM "HardwareMonitor" WHERE time > now() - 5m and HardwareName =~ /Intel.+i7/</code> эквивалент 12th_Gen_Intel_Core_i7-1260P <br> <code>SELECT * FROM "HardwareMonitor" WHERE time > now() - 5m and HardwareName =~ /^Intel/</code> начинается на Intel <br> <code>SELECT * FROM "HardwareMonitor" WHERE time > now() - 5m and HardwareName =~ /00$/</code> заканчивается на 00<h3 id=group-by-tag-key><a aria-label="Anchor link for: group-by-tag-key" class=zola-anchor href=#group-by-tag-key><i class=icon></i></a> GROUP BY tag key</h3><p><code>SELECT * FROM "HardwareMonitor" WHERE time > now() - 5m and SensorName = 'Temperature' GROUP BY HardwareName</code> создать уникальные группы по тэгу HardwareName <br> <code>SELECT * FROM "HardwareMonitor" WHERE time > now() - 5m and SensorName = 'Temperature' GROUP BY Host,HardwareName</code> больше групп по двум тэгаам<h3 id=functions><a aria-label="Anchor link for: functions" class=zola-anchor href=#functions><i class=icon></i></a> Functions</h3><p><a href=https://docs.influxdata.com/influxdb/v1.8/query_language/functions>Functions</a><p><code>SELECT instance,LAST(Avg._Disk_Read_Queue_Length) FROM "win_pdisk" GROUP BY instance</code> отфильтровать вывод по последнему/текущему значению <br> <code>SELECT instance,FIRST(Avg._Disk_Read_Queue_Length) FROM "win_pdisk" GROUP BY instance</code> отфильтровать вывод по первому значению за весь или указанный отрезок времени <br> <code>SELECT instance,MIN(Avg._Disk_Read_Queue_Length) FROM "win_pdisk" GROUP BY instance</code> отфильтровать вывод с отображением минимального значения <br> <code>SELECT instance,MAX(Avg._Disk_Read_Queue_Length) FROM "win_pdisk" GROUP BY instance</code> отфильтровать вывод с отображением максимального значения <br> <code>SELECT SUM(Bytes_Received_persec) FROM "win_net" GROUP BY instance</code> суммах всех значений <br> <code>SELECT COUNT(Bytes_Received_persec) FROM "win_net" WHERE Bytes_Received_persec >= 0 GROUP BY instance</code> кол-во данных, где значение выше или равно 0 <br> <code>SELECT MEAN(Bytes_Received_persec) FROM "win_net" WHERE Bytes_Received_persec < 1000 GROUP BY instance</code> среднее значение данных с показателем от 0 до 1000 (509)<p><code>SELECT *,MAX(Value) FROM "HardwareMonitor" WHERE time > now() -1h GROUP BY SensorName,Host</code> создать группы для выявления максимального значения значения стобца Value каждого тэга SensorName и хоста за последний час <br> <code>SELECT *,MAX(Value) FROM "HardwareMonitor" WHERE time > now() -1h and SensorName = 'CPU_Package' GROUP BY Host</code> масимальное значение CPU_Package за последний час для каждого хоста <br> <code>SELECT MEAN(Value) FROM "HardwareMonitor" WHERE time > now() -1h and SensorName = 'CPU_Package' GROUP BY Host</code> среднее значение CPU_Package за последний час<h3 id=policy><a aria-label="Anchor link for: policy" class=zola-anchor href=#policy><i class=icon></i></a> POLICY</h3><p><code>CREATE DATABASE powershell WITH DURATION 48h REPLICATION 1 NAME "del2d"</code> создать БД с политикой хранения 2 дня <br> <code>CREATE RETENTION POLICY del2h ON powershell DURATION 2h REPLICATION 1</code> создать новую политику хранения для БД <br> <code>CREATE RETENTION POLICY del6h ON powershell DURATION 6h REPLICATION 1 SHARD DURATION 2h</code> указать период хранения 6 часов + 2 часа до очистки (по умолчанию 1ч или больше) <br> <code>ALTER RETENTION POLICY del6h ON powershell DEFAULT</code> изменить (ALTER) политику хранения для БД на del6h (DEFAULT) <br> <code>DROP RETENTION POLICY del2d ON powershell</code> удаление политики хранения приводит к безвозвратному удалению всех измерений (таблиц) и данных, хранящихся в политике хранения <br> <code>SHOW RETENTION POLICIES ON PowerShell</code> отобразить действующие политики базы данных PowerShell<h1 id=influxdb-api><a aria-label="Anchor link for: influxdb-api" class=zola-anchor href=#influxdb-api><i class=icon></i></a> InfluxDB-api</h1><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>data</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">Invoke-RestMethod</span> http:<span class="z-keyword z-operator z-assignment z-powershell">/</span><span class="z-keyword z-operator z-assignment z-powershell">/</span><span class="z-constant z-numeric z-integer z-powershell">192.168</span>.<span class="z-constant z-numeric z-integer z-powershell">3.102</span>:<span class="z-constant z-numeric z-integer z-powershell">8086</span><span class="z-keyword z-operator z-assignment z-powershell">/</span>query?q<span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>SHOW RETENTION POLICIES ON PowerShell<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>col</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>data<span class="z-variable z-other z-member z-powershell">.results.series.columns</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>val</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>data<span class="z-variable z-other z-member z-powershell">.results.series.values</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>mass</span>    <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-group z-array-expression z-powershell"><span class="z-keyword z-other z-array z-begin z-powershell">@</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>mass</span>   <span class="z-keyword z-operator z-assignment z-powershell">+=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">string</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>col</span>
</span><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">foreach</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>v</span> <span class="z-keyword z-control z-powershell">in</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>val</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">	<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>mass</span> <span class="z-keyword z-operator z-assignment z-powershell">+=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">string</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>v</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>mass</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>mass</span> <span class="z-keyword z-operator z-comparison z-powershell">-replace</span> <span class="z-string z-quoted z-single z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">'</span>^<span class="z-punctuation z-definition z-string z-end z-powershell">'</span></span><span class="z-keyword z-operator z-other z-powershell">,</span><span class="z-string z-quoted z-single z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">'</span>"<span class="z-punctuation z-definition z-string z-end z-powershell">'</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>mass</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>mass</span> <span class="z-keyword z-operator z-comparison z-powershell">-replace</span> <span class="z-string z-quoted z-single z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">'</span>$<span class="z-punctuation z-definition z-string z-end z-powershell">'</span></span><span class="z-keyword z-operator z-other z-powershell">,</span><span class="z-string z-quoted z-single z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">'</span>"<span class="z-punctuation z-definition z-string z-end z-powershell">'</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>mass</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>mass</span> <span class="z-keyword z-operator z-comparison z-powershell">-replace</span> <span class="z-string z-quoted z-single z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">'</span>\s<span class="z-punctuation z-definition z-string z-end z-powershell">'</span></span><span class="z-keyword z-operator z-other z-powershell">,</span><span class="z-string z-quoted z-single z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">'</span>","<span class="z-punctuation z-definition z-string z-end z-powershell">'</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>mass</span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-support z-function z-powershell">ConvertFrom-Csv</span>
</span></code></pre><h3 id=api-post><a aria-label="Anchor link for: api-post" class=zola-anchor href=#api-post><i class=icon></i></a> API POST</h3><p>Вместо таблиц в InfluxDB имеются измерения. Вместо столбцов в ней есть теги и поля.<pre class=z-code><code><span class="z-text z-plain">   Table                        Tag (string/int)                          Field (double/int)           TIMESTAMP
</span><span class="z-text z-plain">measurement,Tag_Keys1=Tag_Values1,Tag_Keys2=Tag_Values2 Field_Keys1="Values",Field_Keys2="Values" 0000000000000000000
</span><span class="z-text z-plain">           1                                           2                                         3
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">$ip        = "192.168.3.104"
</span><span class="z-text z-plain">$port      = "8086"
</span><span class="z-text z-plain">$db        = "powershell"
</span><span class="z-text z-plain">$table     = "speedtest"
</span><span class="z-text z-plain">$ipp       = $ip+":"+$port
</span><span class="z-text z-plain">$url       = "http://$ipp/write?db=$db"
</span><span class="z-text z-plain">$user      = "admin"
</span><span class="z-text z-plain">$pass      = "password" | ConvertTo-SecureString -AsPlainText -Force
</span><span class="z-text z-plain">$cred      = [System.Management.Automation.PSCredential]::new($user,$pass)
</span><span class="z-text z-plain">$unixtime  = (New-TimeSpan -Start (Get-Date "01/01/1970") -End (Get-Date)).TotalSeconds
</span><span class="z-text z-plain">$timestamp = ([string]$unixtime -replace "\..+") + "000000000"
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">Invoke-RestMethod -Method POST -Uri $url -Body "$table,host=$(hostname) download=200000,upload=300000,ping=3 $timestamp"
</span></code></pre><h3 id=api-get><a aria-label="Anchor link for: api-get" class=zola-anchor href=#api-get><i class=icon></i></a> API GET</h3><p><code>curl http://192.168.3.104:8086/query --data-urlencode "q=SHOW DATABASES"</code> pwsh7 (ConvertFrom-Json) and bash<p><code>$dbs = irm "http://192.168.3.104:8086/query?q=SHOW DATABASES"</code> <br> <code>$dbs = irm "http://192.168.3.104:8086/query?epoch=ms&u=admin&p=password&q=SHOW DATABASES"</code> <br> <code>$dbs.results.series.values</code><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>ip</span>    <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>192.168.3.104<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>port</span>  <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>8086<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>db</span>    <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>powershell<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>table</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>speedtest<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>query</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>SELECT * FROM <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>table</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>ipp</span>   <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>ip</span><span class="z-keyword z-operator z-assignment z-powershell">+</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>:<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-assignment z-powershell">+</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>port</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>url</span>   <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>http://<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>ipp</span>/query?db=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>db</span>&q=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>query</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>data</span>  <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Method GET <span class="z-keyword z-operator z-assignment z-powershell">-</span>Uri <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>url</span><span class="z-keyword z-operator z-other z-powershell">`</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Credential <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cred</span> 
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>data<span class="z-variable z-other z-member z-powershell">.results.series.name</span></span>   <span class="z-keyword z-operator z-other z-powershell">`</span> имя таблицы
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>data<span class="z-variable z-other z-member z-powershell">.results.series.columns</span></span><span class="z-keyword z-operator z-other z-powershell">`</span> столбцы<span class="z-keyword z-operator z-assignment z-powershell">/</span>ключи
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>data<span class="z-variable z-other z-member z-powershell">.results.series.values</span></span> <span class="z-keyword z-operator z-other z-powershell">`</span> данные построчно
</span></code></pre><h3 id=endpoints><a aria-label="Anchor link for: endpoints" class=zola-anchor href=#endpoints><i class=icon></i></a> Endpoints</h3><p><a href=https://docs.influxdata.com/influxdb/v1.7/tools/api/>API doc</a><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>stats</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> irm http:<span class="z-keyword z-operator z-assignment z-powershell">/</span><span class="z-keyword z-operator z-assignment z-powershell">/</span><span class="z-constant z-numeric z-integer z-powershell">192.168</span>.<span class="z-constant z-numeric z-integer z-powershell">3.104</span>:<span class="z-constant z-numeric z-integer z-powershell">8086</span><span class="z-keyword z-operator z-assignment z-powershell">/</span>debug<span class="z-keyword z-operator z-assignment z-powershell">/</span>vars<span class="z-keyword z-operator z-other z-powershell">`</span> статистика сервера
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>stats</span>.<span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>database:powershell<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>.values<span class="z-keyword z-operator z-other z-powershell">`</span> кол<span class="z-keyword z-operator z-assignment z-powershell">-</span>во таблиц к БД
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>stats<span class="z-variable z-other z-member z-powershell">.queryExecutor.values</span></span><span class="z-keyword z-operator z-other z-powershell">`</span> количество query<span class="z-keyword z-operator z-assignment z-powershell">-</span>запросов <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell">обращений к endpoint <span class="z-keyword z-operator z-assignment z-powershell">/</span>query</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>stats<span class="z-variable z-other z-member z-powershell">.write.values</span></span><span class="z-keyword z-operator z-other z-powershell">`</span> количество <span class="z-support z-function z-powershell">write-запросов</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>stats<span class="z-variable z-other z-member z-powershell">.system.uptime</span></span>
</span></code></pre><p><code>http://192.168.3.104:8086/debug/requests</code> кол-во клиентских HTTP-запросов к конечным точкам /writeи /query <br> <code>http://192.168.3.104:8086/debug/pprof</code> <br> <code>http://192.168.3.104:8086/ping</code> <br> <code>http://192.168.3.104:8086/query</code> <br> <code>http://192.168.3.104:8086/write</code><p><code>http://192.168.3.99:8086/api/v2/setup</code> <br> <code>http://192.168.3.99:8086/api/v2/config</code> <br> <code>http://192.168.3.99:8086/api/v2/write</code><h3 id=pingto-influxdb><a aria-label="Anchor link for: pingto-influxdb" class=zola-anchor href=#pingto-influxdb><i class=icon></i></a> PingTo-InfluxDB</h3><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">while</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-constant z-language z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>true</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">	<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>tz</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">Get-TimeZone</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.BaseUtcOffset.TotalMinutes
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">	<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>unixtime</span>  <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">New-TimeSpan</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Start <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">Get-Date</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>01/01/1970<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>End <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">Get-Date</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.AddMinutes<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-keyword z-operator z-assignment z-powershell">-</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>tz</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.TotalSeconds<span class="z-keyword z-operator z-other z-powershell">`</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>3h UTC
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">	<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>timestamp</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">string</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>unixtime</span> <span class="z-keyword z-operator z-comparison z-powershell">-replace</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>\..+<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-keyword z-operator z-assignment z-powershell">+</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>000000000<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">	<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>tnc</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> tnc <span class="z-constant z-numeric z-integer z-powershell">8.8</span>.<span class="z-constant z-numeric z-integer z-powershell">8.8</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">	<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Status</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>tnc<span class="z-variable z-other z-member z-powershell">.PingSucceeded</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">	<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>RTime</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>tnc<span class="z-variable z-other z-member z-powershell">.PingReplyDetails.RoundtripTime</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">	<span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Method POST <span class="z-keyword z-operator z-assignment z-powershell">-</span>Uri <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>http://192.168.3.104:8086/write?db=powershell<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Body <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>ping,host=<span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-complex z-source z-powershell">hostname</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> status=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>status</span>,rtime=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>RTime</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>timestamp</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">	sleep <span class="z-constant z-numeric z-integer z-powershell">1</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></code></pre><p><code>SELECT * FROM ping WHERE status = false</code><h3 id=performanceto-influxdb><a aria-label="Anchor link for: performanceto-influxdb" class=zola-anchor href=#performanceto-influxdb><i class=icon></i></a> PerformanceTo-InfluxDB</h3><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-meta z-function z-powershell"><span class="z-storage z-type z-powershell">function</span> <span class="z-entity z-name z-function z-powershell">ConvertTo-Encoding</span></span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">string</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>From</span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">string</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>To</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-keyword z-control z-powershell">Begin</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>encFrom</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">System.Text.Encoding</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::GetEncoding<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>from</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>encTo</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">System.Text.Encoding</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::GetEncoding<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>to</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-keyword z-control z-powershell">Process</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>bytes</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>encTo<span class="z-variable z-other z-member z-powershell">.GetBytes</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-variable z-automatic z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>_</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>bytes</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">System.Text.Encoding</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::Convert<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>encFrom</span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>encTo</span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>bytes</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>encTo<span class="z-variable z-other z-member z-powershell">.GetString</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>bytes</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>localization</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">Get-Culture</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.LCID<span class="z-keyword z-operator z-other z-powershell">`</span> текущая локализация
</span><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">if</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>localization</span> <span class="z-keyword z-operator z-comparison z-powershell">-eq</span> <span class="z-constant z-numeric z-integer z-powershell">1049</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">	<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>performance</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>\\<span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-complex z-source z-powershell">hostname</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>\Процессор(_Total)\% загруженности процессора<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-support z-function z-powershell">ConvertTo-Encoding</span> UTF<span class="z-keyword z-operator z-assignment z-powershell">-</span><span class="z-constant z-numeric z-integer z-powershell">8</span> windows<span class="z-keyword z-operator z-assignment z-powershell">-</span><span class="z-constant z-numeric z-integer z-powershell">1251</span><span class="z-keyword z-operator z-other z-powershell">`</span> декодировать кириллицу
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span> <span class="z-keyword z-control z-powershell">else</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">	<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>performance</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>\Processor(_Total)\% Processor Time<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>tz</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">Get-TimeZone</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.BaseUtcOffset.TotalMinutes
</span><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">while</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-constant z-language z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>true</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">	<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>unixtime</span>  <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">New-TimeSpan</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Start <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">Get-Date</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>01/01/1970<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>End <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">Get-Date</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.AddMinutes<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-keyword z-operator z-assignment z-powershell">-</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>tz</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.TotalSeconds<span class="z-keyword z-operator z-other z-powershell">`</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>3h UTC
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">	<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>timestamp</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">string</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>unixtime</span> <span class="z-keyword z-operator z-comparison z-powershell">-replace</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>\..+<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-keyword z-operator z-assignment z-powershell">+</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>000000000<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">	<span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">double</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>value</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">Get-Counter</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>performance</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.CounterSamples.CookedValue.ToString<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>0.00<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.replace<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>,<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-other z-powershell">,</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>.<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span><span class="z-keyword z-operator z-other z-powershell">`</span> округлить в тип данных Double
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">	<span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Method POST <span class="z-keyword z-operator z-assignment z-powershell">-</span>Uri <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>http://192.168.3.104:8086/write?db=powershell<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Body <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>performance,host=<span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-complex z-source z-powershell">hostname</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>,counter=CPU value=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>value</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>timestamp</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">	sleep <span class="z-constant z-numeric z-integer z-powershell">5</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></code></pre><h3 id=service><a aria-label="Anchor link for: service" class=zola-anchor href=#service><i class=icon></i></a> Service</h3><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>powershell_Path</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">Get-Command</span> powershell</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.Source
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>NSSM_Path</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>C:\NSSM\NSSM-2.24.exe<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Script_Path</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>C:\NSSM\PerformanceTo-InfluxDB.ps1<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Service_Name</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>PerformanceTo-InfluxDB<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-keyword z-operator z-other z-powershell">&</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>NSSM_Path</span> install <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Service_Name</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>powershell_Path</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>ExecutionPolicy Bypass <span class="z-keyword z-operator z-assignment z-powershell">-</span>NoProfile <span class="z-keyword z-operator z-string-format z-powershell">-f</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Script_Path</span>
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Get-Service</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Service_Name</span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-support z-function z-powershell">Start-Service</span>
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Get-Service</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Service_Name</span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-support z-function z-powershell">Set-Service</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>StartupType Automatic
</span></code></pre><h3 id=psinfluxdb><a aria-label="Anchor link for: psinfluxdb" class=zola-anchor href=#psinfluxdb><i class=icon></i></a> PSInfluxDB</h3><p><code>Install-Module psinfluxdb -Repository NuGet</code> <br> <code>Get-InfluxUsers -server 192.168.3.102</code> список пользователей на сенвере InfluxDB и права доступа <br> <code>Get-InfluxDatabases -server 192.168.3.102</code> список баз данных <br> <code>Get-InfluxDatabases -server 192.168.3.102 -creat -database test</code> создать базу данных <br> <code>Get-InfluxDatabases -server 192.168.3.102 -delete -database test</code> удалить базу данных <br> <code>Get-InfluxPolicy -server 192.168.3.102 -database PowerShell</code> список политик хранения указанной базы данных <br> <code>Get-InfluxPolicy -server 192.168.3.102 -database PowerShell -creat -policyName del2d -hours 48</code> создать политику хранения <br> <code>Get-InfluxPolicy -server 192.168.3.102 -database PowerShell -policyName del2d -default</code> применить политику хранения к базе данных по умолчанию <br> <code>Get-InfluxTables -server 192.168.3.102 -database PowerShell</code> список таблиц/измерений в базе данных <br> <code>$Data = Get-InfluxData -server 192.168.3.102 -database PowerShell -table ping | Format-Table</code> отобразить данные в таблице <br> <code>$Data | Where-Object {$_.SensorName -match "CPU_Package" -and $_.Value -gt 90} | Format-Table</code> отфильтровать данные по двум параметрам (сенсоры процессора с показателем выше 90) <br> <code>$influx = Get-InfluxData -server 192.168.3.104 -database PowerShell -table speedtest</code> <br> <code>Get-InfluxChart -time ($influx.time) -data ($influx.download) -title "SpeedTest Download" -path "C:\Users\Lifailon\Desktop"</code> создать график (WinForms Chart) измерений и сохранить в jpeg-файл<h1 id=telegraf><a aria-label="Anchor link for: telegraf" class=zola-anchor href=#telegraf><i class=icon></i></a> Telegraf</h1><p><a href=https://docs.influxdata.com/telegraf/v1.27/plugins/#input-plugins>Plugins</a><p><code>iwr https://dl.influxdata.com/telegraf/releases/telegraf-1.27.1_windows_amd64.zip -UseBasicParsing -OutFile telegraf-1.27.1_windows_amd64.zip</code> <br> <code>Expand-Archive .\telegraf-1.27.1_windows_amd64.zip -DestinationPath "C:\Telegraf"</code> <br> <code>rm telegraf-1.27.1_windows_amd64.zip</code> <br> <code>cd C:\Telegraf</code> <br> <code>.\telegraf.exe -sample-config --input-filter cpu:mem:dns_query --output-filter influxdb > telegraf_nt.conf</code> создать конфигурацию с выбарнными плагинами для сбора метрик <br> <code>Start-Process notepad++ C:\Telegraf\telegraf_nt.conf</code><pre class=z-code><code><span class="z-text z-plain">[[outputs.influxdb]]
</span><span class="z-text z-plain">  urls = ["http://192.168.3.104:8086"]
</span><span class="z-text z-plain">  database = "telegraf_nt"
</span><span class="z-text z-plain">  username = "user"
</span><span class="z-text z-plain">  password = "pass"
</span><span class="z-text z-plain">[[inputs.cpu]]
</span><span class="z-text z-plain">  percpu = false
</span><span class="z-text z-plain">  totalcpu = true
</span><span class="z-text z-plain">[[inputs.dns_query]]
</span><span class="z-text z-plain">  servers = ["8.8.8.8"]
</span><span class="z-text z-plain">  network = "udp"
</span><span class="z-text z-plain">  domains = ["."]
</span><span class="z-text z-plain">  record_type = "A"
</span><span class="z-text z-plain">  port = 53
</span><span class="z-text z-plain">  timeout = "2s"
</span></code></pre><p><code>.\telegraf.exe --test -config C:\Telegraf\telegraf_nt.conf</code> тест конфигурации (получения метрик с выводом в консоль) <br> <code>C:\Telegraf\telegraf.exe -config C:\Telegraf\telegraf_nt.conf</code> запустить telegraf (тест отправки данных) <br> <code>.\telegraf.exe --config "C:\Telegraf\telegraf_nt.conf" --service install</code> создать службу <br> <code>Get-Service telegraf | Start-Service</code> <br> <code>.\telegraf.exe --service uninstall</code><p><code>USE telegraf</code> <br> <code>SELECT usage_idle,usage_system,usage_user FROM cpu</code><h1 id=elasticsearch><a aria-label="Anchor link for: elasticsearch" class=zola-anchor href=#elasticsearch><i class=icon></i></a> Elasticsearch</h1><p><code>Install-Module -Name Elastic.Console -AllowPrerelease</code> <a href=https://github.com/elastic/powershell/blob/master/Elastic.Console/README.md>github source</a> <br> <code>Get-Command -Module Elastic.Console</code> <br> <code>Get-ElasticsearchVersion</code> <br> <code>Set-ElasticsearchVersion 7.3.0</code> <br> <code>Invoke-Elasticsearch</code> REST API запросы<h1 id=cdata><a aria-label="Anchor link for: cdata" class=zola-anchor href=#cdata><i class=icon></i></a> CData</h1><p><a href=https://www.powershellgallery.com/profiles/CData>PowerShell Gallery CData</a> <br> <a href=https://www.cdata.com/kb/tech/elasticsearch-ado-powershell.rst>Automate Elasticsearch Integration Tasks from PowerShell</a><p><code>Install-Module ElasticsearchCmdlets</code> <a href=https://www.powershellgallery.com/packages/ElasticsearchCmdlets/23.0.8565.1>пакет драйвера в psgallery</a> <br> <code>Import-Module ElasticsearchCmdlets</code> <br> <code>Get-Command -Module ElasticsearchCmdlets</code><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>elasticsearch</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">Connect-Elasticsearch</span>  <span class="z-keyword z-operator z-assignment z-powershell">-</span>Server <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Server</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Port <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Port</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>User <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>User</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Password <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Password</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>shipcity</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>New York<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>orders</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">Select-Elasticsearch</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Connection <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>elasticsearch</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Table <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Orders<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Where <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>ShipCity = <span class="z-constant z-character z-escape z-powershell">`'</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>ShipCity</span><span class="z-constant z-character z-escape z-powershell">`'</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-other z-powershell">`</span> поиск и получение данных
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>orders</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">Invoke-Elasticsearch</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Connection <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>elasticsearch</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Query <span class="z-string z-quoted z-single z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">'</span>SELECT * FROM Orders WHERE ShipCity = @ShipCity<span class="z-punctuation z-definition z-string z-end z-powershell">'</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Params <span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span><span class="z-string z-quoted z-single z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">'</span>@ShipCity<span class="z-punctuation z-definition z-string z-end z-powershell">'</span></span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-string z-quoted z-single z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">'</span>New York<span class="z-punctuation z-definition z-string z-end z-powershell">'</span></span><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span><span class="z-keyword z-operator z-other z-powershell">`</span> SQL запросы
</span></code></pre><h3 id=ado-net-assembly><a aria-label="Anchor link for: ado-net-assembly" class=zola-anchor href=#ado-net-assembly><i class=icon></i></a> ADO NET Assembly</h3><p><code>Install-Package CData.Elasticsearch</code> <a href=https://www.nuget.org/packages/CData.Elasticsearch>пакет драйвера в nuget</a> <br> <code>[Reflection.Assembly]::LoadFile("C:\Program Files\PackageManagement\NuGet\Packages\CData.Elasticsearch.23.0.8565\lib\net40\System.Data.CData.Elasticsearch.dll")</code><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>connect</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> System.Data.CData.Elasticsearch.ElasticsearchConnection<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Server=127.0.0.1;Port=9200;User=admin;Password=123456;<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>connect<span class="z-variable z-other z-member z-powershell">.Open</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>sql</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>SELECT OrderName, Freight from Orders<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>da</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> System.Data.CData.Elasticsearch.ElasticsearchDataAdapter<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>sql</span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>conn</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>dt</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> System.Data.DataTable
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>da<span class="z-variable z-other z-member z-powershell">.Fill</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>dt</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>dt<span class="z-variable z-other z-member z-powershell">.Rows</span></span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-keyword z-control z-powershell">foreach</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-support z-function z-powershell">Write-Host</span> <span class="z-support z-variable z-automatic z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>_<span class="z-variable z-other z-member z-powershell">.ordername</span></span> <span class="z-support z-variable z-automatic z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>_<span class="z-variable z-other z-member z-powershell">.freight</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></code></pre><h3 id=update-1><a aria-label="Anchor link for: update-1" class=zola-anchor href=#update-1><i class=icon></i></a> UPDATE</h3><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Update-Elasticsearch</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Connection <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Elasticsearch</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Columns <span class="z-meta z-group z-array-expression z-powershell"><span class="z-keyword z-other z-array z-begin z-powershell">@</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-string z-quoted z-single z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">'</span>OrderName<span class="z-punctuation z-definition z-string z-end z-powershell">'</span></span><span class="z-keyword z-operator z-other z-powershell">,</span><span class="z-string z-quoted z-single z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">'</span>Freight<span class="z-punctuation z-definition z-string z-end z-powershell">'</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Values <span class="z-meta z-group z-array-expression z-powershell"><span class="z-keyword z-other z-array z-begin z-powershell">@</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-string z-quoted z-single z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">'</span>MyOrderName<span class="z-punctuation z-definition z-string z-end z-powershell">'</span></span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-string z-quoted z-single z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">'</span>MyFreight<span class="z-punctuation z-definition z-string z-end z-powershell">'</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Table Orders <span class="z-keyword z-operator z-assignment z-powershell">-</span>Id <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>MyId<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span>  <span class="z-support z-function z-powershell">New-Object</span> System.Data.CData.Elasticsearch.ElasticsearchCommand<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>UPDATE Orders SET ShipCity='New York' WHERE Id = @myId<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>conn</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd<span class="z-variable z-other z-member z-powershell">.Parameters.Add</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell">new System.Data.CData.Elasticsearch.ElasticsearchParameter<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>@myId<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-other z-powershell">,</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>10456255-0015501366<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd<span class="z-variable z-other z-member z-powershell">.ExecuteNonQuery</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></code></pre><h3 id=insert-1><a aria-label="Anchor link for: insert-1" class=zola-anchor href=#insert-1><i class=icon></i></a> INSERT</h3><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Add-Elasticsearch</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Connection <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Elasticsearch</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Table Orders <span class="z-keyword z-operator z-assignment z-powershell">-</span>Columns <span class="z-meta z-group z-array-expression z-powershell"><span class="z-keyword z-other z-array z-begin z-powershell">@</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>OrderName<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Freight<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Values <span class="z-meta z-group z-array-expression z-powershell"><span class="z-keyword z-other z-array z-begin z-powershell">@</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>MyOrderName<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>MyFreight<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span>
</span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span>  <span class="z-support z-function z-powershell">New-Object</span> System.Data.CData.Elasticsearch.ElasticsearchCommand<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>INSERT INTO Orders (ShipCity) VALUES (@myShipCity)<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>conn</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd<span class="z-variable z-other z-member z-powershell">.Parameters.Add</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell">new System.Data.CData.Elasticsearch.ElasticsearchParameter<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>@myShipCity<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-other z-powershell">,</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>New York<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd<span class="z-variable z-other z-member z-powershell">.ExecuteNonQuery</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></code></pre><h3 id=delete-1><a aria-label="Anchor link for: delete-1" class=zola-anchor href=#delete-1><i class=icon></i></a> DELETE</h3><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Remove-Elasticsearch</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Connection <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Elasticsearch</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Table <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Orders<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Id <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>MyId<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span>  <span class="z-support z-function z-powershell">New-Object</span> System.Data.CData.Elasticsearch.ElasticsearchCommand<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>DELETE FROM Orders WHERE Id=@myId<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>conn</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd<span class="z-variable z-other z-member z-powershell">.Parameters.Add</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell">new System.Data.CData.Elasticsearch.ElasticsearchParameter<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>@myId<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-other z-powershell">,</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>001d000000YBRseAAH<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd<span class="z-variable z-other z-member z-powershell">.ExecuteNonQuery</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></code></pre><h1 id=odbc><a aria-label="Anchor link for: odbc" class=zola-anchor href=#odbc><i class=icon></i></a> ODBC</h1><p><code>Get-Command -Module Wdac</code> <br> <code>Get-OdbcDriver | ft</code> список установленных драйверов<p><a href=https://www.elastic.co/guide/en/elasticsearch/reference/current/sql-client-apps-ps1.html>Elasticsearch ODBC драйвер для доступа к данным Elasticsearch из Microsoft PowerShell</a><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>connectstring</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>DSN=Local Elasticsearch;<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>sql</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>SELECT * FROM library<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>conn</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> System.Data.Odbc.OdbcConnection<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>connectstring</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>conn<span class="z-variable z-other z-member z-powershell">.open</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> system.Data.Odbc.OdbcCommand<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>sql</span><span class="z-keyword z-operator z-other z-powershell">,</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>conn</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>da</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> system.Data.Odbc.OdbcDataAdapter<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>dt</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> system.Data.datatable
</span><span class="z-source z-powershell"><span class="z-constant z-language z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>null</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>da<span class="z-variable z-other z-member z-powershell">.fill</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>dt</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>conn<span class="z-variable z-other z-member z-powershell">.close</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>dt</span>
</span></code></pre><h1 id=postgresql><a aria-label="Anchor link for: postgresql" class=zola-anchor href=#postgresql><i class=icon></i></a> PostgreSQL</h1><h3 id=odbc-driver><a aria-label="Anchor link for: odbc-driver" class=zola-anchor href=#odbc-driver><i class=icon></i></a> ODBC Driver</h3><p><a href=https://www.postgresql.org/ftp/odbc/versions/msi/>Скачать и установить драйвер</a><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>dbServer</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>192.168.3.101<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>port</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>5432<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>dbName</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>test<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>dbUser</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>admin<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>dbPass</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>admin<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>szConnect</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Driver={PostgreSQL Unicode(x64)};Server=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>dbServer</span>;Port=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>port</span>;Database=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>dbName</span>;Uid=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>dbUser</span>;Pwd=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>dbPass</span>;<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> 
</span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cnDB</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> System.Data.Odbc.OdbcConnection<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>szConnect</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>dsDB</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> System.Data.DataSet
</span><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">try</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cnDB<span class="z-variable z-other z-member z-powershell">.Open</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>adDB</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> System.Data.Odbc.OdbcDataAdapter
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>adDB<span class="z-variable z-other z-member z-powershell">.SelectCommand</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> System.Data.Odbc.OdbcCommand<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>SELECT id, name, age, login FROM public.users<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cnDB</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>adDB<span class="z-variable z-other z-member z-powershell">.Fill</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>dsDB</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cnDB<span class="z-variable z-other z-member z-powershell">.Close</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">catch</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">System.Data.Odbc.OdbcException</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-support z-variable z-automatic z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>_<span class="z-variable z-other z-member z-powershell">.Exception</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-support z-variable z-automatic z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>_<span class="z-variable z-other z-member z-powershell">.Exception.Message</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-support z-variable z-automatic z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>_<span class="z-variable z-other z-member z-powershell">.Exception.ItemName</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">foreach</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>row</span> <span class="z-keyword z-control z-powershell">in</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>dsDB</span><span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-constant z-numeric z-integer z-powershell">0</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>.Tables<span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-constant z-numeric z-integer z-powershell">0</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>.Rows</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>row<span class="z-variable z-other z-member z-powershell">.login</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>row<span class="z-variable z-other z-member z-powershell">.age</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></code></pre><h3 id=npgsql><a aria-label="Anchor link for: npgsql" class=zola-anchor href=#npgsql><i class=icon></i></a> npgsql</h3><p><a href=https://github.com/npgsql/npgsql>Source</a> <br> <a href=https://www.nuget.org/packages/Npgsql.EntityFrameworkCore.PostgreSQL>Package</a><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Подключаем сборку Npgsql<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Add-Type</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Path <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Documents\Npgsql.PostgreSQL\8.0.4\net8.0\Npgsql.EntityFrameworkCore.PostgreSQL.dll<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Определяем строку подключения к базе данных PostgreSQL<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>connString</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Host=myserver;Username=mylogin;Password=mypass;Database=mydatabase<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Создаем объект подключения<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>conn</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> Npgsql.NpgsqlConnection<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>connString</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Открываем соединение с базой данных<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>conn<span class="z-variable z-other z-member z-powershell">.Open</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">try</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Создаем SQL команду<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>conn<span class="z-variable z-other z-member z-powershell">.CreateCommand</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd<span class="z-variable z-other z-member z-powershell">.CommandText</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>INSERT INTO data (some_field) VALUES (@p)<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Добавляем параметр и его значение<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>param</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd<span class="z-variable z-other z-member z-powershell">.Parameters.Add</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>p<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">NpgsqlTypes.NpgsqlDbType</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::Text</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>param<span class="z-variable z-other z-member z-powershell">.Value</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Hello world<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Выполняем команду<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd<span class="z-variable z-other z-member z-powershell">.ExecuteNonQuery</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-support z-function z-powershell">Out-Null</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span> <span class="z-keyword z-control z-powershell">finally</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd<span class="z-variable z-other z-member z-powershell">.Dispose</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Извлекаем все строки из таблицы<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">try</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Создаем команду SQL для извлечения данных<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>conn<span class="z-variable z-other z-member z-powershell">.CreateCommand</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd<span class="z-variable z-other z-member z-powershell">.CommandText</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>SELECT some_field FROM data<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Выполняем команду и получаем объект чтения данных<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>reader</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd<span class="z-variable z-other z-member z-powershell">.ExecuteReader</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Читаем и выводим данные построчно<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-keyword z-control z-powershell">while</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>reader<span class="z-variable z-other z-member z-powershell">.Read</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-support z-function z-powershell">Write-Host</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>reader<span class="z-variable z-other z-member z-powershell">.GetString</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-constant z-numeric z-integer z-powershell">0</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span> <span class="z-keyword z-control z-powershell">finally</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Освобождаем ресурсы чтения данных и команды<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>reader<span class="z-variable z-other z-member z-powershell">.Dispose</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd<span class="z-variable z-other z-member z-powershell">.Dispose</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Закрываем соединение с базой данных<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>conn<span class="z-variable z-other z-member z-powershell">.Close</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>conn<span class="z-variable z-other z-member z-powershell">.Dispose</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></code></pre><span class=hidden id=copy-code-text>Copy Code</span><span class=hidden id=search-index>https://lifailon.github.io/search_index.en.json</span><span class=hidden id=more-matches-text>$MATCHES more matches</span></main><footer id=site-footer><nav><ul><li><a href=https://lifailon.github.io/powershell/>PowerShell</a><li><a href=https://lifailon.github.io/linux/>Linux</a><li><a href=https://lifailon.github.io/golang/>GoLang</a><li><a href=https://lifailon.github.io/node-js/>Node.js</a><li><a href=https://lifailon.github.io/docker/>Docker</a><li><a href=https://lifailon.github.io/network/>Network</a><li><a href=https://lifailon.github.io/windowsserver/>Windows Server</a><li><a class=active href=https://lifailon.github.io/database/>Database</a><li><a href=https://lifailon.github.io/api/>API</a><li><a href=https://lifailon.github.io/jenkins/>Jenkins</a><li><a href=https://lifailon.github.io/devops/>DevOps</a></ul></nav><p>© <strong>2023-2025</strong> <code>Lifailon</code><p><a class=external href=https://github.com/Lifailon/PS-Commands>Website source</a><p><small>Powered by <a class="link external" href=https://www.getzola.org>Zola</a> and <a class="link external" href=https://duckquill.daudix.one>Duckquill</a> </small><ul id=socials><li><a rel=" me" href=https://github.com/lifailon/PS-Commands title=GitHub> <i style="--icon:url(&#34data:image/svg+xml,%3Csvg role='img' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Ctitle%3EGitHub%3C/title%3E%3Cpath d='M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12'/%3E%3C/svg%3E&#34)" class=icon></i> <span>GitHub</span> </a><li><a rel=" me" href=https://www.nuget.org/profiles/Lifailon title=NuGet> <i style="--icon:url(&#34data:image/svg+xml,%3Csvg role='img' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Ctitle%3ENUGet%3C/title%3E%3Cpath d='M1.57 0A1.57 1.57 0 000 1.57v20.86A1.57 1.57 0 001.57 24h20.86A1.57 1.57 0 0024 22.43V1.57A1.57 1.57 0 0022.43 0zM7.5 1.5A2.5 2.5 0 0110 4a2.5 2.5 0 01-2.5 2.5A2.5 2.5 0 015 4a2.5 2.5 0 012.5-2.5zM12 6h9v12h-1.5a3.76 3.76 0 00-2.81-1.25A3.76 3.76 0 0012.5 20a3.76 3.76 0 002.19 3.25A3.76 3.76 0 0018.5 24H21V6z'/%3E%3C/svg%3E&#34)" class=icon></i> <span>NuGet</span> </a><li><a rel=" me" href=https://www.npmjs.com/~lifailon title=NPM> <i style="--icon:url(&#34data:image/svg+xml,%3Csvg role='img' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Ctitle%3ENPM%3C/title%3E%3Cpath d='M0 0v24h24V0zm14.74 14.74h-3.66v-5.5h-1.83v5.5H5.5V5.5h9.24z'/%3E%3C/svg%3E&#34)" class=icon></i> <span>NPM</span> </a><li><a rel=" me" title="Docker Hub" href=https://hub.docker.com/u/lifailon> <i style="--icon:url(&#34data:image/svg+xml,%3Csvg role='img' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Ctitle%3EDocker%3C/title%3E%3Cpath d='M22.149 10.74c-.111-.086-1.15-.86-3.3-.86-.26.002-.52.017-.78.045-.24-1.35-1.32-1.8-1.35-1.81l-.45-.17-.3.42c-.17.24-.65.88-.65 1.76.001.29.04.58.12.86-.66.19-1.3.35-1.95.48a9.72 9.72 0 0 1-1.95.22H.75c-.41 0-.75.34-.75.75 0 4.42 2.4 5.98 4.41 6.68.9.28 1.91.42 3.01.42 1.08 0 2.11-.14 3.01-.42 1.98-.61 3.51-2.01 4.14-4.01.34.04.68.07 1.02.07 1.35 0 2.61-.35 3.72-1.04 1.64-1.01 1.87-2.23 1.87-2.92.01-.96-.34-1.68-.35-1.7zM6.75 8.22h2.25c.14 0 .25-.11.25-.25V6.47c0-.14-.11-.25-.25-.25H6.75c-.14 0-.25.11-.25.25v1.5c0 .14.11.25.25.25zM12 8.22h2.25c.14 0 .25-.11.25-.25V6.47c0-.14-.11-.25-.25-.25H12c-.14 0-.25.11-.25.25v1.5c0 .14.11.25.25.25zM9.375 6.72h-2.25c-.14 0-.25.11-.25.25v1.5c0 .14.11.25.25.25h2.25c.14 0 .25-.11.25-.25v-1.5c0-.14-.11-.25-.25-.25zM12 5.47h-2.25c-.14 0-.25.11-.25.25v1.5c0 .14.11.25.25.25H12c.14 0 .25-.11.25-.25v-1.5c0-.14-.11-.25-.25-.25z'/%3E%3C/svg%3E&#34)" class=icon></i> <span>Docker Hub</span> </a></ul></footer>