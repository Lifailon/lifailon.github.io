<!DOCTYPE html>
<html lang="en-us">
    <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="generator" content="Hugo 0.123.8">

    

    

    
        
            <meta
                name="description"
                content="This is my new hugo site" />
        

        
            <meta
                name="keywords"
                content="hugo,site,new" />
        

        
            <meta name="author" content="Lifailon" />
        

    


    <title>
        
            PowerShell |
            Lifailon.GitHub.io
        
    </title>

    


    
    

    
    


    
    


    
    


    
    

    


    
    

    

    

        
        


        
        


        <link
            rel="stylesheet"
            href="/css/index_d751713.min.912d03bce61461ecbc3ca083479e1ed814bba94df76d0bdc6aa88fdca33621b9bb410dc2c81af31e8101fec62decfa5f6e48901ad673bc5056d2f1d1f2368a34.css"
            integrity="sha512-kS0DvOYUYey8PKCDR54e2BS7qU33bQvcaqiP3KM2Ibm7QQ3CyBrzHoEB/sYt7PpfbkiQGtZzvFBW0vHR8jaKNA==" />
    


    
    

    

    

    

    
</head>



    <body>
        <header class="header">
    <div class="header_left">
        
    </div>

    <div class="header_middle">
        
            PowerShell -
            Lifailon.GitHub.io
        
    </div>
</header>



        <main>
            <aside class="sidebar">
    



    
    

    
    


    <ul class="section-tree">
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/github/" title="./github/">
                        GitHub
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/powershell/" title="./powershell/">
                        PowerShell
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/dotnet/" title="./dotnet/">
                        .NET
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/activedirectory/" title="./activedirectory/">
                        Active Directory
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/ansible/" title="./ansible/">
                        Ansible
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/api/" title="./api/">
                        API
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/apps/" title="./apps/">
                        Apps
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/com/" title="./com/">
                        Component Object Model
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/git/" title="./git/">
                        Git
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/html/" title="./html/">
                        HTML
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/influxdb/" title="./influxdb/">
                        InfluxDB
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/exchange/" title="./exchange/">
                        MS Exchange
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/mssql/" title="./mssql/">
                        MS SQL
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/mysql/" title="./mysql/">
                        MySQL
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/network/" title="./network/">
                        Network
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/virtualization/" title="./virtualization/">
                        Virtualization
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/wmi/" title="./wmi/">
                        WMI
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/zabbix/" title="./zabbix/">
                        Zabbix
                    </a>
                </li>
            
        
    </ul>


</aside>
<aside class="exapandable"></aside>


            
    <article class="main">
        <button
    class="sidebar-toggle-btn"
    type="menu"
    aria-expanded="false"
    aria-haspopup="true">
    <i class="bi bi-list"></i>
</button>



        <div class="title">
            <h1 class="title-header">
                PowerShell
            </h1>

            <div class="author-date-readtime">
                

                    
                        <div class="author" title="Author">
                            <i class="bi bi-person"></i>
                            <a
                                href="/author/lifailon/"
                                class="cat-btn">
                                Lifailon
                            </a>
                        </div>
                    

                

                
                    <div class="date" title="Date">
                        <i class="bi bi-calendar3"></i>
                        <time
                            datetime="Mar 14 2024"
                            >Mar 14 2024
                        </time>
                    </div>
                

                
                    <div
                        class="readtime"
                        title="Time to Read">
                        <i class="bi bi-clock"></i>
                        34 mins to read
                    </div>
                
            </div>
        </div>

        <div class="article-meta">
            

            

            
                <div class="breadcumb">
                    <i class="bi bi-folder"></i>
                    
    




<a href="https://lifailon.github.io/" class="bread-btn">
    
        <i class="bi bi-house-fill"></i>
    

    
        Home
    
</a>




    /



<a href="https://lifailon.github.io/powershell/" class="bread-btn">
    

    
        PowerShell
    
</a>

                </div>
            

            
        </div>

        
            <nav id="TableOfContents">
  <ul>
    <li><a href="#help">Help</a></li>
    <li><a href="#object">Object</a>
      <ul>
        <li><a href="#variable">Variable</a></li>
        <li><a href="#env">ENV</a></li>
        <li><a href="#history">History</a></li>
        <li><a href="#clipboard">Clipboard</a></li>
        <li><a href="#write">Write</a></li>
        <li><a href="#array">Array</a></li>
        <li><a href="#index">Index</a></li>
        <li><a href="#hashtable">HashTable</a></li>
        <li><a href="#collectionslist">Collections/List</a></li>
        <li><a href="#pscustomobject">PSCustomObject</a></li>
        <li><a href="#add-member">Add-Member</a></li>
        <li><a href="#class">Class</a></li>
        <li><a href="#pipeline">Pipeline</a></li>
        <li><a href="#select-object">Select-Object</a></li>
        <li><a href="#expression">Expression</a></li>
        <li><a href="#select-string">Select-String</a></li>
        <li><a href="#format-tableformat-list">Format-Table/Format-List</a></li>
        <li><a href="#measure-object">Measure-Object</a></li>
        <li><a href="#compare-object">Compare-Object</a></li>
        <li><a href="#where-object-">Where-Object (?)</a></li>
        <li><a href="#sort-object">Sort-Object</a></li>
        <li><a href="#lastfirst">Last/First</a></li>
        <li><a href="#group-object">Group-Object</a></li>
        <li><a href="#error">Error</a></li>
        <li><a href="#property">Property</a></li>
        <li><a href="#method">Method</a></li>
        <li><a href="#datetime">DateTime</a></li>
        <li><a href="#measure-command">Measure-Command</a></li>
        <li><a href="#timer">Timer</a></li>
      </ul>
    </li>
    <li><a href="#npp">npp</a></li>
    <li><a href="#regex">Regex</a>
      <ul>
        <li><a href="#matches">Matches</a></li>
        <li><a href="#форматирование-net-method-format">Форматирование (.NET method format)</a></li>
        <li><a href="#условный-оператор">Условный оператор</a></li>
        <li><a href="#операторы">Операторы</a></li>
        <li><a href="#pipeline-operators">Pipeline Operators</a></li>
        <li><a href="#invocation-operator">Invocation Operator</a></li>
        <li><a href="#специальные-символы">Специальные символы</a></li>
        <li><a href="#якори">Якори</a></li>
        <li><a href="#группы-захвата">Группы захвата</a></li>
      </ul>
    </li>
    <li><a href="#datatype">DataType</a>
      <ul>
        <li><a href="#math">Math</a></li>
        <li><a href="#round">Round</a></li>
        <li><a href="#tostring">ToString</a></li>
        <li><a href="#char">Char</a></li>
      </ul>
    </li>
    <li><a href="#module">Module</a>
      <ul>
        <li><a href="#psd1">psd1</a></li>
        <li><a href="#psm1">psm1</a></li>
        <li><a href="#switch">Switch</a></li>
        <li><a href="#function-switch">function switch</a></li>
      </ul>
    </li>
    <li><a href="#bit">Bit</a>
      <ul>
        <li><a href="#bit-convertor">Bit Convertor</a></li>
      </ul>
    </li>
    <li><a href="#cycle">Cycle</a>
      <ul>
        <li><a href="#foreach">Foreach</a></li>
        <li><a href="#foreach-object-">ForEach-Object (%)</a></li>
        <li><a href="#while">While</a></li>
        <li><a href="#try-catch-finally">Try-Catch-Finally</a></li>
      </ul>
    </li>
    <li><a href="#files">Files</a>
      <ul>
        <li><a href="#readwrite-bytes">Read/Write Bytes</a></li>
        <li><a href="#clear-env-temp-14-days">Clear-env-Temp-14-days</a></li>
        <li><a href="#filehash">Filehash</a></li>
        <li><a href="#microsoftpowershellarchive">Microsoft.PowerShell.Archive</a></li>
      </ul>
    </li>
    <li><a href="#credential">Credential</a>
      <ul>
        <li><a href="#out-gridview">Out-Gridview</a></li>
        <li><a href="#out-file">Out-File</a></li>
        <li><a href="#get-content-gccattype">Get-Content (gc/cat/type)</a></li>
        <li><a href="#aes-key">AES Key</a></li>
      </ul>
    </li>
    <li><a href="#winevent">WinEvent</a>
      <ul>
        <li><a href="#filter-xpathhashtable">Filter XPath/Hashtable</a></li>
        <li><a href="#reboot">Reboot</a></li>
        <li><a href="#logon">Logon</a></li>
        <li><a href="#eventlog">EventLog</a></li>
      </ul>
    </li>
    <li><a href="#defender">Defender</a></li>
    <li><a href="#windowsupdate">WindowsUpdate</a></li>
    <li><a href="#dism">DISM</a></li>
    <li><a href="#scheduled">Scheduled</a></li>
    <li><a href="#shutdown">shutdown</a></li>
    <li><a href="#localaccounts">LocalAccounts</a></li>
    <li><a href="#smb">SMB</a>
      <ul>
        <li><a href="#get-acl">Get-Acl</a></li>
        <li><a href="#ntfssecurity">NTFSSecurity</a></li>
        <li><a href="#storage">Storage</a></li>
        <li><a href="#iscsi">iSCSI</a></li>
      </ul>
    </li>
    <li><a href="#ps2exe">PS2EXE</a></li>
    <li><a href="#nssm">NSSM</a></li>
    <li><a href="#jobs">Jobs</a>
      <ul>
        <li><a href="#threadjob">ThreadJob</a></li>
        <li><a href="#poshrsjob">PoshRSJob</a></li>
      </ul>
    </li>
    <li><a href="#regedit">Regedit</a></li>
    <li><a href="#performance">Performance</a></li>
    <li><a href="#dsc">DSC</a></li>
    <li><a href="#oh-my-posh">oh-my-posh</a>
      <ul>
        <li><a href="#themes-performance">themes-performance</a></li>
        <li><a href="#terminal-icons">Terminal-Icons</a></li>
      </ul>
    </li>
    <li><a href="#pester">Pester</a></li>
  </ul>
</nav>
        


        <div class="content">
            
                <h2 id="help">Help</h2>
<p><code>Get-Verb</code> действия/глаголы, утвержденные для использования в командлетах <br>
<code>Get-Command *Language*</code> поиск команды по имени <br>
<code>(Get-Command Get-Language).Module</code> узнать к какому модулю принадлежит команда <br>
<code>Get-Command Get-Content | fl Module,DLL</code> узнать принадлежность команды к модулю и dll <br>
<code>Get-Command -Module LanguagePackManagement</code> отобразить список команд указанного модуля <br>
<code>(Get-Module LanguagePackManagement).ExportedCommands.Values</code> отобразить список команд указанного модуля <br>
<code>Get-Language | Get-Member</code> отобразить список методов команды (действия), объекты вывода и Event (события объектов: Click) <br>
<code>(Get-Help Get-Service).Aliases</code> узнать псевдонимом команды <br>
<code>Get-Alias gsv</code> узнать имя команды по псевдониму <br>
<code>Get-Help Get-Service</code> синтаксис <br>
<code>Get-Help Get-Service -Parameter *</code> описание всех параметров <br>
<code>Get-Help Get-Service -Online</code> <br>
<code>Get-Help Get-Service -ShowWindow</code> описание параметров в GUI с фильтрацией <br>
<code>Show-Command</code> вывести список команд в GUI <br>
<code>Show-Command Get-Service</code> список параметров команды в GUI <br>
<code>Invoke-Expression</code> iex принимает текст для выполнения в консоли как команды <br>
<code>$PSVersionTable</code> версия PowerShell <br>
<code>Set-ExecutionPolicy Unrestricted</code> <br>
<code>Get-ExecutionPolicy</code> <br>
<code>$Metadata = New-Object System.Management.Automation.CommandMetaData (Get-Command Get-Service)</code> получить информацию о командлете <br>
<code>[System.Management.Automation.ProxyCommand]::Create($Metadata)</code> исходный код функции</p>
<h2 id="object">Object</h2>
<h3 id="variable">Variable</h3>
<p><code>$var = Read-Host &quot;Enter&quot;</code> ручной ввод <br>
<code>$pass = Read-Host &quot;Enter Password&quot; -AsSecureString</code> скрывать набор <br>
<code>$global:path = &quot;\\path&quot;</code> задать глобальную переменную, например в функции <br>
<code>$using:srv</code> использовать переменную текущей сесси в Invoke-сессии <br>
<code>Get-Variable</code> отобразить все переменные <br>
<code>ls variable:/</code> отобразить все переменные <br>
<code>Get-Variable *srv*</code> найти переменную по имени <br>
<code>Get-Variable -Scope Global</code> отобразить все глобальные переменные <br>
<code>Get-Variable Error</code> последняя команда с ошибкой <br>
<code>Remove-Variable -Name *</code> очистить все переменные <br>
<code>$LASTEXITCODE</code> содержит код вывода последней запущенной программы, например ping. Если код возврата положительный (True), то $LastExitCode = 0</p>
<h3 id="env">ENV</h3>
<p><code>Get-ChildItem Env:</code> отобразить все переменные окружения <br>
<code>$env:PSModulePath</code> директории импорта модулей <br>
<code>$env:userprofile</code> <br>
<code>$env:computername</code> <br>
<code>$env:username</code> <br>
<code>$env:userdnsdomain</code> <br>
<code>$env:logonserver</code> <br>
<code>([DirectoryServices.ActiveDirectory.Forest]::GetCurrentForest()).Name</code> <br>
<code>[Environment]::GetFolderPath('ApplicationData')</code></p>
<h3 id="history">History</h3>
<p><code>Get-History</code> история команд текущей сессии <br>
<code>(Get-History)[-1].Duration.TotalSeconds</code> время выполнения последней команды <br>
<code>(Get-PSReadLineOption).HistorySavePath</code> путь к сохраненному файлу с 4096 последних команд (из модуля PSReadLine) <br>
<code>Get-Content (Get-PSReadlineOption).HistorySavePath | Select-String Get</code> поиск по содержимому файла (GREP) <br>
<code>Set-PSReadlineOption -MaximumHistoryCount 10000</code> изменить количество сохраняемых команд в файл <br>
<code>Get-PSReadLineOption | select MaximumHistoryCount</code> <br>
<code>Set-PSReadlineOption -HistorySaveStyle SaveNothing</code> отключить ведение журнала <br>
<code>F2</code> переключиться с InlineView на ListView</p>
<h3 id="clipboard">Clipboard</h3>
<p><code>Set-Clipboard $srv</code> скопировать в буфер обмена <br>
<code>Get-Clipboard</code> вставить</p>
<h3 id="write">Write</h3>
<p><code>Write-Host -ForegroundColor Black -BackgroundColor Green &quot;Test&quot; -NoNewline</code> <br>
<code>Write-Error Test</code> <br>
<code>Foreach ($n in 1..100) {Write-Progress -Activity &quot;Test Progress&quot; -PercentComplete $n}</code></p>
<h3 id="array">Array</h3>
<p><code>$srv = @(&quot;server-01&quot;, &quot;server-02&quot;)</code>  создать массив <br>
<code>$srv += @(&quot;server-03&quot;)</code> добавить в массив новый элемент <br>
<code>$srv.Count</code> отобразить кол-во элементов в массиве <br>
<code>Out-String</code> построчный вывод</p>
<h3 id="index">Index</h3>
<p><code>$srv[0]</code> вывести первое значение элемента массива <br>
<code>$srv[0] = Name</code> замена элемента в массиве <br>
<code>$srv[0].Length</code> узнать кол-во символов первого значения в массиве <br>
<code>$srv[10..100]</code> срез</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>$array = <span style="color:#e6db74">&#34;a&#34;</span>,<span style="color:#e6db74">&#34;b&#34;</span>,<span style="color:#e6db74">&#34;c&#34;</span>,<span style="color:#e6db74">&#34;d&#34;</span>
</span></span><span style="display:flex;"><span>$num = <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">foreach</span> ($a <span style="color:#66d9ef">in</span> $array) {
</span></span><span style="display:flex;"><span>$num += <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>$index = [<span style="color:#66d9ef">array</span>]::IndexOf($array, $a) <span style="color:#75715e"># узнать номер индекса по зачению</span>
</span></span><span style="display:flex;"><span>$array[$index] = $num <span style="color:#75715e"># пересобрать исходный массив</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
    
</div>
<h3 id="hashtable">HashTable</h3>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>$hashtable = @{<span style="color:#e6db74">&#34;User&#34;</span> = <span style="color:#e6db74">&#34;</span>$env:username<span style="color:#e6db74">&#34;</span>; <span style="color:#e6db74">&#34;Server&#34;</span> = <span style="color:#e6db74">&#34;</span>$env:computername<span style="color:#e6db74">&#34;</span>} <span style="color:#75715e"># создать</span>
</span></span><span style="display:flex;"><span>$hashtable += @{<span style="color:#e6db74">&#34;User2&#34;</span> = <span style="color:#e6db74">&#34;</span>$env:username<span style="color:#e6db74">&#34;</span>; <span style="color:#e6db74">&#34;Server2&#34;</span> = <span style="color:#e6db74">&#34;</span>$env:computername<span style="color:#e6db74">&#34;</span>} <span style="color:#75715e"># добавить ключи</span>
</span></span><span style="display:flex;"><span>$hashtable.Keys <span style="color:#75715e"># список всех ключей</span>
</span></span><span style="display:flex;"><span>$hashtable[<span style="color:#e6db74">&#34;User&#34;</span>] <span style="color:#75715e"># получить значение (Values) по ключу</span>
</span></span><span style="display:flex;"><span>$hashtable[<span style="color:#e6db74">&#34;User&#34;</span>] = <span style="color:#e6db74">&#34;Test&#34;</span> <span style="color:#75715e"># изменить</span>
</span></span><span style="display:flex;"><span>$hashtable.Remove(<span style="color:#e6db74">&#34;User&#34;</span>) <span style="color:#75715e"># удалить ключ</span></span></span></code></pre></div>
    
</div>
<p><code>$Tag = @{$true = 'dev'; $false = 'prod'}[([System.Net.Dns]::GetHostEntry(&quot;localhost&quot;).HostName) -match '.*.TestDomain$']</code></p>
<h3 id="collectionslist">Collections/List</h3>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>$Collections = New-Object System.Collections.Generic.List[<span style="color:#66d9ef">System.Object</span>]
</span></span><span style="display:flex;"><span>$Collections.Add([<span style="color:#66d9ef">PSCustomObject</span>]@{User = $env:username; Server = $env:computername})</span></span></code></pre></div>
    
</div>
<h3 id="pscustomobject">PSCustomObject</h3>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>$CustomObject = [<span style="color:#66d9ef">PSCustomObject][ordered</span>]@{User = $env:username; Server = $env:computername}
</span></span><span style="display:flex;"><span>$CustomObject | Add-Member <span style="color:#960050;background-color:#1e0010">–</span>MemberType NoteProperty <span style="color:#960050;background-color:#1e0010">–</span>Name Arr <span style="color:#960050;background-color:#1e0010">–</span>Value @(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>) <span style="color:#75715e"># добавить Property (свойство/стобец)</span>
</span></span><span style="display:flex;"><span>$CustomObject.Arr = @(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">5</span>) <span style="color:#75715e"># изменить содержимое</span>
</span></span><span style="display:flex;"><span>$CustomObject.PsObject.Properties.Remove(<span style="color:#e6db74">&#39;User&#39;</span>) <span style="color:#75715e"># удалить Property</span></span></span></code></pre></div>
    
</div>
<h3 id="add-member">Add-Member</h3>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="$ScriptBlock%20=%20%7bGet-Service%7d%0d%0a$CustomObject%20%7c%20Add-Member%20-Name%20%22TestMethod%22%20-MemberType%20ScriptMethod%20-Value%20$ScriptBlock%20#%20%d0%94%d0%be%d0%b1%d0%b0%d0%b2%d0%b8%d1%82%d1%8c%20Method%0d%0a$CustomObject%20%7c%20Get-Member%0d%0a$CustomObject.TestMethod%28%29">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>$ScriptBlock = {Get-Service}
</span></span><span style="display:flex;"><span>$CustomObject | Add-Member -Name <span style="color:#e6db74">&#34;TestMethod&#34;</span> -MemberType ScriptMethod -Value $ScriptBlock <span style="color:#75715e"># Добавить Method</span>
</span></span><span style="display:flex;"><span>$CustomObject | Get-Member
</span></span><span style="display:flex;"><span>$CustomObject.TestMethod()</span></span></code></pre></div>
    
</div>
<h3 id="class">Class</h3>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span><span style="color:#66d9ef">Class</span> CustomClass {
</span></span><span style="display:flex;"><span>[<span style="color:#66d9ef">string</span>]$User
</span></span><span style="display:flex;"><span>[<span style="color:#66d9ef">string</span>]$Server
</span></span><span style="display:flex;"><span>Start([<span style="color:#66d9ef">bool</span>]$Param1) {
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">If</span> ($Param1) {Write-Host <span style="color:#e6db74">&#34;Start Function&#34;</span>}}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$Class = New-Object -TypeName CustomClass
</span></span><span style="display:flex;"><span>$Class.User = $env:username
</span></span><span style="display:flex;"><span>$Class.Server = $env:computername
</span></span><span style="display:flex;"><span>$Class.Start(<span style="color:#ae81ff">1</span>)</span></span></code></pre></div>
    
</div>
<h3 id="pipeline">Pipeline</h3>
<p><code>$obj | Add-Member -MemberType NoteProperty -Name &quot;Type&quot; -Value &quot;user&quot; -Force</code> добавление объкта вывода NoteProperty <br>
<code>$obj | Add-Member -MemberType NoteProperty -Name &quot;User&quot; -Value &quot;admin&quot; -Force</code> изменеие содержимого для сущности объекта User <br>
<code>ping $srv | Out-Null</code> перенаправить результат вывода в Out-Null</p>
<h3 id="select-object">Select-Object</h3>
<p><code>Get-Process | Select-Object -Property *</code> отобразить все доступные объекты вывода <br>
<code>Get-Process | select -Unique &quot;Name&quot;</code> удалить повторяющиеся значения в массиве <br>
<code>Get-Process | select -ExpandProperty ProcessName</code> преобразовать из объекта-коллекции в массив (вывести содержимое без наименовая столбца) <br>
<code>(Get-Process | ? Name -match iperf).Modules</code> список используемых модулей процессом</p>
<h3 id="expression">Expression</h3>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="ps%20%7c%20Sort-Object%20-Descending%20CPU%20%7c%20select%20-first%2010%20ProcessName,%20#%20%d1%81%d0%be%d1%80%d1%82%d0%b8%d1%80%d0%be%d0%b2%d0%ba%d0%b0%20%d0%bf%d0%be%20CPU,%20%d0%b2%d1%8b%d0%b2%d0%b5%d1%81%d1%82%d0%b8%20%d0%bf%d0%b5%d1%80%d0%b2%d1%8b%d1%85%2010%20%d0%b7%d0%bd%d0%b0%d1%87%d0%b5%d0%bd%d0%b8%d0%b9%20%28-first%29%0d%0a@%7bName=%22ProcessorTime%22;%20Expression=%7b$_.TotalProcessorTime%20-replace%20%22%5c.%5cd&#43;$%22%7d%7d,%20#%20%d0%b7%d0%b0%d1%82%d1%80%d0%b0%d1%87%d0%b5%d0%bd%d0%be%20%d0%bf%d1%80%d0%be%d1%86%d0%b5%d1%81%d1%81%d0%be%d1%80%d0%bd%d0%be%d0%b3%d0%be%20%d0%b2%d1%80%d0%b5%d0%bc%d0%b5%d0%bd%d0%b8%20%d0%b2%20%d0%bc%d0%b8%d0%bd%d1%83%d1%82%d0%b0%d1%85%0d%0a@%7bName=%22Memory%22;%20Expression=%7b[string]%28[int]%28$_.WS%20/%201024kb%29%29&#43;%22MB%22%7d%7d,%20#%20%d0%b4%d0%b5%d0%bb%d0%b8%d0%bc%20%d0%b1%d0%b0%d0%b9%d1%82%d1%8b%20%d0%bd%d0%b0%20%d0%9a%d0%91%0d%0a@%7bLabel=%22RunTime%22;%20Expression=%7b%28%28Get-Date%29%20-%20$_.StartTime%29%20-replace%20%22%5c.%5cd&#43;$%22%7d%7d%20#%20%d0%b2%d1%8b%d1%87%d0%b5%d1%81%d1%82%d1%8c%20%d0%b8%d0%b7%20%d1%82%d0%b5%d0%ba%d1%83%d1%89%d0%b5%d0%b3%d0%be%20%d0%b2%d1%80%d0%b5%d0%bc%d0%b5%d0%bd%d0%b8%20-%20%d0%b2%d1%80%d0%b5%d0%bc%d1%8f%20%d0%b7%d0%b0%d0%bf%d1%83%d1%81%d0%ba%d0%b0,%20%d0%b8%20%d1%83%d0%b4%d0%b0%d0%bb%d0%b8%d1%82%d1%8c%20milisec">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>ps | Sort-Object -Descending CPU | select -first <span style="color:#ae81ff">10</span> ProcessName, <span style="color:#75715e"># сортировка по CPU, вывести первых 10 значений (-first)</span>
</span></span><span style="display:flex;"><span>@{Name=<span style="color:#e6db74">&#34;ProcessorTime&#34;</span>; Expression={$_.TotalProcessorTime <span style="color:#f92672">-replace</span> <span style="color:#e6db74">&#34;\.\d+$&#34;</span>}}, <span style="color:#75715e"># затрачено процессорного времени в минутах</span>
</span></span><span style="display:flex;"><span>@{Name=<span style="color:#e6db74">&#34;Memory&#34;</span>; Expression={[<span style="color:#66d9ef">string</span>]([<span style="color:#66d9ef">int</span>]($_.WS / <span style="color:#ae81ff">1024</span>kb))+<span style="color:#e6db74">&#34;MB&#34;</span>}}, <span style="color:#75715e"># делим байты на КБ</span>
</span></span><span style="display:flex;"><span>@{Label=<span style="color:#e6db74">&#34;RunTime&#34;</span>; Expression={((Get-Date) - $_.StartTime) <span style="color:#f92672">-replace</span> <span style="color:#e6db74">&#34;\.\d+$&#34;</span>}} <span style="color:#75715e"># вычесть из текущего времени - время запуска, и удалить milisec</span></span></span></code></pre></div>
    
</div>
<h3 id="select-string">Select-String</h3>
<p><code>$(ipconfig | Select-String IPv4) -replace &quot;.+: &quot; | Where-Object {$_ -match &quot;^172.&quot;}</code> узнать только IP <br>
<code>$Current_IP = Get-Content $RDCMan_RDG_PATH | Select-String $RDCMan_Display_Name -Context 0,1</code> получить две строки <br>
<code>$Current_IP = $Current_IP.Context.DisplayPostContext[0] -replace &quot;.+&lt;name&gt;|&lt;\/name&gt;&quot;</code> забрать только вторую строку и удалить тэги</p>
<h3 id="format-tableformat-list">Format-Table/Format-List</h3>
<p><code>Get-Process | ft ProcessName, StartTime -Autosize</code> автоматическая группировка размера столбцов</p>
<h3 id="measure-object">Measure-Object</h3>
<p><code>Get-Process | Measure | select Count</code> кол-во объектов <br>
<code>Get-Process | Measure -Line -Word -Character</code> кол-во строк, слов и Char объектов <br>
<code>Get-Process | Measure-Object PM -sum | Select-Object Count,@{Name=&quot;MEM_MB&quot;; Expression={[int]($_.Sum/1mb)}}</code> кол-во процессов и общий объем занятой памяти в МБайт</p>
<h3 id="compare-object">Compare-Object</h3>
<p><code>Compare-Object -ReferenceObject (Get-Content -Path .\file1.txt) -DifferenceObject (Get-Content -Path .\file2.txt)</code> сравнение двух файлов <br>
<code>$group1 = Get-ADGroupMember -Identity &quot;Domain Admins&quot;</code> <br>
<code>$group2 = Get-ADGroupMember -Identity &quot;Enterprise Admins&quot;</code> <br>
<code>Compare-Object -ReferenceObject $group1 -DifferenceObject $group2 -IncludeEqual</code>
<code>==</code> нет изменений <br>
<code>&lt;=</code> есть изменения в $group1 <br>
<code>=&gt;</code> есть изменения в $group2</p>
<h3 id="where-object-">Where-Object (?)</h3>
<p><code>Get-Process | Where-Object {$_.ProcessName -match &quot;zabbix&quot;}</code> фильтрация/поиск процессов по имени свойства объекта <br>
<code>Get-Process | where CPU -gt 10 | Sort-Object -Descending CPU</code> вывести объекты, где значения CPU больше 10 <br>
<code>Get-Process | where WS -gt 200MB</code> отобразить процессы где WS выше 200МБ <br>
<code>Get-Service | where Name -match &quot;zabbix&quot;</code> поиск службы <br>
<code>Get-Service -ComputerName $srv | Where {$_.Name -match &quot;WinRM&quot;} | Restart-Service</code> перезапустить службу на удаленном компьютере <br>
<code>(Get-Service).DisplayName</code> вывести значения свойства массива <br>
<code>netstat -an | where {$_ -match 443}</code> <br>
<code>netstat -an | ?{$_ -match 443}</code> <br>
<code>(netstat -an) -match 443</code></p>
<h3 id="sort-object">Sort-Object</h3>
<p><code>Get-Process | Sort-Object -Descending CPU | ft</code> обратная (-Descending) сортировка по CPU <br>
<code>$path[-1..-10]</code> обратная сборка массива без сортировки</p>
<h3 id="lastfirst">Last/First</h3>
<p><code>Get-Process | Sort-Object -Descending CPU | select -First 10</code> вывести первых 10 объектов <br>
<code>Get-Process | Sort-Object -Descending CPU | select -Last 10</code> вывести последних 10 объектов</p>
<h3 id="group-object">Group-Object</h3>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="$Groups%20=%20Get-CimInstance%20-Class%20Win32_PnPSignedDriver%20%7c%0d%0aSelect-Object%20DriverProviderName,%20FriendlyName,%20Description,%20DriverVersion,%20DriverDate%20%7c%0d%0aGroup-Object%20DriverProviderName,%20FriendlyName,%20Description,%20DriverVersion,%20DriverDate%0d%0a$%28foreach%20%28$Group%20in%20$Groups%29%20%7b%0d%0a%20%20%20%20$Group.Group[0]%0d%0a%7d%29%20%7c%20Format-Table">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>$Groups = Get-CimInstance -Class Win32_PnPSignedDriver |
</span></span><span style="display:flex;"><span>Select-Object DriverProviderName, FriendlyName, Description, DriverVersion, DriverDate |
</span></span><span style="display:flex;"><span>Group-Object DriverProviderName, FriendlyName, Description, DriverVersion, DriverDate
</span></span><span style="display:flex;"><span>$(<span style="color:#66d9ef">foreach</span> ($Group <span style="color:#66d9ef">in</span> $Groups) {
</span></span><span style="display:flex;"><span>    $Group.Group[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>}) | Format-Table</span></span></code></pre></div>
    
</div>
<h3 id="error">Error</h3>
<p><code>$Error</code> выводит все ошибки текущего сеанса <br>
<code>$Error[0].InvocationInfo</code> развернутый отчет об ошибке <br>
<code>$Error.clear()</code> <br>
<code>$LASTEXITCODE</code> результат выполнения последней команды (0 - успех) <br>
<code>exit 1</code> код завершения, который возвращается $LASTEXITCODE</p>
<h3 id="property">Property</h3>
<p><code>$srv.Count</code> кол-во элементов в массиве <br>
<code>$srv.Length</code> содержит количество символом строки переменной [string] или количество значений (строк) объекта <br>
<code>$srv.Chars(2)</code> отобразить 3-й символ в строке <br>
<code>$srv[2]</code> отобразить 3-ю строку в массиве</p>
<h3 id="method">Method</h3>
<p><code>$srv.Insert(0,&quot;https://&quot;)</code> добавить значение перед первым символом <br>
<code>$srv.Substring(4)</code> удалить (из всего массива) первые 4 символа <br>
<code>$srv.Remove(3)</code> удалить из всего массива все после 3 символа <br>
<code>$string = &quot;123&quot;</code> создать строку <br>
<code>$int = [convert]::ToInt32($string)</code> преобразовать строку в тип данных число <br>
<code>[string]::Concat($text,$num)</code> объеденить переменные в одну строку <br>
<code>[string]::Join(&quot;:&quot;,$text,$num)</code> объеденить используя разделитель <br>
<code>[string]::Compare($text,$num,$true)</code> выдает 0 при совпадении или 1/-1 при несовпадении, $true (без учета регистра) или $false (с учетом регистра) <br>
<code>[string]::Equals($text,$num)</code> производит сравнение двух строк и выдает $true при их совпадении или $false при несовпадении <br>
<code>[string]::IsNullOrEmpty($text)</code> проверяет наличие строки, если строка пуста $true, если нет $false <br>
<code>[string]::IsNullOrWhiteSpace($text2)</code> проверяет на наличие только символов пробел, табуляция или символ новой строки</p>
<h3 id="datetime">DateTime</h3>
<p><code>Get-TimeZone</code> часовой пояс <br>
<code>[DateTime]::UtcNow</code> время в формате UTC 0 <br>
<code>(Get-Date).AddHours(-3)</code> <br>
<code>$Date = (Get-Date -Format &quot;dd/MM/yyyy hh:mm:ss&quot;)</code> <br>
<code>$Date = Get-Date -f &quot;dd/MM/yyyy&quot;</code> получаем тип данных [string] <br>
<code>[DateTime]$gDate = Get-Date &quot;$Date&quot;</code> преобразовать в тип [DateTime] <br>
<code>[int32]$days=($fDate-$gDate).Days</code> получить разницу в днях <br>
<code>&quot;5/7/07&quot; -as [DateTime]</code> преобразовать входные данные в тип данных [DateTime] <br>
<code>New-TimeSpan -Start $VBRRP.CreationTimeUTC -End $VBRRP.CompletionTimeUTC</code> получить разницу во времени</p>
<h3 id="measure-command">Measure-Command</h3>
<p><code>(Measure-Command {ping ya.ru}).TotalSeconds</code> узнать только время выполнения <br>
<code>(Get-History)[-1] | select @{Name=&quot;RunTime&quot;; Expression={$_.EndExecutionTime - $_.StartExecutionTime}},ExecutionStatus,CommandLine</code> посчитать время работы последней [-1] (select -Last 1) выполненной команды и узнать ее статус</p>
<h3 id="timer">Timer</h3>
<p><code>$start_time = Get-Date</code> зафиксировать время до выполнения команды <br>
<code>$end_time = Get-Date</code> зафиксировать время по завершению <br>
<code>$time = $end_time - $start_time</code> высчитать время работы скрипта <br>
<code>$min = $time.minutes</code> <br>
<code>$sec = $time.seconds</code> <br>
<code>Write-Host &quot;$min минут $sec секунд&quot;</code> <br>
<code>$timer = [System.Diagnostics.Stopwatch]::StartNew()</code> запустить таймер <br>
<code>$timer.IsRunning</code> статус работы таймера <br>
<code>$timer.Elapsed.TotalSeconds</code> отобразить время с момента запуска (в секундах) <br>
<code>$timer.Stop()</code> остановить таймер</p>
<h2 id="npp">npp</h2>
<p><code>pwsh -NoExit -ExecutionPolicy Unrestricted -WindowStyle Maximized -File &quot;$(FULL_CURRENT_PATH)&quot;</code></p>
<p><code>%AppData%\Notepad++</code> themes/shortcuts.xml \</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="%3c?xml%20version=%221.0%22%20encoding=%22UTF-8%22%20?%3e%0d%0a%3cNotepadPlus%3e%0d%0a%20%20%20%20%3cInternalCommands%20/%3e%0d%0a%20%20%20%20%3cMacros%3e%0d%0a%20%20%20%20%20%20%20%20%3cMacro%20name=%22%60&#43;%5c&#43;&amp;gt;%22%20Ctrl=%22yes%22%20Alt=%22no%22%20Shift=%22no%22%20Key=%22190%22%3e%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20%3cAction%20type=%220%22%20message=%222453%22%20wParam=%220%22%20lParam=%220%22%20sParam=%22%22%20/%3e%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20%3cAction%20type=%221%22%20message=%222170%22%20wParam=%220%22%20lParam=%220%22%20sParam=%22%60%22%20/%3e%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20%3cAction%20type=%220%22%20message=%222451%22%20wParam=%220%22%20lParam=%220%22%20sParam=%22%22%20/%3e%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20%3cAction%20type=%220%22%20message=%222451%22%20wParam=%220%22%20lParam=%220%22%20sParam=%22%22%20/%3e%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20%3cAction%20type=%221%22%20message=%222170%22%20wParam=%220%22%20lParam=%220%22%20sParam=%22%20%22%20/%3e%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20%3cAction%20type=%221%22%20message=%222170%22%20wParam=%220%22%20lParam=%220%22%20sParam=%22%5c%22%20/%3e%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20%3cAction%20type=%220%22%20message=%222300%22%20wParam=%220%22%20lParam=%220%22%20sParam=%22%22%20/%3e%0d%0a%20%20%20%20%20%20%20%20%3c/Macro%3e%0d%0a%20%20%20%20%3c/Macros%3e%0d%0a%20%20%20%20%3cUserDefinedCommands%3e%0d%0a%20%20%20%20%20%20%20%20%3cCommand%20name=%22PowerShell7%22%20Ctrl=%22no%22%20Alt=%22yes%22%20Shift=%22no%22%20Key=%22116%22%3epwsh%20-NoExit%20-ExecutionPolicy%20Unrestricted%20-WindowStyle%20Maximized%20-File%20&amp;quot;$%28FULL_CURRENT_PATH%29&amp;quot;%3c/Command%3e%0d%0a%20%20%20%20%3c/UserDefinedCommands%3e%0d%0a%20%20%20%20%3cPluginCommands%20/%3e%0d%0a%20%20%20%20%3cScintillaKeys%20/%3e%0d%0a%3c/NotepadPlus%3e">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;NotepadPlus&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;InternalCommands</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;Macros&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;Macro</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;`+\+&amp;gt;&#34;</span> <span style="color:#a6e22e">Ctrl=</span><span style="color:#e6db74">&#34;yes&#34;</span> <span style="color:#a6e22e">Alt=</span><span style="color:#e6db74">&#34;no&#34;</span> <span style="color:#a6e22e">Shift=</span><span style="color:#e6db74">&#34;no&#34;</span> <span style="color:#a6e22e">Key=</span><span style="color:#e6db74">&#34;190&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;Action</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#a6e22e">message=</span><span style="color:#e6db74">&#34;2453&#34;</span> <span style="color:#a6e22e">wParam=</span><span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#a6e22e">lParam=</span><span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#a6e22e">sParam=</span><span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;Action</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;1&#34;</span> <span style="color:#a6e22e">message=</span><span style="color:#e6db74">&#34;2170&#34;</span> <span style="color:#a6e22e">wParam=</span><span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#a6e22e">lParam=</span><span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#a6e22e">sParam=</span><span style="color:#e6db74">&#34;`&#34;</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;Action</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#a6e22e">message=</span><span style="color:#e6db74">&#34;2451&#34;</span> <span style="color:#a6e22e">wParam=</span><span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#a6e22e">lParam=</span><span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#a6e22e">sParam=</span><span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;Action</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#a6e22e">message=</span><span style="color:#e6db74">&#34;2451&#34;</span> <span style="color:#a6e22e">wParam=</span><span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#a6e22e">lParam=</span><span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#a6e22e">sParam=</span><span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;Action</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;1&#34;</span> <span style="color:#a6e22e">message=</span><span style="color:#e6db74">&#34;2170&#34;</span> <span style="color:#a6e22e">wParam=</span><span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#a6e22e">lParam=</span><span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#a6e22e">sParam=</span><span style="color:#e6db74">&#34; &#34;</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;Action</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;1&#34;</span> <span style="color:#a6e22e">message=</span><span style="color:#e6db74">&#34;2170&#34;</span> <span style="color:#a6e22e">wParam=</span><span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#a6e22e">lParam=</span><span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#a6e22e">sParam=</span><span style="color:#e6db74">&#34;\&#34;</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;Action</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#a6e22e">message=</span><span style="color:#e6db74">&#34;2300&#34;</span> <span style="color:#a6e22e">wParam=</span><span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#a6e22e">lParam=</span><span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#a6e22e">sParam=</span><span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/Macro&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/Macros&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;UserDefinedCommands&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;Command</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;PowerShell7&#34;</span> <span style="color:#a6e22e">Ctrl=</span><span style="color:#e6db74">&#34;no&#34;</span> <span style="color:#a6e22e">Alt=</span><span style="color:#e6db74">&#34;yes&#34;</span> <span style="color:#a6e22e">Shift=</span><span style="color:#e6db74">&#34;no&#34;</span> <span style="color:#a6e22e">Key=</span><span style="color:#e6db74">&#34;116&#34;</span><span style="color:#f92672">&gt;</span>pwsh -NoExit -ExecutionPolicy Unrestricted -WindowStyle Maximized -File &amp;quot;$(FULL_CURRENT_PATH)&amp;quot;<span style="color:#f92672">&lt;/Command&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/UserDefinedCommands&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;PluginCommands</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;ScintillaKeys</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/NotepadPlus&gt;</span></span></span></code></pre></div>
    
</div>
<p><code>Parsing text to Markdown:</code> <br>
<code>Macros: FnLeft+'+FnRight+FnRight+\s\\+Down</code> <br>
<code>Replace: &quot;# &quot;,&quot;'&quot;</code></p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <pre><code>.		# Обозначает любой символ
\		# Экранирующий символ. Символы которые экранируются: ^, [, ., $, {, *, (, ), \, &#43;, |, ?, &lt;, &gt;
^		# Начало строки
$		# Конец строки
\n		# Новая строка
\d		# Любая цифра
\D		# Не цифра
\w		# Любая буква латиницы, цифра, или знак подчёркивания
\W		# Не латиница, не цифра, не подчёркивание
\s		# Пробел, табуляция, перенос строки
\S		# Не пробел
\b		# Граница слова. Применяется когда нужно выделить, что искомые символы являются словом, а не частью другого слова
\B		# Не граница слова
\&lt;		# Начало слова
\&gt;		# Конец слова
\A		# Начало текста
\Z		# Конец текста
*		# Повторитель. Означает что предшествующий символ может работать 0 и более раз
&#43;		# Количество предшествующего не менее 1-го.
?		# Ограничитель. Не более одного раза
|		# Или. Соединяет несколько вариантов
()		# В круглые скобки заключаются все комбинации с &#34;или&#34; и поиск начала и конца строк
[ ]	 	# В квадратных скобках задаются символы к поиску, например [a-яА-Я], или [0-9]
[^ ]	# Исключает из поиска символы указанные в квадратных скобках
{ }		# В фигурных скобках указывается точное количество вхождений
\d{2}	# Найти две цифры
\d{2,4}	# Найти две или четыре
{4,}	# Найти четыре и более

^\s{1,}#.&#43;` поиск вначале строки комментария и пробел после него 1 или больше и любое кол-во символов</code></pre>
    
</div>
<h2 id="regex">Regex</h2>
<p><code>-replace &quot;1&quot;,&quot;2&quot;</code> замена элементов в индексах массива (везде где присутствует 1, заменить на 2), для удаления используется только первое значение <br>
<code>-split &quot; &quot;</code> преобразовать строку в массив, разделителем указан пробел, которой удаляется ($url.Split(&quot;/&quot;)[-1]) <br>
<code>-join &quot; &quot;</code> преобразовать массив (коллекцию) в единую строку (string), добавить разделителем пробел \</p>
<p><code>-like *txt*</code> поиск по маскам wildcard, выводит значение на экран <br>
<code>-match txt</code> поиска по шаблонам, проверка на соответствие содержимого текста <br>
<code>-match &quot;zabbix|rpc&quot;</code> условия, для поиска по нескольким словам <br>
<code>-NotMatch</code> проверка на отсутствие вхождения \</p>
<h3 id="matches">Matches</h3>
<p><code>$ip = &quot;192.168.10.1&quot;</code> <br>
<code>$ip -match &quot;(\.\d{1,3})\.\d{1,2}&quot;</code> True <br>
<code>$Matches</code> отобразить все подходящие переменные последнего поиска, которые входят и не входят в группы ()</p>
<p><code>$String = &quot;09/14/2017 12:00:27 - mtbill_post_201709141058.txt 7577_Delivered: OK&quot;</code> <br>
<code>$String -Match &quot;.*(?=\.txt)&quot; | Out-Null</code> <br>
<code>$Matches[0][-4..-1] -Join &quot;&quot;</code></p>
<p><code>$string.Substring($string.IndexOf(&quot;.txt&quot;)-4, 4)</code> 2-й вариант (IndexOf)`</p>
<h3 id="форматирование-net-method-format">Форматирование (.NET method format)</h3>
<p><code>[string]::Format(&quot;{1} {0}&quot;,&quot;Index0&quot;,&quot;Index1&quot;)</code> <br>
<code>&quot;{1} {0}&quot; -f &quot;Index0&quot;,&quot;Index1&quot;</code> <br>
<code>&quot;{0:###-##-##}&quot; -f 1234567</code> записать число в другом формате (#) <br>
<code>&quot;{0:0000}&quot; -f 123</code> вывести число в формате не меньше 4 знаков (0123) <br>
<code>&quot;{0:P0}&quot; -f (220/1000)</code> посчитать в процентах (P) <br>
<code>&quot;{0:P}&quot; -f (512MB/1GB)</code> сколько % составляет 512Мб от 1Гб <br>
<code>&quot;{0:0.0%}&quot; -f 0.123</code> умножить на 100%</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>$gp = Get-Process | sort cpu -Descending | select -First <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">foreach</span> ($p <span style="color:#66d9ef">in</span> $gp) {
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;{0} - {1:N2}&#34;</span> <span style="color:#f92672">-f</span> $p.processname, $p.cpu <span style="color:#75715e"># округлить</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
    
</div>
<h3 id="условный-оператор">Условный оператор</h3>
<p><code>$rh = Read-Host</code> <br>
<code>if ($rh -eq 1) {ipconfig} elseif ($rh -eq 2) {getmac} else {hostname}</code> <br>
Если условие if () является истенным ($True), выполнить действие в {} <br>
Если условие if () является ложным ($False), выполнить действие не обязательного оператора else <br>
Условие Elseif идёт после условия if для проверки дополнительных условий перед выполнение оператора else. Оператор, который первый вернет $True, отменит выполнение следующих дополнительных условий <br>
Если передать переменную в условие без оператора, то будет проверяться наличие значения у переменной на $True/$False <br>
<code>if ((tnc $srv -Port 80).TcpTestSucceeded) {&quot;Opened port&quot;} else {&quot;Closed port&quot;}</code></p>
<h3 id="операторы">Операторы</h3>
<p><code>-eq</code> равно (equal) <br>
<code>-ceq</code> учитывать регистр <br>
<code>-ne</code> не равно (not equal) <br>
<code>-gt</code> больше (greater) <br>
<code>-ge</code> больше или равно <br>
<code>-lt</code> меньше (less) <br>
<code>-le</code> меньше или равно <br>
<code>-in</code> проверить на наличие (5 -in @(1,2,3,4,5)) <br>
<code>-NOT</code> логическое НЕТ !(Test-Path $path) <br>
<code>-and</code> логическое И <br>
<code>-or</code> логическое ИЛИ <br>
<code>if ((($1 -eq 1) -and ($2 -eq 2)) -or ($1 -ne 3)) {&quot;$true&quot;} else {&quot;$false&quot;}</code> два условия: (если $1 = 1 и $2 = 2) или $1 не равно 3</p>
<h3 id="pipeline-operators">Pipeline Operators</h3>
<p><code>Write-Output &quot;First&quot; &amp;&amp; Write-Output &quot;Second&quot;</code> две успешные команды выполняются <br>
<code>Write-Error &quot;Bad&quot; &amp;&amp; Write-Output &quot;Second&quot;</code> первая команда завершается ошибкой, из-за чего вторая команда не выполняется <br>
<code>Write-Error &quot;Bad&quot; || Write-Output &quot;Second&quot;</code> первая команда завершается ошибкой, поэтому выполняется вторая команда <br>
<code>Write-Output &quot;First&quot; || Write-Output &quot;Second&quot;</code> первая команда выполнена успешно, поэтому вторая команда не выполняется</p>
<h3 id="invocation-operator">Invocation Operator</h3>
<p><code>$addr = &quot;8.8.8.8&quot;</code> <br>
<code>$ping = &quot;ping&quot;</code> <br>
<code>&amp; $ping $addr</code> запускает текст как команду</p>
<p><code>&amp; $ping $addr &amp;</code> запустить команду в фоне <br>
<code>(Get-Job)[-1] | Receive-Job -Keep</code></p>
<h3 id="специальные-символы">Специальные символы</h3>
<p><code>\d</code> число от 0 до 9 (20-07-2022 эквивалент: &ldquo;\d\d-\d\d-\d\d\d\d&rdquo;) <br>
<code>\D</code> обозначает любой символ, кроме цифры. Удаления всех символов, кроме цифр: [int]$(&ldquo;123 test&rdquo; -replace &ldquo;\D&rdquo;) <br>
<code>\w</code> буква от &ldquo;a&rdquo; до &ldquo;z&rdquo; и от &ldquo;A&rdquo; до &ldquo;Z&rdquo; или число от 0 до 9 <br>
<code>\s</code> пробел, эквивалент: &quot; &quot; <br>
<code>\n</code> новая строка <br>
<code>\b</code> маска, определяет начало и конец целого словосочетания для поиска <br>
<code>.</code> обозначает любой символ, кроме новой строки <br>
<code>\</code> экранирует любой специальны символ (метасимвол). Используется, если нужно указать конкретный символ, вместо специального ({ } [ ] / \ + * . $ ^ | ?) <br>
<code>+</code> повторяется 1 и более раз (\s+) <br>
<code>{1,25}</code> квантификатор, указывает количество повторений символа слева на право (от 1 до 25 раз) <br>
<code>[]</code> поиск совпадения любой буквы, например, [A-z0-9] от A до z и цифры от 0 до 9 (&ldquo;192.168.1.1&rdquo; -match &ldquo;192.1[6-7][0-9]&rdquo;)</p>
<h3 id="якори">Якори</h3>
<p><code>^</code> или <code>\A</code> определяет начало строки. $url -replace &lsquo;^&rsquo;,&lsquo;https:&rsquo;<code>добавить в начало; \</code>$<code>или</code>\Z<code>обозначают конец строки. $ip -replace &quot;\d{1,3}$&quot;,&quot;0&quot; \</code>(?=text)<code>поиск слова слева. Пишем слева на право от искомого (ищет только целые словосочетания) &quot;Server:\s(.{1,30})\s(?=$username)&quot; \</code>(?&lt;=text)<code> поиск слова справа. $in_time -replace &quot;.+(?&lt;=Last)&quot;</code> удалить все до слова Last <br>
<code>(?!text)</code> не совпадает со словом слева <br>
<code>(?&lt;!text)</code> не совпадает со словом справа</p>
<p><code>$test = &quot;string&quot;</code> <br>
<code>$test -replace &quot;.{1}$&quot;</code> удалить любое кол-во символов в конце строки <br>
<code>$test -replace &quot;^.{1}&quot;</code> удалить любое кол-во символов в начале строки \</p>
<h3 id="группы-захвата">Группы захвата</h3>
<p><code>$date = '12.31.2021'</code> <br>
<code>$date -replace '^(\d{2}).(\d{2})','$2.$1'</code> поменять местами <br>
<code>$1</code> содержимое первой группы в скобках <br>
<code>$2</code> содержимое второй группы</p>
<h2 id="datatype">DataType</h2>
<p><code>$srv.GetType()</code> узнать тип данных <br>
<code>$srv -is [string]</code> проверка на соответствие типа данных <br>
<code>$srv -isnot [System.Object]</code> проверка на несоответствие <br>
<code>[Object]</code> массив (BaseType:System.Array) <br>
<code>[DateTime]</code> формат времени (BaseType:System.ValueType) <br>
<code>[Bool]/[Boolean]</code> логическое значение ($True/$False) или 1/0 (1 бит) наличие/отсуствие напряжения <br>
<code>[Byte]</code> 8-битное (1 байт) целое число без знака (0..255) <br>
<code>[Int16]</code> 16-битное знаковое целое число от -32767 до 32767 (тип данных WORD 0..65535) <br>
<code>[Int]</code> 32-битное (4 байта) знаковое целое число от –2147483648 до 2147483647 (DWORD) <br>
<code>[Int64]</code> 64-битное от -9223372036854775808 до 9223372036854775808 (LWORD) <br>
<code>[Decimal]</code> 128-битное десятичное значение от –79228162514264337593543950335 до 79228162514264337593543950335 <br>
<code>[Single]</code> число с плавающей запятой (32-разрядное) <br>
<code>[Double]</code> число с плавающей запятой с двойной точностью (64-разрядное) <br>
<code>[String]</code> неизменяемая строка символов Юникода фиксированной длины (BaseType:System.Object)</p>
<h3 id="math">Math</h3>
<p><code>[math] | Get-Member -Static</code> <br>
<code>[math]::Pow(2,4)</code> 2 в 4 степени <br>
<code>[math]::Truncate(1.8)</code> грубое округление, удаляет дробную часть <br>
<code>[math]::Ceiling(1.8)</code> округляет число в большую сторону до ближайшего целого значения <br>
<code>[math]::Floor(-1.8)</code> округляет число в меньшую сторону <br>
<code>[math]::Min(33,22)</code> возвращает наименьшее значение двух значений <br>
<code>[math]::Max(33,22)</code> возвращает наибольшее значение двух значений</p>
<h3 id="round">Round</h3>
<p><code>[double]::Round(87.5, 0)</code> 88 (нечетное), в .NET по умолчанию используется округление в средней точке ToEven, где *.5 значения округляются до ближайшего четного целого числа. <br>
<code>[double]::Round(88.5, 0)</code> 88 (четное) <br>
<code>[double]::Round(88.5, 0, 1)</code> 89 (округлять в большую сторону) <br>
<code>[double]::Round(1234.56789, 2)</code> округлить до 2 символов после запятой</p>
<h3 id="tostring">ToString</h3>
<p><code>(4164539/1MB).ToString(&quot;0.00&quot;)</code> разделить на дважды на 1024/1024 и округлить до 3,97</p>
<h3 id="char">Char</h3>
<p><code>[Char]</code> cимвол Юникода (16-разрядный) <br>
<code>$char = $srv.ToCharArray()</code> разбить строку [string] на массив [System.Array] из букв \</p>
<h2 id="module">Module</h2>
<h3 id="psd1">psd1</h3>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>@{
</span></span><span style="display:flex;"><span>    RootModule        = <span style="color:#e6db74">&#34;Get-Function.psm1&#34;</span>
</span></span><span style="display:flex;"><span>    ModuleVersion     = <span style="color:#e6db74">&#34;0.1&#34;</span>
</span></span><span style="display:flex;"><span>    Author            = <span style="color:#e6db74">&#34;Lifailon&#34;</span>
</span></span><span style="display:flex;"><span>    CompanyName       = <span style="color:#e6db74">&#34;Open Source Community&#34;</span>
</span></span><span style="display:flex;"><span>    Copyright         = <span style="color:#e6db74">&#34;Apache-2.0&#34;</span>
</span></span><span style="display:flex;"><span>    Description       = <span style="color:#e6db74">&#34;Function example&#34;</span>
</span></span><span style="display:flex;"><span>    PowerShellVersion = <span style="color:#e6db74">&#34;7.2&#34;</span>
</span></span><span style="display:flex;"><span>    PrivateData       = @{
</span></span><span style="display:flex;"><span>        PSData = @{
</span></span><span style="display:flex;"><span>            Tags         = @(<span style="color:#e6db74">&#34;Function&#34;</span>,<span style="color:#e6db74">&#34;Example&#34;</span>)
</span></span><span style="display:flex;"><span>            ProjectUri   = <span style="color:#e6db74">&#34;https://github.com/Lifailon/PS-Commands&#34;</span>
</span></span><span style="display:flex;"><span>            LicenseUri   = <span style="color:#e6db74">&#34;https://github.com/Lifailon/Console-Translate/blob/rsa/LICENSE&#34;</span>
</span></span><span style="display:flex;"><span>            ReleaseNotes = <span style="color:#e6db74">&#34;Second release&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
    
</div>
<h3 id="psm1">psm1</h3>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> Get-Function {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&lt;#
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    .</span><span style="color:#e6db74">SYNOPSIS</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    Описание
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    .</span><span style="color:#e6db74">DESCRIPTION</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    Описание
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    .</span><span style="color:#e6db74">LINK</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    https://github.com/Lifailon/PS-Commands
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    #&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">param</span> (
</span></span><span style="display:flex;"><span>        [Parameter(<span style="color:#a6e22e">Mandatory</span>,<span style="color:#a6e22e">ValueFromPipeline</span>)][<span style="color:#66d9ef">string</span>]$Text,
</span></span><span style="display:flex;"><span>        [ValidateSet(<span style="color:#e6db74">&#34;Test1&#34;</span>,<span style="color:#e6db74">&#34;Test2&#34;</span>)][<span style="color:#66d9ef">string</span>]$Provider = <span style="color:#e6db74">&#34;Test1&#34;</span>,
</span></span><span style="display:flex;"><span>        [ValidateRange(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">3</span>)][<span style="color:#66d9ef">int</span>]$Number = <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>        [<span style="color:#66d9ef">Switch</span>]$Switch
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    Write-Host <span style="color:#66d9ef">Param</span> Text<span style="color:#960050;background-color:#1e0010">:</span> $Text
</span></span><span style="display:flex;"><span>    Write-Host <span style="color:#66d9ef">Param</span> Provider<span style="color:#960050;background-color:#1e0010">:</span> $Provider
</span></span><span style="display:flex;"><span>    Write-Host <span style="color:#66d9ef">Param</span> Number<span style="color:#960050;background-color:#1e0010">:</span> $Number
</span></span><span style="display:flex;"><span>    Write-Host <span style="color:#66d9ef">Param</span> <span style="color:#66d9ef">Switch</span><span style="color:#960050;background-color:#1e0010">:</span> $Switch
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
    
</div>
<p><code>Get-Function Test</code></p>
<h3 id="switch">Switch</h3>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="$MMM%20=%20Get-Date%20-UFormat%20%22%25m%22%0d%0aswitch%28$MMM%29%20%7b%0d%0a%20%20%20%20%2201%22%20%7b$Month%20=%20%27Jan%27%7d%0d%0a%20%20%20%20%2202%22%20%7b$Month%20=%20%27Feb%27%7d%0d%0a%20%20%20%20%2203%22%20%7b$Month%20=%20%27Mar%27%7d%0d%0a%20%20%20%20%2204%22%20%7b$Month%20=%20%27Apr%27%7d%0d%0a%20%20%20%20%2205%22%20%7b$Month%20=%20%27May%27%7d%0d%0a%20%20%20%20%2206%22%20%7b$Month%20=%20%27Jun%27%7d%0d%0a%20%20%20%20%2207%22%20%7b$Month%20=%20%27Jul%27%7d%0d%0a%20%20%20%20%2208%22%20%7b$Month%20=%20%27Aug%27%7d%0d%0a%20%20%20%20%2209%22%20%7b$Month%20=%20%27Sep%27%7d%0d%0a%20%20%20%20%2210%22%20%7b$Month%20=%20%27Oct%27%7d%0d%0a%20%20%20%20%2211%22%20%7b$Month%20=%20%27Nov%27%7d%0d%0a%20%20%20%20%2212%22%20%7b$Month%20=%20%27Dec%27%7d%0d%0a%7d">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>$MMM = Get-Date -UFormat <span style="color:#e6db74">&#34;%m&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">switch</span>($MMM) {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;01&#34;</span> {$Month = <span style="color:#e6db74">&#39;Jan&#39;</span>}
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;02&#34;</span> {$Month = <span style="color:#e6db74">&#39;Feb&#39;</span>}
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;03&#34;</span> {$Month = <span style="color:#e6db74">&#39;Mar&#39;</span>}
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;04&#34;</span> {$Month = <span style="color:#e6db74">&#39;Apr&#39;</span>}
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;05&#34;</span> {$Month = <span style="color:#e6db74">&#39;May&#39;</span>}
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;06&#34;</span> {$Month = <span style="color:#e6db74">&#39;Jun&#39;</span>}
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;07&#34;</span> {$Month = <span style="color:#e6db74">&#39;Jul&#39;</span>}
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;08&#34;</span> {$Month = <span style="color:#e6db74">&#39;Aug&#39;</span>}
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;09&#34;</span> {$Month = <span style="color:#e6db74">&#39;Sep&#39;</span>}
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;10&#34;</span> {$Month = <span style="color:#e6db74">&#39;Oct&#39;</span>}
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;11&#34;</span> {$Month = <span style="color:#e6db74">&#39;Nov&#39;</span>}
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;12&#34;</span> {$Month = <span style="color:#e6db74">&#39;Dec&#39;</span>}
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
    
</div>
<h3 id="function-switch">function switch</h3>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="Function%20fun-switch%20%28%0d%0a%20%20%20%20[switch]$param%0d%0a%29%20%7b%0d%0a%20%20%20%20If%20%28$param%29%20%7b%22yes%22%7d%20else%20%7b%22no%22%7d%0d%0a%7d%0d%0a%0d%0afun-switch%20-param">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span><span style="color:#66d9ef">Function</span> fun-switch (
</span></span><span style="display:flex;"><span>    [<span style="color:#66d9ef">switch</span>]$param
</span></span><span style="display:flex;"><span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">If</span> ($param) {<span style="color:#e6db74">&#34;yes&#34;</span>} <span style="color:#66d9ef">else</span> {<span style="color:#e6db74">&#34;no&#34;</span>}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fun-switch -param</span></span></code></pre></div>
    
</div>
<h2 id="bit">Bit</h2>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <pre><code>Двоичное    Десятичное
1           1
10          2
11          3
100         4
101         5
110         6
111         7
1000        8
1001        9
1010        10
1011        11
1100        12
1101        13
1110        14
1111        15
1 0000      16

Двоичное    Десятичное  Номер разряда
1           1           0
10          2           1
100         4           2
1000        8           3
1 0000      16          4
10 0000     32          5
100 0000    64          6
1000 0000   128         7
1 0000 0000 256         8

Из двоичного =&gt; десятичное (1-й вариант по таблице)
1001 0011 = 1000 0000 &#43; 1 0000 &#43; 10 &#43; 1 = 128 &#43; 16 &#43; 2 &#43; 1 = 147

2-й вариант
7654 3210 (разряды двоичного выражения) = (1*2^7)&#43;(0*2^6)&#43;(0*2^5)&#43;(1*2^4)&#43;(0*2^3)&#43;(0*2^2)&#43;(1*2^1)&#43;(1*2^0) = 147
[math]::Pow(2,7) &#43; [math]::Pow(2,4) &#43; [math]::Pow(2,1) &#43; [math]::Pow(2,0) = 147` исключить 0 и сложить степень

Из десятичного =&gt; двоичное (1-й вариант по таблице)
347 вычесть ближайшие 256 = 91 (&#43; 1 0000 0000 забрать двоичный остаток)
91  - 64  = 27 ближайшее 16 (&#43; 100 0000)
27  - 16  = 11 ближайшее 8 (&#43; 1 0000)
11  - 8   = 3  ближайшее 2 (&#43; 1000)
3   - 2   = 1 (&#43; 10)
1   - 1   = 0 (&#43; 1)
1 0101 1011

2-й вариант
Последовательное деления числа на 2, предворительно забирая остаток для получения четного числа в меньшую сторону
347 - 346 = остаток 1, (347-1)/2 = 173
173 - 172 = остаток 1, (172-1)/2 = 86
86  - 86  = остаток 0, 86/2 = 43
43  - 42  = остаток 1, (43-1)/2 = 21
21  - 20  = остаток 1, (21-1)/2 = 10
10  - 10  = остаток 0, 10/2 = 5
5   - 4   = остаток 1, (5-1)/2 = 2
2   - 2   = остаток 0, 2/2 = 1
1   - 2   = остаток 1, (1-1)/2 = 0
Результат деления записывается снизу вверх</code></pre>
    
</div>
<h3 id="bit-convertor">Bit Convertor</h3>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="function%20ConvertTo-Bit%20%7b%0d%0a%20%20%20%20param%20%28%0d%0a%20%20%20%20%20%20%20%20[Int]$int%0d%0a%20%20%20%20%29%0d%0a%20%20%20%20[array]$bits%20=%20@%28%29%0d%0a%20%20%20%20$test%20=%20$true%0d%0a%20%20%20%20while%20%28$test%20-eq%20$true%29%20%7b%0d%0a%20%20%20%20%20%20%20%20if%20%28%28$int/2%29.GetType%28%29%20-match%20[double]%29%20%7b%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20$int%20=%20%28$int-1%29/2%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20[array]$bits%20&#43;=%201%0d%0a%20%20%20%20%20%20%20%20%7d%0d%0a%20%20%20%20%20%20%20%20elseif%20%28%28$int/2%29.GetType%28%29%20-match%20[int]%29%20%7b%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20$int%20=%20$int/2%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20[array]$bits%20&#43;=%200%0d%0a%20%20%20%20%20%20%20%20%7d%0d%0a%20%20%20%20%20%20%20%20if%20%28$int%20-eq%200%29%20%7b%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20$test%20=%20$false%0d%0a%20%20%20%20%20%20%20%20%7d%0d%0a%20%20%20%20%7d%0d%0a%20%20%20%20$bits%20=%20%20$bits[-1..-999]%0d%0a%20%20%20%20%28[string]%28$bits%29%29%20-replace%20%22%5cs%22%0d%0a%7d">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> ConvertTo-Bit {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">param</span> (
</span></span><span style="display:flex;"><span>        [<span style="color:#66d9ef">Int</span>]$int
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    [<span style="color:#66d9ef">array</span>]$bits = @()
</span></span><span style="display:flex;"><span>    $test = $true
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> ($test <span style="color:#f92672">-eq</span> $true) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (($int/<span style="color:#ae81ff">2</span>).GetType() <span style="color:#f92672">-match</span> [<span style="color:#66d9ef">double</span>]) {
</span></span><span style="display:flex;"><span>            $int = ($int-<span style="color:#ae81ff">1</span>)/<span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>            [<span style="color:#66d9ef">array</span>]$bits += <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">elseif</span> (($int/<span style="color:#ae81ff">2</span>).GetType() <span style="color:#f92672">-match</span> [<span style="color:#66d9ef">int</span>]) {
</span></span><span style="display:flex;"><span>            $int = $int/<span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>            [<span style="color:#66d9ef">array</span>]$bits += <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ($int <span style="color:#f92672">-eq</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>            $test = $false
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    $bits =  $bits[<span style="color:#ae81ff">-1</span>..<span style="color:#ae81ff">-999</span>]
</span></span><span style="display:flex;"><span>    ([<span style="color:#66d9ef">string</span>]($bits)) <span style="color:#f92672">-replace</span> <span style="color:#e6db74">&#34;\s&#34;</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
    
</div>
<p><code>ConvertTo-Bit 347</code></p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> ConvertFrom-Bit {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">param</span> (
</span></span><span style="display:flex;"><span>        $bit
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    [<span style="color:#66d9ef">int</span>]$int = <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    $bits = $bit.ToString().ToCharArray()
</span></span><span style="display:flex;"><span>    $index = ($bits.Count)<span style="color:#ae81ff">-1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">foreach</span> ($b <span style="color:#66d9ef">in</span> $bits) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ($b <span style="color:#f92672">-notlike</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>            $int += [<span style="color:#66d9ef">math</span>]::Pow(<span style="color:#ae81ff">2</span>,$index)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    $index -= <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    $int
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
    
</div>
<p><code>ConvertFrom-Bit 10010011</code></p>
<p><code>Get-Process pwsh | fl ProcessorAffinity</code> привязка процесса к ядрам, представляет из себя битовую маску (bitmask), где каждому биту соответствует ядро процессора. Если для ядра отмечено сходство (affinity), то бит выставляется в 1, если нет — то в 0. Например, если выбраны все 16 ядер, то это 1111 1111 1111 1111 или 65535. <br>
<code>(Get-Process pwsh).ProcessorAffinity = 15</code> 0000000000001111 присвоить 4 первых ядра <br>
<code>(Get-Process pwsh).ProcessorAffinity = 61440</code> 1111000000000000 присвоить 4 последних ядра <br>
<code>(Get-Process pwsh).ProcessorAffinity = (ConvertFrom-Bit 1111000000000000)</code></p>
<h2 id="cycle">Cycle</h2>
<h3 id="foreach">Foreach</h3>
<p><code>$list = 100..110</code> создать массив из цифр от 100 до 110 <br>
<code>foreach ($srv in $list) {ping 192.168.3.$srv -n 1 -w 50}</code> $srv хранит текущий элемент из $list и повторяет команду до последнего элемента в массиве <br>
<code>$foreach.Current</code> текущий элемент в цикле <br>
<code>$foreach.Reset()</code> обнуляет итерацию, перебор начнется заново, что приводит к бесконечному циклу <br>
<code>$foreach.MoveNext()</code> переход к следующему элементу в цикле</p>
<h3 id="foreach-object-">ForEach-Object (%)</h3>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="100..110%20%7c%20%25%7bping%20-n%201%20-w%2050%20192.168.3.$_%20%3e%20$null%0d%0aif%20%28$LastExitCode%20-eq%200%29%20%7bWrite-Host%20%22192.168.3.$_%22%20-ForegroundColor%20green%0d%0a%7d%20else%20%7b%0d%0aWrite-Host%20%22192.168.3.$_%22-ForegroundColor%20Red%7d%7d%0d%0a%25%20%20#%20%d0%bf%d0%b5%d1%80%d0%b5%d0%b4%d0%b0%d1%82%d1%8c%20%d1%86%d0%b8%d0%ba%d0%bb%20%d1%87%d0%b5%d1%80%d0%b5%d0%b7%20%d0%ba%d0%be%d0%bd%d0%b2%d0%b5%d0%b5%d1%80%20%28ForEach-Object%29%0d%0a$_%20#%20%d0%bf%d0%b5%d1%80%d0%b5%d0%bc%d0%b5%d0%bd%d0%bd%d0%b0%d1%8f%20%d1%86%d0%b8%d0%ba%d0%bb%d0%b0%20%d0%b8%20%d0%ba%d0%be%d0%bd%d0%b2%d0%b5%d0%b5%d1%80%d0%b0%20%28$PSItem%29%0d%0agwmi%20Win32_QuickFixEngineering%20%7c%20where%20%7b$_.InstalledOn.ToString%28%29%20-match%20%222022%22%7d%20%7c%20%25%7b%28$_.HotFixID.Substring%282%29%29%7d%20#%20gwmi%20%d1%81%d0%be%d0%b7%d0%b4%d0%b0%d0%b5%d1%82%20%d0%bc%d0%b0%d1%81%d1%81%d0%b8%d0%b2,%20%d0%b2%d1%8b%d0%b2%d0%be%d0%b4%20%d0%ba%d0%be%d0%bc%d0%b0%d0%bd%d0%b4%d1%8b%20%d0%bf%d0%b5%d1%80%d0%b5%d0%b4%d0%b0%d0%b5%d1%82%d1%81%d1%8f%20where%20%d0%b4%d0%bb%d1%8f%20%d0%bf%d0%be%d0%b8%d1%81%d0%ba%d0%b0%20%d0%bf%d0%be%d0%b4%d1%85%d0%be%d0%b4%d1%8f%d1%89%d0%b8%d1%85%20%d0%bf%d0%be%d0%b4%20%d0%ba%d1%80%d0%b8%d1%82%d0%b5%d1%80%d0%b8%d0%b8%20%d0%be%d0%b1%d1%8a%d0%b5%d0%ba%d1%82%d0%be%d0%b2.%20%d0%9f%d0%be%20%d0%ba%d0%be%d0%bd%d0%b2%d0%b5%d0%b5%d1%80%d1%83%20%d0%bf%d0%b5%d1%80%d0%b5%d0%b4%d0%b0%d0%b5%d1%82%d1%81%d1%8f%20%d0%b2%20%d1%86%d0%b8%d0%ba%d0%bb%20%d0%b4%d0%bb%d1%8f%20%d1%83%d0%b4%d0%b0%d0%bb%d0%b5%d0%bd%d0%b8%d1%8f%20%d0%bf%d0%b5%d1%80%d0%b2%d1%8b%d1%85%20%282%29%20%d1%81%d0%b8%d0%bc%d0%b2%d0%be%d0%bb%d0%be%d0%b2%20%d0%bc%d0%b5%d1%82%d0%be%d0%b4%d0%be%d0%bc%20Substring%20%d0%b8%d0%b7%20%d0%b2%d1%81%d0%b5%d1%85%20%d0%be%d0%b1%d1%8a%d0%b5%d0%ba%d1%82%d0%be%d0%b2%20HotFixID.">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span><span style="color:#ae81ff">100</span>.<span style="color:#ae81ff">.110</span> | %{ping -n <span style="color:#ae81ff">1</span> -w <span style="color:#ae81ff">50</span> <span style="color:#ae81ff">192.168</span>.3.$_ &gt; $null
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> ($LastExitCode <span style="color:#f92672">-eq</span> <span style="color:#ae81ff">0</span>) {Write-Host <span style="color:#e6db74">&#34;192.168.3.</span>$_<span style="color:#e6db74">&#34;</span> -ForegroundColor green
</span></span><span style="display:flex;"><span>} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>Write-Host <span style="color:#e6db74">&#34;192.168.3.</span>$_<span style="color:#e6db74">&#34;</span>-ForegroundColor Red}}
</span></span><span style="display:flex;"><span>%  <span style="color:#75715e"># передать цикл через конвеер (ForEach-Object)</span>
</span></span><span style="display:flex;"><span>$_ <span style="color:#75715e"># переменная цикла и конвеера ($PSItem)</span>
</span></span><span style="display:flex;"><span>gwmi Win32_QuickFixEngineering | where {$_.InstalledOn.ToString() <span style="color:#f92672">-match</span> <span style="color:#e6db74">&#34;2022&#34;</span>} | %{($_.HotFixID.Substring(<span style="color:#ae81ff">2</span>))} <span style="color:#75715e"># gwmi создает массив, вывод команды передается where для поиска подходящих под критерии объектов. По конвееру передается в цикл для удаления первых (2) символов методом Substring из всех объектов HotFixID.</span></span></span></code></pre></div>
    
</div>
<h3 id="while">While</h3>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="$srv%20=%20%22yandex.ru%22%0d%0a$out2%20=%20%22%d0%95%d1%81%d1%82%d1%8c%20%d0%bf%d0%b8%d0%bd%d0%b3%22%0d%0a$out3%20=%20%22%d0%9d%d0%b5%d1%82%20%d0%bf%d0%b8%d0%bd%d0%b3%d0%b0%22%0d%0a$out%20=%20$false%20#%20%d0%bf%d1%80%d0%b5%d0%b4%d0%b2%d0%b0%d1%80%d0%b8%d1%82%d0%b5%d0%bb%d1%8c%d0%bd%d0%be%20%d1%81%d0%b1%d1%80%d0%be%d1%81%d0%b8%d1%82%d1%8c%20%d0%bf%d0%b5%d1%80%d0%b5%d0%bc%d0%b5%d0%bd%d0%bd%d1%83%d1%8e,%20While%20%d0%bf%d1%80%d0%be%d0%b2%d0%b5%d1%80%d1%8f%d0%b5%d1%82%20%d1%83%d1%81%d0%bb%d0%be%d0%b2%d0%b8%d0%b5%20%d0%b4%d0%be%20%d0%b7%d0%b0%d0%bf%d1%83%d1%81%d0%ba%d0%b0%20%d1%86%d0%b8%d0%ba%d0%bb%d0%b0%0d%0aWhile%20%28$out%20-eq%20$false%29%7b%20#%20%d0%bf%d0%be%d0%ba%d0%b0%20%d1%83%d1%81%d0%bb%d0%be%d0%b2%d0%b8%d0%b5%20%d1%8f%d0%b2%d0%bb%d1%8f%d0%b5%d1%82%d1%81%d1%8f%20$true,%20%d1%86%d0%b8%d0%ba%d0%bb%20%d0%b1%d1%83%d0%b4%d0%b5%d1%82%20%d0%bf%d0%be%d0%b2%d1%82%d0%be%d1%80%d1%8f%d1%82%d1%8c%d1%81%d1%8f%0d%0a$out%20=%20ping%20-n%201%20-w%2050%20$srv%0d%0aif%20%28$out%20-match%20%22ttl%22%29%20%7b$out%20=%20$true;%20$out2%7d%20else%20%7b$out%20=%20$false;%20$out3;%20sleep%201%7d%0d%0a%7d%0d%0a%0d%0awhile%20%28$True%29%7b%20#%20%d0%b7%d0%b0%d0%bf%d1%83%d1%81%d1%82%d0%b8%d1%82%d1%8c%20%d0%b1%d0%b5%d1%81%d0%ba%d0%be%d0%bd%d0%b5%d1%87%d0%bd%d1%8b%d0%b9%20%d1%86%d0%b8%d0%ba%d0%bb%0d%0a$result%20=%20ping%20yandex.ru%20-n%201%20-w%2050%0d%0aif%20%28$result%20-match%20%22TTL%22%29%7b%20#%20%d1%83%d1%81%d0%bb%d0%be%d0%b2%d0%b8%d0%b5,%20%d0%bf%d1%80%d0%b8%20%d0%ba%d0%be%d1%82%d0%be%d1%80%d0%be%d0%bc%20%d0%b1%d1%83%d0%b4%d0%b5%d1%82%20%d0%b2%d1%8b%d0%bf%d0%be%d0%bb%d0%bd%d0%b5%d0%bd%20break%0d%0aWrite-Host%20%22%d0%a1%d0%b0%d0%b9%d1%82%20%d0%b4%d0%be%d1%81%d1%82%d1%83%d0%bf%d0%b5%d0%bd%22%0d%0abreak%20#%20%d0%be%d1%81%d1%82%d0%b0%d0%bd%d0%be%d0%b2%d0%b8%d1%82%20%d1%86%d0%b8%d0%ba%d0%bb%0d%0a%7d%20else%20%7bWrite-Host%20%22%d0%a1%d0%b0%d0%b9%d1%82%20%d0%bd%d0%b5%d0%b4%d0%be%d1%81%d1%82%d1%83%d0%bf%d0%b5%d0%bd%22;%20sleep%201%7d%0d%0a%7d">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>$srv = <span style="color:#e6db74">&#34;yandex.ru&#34;</span>
</span></span><span style="display:flex;"><span>$out2 = <span style="color:#e6db74">&#34;Есть пинг&#34;</span>
</span></span><span style="display:flex;"><span>$out3 = <span style="color:#e6db74">&#34;Нет пинга&#34;</span>
</span></span><span style="display:flex;"><span>$out = $false <span style="color:#75715e"># предварительно сбросить переменную, While проверяет условие до запуска цикла</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">While</span> ($out <span style="color:#f92672">-eq</span> $false){ <span style="color:#75715e"># пока условие является $true, цикл будет повторяться</span>
</span></span><span style="display:flex;"><span>$out = ping -n <span style="color:#ae81ff">1</span> -w <span style="color:#ae81ff">50</span> $srv
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> ($out <span style="color:#f92672">-match</span> <span style="color:#e6db74">&#34;ttl&#34;</span>) {$out = $true; $out2} <span style="color:#66d9ef">else</span> {$out = $false; $out3; sleep <span style="color:#ae81ff">1</span>}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> ($True){ <span style="color:#75715e"># запустить бесконечный цикл</span>
</span></span><span style="display:flex;"><span>$result = ping yandex.ru -n <span style="color:#ae81ff">1</span> -w <span style="color:#ae81ff">50</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> ($result <span style="color:#f92672">-match</span> <span style="color:#e6db74">&#34;TTL&#34;</span>){ <span style="color:#75715e"># условие, при котором будет выполнен break</span>
</span></span><span style="display:flex;"><span>Write-Host <span style="color:#e6db74">&#34;Сайт доступен&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">break</span> <span style="color:#75715e"># остановит цикл</span>
</span></span><span style="display:flex;"><span>} <span style="color:#66d9ef">else</span> {Write-Host <span style="color:#e6db74">&#34;Сайт недоступен&#34;</span>; sleep <span style="color:#ae81ff">1</span>}
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
    
</div>
<h3 id="try-catch-finally">Try-Catch-Finally</h3>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="Try%20%7b$out%20=%20pping%20192.168.3.1%7d%0d%0aCatch%20%7bWrite-Warning%20%22$%28$error[0]%29%22%7d%20#%20%d0%b2%d1%8b%d0%b2%d0%be%d0%b4%d0%b8%d1%82%20%d0%b2%20%d1%81%d0%bb%d1%83%d1%87%d0%b0%d0%b5%20%d0%be%d1%88%d0%b8%d0%b1%d0%ba%d0%b8%20%28%d0%b2%d0%bc%d0%b5%d1%81%d1%82%d0%be%20%d0%be%d1%88%d0%b8%d0%b1%d0%ba%d0%b8%29%0d%0afinally%20%7b$out%20=%20%22End%22%7d%20#%20%d0%b2%d1%8b%d0%bf%d0%be%d0%bb%d0%bd%d1%8f%d0%b5%d1%82%d1%81%d1%8f%20%d0%b2%20%d0%ba%d0%be%d0%bd%d1%86%d0%b5%20%d0%b2%20%d0%bb%d1%8e%d0%b1%d0%be%d0%bc%20%d1%81%d0%bb%d1%83%d1%87%d0%b0%d0%b5">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span><span style="color:#66d9ef">Try</span> {$out = pping <span style="color:#ae81ff">192.168</span>.3.<span style="color:#ae81ff">1</span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Catch</span> {Write-Warning <span style="color:#e6db74">&#34;</span>$($error[<span style="color:#ae81ff">0</span>])<span style="color:#e6db74">&#34;</span>} <span style="color:#75715e"># выводит в случае ошибки (вместо ошибки)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">finally</span> {$out = <span style="color:#e6db74">&#34;End&#34;</span>} <span style="color:#75715e"># выполняется в конце в любом случае</span></span></span></code></pre></div>
    
</div>
<h2 id="files">Files</h2>
<p><code>$file = [System.IO.File]::Create(&quot;$home\desktop\test.txt&quot;)</code> создать файл <br>
<code>$file.Close()</code> закрыть файл <br>
<code>[System.IO.File]::ReadAllLines(&quot;$home\desktop\test.txt&quot;)</code> прочитать файл <br>
<code>$file = New-Object System.IO.StreamReader(&quot;$home\desktop\test.txt&quot;)</code> файл будет занят процессом PowerShell <br>
<code>$file | gm</code> <br>
<code>$file.ReadLine()</code> построчный вывод <br>
<code>$file.ReadToEnd()</code> прочитать файл целиком</p>
<h3 id="readwrite-bytes">Read/Write Bytes</h3>
<p><code>$file = [io.file]::ReadAllBytes(&quot;$home\desktop\powershell.jpg&quot;)</code> метод открывает двоичный файл, считывает его в массив байт и закрывает файл <br>
<code>[io.file]::WriteAllBytes(&quot;$home\desktop\tloztotk-2.jpg&quot;,$file)</code> сохранить байты в файл (можно использовать для выгрузки двоичных файлов из БД)</p>
<p><code>Get-Content $home/desktop\test.txt -Wait</code> аналог tail <br>
<code>Test-Path $path</code> проверить доступность пути <br>
<code>Get-ChildItem $path -Filter *.txt -Recurse</code> отобразить содержимое каталога (Alias: ls/gci/dir) и дочерних каталогов (-Recurse) и отфильтровать вывод <br>
<code>Get-Location</code> отобразить текущие месторасположение (Alias: pwd/gl) <br>
<code>Set-Location $path</code> перемещение по каталогам (Alias: cd/sl) <br>
<code>Invoke-Item $path</code> открыть файл (Alias: ii/start) <br>
<code>Get-ItemProperty $env:userprofile\Documents\dns-list.txt | select FullName,Directory,Name,BaseName,Extension</code> свойтсва файла <br>
<code>Get-ItemProperty -Path $path\* | select FullName,CreationTime,LastWriteTime</code> свойства файлов содержимого директории, дата их создания и последнего изменения <br>
<code>New-Item -Path &quot;C:\test\&quot; -ItemType &quot;Directory&quot;</code> создать директорию (Alias: mkdir/md) <br>
<code>New-Item -Path &quot;C:\test\file.txt&quot; -ItemType &quot;File&quot; -Value &quot;Добавить текст в файл&quot;</code> создать файл <br>
<code>&quot;test&quot; &gt; &quot;C:\test\file.txt&quot;</code> заменить содержимое <br>
<code>&quot;test&quot; &gt;&gt; &quot;C:\test\file.txt&quot;</code> добавить строку в файл <br>
<code>New-Item -Path &quot;C:\test\test\file.txt&quot; -Force</code> ключ используется для создания отсутствующих в пути директорий или перезаписи файла если он уже существует <br>
<code>Move-Item</code> перемещение объектов (Alias: mv/move) <br>
<code>Remove-Item &quot;$path\&quot; -Recurse</code> удаление всех файлов внутри каталога, без запроса подверждения (Alias: rm/del) <br>
<code>Remove-Item $path -Recurse -Include &quot;*.txt&quot;,&quot;*.temp&quot; -Exclude &quot;log.txt&quot;</code> удалить все файлы с расширением txt и temp ([Array]), кроме log.txt <br>
<code>Rename-Item &quot;C:\test\*.*&quot; &quot;*.jpg&quot;</code> переименовать файлы по маске (Alias: ren) <br>
<code>Copy-Item</code> копирование файлов и каталогов (Alias: cp/copy) <br>
<code>Copy-Item -Path &quot;\\server-01\test&quot; -Destination &quot;C:\&quot; -Recurse</code> копировать директорию с ее содержимым (-Recurse) <br>
<code>Copy-Item -Path &quot;C:\*.txt&quot; -Destination &quot;C:\test\&quot;</code> знак &lsquo;' в конце Destination используется для переноса папки внутрь указанной, отсутствие, что это новое имя директории <br>
<code>Copy-Item -Path &quot;C:\*&quot; -Destination &quot;C:\test\&quot; -Include '*.txt','*.jpg'</code> копировать объекты с указанным расширением (Include) <br>
<code>Copy-Item -Path &quot;C:\*&quot; -Destination &quot;C:\test\&quot; -Exclude '*.jpeg'</code> копировать объекты, за исключением файлов с расширением (Exclude) <br>
<code>$log = Copy-Item &quot;C:\*.txt&quot; &quot;C:\test\&quot; -PassThru</code> вывести результат копирования (логирование) в переменную, можно забирать строки с помощью индексов $log[0].FullName</p>
<h3 id="clear-env-temp-14-days">Clear-env-Temp-14-days</h3>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>$ls = Get-Item $env:TEMP\*.tmp <span style="color:#75715e"># считать все файлы с указанным расширением</span>
</span></span><span style="display:flex;"><span>$date = (Get-Date).AddDays(<span style="color:#ae81ff">-14</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">foreach</span> ($l <span style="color:#66d9ef">in</span> $ls) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ($l.LastWriteTime <span style="color:#f92672">-le</span> $date) {
</span></span><span style="display:flex;"><span>        $l.FullName
</span></span><span style="display:flex;"><span>        Remove-Item $l.FullName -Recurse
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
    
</div>
<h3 id="filehash">Filehash</h3>
<p><code>Get-Filehash -Algorithm SHA256 &quot;$env:USERPROFILE\Documents\RSA.conf.txt&quot;</code></p>
<h3 id="microsoftpowershellarchive">Microsoft.PowerShell.Archive</h3>
<p><code>Compress-Archive -Path $sourcepath -DestinationPath $dstpath -CompressionLevel Optimal</code> архивировать <br>
<code>Expand-Archive .\powerlinefonts.zip</code> разархивировать</p>
<h2 id="credential">Credential</h2>
<p><code>$Cred = Get-Credential</code> сохраняет креды в переменные <code>$Cred.Username</code> и <code>$Cred.Password</code> <br>
<code>$Cred.GetNetworkCredential().password</code> извлечь пароль <br>
<code>cmdkey /generic:&quot;TERMSRV/$srv&quot; /user:&quot;$username&quot; /pass:&quot;$password&quot;</code> добавить указанные креды аудентификации на на терминальный сервер для подключения без пароля <br>
<code>mstsc /admin /v:$srv</code> авторизоваться <br>
<code>cmdkey /delete:&quot;TERMSRV/$srv&quot;</code> удалить добавленные креды аудентификации из системы <br>
<code>rundll32.exe keymgr.dll,KRShowKeyMgr</code> хранилище Stored User Names and Password <br>
<code>Get-Service VaultSvc</code> служба для работы Credential Manager <br>
<code>Install-Module CredentialManager</code> установить модуль управления Credential Manager к хранилищу PasswordVault из PowerShell <br>
<code>[System.Net.ServicePointManager]::SecurityProtocol = [System.Net.SecurityProtocolType]'Tls11,Tls12'</code> для устаноки модуля <br>
<code>Get-StoredCredential</code> получить учетные данные из хранилища Windows Vault <br>
<code>Get-StrongPassword</code> генератор пароля <br>
<code>New-StoredCredential -UserName test -Password &quot;123456&quot;</code> добавить учетную запись <br>
<code>Remove-StoredCredential</code> удалить учетную запись <br>
<code>$Cred = Get-StoredCredential | where {$_.username -match &quot;admin&quot;}</code> <br>
<code>$pass = $cred.password</code> <br>
<code>$BSTR = [System.Runtime.InteropServices.Marshal]::SecureStringToBSTR($pass)</code> <br>
<code>[System.Runtime.InteropServices.Marshal]::PtrToStringAuto($BSTR)</code></p>
<h3 id="out-gridview">Out-Gridview</h3>
<p><code>Get-Service -cn $srv | Out-GridView -Title &quot;Service $srv&quot; -OutputMode Single –PassThru | Restart-Service</code> перезапустить выбранную службу</p>
<h3 id="out-file">Out-File</h3>
<p><code>Read-Host –AsSecureString | ConvertFrom-SecureString | Out-File &quot;$env:userprofile\desktop\password.txt&quot;</code> писать в файл. Преобразовать пароль в формат SecureString с использованием шифрования Windows Data Protection API (DPAPI)</p>
<h3 id="get-content-gccattype">Get-Content (gc/cat/type)</h3>
<p><code>$password = gc &quot;$env:userprofile\desktop\password.txt&quot; | ConvertTo-SecureString</code> читать хэш пароля из файла с помощью ключей, хранящихся в профиле текущего пользователя, который невозможно прочитать на другом копьютере</p>
<h3 id="aes-key">AES Key</h3>
<p><code>$AESKey = New-Object Byte[] 32</code> <br>
<code>[Security.Cryptography.RNGCryptoServiceProvider]::Create().GetBytes($AESKey)</code> <br>
<code>$AESKey | Out-File &quot;C:\password.key&quot;</code> <br>
<code>$Cred.Password | ConvertFrom-SecureString -Key (Get-Content &quot;C:\password.key&quot;) | Set-Content &quot;C:\password.txt&quot;</code> сохранить пароль в файл используя внешний ключ <br>
<code>$pass = Get-Content &quot;C:\password.txt&quot; | ConvertTo-SecureString -Key (Get-Content &quot;\\Server\Share\password.key&quot;)</code> расшифровать пароль на втором компьютере</p>
<h2 id="winevent">WinEvent</h2>
<p><code>Get-WinEvent -ListLog *</code> отобразить все доступные журналы логов <br>
<code>Get-WinEvent -ListLog * | where RecordCount -ne 0 | where RecordCount -ne $null | sort -Descending RecordCount</code> отобразить не пустые журналы с сортировкой по кол-ву записей <br>
<code>Get-WinEvent -ListProvider * | ft</code> отобразить всех провайдеров приложений <br>
<code>Get-WinEvent -ListProvider GroupPolicy</code> найти в какой журнал LogLinks {Application} пишутся логи приложения <br>
<code>Get-WinEvent -ListProvider *smb*</code> <br>
<code>Get-WinEvent -ListLog * | where logname -match SMB | sort -Descending RecordCount</code> найти все журналы по имени <br>
<code>Get-WinEvent -LogName &quot;Microsoft-Windows-SmbClient/Connectivity&quot;</code> <br>
<code>Get-WinEvent -ListProvider *firewall*</code></p>
<h3 id="filter-xpathhashtable">Filter XPath/Hashtable</h3>
<p><code>Get-WinEvent -FilterHashtable @{LogName=&quot;Security&quot;;ID=4624}</code> найти логи по ID в журнале Security <br>
<code>Get-WinEvent -FilterHashtable @{LogName=&quot;System&quot;;Level=2}</code> найти все записи ошибки (1 - критический, 3 - предупреждение, 4 - сведения) <br>
<code>Get-WinEvent -FilterHashtable @{LogName=&quot;System&quot;;Level=2;ProviderName=&quot;Service Control Manager&quot;}</code> отфильтровать по имени провайдера</p>
<p><code>([xml](Get-WinEvent -FilterHashtable @{LogName=&quot;Security&quot;;ID=4688} -MaxEvents 1).ToXml()).Event.EventData.Data</code> отобразить все свойства, хранимые в EventData (Message) <br>
<code>Get-WinEvent -FilterHashtable @{logname=&quot;security&quot;;ID=4688} -MaxEvents 1 | select timecreated,{$_.Properties[5].value}</code> отфильтровать время события и имя запущенного процесса</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <pre><code>$query = &#39;
&lt;QueryList&gt;
    &lt;Query Id=&#34;0&#34; Path=&#34;Security&#34;&gt;
        &lt;Select Path=&#34;Security&#34;&gt;
		    *[System[EventID=4688]] and 
            *[EventData[Data[@Name=&#34;NewProcessName&#34;]=&#34;C:\Windows\System32\autochk.exe&#34; or Data[@Name=&#34;NewProcessName&#34;]=&#34;C:\Windows\System32\services.exe&#34;]]
        &lt;/Select&gt;
    &lt;/Query&gt;
&lt;/QueryList&gt;
&#39;

Get-WinEvent -LogName Security -FilterXPath $query</code></pre>
    
</div>
<h3 id="reboot">Reboot</h3>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="$query%20=%20%27%0d%0a%3cQueryList%3e%0d%0a%20%20%20%20%3cQuery%20Id=%220%22%20Path=%22System%22%3e%0d%0a%20%20%20%20%20%20%20%20%3cSelect%20Path=%22System%22%3e%0d%0a%09%09%20%20%20%20*[%0d%0a%09%09%09System[%0d%0a%09%09%09EventID=41%20or%0d%0a%09%09%09EventID=1074%20or%0d%0a%09%09%09EventID=1076%20or%0d%0a%09%09%09EventID=6005%20or%0d%0a%09%09%09EventID=6006%20or%0d%0a%09%09%09EventID=6008%20or%0d%0a%09%09%09EventID=6009%20or%0d%0a%09%09%09EventID=6013%0d%0a%09%09%09]%0d%0a%09%09%09]%0d%0a%20%20%20%20%20%20%20%20%3c/Select%3e%0d%0a%20%20%20%20%3c/Query%3e%0d%0a%3c/QueryList%3e%0d%0a%27%0d%0aGet-WinEvent%20-LogName%20System%20-FilterXPath%20$query%0d%0a%0d%0a41%20%20%60%20%d0%a1%d0%b8%d1%81%d1%82%d0%b5%d0%bc%d0%b0%20%d0%b1%d1%8b%d0%bb%d0%b0%20%d0%bf%d0%b5%d1%80%d0%b5%d0%b7%d0%b0%d0%b3%d1%80%d1%83%d0%b6%d0%b5%d0%bd%d0%b0%20%d0%b1%d0%b5%d0%b7%20%d0%ba%d0%be%d1%80%d1%80%d0%b5%d0%ba%d1%82%d0%bd%d0%be%d0%b3%d0%be%20%d0%b7%d0%b0%d0%b2%d0%b5%d1%80%d1%88%d0%b5%d0%bd%d0%b8%d1%8f%20%d1%80%d0%b0%d0%b1%d0%be%d1%82%d1%8b.%0d%0a1074%60%20%d0%a1%d0%b8%d1%81%d1%82%d0%b5%d0%bc%d0%b0%20%d0%b1%d1%8b%d0%bb%d0%b0%20%d0%ba%d0%be%d1%80%d1%80%d0%b5%d0%ba%d1%82%d0%bd%d0%be%d0%b3%d0%be%20%d0%b2%d1%8b%d0%ba%d0%bb%d1%8e%d1%87%d0%b5%d0%bd%d0%b0%20%d0%bf%d0%be%d0%bb%d1%8c%d0%b7%d0%be%d0%b2%d0%b0%d1%82%d0%b5%d0%bb%d0%b5%d0%bc%20%d0%b8%d0%bb%d0%b8%20%d0%bf%d1%80%d0%be%d1%86%d0%b5%d1%81%d1%81%d0%be%d0%bc.%0d%0a1076%60%20%d0%a1%d0%bb%d0%b5%d0%b4%d1%83%d0%b5%d1%82%20%d0%b7%d0%b0%20Event%20ID%206008%20%d0%b8%20%d0%be%d0%b7%d0%bd%d0%b0%d1%87%d0%b0%d0%b5%d1%82,%20%d1%87%d1%82%d0%be%20%d0%bf%d0%b5%d1%80%d0%b2%d1%8b%d0%b9%20%d0%bf%d0%be%d0%bb%d1%8c%d0%b7%d0%be%d0%b2%d0%b0%d1%82%d0%b5%d0%bb%d1%8c%20%28%d1%81%20%d0%bf%d1%80%d0%b0%d0%b2%d0%be%d0%bc%20%d0%b2%d1%8b%d0%ba%d0%bb%d1%8e%d1%87%d0%b5%d0%bd%d0%b8%d1%8f%20%d1%81%d0%b8%d1%81%d1%82%d0%b5%d0%bc%d1%8b%29%20%d0%bf%d0%be%d0%b4%d0%ba%d0%bb%d1%8e%d1%87%d0%b8%d0%b2%d1%88%d0%b8%d0%b9%d1%81%d1%8f%20%d0%ba%20%d1%81%d0%b5%d1%80%d0%b2%d0%b5%d1%80%d1%83%20%d0%bf%d0%be%d1%81%d0%bb%d0%b5%20%d0%bd%d0%b5%d0%be%d0%b6%d0%b8%d0%b4%d0%b0%d0%bd%d0%bd%d0%be%d0%b9%20%d0%bf%d0%b5%d1%80%d0%b5%d0%b7%d0%b0%d0%b3%d1%80%d1%83%d0%b7%d0%ba%d0%b8%20%d0%b8%d0%bb%d0%b8%20%d0%b2%d1%8b%d0%ba%d0%bb%d1%8e%d1%87%d0%b5%d0%bd%d0%b8%d1%8f,%20%d1%83%d0%ba%d0%b0%d0%b7%d0%b0%d0%bb%20%d0%bf%d1%80%d0%b8%d1%87%d0%b8%d0%bd%d1%83%20%d1%8d%d1%82%d0%be%d0%b3%d0%be%20%d1%81%d0%be%d0%b1%d1%8b%d1%82%d0%b8%d1%8f.%0d%0a6005%60%20%d0%97%d0%b0%d0%bf%d1%83%d1%81%d0%ba%20%22%d0%96%d1%83%d1%80%d0%bd%d0%b0%d0%bb%d0%b0%20%d1%81%d0%be%d0%b1%d1%8b%d1%82%d0%b8%d0%b9%20Windows%22%20%28Event%20Log%29.%20%d0%a3%d0%ba%d0%b0%d0%b7%d1%8b%d0%b2%d0%b0%d0%b5%d1%82%20%d0%bd%d0%b0%20%d0%b2%d0%ba%d0%bb%d1%8e%d1%87%d0%b5%d0%bd%d0%b8%d0%b5%20%d1%81%d0%b8%d1%81%d1%82%d0%b5%d0%bc%d1%8b.%0d%0a6006%60%20%d0%9e%d1%81%d1%82%d0%b0%d0%bd%d0%be%d0%b2%d0%ba%d0%b0%20%c2%ab%d0%96%d1%83%d1%80%d0%bd%d0%b0%d0%bb%d0%b0%20%d1%81%d0%be%d0%b1%d1%8b%d1%82%d0%b8%d0%b9%20Windows%c2%bb.%20%d0%a3%d0%ba%d0%b0%d0%b7%d1%8b%d0%b2%d0%b0%d0%b5%d1%82%20%d0%bd%d0%b0%20%d0%b2%d1%8b%d0%ba%d0%bb%d1%8e%d1%87%d0%b5%d0%bd%d0%b8%d0%b5%20%d1%81%d0%b8%d1%81%d1%82%d0%b5%d0%bc%d1%8b.%0d%0a6008%60%20%d0%9f%d1%80%d0%b5%d0%b4%d1%8b%d0%b4%d1%83%d1%89%d0%b5%d0%b5%20%d0%b2%d1%8b%d0%ba%d0%bb%d1%8e%d1%87%d0%b5%d0%bd%d0%b8%d0%b5%20%d1%81%d0%b8%d1%81%d1%82%d0%b5%d0%bc%d1%8b%20%d0%b1%d1%8b%d0%bb%d0%be%20%d0%bd%d0%b5%d0%be%d0%b6%d0%b8%d0%b4%d0%b0%d0%bd%d0%bd%d1%8b%d0%bc.%0d%0a6009%60%20%d0%92%d0%b5%d1%80%d1%81%d0%b8%d1%8f%20%d0%be%d0%bf%d0%b5%d1%80%d0%b0%d1%86%d0%b8%d0%be%d0%bd%d0%bd%d0%be%d0%b9%20%d1%81%d0%b8%d1%81%d1%82%d0%b5%d0%bc%d1%8b,%20%d0%b7%d0%b0%d1%84%d0%b8%d0%ba%d1%81%d0%b8%d1%80%d0%be%d0%b2%d0%b0%d0%bd%d0%bd%d0%b0%d1%8f%20%d0%bf%d1%80%d0%b8%20%d0%b7%d0%b0%d0%b3%d1%80%d1%83%d0%b7%d0%ba%d0%b5%20%d1%81%d0%b8%d1%81%d1%82%d0%b5%d0%bc%d1%8b.%0d%0a6013%60%20%d0%92%d1%80%d0%b5%d0%bc%d1%8f%20%d1%80%d0%b0%d0%b1%d0%be%d1%82%d1%8b%20%d1%81%d0%b8%d1%81%d1%82%d0%b5%d0%bc%d1%8b%20%28system%20uptime%29%20%d0%b2%20%d1%81%d0%b5%d0%ba%d1%83%d0%bd%d0%b4%d0%b0%d1%85.">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <pre><code>$query = &#39;
&lt;QueryList&gt;
    &lt;Query Id=&#34;0&#34; Path=&#34;System&#34;&gt;
        &lt;Select Path=&#34;System&#34;&gt;
		    *[
			System[
			EventID=41 or
			EventID=1074 or
			EventID=1076 or
			EventID=6005 or
			EventID=6006 or
			EventID=6008 or
			EventID=6009 or
			EventID=6013
			]
			]
        &lt;/Select&gt;
    &lt;/Query&gt;
&lt;/QueryList&gt;
&#39;
Get-WinEvent -LogName System -FilterXPath $query

41  ` Система была перезагружена без корректного завершения работы.
1074` Система была корректного выключена пользователем или процессом.
1076` Следует за Event ID 6008 и означает, что первый пользователь (с правом выключения системы) подключившийся к серверу после неожиданной перезагрузки или выключения, указал причину этого события.
6005` Запуск &#34;Журнала событий Windows&#34; (Event Log). Указывает на включение системы.
6006` Остановка «Журнала событий Windows». Указывает на выключение системы.
6008` Предыдущее выключение системы было неожиданным.
6009` Версия операционной системы, зафиксированная при загрузке системы.
6013` Время работы системы (system uptime) в секундах.</code></pre>
    
</div>
<h3 id="logon">Logon</h3>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="$srv%20=%20%22localhost%22%0d%0a$FilterXPath%20=%20%27%3cQueryList%3e%3cQuery%20Id=%220%22%3e%3cSelect%3e*[System[EventID=21]]%3c/Select%3e%3c/Query%3e%3c/QueryList%3e%27%0d%0a$RDPAuths%20=%20Get-WinEvent%20-ComputerName%20$srv%20-LogName%20%22Microsoft-Windows-TerminalServices-LocalSessionManager/Operational%22%20-FilterXPath%20$FilterXPath%0d%0a[xml[]]$xml%20=%20$RDPAuths%20%7c%20Foreach%20%7b$_.ToXml%28%29%7d%0d%0a$EventData%20=%20Foreach%20%28$event%20in%20$xml.Event%29%20%7b%0d%0aNew-Object%20PSObject%20-Property%20@%7b%0d%0a%22Connection%20Time%22%20=%20%28Get-Date%20%28$event.System.TimeCreated.SystemTime%29%20-Format%20%27yyyy-MM-dd%20hh:mm%20K%27%29%0d%0a%22User%20Name%22%20=%20$event.UserData.EventXML.User%0d%0a%22User%20ID%22%20=%20$event.UserData.EventXML.SessionID%0d%0a%22User%20Address%22%20=%20$event.UserData.EventXML.Address%0d%0a%22Event%20ID%22%20=%20$event.System.EventID%0d%0a%7d%7d%0d%0a$EventData%20%7c%20ft">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>$srv = <span style="color:#e6db74">&#34;localhost&#34;</span>
</span></span><span style="display:flex;"><span>$FilterXPath = <span style="color:#e6db74">&#39;&lt;QueryList&gt;&lt;Query Id=&#34;0&#34;&gt;&lt;Select&gt;*[System[EventID=21]]&lt;/Select&gt;&lt;/Query&gt;&lt;/QueryList&gt;&#39;</span>
</span></span><span style="display:flex;"><span>$RDPAuths = Get-WinEvent -ComputerName $srv -LogName <span style="color:#e6db74">&#34;Microsoft-Windows-TerminalServices-LocalSessionManager/Operational&#34;</span> -FilterXPath $FilterXPath
</span></span><span style="display:flex;"><span>[<span style="color:#66d9ef">xml[]</span>]$xml = $RDPAuths | <span style="color:#66d9ef">Foreach</span> {$_.ToXml()}
</span></span><span style="display:flex;"><span>$EventData = <span style="color:#66d9ef">Foreach</span> ($event <span style="color:#66d9ef">in</span> $xml.Event) {
</span></span><span style="display:flex;"><span>New-Object PSObject -Property @{
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;Connection Time&#34;</span> = (Get-Date ($event.System.TimeCreated.SystemTime) -Format <span style="color:#e6db74">&#39;yyyy-MM-dd hh:mm K&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;User Name&#34;</span> = $event.UserData.EventXML.User
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;User ID&#34;</span> = $event.UserData.EventXML.SessionID
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;User Address&#34;</span> = $event.UserData.EventXML.Address
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;Event ID&#34;</span> = $event.System.EventID
</span></span><span style="display:flex;"><span>}}
</span></span><span style="display:flex;"><span>$EventData | ft</span></span></code></pre></div>
    
</div>
<h3 id="eventlog">EventLog</h3>
<p><code>Get-EventLog -List</code> отобразить все корневые журналы логов и их размер <br>
<code>Clear-EventLog Application</code> очистить логи указанного журнала <br>
<code>Get-EventLog -LogName Security -InstanceId 4624</code> найти логи по ID в журнале Security</p>
<h2 id="defender">Defender</h2>
<p><code>Import-Module Defender</code> <br>
<code>Get-Command -Module Defender</code> <br>
<code>Get-MpComputerStatus</code> <br>
<code>(Get-MpComputerStatus).AntivirusEnabled</code> статус работы антивируса</p>
<p><code>$session = NewCimSession -ComputerName hostname</code> подключиться к удаленному компьютеру, используется WinRM <br>
<code>Get-MpComputerStatus -CimSession $session | fl fullscan*</code> узнать дату последнего сканирования на удаленном компьютере</p>
<p><code>Get-MpPreference</code> настройки <br>
<code>(Get-MpPreference).ScanPurgeItemsAfterDelay</code> время хранения записей журнала защитника в днях <br>
<code>Set-MpPreference -ScanPurgeItemsAfterDelay 30</code> изменить время хранения <br>
<code>ls &quot;C:\ProgramData\Microsoft\Windows Defender\Scans\History&quot;</code> <br>
<code>Get-MpPreference | select disable*</code> отобразить статус всех видов проверок/сканирований <br>
<code>Set-MpPreference -DisableRealtimeMonitoring $true</code> отключить защиту Defender в реальном времени (использовать только ручное сканирование) <br>
<code>Set-MpPreference -DisableRemovableDriveScanning $false</code> включить сканирование USB накопителей <br>
<code>Get-MpPreference | select excl*</code> отобразить список всех исключений <br>
<code>(Get-MpPreference).ExclusionPath</code> <br>
<code>Add-MpPreference -ExclusionPath C:\install</code> добавить директорию в исключение <br>
<code>Remove-MpPreference -ExclusionPath C:\install</code> удалить из исключения <br>
<code>New-ItemProperty -Path &quot;HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender&quot; -Name DisableAntiSpyware -Value 1 -PropertyType DWORD -Force</code> полностью отключить Windows Defender</p>
<p><code>Set-MpPreference -SignatureDefinitionUpdateFileSharesSources \\FileShare1\Updates</code> для обновления из сетевой папки нужно предварительно скачать файлы с сигнатурами баз с сайта <a href="https://www.microsoft.com/security/portal/definitions/adl.aspx">https://www.microsoft.com/security/portal/definitions/adl.aspx</a> и поместить в сетевой каталог
<code>Update-MpSignature -UpdateSource FileShares</code> изменить источник обновлений (MicrosoftUpdateServer – сервера обновлений MS в интернете, InternalDefinitionUpdateServer — внутренний WSUS сервер) <br>
<code>Update-MpSignature</code> обновить сигнатуры</p>
<p><code>Start-MpScan -ScanType QuickScan</code> быстрая проверка или FullScan <br>
<code>Start-MpScan -ScanType FullScan -AsJob</code> <br>
<code>Set-MpPreference -RemediationScheduleDay 1-7</code> выбрать дни, начиная с воскресенья или 0 каждый день, 8 - сбросить <br>
<code>Set-MpPreference -ScanScheduleQuickScanTime 14:00:00</code> <br>
<code>Start-MpScan -ScanType CustomScan -ScanPath &quot;C:\Program Files&quot;</code> сканировать выбранную директорию</p>
<p><code>Get-MpThreat</code> история угроз и тип угрозы (ThreatName: HackTool/Trojan) <br>
<code>Get-MpThreatCatalog</code> список известных видов угроз <br>
<code>Get-MpThreatDetection</code> история защиты (активных и прошлые) и ID угрозы <br>
<code>Get-MpThreat -ThreatID 2147760253</code></p>
<p><code>ls &quot;C:\ProgramData\Microsoft\Windows Defender\Quarantine\&quot;</code> директория хранения файлов в карантине <br>
<code>cd &quot;C:\Program Files\Windows Defender\&quot;</code> <br>
<code>.\MpCmdRun.exe -restore -name $ThreatName</code> восстановить файл из карантина <br>
<code>.\MpCmdRun.exe -restore -filepath $path_file</code></p>
<h2 id="windowsupdate">WindowsUpdate</h2>
<p><code>Get-Hotfix | Sort-Object -Descending  InstalledOn</code> список установленных обновлений (информация из cimv2) <br>
<code>Get-Hotfix -Description &quot;Security update&quot;</code> <br>
<code>Get-CimInstance Win32_QuickFixEngineering</code> <br>
<code>Get-Command -Module WindowsUpdate</code> <br>
<code>Get-WindowsUpdateLog</code> <br>
<code>Get-Service uhssvc</code> служба Microsoft Health Update Tools, которая отвечает за предоставление обновлений</p>
<p><code>Install-Module -Name PSWindowsUpdate -Scope CurrentUser</code> <br>
<code>Import-Module PSWindowsUpdate</code> <br>
<code>Get-Command -Module PSWindowsUpdate</code> <br>
<code>Get-WindowsUpdate</code> список обновлений для скачать и установить с сервера WSUS или Microsoft Update <br>
<code>Get-WindowsUpdate -Download</code> загрузить все обновления <br>
<code>Get-WindowsUpdate –Install</code> установить все обновления <br>
<code>Install-WindowsUpdate -MicrosoftUpdate -AcceptAll -IgnoreReboot</code> установить все обновления без перезагрузки <br>
<code>Get-WindowsUpdate -KBArticleID KB2267602, KB4533002 -Install</code> <br>
<code>Get-WindowsUpdate -KBArticleID KB2538243 -Hide</code> скрыть обновления, что бы они никогда не устанавливались <br>
<code>Get-WindowsUpdate –IsHidden</code> отобразить скрытые обновления (Hide-WindowsUpdate) <br>
<code>Remove-WindowsUpdate -KBArticleID KB4011634 -NoRestart</code> удалить обновление <br>
<code>Uninstall-WindowsUpdate</code> удалить обновление <br>
<code>Add-WUServiceManager</code> регистрация сервера обновления (Windows Update Service Manager) <br>
<code>Enable-WURemoting</code> включить правила Windows Defender, разрешающие удаленное использование командлета PSWindowsUpdate <br>
<code>Get-WUApiVersion</code> версия Windows Update Agent <br>
<code>Get-WUHistory</code> список всех установленных обновлений (история обновлений) <br>
<code>Get-WUHistory | Where-Object {$_.Title -match &quot;KB4517389&quot;}</code> поиск обновления <br>
<code>Get-WULastResults</code> даты последнего поиска и установки обновлений <br>
<code>Get-WURebootStatus</code> проверить, нужна ли перезагрузка для применения конкретного обновления <br>
<code>Get-WUServiceManager</code> выводит источники обновлений <br>
<code>Get-WUInstallerStatus</code> статус службы Windows Installer <br>
<code>Remove-WUServiceManager</code> отключить Windows Update Service Manager</p>
<h2 id="dism">DISM</h2>
<p><code>Get-Command -Module Dism -Name *Driver*</code> <br>
<code>Export-WindowsDriver -Online -Destination C:\Users\Lifailon\Documents\Drivers\</code> извлечение драйверов из текущей системы (C:\Windows\System32\DriverStore\FileRepository), выгружает список файлов, которые необходимы для установки драйвера (dll,sys,exe) в соответствии со списком файлов, указанных в секции [CopyFiles] inf-файла драйвера. <br>
<code>Export-WindowsDriver -Path C:\win_image -Destination C:\drivers</code> извлечь драйвера из офлайн образа Windows, смонтированного в каталог c:\win_image <br>
<code>$BackupDrivers = Export-WindowsDriver -Online -Destination C:\Drivers</code> <br>
<code>$BackupDrivers | ft Driver,ClassName,ProviderName,Date,Version,ClassDescription</code> список драйверов в объектном представлении <br>
<code>$BackupDrivers | where classname -match printer</code> <br>
<code>pnputil.exe /add-driver C:\drivers\*.inf /subdirs /install</code> установить все (параметр subdirs) драйвера из указанной папки (включая вложенные)</p>
<p><code>sfc /scannow</code> проверить целостность системных файлов с помощью утилиты SFC (System File Checker), в случае поиска ошибок, попробует восстановить их оригинальные копии из хранилища системных компонентов Windows (каталог C:\Windows\WinSxS). Вывод работы логируется в C:\Windows\Logs\CBS с тегом SR <br>
<code>Get-ComputerInfo | select *</code> подробная информация о системе (WindowsVersion,WindowsEditionId,<em>Bios</em>) <br>
<code>Get-WindowsImage -ImagePath E:\sources\install.wim</code> список доступных версий в образе <br>
<code>Repair-WindowsImage -Online –ScanHealth</code> <br>
<code>Repair-WindowsImage -Online -RestoreHealth</code> восстановление хранилища системных компонентов <br>
<code>Repair-WindowsImage -Online -RestoreHealth -Source E:\sources\install.wim:3 –LimitAccess</code> восстановление в оффлайн режиме из образа по номеру индекса</p>
<h2 id="scheduled">Scheduled</h2>
<p><code>$Trigger = New-ScheduledTaskTrigger -At 01:00am -Daily</code> 1:00 ночи <br>
<code>$Trigger = New-ScheduledTaskTrigger –AtLogon</code> запуск при входе пользователя в систему <br>
<code>$Trigger = New-ScheduledTaskTrigger -AtStartup</code> при запуске системы <br>
<code>$User = &quot;NT AUTHORITY\SYSTEM&quot;</code> <br>
<code>$Action = New-ScheduledTaskAction -Execute &quot;PowerShell.exe&quot; -Argument &quot;$home\Documents\DNS-Change-Tray-1.3.ps1&quot;</code> <br>
<code>$Action = New-ScheduledTaskAction -Execute &quot;PowerShell.exe&quot; -Argument &quot;-NoProfile -NoLogo -NonInteractive -ExecutionPolicy Unrestricted -WindowStyle Hidden -File $home\Documents\DNS-Change-Tray-1.3.ps1&quot;</code> <br>
<code>Register-ScheduledTask -TaskName &quot;DNS-Change-Tray-Startup&quot; -Trigger $Trigger -User $User -Action $Action -RunLevel Highest –Force</code></p>
<p><code>Get-ScheduledTask | ? state -ne Disabled</code> список всех активных заданий <br>
<code>Start-ScheduledTask DNS-Change-Tray-Startup</code> запустить задание немедленно <br>
<code>Get-ScheduledTask DNS-Change-Tray-Startup | Disable-ScheduledTask</code> отключить задание <br>
<code>Get-ScheduledTask DNS-Change-Tray-Startup | Enable-ScheduledTask</code> включить задание <br>
<code>Unregister-ScheduledTask DNS-Change-Tray-Startup</code> удалить задание <br>
<code>Export-ScheduledTask DNS-Change-Tray-Startup | Out-File $home\Desktop\Task-Export-Startup.xml</code> экспортировать задание в xml <br>
<code>Register-ScheduledTask -Xml (Get-Content $home\Desktop\Task-Export-Startup.xml | Out-String) -TaskName &quot;DNS-Change-Tray-Startup&quot;</code></p>
<h2 id="shutdown">shutdown</h2>
<p><code>shutdown /r /o</code> перезагрузка в безопасный режим <br>
<code>shutdown /s /t 600 /c &quot;Power off after 10 minutes&quot;</code> выключение <br>
<code>shutdown /s /f</code> принудительное закрытие приложений <br>
<code>shutdown /a</code> отмена <br>
<code>shutdown /r /t 0 /m \\192.168.3.100</code> <br>
<code>Restart-Computer -ComputerName 192.168.3.100 -Protocol WSMan</code> через WinRM <br>
<code>Restart-Computer –ComputerName 192.168.3.100 –Force</code> через WMI <br>
<code>Set-ItemProperty -Path &quot;HKLM:\SOFTWARE\Microsoft\PolicyManager\default\Start\HideShutDown&quot; -Name &quot;value&quot; -Value 1</code> скрыть кнопку выключения <br>
<code>Set-ItemProperty -Path &quot;HKLM:\SOFTWARE\Microsoft\PolicyManager\default\Start\HideRestart&quot; -Name &quot;value&quot; -Value 1</code> скрыть кнопку перезагрузки</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> Start-Shutdown {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&lt;#
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    .</span><span style="color:#e6db74">SYNOPSIS</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    Module for shutdown and restart the computer at a specified time
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    .</span><span style="color:#e6db74">DESCRIPTION</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    Example:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    # Start-Shutdown -Time &#34;18:00&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    # Start-Shutdown -Restart -Time &#34;18:00&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    # Start-Shutdown -Cancel
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    .</span><span style="color:#e6db74">LINK</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    https://github.com/Lifailon/PS-Commands
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    #&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">param</span>(
</span></span><span style="display:flex;"><span>        [<span style="color:#66d9ef">string</span>]$Time,
</span></span><span style="display:flex;"><span>        [<span style="color:#66d9ef">switch</span>]$Restart,
</span></span><span style="display:flex;"><span>        [<span style="color:#66d9ef">switch</span>]$Cancel
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ($Time) {
</span></span><span style="display:flex;"><span>        $currentDateTime = Get-Date
</span></span><span style="display:flex;"><span>        $shutdownTime = Get-Date $Time
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ($shutdownTime <span style="color:#f92672">-lt</span> $currentDateTime) {
</span></span><span style="display:flex;"><span>            $shutdownTime = $shutdownTime.AddDays(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        $timeUntilShutdown = $shutdownTime - $currentDateTime
</span></span><span style="display:flex;"><span>        $secondsUntilShutdown = [<span style="color:#66d9ef">math</span>]::Round($timeUntilShutdown.TotalSeconds)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ($Cancel) {
</span></span><span style="display:flex;"><span>        Start-Process -FilePath <span style="color:#e6db74">&#34;shutdown.exe&#34;</span> -ArgumentList <span style="color:#e6db74">&#34;/a&#34;</span>
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">elseif</span> ($Restart) {
</span></span><span style="display:flex;"><span>        Write-Host <span style="color:#e6db74">&#34;The computer will restart after </span>$($timeUntilShutdown.Hours)<span style="color:#e6db74"> hours and </span>$($timeUntilShutdown.Minutes)<span style="color:#e6db74"> minutes.&#34;</span>
</span></span><span style="display:flex;"><span>        Start-Process -FilePath <span style="color:#e6db74">&#34;shutdown.exe&#34;</span> -ArgumentList <span style="color:#e6db74">&#34;/r&#34;</span>, <span style="color:#e6db74">&#34;/f&#34;</span>, <span style="color:#e6db74">&#34;/t&#34;</span>, <span style="color:#e6db74">&#34;</span>$secondsUntilShutdown<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        Write-Host <span style="color:#e6db74">&#34;The computer will shutdown after </span>$($timeUntilShutdown.Hours)<span style="color:#e6db74"> hours and </span>$($timeUntilShutdown.Minutes)<span style="color:#e6db74"> minutes.&#34;</span>
</span></span><span style="display:flex;"><span>        Start-Process -FilePath <span style="color:#e6db74">&#34;shutdown.exe&#34;</span> -ArgumentList <span style="color:#e6db74">&#34;/s&#34;</span>, <span style="color:#e6db74">&#34;/f&#34;</span>, <span style="color:#e6db74">&#34;/t&#34;</span>, <span style="color:#e6db74">&#34;</span>$secondsUntilShutdown<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
    
</div>
<h2 id="localaccounts">LocalAccounts</h2>
<p><code>Get-Command -Module Microsoft.PowerShell.LocalAccounts</code> <br>
<code>Get-LocalUser</code> список пользователей <br>
<code>Get-LocalGroup</code> список групп <br>
<code>New-LocalUser &quot;1C&quot; -Password $Password -FullName &quot;1C Domain&quot;</code> создать пользователя <br>
<code>Set-LocalUser -Password $Password 1C</code> изменить пароль <br>
<code>Add-LocalGroupMember -Group &quot;Administrators&quot; -Member &quot;1C&quot;</code> добавить в группу Администраторов <br>
<code>Get-LocalGroupMember &quot;Administrators&quot;</code> члены группы</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="@%28%22vproxy-01%22,%22vproxy-02%22,%22vproxy-03%22%29%20%7c%20%25%7b%0d%0aicm%20$_%20%7bAdd-LocalGroupMember%20-Group%20%22Administrators%22%20-Member%20%22support4%22%7d%0d%0aicm%20$_%20%7bGet-LocalGroupMember%20%22Administrators%22%7d%0d%0a%7d">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>@(<span style="color:#e6db74">&#34;vproxy-01&#34;</span>,<span style="color:#e6db74">&#34;vproxy-02&#34;</span>,<span style="color:#e6db74">&#34;vproxy-03&#34;</span>) | %{
</span></span><span style="display:flex;"><span>icm $_ {Add-LocalGroupMember -Group <span style="color:#e6db74">&#34;Administrators&#34;</span> -Member <span style="color:#e6db74">&#34;support4&#34;</span>}
</span></span><span style="display:flex;"><span>icm $_ {Get-LocalGroupMember <span style="color:#e6db74">&#34;Administrators&#34;</span>}
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
    
</div>
<h2 id="smb">SMB</h2>
<p><code>Get-SmbServerConfiguration</code> <br>
<code>Set-SmbServerConfiguration -EnableSMB1Protocol $false -Force</code> отключить протокол SMB v1 <br>
<code>Get-WindowsFeature | Where-Object {$_.name -eq &quot;FS-SMB1&quot;} | ft Name,Installstate</code> модуль ServerManager, проверить установлен ли компонент SMB1 <br>
<code>Install-WindowsFeature FS-SMB1</code> установить SMB1 <br>
<code>Uninstall-WindowsFeature –Name FS-SMB1 –Remove</code> удалить SMB1 клиента (понадобится перезагрузка) <br>
<code>Get-WindowsOptionalFeature -Online</code> модуль DISM, для работы с компонентами Windows <br>
<code>Disable-WindowsOptionalFeature -Online -FeatureName SMB1Protocol -Remove</code> удалить SMB1 <br>
<code>Set-SmbServerConfiguration –AuditSmb1Access $true</code> включить аудит SMB1 <br>
<code>Get-SmbConnection</code> список активных сессий и используемая версия SMB (Dialect) <br>
<code>Get-SmbOpenFile | select ClientUserName,ClientComputerName,Path,SessionID</code> список открытых файлов <br>
<code>Get-SmbShare</code> список сетевых папок <br>
<code>New-SmbShare -Name xl-share -Path E:\test</code> создать новую общую сетевую папку (расшарить) <br>
<code>-EncryptData $True</code> включить шифрование SMB <br>
<code>-Description</code> имя в сетевом окружении <br>
<code>-ReadAccess &quot;domain\username&quot;</code> доступ на чтение <br>
<code>-ChangeAccess</code> доступ на запись <br>
<code>-FullAccess</code> полный доступ <br>
<code>-NoAccess ALL</code> нет прав <br>
<code>-FolderEnumerationMode [AccessBased | Unrestricted]</code> позволяет скрыть в сетевой папке объекты, на которых у пользователя нет доступа с помощью Access-Based Enumeration (ABE) <br>
<code>Get-SmbShare xl-share | Set-SmbShare -FolderEnumerationMode AccessBased</code> ключить ABE для всех расшаренных папок <br>
<code>Remove-SmbShare xl-share -force</code> удалить сетевой доступ (шару) <br>
<code>Get-SmbShareAccess xl-share</code> вывести список доступов безопасности к шаре <br>
<code>Revoke-SmbShareAccess xl-share -AccountName Everyone –Force</code> удалить группу из списка доступов <br>
<code>Grant-SmbShareAccess -Name xl-share -AccountName &quot;domain\XL-Share&quot; -AccessRight Change –force</code> изменить/добавить разрешения на запись (Full,Read) <br>
<code>Grant-SmbShareAccess -Name xl-share -AccountName &quot;все&quot; -AccessRight Change –force</code> <br>
<code>Block-SmbShareAccess -Name xl-share -AccountName &quot;domain\noAccess&quot; -Force</code> принудительный запрет <br>
<code>New-SmbMapping -LocalPath X: -RemotePath \\$srv\xl-share -UserName support4 -Password password –Persistent $true</code> подключить сетевой диск <br>
<code>-Persistent</code> восстановление соединения после отключения компьютера или сети <br>
<code>-SaveCredential</code> позволяет сохранить учетные данные пользователя для подключения в диспетчер учетных данных Windows Credential Manager <br>
<code>Stop-Process -Name &quot;explorer&quot; | Start-Process -FilePath &quot;C:\Windows\explorer.exe&quot;</code> перезапустить процесс для отображения в проводнике <br>
<code>Get-SmbMapping</code> список подключенных сетевых дисков <br>
<code>Remove-SmbMapping X: -force</code> отмонтировать сетевой диск <br>
<code>$CIMSession = New-CIMSession –Computername $srv</code> создать сеанс CIM (аудентификация на SMB) <br>
<code>Get-SmbOpenFile -CIMSession $CIMSession | select ClientUserName,ClientComputerName,Path | Out-GridView -PassThru | Close-SmbOpenFile -CIMSession $CIMSession -Confirm:$false –Force</code> закрыть файлы (открыть к ним сетевой доступ)</p>
<h3 id="get-acl">Get-Acl</h3>
<p><code>(Get-Acl \\$srv\xl-share).access</code> доступ ACL на уровне NTFS <br>
<code>Get-Acl C:\Drivers | Set-Acl C:\Distr</code> скопировать NTFS разрешения с одной папки и применить их на другую</p>
<h3 id="ntfssecurity">NTFSSecurity</h3>
<p><code>Install-Module -Name NTFSSecurity -force</code> <br>
<code>Get-Item &quot;\\$srv\xl-share&quot; | Get-NTFSAccess</code> <br>
<code>Add-NTFSAccess -Path &quot;\\$srv\xl-share&quot; -Account &quot;domain\xl-share&quot; -AccessRights Fullcontrol -PassThru</code> добавить <br>
<code>Remove-NTFSAccess -Path &quot;\\$srv\xl-share&quot; -Account &quot;domain\xl-share&quot; -AccessRights FullControl -PassThru</code> удалить <br>
<code>Get-ChildItem -Path &quot;\\$srv\xl-share&quot; -Recurse -Force | Clear-NTFSAccess</code> удалить все разрешения, без удаления унаследованных разрешений <br>
<code>Get-ChildItem -Path &quot;\\$srv\xl-share&quot; -Recurse -Force | Enable-NTFSAccessInheritance</code> включить NTFS наследование для всех объектов в каталоге</p>
<h3 id="storage">Storage</h3>
<p><code>Get-Command -Module Storage</code> <br>
<code>Get-Disk</code> список логических дисков <br>
<code>Get-Partition</code> отобразить разделы на всех дисках <br>
<code>Get-Volume</code> список логичких разделов <br>
<code>Get-PhysicalDisk</code> список физических дисков <br>
<code>Initialize-Disk 1 –PartitionStyle MBR</code> инициализировать диск <br>
<code>New-Partition -DriveLetter D –DiskNumber 1 -Size 500gb</code> создать раздел (выделить все место -UseMaximumSize) <br>
<code>Format-Volume -DriveLetter D -FileSystem NTFS -NewFileSystemLabel Disk-D</code> форматировать раздел <br>
<code>Set-Partition -DriveLetter D -IsActive $True</code> сделать активным <br>
<code>Remove-Partition -DriveLetter D –DiskNumber 1</code> удалить раздел <br>
<code>Clear-Disk -Number 1 -RemoveData</code> очистить диск <br>
<code>Repair-Volume –driveletter C –Scan</code> Check disk <br>
<code>Repair-Volume –driveletter C –SpotFix</code> <br>
<code>Repair-Volume –driverletter C -Scan –Cimsession $CIMSession</code></p>
<h3 id="iscsi">iSCSI</h3>
<p><code>New-IscsiVirtualDisk -Path D:\iSCSIVirtualDisks\iSCSI2.vhdx -Size 20GB</code> создать динамический vhdx-диск (для фиксированного размера -UseFixed) <br>
<code>New-IscsiServerTarget -TargetName iscsi-target-2 -InitiatorIds &quot;IQN:iqn.1991-05.com.microsoft:srv3.contoso.com&quot;</code> создать Target <br>
<code>Get-IscsiServerTarget | fl TargetName, LunMappings</code> <br>
<code>Connect-IscsiTarget -NodeAddress &quot;iqn.1995-05.com.microsoft:srv2-iscsi-target-2-target&quot; -IsPersistent $true</code> подключиться инициатором к таргету <br>
<code>Get-IscsiTarget | fl</code> <br>
<code>Disconnect-IscsiTarget -NodeAddress &quot;iqn.1995-05.com.microsoft:srv2-iscsi-target-2-target&quot; -Confirm:$false</code> отключиться</p>
<h2 id="ps2exe">PS2EXE</h2>
<p><code>Install-Module ps2exe -Repository PSGallery</code> <br>
<code>Get-Module -ListAvailable</code> список всех модулей <br>
<code>-noConsole</code> использовать GUI, без окна консоли powershell <br>
<code>-noOutput</code> выполнение в фоне <br>
<code>-noError</code> без вывода ошибок <br>
<code>-requireAdmin</code> при запуске запросить права администратора <br>
<code>-credentialGUI</code> вывод диалогового окна для ввода учетных данных <br>
<code>Invoke-ps2exe -inputFile &quot;$home\Desktop\WinEvent-Viewer-1.1.ps1&quot; -outputFile &quot;$home\Desktop\WEV-1.1.exe&quot; -iconFile &quot;$home\Desktop\log_48px.ico&quot; -title &quot;WinEvent-Viewer&quot; -noConsole -noOutput -noError</code></p>
<h2 id="nssm">NSSM</h2>
<p><code>$powershell_Path = (Get-Command powershell).Source</code> <br>
<code>$NSSM_Path = (Get-Command &quot;C:\WinPerf-Agent\NSSM-2.24.exe&quot;).Source</code> <br>
<code>$Script_Path = &quot;C:\WinPerf-Agent\WinPerf-Agent-1.1.ps1&quot;</code> <br>
<code>$Service_Name = &quot;WinPerf-Agent&quot;</code> <br>
<code>&amp; $NSSM_Path install $Service_Name $powershell_Path -ExecutionPolicy Bypass -NoProfile -f $Script_Path</code> создать Service <br>
<code>&amp; $NSSM_Path start $Service_Name</code> запустить <br>
<code>&amp; $NSSM_Path status $Service_Name</code> статус <br>
<code>$Service_Name | Restart-Service</code> перезапустить <br>
<code>$Service_Name | Get-Service</code> статус <br>
<code>$Service_Name | Stop-Service</code> остановить <br>
<code>&amp; $NSSM_Path set $Service_Name description &quot;Check performance CPU and report email&quot;</code> изменить описание <br>
<code>&amp; $NSSM_Path remove $Service_Name</code> удалить</p>
<h2 id="jobs">Jobs</h2>
<p><code>Get-Job</code> получение списка задач <br>
<code>Start-Job</code> запуск процесса <br>
<code>Stop-Job</code> остановка процесса <br>
<code>Suspend-Job</code> приостановка работы процесса <br>
<code>Resume-Job</code> восстановление работы процесса <br>
<code>Wait-Job</code> ожидание вывода команды <br>
<code>Receive-Job</code> получение результатов выполненного процесса <br>
<code>Remove-Job</code> удалить задачу</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> Start-PingJob ($Network) {
</span></span><span style="display:flex;"><span>$RNetwork = $Network <span style="color:#f92672">-replace</span> <span style="color:#e6db74">&#34;\.\d{1,3}$&#34;</span>,<span style="color:#e6db74">&#34;.&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">foreach</span> ($4 <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1</span>.<span style="color:#ae81ff">.254</span>) {
</span></span><span style="display:flex;"><span>$ip = $RNetwork+$4
</span></span><span style="display:flex;"><span><span style="color:#75715e"># создаем задания, забираем 3-ю строку вывода и добавляем к выводу ip-адрес:</span>
</span></span><span style="display:flex;"><span>(Start-Job {<span style="color:#e6db74">&#34;</span>$using<span style="color:#e6db74">:ip : &#34;</span>+(ping -n <span style="color:#ae81ff">1</span> -w <span style="color:#ae81ff">50</span> $using<span style="color:#960050;background-color:#1e0010">:</span>ip)[<span style="color:#ae81ff">2</span>]}) | Out-Null
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> ($True){
</span></span><span style="display:flex;"><span>$status_job = (Get-Job).State[<span style="color:#ae81ff">-1</span>] <span style="color:#75715e"># забираем статус последнего задания</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> ($status_job <span style="color:#f92672">-like</span> <span style="color:#e6db74">&#34;Completed&#34;</span>){ <span style="color:#75715e"># проверяем на выполнение (задания выполняются по очереди сверху вниз)</span>
</span></span><span style="display:flex;"><span>$ping_out = Get-Job | Receive-Job <span style="color:#75715e"># если выполнен, забираем вывод всех заданий</span>
</span></span><span style="display:flex;"><span>Get-Job | Remove-Job -Force <span style="color:#75715e"># удаляем задания</span>
</span></span><span style="display:flex;"><span>$ping_out
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">break</span> <span style="color:#75715e"># завершаем цикл</span>
</span></span><span style="display:flex;"><span>}}
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
    
</div>
<p><code>Start-PingJob -Network 192.168.3.0</code> <br>
<code>(Measure-Command {Start-PingJob -Network 192.168.3.0}).TotalSeconds</code> 60 Seconds</p>
<h3 id="threadjob">ThreadJob</h3>
<p><code>Install-Module -Name ThreadJob</code> <br>
<code>Get-Module ThreadJob -list</code> <br>
<code>Start-ThreadJob {ping ya.ru} | Out-Null</code> создать фоновую задачу <br>
<code>Get-Job | Receive-Job -Keep</code> отобразить и не удалять вывод <br>
<code>(Get-Job).HasMoreData</code> если False, то вывод команы удален <br>
<code>(Get-Job)[-1].Output</code> отобразить вывод последней задачи</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> Start-PingThread ($Network) {
</span></span><span style="display:flex;"><span>$RNetwork = $Network <span style="color:#f92672">-replace</span> <span style="color:#e6db74">&#34;\.\d{1,3}$&#34;</span>,<span style="color:#e6db74">&#34;.&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">foreach</span> ($4 <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1</span>.<span style="color:#ae81ff">.254</span>) {
</span></span><span style="display:flex;"><span>$ip = $RNetwork+$4
</span></span><span style="display:flex;"><span><span style="color:#75715e"># создаем задания, забираем 3-ю строку вывода и добавляем к выводу ip-адрес:</span>
</span></span><span style="display:flex;"><span>(Start-ThreadJob {<span style="color:#e6db74">&#34;</span>$using<span style="color:#e6db74">:ip : &#34;</span>+(ping -n <span style="color:#ae81ff">1</span> -w <span style="color:#ae81ff">50</span> $using<span style="color:#960050;background-color:#1e0010">:</span>ip)[<span style="color:#ae81ff">2</span>]}) | Out-Null
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> ($True){
</span></span><span style="display:flex;"><span>$status_job = (Get-Job).State[<span style="color:#ae81ff">-1</span>] <span style="color:#75715e"># забираем статус последнего задания</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> ($status_job <span style="color:#f92672">-like</span> <span style="color:#e6db74">&#34;Completed&#34;</span>){ <span style="color:#75715e"># проверяем на выполнение (задания выполняются по очереди сверху вниз)</span>
</span></span><span style="display:flex;"><span>$ping_out = Get-Job | Receive-Job <span style="color:#75715e"># если выполнен, забираем вывод всех заданий</span>
</span></span><span style="display:flex;"><span>Get-Job | Remove-Job -Force <span style="color:#75715e"># удаляем задания</span>
</span></span><span style="display:flex;"><span>$ping_out
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">break</span> <span style="color:#75715e"># завершаем цикл</span>
</span></span><span style="display:flex;"><span>}}
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
    
</div>
<p><code>Start-PingThread -Network 192.168.3.0</code> <br>
<code>(Measure-Command {Start-PingThread -Network 192.168.3.0}).TotalSeconds</code> 24 Seconds</p>
<h3 id="poshrsjob">PoshRSJob</h3>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> Start-PingRSJob ($Network) {
</span></span><span style="display:flex;"><span>$RNetwork = $Network <span style="color:#f92672">-replace</span> <span style="color:#e6db74">&#34;\.\d{1,3}$&#34;</span>,<span style="color:#e6db74">&#34;.&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">foreach</span> ($4 <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1</span>.<span style="color:#ae81ff">.254</span>) {
</span></span><span style="display:flex;"><span>$ip = $RNetwork+$4
</span></span><span style="display:flex;"><span>(Start-RSJob {<span style="color:#e6db74">&#34;</span>$using<span style="color:#e6db74">:ip : &#34;</span>+(ping -n <span style="color:#ae81ff">1</span> -w <span style="color:#ae81ff">50</span> $using<span style="color:#960050;background-color:#1e0010">:</span>ip)[<span style="color:#ae81ff">2</span>]}) | Out-Null
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>$ping_out = Get-RSJob | Receive-RSJob
</span></span><span style="display:flex;"><span>$ping_out
</span></span><span style="display:flex;"><span>Get-RSJob | Remove-RSJob
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
    
</div>
<p><code>Start-PingRSJob -Network 192.168.3.0</code> <br>
<code>(Measure-Command {Start-PingRSJob -Network 192.168.3.0}).TotalSeconds</code> 10 Seconds</p>
<h2 id="regedit">Regedit</h2>
<p><code>Get-PSDrive</code> список всех доступных дисков/разделов, их размер и веток реестра <br>
<code>cd HKLM:\</code> HKEY_LOCAL_MACHINE <br>
<code>cd HKCU:\</code> HKEY_CURRENT_USER <br>
<code>Get-Item</code> получить информацию о ветке реестра <br>
<code>New-Item</code> создать новый раздел реестра <br>
<code>Remove-Item</code> удалить ветку реестра <br>
<code>Get-ItemProperty</code> получить значение ключей/параметров реестра (это свойства ветки реестра, аналогично свойствам файла) <br>
<code>Set-ItemProperty</code> изменить название или значение параметра реестра <br>
<code>New-ItemProperty</code> создать параметр реестра <br>
<code>Remove-ItemProperty</code> удалить параметр</p>
<p><code>Get-ItemProperty HKLM:\Software\Microsoft\Windows\CurrentVersion\Uninstall\* | Select DisplayName</code> список установленных программ <br>
<code>Get-Item HKCU:\SOFTWARE\Microsoft\Office\16.0\Outlook\Profiles\Outlook\9375CFF0413111d3B88A00104B2A6676\00000002</code> посмотреть содержимое Items <br>
<code>(Get-ItemProperty HKCU:\SOFTWARE\Microsoft\Office\16.0\Outlook\Profiles\Outlook\9375CFF0413111d3B88A00104B2A6676\00000002).&quot;New Signature&quot;</code> отобразить значение (Value) свойства (Property) Items <br>
<code>$reg_path = &quot;HKCU:\SOFTWARE\Microsoft\Office\16.0\Outlook\Profiles\Outlook\9375CFF0413111d3B88A00104B2A6676\00000002&quot;</code> <br>
<code>$sig_name = &quot;auto&quot;</code> <br>
<code>Set-ItemProperty -Path $reg_path -Name &quot;New Signature&quot; -Value $sig_name</code> изменить или добавить в корне ветки (Path) свойство (Name) со значением (Value) <br>
<code>Set-ItemProperty -Path $reg_path -Name &quot;Reply-Forward Signature&quot; -Value $sig_name</code></p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <pre><code>Windows Registry Editor Version 5.00
[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\taskmgr.exe]
&#34;Debugger&#34;=&#34;\&#34;C:\\Windows\\System32\\Taskmgr.exe\&#34;&#34;</code></pre>
    
</div>
<h2 id="performance">Performance</h2>
<p><code>lodctr /R</code> пересоздать счетчиков производительности из системного хранилища архивов (так же исправляет счетчики для CIM, например, для cpu Win32_PerfFormattedData_PerfOS_Processor и iops Win32_PerfFormattedData_PerfDisk_PhysicalDisk) <br>
<code>(Get-Counter -ListSet *).CounterSetName</code> вывести список всех доступных счетчиков производительности в системе <br>
<code>(Get-Counter -ListSet *memory*).Counter</code> поиск по wildcard-имени во всех счетчиках (включая дочернии) <br>
<code>Get-Counter &quot;\Memory\Available MBytes&quot;</code> объем свободной оперативной памяти <br>
<code>Get-Counter -cn $srv &quot;\LogicalDisk(*)\% Free Space&quot;</code> % свободного места на всех разделах дисков <br>
<code>(Get-Counter &quot;\Process(*)\ID Process&quot;).CounterSamples</code> <br>
<code>Get-Counter &quot;\Processor(_Total)\% Processor Time&quot; –ComputerName $srv -MaxSamples 5 -SampleInterval 2</code> 5 проверок каждые 2 секунды <br>
<code>Get-Counter &quot;\Процессор(_Total)\% загруженности процессора&quot; -Continuous</code> непрерывно <br>
<code>(Get-Counter &quot;\Процессор(*)\% загруженности процессора&quot;).CounterSamples</code></p>
<p><code>(Get-Counter -ListSet *интерфейс*).Counter</code> найти все счетчики <br>
<code>Get-Counter &quot;\Сетевой интерфейс(*)\Всего байт/с&quot;</code> отобразить все адаптеры (выбрать действующий по трафику)</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="$WARNING%20=%2025%0d%0a$CRITICAL%20=%2050%0d%0a$TransferRate%20=%20%28%28Get-Counter%20%22%5c%5chuawei-mb-x-pro%5c%d1%81%d0%b5%d1%82%d0%b5%d0%b2%d0%be%d0%b9%20%d0%b8%d0%bd%d1%82%d0%b5%d1%80%d1%84%d0%b5%d0%b9%d1%81%28intel[r]%20wi-fi%206e%20ax211%20160mhz%29%5c%d0%b2%d1%81%d0%b5%d0%b3%d0%be%20%d0%b1%d0%b0%d0%b9%d1%82/%d1%81%22%0d%0a%29.countersamples%20%7c%20select%20-ExpandProperty%20CookedValue%29*8%0d%0a$NetworkUtilisation%20=%20[math]::round%28$TransferRate/1000000000*100,2%29%0d%0aif%20%28$NetworkUtilisation%20-gt%20$CRITICAL%29%7b%0d%0aWrite-Output%20%22CRITICAL:%20$%28$NetworkUtilisation%29%20%25%20Network%20utilisation,%20$%28$TransferRate.ToString%28%27N0%27%29%29%20b/s%22%20%20%20%0d%0a#exit%202%09%09%0d%0a%7d%0d%0aif%20%28$NetworkUtilisation%20-gt%20$WARNING%29%7b%0d%0aWrite-Output%20%22WARNING:%20$%28$NetworkUtilisation%29%20%25%20Network%20utilisation,%20$%28$TransferRate.ToString%28%27N0%27%29%29%20b/s%22%0d%0a#exit%201%0d%0a%7d%0d%0aWrite-Output%20%22OK:%20$%28$NetworkUtilisation%29%20%25%20Network%20utilisation,%20$%28$TransferRate.ToString%28%27N0%27%29%29%20b/s%22%20%20%20%0d%0a#exit%200">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>$WARNING = <span style="color:#ae81ff">25</span>
</span></span><span style="display:flex;"><span>$CRITICAL = <span style="color:#ae81ff">50</span>
</span></span><span style="display:flex;"><span>$TransferRate = ((Get-Counter <span style="color:#e6db74">&#34;\\huawei-mb-x-pro\сетевой интерфейс(intel[r] wi-fi 6e ax211 160mhz)\всего байт/с&#34;</span>
</span></span><span style="display:flex;"><span>).countersamples | select -ExpandProperty CookedValue)*<span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>$NetworkUtilisation = [<span style="color:#66d9ef">math</span>]::round($TransferRate/<span style="color:#ae81ff">1000000000</span>*<span style="color:#ae81ff">100</span>,<span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> ($NetworkUtilisation <span style="color:#f92672">-gt</span> $CRITICAL){
</span></span><span style="display:flex;"><span>Write-Output <span style="color:#e6db74">&#34;CRITICAL: </span>$($NetworkUtilisation)<span style="color:#e6db74"> % Network utilisation, </span>$($TransferRate.ToString(<span style="color:#e6db74">&#39;N0&#39;</span>))<span style="color:#e6db74"> b/s&#34;</span>   
</span></span><span style="display:flex;"><span><span style="color:#75715e">#exit 2		</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> ($NetworkUtilisation <span style="color:#f92672">-gt</span> $WARNING){
</span></span><span style="display:flex;"><span>Write-Output <span style="color:#e6db74">&#34;WARNING: </span>$($NetworkUtilisation)<span style="color:#e6db74"> % Network utilisation, </span>$($TransferRate.ToString(<span style="color:#e6db74">&#39;N0&#39;</span>))<span style="color:#e6db74"> b/s&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#exit 1</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>Write-Output <span style="color:#e6db74">&#34;OK: </span>$($NetworkUtilisation)<span style="color:#e6db74"> % Network utilisation, </span>$($TransferRate.ToString(<span style="color:#e6db74">&#39;N0&#39;</span>))<span style="color:#e6db74"> b/s&#34;</span>   
</span></span><span style="display:flex;"><span><span style="color:#75715e">#exit 0</span></span></span></code></pre></div>
    
</div>
<h2 id="dsc">DSC</h2>
<p><code>Import-Module PSDesiredStateConfiguration</code> <br>
<code>Get-Command -Module PSDesiredStateConfiguration</code> <br>
<code>(Get-Module PSDesiredStateConfiguration).ExportedCommands</code> <br>
<code>Get-DscLocalConfigurationManager</code></p>
<p><code>Get-DscResource</code> <br>
<code>Get-DscResource -Name File -Syntax</code> <a href="https://learn.microsoft.com/ru-ru/powershell/dsc/reference/resources/windows/fileresource?view=dsc-1.1">синтаксис</a></p>
<p><code>Ensure = Present</code> настройка должна быть включена (каталог должен присутствовать, процесс должен быть запущен, если нет – создать, запустить) <br>
<code>Ensure = Absent</code> настройка должна быть выключена (каталога быть не должно, процесс не должен быть запущен, если нет – удалить, остановить)</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span><span style="color:#66d9ef">Configuration</span> TestConfiguraion
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    Ctrl+Space
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Configuration</span> DSConfigurationProxy 
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    Node vproxy-<span style="color:#ae81ff">01</span> 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        File CreateDir
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            Ensure = <span style="color:#e6db74">&#34;Present&#34;</span>
</span></span><span style="display:flex;"><span>            Type = <span style="color:#e6db74">&#34;Directory&#34;</span>
</span></span><span style="display:flex;"><span>            DestinationPath = <span style="color:#e6db74">&#34;C:\Temp&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        Service StopW32time
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            Name = <span style="color:#e6db74">&#34;w32time&#34;</span>
</span></span><span style="display:flex;"><span>            State = <span style="color:#e6db74">&#34;Stopped&#34;</span>` Running
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>		WindowsProcess RunCalc
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            Ensure = <span style="color:#e6db74">&#34;Present&#34;</span>
</span></span><span style="display:flex;"><span>            Path = <span style="color:#e6db74">&#34;C:\WINDOWS\system32\calc.exe&#34;</span>
</span></span><span style="display:flex;"><span>            Arguments = <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        Registry RegSettings
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            Ensure = <span style="color:#e6db74">&#34;Present&#34;</span>
</span></span><span style="display:flex;"><span>            Key = <span style="color:#e6db74">&#34;HKEY_LOCAL_MACHINE\SOFTWARE\MySoft&#34;</span>
</span></span><span style="display:flex;"><span>            ValueName = <span style="color:#e6db74">&#34;TestName&#34;</span>
</span></span><span style="display:flex;"><span>            ValueData = <span style="color:#e6db74">&#34;TestValue&#34;</span>
</span></span><span style="display:flex;"><span>            ValueType = <span style="color:#e6db74">&#34;String&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span><span style="color:#75715e">#		WindowsFeature IIS</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#       {</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#            Ensure = &#34;Present&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#            Name = &#34;Web-Server&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#       }</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
    
</div>
<p><code>$Path = (DSConfigurationProxy).DirectoryName</code> <br>
<code>Test-DscConfiguration -Path $Path | select *</code> ResourcesInDesiredState - уже настроено, ResourcesNotInDesiredState - не настроено (не соответствует) <br>
<code>Start-DscConfiguration -Path $Path</code> <br>
<code>Get-Job</code> <br>
<code>$srv = &quot;vproxy-01&quot;</code> <br>
<code>Get-Service -ComputerName $srv | ? name -match w32time # Start-Service</code> <br>
<code>icm $srv {Get-Process | ? ProcessName -match calc} | ft # Stop-Process -Force</code> <br>
<code>icm $srv {ls C:\ | ? name -match Temp} | ft</code> rm`</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span><span style="color:#66d9ef">Configuration</span> InstallPowerShellCore {
</span></span><span style="display:flex;"><span>    Import-DscResource -ModuleName PSDesiredStateConfiguration
</span></span><span style="display:flex;"><span>    Node localhost {
</span></span><span style="display:flex;"><span>        Script InstallPowerShellCore {
</span></span><span style="display:flex;"><span>            GetScript = {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> @{
</span></span><span style="display:flex;"><span>                    GetScript = $GetScript
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            SetScript = {
</span></span><span style="display:flex;"><span>				[<span style="color:#66d9ef">string</span>]$url = $(Invoke-RestMethod https<span style="color:#960050;background-color:#1e0010">:</span>//api.github.com/repos/PowerShell/PowerShell/releases/latest).assets.browser_download_url <span style="color:#f92672">-match</span> <span style="color:#e6db74">&#34;win-x64.zip&#34;</span>
</span></span><span style="display:flex;"><span>                $downloadPath = <span style="color:#e6db74">&#34;</span>$home<span style="color:#e6db74">\Downloads\PowerShell.zip&#34;</span>
</span></span><span style="display:flex;"><span>                $installPath = <span style="color:#e6db74">&#34;</span>$env:ProgramFiles<span style="color:#e6db74">\PowerShell\7&#34;</span>
</span></span><span style="display:flex;"><span>                Invoke-WebRequest -Uri $url -OutFile $downloadPath
</span></span><span style="display:flex;"><span>                Expand-Archive -Path $downloadPath -DestinationPath $installPath -Force
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            TestScript = {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> Test-Path <span style="color:#e6db74">&#34;</span>$env:ProgramFiles<span style="color:#e6db74">\PowerShell\7\pwsh.exe&#34;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
    
</div>
<p><code>$Path = (InstallPowerShellCore).DirectoryName</code> <br>
<code>Test-DscConfiguration -Path $Path</code> <br>
<code>Start-DscConfiguration -Path $path -Wait -Verbose</code> <br>
<code>Get-Job</code></p>
<h2 id="oh-my-posh">oh-my-posh</h2>
<p><a href="https://ohmyposh.dev/docs/installation/windows">Install</a></p>
<p><code>winget install JanDeDobbeleer.OhMyPosh -s winget</code> <br>
<code>choco install oh-my-posh -y</code> <br>
<code>scoop install https://github.com/JanDeDobbeleer/oh-my-posh/releases/latest/download/oh-my-posh.json</code> <br>
<code>Set-ExecutionPolicy Bypass -Scope Process -Force; Invoke-Expression ((New-Object System.Net.WebClient).DownloadString('https://ohmyposh.dev/install.ps1'))</code></p>
<p><a href="https://ohmyposh.dev/docs/themes">Themes</a></p>
<p><code>Get-PoshThemes</code> <br>
<code>oh-my-posh init pwsh --config &quot;$env:POSH_THEMES_PATH/di4am0nd.omp.json&quot; | Invoke-Expression</code> <br>
<code>oh-my-posh init pwsh --config &quot;https://raw.githubusercontent.com/JanDeDobbeleer/oh-my-posh/main/themes/cert.omp.json&quot; | Invoke-Expression</code></p>
<p><code>New-Item -Path $PROFILE -Type File -Force</code> <br>
<code>notepad $PROFILE</code> <br>
<code>oh-my-posh init pwsh --config &quot;$env:POSH_THEMES_PATH/di4am0nd.omp.json&quot; | Invoke-Expression</code></p>
<h3 id="themes-performance">themes-performance</h3>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="Install-Module%20themes-performance%20-Repository%20NuGet%0d%0aImport-Module%20themes-performance%0d%0aSet-PoshTheme%20-Theme%20System-Sensors%20#%20-Save%0d%0aSet-PoshTheme%20-Theme%20System-Performance%20#%20-Save%0d%0aSet-PoshTheme%20-Theme%20Pwsh-Process-Performance%20#%20-Save">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>Install-Module themes-performance -Repository NuGet
</span></span><span style="display:flex;"><span>Import-Module themes-performance
</span></span><span style="display:flex;"><span>Set-PoshTheme -Theme System-Sensors <span style="color:#75715e"># -Save</span>
</span></span><span style="display:flex;"><span>Set-PoshTheme -Theme System-Performance <span style="color:#75715e"># -Save</span>
</span></span><span style="display:flex;"><span>Set-PoshTheme -Theme Pwsh-Process-Performance <span style="color:#75715e"># -Save</span></span></span></code></pre></div>
    
</div>
<h3 id="terminal-icons">Terminal-Icons</h3>
<p><code>Install-Module -Name Terminal-Icons -Repository PSGallery</code> <br>
<code>scoop bucket add extras</code> <br>
<code>scoop install terminal-icons</code></p>
<p><code>notepad $PROFILE</code> <br>
<code>Import-Module -Name Terminal-Icons</code></p>
<p>Использует шрифты, которые необходимо установить и настроить в параметрах профиля PowerShell: <a href="https://github.com/ryanoasis/nerd-fonts">Nerd Fonts</a> <br>
<a href="https://www.nerdfonts.com/font-downloads">Список шрифтов</a> <br>
Скачать и установить шрифт похожий на Cascadia Code - <a href="https://github.com/ryanoasis/nerd-fonts/releases/download/v3.1.1/CascadiaCode.zip">CaskaydiaCove</a></p>
<h2 id="pester">Pester</h2>
<p><a href="https://github.com/pester/Pester">Source</a></p>
<p><code>Install-Module -Name Pester -Repository PSGallery -Force -AllowClobber</code> <br>
<code>Import-Module Pester</code> <br>
<code>$(Get-Module Pester -ListAvailable).Version</code></p>
<p><code>.Tests.ps1</code></p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="function%20Add-Numbers%20%7b%0d%0a%20%20%20%20param%20%28%0d%0a%20%20%20%20%20%20%20%20[int]$a,%0d%0a%20%20%20%20%20%20%20%20[int]$b%0d%0a%20%20%20%20%29%0d%0a%20%20%20%20$a%20&#43;%20$b%0d%0a%7d%0d%0aDescribe%20%22Add-Numbers%22%20%7b%0d%0a%20%20%20%20Context%20%22%d0%9f%d1%80%d0%b8%20%d1%81%d0%bb%d0%be%d0%b6%d0%b5%d0%bd%d0%b8%d0%b8%20%d0%b4%d0%b2%d1%83%d1%85%20%d1%87%d0%b8%d1%81%d0%b5%d0%bb%22%20%7b%0d%0a%20%20%20%20%20%20%20%20It%20%22%d0%94%d0%be%d0%bb%d0%b6%d0%bd%d0%b0%20%d0%b2%d0%b5%d1%80%d0%bd%d1%83%d1%82%d1%8c%d1%81%d1%8f%20%d0%bf%d1%80%d0%b0%d0%b2%d0%b8%d0%bb%d1%8c%d0%bd%d0%b0%d1%8f%20%d1%81%d1%83%d0%bc%d0%bc%d0%b0%22%20%7b%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20$result%20=%20Add-Numbers%20-a%203%20-b%204%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20$result%20%7c%20Should%20-Be%207%0d%0a%20%20%20%20%20%20%20%20%7d%0d%0a%20%20%20%20%7d%0d%0a%20%20%20%20Context%20%22%d0%9f%d1%80%d0%b8%20%d1%81%d0%bb%d0%be%d0%b6%d0%b5%d0%bd%d0%b8%d0%b8%20%d0%b4%d0%b2%d1%83%d1%85%20%d1%87%d0%b8%d1%81%d0%b5%d0%bb%22%20%7b%0d%0a%20%20%20%20%20%20%20%20It%20%22%d0%94%d0%be%d0%bb%d0%b6%d0%bd%d0%b0%20%d0%b2%d0%b5%d1%80%d0%bd%d1%83%d1%82%d1%8c%d1%81%d1%8f%20%d0%be%d1%88%d0%b8%d0%b1%d0%ba%d0%b0%20%285&#43;0%20-ne%204%29%22%20%7b%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20$result%20=%20Add-Numbers%20-a%205%20-b%200%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20$result%20%7c%20Should%20-Be%204%0d%0a%20%20%20%20%20%20%20%20%7d%0d%0a%20%20%20%20%7d%0d%0a%7d%0d%0a%0d%0afunction%20Get-RunningProcess%20%7b%0d%0a%20%20%20%20return%20Get-Process%20%7c%20Select-Object%20-ExpandProperty%20Name%0d%0a%7d%0d%0aDescribe%20%22Get-RunningProcess%22%20%7b%0d%0a%20%20%20%20Context%20%22%d0%9f%d1%80%d0%b8%20%d0%bd%d0%b0%d0%bb%d0%b8%d1%87%d0%b8%d0%b8%20%d0%b7%d0%b0%d0%bf%d1%83%d1%89%d0%b5%d0%bd%d0%bd%d1%8b%d1%85%20%d0%bf%d1%80%d0%be%d1%86%d0%b5%d1%81%d1%81%d0%be%d0%b2%22%20%7b%0d%0a%20%20%20%20%20%20%20%20It%20%22%d0%94%d0%be%d0%bb%d0%b6%d0%b5%d0%bd%20%d0%b2%d0%be%d0%b7%d0%b2%d1%80%d0%b0%d1%89%d0%b0%d1%82%d1%8c%20%d1%81%d0%bf%d0%b8%d1%81%d0%be%d0%ba%20%d0%b8%d0%bc%d0%b5%d0%bd%20%d0%bf%d1%80%d0%be%d1%86%d0%b5%d1%81%d1%81%d0%be%d0%b2%22%20%7b%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20$result%20=%20Get-RunningProcess%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20$result%20%7c%20Should%20-Contain%20%22svchost%22%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20$result%20%7c%20Should%20-Contain%20%22explorer%22%0d%0a%20%20%20%20%20%20%20%20%7d%0d%0a%20%20%20%20%7d%0d%0a%20%20%20%20Context%20%22%d0%9a%d0%be%d0%b3%d0%b4%d0%b0%20%d0%bd%d0%b5%d1%82%20%d0%b7%d0%b0%d0%bf%d1%83%d1%89%d0%b5%d0%bd%d0%bd%d1%8b%d1%85%20%d0%bf%d1%80%d0%be%d1%86%d0%b5%d1%81%d1%81%d0%be%d0%b2%22%20%7b%0d%0a%20%20%20%20%20%20%20%20It%20%22%d0%94%d0%be%d0%bb%d0%b6%d0%b5%d0%bd%20%d0%b2%d0%be%d0%b7%d0%b2%d1%80%d0%b0%d1%89%d0%b0%d1%82%d1%8c%20%d0%bf%d1%83%d1%81%d1%82%d0%be%d0%b9%20%d1%81%d0%bf%d0%b8%d1%81%d0%be%d0%ba%22%20%7b%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20#%20%d0%97%d0%b0%d0%bc%d0%be%d0%ba%d0%b0%d1%82%d1%8c%20%d1%84%d1%83%d0%bd%d0%ba%d1%86%d0%b8%d1%8e%20Get-Process,%20%d1%87%d1%82%d0%be%d0%b1%d1%8b%20%d0%be%d0%bd%d0%b0%20%d0%b2%d1%81%d0%b5%d0%b3%d0%b4%d0%b0%20%d0%b2%d0%be%d0%b7%d0%b2%d1%80%d0%b0%d1%89%d0%b0%d0%bb%d0%b0%20%d0%bf%d1%83%d1%81%d1%82%d0%be%d0%b9%20%d1%81%d0%bf%d0%b8%d1%81%d0%be%d0%ba%20%d0%bf%d1%80%d0%be%d1%86%d0%b5%d1%81%d1%81%d0%be%d0%b2%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20Mock%20Get-Process%20%7b%20return%20@%28%29%20%7d%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20$result%20=%20Get-RunningProcess%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20$result%20%7c%20Should%20-BeEmpty%0d%0a%20%20%20%20%20%20%20%20%7d%0d%0a%20%20%20%20%7d%0d%0a%7d">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> Add-Numbers {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">param</span> (
</span></span><span style="display:flex;"><span>        [<span style="color:#66d9ef">int</span>]$a,
</span></span><span style="display:flex;"><span>        [<span style="color:#66d9ef">int</span>]$b
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    $a + $b
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>Describe <span style="color:#e6db74">&#34;Add-Numbers&#34;</span> {
</span></span><span style="display:flex;"><span>    Context <span style="color:#e6db74">&#34;При сложении двух чисел&#34;</span> {
</span></span><span style="display:flex;"><span>        It <span style="color:#e6db74">&#34;Должна вернуться правильная сумма&#34;</span> {
</span></span><span style="display:flex;"><span>            $result = Add-Numbers -a <span style="color:#ae81ff">3</span> -b <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>            $result | Should -Be <span style="color:#ae81ff">7</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    Context <span style="color:#e6db74">&#34;При сложении двух чисел&#34;</span> {
</span></span><span style="display:flex;"><span>        It <span style="color:#e6db74">&#34;Должна вернуться ошибка (5+0 -ne 4)&#34;</span> {
</span></span><span style="display:flex;"><span>            $result = Add-Numbers -a <span style="color:#ae81ff">5</span> -b <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>            $result | Should -Be <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> Get-RunningProcess {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> Get-Process | Select-Object -ExpandProperty Name
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>Describe <span style="color:#e6db74">&#34;Get-RunningProcess&#34;</span> {
</span></span><span style="display:flex;"><span>    Context <span style="color:#e6db74">&#34;При наличии запущенных процессов&#34;</span> {
</span></span><span style="display:flex;"><span>        It <span style="color:#e6db74">&#34;Должен возвращать список имен процессов&#34;</span> {
</span></span><span style="display:flex;"><span>            $result = Get-RunningProcess
</span></span><span style="display:flex;"><span>            $result | Should -Contain <span style="color:#e6db74">&#34;svchost&#34;</span>
</span></span><span style="display:flex;"><span>            $result | Should -Contain <span style="color:#e6db74">&#34;explorer&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    Context <span style="color:#e6db74">&#34;Когда нет запущенных процессов&#34;</span> {
</span></span><span style="display:flex;"><span>        It <span style="color:#e6db74">&#34;Должен возвращать пустой список&#34;</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Замокать функцию Get-Process, чтобы она всегда возвращала пустой список процессов</span>
</span></span><span style="display:flex;"><span>            Mock Get-Process { <span style="color:#66d9ef">return</span> @() }
</span></span><span style="display:flex;"><span>            $result = Get-RunningProcess
</span></span><span style="display:flex;"><span>            $result | Should -BeEmpty
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
    
</div>

            
        </div>
    </article>

        </main>

        <footer class="footer">
    <div class="footer-left">
        <ul class="social">
            
                <li>GitHub</li>
            

            
                <li>Lifailon</li>
            

            
                
            
                
            
                
                    <li>
                        
                            <a href="https://github.com/Lifailon" target="_blank">
                                <i class="bi-github"></i>
                            </a>
                        

                    </li>
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
        </ul>
    </div>

    <div class="footer-right">
        <ul class="control status clearfix">
            

            
            

            

            
                <li>
                    <a href="https://gohugo.io" class="btn" target="_blank"
                        >Hugo: 0.123.8</a
                    >
                </li>
            

            
                <li>
                    <a
                        href="https://github.com/JingWangTW/dark-theme-editor"
                        class="btn"
                        target="_blank"
                        >Theme: dark-theme-editor</a
                    >
                </li>
            

            
                <li>
                    
                        Last modified: &nbsp;
                        <time>
                            Mar 14 2024
                        </time>
                    
                </li>
            

            
        </ul>
    </div>
</footer>

    </body>

    























    
    


    
    


    <script
        type="text/javascript"
        src="/js/index_d751713.min.5eeb120f16ea146352725c420364f87befead45f678142b8f0ffbef024646931fbc06bff07a7bd6cb57fa2f8cd8a21ba6a4ee5a278ec32303a378bc1cd17f246.js"
        integrity="sha512-XusSDxbqFGNSclxCA2T4e&#43;/q1F9ngUK48P&#43;&#43;8CRkaTH7wGv/B6e9bLV/ovjNiiG6ak7lonjsMjA6N4vBzRfyRg=="></script>














<link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" />




</html>
