<!DOCTYPE html>
<html lang="en-us">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="generator" content="Hugo 0.123.8">

    

    

    
        
            <meta
                name="description"
                content="Large base of PowerShell notes in Russian language" />
        

        
            <meta
                name="keywords"
                content="PowerShell" />
        

        
            <meta name="author" content="Lifailon" />
        

    


    <title>
        
            Hypervisor |
            Lifailon.GitHub.io
        
    </title>

    


    
    

    
    


    
    


    
    


    
    

    


    
    

    

    

        
            
            <link
                rel="stylesheet"
                href="/reset.min_6851612176967065231.3662e40c85350bf0bcf308b7db81c173e4b690b862d3c3cde460de5155550bf055b7ff48cddb1cf5255e55f0355196d8dec1d49434b2457842cc77ebea198f3f.css"
                integrity="sha512-NmLkDIU1C/C88wi324HBc&#43;S2kLhi08PN5GDeUVVVC/BVt/9Izdsc9SVeVfA1UZbY3sHUlDSyRXhCzHfr6hmPPw==" />
        
            
            <link
                rel="stylesheet"
                href="/_theme/css/01_layout.26ffaaf7a32c233cbe1c7c9093d3b744e9466ea0a11559a8f3350a40468de72856a6fd3fd8f38bc13f66093fbeeee908d56483cac2ac01de75b17f999fd2606a.css"
                integrity="sha512-Jv&#43;q96MsIzy&#43;HHyQk9O3ROlGbqChFVmo8zUKQEaN5yhWpv0/2POLwT9mCT&#43;&#43;7ukI1WSDysKsAd51sX&#43;Zn9Jgag==" />
        
            
            <link
                rel="stylesheet"
                href="/_theme/css/02_style.6e547a963eb4b47b8466738206d9e1d164b1af63a268440672bd5138749f058278dbecc942f26f32c884fba203dc138d3dbdc0d3b559a049feec71464bb56ca1.css"
                integrity="sha512-blR6lj60tHuEZnOCBtnh0WSxr2OiaEQGcr1ROHSfBYJ42&#43;zJQvJvMsiE&#43;6ID3BONPb3A07VZoEn&#43;7HFGS7VsoQ==" />
        
            
            <link
                rel="stylesheet"
                href="/_theme/css/03_home.c12c2a68104bddb5523ceeaafb439534c4574cc4e78ffbab3a8e7d8c2bd3bd4eab28a89e9039fb588153dbf64108c4eafaee3c52d6192050f7ef5ec4ecc7c21f.css"
                integrity="sha512-wSwqaBBL3bVSPO6q&#43;0OVNMRXTMTnj/urOo59jCvTvU6rKKiekDn7WIFT2/ZBCMTq&#43;u48UtYZIFD3717E7MfCHw==" />
        
            
            <link
                rel="stylesheet"
                href="/_theme/css/04_responsive.cd3527afabdc02c3c117d57389f622b57e143ac3ee5dcc150b0e4b6ef262353217a1bf92f365e0f23f3021fd5e97abab71b1f06c2c431e885f46a27f5d9e9730.css"
                integrity="sha512-zTUnr6vcAsPBF9VzifYitX4UOsPuXcwVCw5LbvJiNTIXob&#43;S82Xg8j8wIf1el6urcbHwbCxDHohfRqJ/XZ6XMA==" />
        
            
            <link
                rel="stylesheet"
                href="/_theme/css/05_markdown.b84d310882bf53ceaa3e614e623874bb542bacb17445bb27c2deb29e6dc0525a4d9fa5c49532000df51ca1cb29d2697dcd4ec4ef2493bd86f5d820de17ebae21.css"
                integrity="sha512-uE0xCIK/U86qPmFOYjh0u1QrrLF0Rbsnwt6ynm3AUlpNn6XElTIADfUcocsp0ml9zU7E7ySTvYb12CDeF&#43;uuIQ==" />
        

    


    
    

    

    

    

    
</head>



    <body>
        <header class="header">
    <div class="header_left">
        
    </div>

    <div class="header_middle">
        
            Hypervisor -
            Lifailon.GitHub.io
        
    </div>
</header>



        <main>
            <aside class="sidebar">
    



    
    

    
    


    <ul class="section-tree">
        
            
                <li class="file">
                    <a href="http://localhost:1313/dotnet/" title="./dotnet/">
                        .NET
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/activedirectory/" title="./activedirectory/">
                        Active Directory
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/mssql/" title="./mssql/">
                        Active Directory
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/network/" title="./network/">
                        Active Directory
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/odbc/" title="./odbc/">
                        Active Directory
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/restapi/" title="./restapi/">
                        Active Directory
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/software/" title="./software/">
                        Active Directory
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/wmi/" title="./wmi/">
                        Active Directory
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/zabbix/" title="./zabbix/">
                        Active Directory
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/ansible/" title="./ansible/">
                        Ansible
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/com/" title="./com/">
                        Component Object Model
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/git/" title="./git/">
                        Git
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/html/" title="./html/">
                        HTML
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/vmware/" title="./vmware/">
                        Hypervisor
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/influxdb/" title="./influxdb/">
                        InfluxDB
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/exchange/" title="./exchange/">
                        MS Exchange
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/mysql/" title="./mysql/">
                        MySQL
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="http://localhost:1313/powershell/" title="./powershell/">
                        PowerShell Commands
                    </a>
                </li>
            
        
    </ul>


</aside>
<aside class="exapandable"></aside>


            
    <article class="main">
        <button
    class="sidebar-toggle-btn"
    type="menu"
    aria-expanded="false"
    aria-haspopup="true">
    <i class="bi bi-list"></i>
</button>



        <div class="title">
            <h1 class="title-header">
                Hypervisor
            </h1>

            <div class="author-date-readtime">
                

                    
                        <div class="author" title="Author">
                            <i class="bi bi-person"></i>
                            <a
                                href="/author/lifailon/"
                                class="cat-btn">
                                Lifailon
                            </a>
                        </div>
                    

                

                
                    <div class="date" title="Date">
                        <i class="bi bi-calendar3"></i>
                        <time
                            datetime="Mar 14 2024"
                            >Mar 14 2024
                        </time>
                    </div>
                

                
                    <div
                        class="readtime"
                        title="Time to Read">
                        <i class="bi bi-clock"></i>
                        4 mins to read
                    </div>
                
            </div>
        </div>

        <div class="article-meta">
            

            

            
                <div class="breadcumb">
                    <i class="bi bi-folder"></i>
                    
    




<a href="http://localhost:1313/" class="bread-btn">
    
        <i class="bi bi-house-fill"></i>
    

    
        Home
    
</a>




    /



<a href="http://localhost:1313/vmware/" class="bread-btn">
    

    
        Hypervisor
    
</a>

                </div>
            

            
        </div>

        
            <nav id="TableOfContents">
  <ul>
    <li><a href="#vmware">VMWare</a></li>
    <li><a href="#hyper-v">Hyper-V</a></li>
  </ul>
</nav>
        


        <div class="content">
            
                <h2 id="vmware">VMWare</h2>
<p><code>Install-Module -Name VMware.PowerCLI # -AllowClobber</code> установить модуль (PackageProvider: nuget) <br>
<code>Get-Module -ListAvailable VMware* | Select Name,Version</code> <br>
<code>Import-Module VMware.VimAutomation.Core</code> импортировать в сессию <br>
<code>Get-PSProvider | format-list Name,PSSnapIn,ModuleName</code> список оснасток Windows PowerShell</p>
<p><code>Get-PowerCLIConfiguration</code> конфигурация подключения <br>
<code>Set-PowerCLIConfiguration -Scope AllUsers -InvalidCertificateAction ignore -confirm:$false</code> eсли используется самоподписанный сертификат, изменить значение параметра InvalidCertificateAction с Unset на Ignore/Warn <br>
<code>Set-PowerCLIConfiguration -Scope AllUsers -ParticipateInCeip $false</code> отключить уведомление сбора данных через VMware Customer Experience Improvement Program (CEIP)</p>
<p><code>Read-Host –AsSecureString | ConvertFrom-SecureString | Out-File &quot;$home\Documents\vcsa_password.txt&quot;</code> зашифровать пароль и сохранить в файл <br>
<code>$esxi = &quot;vcsa.domain.local&quot;</code> <br>
<code>$user = &quot;administrator@vsphere.local&quot;</code> <br>
<code>$pass = Get-Content &quot;$home\Documents\vcsa_password.txt&quot; | ConvertTo-SecureString</code> прочитать пароль <br>
<code>$pass = &quot;password&quot;</code> <br>
<code>$Cred = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList $user ,$pass</code> <br>
<code>Connect-VIServer $esxi -User $Cred.Username -Password $Cred.GetNetworkCredential().password</code> подключиться, используя PSCredential ($Cred) <br>
<code>Connect-VIServer $esxi -User $user -Password $pass</code> подключиться, используя логин и пароль</p>
<p><code>Get-Command –Module *vmware*</code> <br>
<code>Get-Command –Module *vmware* -name *get*iscsi*</code> <br>
<code>Get-IScsiHbaTarget</code> <br>
<code>Get-Datacenter</code> <br>
<code>Get-Cluster</code> <br>
<code>Get-VMHost</code> <br>
<code>Get-VMHost | select Name,Model,ProcessorType,MaxEVCMode,NumCpu,CpuTotalMhz,CpuUsageMhz,MemoryTotalGB,MemoryUsageGB</code> <br>
<code>Get-VMHostDisk | select VMHost,ScsiLun,TotalSectors</code></p>
<p><code>Get-Datastore</code> <br>
<code>Get-Datastore TNAS-vmfs-4tb-01</code> <br>
<code>Get-Datastore TNAS-vmfs-4tb-01 | get-vm</code> <br>
<code>Get-Datastore -RelatedObject vm-01</code> <br>
<code>(Get-Datastore TNAS-vmfs-4tb-01).ExtensionData.Info.GetType()</code> <br>
<code>(Get-Datastore TNAS-vmfs-4tb-01).ExtensionData.Info.Vmfs.Extent</code></p>
<p><code>Get-Command –Module *vmware* -name *disk*</code> <br>
<code>Get-VM vm-01 | Get-Datastore</code> <br>
<code>Get-VM vm-01 | Get-HardDisk</code> <br>
<code>Get-VM | Get-HardDisk | select Parent,Name,CapacityGB,StorageFormat,FileName | ft</code> <br>
<code>Copy-HardDisk</code> <br>
<code>Get-VM | Get-Snapshot</code> <br>
<code>Get-VM | where {$_.Powerstate -eq &quot;PoweredOn&quot;}</code> <br>
<code>Get-VMHost esxi-05 | Get-VM | where {$_.Powerstate -eq &quot;PoweredOff&quot;} | Move-VM –Destination (Get-VMHost esxi-06)</code></p>
<p><code>Get-VM | select Name,VMHost,PowerState,NumCpu,MemoryGB,</code> <br>
<code>@{Name=&quot;UsedSpaceGB&quot;; Expression={[int32]($_.UsedSpaceGB)}},@{Name=&quot;ProvisionedSpaceGB&quot;; Expression={[int32]($_.ProvisionedSpaceGB)}},</code> <br>
<code>CreateDate,CpuHotAddEnabled,MemoryHotAddEnabled,CpuHotRemoveEnabled,Notes</code></p>
<p><code>Get-VMGuest vm-01 | Update-Tools</code> <br>
<code>Get-VMGuest vm-01 | select OSFullName,IPAddress,HostName,State,Disks,Nics,ToolsVersion</code> <br>
<code>Get-VMGuest * | select -ExpandProperty IPAddress</code> <br>
<code>Restart-VMGuest -vm vm-01 -Confirm:$False</code> <br>
<code>Start-VM -vm vm-01 -Confirm:$False</code> <br>
<code>Shutdown-VMGuest -vm vm-01 -Confirm:$false</code></p>
<p><code>New-VM –Name vm-01 -VMHost esxi-06 –ResourcePool Production –DiskGB 60 –DiskStorageFormat Thin –Datastore TNAS-vmfs-4tb-01</code> <br>
<code>Get-VM vm-01 | Copy-VMGuestFile -Source &quot;\\$srv\Install\Soft\Btest.exe&quot; -Destination &quot;C:\Install\&quot; -LocalToGuest -GuestUser USER -GuestPassword PASS -force</code></p>
<p><code>Get-VM -name vm-01 | Export-VApp -Destination C:\Install -Format OVF</code> Export template (.ovf, .vmdk, .mf) <br>
<code>Get-VM -name vm-01 | Export-VApp -Destination C:\Install -Format OVA</code></p>
<p><code>Get-VMHostNetworkAdapter | select VMHost,Name,Mac,IP,@{Label=&quot;Port Group&quot;; Expression={$_.ExtensionData.Portgroup}} | ft</code> <br>
<code>Get-VM | Get-NetworkAdapter | select Parent,Name,Id,Type,MacAddress,ConnectionState,WakeOnLanEnabled | ft</code></p>
<p><code>Get-Command –Module *vmware* -name *event*</code> <br>
<code>Get-VIEvent -MaxSamples 1000 | where {($_.FullFormattedMessage -match &quot;power&quot;)} | select username,CreatedTime,FullFormattedMessage</code> <br>
<code>Get-logtype | select Key,SourceEntityId,Filename,Creator,Info</code> <br>
<code>(Get-Log vpxd:vpxd.log).Entries | select -Last 50</code></p>
<p><code>Get-Command –Module *vmware* -name *syslog*</code> <br>
<code>Set-VMHostSysLogServer -VMHost esxi-05 -SysLogServer &quot;tcp://192.168.3.100&quot; -SysLogServerPort 3515</code> <br>
<code>Get-VMHostSysLogServer -VMHost esxi-05</code></p>
<h2 id="hyper-v">Hyper-V</h2>
<p><code>Install-WindowsFeature -Name Hyper-V -IncludeManagementTools -Restart</code> установить роль на Windows Server <br>
<code>Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Hyper-V –All</code> установить роль на  Windows Desktop <br>
<code>Get-Command -Module hyper-v</code> <br>
<code>Get-VMHost</code></p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="New-VMSwitch%20-name%20NAT%20-SwitchType%20Internal%20#%20%d1%81%d0%be%d0%b7%d0%b4%d0%b0%d1%82%d1%8c%20%d0%b2%d0%b8%d1%80%d1%82%d1%83%d0%b0%d0%bb%d1%8c%d0%bd%d1%8b%d0%b9%20%d0%ba%d0%be%d0%bc%d0%bc%d1%83%d1%82%d0%b0%d1%82%d0%be%d1%80%20%d0%b8%20%d0%b0%d0%b4%d0%b0%d0%bf%d1%82%d0%b5%d1%80%20%d0%b4%d0%bb%d1%8f%20%d0%bd%d0%b5%d0%b3%d0%be%0d%0aGet-NetAdapter%20%7c%20where%20InterfaceDescription%20-match%20Hyper-V%20#%20%d1%81%d0%bf%d0%b8%d1%81%d0%be%d0%ba%20%d1%81%d0%b5%d1%82%d0%b5%d0%b2%d1%8b%d1%85%20%d0%b0%d0%b4%d0%b0%d0%bf%d1%82%d0%b5%d1%80%d0%be%d0%b2%0d%0aNew-NetNat%20-Name%20LocalNat%20-InternalIPInterfaceAddressPrefix%20%22192.168.3.0/24%22%20#%20%d0%b7%d0%b0%d0%b4%d0%b0%d1%82%d1%8c%20%d1%81%d0%b5%d1%82%d1%8c%0d%0aGet-NetAdapter%20%22vEthernet%20%28NAT%29%22%20%7c%20New-NetIPAddress%20-IPAddress%20192.168.3.200%20-AddressFamily%20IPv4%20-PrefixLength%2024%20#%20%d0%bf%d1%80%d0%b8%d1%81%d0%b2%d0%be%d0%b8%d1%82%d1%8c%20%d0%b0%d0%b4%d1%80%d0%b5%d1%81,%20%d0%bd%d0%b5%d0%be%d0%b1%d1%85%d0%be%d0%b4%d0%b8%d0%bc%d0%be%20%d0%bd%d0%b0%20%d0%92%d0%9c%20%d1%83%d0%ba%d0%b0%d0%b7%d0%b0%d1%82%d1%8c%20%d1%88%d0%bb%d1%8e%d0%b7%20192.168.3.200,%20%d1%87%d1%82%d0%be%20%d0%b1%d1%8b%20%d0%bd%d0%b0%d1%85%d0%be%d0%b4%d0%b8%d1%82%d1%8c%d1%81%d1%8f%20%d0%b7%d0%b0%20NAT,%20%d0%b8%d0%bb%d0%b8%20%d0%b2%20%d0%bd%d0%b0%d1%81%d1%82%d1%80%d0%be%d0%b9%d0%ba%d0%b0%20%d0%92%d0%9c%20%d1%83%d0%ba%d0%b0%d0%b7%d0%b0%d1%82%d1%8c%20%d1%81%d0%be%d0%be%d1%82%d0%b2%d0%b5%d1%82%d1%81%d1%82%d0%b2%d1%83%d1%8e%d1%89%d0%b8%d0%b9%20%d0%b0%d0%b4%d0%b0%d0%bf%d1%82%d0%b5%d1%80%0d%0aAdd-NetNatStaticMapping%20-NatName%20LocalNat%20-Protocol%20TCP%20-ExternalIPAddress%200.0.0.0%20-ExternalPort%202222%20-InternalIPAddress%20192.168.3.103%20-InternalPort%202121%20#%20%d0%bf%d1%80%d0%be%d0%b1%d1%80%d0%be%d1%81,%20%d0%b2%d0%b5%d1%81%d1%82%20%d1%82%d1%80%d0%b0%d1%84%d0%b8%d0%ba%20%d0%ba%d0%be%d1%82%d0%be%d1%80%d1%8b%d0%b9%20%d0%bf%d1%80%d0%b8%d1%85%d0%be%d0%b4%d0%b8%d1%82%20%d0%bd%d0%b0%20%d1%85%d0%be%d1%81%d1%82%20Hyper-V%20TCP/2222,%20%d0%b1%d1%83%d0%b4%d0%b5%d1%82%20%d0%bf%d0%b5%d1%80%d0%b5%d0%bd%d0%b0%d0%bf%d1%80%d0%b0%d0%b2%d0%bb%d1%8f%d1%82%d1%8c%d1%81%d1%8f%20%d0%bd%d0%b0%20%d1%81%d0%be%d0%be%d1%82%d0%b2%d0%b5%d1%82%d1%81%d1%82%d0%b2%d1%83%d1%8e%d1%89%d0%b8%d0%b9%20%d0%bf%d0%be%d1%80%d1%82%20%d0%b2%d0%b8%d1%80%d1%82%d1%83%d0%b0%d0%bb%d1%8c%d0%bd%d0%be%d0%b9%20%d0%bc%d0%b0%d1%88%d0%b8%d0%bd%d1%8b%20%d0%b7%d0%b0%20NAT.%0d%0a%28Get-NetAdapter%20%7c%20where%20Name%20-match%20NAT%29.Status">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>New-VMSwitch -name NAT -SwitchType Internal <span style="color:#75715e"># создать виртуальный коммутатор и адаптер для него</span>
</span></span><span style="display:flex;"><span>Get-NetAdapter | where InterfaceDescription <span style="color:#f92672">-match</span> Hyper-V <span style="color:#75715e"># список сетевых адаптеров</span>
</span></span><span style="display:flex;"><span>New-NetNat -Name LocalNat -InternalIPInterfaceAddressPrefix <span style="color:#e6db74">&#34;192.168.3.0/24&#34;</span> <span style="color:#75715e"># задать сеть</span>
</span></span><span style="display:flex;"><span>Get-NetAdapter <span style="color:#e6db74">&#34;vEthernet (NAT)&#34;</span> | New-NetIPAddress -IPAddress <span style="color:#ae81ff">192.168</span>.3.200 -AddressFamily IPv4 -PrefixLength <span style="color:#ae81ff">24</span> <span style="color:#75715e"># присвоить адрес, необходимо на ВМ указать шлюз 192.168.3.200, что бы находиться за NAT, или в настройка ВМ указать соответствующий адаптер</span>
</span></span><span style="display:flex;"><span>Add-NetNatStaticMapping -NatName LocalNat -Protocol TCP -ExternalIPAddress <span style="color:#ae81ff">0.0</span>.0.0 -ExternalPort <span style="color:#ae81ff">2222</span> -InternalIPAddress <span style="color:#ae81ff">192.168</span>.3.103 -InternalPort <span style="color:#ae81ff">2121</span> <span style="color:#75715e"># проброс, вест трафик который приходит на хост Hyper-V TCP/2222, будет перенаправляться на соответствующий порт виртуальной машины за NAT.</span>
</span></span><span style="display:flex;"><span>(Get-NetAdapter | where Name <span style="color:#f92672">-match</span> NAT).Status</span></span></code></pre></div>
    
</div>
<p><code>Get-NetNatStaticMapping</code> отобразить пробросы (NAT) <br>
<code>Get-NetNat</code> список сетей <br>
<code>Remove-NetNatStaticMapping -StaticMappingID 0</code> удалить проброс <br>
<code>Remove-NetNat -Name LocalNat</code> удалить сеть</p>
<p><code>New-VMSwitch -Name Local -AllowManagementOS $True -NetAdapterName &quot;Ethernet 4&quot; -SwitchType External</code> создать вшений (External) виртуальный коммутатор <br>
<code>$VMName = &quot;hv-dc-01&quot;</code></p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>$VM = @{
</span></span><span style="display:flex;"><span>Name = $VMName
</span></span><span style="display:flex;"><span>MemoryStartupBytes = <span style="color:#ae81ff">4</span>Gb
</span></span><span style="display:flex;"><span>Generation = <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>NewVHDPath = <span style="color:#e6db74">&#34;D:\VM\</span>$VMName<span style="color:#e6db74">\</span>$VMName<span style="color:#e6db74">.vhdx&#34;</span>
</span></span><span style="display:flex;"><span>NewVHDSizeBytes = <span style="color:#ae81ff">50</span>Gb
</span></span><span style="display:flex;"><span>BootDevice = <span style="color:#e6db74">&#34;VHD&#34;</span>
</span></span><span style="display:flex;"><span>Path = <span style="color:#e6db74">&#34;D:\VM\</span>$VMName<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>SwitchName = <span style="color:#e6db74">&#34;NAT&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>New-VM @VM</span></span></code></pre></div>
    
</div>
<p><code>Set-VMDvdDrive -VMName $VMName -Path &quot;C:\Users\Lifailon\Documents\WS-2016.iso&quot;</code> <br>
<code>New-VHD -Path &quot;D:\VM\$VMName\disk_d.vhdx&quot; -SizeBytes 10GB</code> создать VHDX диск <br>
<code>Add-VMHardDiskDrive -VMName $VMName -Path &quot;D:\VM\$VMName\disk_d.vhdx&quot;</code> примонтировать диск <br>
<code>Get-VM –VMname $VMName | Set-VM –AutomaticStartAction Start</code> автозапуск <br>
<code>Get-VM -Name $VMName | Set-VMMemory -StartupBytes 8Gb</code> <br>
<code>Set-VMProcessor $VMName -Count 2</code> <br>
<code>Get-VM -Name $VMName | Checkpoint-VM -SnapshotName &quot;Snapshot-1&quot;</code> <br>
<code>Restore-VMCheckpoint -Name Snapshot-1&quot; -VMName $VMName -Confirm:$false</code> <br>
<code>Get-VM | Select -ExpandProperty NetworkAdapters | Select VMName,IPAddresses,Status</code> получить IP адрес всех ВМ <br>
<code>vmconnect.exe localhost $VMHost</code></p>
<p><code>Get-NetTCPConnection -State Established,Listen | Where-Object LocalPort -Match 2179</code> найти порт слушателя
<code>Get-Process -Id (Get-NetTCPConnection -State Established,Listen | Where-Object LocalPort -Match 2179).OwningProcess</code> найти процесс по ID (vmms/VMConnect) <br>
<code>New-NetFirewallRule -Name &quot;Hyper-V&quot; -DisplayName &quot;Hyper-V&quot; -Group &quot;Hyper-V&quot; -Direction Inbound -Protocol TCP -LocalPort 2179 -Action Allow -Profile Public</code> <br>
<code>Get-LocalGroupMember -Group &quot;Администраторы Hyper-V&quot;</code> или &ldquo;Hyper-V Administrators&rdquo; <br>
<code>Add-LocalGroupMember -Group &quot;Администраторы Hyper-V&quot; -Member &quot;lifailon&quot;</code> <br>
<code>Get-VM * | select name,ID</code> добавить id в RDCMan для подключения <br>
<code>Grant-VMConnectAccess -ComputerName plex-01 -VMName hv-devops-01 -UserName lifailon</code> дать доступ на подключение не администратору <br>
<code>Grant-VMConnectAccess -ComputerName huawei-book -VMName hv-devops-01 -UserName lifailon</code> <br>
<code>Get-VMConnectAccess</code> <br>
<code>Revoke-VMConnectAccess -VMName hv-devops-01 -UserName lifailon</code></p>
<p>Error: <code>Unknown disconnection reason 3848</code> - добавить ключи реестра на стороне клиента</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>New-ItemProperty -Path HKLM<span style="color:#960050;background-color:#1e0010">:</span>\SYSTEM\CurrentControlSet\Control\Lsa\Credssp\PolicyDefaults\AllowFreshCredentialsDomain -Name Hyper-V -PropertyType String -Value <span style="color:#e6db74">&#34;Microsoft Virtual Console Service/*&#34;</span> -Force
</span></span><span style="display:flex;"><span>New-ItemProperty -Path HKLM<span style="color:#960050;background-color:#1e0010">:</span>\SYSTEM\CurrentControlSet\Control\Lsa\Credssp\PolicyDefaults\AllowDefaultCredentials -Name Hyper-V -PropertyType String -Value <span style="color:#e6db74">&#34;Microsoft Virtual Console Service/*&#34;</span> -Force
</span></span><span style="display:flex;"><span>New-ItemProperty -Path HKLM<span style="color:#960050;background-color:#1e0010">:</span>\SYSTEM\CurrentControlSet\Control\Lsa\Credssp\PolicyDefaults\AllowFreshCredentialsWhenNTLMOnlyDomain -Name Hyper-V -PropertyType String -Value <span style="color:#e6db74">&#34;Microsoft Virtual Console Service/*&#34;</span> -Force
</span></span><span style="display:flex;"><span>ItemProperty -Path HKLM<span style="color:#960050;background-color:#1e0010">:</span>\SYSTEM\CurrentControlSet\Control\Lsa\Credssp\PolicyDefaults\AllowDefaultCredentialsDomain -Name Hyper-V -PropertyType String -Value <span style="color:#e6db74">&#34;Microsoft Virtual Console Service/*&#34;</span> -Force
</span></span><span style="display:flex;"><span>New-ItemProperty -Path HKLM<span style="color:#960050;background-color:#1e0010">:</span>\SYSTEM\CurrentControlSet\Control\Lsa\Credssp\PolicyDefaults\AllowFreshCredentials -Name Hyper-V -PropertyType String -Value <span style="color:#e6db74">&#34;Microsoft Virtual Console Service/*&#34;</span> -Force
</span></span><span style="display:flex;"><span>New-ItemProperty -Path HKLM<span style="color:#960050;background-color:#1e0010">:</span>\SYSTEM\CurrentControlSet\Control\Lsa\Credssp\PolicyDefaults\AllowFreshCredentialsWhenNTLMOnly -Name Hyper-V -PropertyType String -Value <span style="color:#e6db74">&#34;Microsoft Virtual Console Service/*&#34;</span> -Force
</span></span><span style="display:flex;"><span>New-ItemProperty -Path HKLM<span style="color:#960050;background-color:#1e0010">:</span>\SYSTEM\CurrentControlSet\Control\Lsa\Credssp\PolicyDefaults\AllowSavedCredentialsWhenNTLMOnly -Name Hyper-V -PropertyType String -Value <span style="color:#e6db74">&#34;Microsoft Virtual Console Service/*&#34;</span> -Force
</span></span><span style="display:flex;"><span>New-ItemProperty -Path HKLM<span style="color:#960050;background-color:#1e0010">:</span>\SYSTEM\CurrentControlSet\Control\Lsa\Credssp\PolicyDefaults\AllowSavedCredentials -Name Hyper-V -PropertyType String -Value <span style="color:#e6db74">&#34;Microsoft Virtual Console Service/*&#34;</span> -Force
</span></span><span style="display:flex;"><span>New-ItemProperty -Path HKLM<span style="color:#960050;background-color:#1e0010">:</span>\SYSTEM\CurrentControlSet\Control\Lsa\Credssp\PolicyDefaults\AllowSavedCredentialsDomain -Name Hyper-V -PropertyType String -Value <span style="color:#e6db74">&#34;Microsoft Virtual Console Service/*&#34;</span> -Force</span></span></code></pre></div>
    
</div>

            
        </div>
    </article>

        </main>

        <footer class="footer">
    <div class="footer-left">
        <ul class="social">
            
                <li>GitHub</li>
            

            
                <li>Lifailon</li>
            

            
                
            
                
            
                
                    <li>
                        
                            <a href="https://github.com/Lifailon" target="_blank">
                                <i class="bi-github"></i>
                            </a>
                        

                    </li>
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
        </ul>
    </div>

    <div class="footer-right">
        <ul class="control status clearfix">
            

            
            

            

            
                <li>
                    <a href="https://gohugo.io" class="btn" target="_blank"
                        >Hugo: 0.123.8</a
                    >
                </li>
            

            
                <li>
                    <a
                        href="https://github.com/JingWangTW/dark-theme-editor"
                        class="btn"
                        target="_blank"
                        >Theme: dark-theme-editor</a
                    >
                </li>
            

            
                <li>
                    
                        Last modified: &nbsp;
                        <time>
                            Mar 14 2024
                        </time>
                    
                </li>
            

            
        </ul>
    </div>
</footer>

    </body>

    






















    
        
        <script
            type="text/javascript"
            src="/_theme/js/codeblock_copy.2e8ec6d1c2acd298acca044dd90a3e6c550bfe467768a22d8ce69c30cefdf813e1f2bdf31939c94542b977db46bdc0e844c807779972408d8a58df29657a635b.js"
            integrity="sha512-Lo7G0cKs0pisygRN2Qo&#43;bFUL/kZ3aKItjOacMM79&#43;BPh8r3zGTnJRUK5d9tGvcDoRMgHd5lyQI2KWN8pZXpjWw=="></script>
    
        
        <script
            type="text/javascript"
            src="/_theme/js/dir_toggle.35e8f79b370b43fa56a12e33f2a6498fdd571d6d857796df2ade4bf9af6a2d6b274fcc3846de6aa679a12d2e9cce53330ee1eeec121bc40d0a42d98b2b413b8f.js"
            integrity="sha512-Nej3mzcLQ/pWoS4z8qZJj91XHW2Fd5bfKt5L&#43;a9qLWsnT8w4Rt5qpnmhLS6czlMzDuHu7BIbxA0KQtmLK0E7jw=="></script>
    
        
        <script
            type="text/javascript"
            src="/_theme/js/sidebar.c85fe41e1d2b187f402cf6abbc0273c6c8b0767b0d20dec7ca6134a4dc3e01a4bc8a9bcee30203dea8546be9fdbd73d53e09aa8908f54a44429ca324e81905da.js"
            integrity="sha512-yF/kHh0rGH9ALParvAJzxsiwdnsNIN7HymE0pNw&#43;AaS8ipvO4wID3qhUa&#43;n9vXPVPgmqiQj1SkRCnKMk6BkF2g=="></script>
    















<link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" />




</html>
