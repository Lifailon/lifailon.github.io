<!DOCTYPE html>
<html lang="en-us">
    <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="generator" content="Hugo 0.123.8">

    

    

    
        
            <meta
                name="description"
                content="This is my new hugo site" />
        

        
            <meta
                name="keywords"
                content="hugo,site,new" />
        

        
            <meta name="author" content="Lifailon" />
        

    


    <title>
        
            Zabbix |
            Lifailon.GitHub.io
        
    </title>

    


    
    

    
    


    
    


    
    


    
    

    


    
    

    

    

        
        


        
        


        <link
            rel="stylesheet"
            href="/css/index_d751713.min.912d03bce61461ecbc3ca083479e1ed814bba94df76d0bdc6aa88fdca33621b9bb410dc2c81af31e8101fec62decfa5f6e48901ad673bc5056d2f1d1f2368a34.css"
            integrity="sha512-kS0DvOYUYey8PKCDR54e2BS7qU33bQvcaqiP3KM2Ibm7QQ3CyBrzHoEB/sYt7PpfbkiQGtZzvFBW0vHR8jaKNA==" />
    


    
    

    

    

    

    
</head>



    <body>
        <header class="header">
    <div class="header_left">
        
    </div>

    <div class="header_middle">
        
            Zabbix -
            Lifailon.GitHub.io
        
    </div>
</header>



        <main>
            <aside class="sidebar">
    



    
    

    
    


    <ul class="section-tree">
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/github/" title="./github/">
                        GitHub
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/powershell/" title="./powershell/">
                        PowerShell
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/dotnet/" title="./dotnet/">
                        .NET
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/activedirectory/" title="./activedirectory/">
                        Active Directory
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/ansible/" title="./ansible/">
                        Ansible
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/api/" title="./api/">
                        API
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/apps/" title="./apps/">
                        Apps
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/com/" title="./com/">
                        Component Object Model
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/git/" title="./git/">
                        Git
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/html/" title="./html/">
                        HTML
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/influxdb/" title="./influxdb/">
                        InfluxDB
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/exchange/" title="./exchange/">
                        MS Exchange
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/mssql/" title="./mssql/">
                        MS SQL
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/mysql/" title="./mysql/">
                        MySQL
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/network/" title="./network/">
                        Network
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/virtualization/" title="./virtualization/">
                        Virtualization
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/wmi/" title="./wmi/">
                        WMI
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/zabbix/" title="./zabbix/">
                        Zabbix
                    </a>
                </li>
            
        
    </ul>


</aside>
<aside class="exapandable"></aside>


            
    <article class="main">
        <button
    class="sidebar-toggle-btn"
    type="menu"
    aria-expanded="false"
    aria-haspopup="true">
    <i class="bi bi-list"></i>
</button>



        <div class="title">
            <h1 class="title-header">
                Zabbix
            </h1>

            <div class="author-date-readtime">
                

                    
                        <div class="author" title="Author">
                            <i class="bi bi-person"></i>
                            <a
                                href="/author/lifailon/"
                                class="cat-btn">
                                Lifailon
                            </a>
                        </div>
                    

                

                
                    <div class="date" title="Date">
                        <i class="bi bi-calendar3"></i>
                        <time
                            datetime="Mar 14 2024"
                            >Mar 14 2024
                        </time>
                    </div>
                

                
                    <div
                        class="readtime"
                        title="Time to Read">
                        <i class="bi bi-clock"></i>
                        5 mins to read
                    </div>
                
            </div>
        </div>

        <div class="article-meta">
            

            

            
                <div class="breadcumb">
                    <i class="bi bi-folder"></i>
                    
    




<a href="https://lifailon.github.io/" class="bread-btn">
    
        <i class="bi bi-house-fill"></i>
    

    
        Home
    
</a>




    /



<a href="https://lifailon.github.io/zabbix/" class="bread-btn">
    

    
        Zabbix
    
</a>

                </div>
            

            
        </div>

        
            <nav id="TableOfContents">
  <ul>
    <li><a href="#zabbix-agent-deploy">Zabbix Agent Deploy</a></li>
    <li><a href="#zabbix_sender">zabbix_sender</a></li>
    <li><a href="#zabbix_get">zabbix_get</a></li>
    <li><a href="#userparameter">UserParameter</a></li>
    <li><a href="#include">Include</a></li>
    <li><a href="#zabbix_agent2conf">zabbix_agent2.conf</a></li>
    <li><a href="#api-token">API Token</a></li>
    <li><a href="#userget">user.get</a></li>
    <li><a href="#problemget">problem.get</a></li>
    <li><a href="#hostget">host.get</a></li>
    <li><a href="#itemget">item.get</a></li>
    <li><a href="#historyget">history.get</a></li>
    <li><a href="#convert-secconds-to-timespan-and-datetime">Convert Secconds To TimeSpan and DateTime</a></li>
    <li><a href="#convert-from-unix-time">Convert From Unix Time</a></li>
  </ul>
</nav>
        


        <div class="content">
            
                <h2 id="zabbix-agent-deploy">Zabbix Agent Deploy</h2>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>$url = <span style="color:#e6db74">&#34;https://cdn.zabbix.com/zabbix/binaries/stable/6.4/6.4.5/zabbix_agent2-6.4.5-windows-amd64-static.zip&#34;</span>
</span></span><span style="display:flex;"><span>$path = <span style="color:#e6db74">&#34;</span>$home<span style="color:#e6db74">\Downloads\zabbix-agent2-6.4.5.zip&#34;</span>
</span></span><span style="display:flex;"><span>$WebClient = New-Object System.Net.WebClient
</span></span><span style="display:flex;"><span>$WebClient.DownloadFile($url, $path)` скачать файл
</span></span><span style="display:flex;"><span>Expand-Archive $path -DestinationPath <span style="color:#e6db74">&#34;C:\zabbix-agent2-6.4.5\&#34;</span>` разархивировать
</span></span><span style="display:flex;"><span>Remove-Item $path` удалить архив
</span></span><span style="display:flex;"><span>New-NetFirewallRule -DisplayName <span style="color:#e6db74">&#34;Zabbix-Agent&#34;</span> -Profile Any -Direction Inbound -Action Allow -Protocol TCP -LocalPort <span style="color:#ae81ff">10050</span>,<span style="color:#ae81ff">10051</span>` открыть порты в FW
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$Zabbix_Server = <span style="color:#e6db74">&#34;192.168.3.102&#34;</span>
</span></span><span style="display:flex;"><span>$conf = <span style="color:#e6db74">&#34;C:\zabbix-agent2-6.4.5\conf\zabbix_agent2.conf&#34;</span>
</span></span><span style="display:flex;"><span>$cat = cat $conf
</span></span><span style="display:flex;"><span>$rep = $cat <span style="color:#f92672">-replace</span> <span style="color:#e6db74">&#34;Server=.+&#34;</span>,<span style="color:#e6db74">&#34;Server=</span>$Zabbix_Server<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>$rep | Select-String Server=
</span></span><span style="display:flex;"><span>$rep &gt; $conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$exe = <span style="color:#e6db74">&#34;C:\zabbix-agent2-6.4.5\bin\zabbix_agent2.exe&#34;</span>
</span></span><span style="display:flex;"><span>.$exe --config $conf --install` установить службу
</span></span><span style="display:flex;"><span>Get-Service *Zabbix*Agent* | Start-Service` запустить службу
</span></span><span style="display:flex;"><span><span style="color:#75715e">#.$exe --config $conf --uninstall` удалить службу</span></span></span></code></pre></div>
    
</div>
<h2 id="zabbix_sender">zabbix_sender</h2>
<p>Создать host - задать произвольное имя (powershell-host) и добавить в группу <br>
Создать Items: <br>
Name: Service Count <br>
Type: Zabbix trapper <br>
Key: service.count <br>
Type of Information: Numeric</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>$path = <span style="color:#e6db74">&#34;C:\zabbix-agent2-6.4.5\bin&#34;</span>
</span></span><span style="display:flex;"><span>$scount = (Get-Service).Count
</span></span><span style="display:flex;"><span>.$path\zabbix_sender.exe -z <span style="color:#ae81ff">192.168</span>.3.102 -s <span style="color:#e6db74">&#34;powershell-host&#34;</span> -k service.count -o $scount</span></span></code></pre></div>
    
</div>
<h2 id="zabbix_get">zabbix_get</h2>
<p><code>apt install zabbix-get</code> <br>
<code>nano /etc/zabbix/zabbix_agentd.conf</code> <br>
<code>Server=127.0.0.1,192.168.3.102,192.168.3.99</code> добавить сервера для получения данных zabbix_get с агента (как их запрашивает сервер)</p>
<p><code>.$path\zabbix_get -s 192.168.3.101 -p 10050 -k agent.version</code> проверить версию агента <br>
<code>.$path\zabbix_get -s 192.168.3.101 -p 10050 -k agent.ping</code> 1 - ok <br>
<code>.$path\zabbix_get -s 192.168.3.101 -p 10050 -k net.if.discovery</code> список сетевых интерфейсов <br>
<code>.$path\zabbix_get -s 192.168.3.101 -p 10050 -k net.if.in[&quot;ens33&quot;]</code> <br>
<code>.$path\zabbix_get -s 192.168.3.101 -p 10050 -k net.if.out[&quot;ens33&quot;]</code></p>
<h2 id="userparameter">UserParameter</h2>
<p><code>UserParameter=process.count,powershell -Command &quot;(Get-Process).Count&quot;</code> <br>
<code>UserParameter=process.vm[*],powershell -Command &quot;(Get-Process $1).ws&quot;</code></p>
<p>Test: <br>
<code>C:\zabbix-agent2-6.4.5\bin\zabbix_get.exe -s 127.0.0.1 -p 10050 -k process.count</code> <br>
<code>C:\zabbix-agent2-6.4.5\bin\zabbix_get.exe -s 127.0.0.1 -p 10050 -k process.vm[zabbix_agent2] </code><br>
<code>C:\zabbix-agent2-6.4.5\bin\zabbix_get.exe -s 127.0.0.1 -p 10050 -k process.vm[powershell]</code></p>
<p>Создать новые Items: <br>
key: <code>process.count</code> <br>
key: <code>process.vm[zabbix_agent2]</code></p>
<h2 id="include">Include</h2>
<ul>
<li>
<p>Добавить параметр Include для включения конфигурационных файлов подключаемых плагинов
<code>'Include=.\zabbix_agent2.d\plugins.d\*.conf' &gt;&gt; C:\zabbix-agent2-6.4.5\conf\zabbix_agent2.conf</code></p>
</li>
<li>
<p>Создать конфигурационный файл с пользовательскими параметрами в каталоге, путь к которому указан в zabbix_agentd.conf <br>
<code>'UserParameter=Get-Query-Param[*],powershell.exe -noprofile -executionpolicy bypass -File C:\zabbix-agent2-6.4.5\conf\zabbix_agent2.d\scripts\User-Sessions\Get-Query-Param.ps1 $1' &gt; C:\zabbix-agent2-6.4.5\conf\zabbix_agent2.d\plugins.d\User-Sessions.conf</code></p>
</li>
<li>
<p>Поместить скрипт Get-Query-Param.ps1 в каталог, путь к которому указан в User-Sessions.conf. Скрипт содержим пользовательские параметры, которые он принимает от Zabbix сервера для передачи их в функции скрипта.</p>
</li>
</ul>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="Param%28[string]$select%29%0d%0aif%20%28$select%20-eq%20%22ACTIVEUSER%22%29%20%7b%0d%0a%28Get-Query%20%7c%20where%20status%20-match%20%22Active%22%29.User%0d%0a%7d%0d%0aif%20%28$select%20-eq%20%22INACTIVEUSER%22%29%20%7b%0d%0a%28Get-Query%20%7c%20where%20status%20-match%20%22Disconnect%22%29.User%0d%0a%7d%0d%0aif%20%28$select%20-eq%20%22ACTIVECOUNT%22%29%20%7b%0d%0a%28Get-Query%20%7c%20where%20status%20-match%20%22Active%22%29.Status.Count%0d%0a%7d%0d%0aif%20%28$select%20-eq%20%22INACTIVECOUNT%22%29%20%7b%0d%0a%28Get-Query%20%7c%20where%20status%20-match%20%22Disconnect%22%29.Status.Count%0d%0a%7d">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span><span style="color:#66d9ef">Param</span>([<span style="color:#66d9ef">string</span>]$select)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> ($select <span style="color:#f92672">-eq</span> <span style="color:#e6db74">&#34;ACTIVEUSER&#34;</span>) {
</span></span><span style="display:flex;"><span>(Get-Query | where status <span style="color:#f92672">-match</span> <span style="color:#e6db74">&#34;Active&#34;</span>).User
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> ($select <span style="color:#f92672">-eq</span> <span style="color:#e6db74">&#34;INACTIVEUSER&#34;</span>) {
</span></span><span style="display:flex;"><span>(Get-Query | where status <span style="color:#f92672">-match</span> <span style="color:#e6db74">&#34;Disconnect&#34;</span>).User
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> ($select <span style="color:#f92672">-eq</span> <span style="color:#e6db74">&#34;ACTIVECOUNT&#34;</span>) {
</span></span><span style="display:flex;"><span>(Get-Query | where status <span style="color:#f92672">-match</span> <span style="color:#e6db74">&#34;Active&#34;</span>).Status.Count
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> ($select <span style="color:#f92672">-eq</span> <span style="color:#e6db74">&#34;INACTIVECOUNT&#34;</span>) {
</span></span><span style="display:flex;"><span>(Get-Query | where status <span style="color:#f92672">-match</span> <span style="color:#e6db74">&#34;Disconnect&#34;</span>).Status.Count
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
    
</div>
<ul>
<li>Проверить работу скрипта:</li>
</ul>
<p><code>$path = &quot;C:\zabbix-agent2-6.4.5\conf\zabbix_agent2.d\scripts\User-Sessions&quot;</code> <br>
<code>.$path\Get-Query-Param.ps1 ACTIVEUSER</code> <br>
<code>.$path\Get-Query-Param.ps1 INACTIVEUSER</code> <br>
<code>.$path\Get-Query-Param.ps1 ACTIVECOUNT</code> <br>
<code>.$path\Get-Query-Param.ps1 INACTIVECOUNT</code></p>
<ul>
<li>Создать Items с ключами:</li>
</ul>
<p><code>Get-Query-Param[ACTIVEUSER]</code> Type: Text <br>
<code>Get-Query-Param[INACTIVEUSER]</code> Type: Text <br>
<code>Get-Query-Param[ACTIVECOUNT]</code> Type: Int <br>
<code>Get-Query-Param[INACTIVECOUNT]</code> Type: Int</p>
<ul>
<li>Макросы:</li>
</ul>
<p><code>{$ACTIVEMAX} = 16</code> <br>
<code>{$ACTIVEMIN} = 0</code></p>
<ul>
<li>Триггеры:</li>
</ul>
<p><code>last(/Windows-User-Sessions/Get-Query-Param[ACTIVECOUNT])&gt;{$ACTIVEMAX}</code> <br>
<code>min(/Windows-User-Sessions/Get-Query-Param[ACTIVECOUNT],24h)={$ACTIVEMIN}</code></p>
<h2 id="zabbix_agent2conf">zabbix_agent2.conf</h2>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <pre><code># Агент может работать в пассивном (сервер забирает сам информацию) и активном режиме (агент сам отправляет):
Server=192.168.3.102
ServerActive=192.168.3.102
# Требуется указать hostname для ServerActive:
Hostname=huawei-book-01
# Если не указано, используется для генерации имени хоста (игнорируется, если имя хоста определено):
# HostnameItem=system.hostname
# Как часто обновляется список активных проверок, в секундах (Range: 60-3600):
RefreshActiveChecks=120
# IP-адрес источника для исходящих соединений:
# SourceIP=
# Агент будет слушать на этом порту соединения с сервером (Range: 1024-32767):
# ListenPort=10050
# Список IP-адресов, которые агент должен прослушивать через запятую
# ListenIP=0.0.0.0
# Агент будет прослушивать этот порт для запросов статуса HTTP (Range: 1024-32767):
# StatusPort=
ControlSocket=\\.\pipe\agent.sock
# Куда вести журнал (file/syslog/console):
LogType=file
LogFile=C:\zabbix-agent2-6.4.5\zabbix_agent2.log
# Размер лога от 0-1024 MB (0 - отключить автоматическую ротацию логов)
LogFileSize=100
# Уровень логирования. 4 - для отладки (выдает много информации)
DebugLevel=4</code></pre>
    
</div>
<h2 id="api-token">API Token</h2>
<p><a href="https://www.zabbix.com/documentation/current/en/manual/api/reference">Documentation</a></p>
<p><code>$ip = &quot;192.168.3.102&quot;</code> <br>
<code>$url = &quot;http://$ip/zabbix/api_jsonrpc.php&quot;</code></p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="$data%20=%20@%7b%0d%0a%20%20%20%20%22jsonrpc%22=%222.0%22;%0d%0a%20%20%20%20%22method%22=%22user.login%22;%0d%0a%20%20%20%20%22params%22=@%7b%0d%0a%20%20%20%20%20%20%20%20%22username%22=%22Admin%22;%60%20%d0%b2%20%d0%b2%d0%b5%d1%80%d1%81%d0%b8%d0%b8%20%d0%b4%d0%be%206.4%20%d0%bf%d0%b0%d1%80%d0%b0%d0%bc%d0%b5%d1%82%d1%80%20%22user%22%0d%0a%20%20%20%20%20%20%20%20%22password%22=%22zabbix%22;%0d%0a%20%20%20%20%7d;%0d%0a%20%20%20%20%22id%22=1;%0d%0a%7d%0d%0a$token%20=%20%28Invoke-RestMethod%20-Method%20POST%20-Uri%20$url%20-Body%20%28$data%20%7c%20ConvertTo-Json%29%20-ContentType%20%22application/json%22%29.Result">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>$data = @{
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;jsonrpc&#34;</span>=<span style="color:#e6db74">&#34;2.0&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;method&#34;</span>=<span style="color:#e6db74">&#34;user.login&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;params&#34;</span>=@{
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;username&#34;</span>=<span style="color:#e6db74">&#34;Admin&#34;</span>;` в версии до <span style="color:#ae81ff">6.4</span> параметр <span style="color:#e6db74">&#34;user&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;password&#34;</span>=<span style="color:#e6db74">&#34;zabbix&#34;</span>;
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;id&#34;</span>=<span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>$token = (Invoke-RestMethod -Method POST -Uri $url -Body ($data | ConvertTo-Json) -ContentType <span style="color:#e6db74">&#34;application/json&#34;</span>).Result</span></span></code></pre></div>
    
</div>
<p><code>$token = &quot;2eefd25fdf1590ebcdb7978b5bcea1fff755c65b255da8cbd723181b639bb789&quot;</code> сгенерировать токен в UI (http://192.168.3.102/zabbix/zabbix.php?action=token.list)</p>
<h2 id="userget">user.get</h2>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="$data%20=%20@%7b%0d%0a%20%20%20%20%22jsonrpc%22=%222.0%22;%0d%0a%20%20%20%20%22method%22=%22user.get%22;%0d%0a%20%20%20%20%22params%22=@%7b%0d%0a%20%20%20%20%7d;%0d%0a%20%20%20%20%22auth%22=$token;%0d%0a%20%20%20%20%22id%22=1;%0d%0a%7d%0d%0a$users%20=%20%28Invoke-RestMethod%20-Method%20POST%20-Uri%20$url%20-Body%20%28$data%20%7c%20ConvertTo-Json%29%20-ContentType%20%22application/json%22%29.Result">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>$data = @{
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;jsonrpc&#34;</span>=<span style="color:#e6db74">&#34;2.0&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;method&#34;</span>=<span style="color:#e6db74">&#34;user.get&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;params&#34;</span>=@{
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;auth&#34;</span>=$token;
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;id&#34;</span>=<span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>$users = (Invoke-RestMethod -Method POST -Uri $url -Body ($data | ConvertTo-Json) -ContentType <span style="color:#e6db74">&#34;application/json&#34;</span>).Result</span></span></code></pre></div>
    
</div>
<h2 id="problemget">problem.get</h2>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="$data%20=%20@%7b%0d%0a%20%20%20%20%22jsonrpc%22=%222.0%22;%0d%0a%20%20%20%20%22method%22=%22problem.get%22;%0d%0a%20%20%20%20%22params%22=@%7b%0d%0a%20%20%20%20%7d;%0d%0a%20%20%20%20%22auth%22=$token;%0d%0a%20%20%20%20%22id%22=1;%0d%0a%7d%0d%0a%28Invoke-RestMethod%20-Method%20POST%20-Uri%20$url%20-Body%20%28$data%20%7c%20ConvertTo-Json%29%20-ContentType%20%22application/json%22%29.Result">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>$data = @{
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;jsonrpc&#34;</span>=<span style="color:#e6db74">&#34;2.0&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;method&#34;</span>=<span style="color:#e6db74">&#34;problem.get&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;params&#34;</span>=@{
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;auth&#34;</span>=$token;
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;id&#34;</span>=<span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>(Invoke-RestMethod -Method POST -Uri $url -Body ($data | ConvertTo-Json) -ContentType <span style="color:#e6db74">&#34;application/json&#34;</span>).Result</span></span></code></pre></div>
    
</div>
<h2 id="hostget">host.get</h2>
<p>Получить список всех хостов (имя и id)</p>
<p><a href="https://www.zabbix.com/documentation/current/en/manual/api/reference/host">Endpoint host</a></p>
<p>host.create - creating new hosts <br>
host.delete - deleting hosts <br>
host.get - retrieving hosts <br>
host.massadd - adding related objects to hosts <br>
host.massremove - removing related objects from hosts <br>
host.massupdate - replacing or removing related objects from hosts <br>
host.update - updating hosts</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="$data%20=%20@%7b%0d%0a%20%20%20%20%22jsonrpc%22=%222.0%22;%0d%0a%20%20%20%20%22method%22=%22host.get%22;%0d%0a%20%20%20%20%22params%22=@%7b%0d%0a%20%20%20%20%20%20%20%20%22output%22=@%28%60%20%d0%be%d1%82%d1%84%d0%b8%d0%bb%d1%8c%d1%82%d1%80%d0%be%d0%b2%d0%b0%d1%82%d1%8c%20%d0%b2%d1%8b%d0%b2%d0%be%d0%b4%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20%22hostid%22;%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20%22host%22;%0d%0a%20%20%20%20%20%20%20%20%29;%0d%0a%20%20%20%20%7d;%0d%0a%20%20%20%20%22id%22=2;%0d%0a%20%20%20%20%22auth%22=$token;%0d%0a%7d%0d%0a$hosts%20=%20%28Invoke-RestMethod%20-Method%20POST%20-Uri%20$url%20-Body%20%28$data%20%7c%20ConvertTo-Json%29%20-ContentType%20%22application/json%22%29.Result%0d%0a$host_id%20=%20$hosts[3].hostid%60%20%d0%b7%d0%b0%d0%b1%d1%80%d0%b0%d1%82%d1%8c%20id%20%d1%85%d0%be%d1%81%d1%82%d0%b0%20%d0%bf%d0%be%20%d0%b8%d0%bd%d0%b4%d0%b5%d0%ba%d1%81%d1%83">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>$data = @{
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;jsonrpc&#34;</span>=<span style="color:#e6db74">&#34;2.0&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;method&#34;</span>=<span style="color:#e6db74">&#34;host.get&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;params&#34;</span>=@{
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;output&#34;</span>=@(` отфильтровать вывод
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;hostid&#34;</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;host&#34;</span>;
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;id&#34;</span>=<span style="color:#ae81ff">2</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;auth&#34;</span>=$token;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>$hosts = (Invoke-RestMethod -Method POST -Uri $url -Body ($data | ConvertTo-Json) -ContentType <span style="color:#e6db74">&#34;application/json&#34;</span>).Result
</span></span><span style="display:flex;"><span>$host_id = $hosts[<span style="color:#ae81ff">3</span>].hostid` забрать id хоста по индексу</span></span></code></pre></div>
    
</div>
<h2 id="itemget">item.get</h2>
<p>Получить id элементов данных по наименованию ключа для конкретного хоста</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="$data%20=%20@%7b%0d%0a%20%20%20%20%22jsonrpc%22=%222.0%22;%0d%0a%20%20%20%20%22method%22=%22item.get%22;%0d%0a%20%20%20%20%22params%22=@%7b%0d%0a%20%20%20%20%20%20%20%20%22hostids%22=@%28$host_id%29;%60%20%d0%be%d1%82%d1%84%d0%b8%d0%bb%d1%8c%d1%82%d1%80%d0%be%d0%b2%d0%b0%d1%82%d1%8c%20%d0%bf%d0%be%20%d1%85%d0%be%d1%81%d1%82%d1%83%0d%0a%20%20%20%20%7d;%0d%0a%20%20%20%20%22auth%22=$token;%0d%0a%20%20%20%20%22id%22=1;%0d%0a%7d%0d%0a$items%20=%20%28Invoke-RestMethod%20-Method%20POST%20-Uri%20$url%20-Body%20%28$data%20%7c%20ConvertTo-Json%29%20-ContentType%20%22application/json%22%29.Result%0d%0a$items_id%20=%20%28$items%20%7c%20where%20key_%20-match%20system.uptime%29.itemid%60%20%d0%b7%d0%b0%d0%b1%d1%80%d0%b0%d1%82%d1%8c%20id%20%d1%8d%d0%bb%d0%b5%d0%bc%d0%b5%d0%bd%d1%82%d0%b0%20%d0%b4%d0%b0%d0%bd%d0%bd%d1%8b%d1%85">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>$data = @{
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;jsonrpc&#34;</span>=<span style="color:#e6db74">&#34;2.0&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;method&#34;</span>=<span style="color:#e6db74">&#34;item.get&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;params&#34;</span>=@{
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;hostids&#34;</span>=@($host_id);` отфильтровать по хосту
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;auth&#34;</span>=$token;
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;id&#34;</span>=<span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>$items = (Invoke-RestMethod -Method POST -Uri $url -Body ($data | ConvertTo-Json) -ContentType <span style="color:#e6db74">&#34;application/json&#34;</span>).Result
</span></span><span style="display:flex;"><span>$items_id = ($items | where key_ <span style="color:#f92672">-match</span> system.uptime).itemid` забрать id элемента данных</span></span></code></pre></div>
    
</div>
<h2 id="historyget">history.get</h2>
<p>Получить всю историю элемента данных по его id</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="$data%20=%20@%7b%0d%0a%20%20%20%20%22jsonrpc%22=%222.0%22;%0d%0a%20%20%20%20%22method%22=%22history.get%22;%0d%0a%20%20%20%20%22params%22=@%7b%0d%0a%20%20%20%20%20%20%20%20%22hostids%22=@%28$host_id%29;%20%60%20%d1%84%d0%b8%d0%bb%d1%8c%d1%82%d1%80%d0%b0%d1%86%d0%b8%d1%8f%20%d0%bf%d0%be%20%d1%85%d0%be%d1%81%d1%82%d1%83%0d%0a%20%20%20%20%20%20%20%20%22itemids%22=@%28$items_id%29;%60%20%d1%84%d0%b8%d0%bb%d1%8c%d1%82%d1%80%d0%b0%d1%86%d0%b8%d1%8f%20%d0%bf%d0%be%20%d1%8d%d0%bb%d0%b5%d0%bc%d0%b5%d0%bd%d1%82%d1%83%20%d0%b4%d0%b0%d0%bd%d0%bd%d1%8b%d1%85%0d%0a%20%20%20%20%7d;%0d%0a%20%20%20%20%22auth%22=$token;%0d%0a%20%20%20%20%22id%22=1;%0d%0a%7d%0d%0a$items_data_uptime%20=%20%28Invoke-RestMethod%20-Method%20POST%20-Uri%20$url%20-Body%20%28$data%20%7c%20ConvertTo-Json%29%20-ContentType%20%22application/json%22%29.Result%60%20%d0%bf%d0%be%d0%bb%d1%83%d1%87%d0%b8%d1%82%d1%8c%20%d0%b2%d1%81%d0%b5%20%d0%b4%d0%b0%d0%bd%d0%bd%d1%8b%d0%b5%20%d0%bf%d0%be%20%d0%ba%d0%bb%d1%8e%d1%87%d1%83%20%d1%83%20%d0%ba%d0%be%d0%bd%d0%ba%d1%80%d0%b5%d1%82%d0%bd%d0%be%d0%b3%d0%be%20%d1%85%d0%be%d1%81%d1%82%d0%b0">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>$data = @{
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;jsonrpc&#34;</span>=<span style="color:#e6db74">&#34;2.0&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;method&#34;</span>=<span style="color:#e6db74">&#34;history.get&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;params&#34;</span>=@{
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;hostids&#34;</span>=@($host_id); ` фильтрация по хосту
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;itemids&#34;</span>=@($items_id);` фильтрация по элементу данных
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;auth&#34;</span>=$token;
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;id&#34;</span>=<span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>$items_data_uptime = (Invoke-RestMethod -Method POST -Uri $url -Body ($data | ConvertTo-Json) -ContentType <span style="color:#e6db74">&#34;application/json&#34;</span>).Result` получить все данные по ключу у конкретного хоста</span></span></code></pre></div>
    
</div>
<h2 id="convert-secconds-to-timespan-and-datetime">Convert Secconds To TimeSpan and DateTime</h2>
<p><code>$sec = $items_data_uptime.value</code></p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> ConvertSecondsTo-TimeSpan {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">param</span> (
</span></span><span style="display:flex;"><span>        $insec
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    $TimeSpan = [<span style="color:#66d9ef">TimeSpan</span>]::fromseconds($insec)
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;{0:dd&#39; day &#39;hh\:mm\:ss}&#34;</span> <span style="color:#f92672">-f</span> $TimeSpan
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
    
</div>
<p><code>$UpTime = ConvertSecondsTo-TimeSpan $sec[-1]</code></p>
<h2 id="convert-from-unix-time">Convert From Unix Time</h2>
<p><code>$time = $items_data_uptime.clock</code></p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="function%20ConvertFrom-UnixTime%20%7b%0d%0a%20%20%20%20param%20%28%0d%0a%20%20%20%20%20%20%20%20$intime%0d%0a%20%20%20%20%29%0d%0a%20%20%20%20$EpochTime%20=%20[DateTime]%221/1/1970%22%0d%0a%20%20%20%20$TimeZone%20=%20Get-TimeZone%0d%0a%20%20%20%20$UTCTime%20=%20$EpochTime.AddSeconds%28$intime%29%0d%0a%20%20%20%20$UTCTime.AddMinutes%28$TimeZone.BaseUtcOffset.TotalMinutes%29%0d%0a%7d">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> ConvertFrom-UnixTime {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">param</span> (
</span></span><span style="display:flex;"><span>        $intime
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    $EpochTime = [<span style="color:#66d9ef">DateTime</span>]<span style="color:#e6db74">&#34;1/1/1970&#34;</span>
</span></span><span style="display:flex;"><span>    $TimeZone = Get-TimeZone
</span></span><span style="display:flex;"><span>    $UTCTime = $EpochTime.AddSeconds($intime)
</span></span><span style="display:flex;"><span>    $UTCTime.AddMinutes($TimeZone.BaseUtcOffset.TotalMinutes)
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
    
</div>
<p><code>$GetDataTime = ConvertFrom-UnixTime $time[-1]</code></p>
<p><code>($hosts | where hostid -eq $host_id).host</code> получить имя хоста <br>
<code>$UpTime</code> последнее полученное значение времени работы хоста <br>
<code>$GetDataTime</code> время последнего полученного значения</p>

            
        </div>
    </article>

        </main>

        <footer class="footer">
    <div class="footer-left">
        <ul class="social">
            
                <li>GitHub</li>
            

            
                <li>Lifailon</li>
            

            
                
            
                
            
                
                    <li>
                        
                            <a href="https://github.com/Lifailon" target="_blank">
                                <i class="bi-github"></i>
                            </a>
                        

                    </li>
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
        </ul>
    </div>

    <div class="footer-right">
        <ul class="control status clearfix">
            

            
            

            

            
                <li>
                    <a href="https://gohugo.io" class="btn" target="_blank"
                        >Hugo: 0.123.8</a
                    >
                </li>
            

            
                <li>
                    <a
                        href="https://github.com/JingWangTW/dark-theme-editor"
                        class="btn"
                        target="_blank"
                        >Theme: dark-theme-editor</a
                    >
                </li>
            

            
                <li>
                    
                        Last modified: &nbsp;
                        <time>
                            Mar 14 2024
                        </time>
                    
                </li>
            

            
        </ul>
    </div>
</footer>

    </body>

    























    
    


    
    


    <script
        type="text/javascript"
        src="/js/index_d751713.min.5eeb120f16ea146352725c420364f87befead45f678142b8f0ffbef024646931fbc06bff07a7bd6cb57fa2f8cd8a21ba6a4ee5a278ec32303a378bc1cd17f246.js"
        integrity="sha512-XusSDxbqFGNSclxCA2T4e&#43;/q1F9ngUK48P&#43;&#43;8CRkaTH7wGv/B6e9bLV/ovjNiiG6ak7lonjsMjA6N4vBzRfyRg=="></script>














<link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" />




</html>
