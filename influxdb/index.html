<!DOCTYPE html>
<html lang="en-us">
    <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="generator" content="Hugo 0.123.8">

    

    

    
        
            <meta
                name="description"
                content="This is my new hugo site" />
        

        
            <meta
                name="keywords"
                content="hugo,site,new" />
        

        
            <meta name="author" content="Lifailon" />
        

    


    <title>
        
            InfluxDB |
            Lifailon.GitHub.io
        
    </title>

    


    
    

    
    


    
    


    
    


    
    

    


    
    

    

    

        
        


        
        


        <link
            rel="stylesheet"
            href="/css/index_d751713.min.912d03bce61461ecbc3ca083479e1ed814bba94df76d0bdc6aa88fdca33621b9bb410dc2c81af31e8101fec62decfa5f6e48901ad673bc5056d2f1d1f2368a34.css"
            integrity="sha512-kS0DvOYUYey8PKCDR54e2BS7qU33bQvcaqiP3KM2Ibm7QQ3CyBrzHoEB/sYt7PpfbkiQGtZzvFBW0vHR8jaKNA==" />
    


    
    

    

    

    

    
</head>



    <body>
        <header class="header">
    <div class="header_left">
        
    </div>

    <div class="header_middle">
        
            InfluxDB -
            Lifailon.GitHub.io
        
    </div>
</header>



        <main>
            <aside class="sidebar">
    



    
    

    
    


    <ul class="section-tree">
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/github/" title="./github/">
                        GitHub
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/powershell/" title="./powershell/">
                        PowerShell
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/dotnet/" title="./dotnet/">
                        .NET
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/activedirectory/" title="./activedirectory/">
                        Active Directory
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/ansible/" title="./ansible/">
                        Ansible
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/api/" title="./api/">
                        API
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/apps/" title="./apps/">
                        Apps
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/com/" title="./com/">
                        Component Object Model
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/git/" title="./git/">
                        Git
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/html/" title="./html/">
                        HTML
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/influxdb/" title="./influxdb/">
                        InfluxDB
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/exchange/" title="./exchange/">
                        MS Exchange
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/mssql/" title="./mssql/">
                        MS SQL
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/mysql/" title="./mysql/">
                        MySQL
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/network/" title="./network/">
                        Network
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/virtualization/" title="./virtualization/">
                        Virtualization
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/wmi/" title="./wmi/">
                        WMI
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://lifailon.github.io/zabbix/" title="./zabbix/">
                        Zabbix
                    </a>
                </li>
            
        
    </ul>


</aside>
<aside class="exapandable"></aside>


            
    <article class="main">
        <button
    class="sidebar-toggle-btn"
    type="menu"
    aria-expanded="false"
    aria-haspopup="true">
    <i class="bi bi-list"></i>
</button>



        <div class="title">
            <h1 class="title-header">
                InfluxDB
            </h1>

            <div class="author-date-readtime">
                

                    
                        <div class="author" title="Author">
                            <i class="bi bi-person"></i>
                            <a
                                href="/author/lifailon/"
                                class="cat-btn">
                                Lifailon
                            </a>
                        </div>
                    

                

                
                    <div class="date" title="Date">
                        <i class="bi bi-calendar3"></i>
                        <time
                            datetime="Mar 14 2024"
                            >Mar 14 2024
                        </time>
                    </div>
                

                
                    <div
                        class="readtime"
                        title="Time to Read">
                        <i class="bi bi-clock"></i>
                        7 mins to read
                    </div>
                
            </div>
        </div>

        <div class="article-meta">
            

            

            
                <div class="breadcumb">
                    <i class="bi bi-folder"></i>
                    
    




<a href="https://lifailon.github.io/" class="bread-btn">
    
        <i class="bi bi-house-fill"></i>
    

    
        Home
    
</a>




    /



<a href="https://lifailon.github.io/influxdb/" class="bread-btn">
    

    
        InfluxDB
    
</a>

                </div>
            

            
        </div>

        
            <nav id="TableOfContents">
  <ul>
    <li><a href="#install-windows">Install Windows</a></li>
    <li><a href="#install-ubuntu">Install Ubuntu</a></li>
    <li><a href="#api">API</a></li>
    <li><a href="#chronograf">Chronograf</a></li>
    <li><a href="#grafana">Grafana</a></li>
    <li><a href="#cli-client">CLI Client</a></li>
    <li><a href="#users">USERS</a></li>
    <li><a href="#database">DATABASE</a></li>
    <li><a href="#measurement">MEASUREMENT</a></li>
    <li><a href="#selectwhere">SELECT/WHERE</a></li>
    <li><a href="#regex">REGEX</a></li>
    <li><a href="#group-by-tag_key">GROUP BY tag_key</a></li>
    <li><a href="#functionsfield_key">Functions(field_key)</a></li>
    <li><a href="#policy">POLICY</a></li>
    <li><a href="#api-post">API POST</a></li>
    <li><a href="#api-get">API GET</a></li>
    <li><a href="#endpoints">Endpoints</a></li>
    <li><a href="#pingto-influxdb">PingTo-InfluxDB</a></li>
    <li><a href="#performanceto-influxdb">PerformanceTo-InfluxDB</a></li>
    <li><a href="#service">Service</a></li>
    <li><a href="#telegraf">Telegraf</a></li>
  </ul>
</nav>
        


        <div class="content">
            
                <h2 id="install-windows">Install Windows</h2>
<p><a href="https://www.influxdata.com/downloads">Download InfluxDB 1.x Open Source</a></p>
<p><a href="https://github.com/CymaticLabs/InfluxDBStudio">InfluxDB-Studio</a></p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>Invoke-RestMethod <span style="color:#e6db74">&#34;https://dl.influxdata.com/influxdb/releases/influxdb-1.8.10_windows_amd64.zip&#34;</span> -OutFile <span style="color:#e6db74">&#34;</span>$home<span style="color:#e6db74">\Downloads\influxdb-1.8.10_windows_amd64.zip&#34;</span>
</span></span><span style="display:flex;"><span>Expand-Archive <span style="color:#e6db74">&#34;</span>$home<span style="color:#e6db74">\Downloads\influxdb-1.8.10_windows_amd64.zip&#34;</span> -DestinationPath <span style="color:#e6db74">&#34;</span>$home<span style="color:#e6db74">\Documents\&#34;</span>
</span></span><span style="display:flex;"><span>Remove-Item <span style="color:#e6db74">&#34;</span>$home<span style="color:#e6db74">\Downloads\influxdb-1.8.10_windows_amd64.zip&#34;</span>
</span></span><span style="display:flex;"><span>&amp; <span style="color:#e6db74">&#34;</span>$home<span style="color:#e6db74">\Downloads\influxdb-1.8.10-1\influxd.exe&#34;</span></span></span></code></pre></div>
    
</div>
<h2 id="install-ubuntu">Install Ubuntu</h2>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Bash" data-lang="Bash"><span style="display:flex;"><span>wget https://dl.influxdata.com/influxdb/releases/influxdb_1.8.10_amd64.deb
</span></span><span style="display:flex;"><span>sudo dpkg -i influxdb_1.8.10_amd64.deb
</span></span><span style="display:flex;"><span>systemctl start influxdb
</span></span><span style="display:flex;"><span>systemctl status influxdb
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ps aux | grep influxdb | grep -Ev <span style="color:#e6db74">&#34;grep&#34;</span>
</span></span><span style="display:flex;"><span>netstat -natpl | grep 80<span style="color:#f92672">[</span>8-9<span style="color:#f92672">][</span>3-9<span style="color:#f92672">]</span></span></span></code></pre></div>
    
</div>
<h2 id="api">API</h2>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="nano%20/etc/influxdb/influxdb.conf%0d%0a%0d%0a[http]%0d%0a%20%20enabled%20=%20true%0d%0a%20%20bind-address%20=%20%22:8086%22%0d%0a%20%20auth-enabled%20=%20false%0d%0a%0d%0asystemctl%20restart%20influxdb">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Bash" data-lang="Bash"><span style="display:flex;"><span>nano /etc/influxdb/influxdb.conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>http<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>  enabled <span style="color:#f92672">=</span> true
</span></span><span style="display:flex;"><span>  bind-address <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;:8086&#34;</span>
</span></span><span style="display:flex;"><span>  auth-enabled <span style="color:#f92672">=</span> false
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>systemctl restart influxdb</span></span></code></pre></div>
    
</div>
<h2 id="chronograf">Chronograf</h2>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <pre><code>wget https://dl.influxdata.com/chronograf/releases/chronograf-1.10.2_windows_amd64.zip -UseBasicParsing -OutFile chronograf-1.10.2_windows_amd64.zip
Expand-Archive .\chronograf-1.10.2_windows_amd64.zip -DestinationPath &#39;C:\Program Files\InfluxData\chronograf\&#39;

wget https://dl.influxdata.com/chronograf/releases/chronograf_1.10.2_amd64.deb
sudo dpkg -i chronograf_1.10.2_amd64.deb
systemctl status influxdb
http://192.168.3.102:8888</code></pre>
    
</div>
<h2 id="grafana">Grafana</h2>
<p><a href="https://grafana.com/grafana/download">Download</a></p>
<p><code>invoke-RestMethod https://dl.grafana.com/enterprise/release/grafana-enterprise-10.3.1.windows-amd64.msi -OutFile &quot;$home\Download\grafana.msi&quot;</code></p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Bash" data-lang="Bash"><span style="display:flex;"><span>apt-get install -y adduser libfontconfig1 musl
</span></span><span style="display:flex;"><span>wget https://dl.grafana.com/enterprise/release/grafana-enterprise_10.3.1_amd64.deb
</span></span><span style="display:flex;"><span>dpkg -i grafana-enterprise_10.3.1_amd64.deb
</span></span><span style="display:flex;"><span>systemctl start grafana-server
</span></span><span style="display:flex;"><span>systemctl status grafana-server</span></span></code></pre></div>
    
</div>
<h2 id="cli-client">CLI Client</h2>
<p><code>apt install influxdb-client</code> <br>
<code>influx</code> <br>
<code>influx --host 192.168.3.102 --username admin --password password</code></p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="$influx_client_exec%20=%20%22$home%5cDocuments%5cinfluxdb-1.8.10-1%5cinflux.exe%22%0d%0a&amp;%20$influx_client_exec%20-host%20192.168.3.102%20-port%208086%0d%0ahelp%0d%0ashow%20databases%0d%0ause%20PowerShell%0d%0aSELECT%20*%20FROM%20%22HardwareMonitor%22%20WHERE%20time%20%3e%20now%28%29%20-%205m">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>$influx_client_exec = <span style="color:#e6db74">&#34;</span>$home<span style="color:#e6db74">\Documents\influxdb-1.8.10-1\influx.exe&#34;</span>
</span></span><span style="display:flex;"><span>&amp; $influx_client_exec -host <span style="color:#ae81ff">192.168</span>.3.102 -port <span style="color:#ae81ff">8086</span>
</span></span><span style="display:flex;"><span>help
</span></span><span style="display:flex;"><span>show databases
</span></span><span style="display:flex;"><span>use PowerShell
</span></span><span style="display:flex;"><span>SELECT * FROM <span style="color:#e6db74">&#34;HardwareMonitor&#34;</span> WHERE time &gt; now() - <span style="color:#ae81ff">5m</span></span></span></code></pre></div>
    
</div>
<h2 id="users">USERS</h2>
<p><code>SHOW USERS</code> отобразить пользователей и их права доступа <br>
<code>CREATE USER admin WITH PASSWORD 'password' WITH ALL PRIVILEGES</code> создать пользователя <br>
<code>GRANT ALL PRIVILEGES TO &quot;admin&quot;</code> предоставить права доступа <br>
<code>GRANT READ ON &quot;database&quot; TO &quot;admin&quot;</code> доступ на чтение для БД или запись (WRITE) <br>
<code>REVOKE ALL PRIVILEGES FROM &quot;admin&quot;</code> отозвать права доступа <br>
<code>SHOW GRANTS FOR &quot;admin&quot;</code> БД и привелегии доступа для указанного пользователя <br>
<code>SET PASSWORD FOR &quot;admin&quot; = 'new_password'</code> изменить пароль <br>
<code>DROP USER &quot;admin&quot;</code> удалить пользователя</p>
<h2 id="database">DATABASE</h2>
<p><code>CREATE DATABASE powershell</code> создать БД <br>
<code>SHOW DATABASES</code> отобразить список БД <br>
<code>DROP DATABASE powershell</code> удалить БД <br>
<code>USE powershell</code> <br>
<code>SHOW measurements</code> отобразить все таблицы <br>
<code>INSERT performance,host=console,counter=CPU value=0.88</code> записать данные в таблицу performance</p>
<h2 id="measurement">MEASUREMENT</h2>
<p><code>SHOW TAG KEYS FROM &quot;HardwareMonitor&quot;</code> отобразить все тэги в таблице <br>
<code>SHOW TAG VALUES FROM &quot;HardwareMonitor&quot; WITH KEY = &quot;HardwareName&quot;</code> отобразить все значения указанного тэга <br>
<code>SHOW FIELD KEYS FROM &quot;HardwareMonitor&quot;</code> отобразить все Field Tags и их тип данных <br>
<code>SHOW SERIES FROM &quot;HardwareMonitor&quot;</code> отобразить список всех уникальных серий в указанной таблице. Серия - это набор точек данных, которые имеют одинаковые значения для всех тегов, за исключением времени. <br>
<code>DROP SERIES FROM &quot;HardwareMonitor&quot;</code> очистить все данные в таблице <br>
<code>DROP MEASUREMENT &quot;HardwareMonitor&quot;</code> удалить таблицу</p>
<h2 id="selectwhere">SELECT/WHERE</h2>
<p><code>SELECT * FROM performance</code> отобразить все данные в таблице <br>
<code>SELECT value FROM performance</code> отфильтровать по столбцу value (только Field Keys) <br>
<code>SELECT * FROM performance limit 10</code> отобразить 10 единиц данных <br>
<code>SELECT * FROM performance WHERE time &gt; now() -2d</code> отобразить данные за последние 2 дня <br>
<code>SELECT * FROM performance WHERE time &gt; now() +3h -5m</code> данные за последние 5 минут (+3 часа от текущего времени по UTC 0 -5 минут) <br>
<code>SELECT * FROM performance WHERE counter = 'CPU'</code> выборка по тэгу <br>
<code>SELECT upload/1000 FROM speedtest WHERE upload/1000 &lt;= 250</code> выборка по столбцу upload и разделить вывод на 1000, вывести upload меньше 250 <br>
<code>DELETE FROM performance WHERE time &gt; now() -1h</code> удалить данные за последние 1/4 часа <br>
<code>DELETE FROM performance WHERE time &lt; now() -24h</code> удалить данные старше 24 часов</p>
<h2 id="regex">REGEX</h2>
<p><code>SELECT * FROM &quot;win_pdisk&quot; WHERE instance =~/.*C:/ and time &gt; now() - 5m</code> и <br>
<code>SELECT * FROM &quot;win_pdisk&quot; WHERE instance =~/.*E:/ or instance =~ /.*F:/</code> или <br>
<code>SELECT * FROM &quot;win_pdisk&quot; WHERE instance !~ /.*Total/</code> не равно (исключить) <br>
<code>SELECT * FROM &quot;HardwareMonitor&quot; WHERE time &gt; now() - 5m and HardwareName =~ /Intel/</code> приблизительно равно <br>
<code>SELECT * FROM &quot;HardwareMonitor&quot; WHERE time &gt; now() - 5m and HardwareName =~ /Intel.+i7/</code> эквивалент 12th_Gen_Intel_Core_i7-1260P <br>
<code>SELECT * FROM &quot;HardwareMonitor&quot; WHERE time &gt; now() - 5m and HardwareName =~ /^Intel/</code> начинается на Intel <br>
<code>SELECT * FROM &quot;HardwareMonitor&quot; WHERE time &gt; now() - 5m and HardwareName =~ /00$/</code> заканчивается на 00</p>
<h2 id="group-by-tag_key">GROUP BY tag_key</h2>
<p><code>SELECT * FROM &quot;HardwareMonitor&quot; WHERE time &gt; now() - 5m and SensorName = 'Temperature' GROUP BY HardwareName</code> создать уникальные группы по тэгу HardwareName <br>
<code>SELECT * FROM &quot;HardwareMonitor&quot; WHERE time &gt; now() - 5m and SensorName = 'Temperature' GROUP BY Host,HardwareName</code> больше групп по двум тэгаам</p>
<h2 id="functionsfield_key">Functions(field_key)</h2>
<p><a href="https://docs.influxdata.com/influxdb/v1.8/query_language/functions">Functions</a></p>
<p><code>SELECT instance,LAST(Avg._Disk_Read_Queue_Length) FROM &quot;win_pdisk&quot; GROUP BY instance</code> отфильтровать вывод по последнему/текущему значению <br>
<code>SELECT instance,FIRST(Avg._Disk_Read_Queue_Length) FROM &quot;win_pdisk&quot; GROUP BY instance</code> отфильтровать вывод по первому значению за весь или указанный отрезок времени <br>
<code>SELECT instance,MIN(Avg._Disk_Read_Queue_Length) FROM &quot;win_pdisk&quot; GROUP BY instance</code> отфильтровать вывод с отображением минимального значения <br>
<code>SELECT instance,MAX(Avg._Disk_Read_Queue_Length) FROM &quot;win_pdisk&quot; GROUP BY instance</code> отфильтровать вывод с отображением максимального значения <br>
<code>SELECT SUM(Bytes_Received_persec) FROM &quot;win_net&quot; GROUP BY instance</code> суммах всех значений <br>
<code>SELECT COUNT(Bytes_Received_persec) FROM &quot;win_net&quot; WHERE Bytes_Received_persec &gt;= 0 GROUP BY instance</code> кол-во данных, где значение выше или равно 0 <br>
<code>SELECT MEAN(Bytes_Received_persec) FROM &quot;win_net&quot; WHERE Bytes_Received_persec &lt; 1000 GROUP BY instance</code> среднее значение данных с показателем от 0 до 1000 (509)</p>
<p><code>SELECT *,MAX(Value) FROM &quot;HardwareMonitor&quot; WHERE time &gt; now() -1h GROUP BY SensorName,Host</code> создать группы для выявления максимального значения значения стобца Value каждого тэга SensorName и хоста за последний час <br>
<code>SELECT *,MAX(Value) FROM &quot;HardwareMonitor&quot; WHERE time &gt; now() -1h and SensorName = 'CPU_Package' GROUP BY Host</code> масимальное значение CPU_Package за последний час для каждого хоста <br>
<code>SELECT MEAN(Value) FROM &quot;HardwareMonitor&quot; WHERE time &gt; now() -1h and SensorName = 'CPU_Package' GROUP BY Host</code> среднее значение CPU_Package за последний час</p>
<h2 id="policy">POLICY</h2>
<p><code>CREATE DATABASE powershell WITH DURATION 48h REPLICATION 1 NAME &quot;del2d&quot;</code> создать БД с политикой хранения 2 дня <br>
<code>CREATE RETENTION POLICY del2h ON powershell DURATION 2h REPLICATION 1</code> создать новую политику хранения для БД <br>
<code>CREATE RETENTION POLICY del6h ON powershell DURATION 6h REPLICATION 1 SHARD DURATION 2h</code> указать период хранения 6 часов + 2 часа до очистки (по умолчанию 1ч или больше) <br>
<code>ALTER RETENTION POLICY del6h ON powershell DEFAULT</code> изменить (ALTER) политику хранения для БД на del6h (DEFAULT) <br>
<code>DROP RETENTION POLICY del2d ON powershell</code> удаление политики хранения приводит к безвозвратному удалению всех измерений (таблиц) и данных, хранящихся в политике хранения <br>
<code>SHOW RETENTION POLICIES ON PowerShell</code> отобразить действующие политики базы данных PowerShell</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>$data = Invoke-RestMethod http<span style="color:#960050;background-color:#1e0010">:</span>//<span style="color:#ae81ff">192.168</span>.3.<span style="color:#ae81ff">102</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#ae81ff">8086</span>/query<span style="color:#66d9ef">?</span>q=<span style="color:#e6db74">&#34;SHOW RETENTION POLICIES ON PowerShell&#34;</span>
</span></span><span style="display:flex;"><span>$col = $data.results.series.columns
</span></span><span style="display:flex;"><span>$val = $data.results.series.values
</span></span><span style="display:flex;"><span>$mass    = @()
</span></span><span style="display:flex;"><span>$mass   += [<span style="color:#66d9ef">string</span>]$col
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">foreach</span> ($v <span style="color:#66d9ef">in</span> $val) {
</span></span><span style="display:flex;"><span>	$mass += [<span style="color:#66d9ef">string</span>]$v
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>$mass = $mass <span style="color:#f92672">-replace</span> <span style="color:#e6db74">&#39;^&#39;</span>,<span style="color:#e6db74">&#39;&#34;&#39;</span>
</span></span><span style="display:flex;"><span>$mass = $mass <span style="color:#f92672">-replace</span> <span style="color:#e6db74">&#39;$&#39;</span>,<span style="color:#e6db74">&#39;&#34;&#39;</span>
</span></span><span style="display:flex;"><span>$mass = $mass <span style="color:#f92672">-replace</span> <span style="color:#e6db74">&#39;\s&#39;</span>,<span style="color:#e6db74">&#39;&#34;,&#34;&#39;</span>
</span></span><span style="display:flex;"><span>$mass | ConvertFrom-Csv</span></span></code></pre></div>
    
</div>
<h2 id="api-post">API POST</h2>
<p>Вместо таблиц в InfluxDB имеются измерения. Вместо столбцов в ней есть теги и поля.</p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="%20%20%20Table%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Tag%20%28string/int%29%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Field%20%28double/int%29%20%20%20%20%20%20%20%20%20%20%20TIMESTAMP%0d%0ameasurement,Tag_Keys1=Tag_Values1,Tag_Keys2=Tag_Values2%20Field_Keys1=%22Values%22,Field_Keys2=%22Values%22%200000000000000000000%0d%0a%20%20%20%20%20%20%20%20%20%20%201%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%202%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%203%0d%0a%0d%0a$ip%20%20%20%20%20%20%20%20=%20%22192.168.3.104%22%0d%0a$port%20%20%20%20%20%20=%20%228086%22%0d%0a$db%20%20%20%20%20%20%20%20=%20%22powershell%22%0d%0a$table%20%20%20%20%20=%20%22speedtest%22%0d%0a$ipp%20%20%20%20%20%20%20=%20$ip&#43;%22:%22&#43;$port%0d%0a$url%20%20%20%20%20%20%20=%20%22http://$ipp/write?db=$db%22%0d%0a$user%20%20%20%20%20%20=%20%22admin%22%0d%0a$pass%20%20%20%20%20%20=%20%22password%22%20%7c%20ConvertTo-SecureString%20-AsPlainText%20-Force%0d%0a$cred%20%20%20%20%20%20=%20[System.Management.Automation.PSCredential]::new%28$user,$pass%29%0d%0a$unixtime%20%20=%20%28New-TimeSpan%20-Start%20%28Get-Date%20%2201/01/1970%22%29%20-End%20%28Get-Date%29%29.TotalSeconds%0d%0a$timestamp%20=%20%28[string]$unixtime%20-replace%20%22%5c..&#43;%22%29%20&#43;%20%22000000000%22%0d%0a%0d%0aInvoke-RestMethod%20-Method%20POST%20-Uri%20$url%20-Body%20%22$table,host=$%28hostname%29%20download=200000,upload=300000,ping=3%20$timestamp%22">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <pre><code>   Table                        Tag (string/int)                          Field (double/int)           TIMESTAMP
measurement,Tag_Keys1=Tag_Values1,Tag_Keys2=Tag_Values2 Field_Keys1=&#34;Values&#34;,Field_Keys2=&#34;Values&#34; 0000000000000000000
           1                                           2                                         3

$ip        = &#34;192.168.3.104&#34;
$port      = &#34;8086&#34;
$db        = &#34;powershell&#34;
$table     = &#34;speedtest&#34;
$ipp       = $ip&#43;&#34;:&#34;&#43;$port
$url       = &#34;http://$ipp/write?db=$db&#34;
$user      = &#34;admin&#34;
$pass      = &#34;password&#34; | ConvertTo-SecureString -AsPlainText -Force
$cred      = [System.Management.Automation.PSCredential]::new($user,$pass)
$unixtime  = (New-TimeSpan -Start (Get-Date &#34;01/01/1970&#34;) -End (Get-Date)).TotalSeconds
$timestamp = ([string]$unixtime -replace &#34;\..&#43;&#34;) &#43; &#34;000000000&#34;

Invoke-RestMethod -Method POST -Uri $url -Body &#34;$table,host=$(hostname) download=200000,upload=300000,ping=3 $timestamp&#34;</code></pre>
    
</div>
<h2 id="api-get">API GET</h2>
<p><code>curl http://192.168.3.104:8086/query --data-urlencode &quot;q=SHOW DATABASES&quot;</code> pwsh7 (ConvertFrom-Json) and bash</p>
<p><code>$dbs = irm &quot;http://192.168.3.104:8086/query?q=SHOW DATABASES&quot;</code> <br>
<code>$dbs = irm &quot;http://192.168.3.104:8086/query?epoch=ms&amp;u=admin&amp;p=password&amp;q=SHOW DATABASES&quot;</code> <br>
<code>$dbs.results.series.values</code></p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>$ip    = <span style="color:#e6db74">&#34;192.168.3.104&#34;</span>
</span></span><span style="display:flex;"><span>$port  = <span style="color:#e6db74">&#34;8086&#34;</span>
</span></span><span style="display:flex;"><span>$db    = <span style="color:#e6db74">&#34;powershell&#34;</span>
</span></span><span style="display:flex;"><span>$table = <span style="color:#e6db74">&#34;speedtest&#34;</span>
</span></span><span style="display:flex;"><span>$query = <span style="color:#e6db74">&#34;SELECT * FROM </span>$table<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>$ipp   = $ip+<span style="color:#e6db74">&#34;:&#34;</span>+$port
</span></span><span style="display:flex;"><span>$url   = <span style="color:#e6db74">&#34;http://</span>$ipp<span style="color:#e6db74">/query?db=</span>$db<span style="color:#e6db74">&amp;q=</span>$query<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>$data  = Invoke-RestMethod -Method GET -Uri $url` -Credential $cred 
</span></span><span style="display:flex;"><span>$data.results.series.name   ` имя таблицы
</span></span><span style="display:flex;"><span>$data.results.series.columns` столбцы/ключи
</span></span><span style="display:flex;"><span>$data.results.series.values ` данные построчно</span></span></code></pre></div>
    
</div>
<h2 id="endpoints">Endpoints</h2>
<p><a href="https://docs.influxdata.com/influxdb/v1.7/tools/api/">API doc</a></p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>$stats = irm http<span style="color:#960050;background-color:#1e0010">:</span>//<span style="color:#ae81ff">192.168</span>.3.<span style="color:#ae81ff">104</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#ae81ff">8086</span>/debug/vars` статистика сервера
</span></span><span style="display:flex;"><span>$stats.<span style="color:#e6db74">&#34;database:powershell&#34;</span>.values` кол-во таблиц к БД
</span></span><span style="display:flex;"><span>$stats.queryExecutor.values` количество query-запросов (обращений к endpoint /query)
</span></span><span style="display:flex;"><span>$stats.write.values` количество write-запросов
</span></span><span style="display:flex;"><span>$stats.system.uptime</span></span></code></pre></div>
    
</div>
<p><code>http://192.168.3.104:8086/debug/requests</code> кол-во клиентских HTTP-запросов к конечным точкам /writeи /query <br>
<code>http://192.168.3.104:8086/debug/pprof</code> <br>
<code>http://192.168.3.104:8086/ping</code> <br>
<code>http://192.168.3.104:8086/query</code> <br>
<code>http://192.168.3.104:8086/write</code></p>
<p><code>http://192.168.3.99:8086/api/v2/setup</code> <br>
<code>http://192.168.3.99:8086/api/v2/config</code> <br>
<code>http://192.168.3.99:8086/api/v2/write</code></p>
<h2 id="pingto-influxdb">PingTo-InfluxDB</h2>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="while%20%28$true%29%20%7b%0d%0a%09$tz%20=%20%28Get-TimeZone%29.BaseUtcOffset.TotalMinutes%0d%0a%09$unixtime%20%20=%20%28New-TimeSpan%20-Start%20%28Get-Date%20%2201/01/1970%22%29%20-End%20%28%28Get-Date%29.AddMinutes%28-$tz%29%29%29.TotalSeconds%60%20-3h%20UTC%0d%0a%09$timestamp%20=%20%28[string]$unixtime%20-replace%20%22%5c..&#43;%22%29%20&#43;%20%22000000000%22%0d%0a%09$tnc%20=%20tnc%208.8.8.8%0d%0a%09$Status%20=%20$tnc.PingSucceeded%0d%0a%09$RTime%20=%20$tnc.PingReplyDetails.RoundtripTime%0d%0a%09Invoke-RestMethod%20-Method%20POST%20-Uri%20%22http://192.168.3.104:8086/write?db=powershell%22%20-Body%20%22ping,host=$%28hostname%29%20status=$status,rtime=$RTime%20$timestamp%22%0d%0a%09sleep%201%0d%0a%7d">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span><span style="color:#66d9ef">while</span> ($true) {
</span></span><span style="display:flex;"><span>	$tz = (Get-TimeZone).BaseUtcOffset.TotalMinutes
</span></span><span style="display:flex;"><span>	$unixtime  = (New-TimeSpan -Start (Get-Date <span style="color:#e6db74">&#34;01/01/1970&#34;</span>) -End ((Get-Date).AddMinutes(-$tz))).TotalSeconds` -3h UTC
</span></span><span style="display:flex;"><span>	$timestamp = ([<span style="color:#66d9ef">string</span>]$unixtime <span style="color:#f92672">-replace</span> <span style="color:#e6db74">&#34;\..+&#34;</span>) + <span style="color:#e6db74">&#34;000000000&#34;</span>
</span></span><span style="display:flex;"><span>	$tnc = tnc <span style="color:#ae81ff">8.8</span>.8.8
</span></span><span style="display:flex;"><span>	$Status = $tnc.PingSucceeded
</span></span><span style="display:flex;"><span>	$RTime = $tnc.PingReplyDetails.RoundtripTime
</span></span><span style="display:flex;"><span>	Invoke-RestMethod -Method POST -Uri <span style="color:#e6db74">&#34;http://192.168.3.104:8086/write?db=powershell&#34;</span> -Body <span style="color:#e6db74">&#34;ping,host=</span>$(hostname)<span style="color:#e6db74"> status=</span>$status<span style="color:#e6db74">,rtime=</span>$RTime<span style="color:#e6db74"> </span>$timestamp<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>	sleep <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
    
</div>
<p><code>SELECT * FROM ping WHERE status = false</code></p>
<h2 id="performanceto-influxdb">PerformanceTo-InfluxDB</h2>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> ConvertTo-Encoding ([<span style="color:#66d9ef">string</span>]$From, [<span style="color:#66d9ef">string</span>]$To) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">Begin</span> {
</span></span><span style="display:flex;"><span>        $encFrom = [<span style="color:#66d9ef">System.Text.Encoding</span>]::GetEncoding($from)
</span></span><span style="display:flex;"><span>        $encTo = [<span style="color:#66d9ef">System.Text.Encoding</span>]::GetEncoding($to)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">Process</span> {
</span></span><span style="display:flex;"><span>        $bytes = $encTo.GetBytes($_)
</span></span><span style="display:flex;"><span>        $bytes = [<span style="color:#66d9ef">System.Text.Encoding</span>]::Convert($encFrom, $encTo, $bytes)
</span></span><span style="display:flex;"><span>        $encTo.GetString($bytes)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$localization = (Get-Culture).LCID` текущая локализация
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> ($localization <span style="color:#f92672">-eq</span> <span style="color:#ae81ff">1049</span>) {
</span></span><span style="display:flex;"><span>	$performance = <span style="color:#e6db74">&#34;\\</span>$(hostname)<span style="color:#e6db74">\Процессор(_Total)\% загруженности процессора&#34;</span> | ConvertTo-Encoding UTF-<span style="color:#ae81ff">8</span> windows-<span style="color:#ae81ff">1251</span>` декодировать кириллицу
</span></span><span style="display:flex;"><span>} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>	$performance = <span style="color:#e6db74">&#34;\Processor(_Total)\% Processor Time&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$tz = (Get-TimeZone).BaseUtcOffset.TotalMinutes
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> ($true) {
</span></span><span style="display:flex;"><span>	$unixtime  = (New-TimeSpan -Start (Get-Date <span style="color:#e6db74">&#34;01/01/1970&#34;</span>) -End ((Get-Date).AddMinutes(-$tz))).TotalSeconds` -3h UTC
</span></span><span style="display:flex;"><span>	$timestamp = ([<span style="color:#66d9ef">string</span>]$unixtime <span style="color:#f92672">-replace</span> <span style="color:#e6db74">&#34;\..+&#34;</span>) + <span style="color:#e6db74">&#34;000000000&#34;</span>
</span></span><span style="display:flex;"><span>	[<span style="color:#66d9ef">double</span>]$value = (Get-Counter $performance).CounterSamples.CookedValue.ToString(<span style="color:#e6db74">&#34;0.00&#34;</span>).replace(<span style="color:#e6db74">&#34;,&#34;</span>,<span style="color:#e6db74">&#34;.&#34;</span>)` округлить в тип данных Double
</span></span><span style="display:flex;"><span>	Invoke-RestMethod -Method POST -Uri <span style="color:#e6db74">&#34;http://192.168.3.104:8086/write?db=powershell&#34;</span> -Body <span style="color:#e6db74">&#34;performance,host=</span>$(hostname)<span style="color:#e6db74">,counter=CPU value=</span>$value<span style="color:#e6db74"> </span>$timestamp<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>	sleep <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
    
</div>
<h2 id="service">Service</h2>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>$powershell_Path = (Get-Command powershell).Source
</span></span><span style="display:flex;"><span>$NSSM_Path = <span style="color:#e6db74">&#34;C:\NSSM\NSSM-2.24.exe&#34;</span>
</span></span><span style="display:flex;"><span>$Script_Path = <span style="color:#e6db74">&#34;C:\NSSM\PerformanceTo-InfluxDB.ps1&#34;</span>
</span></span><span style="display:flex;"><span>$Service_Name = <span style="color:#e6db74">&#34;PerformanceTo-InfluxDB&#34;</span>
</span></span><span style="display:flex;"><span>&amp; $NSSM_Path install $Service_Name $powershell_Path -ExecutionPolicy Bypass -NoProfile <span style="color:#f92672">-f</span> $Script_Path
</span></span><span style="display:flex;"><span>Get-Service $Service_Name | Start-Service
</span></span><span style="display:flex;"><span>Get-Service $Service_Name | Set-Service -StartupType Automatic</span></span></code></pre></div>
    
</div>
<h2 id="telegraf">Telegraf</h2>
<p><a href="https://docs.influxdata.com/telegraf/v1.27/plugins/#input-plugins">Plugins</a></p>
<p><code>iwr https://dl.influxdata.com/telegraf/releases/telegraf-1.27.1_windows_amd64.zip -UseBasicParsing -OutFile telegraf-1.27.1_windows_amd64.zip</code> <br>
<code>Expand-Archive .\telegraf-1.27.1_windows_amd64.zip -DestinationPath &quot;C:\Telegraf&quot;</code> <br>
<code>rm telegraf-1.27.1_windows_amd64.zip</code> <br>
<code>cd C:\Telegraf</code> <br>
<code>.\telegraf.exe -sample-config --input-filter cpu:mem:dns_query --output-filter influxdb &gt; telegraf_nt.conf</code> создать конфигурацию с выбарнными плагинами для сбора метрик <br>
<code>Start-Process notepad++ C:\Telegraf\telegraf_nt.conf</code></p>







<div class="codeblock">
    
        <div class="copy-button-box">
            <button class="copy-button" state="copy" data="#ZgotmplZ">
                <i class="bi bi-copy"></i>
            </button>
        </div>
    

    
        <pre><code>[[outputs.influxdb]]
  urls = [&#34;http://192.168.3.104:8086&#34;]
  database = &#34;telegraf_nt&#34;
  username = &#34;user&#34;
  password = &#34;pass&#34;
[[inputs.cpu]]
  percpu = false
  totalcpu = true
[[inputs.dns_query]]
  servers = [&#34;8.8.8.8&#34;]
  network = &#34;udp&#34;
  domains = [&#34;.&#34;]
  record_type = &#34;A&#34;
  port = 53
  timeout = &#34;2s&#34;</code></pre>
    
</div>
<p><code>.\telegraf.exe --test -config C:\Telegraf\telegraf_nt.conf</code> тест конфигурации (получения метрик с выводом в консоль) <br>
<code>C:\Telegraf\telegraf.exe -config C:\Telegraf\telegraf_nt.conf</code> запустить telegraf (тест отправки данных) <br>
<code>.\telegraf.exe --config &quot;C:\Telegraf\telegraf_nt.conf&quot; --service install</code> создать службу <br>
<code>Get-Service telegraf | Start-Service</code> <br>
<code>.\telegraf.exe --service uninstall</code></p>
<p><code>USE telegraf</code> <br>
<code>SELECT usage_idle,usage_system,usage_user FROM cpu</code></p>

            
        </div>
    </article>

        </main>

        <footer class="footer">
    <div class="footer-left">
        <ul class="social">
            
                <li>GitHub</li>
            

            
                <li>Lifailon</li>
            

            
                
            
                
            
                
                    <li>
                        
                            <a href="https://github.com/Lifailon" target="_blank">
                                <i class="bi-github"></i>
                            </a>
                        

                    </li>
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
        </ul>
    </div>

    <div class="footer-right">
        <ul class="control status clearfix">
            

            
            

            

            
                <li>
                    <a href="https://gohugo.io" class="btn" target="_blank"
                        >Hugo: 0.123.8</a
                    >
                </li>
            

            
                <li>
                    <a
                        href="https://github.com/JingWangTW/dark-theme-editor"
                        class="btn"
                        target="_blank"
                        >Theme: dark-theme-editor</a
                    >
                </li>
            

            
                <li>
                    
                        Last modified: &nbsp;
                        <time>
                            Mar 14 2024
                        </time>
                    
                </li>
            

            
        </ul>
    </div>
</footer>

    </body>

    























    
    


    
    


    <script
        type="text/javascript"
        src="/js/index_d751713.min.5eeb120f16ea146352725c420364f87befead45f678142b8f0ffbef024646931fbc06bff07a7bd6cb57fa2f8cd8a21ba6a4ee5a278ec32303a378bc1cd17f246.js"
        integrity="sha512-XusSDxbqFGNSclxCA2T4e&#43;/q1F9ngUK48P&#43;&#43;8CRkaTH7wGv/B6e9bLV/ovjNiiG6ak7lonjsMjA6N4vBzRfyRg=="></script>














<link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" />




</html>
