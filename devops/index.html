<!doctype html><html data-theme=dark lang=en xmlns=http://www.w3.org/1999/xhtml><head><meta charset=UTF-8><meta content="Web version for PowerShell notes in Russian language (Сheat Sheet & Documentation), Linux commands and RuDocs for Node.js" name=description><meta content="width=device-width,initial-scale=1" name=viewport><meta content=#ff7800 name=theme-color><meta content=#ffa348 media=(prefers-color-scheme:dark) name=theme-color><meta content="default-src 'none';font-src 'self';img-src 'self' https: data:;media-src 'self' https:;style-src 'self' 'unsafe-inline';frame-src https://player.vimeo.com https://www.youtube-nocookie.com https://toot.community;frame-ancestors 'none';base-uri 'none';form-action 'none';connect-src 'self' https://toot.community;script-src 'self' 'self'" http-equiv=content-security-policy><title>DevOps - PowerShell Commands</title><link href=https://lifailon.github.io/devops/ rel=canonical><link href=https://lifailon.github.io/favicon.png rel=icon type=image/png><link href=https://lifailon.github.io/apple-touch-icon.png rel=apple-touch-icon sizes=180x180 type=image/png><link title="PowerShell Commands - RSS Feed" href=https://lifailon.github.io/rss.xml rel=alternate type=application/rss+xml><link title="PowerShell Commands - Atom Feed" href=https://lifailon.github.io/atom.xml rel=alternate type=application/atom+xml><style>:root{--accent-color:#ff7800}[data-theme=dark]{--accent-color:#ffa348}@media (prefers-color-scheme:dark){:root:not([data-theme=light]){--accent-color:#ffa348}}</style><link href=https://lifailon.github.io/style.css rel=stylesheet><link media="(prefers-color-scheme: light)" href=https://lifailon.github.io/syntax-theme-light.css rel=stylesheet><link media="(prefers-color-scheme: dark)" href=https://lifailon.github.io/syntax-theme-dark.css rel=stylesheet><script defer src=https://lifailon.github.io/closable.js></script><script defer src=https://lifailon.github.io/copy-button.js></script><script defer src=https://lifailon.github.io/fuse.js></script><script defer src=https://lifailon.github.io/search-fuse.js></script><script defer src=https://lifailon.github.io/theme-switcher.js></script><meta content="PowerShell Commands" property=og:site_name><meta content="DevOps - PowerShell Commands" property=og:title><meta content=https://lifailon.github.io/devops/ property=og:url><meta content="Web version for PowerShell notes in Russian language (Сheat Sheet & Documentation), Linux commands and RuDocs for Node.js" property=og:description><meta content=https://lifailon.github.io/card.png property=og:image><meta content=en_US property=og:locale><body><div id=handle></div><header id=site-nav><nav><a href=#main-content tabindex=0> Skip to Main Content </a><ul><li id=home><a href=https://lifailon.github.io> <i class=icon></i>PowerShell Commands</a><li class=divider><li><a href=https://lifailon.github.io/powershell/>PowerShell</a><li><a href=https://lifailon.github.io/linux/>Linux</a><li><a href=https://lifailon.github.io/golang/>GoLang</a><li><a href=https://lifailon.github.io/node-js/>Node.js</a><li><a href=https://lifailon.github.io/docker/>Docker</a><li><a href=https://lifailon.github.io/network/>Network</a><li><a href=https://lifailon.github.io/windowsserver/>Windows Server</a><li><a href=https://lifailon.github.io/database/>Database</a><li><a href=https://lifailon.github.io/api/>API</a><li><a class=active href=https://lifailon.github.io/devops/>DevOps</a><li id=search><button class=circle id=search-toggle title=Search><i class=icon></i></button><li id=theme-switcher><details class=closable><summary class=circle title=Theme><i class=icon></i></summary> <ul><li><button title="Switch to Light Theme" class=circle id=theme-light><i class=icon></i></button><li><button title="Switch to Dark Theme" class=circle id=theme-dark><i class=icon></i></button><li><button title="Use System Theme" class=circle id=theme-system><i class=icon></i></button></ul></details><li id=repo><a class=circle href=https://github.com/Lifailon/PS-Commands title=Repository> <i class=icon></i> </a></ul></nav><div id=search-container><label class=visually-hidden for=search-bar>Search</label><input placeholder="Search for…" autocomplete=off disabled id=search-bar type=search><div id=search-results-container><div id=search-results></div></div></div></header><div id=sidebar><div><h2>Table of Contents</h2><ul><li><a href=https://lifailon.github.io/devops/#git>Git</a><li><a href=https://lifailon.github.io/devops/#github-api>GitHub api</a><li><a href=https://lifailon.github.io/devops/#github-actions>GitHub Actions</a><ul><li><a href=https://lifailon.github.io/devops/#runner-agent>Runner (Agent)</a><li><a href=https://lifailon.github.io/devops/#build-pipeline>Build (Pipeline)</a><li><a href=https://lifailon.github.io/devops/#ci>CI</a><li><a href=https://lifailon.github.io/devops/#logs>Logs</a><li><a href=https://lifailon.github.io/devops/#act>act</a></ul><li><a href=https://lifailon.github.io/devops/#vercel>Vercel</a><ul><li><a href=https://lifailon.github.io/devops/#cd>CD</a></ul><li><a href=https://lifailon.github.io/devops/#gitlab>GitLab</a><li><a href=https://lifailon.github.io/devops/#jenkins>Jenkins</a><ul><li><a href=https://lifailon.github.io/devops/#api>API</a><li><a href=https://lifailon.github.io/devops/#plugins>Plugins</a><li><a href=https://lifailon.github.io/devops/#ssh-steps-and-artifacts>SSH Steps and Artifacts</a><li><a href=https://lifailon.github.io/devops/#update-ssh-authorized-keys>Update SSH authorized_keys</a><li><a href=https://lifailon.github.io/devops/#upload-file-parameter>Upload File Parameter</a><li><a href=https://lifailon.github.io/devops/#input-text-and-file>Input Text and File</a><li><a href=https://lifailon.github.io/devops/#httpurlconnection>HttpURLConnection</a><li><a href=https://lifailon.github.io/devops/#active-choices-parameter>Active Choices Parameter</a><li><a href=https://lifailon.github.io/devops/#vault>Vault</a><li><a href=https://lifailon.github.io/devops/#email-extension>Email Extension</a><li><a href=https://lifailon.github.io/devops/#parallel>Parallel</a><li><a href=https://lifailon.github.io/devops/#groovy>Groovy</a></ul><li><a href=https://lifailon.github.io/devops/#secret-manager>Secret Manager</a><ul><li><a href=https://lifailon.github.io/devops/#bitwarden>Bitwarden</a><li><a href=https://lifailon.github.io/devops/#infisical>Infisical</a><li><a href=https://lifailon.github.io/devops/#hashicorp-vault>HashiCorp/Vault</a><li><a href=https://lifailon.github.io/devops/#hashicorp-consul>HashiCorp/Consul</a></ul><li><a href=https://lifailon.github.io/devops/#pussh>pussh</a><li><a href=https://lifailon.github.io/devops/#sake>Sake</a><li><a href=https://lifailon.github.io/devops/#puppet>Puppet</a><ul><li><a href=https://lifailon.github.io/devops/#bolt>Bolt</a></ul><li><a href=https://lifailon.github.io/devops/#ansible>Ansible</a><ul><li><a href=https://lifailon.github.io/devops/#hosts>Hosts</a><li><a href=https://lifailon.github.io/devops/#windows-modules>Windows Modules</a></ul><li><a href=https://lifailon.github.io/devops/#jinja>Jinja</a><li><a href=https://lifailon.github.io/devops/#dsc>DSC</a><li><a href=https://lifailon.github.io/devops/#psappdeploytoolkit>PSAppDeployToolkit</a><ul><li><a href=https://lifailon.github.io/devops/#install-deploytoolkit>Install-DeployToolkit</a><li><a href=https://lifailon.github.io/devops/#deploy-notepad-plus-plus>Deploy-Notepad-Plus-Plus</a><li><a href=https://lifailon.github.io/devops/#uninstall-notepad-plus-plus>Uninstall-Notepad-Plus-Plus</a><li><a href=https://lifailon.github.io/devops/#deploy-winscp>Deploy-WinSCP</a></ul><li><a href=https://lifailon.github.io/devops/#atlassian>Atlassian</a><ul><li><a href=https://lifailon.github.io/devops/#bitbucket>Bitbucket</a><li><a href=https://lifailon.github.io/devops/#jira>Jira</a><li><a href=https://lifailon.github.io/devops/#confluence>Confluence</a></ul><li><a href=https://lifailon.github.io/devops/#prometheus>Prometheus</a><li><a href=https://lifailon.github.io/devops/#zabbix>Zabbix</a><ul><li><a href=https://lifailon.github.io/devops/#zabbix-agent>Zabbix Agent</a><li><a href=https://lifailon.github.io/devops/#zabbix-sender>Zabbix Sender</a><li><a href=https://lifailon.github.io/devops/#zabbix-get>Zabbix Get</a><li><a href=https://lifailon.github.io/devops/#userparameter>UserParameter</a><li><a href=https://lifailon.github.io/devops/#include-plugins>Include Plugins</a><li><a href=https://lifailon.github.io/devops/#zabbix-api>Zabbix API</a></ul><li><a href=https://lifailon.github.io/devops/#load-testing>Load Testing</a><ul><li><a href=https://lifailon.github.io/devops/#apache-benchmark>Apache Benchmark</a><li><a href=https://lifailon.github.io/devops/#locust>Locust</a></ul><li><a href=https://lifailon.github.io/devops/#graylog>Graylog</a></ul></div></div><main id=main-content><div id=buttons-container><a title="Go to Top" href=#top id=go-to-top><i class=icon></i></a></div><h1>DevOps</h1><p>Заметки по инструментам и системам направления <code>DevOps</code>.<hr><h1 id=git><a aria-label="Anchor link for: git" class=zola-anchor href=#git><i class=icon></i></a> Git</h1><p><code>git --version</code> <br> <code>git config --global user.name "Lifailon"</code> добавить имя для коммитов <br> <code>git config --global user.email "lifailon@yandex.ru"</code> <br> <code>git config --global --edit</code> <br> <code>git config --global core.editor "code --wait"</code> изменить редактор коммитов по умолчанию <br> <code>ssh-keygen -t rsa -b 4096</code> <br> <code>Get-Service | where name -match "ssh-agent" | Set-Service -StartupType Automatic</code> <br> <code>Get-Service | where name -match "ssh-agent" | Start-Service</code> <br> <code>Get-Service | where name -match "ssh-agent" | select Name,Status,StartType</code> <br> <code>ssh-agent</code> <br> <code>ssh-add C:\Users\Lifailon\.ssh\id_rsa</code> <br> <code>cat ~\.ssh\id_rsa.pub | Set-Clipboard</code> copy to <a href=https://github.com/settings/keys>settings keys</a> <br> <code>cd $home\Documents\Git</code> <br> <code>git clone git@github.com:Lifailon/lifailon.github.io</code> <br> <code>cd lifailon.github.io</code> <br> <code>git grep "ping ya.ru"</code> поиск текста в файлах <br> <code>git fetch</code> загрузить изменения из удаленного хранилища для обновления всех веток локального репозитория, не затрагивая текущую рабочую ветку (загружает все коммиты, ветки и т.д. которые не присутствуют в локальном репозитории) <br> <code>git fetch --all</code> загрузить все ветки с удаленного репозитория (обновляет информацию о состоянии удаленного репозитория и загружает все изменения ваших веток без автоматического объединения) <br> <code>git pull</code> загрузить изменения из удаленного хранилища для обновления локального репозитория (выполняет <code>git fetch</code>, чтобы получить последние изменения из удаленного репозитория, а затеим объеденяем изменения с локальной копией с помощью <code>git merge</code> для обновления текущей рабочей ветки) <br> <code>git stash</code> сохраняет текущие незакоммиченные изменения в временное хранилище (например, на время выполнения <code>git pull</code>), в т.ч. неотслеживаемые файлы и очищает рабочую директорию (вернет в состояние, соответствующее последнему коммиту) <br> <code>git stash pop</code> применяет последние изменения из стэша к текущей ветке (вернутся только измененные строки в файлах, при этом будут сохранены новые добавленные строки в файле без конфликтов) и удаляет их из стэша <br> <code>git stash apply</code> применяет изменения, но не удаляет их из стэша <br> <code>git status</code> отобразить статус изменений по файлам <br> <code>git diff</code> отобразить историю изменений построчно <br> <code>git diff pandoc</code> сравнивает изменения в текущей рабочей директории с последним коммитом в указанной ветке <code>pandoc</code> <br> <code>git add .</code> добавить (проиндексировать) изменения во всех файлах текущего каталога <br> <code>git commit -m "update powershell commands"</code> сохранить изменения с комментарием <br> <code>git push</code> синхронизировать локальные изменения с репозиторием на сервере <br> <code>git push origin mkdocs-material</code> отправить в конкретную ветку <br> <code>git push origin --delete mkdocs</code> удалить ветку на удаленном сервере <br> <code>git commit --amend</code> изменить комментарий в последнем коммите (до <code>push</code>) <br> <code>git commit --amend --no-edit --date="Sun Oct 27 23:20:00 2024 +0300"</code> изменить дату последнего коммита <br> <code>git branch -a</code> отобразить все ветки (в том числе удаленные remotes/origin) <br> <code>git branch hugo</code> создать новую ветку <br> <code>git branch -m hugo-public</code> переименовать текущую ветку <br> <code>git branch -d hugo-public</code> удалить ветку <br> <code>git switch hugo</code> переключиться на другую ветку <br> <code>git push origin hugo</code> отправить изменения в указанную ветку <br> <code>git branch --set-upstream-to=origin/hugo hugo</code> локальная ветка <code>hugo</code> будет отслеживать удаленную ветку <code>hugo</code> на удаленном сервере-репозитории <code>origin</code> (позволяет не указывать название удаленной ветки при каждом использовании команд <code>git push</code> или <code>git pull</code>) <br> <code>git switch pandoc</code> переключиться на другую ветку <br> <code>git merge hugo</code> слияние указанной ветки (<code>hugo</code>) в текущую ветку (<code>pandoc</code>) <br> <code>git log --oneline --all</code> отобразить список всех коммитов и их сообщений <br> <code>git log --graph</code> коммиты и следование веток <br> <code>git log --author="Lifailon"</code> показывает историю коммитов указанного пользователя <br> <code>git blame .\posh.md</code> показывает, кто и когда внес изменения в каждую строку указанного файла (<code>НОМЕР_КОММИТА (ИМЯ_ПОЛЬЗОВАТЕЛЯ ДАТА НОМЕР_СТРОКИ) ТЕКСТ.</code>) <br> <code>git show d01f09dead3a6a8d75dda848162831c58ca0ee13</code> отобразить подробный лог по номеру коммита <br> <code>git checkout filename</code> устаревшая команда, откатить не проиндексированные изменения для коммита, возвращая его к состоянию, каким оно было на момент последнего коммита (если не было индексации через <code>add</code>) <br> <code>git restore filename</code> отменить все локальные изменения в рабочей копии независимо от того, были они проиндексированы или нет (через <code>add</code>), возвращая его к состоянию на момент последнего коммита <br> <code>git restore --source d01f09dead3a6a8d75dda848162831c58ca0ee13 filename</code> восстановить файл на указанную версию по хэшу индентификатора коммита <br> <code>git reset HEAD filename</code> удалить указанный файл из индекса без удаления самих изменений в файле для последующей повторной индексации (если был <code>add</code> но не было <code>commit</code>, потом выполнить <code>checkout</code>) <br> <code>git reset --soft HEAD^</code> отменяет последний (^) коммит, сохраняя изменения из этого коммита в рабочем каталоге и индексе (подготовленной области), можно внести изменения в файлы и повторно их зафиксировать через <code>commit</code> <br> <code>git reset --hard HEAD^</code> полностью отменяет последний коммит, удаляя все его изменения из рабочего каталога и индекса до состояния предыдущего перед последним коммитом (аналогично <code>HEAD~1</code>) <br> <code>git push origin main --force</code> удалить последний коммит на удаленном сервере репозитория после <code>reset --hard HEAD^</code> <br> <code>git reset --hard d01f09dead3a6a8d75dda848162831c58ca0ee13</code> откатывает изменения к указанному коммиту и удаляет все коммиты, которые были сделаны после него (будут потеряны все незакоммиченные изменения и историю коммитов после указанного) <br> <code>git revert HEAD --no-edit</code> создает новый коммит, который отменяет последний коммит (<code>HEAD^</code>) и новый коммит будет добавлен поверх него (события записываются в <code>git log</code>) <br> <code>git revert d01f09dead3a6a8d75dda848162831c58ca0ee13</code> создает новый коммит, который отменяет изменения, внесенные в указанный коммит с хешем (не изменяет историю коммитов, а создает новый коммит с изменениями отмены)<h1 id=github-api><a aria-label="Anchor link for: github-api" class=zola-anchor href=#github-api><i class=icon></i></a> GitHub api</h1><p><code>$user = "Lifailon"</code> <br> <code>$repository = "ReverseProxyNET"</code> <br> <code>Invoke-RestMethod https://api.github.com/users/$($user)</code> получаем информацию о пользователе <br> <code>Invoke-RestMethod https://api.github.com/users/$($user)/repos</code> получаем список последних (актуальные коммиты) 30 репозиториев указанного пользователя <br> <code>Invoke-RestMethod https://api.github.com/users/$($user)/repos?per_page=100</code> получаем список последних (актуальные коммиты) 100 репозиториев указанного пользователя <br> <code>Invoke-RestMethod https://api.github.com/repos/$($user)/$($repository)/contents</code> получаем содержимое корневой директории репозитория <br> <code>Invoke-RestMethod https://api.github.com/repos/$($user)/$($repository)/contents/source/rpnet.cs</code> получаем содержимое файла в формате Base64 <br> <code>$commits = Invoke-RestMethod https://api.github.com/repos/$($user)/$($repository)/commits</code> получаем список коммитов <br> <code>$commits[0].commit.message</code> читаем комментарий последнего коммита <br> <code>$commits[0].commit.committer.date</code> получаем дату последнего коммита <br> <code>Invoke-RestMethod https://api.github.com/repos/$($user)/$($repository)/commits/$($commits[0].sha)</code> получаем подробную информацию изменений о последнем коммите в репозитории <br> <code>$releases_latest = Invoke-RestMethod "https://api.github.com/repos/$($user)/$($repository)/releases/latest"</code> получаем информацию о последнем релизе в репозитории <br> <code>$releases_latest.assets.name</code> список приложенных файлов последнего релиза <br> <code>$releases_latest.assets.browser_download_url</code> получаем список url для загрузки файлов <br> <code>$($releases_latest.assets | Where-Object name -like "*win*x64*exe*").browser_download_url</code> фильтруем по ОС и разрядности <br> <code>$(Invoke-RestMethod -Uri "https://api.github.com/repos/Lifailon/epic-games-radar/commits?path=api/giveaway/index.json")[0].commit.author.date</code> узнать дату последнего обновления файла в репозитории <br> <code>$issues = Invoke-RestMethod https://api.github.com/repos/LibreHardwareMonitor/LibreHardwareMonitor/issues?per_page=500</code> получаем список открытых проблем в репозитории (получаем максимум 100 последних, по умолчанию забираем последние 30 issues) <br> <code>$issue_number = $($issues | Where-Object title -match "PowerShell").number</code> получаем номер issue, в заголовке которого есть слово “PowerShell” <br> <code>Invoke-RestMethod https://api.github.com/repos/LibreHardwareMonitor/LibreHardwareMonitor/issues/$($issue_number)/comments</code> отобразить список комментарием указанного issues <br> <code>Invoke-RestMethod https://api.github.com/repos/LibreHardwareMonitor/LibreHardwareMonitor/languages</code> получаем список языков программирования, используемых в репозитории <br> <code>Invoke-RestMethod https://api.github.com/repos/LibreHardwareMonitor/LibreHardwareMonitor/pulls</code> получаем список всех pull requests в репозитории <br> <code>Invoke-RestMethod https://api.github.com/repos/LibreHardwareMonitor/LibreHardwareMonitor/forks</code> получаем список форков (forks) <br> <code>Invoke-RestMethod https://api.github.com/repos/LibreHardwareMonitor/LibreHardwareMonitor/stargazers?per_page=4000</code> получаем список пользователей, которые поставили звезды репозиторию <br> <code>Invoke-RestMethod https://api.github.com/repos/LibreHardwareMonitor/LibreHardwareMonitor/subscribers</code> получаем список подписчиков (watchers) репозитория<h1 id=github-actions><a aria-label="Anchor link for: github-actions" class=zola-anchor href=#github-actions><i class=icon></i></a> GitHub Actions</h1><h2 id=runner-agent><a aria-label="Anchor link for: runner-agent" class=zola-anchor href=#runner-agent><i class=icon></i></a> Runner (Agent)</h2><p><code>mkdir actions-runner; cd actions-runner</code> <br> <code>Invoke-WebRequest -Uri https://github.com/actions/runner/releases/download/v2.316.1/actions-runner-win-x64-2.316.1.zip -OutFile actions-runner-win-x64-2.316.1.zip</code> загрузить пакет с Runner последней версии <br> <code>if((Get-FileHash -Path actions-runner-win-x64-2.316.1.zip -Algorithm SHA256).Hash.ToUpper() -ne 'e41debe4f0a83f66b28993eaf84dad944c8c82e2c9da81f56a850bc27fedd76b'.ToUpper()){ throw 'Computed checksum did not match' }</code> проверить валидность пакета с помощью hash-суммы <br> <code>Add-Type -AssemblyName System.IO.Compression.FileSystem ; [System.IO.Compression.ZipFile]::ExtractToDirectory("$PWD/actions-runner-win-x64-2.316.1.zip", "$PWD")</code> разархивировать <br> <code>Remove-Item *.zip</code> удалить архив <br> <code>./config.cmd --url https://github.com/Lifailon/egapi --token XXXXXXXXXXXXXXXXXXXXXXXXXXXXX</code> авторизовать и сконфигурировать сборщика с помощью скрипта (что бы на последнем пункте создать службу для управления сборщиком, нужно запустить консоль с правами администратора) <br> <code>./run.cmd</code> запустить процесс (если не используется служба) <br> <code>Get-Service *actions* | Start-Service</code> запустить службу <br> <code>Get-Process *Runner.Listener*</code> <br> <code>./config.cmd remove --token XXXXXXXXXXXXXXXXXXXXXXXXXXXXX</code> удалить конфигурацию<h2 id=build-pipeline><a aria-label="Anchor link for: build-pipeline" class=zola-anchor href=#build-pipeline><i class=icon></i></a> Build (Pipeline)</h2><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">build-game-list</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-constant z-language z-boolean z-yaml">on</span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Разрешить ручной запуск workflow через интерфейс GitHub
</span></span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">workflow_dispatch</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  
</span><span class="z-source z-yaml">  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Запускать workflow по расписанию каждый час в 00 минут
</span></span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">schedule</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">cron</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-single z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">'</span>00 * * * *<span class="z-punctuation z-definition z-string z-end z-yaml">'</span></span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">jobs</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">Job_01</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Указываем, что job будет выполняться на последней версии Ubuntu
</span></span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">runs-on</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ubuntu-latest</span>
</span><span class="z-source z-yaml">    
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">steps</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Шаги, которые будут выполнены в рамках этого job
</span></span><span class="z-source z-yaml">    <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Checkout repository</span>
</span><span class="z-source z-yaml">      <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Клонирования репозиторий
</span></span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">uses</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">actions/checkout@v2</span>
</span><span class="z-source z-yaml">    
</span><span class="z-source z-yaml">    <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Get content and write to file</span>
</span><span class="z-source z-yaml">      <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Выполняем скрипт PowerShell, расположенный в ./scripts/Get-GameList.ps1
</span></span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">run</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">pwsh -File ./scripts/Get-GameList.ps1</span>
</span><span class="z-source z-yaml">      <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Указываем, что команда должна выполняться в оболочке bash
</span></span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">shell</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">bash</span> 
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">    <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Commit and push changes</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">run</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-keyword z-control z-flow z-block-scalar z-literal z-yaml">|</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">        # Задаем имя пользователя и email для коммитов
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">        git config --global user.name 'GitHub Actions'
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">        git config --global user.email 'actions@github.com'
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">        # Добавляем все изменения в индекс
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">        git add .
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">        # Делаем коммит с комментарием
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">        git commit -m "update game list"
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">        # Отправляем коммит в удаленный репозиторий
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">        git push
</span></span></code></pre><h2 id=ci><a aria-label="Anchor link for: ci" class=zola-anchor href=#ci><i class=icon></i></a> CI</h2><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Docker Build and Push Image</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-constant z-language z-boolean z-yaml">on</span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Запусать при git push в ветку main
</span></span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">push</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">branches</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">main</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">jobs</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">build</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">runs-on</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ubuntu-latest</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">steps</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Клонируем репозиторий</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">uses</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">actions/checkout@v2</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">    <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Авторизация в Docker Hub</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">uses</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">docker/login-action@v3</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">with</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">username</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">${{ secrets.DOCKER_USERNAME }}</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">password</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">${{ secrets.DOCKER_PASSWORD }}</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">    <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Сборка образа и отправка в Docker Hub</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">run</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-keyword z-control z-flow z-block-scalar z-literal z-yaml">|</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">        docker build -t lifailon/torapi:latest .
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">        docker push lifailon/torapi:latest
</span></span></code></pre><h2 id=logs><a aria-label="Anchor link for: logs" class=zola-anchor href=#logs><i class=icon></i></a> Logs</h2><p><code>$(Invoke-RestMethod https://api.github.com/repos/Lifailon/TorAPI/actions/workflows).total_count</code> получить количество запусков всех рабочих процессов <br> <code>$(Invoke-RestMethod https://api.github.com/repos/Lifailon/TorAPI/actions/workflows).workflows</code> подробная информации о запускаемых рабочих процессах <br> <code>$actions_last_id = $(Invoke-RestMethod https://api.github.com/repos/Lifailon/TorAPI/actions/workflows).workflows[-1].id</code> получить идентификатор последнего события <br> <code>$(Invoke-RestMethod https://api.github.com/repos/Lifailon/TorAPI/actions/workflows/$actions_last_id/runs).workflow_runs</code> подробная информация о последней сборке <br> <code>$run_id = $(Invoke-RestMethod https://api.github.com/repos/Lifailon/TorAPI/actions/workflows/$actions_last_id/runs).workflow_runs.id</code> получить идентификатор запуска рабочего процесса <br> <code>$(Invoke-RestMethod "https://api.github.com/repos/Lifailon/TorAPI/actions/runs/$run_id/jobs").jobs.steps</code> подробная информация для всех шагов выполнения (время работы и статус выполнения) <br> <code>$jobs_id = $(Invoke-RestMethod "https://api.github.com/repos/Lifailon/TorAPI/actions/runs/$run_id/jobs").jobs[0].id</code> получить идентификатор последнего задания указанного рабочего процесса<pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>url</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>https://api.github.com/repos/Lifailon/TorAPI/actions/jobs/<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>jobs_id</span>/logs<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>headers</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">Authorization</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>token ghp_XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Uri <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>url</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Headers <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>headers</span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> получить логи задания<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></code></pre><h2 id=act><a aria-label="Anchor link for: act" class=zola-anchor href=#act><i class=icon></i></a> act</h2><p><a href=https://github.com/nektos/act>act</a> - пользволяет запускать действия GitHub Actions локально.<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">version</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">curl</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>s</span> https://api.github.com/repos/nektos/act/releases/latest</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">jq</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>r</span> .tag_name</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">curl</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>L</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>https://github.com/nektos/act/releases/download/<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">version</span></span>/act_<span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">uname</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>s</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span>_<span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">uname</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>m</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span>.tar.gz<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>o</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">HOME</span></span>/.local/bin/act.tar.gz</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">tar</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>xzf</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">HOME</span></span>/.local/bin/act.tar.gz<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>C</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">HOME</span></span>/.local/bin</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">chmod</span></span><span class="z-meta z-function-call z-arguments z-shell"> +x <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">HOME</span></span>/.local/bin/act</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">rm</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">HOME</span></span>/.local/bin/act.tar.gz</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">act</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>version</span></span>
</span></code></pre><p><code>act --list</code> список доступных действий, указаных в файлах .github/workflows <br> <code>act -j build</code> запуск указанного действия по Job ID (имя файла, не путать с названием Workflow) <br> <code>act -n -j build</code> пробный запуск (–dry-run), без выполнения команд, для отображения всех выполняемых jobs и steps<pre class="language-json z-code" data-lang=json><code class=language-json data-lang=json><span class="z-source z-json"><span class="z-meta z-mapping z-json"><span class="z-punctuation z-section z-mapping z-begin z-json">{</span>
</span></span><span class="z-source z-json"><span class="z-meta z-mapping z-json">  </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>inputs<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-json"><span class="z-punctuation z-section z-mapping z-begin z-json">{</span>
</span></span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-json">    </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>Distro<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>ubuntu-24.04<span class="z-punctuation z-definition z-string z-end z-json">"</span></span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
</span></span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-value z-json">    </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>Update<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>false<span class="z-punctuation z-definition z-string z-end z-json">"</span></span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
</span></span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-value z-json">    </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>Linter<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>true<span class="z-punctuation z-definition z-string z-end z-json">"</span></span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
</span></span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-value z-json">    </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>Test<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>false<span class="z-punctuation z-definition z-string z-end z-json">"</span></span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
</span></span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-value z-json">    </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>Release<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>false<span class="z-punctuation z-definition z-string z-end z-json">"</span></span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
</span></span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-value z-json">    </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>Binary<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>true<span class="z-punctuation z-definition z-string z-end z-json">"</span></span>
</span></span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-value z-json">  <span class="z-punctuation z-section z-mapping z-end z-json">}</span></span>
</span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-section z-mapping z-end z-json">}</span></span>
</span></code></pre><p><code>act -e event.json -W .github/workflows/build.yml -P ubuntu-24.04=catthehacker/ubuntu:act-latest</code> запустить указанный файл workflow с переданным файлом переменных (предварительно определенных параметров) и указанным сборщиком <br> <code>act -e event.json -W .github/workflows/build.yml -P ubuntu-24.04=catthehacker/ubuntu:act-latest --artifact-server-path $PWD/artifacts</code> примонтировать рабочий каталог в контейнер для сохранения артефактов<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>DOCKER_HUB_USERNAME=username<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">>></span> .secrets</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>DOCKER_HUB_PASSWORD=password<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">>></span> .secrets</span>
</span></code></pre><p><code>act --secret-file .secrets</code> <br> <code>act -s DOCKER_HUB_USERNAME=username -s DOCKER_HUB_PASSWORD=password</code> передать содержимое секретов <br> <code>act push</code> симуляция push-ивента (имитация коммита и запуск workflow, который реагирует на push) <br> <code>act --reuse</code> не удалять контейнер из успешно завершенных рабочих процессов для сохранения состояния между запусками (кэширование) <br> <code>act --parallel</code> запуск всех jobs одновременно или последовательно (–no-parallel, по умолчанию)<h1 id=vercel><a aria-label="Anchor link for: vercel" class=zola-anchor href=#vercel><i class=icon></i></a> Vercel</h1><p><code>npm i -g vercel</code> установить глобально в систему Vercel CLI <br> <code>vercel --version</code> выводит текущую версию установленного Vercel CLI <br> <code>vercel login</code> выполняет вход в аккаунт Vercel (<code>> Continue with GitHub</code>) <br> <code>vercel logout</code> выполняет выход из аккаунта Vercel <br> <code>vercel init</code> инициализирует новый проект в текущей директории (создает файл конфигурации vercel.json и другие файлы, необходимые для проекта) <br> <code>vercel dev</code> запускает локальный сервер для проверки работоспособности (http://localhost:3000) <br> <code>vercel deploy</code> загружает проект на серверы Vercel и развертывает его <br> <code>vercel link</code> привязывает текущую директорию к существующему проекту на сервере Vercel (выбрать из списка) <br> <code>vercel unlink</code> отменяет привязку текущей директории от проекта Vercel <br> <code>vercel env</code> управляет переменными окружения для проекта <br> <code>vercel env pull</code> подтягивает переменные окружения с Vercel в локальный .env файл <br> <code>vercel env ls</code> показывает список всех переменных окружения для проекта <br> <code>vercel env add &LTkey> &LTenvironment></code> добавляет новую переменную окружения для указанного окружения (production, preview, development) <br> <code>vercel env rm &LTkey> &LTenvironment></code> удаляет переменную окружения из указанного окружения <br> <code>vercel projects</code> управляет проектами Vercel <br> <code>vercel projects ls</code> показывает список всех проектов <br> <code>vercel projects add</code> добавляет новый проект <br> <code>vercel projects rm &LTproject></code> удаляет указанный проект <br> <code>vercel pull</code> подтягивает последние настройки окружения с Vercel <br> <code>vercel alias</code> управляет алиасами доменов для проектов <br> <code>vercel alias ls</code> показывает список всех алиасов для текущего проекта <br> <code>vercel alias set &LTalias></code> устанавливает алиас для указанного проекта <br> <code>vercel alias rm &LTalias></code> удаляет указанный алиас <br> <code>vercel domains</code> управляет доменами, привязанными к проекту <br> <code>vercel domains ls</code> показывает список всех доменов <br> <code>vercel domains add &LTdomain></code> добавляет новый домен к проекту <br> <code>vercel domains rm &LTdomain></code> удаляет указанный домен <br> <code>vercel teams</code> управляет командами и членами команд на Vercel <br> <code>vercel teams ls</code> показывает список всех команд <br> <code>vercel teams add &LTteam></code> добавляет новую команду <br> <code>vercel teams rm &LTteam></code> удаляет указанную команду <br> <code>vercel logs &LTdeployment></code> выводит логи для указанного деплоя <br> <code>vercel secrets</code> управляет секретами, используемыми в проектах <br> <code>vercel secrets add &LTname> &LTvalue></code> добавляет новый секрет <br> <code>vercel secrets rm &LTname></code> удаляет указанный секрет <br> <code>vercel secrets ls</code> показывает список всех секретов <br> <code>vercel switch &LTteam></code> переключается между командами и аккаунтами Vercel<h2 id=cd><a aria-label="Anchor link for: cd" class=zola-anchor href=#cd><i class=icon></i></a> CD</h2><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Deploy to Vercel</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-constant z-language z-boolean z-yaml">on</span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">workflow_dispatch</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">jobs</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">deploy</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">runs-on</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ubuntu-latest</span>
</span><span class="z-source z-yaml">    
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">steps</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Clone repository</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">uses</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">actions/checkout@v4</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">    <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Install Node.js</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">uses</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">actions/setup-node@v4</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">with</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">node-version</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-single z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">'</span>20<span class="z-punctuation z-definition z-string z-end z-yaml">'</span></span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">    <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Install dependencies</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">run</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">npm install</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">    <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Deploy to Vercel</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">uses</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">amondnet/vercel-action@v25</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">with</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">vercel-token</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">${{ secrets.VERCEL_TOKEN }}</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">vercel-org-id</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">${{ secrets.VERCEL_ORG_ID }}</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">vercel-project-id</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">${{ secrets.VERCEL_PROJECT_ID }}</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">vercel-args</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-single z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">'</span>--prod<span class="z-punctuation z-definition z-string z-end z-yaml">'</span></span>
</span></code></pre><h1 id=gitlab><a aria-label="Anchor link for: gitlab" class=zola-anchor href=#gitlab><i class=icon></i></a> GitLab</h1><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> run<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>detach</span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>hostname</span> 192.168.3.101 <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>publish</span> 443:443<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>publish</span> 80:80<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>publish</span> 2222:22 <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>name</span> gitlab <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>restart</span> always <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>volume</span> /srv/gitlab/config:/etc/gitlab <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>volume</span> /srv/gitlab/logs:/var/log/gitlab <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>volume</span> /srv/gitlab/data:/var/opt/gitlab <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell">    gitlab/gitlab-ee:latest</span>
</span></code></pre><p><code>docker logs -f gitlab</code> логи контейнера <br> <code>docker exec -it gitlab cat /etc/gitlab/initial_root_password</code> получить пароль для root <br> <code>docker exec -it gitlab cat /etc/gitlab/gitlab.rb</code> конфигурация сервера<p>Получить токен регистрации Runner: http://192.168.3.101/root/torapi/-/settings/ci_cd#js-runners-settings<p><code>curl -L --output /usr/local/bin/gitlab-runner https://gitlab-runner-downloads.s3.amazonaws.com/latest/binaries/gitlab-runner-linux-amd64</code> загрузить исполняемый файл Runner <code>chmod +x /usr/local/bin/gitlab-runner</code><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> run<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>d</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>name</span> gitlab-runner<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>restart</span> always <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    -</span>v</span> /srv/gitlab-runner/config:/etc/gitlab-runner <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell">    gitlab/gitlab-runner:latest</span>
</span></code></pre><p><code>docker exec -it gitlab-runner bash</code> <br> <code>gitlab-runner list</code> список сборщиков <br> <code>gitlab-runner verify</code> проверка <br> <code>gitlab-runner restart</code> применить настройки <br> <code>gitlab-runner status</code> статус <br> <code>gitlab-runner unregister --all-runners</code> удалить все регистрации <br> <code>gitlab-runner install</code> установить службу <br> <code>gitlab-runner run</code> запустить с выводом в консоль<p><code>gitlab-runner register</code><pre class=z-code><code><span class="z-text z-plain">Enter the GitLab instance URL (for example, https://gitlab.com/): http://192.168.3.101/
</span><span class="z-text z-plain">Enter the registration token: GR1348941enqAxqQgm8AZJD_g7vme
</span><span class="z-text z-plain">Enter an executor: shell
</span></code></pre><p><code>cat /etc/gitlab-runner/config.toml</code> конфигурация<p>Включить импорт проектов из GitHub: http://192.168.3.101/admin/application_settings/general#js-import-export-settings<pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">variables</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">PORT</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">2024</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">TITLE</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>The+Rookie<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">stages</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">test</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">test</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">stage</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">test</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">script</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-keyword z-control z-flow z-block-scalar z-literal z-yaml">|</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">        pwsh -Command "
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">            Write-Host PORT - $env:PORT
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">            Write-Host TITLE - $env:TITLE
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">            npm install
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">            Start-Process -NoNewWindow -FilePath 'npm' -ArgumentList 'start -- --port $env:PORT' -RedirectStandardOutput 'torapi.log'
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">            Start-Sleep -Seconds 5
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">            Invoke-RestMethod -Uri http://localhost:$env:PORT/api/search/title/all?query=$env:TITLE | Format-List
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">            Get-Content torapi.log
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">            Stop-Process -Name 'node' -Force -ErrorAction SilentlyContinue
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">        "
</span></span></code></pre><h1 id=jenkins><a aria-label="Anchor link for: jenkins" class=zola-anchor href=#jenkins><i class=icon></i></a> Jenkins</h1><p>Примеры <code>Pipeline</code> и базовый синтаксис <code>Groovy</code>.<p><code>docker run -d --name=jenkins -p 8080:8080 -p 50000:50000 --restart=unless-stopped -v jenkins_home:/var/jenkins_home jenkins/jenkins:latest</code> <br> <code>ls /var/lib/docker/volumes/jenkins_home/_data/jobs</code> директория хранящая историю сборок в хостовой системе <br> <code>docker exec -it jenkins /bin/bash</code> подключиться к контейнеру <br> <code>cat /var/jenkins_home/secrets/initialAdminPassword</code> получить токен инициализации<pre class=z-code><code><span class="z-text z-plain">docker run -d \
</span><span class="z-text z-plain">  --name jenkins-remote-agent-01 \
</span><span class="z-text z-plain">  --restart unless-stopped \
</span><span class="z-text z-plain">  -e JENKINS_URL=http://192.168.3.101:8080 \
</span><span class="z-text z-plain">  -e JENKINS_AGENT_NAME=remote-agent-01 \
</span><span class="z-text z-plain">  -e JENKINS_SECRET=3ad54fc9f914957da8205f8b4e88ff8df20d54751545f34f22f0e28c64b1fb29 \
</span><span class="z-text z-plain">  -v jenkins_agent:/home/jenkins \
</span><span class="z-text z-plain">  jenkins/inbound-agent:latest
</span><span class="z-text z-plain">
</span><span class="z-text z-plain"># Или ссылаться на локальный контейнер сервера по имени
</span><span class="z-text z-plain"># --link jenkins:jenkins
</span><span class="z-text z-plain"># -e JENKINS_URL=http://jenkins:8080
</span></code></pre><p><code>docker exec -u root -it jenkins-remote-agent-01 /bin/bash</code> подключиться к slave агенту под root <br> <code>apt-get update && apt-get install -y iputils-ping netcat-openbsd</code> установить ping и nc на машину сборщика (slave)<p><code>jenkinsVolumePath=$(docker inspect jenkins | jq -r .[].Mounts.[].Source)</code> получить путь к директории Jenkins в хостовой системе <br> <code>sudo tar -czf $HOME/jenkins-backup.tar.gz -C $jenkinsVolumePath .</code> резервная копия всех файлов <br> <code>(crontab -l ; echo "0 23 * * * sudo tar -czf /home/lifailon/jenkins-backup.tar.gz -C /var/lib/docker/volumes/jenkins_home/_data .") | crontab -</code> <br> <code>sudo tar -xzf $HOME/jenkins-backup.tar.gz -C /var/lib/docker/volumes/jenkins_home/_data</code> восстановление<p><code>wget http://127.0.0.1:8080/jnlpJars/jenkins-cli.jar -P $HOME/</code> скачать jenkins-cli (http://127.0.0.1:8080/manage/cli) <br> <code>apt install openjdk-17-jre-headless</code> установить java runtime <br> <code>java -jar jenkins-cli.jar -auth lifailon:password -s http://127.0.0.1:8080 -webSocket help</code> получить список команд <br> <code>java -jar jenkins-cli.jar -auth lifailon:password -s http://127.0.0.1:8080 groovysh</code> запустить консоль Groovy <br> <code>java -jar jenkins-cli.jar -auth lifailon:password -s http://127.0.0.1:8080 install-plugin ssh-steps -deploy</code> устанавливаем плагин SSH Pipeline Steps<h2 id=api><a aria-label="Anchor link for: api" class=zola-anchor href=#api><i class=icon></i></a> API</h2><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>username</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Lifailon<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>password</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>password<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>base64AuthInfo</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">Convert</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::ToBase64String<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">Text.Encoding</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::ASCII.GetBytes<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>{0}:{1}<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-string-format z-powershell">-f</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>username</span><span class="z-keyword z-operator z-other z-powershell">,</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>password</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>headers</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span><span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">Authorization</span><span class="z-keyword z-operator z-assignment z-powershell">=</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Basic {0}<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-string-format z-powershell">-f</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>base64AuthInfo</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>http://192.168.3.101:8080/rssAll<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Headers <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>headers</span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> RSS лента всех сборок и их статус в title<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>http://192.168.3.101:8080/rssFailed<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Headers <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>headers</span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> RSS лента всех неудачных сборок<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-group z-complex z-subexpression z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>http://192.168.3.101:8080/computer/local-agent/api/json<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Headers <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>headers</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span>.offline <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> проверить статус работы slave агента<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>jobs</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>http://192.168.3.101:8080/api/json/job<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Headers <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>headers</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>jobs<span class="z-variable z-other z-member z-powershell">.jobs.name</span></span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> список всех проектов<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>jobName</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Update SSH authorized_keys<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>job</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>http://192.168.3.101:8080/job/<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-braces z-begin">{</span>jobName<span class="z-punctuation z-section z-braces z-end">}</span></span>/api/json<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Headers <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>headers</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>job<span class="z-variable z-other z-member z-powershell">.builds</span></span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> список всех сборок<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>buildNumber</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>job<span class="z-variable z-other z-member z-powershell">.lastUnsuccessfulBuild.number</span></span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> последняя неуспешная сборка<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>http://192.168.3.101:8080/job/<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-braces z-begin">{</span>jobName<span class="z-punctuation z-section z-braces z-end">}</span></span>/<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-braces z-begin">{</span>buildNumber<span class="z-punctuation z-section z-braces z-end">}</span></span>/consoleText<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Headers <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>headers</span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> вывести лог указанной сборки<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>lastCompletedBuild</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>job<span class="z-variable z-other z-member z-powershell">.lastCompletedBuild.number</span></span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> последняя успешная сборка<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>crumb</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-group z-complex z-subexpression z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>http://192.168.3.101:8080/crumbIssuer/api/json<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Headers <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>headers</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span>.crumb <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> получаем временный токен доступа (crumb)<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>headers</span><span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Jenkins-Crumb<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>crumb</span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> добавляем crumb в заголовки<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>body</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>.crumb<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>crumb</span><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> добавляем crumb в тело запроса<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>http://192.168.3.101:8080/job/<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-braces z-begin">{</span>jobName<span class="z-punctuation z-section z-braces z-end">}</span></span>/<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-braces z-begin">{</span>lastCompletedBuild<span class="z-punctuation z-section z-braces z-end">}</span></span>/rebuild<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Headers <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>headers</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Method POST <span class="z-keyword z-operator z-assignment z-powershell">-</span>Body <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>body</span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> перезапустить сборку<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></code></pre><h2 id=plugins><a aria-label="Anchor link for: plugins" class=zola-anchor href=#plugins><i class=icon></i></a> Plugins</h2><table><thead><tr><th>Плагин<th>Описание<tbody><tr><td><a href=https://plugins.jenkins.io/monitoring>Web Monitoring</a><td>Конечная точка <code>/monitoring</code> для отображения графиков мониторинга в веб-интерфейсе.<tr><td><a href=https://plugins.jenkins.io/prometheus>Prometheus Metrics</a><td>Предоставляет конечную точку <code>/prometheus</code> с метриками, которые используются для сбора данных.<tr><td><a href=https://plugins.jenkins.io/embeddable-build-status>Embeddable Build Status</a><td>Предоставляет настраиваемые значки (like <code>shields.io</code>), который возвращает статус сборки.<tr><td><a href=https://plugins.jenkins.io/jobConfigHistory>Job Configuration History</a><td>Сохраняет копию файла сборки в формате <code>xml</code> (который хранится на сервере) и позволяет производить сверку.<tr><td><a href=https://plugins.jenkins.io/ssh-steps>SSH Pipeline Steps</a><td>Плагин для подключения к удаленным машинам через протокол ssh по ключу или паролю.<tr><td><a href=https://plugins.jenkins.io/uno-choice>Active Choices</a><td>Активные параметры, которые позволяют динамически обновлять содержимое параметров.<tr><td><a href=https://plugins.jenkins.io/file-parameters>File parameters</a><td>Поддержка параметров для загрузки файлов (перезагрузить Jenkins для использования нового параметра).<tr><td><a href=https://plugins.jenkins.io/email-ext>Email Extension</a><td>Плагин для отправки на почту из pipeline.<tr><td><a href=https://plugins.jenkins.io/schedule-build>Schedule Build</a><td>Позволяет запланировать сборку на указанный момент времени.<tr><td><a href=https://plugins.jenkins.io/test-results-analyzer>Test Results Analyzer</a><td>Показывает историю результатов сборки junit тестов в табличном древовидном виде.</table><h2 id=ssh-steps-and-artifacts><a aria-label="Anchor link for: ssh-steps-and-artifacts" class=zola-anchor href=#ssh-steps-and-artifacts><i class=icon></i></a> SSH Steps and Artifacts</h2><p>Добавляем логин и <code>Private Key</code> для авторизации по ssh: <code>Manage (Settings)</code> => <code>Credentials</code> => <code>Global</code> => <code>Add credentials</code> => Kind: <code>SSH Username with private key</code><p>Сценарий проверяет доступность удаленной машины, подключается к ней по ssh, выполняет скрипт <a href=https://github.com/Lifailon/hwstat>hwstat</a> для сбора метрик и выгружает json отчет в артефакты:<pre class="language-Groovy z-code" data-lang=Groovy><code class=language-Groovy data-lang=Groovy><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Глобальный массив для хранения данных подключения по ssh 
</span></span><span class="z-source z-groovy"><span class="z-storage z-type z-def z-groovy">def</span> remote <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span>:<span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span>
</span><span class="z-source z-groovy">
</span><span class="z-source z-groovy">pipeline <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    agent any <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> { label 'remote-agent-01' }
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    parameters <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">string</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>address<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">defaultValue</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>192.168.3.101<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">description</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Адрес удаленного сервера<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> choice(name: "addresses", choices: ["192.168.3.101","192.168.3.102"], description: "Выберите сервер из выпадающего списка")
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">string</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>port<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">defaultValue</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>22<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">description</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Порт ssh<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">string</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>credentials<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">defaultValue</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>d5da50fc-5a98-44c4-8c55-d009081a861a<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">description</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Идентификатор учетных данных из Jenkins<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">booleanParam</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>root<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">defaultValue</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-constant z-language z-groovy">false</span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">description</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Запуск с повышенными привилегиями<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">booleanParam</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>report<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">defaultValue</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-constant z-language z-groovy">true</span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">description</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Выгружать отчет в формате json<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    triggers <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">cron</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>H */6 * * 1-5<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> выполнять запуск каждын 6 часов с понедельника по пятницу
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    options <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">timeout</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">time</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-constant z-numeric z-groovy">5</span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">unit</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>MINUTES<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> период ожидания, после которого нужно прервать Pipeline
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">retry</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-numeric z-groovy">2</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> в случае неудачи повторить весь Pipeline указанное количество раз
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    environment <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Переменная окружения для хранения пути временного файла с содержимым приватного ключа
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-constant z-other z-groovy">SSH_KEY_FILE</span> <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>/tmp/ssh_key_<span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-constant z-other z-groovy">UUID</span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">randomUUID</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">toString</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    stages <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">stage</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Проверка доступности хоста (icmp и tcp)<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            steps <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                script <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-storage z-type z-def z-groovy">def</span> check <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">sh</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy">                        <span class="z-constant z-other z-key z-groovy">script</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-double z-block z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"""</span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                            ping -c 1 <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>address<span class="z-punctuation z-section z-embedded z-groovy">}</span></span> > /dev/null || exit 1
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                            nc -z <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>address<span class="z-punctuation z-section z-embedded z-groovy">}</span></span> <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>port<span class="z-punctuation z-section z-embedded z-groovy">}</span></span> || exit 2
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                        <span class="z-punctuation z-definition z-string z-end z-groovy">"""</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy">                        <span class="z-constant z-other z-key z-groovy">returnStatus</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-constant z-language z-groovy">true</span> <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> исключить завершение Pipeline с ошибкой
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy">                    <span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-keyword z-control z-groovy">if</span> (check <span class="z-keyword z-operator z-comparison z-groovy">==</span> <span class="z-constant z-numeric z-groovy">1</span>) <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">error</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Сервер <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>address<span class="z-punctuation z-section z-embedded z-groovy">}</span></span> недоступен (icmp ping)<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span> <span class="z-keyword z-control z-groovy">else</span> <span class="z-keyword z-control z-groovy">if</span> (check <span class="z-keyword z-operator z-comparison z-groovy">==</span> <span class="z-constant z-numeric z-groovy">2</span>) <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">error</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Порт <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>address<span class="z-punctuation z-section z-embedded z-groovy">}</span></span> закрыт (tcp check)<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span> <span class="z-keyword z-control z-groovy">else</span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Сервер <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>address<span class="z-punctuation z-section z-embedded z-groovy">}</span></span> доступен и порт <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>port<span class="z-punctuation z-section z-embedded z-groovy">}</span></span> открыт<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">stage</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Извлечение данных для авторизации по ключу<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            steps <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                script <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">withCredentials</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">sshUserPrivateKey</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">credentialsId</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>credentials<span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">usernameVariable</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>SSH_USER<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">keyFileVariable</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>SSH_KEY<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">passphraseVariable</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span><span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Записываем содержимое приватного ключа во временный файл
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">writeFile</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">file</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-storage z-type z-class z-groovy">env.SSH_KEY_FILE</span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">text</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">readFile</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-groovy">SSH_KEY</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        sh <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>chmod 600 <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-storage z-type z-class z-groovy">env.SSH_KEY_FILE</span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        remote<span class="z-punctuation z-accessor z-dot z-groovy">.</span>name <span class="z-keyword z-operator z-assignment z-groovy">=</span> params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>address
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        remote<span class="z-punctuation z-accessor z-dot z-groovy">.</span>host <span class="z-keyword z-operator z-assignment z-groovy">=</span> params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>address
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        remote<span class="z-punctuation z-accessor z-dot z-groovy">.</span>port <span class="z-keyword z-operator z-assignment z-groovy">=</span> params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>port<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">toInteger</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        remote<span class="z-punctuation z-accessor z-dot z-groovy">.</span>user <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-constant z-other z-groovy">SSH_USER</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        remote<span class="z-punctuation z-accessor z-dot z-groovy">.</span>identityFile <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-storage z-type z-class z-groovy">env.SSH_KEY_FILE</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        remote<span class="z-punctuation z-accessor z-dot z-groovy">.</span>allowAnyHosts <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-constant z-language z-groovy">true</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">stage</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Запуск скрипта через через ssh<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            steps <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                script <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-storage z-type z-def z-groovy">def</span> runCommand
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-keyword z-control z-groovy">if</span> (params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>root) <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        runCommand <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-string z-quoted z-double z-block z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"""</span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                            curl -sS https://raw.githubusercontent.com/Lifailon/hwstat/rsa/hwstat.sh | sudo bash -s -- "json" > "hwstat-report.json"
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                        <span class="z-punctuation z-definition z-string z-end z-groovy">"""</span></span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span> <span class="z-keyword z-control z-groovy">else</span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        runCommand <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-string z-quoted z-double z-block z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"""</span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                            curl -sS https://raw.githubusercontent.com/Lifailon/hwstat/rsa/hwstat.sh | bash -s -- "json" > "hwstat-report.json"
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                        <span class="z-punctuation z-definition z-string z-end z-groovy">"""</span></span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-storage z-type z-def z-groovy">def</span> jsonOutput <span class="z-keyword z-operator z-assignment z-groovy">=</span> sshCommand <span class="z-constant z-other z-key z-groovy">remote</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> remote, <span class="z-constant z-other z-key z-groovy">command</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> runCommand
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-keyword z-control z-groovy">if</span> (params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>report) <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Записать содержимое переменной в файл
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> writeFile file: 'hwstat-report.json', text: jsonOutput
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Загрузить файл из удаленной машины
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        sshGet <span class="z-constant z-other z-key z-groovy">remote</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> remote, <span class="z-constant z-other z-key z-groovy">from</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>hwstat-report.json<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>, <span class="z-constant z-other z-key z-groovy">into</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span><span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-storage z-type z-class z-groovy">env.WORKSPACE</span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span>/hwstat-report.json<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>, <span class="z-constant z-other z-key z-groovy">override</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-constant z-language z-groovy">true</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    sshCommand <span class="z-constant z-other z-key z-groovy">remote</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> remote, <span class="z-constant z-other z-key z-groovy">command</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>rm hwstat-report.json<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">stage</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Загрузка json отчета в Jenkins<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Проверка условия перед выполнением шага (пропуск если false)
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            when <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                expression <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span> params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>report <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            steps <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                archiveArtifacts <span class="z-constant z-other z-key z-groovy">artifacts</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>hwstat-report.json<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span>, <span class="z-constant z-other z-key z-groovy">allowEmptyArchive</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-constant z-language z-groovy">true</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    post <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Выполнять независимо от успеха или ошибки
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        always <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            script <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                sh <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>rm -f <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-storage z-type z-class z-groovy">env.SSH_KEY_FILE</span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        success   <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span> echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Сборка завершена успешно<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span> <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        failure   <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span> echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Сборка завершилась с ошибкой<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span> <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        unstable  <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span> echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Сборка завершилась с предупреждениями<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span> <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        changed   <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span> echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Текущий статус завершения изменился по сравнению с предыдущим запуском<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span> <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        fixed     <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span> echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Сборка завершена успешно по сравнению с предыдущим запуском<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span> <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        aborted   <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span> echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Запуск был прерван<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span> <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></code></pre><h2 id=update-ssh-authorized-keys><a aria-label="Anchor link for: update-ssh-authorized-keys" class=zola-anchor href=#update-ssh-authorized-keys><i class=icon></i></a> Update SSH authorized_keys</h2><p>Добавляем логин и пароль для авторизации по ssh: <code>Manage (Settings)</code> => <code>Credentials</code> => <code>Global</code> => <code>Add credentials</code> => Kind: <code>Username with password</code><p>Сценарий обновляет параметр со списком текущих пользователей на машине и добавляет или заменяет ssh ключ для выбранного пользователя:<pre class="language-Groovy z-code" data-lang=Groovy><code class=language-Groovy data-lang=Groovy><span class="z-source z-groovy"><span class="z-storage z-type z-def z-groovy">def</span> remote <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span>:<span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span>
</span><span class="z-source z-groovy">
</span><span class="z-source z-groovy">pipeline <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    agent any
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    parameters <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">string</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>address<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">defaultValue</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>192.168.3.101<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">description</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Адрес удаленного сервера<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">string</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>port<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">defaultValue</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>22<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">description</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Порт ssh<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">string</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>credentials<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">defaultValue</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>15d05be6-682a-472b-9c1d-cf5080e98170<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">description</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Идентификатор учетных данных из Jenkins<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">booleanParam</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>getUsers<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">defaultValue</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-constant z-language z-groovy">true</span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">description</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Получить список текущих пользователей системы<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">string</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>sshKey<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">defaultValue</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span><span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">description</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Открытый ssh ключ для добавления в authorized_keys<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">booleanParam</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>rewriteKey<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">defaultValue</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-constant z-language z-groovy">false</span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">description</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Перезаписать текущие ключи в файле authorized_keys<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    stages <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">stage</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Извлекаем параметры для авторизации по ssh<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            steps <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                script <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">withCredentials</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">usernamePassword</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">credentialsId</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>credentials<span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">usernameVariable</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>SSH_USER<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">passwordVariable</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>SSH_PASS<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        remote<span class="z-punctuation z-accessor z-dot z-groovy">.</span>name <span class="z-keyword z-operator z-assignment z-groovy">=</span> params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>address
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        remote<span class="z-punctuation z-accessor z-dot z-groovy">.</span>host <span class="z-keyword z-operator z-assignment z-groovy">=</span> params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>address
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        remote<span class="z-punctuation z-accessor z-dot z-groovy">.</span>port <span class="z-keyword z-operator z-assignment z-groovy">=</span> params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>port<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">toInteger</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        remote<span class="z-punctuation z-accessor z-dot z-groovy">.</span>user <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-storage z-type z-class z-groovy">env.SSH_USER</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        remote<span class="z-punctuation z-accessor z-dot z-groovy">.</span>password <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-storage z-type z-class z-groovy">env.SSH_PASS</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        remote<span class="z-punctuation z-accessor z-dot z-groovy">.</span>allowAnyHosts <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-constant z-language z-groovy">true</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">stage</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Обновить список пользователей<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            when <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                expression <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span> params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>getUsers <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            steps <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                script <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-storage z-type z-def z-groovy">def</span> mainCommand <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>echo <span class="z-constant z-character z-escape z-groovy">\$</span>(ls /home)<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-storage z-type z-def z-groovy">def</span> users <span class="z-keyword z-operator z-assignment z-groovy">=</span> sshCommand <span class="z-constant z-other z-key z-groovy">remote</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> remote, <span class="z-constant z-other z-key z-groovy">command</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> mainCommand
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-storage z-type z-def z-groovy">def</span> usersList <span class="z-keyword z-operator z-assignment z-groovy">=</span> users<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">trim</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">split</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span><span class="z-constant z-character z-escape z-groovy">\\</span>s<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    usersList <span class="z-keyword z-operator z-arithmetic z-groovy">+</span><span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>root<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-storage z-type z-def z-groovy">def</span> usersListChoice <span class="z-keyword z-operator z-assignment z-groovy">=</span> usersList<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">toList</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    writeFile <span class="z-constant z-other z-key z-groovy">file</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>user_list.txt<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span>, <span class="z-constant z-other z-key z-groovy">text</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> usersList<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">join</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span><span class="z-constant z-character z-escape z-groovy">\\</span>s<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">properties</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy">                        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">parameters</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span>
</span></span></span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy">                            <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">string</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>address<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">defaultValue</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>address<span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">description</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Адрес удаленного сервера<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span><span class="z-punctuation z-definition z-separator z-groovy">,</span>
</span></span></span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy">                            <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">string</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>port<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">defaultValue</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>port<span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">description</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Порт ssh<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span><span class="z-punctuation z-definition z-separator z-groovy">,</span>
</span></span></span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy">                            <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">string</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>credentials<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">defaultValue</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>credentials<span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">description</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Идентификатор учетных данных из Jenkins<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span><span class="z-punctuation z-definition z-separator z-groovy">,</span>
</span></span></span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy">                            <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">booleanParam</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>getUsers<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">defaultValue</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>getUsers<span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">description</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Получить список текущих пользователей системы<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span><span class="z-punctuation z-definition z-separator z-groovy">,</span>
</span></span></span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy">                            <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">string</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>sshKey<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">defaultValue</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span><span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">description</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Открытый ssh ключ для добавления в authorized_keys<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span><span class="z-punctuation z-definition z-separator z-groovy">,</span>
</span></span></span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy">                            <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">booleanParam</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>rewriteKey<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">defaultValue</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-constant z-language z-groovy">false</span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">description</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Перезаписать текущие ключи в файле authorized_keys<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span><span class="z-punctuation z-definition z-separator z-groovy">,</span>
</span></span></span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy">                            <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">choice</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span>
</span></span></span></span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-method-call z-groovy">                                <span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>userList<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span>
</span></span></span></span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-method-call z-groovy">                                <span class="z-constant z-other z-key z-groovy">choices</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> usersListChoice<span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span>
</span></span></span></span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-method-call z-groovy">                                <span class="z-constant z-other z-key z-groovy">description</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Выбрать пользователя<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span>
</span></span></span></span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-method-call z-groovy">                            <span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy">                        <span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy">                    <span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">stage</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Добавить новый SSH ключ<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            when <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                expression <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span> <span class="z-keyword z-operator z-logical z-groovy">!</span>params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>getUsers <span class="z-keyword z-operator z-logical z-groovy">&&</span> params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>sshKey <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            steps <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                script <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-storage z-type z-def z-groovy">def</span> selectedUser <span class="z-keyword z-operator z-assignment z-groovy">=</span> params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>userList
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-storage z-type z-def z-groovy">def</span> sshKey <span class="z-keyword z-operator z-assignment z-groovy">=</span> params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>sshKey
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-keyword z-control z-groovy">if</span> (selectedUser <span class="z-keyword z-operator z-comparison z-groovy">==</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>root<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>) <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        path <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>/root/.ssh/authorized_keys<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span> <span class="z-keyword z-control z-groovy">else</span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        path<span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>/home/<span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>selectedUser<span class="z-punctuation z-section z-embedded z-groovy">}</span></span>/.ssh/authorized_keys<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-keyword z-control z-groovy">if</span> (params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>rewriteKey) <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Обновляем все SSH ключи для пользователя: <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>selectedUser<span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        teeCommand <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>tee<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span> <span class="z-keyword z-control z-groovy">else</span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Добавляем новый SSH ключ для пользователя: <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>selectedUser<span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        teeCommand <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>tee -a<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-storage z-type z-def z-groovy">def</span> mainCommand <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-string z-quoted z-double z-block z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"""</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                        checkFile=<span class="z-constant z-character z-escape z-groovy">\$</span>(ls <span class="z-variable z-other z-interpolated z-groovy">$path</span> 2> /dev/null || echo false)
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                        if [ <span class="z-constant z-character z-escape z-groovy">\$</span>checkFile == "false" ]; then
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                            mkdir -p <span class="z-constant z-character z-escape z-groovy">\$</span>(dirname <span class="z-variable z-other z-interpolated z-groovy">$path</span>) && touch <span class="z-variable z-other z-interpolated z-groovy">$path</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                        fi
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                        echo <span class="z-variable z-other z-interpolated z-groovy">$sshKey</span> | <span class="z-variable z-other z-interpolated z-groovy">$teeCommand</span> <span class="z-variable z-other z-interpolated z-groovy">$path</span> > /dev/null
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                    <span class="z-punctuation z-definition z-string z-end z-groovy">"""</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    sshCommand <span class="z-constant z-other z-key z-groovy">remote</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> remote, <span class="z-constant z-other z-key z-groovy">command</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> mainCommand
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></code></pre><h2 id=upload-file-parameter><a aria-label="Anchor link for: upload-file-parameter" class=zola-anchor href=#upload-file-parameter><i class=icon></i></a> Upload File Parameter</h2><p>Передача файла через параметр и чтение его содержимого:<pre class="language-Groovy z-code" data-lang=Groovy><code class=language-Groovy data-lang=Groovy><span class="z-source z-groovy">pipeline <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    agent any
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    parameters <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        base64File <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>UPLOAD_FILE<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    stages <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">stage</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Читаем содержимое файла<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            steps <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Переменная хранит содержимое файла в формате base64
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> echo UPLOAD_FILE
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Декодируем base64
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">withFileParameter</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>UPLOAD_FILE<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    sh <span class="z-string z-quoted z-double z-block z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"""</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                        echo "<span class="z-variable z-other z-interpolated z-groovy">$UPLOAD_FILE</span>" # выводим путь к временному файлу с содержимым переданного файла
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                        cat "<span class="z-variable z-other z-interpolated z-groovy">$UPLOAD_FILE</span>"  # читаем содержимое файла
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                    <span class="z-punctuation z-definition z-string z-end z-groovy">"""</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></code></pre><h2 id=input-text-and-file><a aria-label="Anchor link for: input-text-and-file" class=zola-anchor href=#input-text-and-file><i class=icon></i></a> Input Text and File</h2><p>Останавливает выполнение <code>Pipeline</code> и заставляет пользователя передать текстовый параметр и файл:<pre class="language-Groovy z-code" data-lang=Groovy><code class=language-Groovy data-lang=Groovy><span class="z-source z-groovy">pipeline <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    agent any
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    stages <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">stage</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Input text<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            input <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                message <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Что бы продолжить, передайте текст в поле ввода<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                ok <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Передать<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                parameters <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">string</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>TEXT<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">defaultValue</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>test<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">description</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Введите текст<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            steps <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Переданный текст в параметре input: <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-constant z-other z-groovy">TEXT</span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">stage</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Input file<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            steps <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                script <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-storage z-type z-def z-groovy">def</span> fileBase64 <span class="z-keyword z-operator z-assignment z-groovy">=</span> input <span class="z-constant z-other z-key z-groovy">message</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Передайте файл<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>, <span class="z-constant z-other z-key z-groovy">parameters</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">base64File</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>file<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    sh <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>echo <span class="z-variable z-other z-interpolated z-groovy">$fileBase64</span> | base64 -d<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></code></pre><h2 id=httpurlconnection><a aria-label="Anchor link for: httpurlconnection" class=zola-anchor href=#httpurlconnection><i class=icon></i></a> HttpURLConnection</h2><p>Любой код Groovy возможно запустить и проверить через <code>Script Console</code> (http://127.0.0.1:8080/manage/script)<p>Пример <code>API</code> запроса к репозиторию PowerShell на GitHub для получения последней версии и всех доступных версий:<pre class="language-Groovy z-code" data-lang=Groovy><code class=language-Groovy data-lang=Groovy><span class="z-source z-groovy"><span class="z-meta z-import z-groovy"><span class="z-keyword z-other z-import z-groovy">import</span> <span class="z-storage z-type z-import z-groovy">groovy.json.JsonSlurper
</span></span></span><span class="z-source z-groovy"><span class="z-storage z-type z-def z-groovy">def</span> url <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-constant z-other z-groovy">URL</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>https://api.github.com/repos/PowerShell/PowerShell/tags<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>)
</span><span class="z-source z-groovy"><span class="z-storage z-type z-def z-groovy">def</span> connection <span class="z-keyword z-operator z-assignment z-groovy">=</span> url<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">openConnection</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span><span class="z-source z-groovy">connection<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">setRequestMethod</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>GET<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span><span class="z-source z-groovy">connection<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">setRequestProperty</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Accept<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>application/json<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span><span class="z-source z-groovy"><span class="z-storage z-type z-def z-groovy">def</span> responseCode <span class="z-keyword z-operator z-assignment z-groovy">=</span> connection<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">getResponseCode</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span><span class="z-source z-groovy"><span class="z-keyword z-control z-groovy">if</span> (responseCode <span class="z-keyword z-operator z-comparison z-groovy">==</span> <span class="z-constant z-numeric z-groovy">200</span>) <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Получаем данные ответа
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-storage z-type z-def z-groovy">def</span> response <span class="z-keyword z-operator z-assignment z-groovy">=</span> connection<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">getInputStream</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">getText</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Парсим JSON ответ
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-storage z-type z-def z-groovy">def</span> jsonSlurper <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">JsonSlurper</span>()
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-storage z-type z-def z-groovy">def</span> tags <span class="z-keyword z-operator z-assignment z-groovy">=</span> jsonSlurper<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">parseText</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span>response<span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Проверяем количество элементов в массиве
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-keyword z-control z-groovy">if</span> (tags<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">size</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-keyword z-operator z-comparison z-groovy">></span> <span class="z-constant z-numeric z-groovy">0</span>) <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Забираем последний тег из списка
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-storage z-type z-def z-groovy">def</span> latestTag <span class="z-keyword z-operator z-assignment z-groovy">=</span> tags<span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-constant z-numeric z-groovy">0</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span>name
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-support z-function z-print z-groovy">println</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Latest version: <span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span> <span class="z-keyword z-operator z-arithmetic z-groovy">+</span> latestTag)
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-support z-function z-print z-groovy">println</span>()
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Проходимся по всем тегам
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-support z-function z-print z-groovy">println</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>List of all versions:<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>)
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-keyword z-control z-groovy">for</span> (tag in tags) <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-support z-function z-print z-groovy">println</span>(tag<span class="z-punctuation z-accessor z-dot z-groovy">.</span>name)
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span> <span class="z-keyword z-control z-groovy">else</span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">error</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>No tags found in the response<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-end z-groovy">}</span></span> <span class="z-keyword z-control z-groovy">else</span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">error</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Failed to call API, response code: <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>responseCode<span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span><span class="z-source z-groovy">connection<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">disconnect</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></code></pre><h2 id=active-choices-parameter><a aria-label="Anchor link for: active-choices-parameter" class=zola-anchor href=#active-choices-parameter><i class=icon></i></a> Active Choices Parameter</h2><p>Пример выбора репозитория, получения списка доступных версий и содержимого файлов выбранного релиза.<ul><li><ol><li>Active Choices Parameter</ol></ul><p>Name: <code>Repos</code><p>Groovy Script:<pre class="language-Groovy z-code" data-lang=Groovy><code class=language-Groovy data-lang=Groovy><span class="z-source z-groovy"><span class="z-keyword z-control z-groovy">return</span> <span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-structure z-groovy">    <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Lifailon/lazyjournal<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-groovy">,</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-structure z-groovy">    <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>jesseduffield/lazydocker<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span>
</span></code></pre><ul><li><ol start=2><li>Active Choices Reactive Parameter</ol></ul><p>Name: <code>Versions</code><p>Groovy Script:<pre class="language-Groovy z-code" data-lang=Groovy><code class=language-Groovy data-lang=Groovy><span class="z-source z-groovy"><span class="z-meta z-import z-groovy"><span class="z-keyword z-other z-import z-groovy">import</span> <span class="z-storage z-type z-import z-groovy">groovy.json.JsonSlurper
</span></span></span><span class="z-source z-groovy"><span class="z-storage z-type z-def z-groovy">def</span> selectedRepo <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-storage z-type z-class z-groovy">Repos</span>
</span><span class="z-source z-groovy"><span class="z-storage z-type z-def z-groovy">def</span> apiUrl <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>https://api.github.com/repos/<span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>selectedRepo<span class="z-punctuation z-section z-embedded z-groovy">}</span></span>/tags<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span><span class="z-source z-groovy"><span class="z-storage z-type z-def z-groovy">def</span> conn <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-constant z-other z-groovy">URL</span>(apiUrl)<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">openConnection</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span><span class="z-source z-groovy">conn<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">setRequestProperty</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>User-Agent<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Jenkins<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span><span class="z-source z-groovy"><span class="z-storage z-type z-def z-groovy">def</span> response <span class="z-keyword z-operator z-assignment z-groovy">=</span> conn<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">getInputStream</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">getText</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span><span class="z-source z-groovy"><span class="z-storage z-type z-def z-groovy">def</span> json <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">JsonSlurper</span>()<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">parseText</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span>response<span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span><span class="z-source z-groovy"><span class="z-storage z-type z-def z-groovy">def</span> versionsCount <span class="z-keyword z-operator z-assignment z-groovy">=</span> json<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">size</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span><span class="z-source z-groovy"><span class="z-storage z-type z-def z-groovy">def</span> data <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span>
</span><span class="z-source z-groovy"><span class="z-keyword z-control z-groovy">for</span> (<span class="z-storage z-type z-primitive z-groovy">int</span> i <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-constant z-numeric z-groovy">0</span>; i <span class="z-keyword z-operator z-comparison z-groovy"><</span> versionsCount; i<span class="z-keyword z-operator z-increment-decrement z-groovy">++</span>) <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    data <span class="z-keyword z-operator z-arithmetic z-groovy">+</span><span class="z-keyword z-operator z-assignment z-groovy">=</span> json<span class="z-punctuation z-accessor z-dot z-groovy">.</span>name<span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span>i<span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span><span class="z-source z-groovy"><span class="z-keyword z-control z-groovy">return</span> data
</span></code></pre><p>Настройки параметров: Choice Type: <code>Single Select</code> Привязать параметр <code>Repos</code> из <code>Active Choices</code> в <code>Reactive Parameter</code> через <code>Referenced parameters</code> Включить фильтрацию через <code>Enable filters</code><ul><li><ol start=3><li>Active Choices Reactive Parameter</ol></ul><p>Name: <code>Files</code><p>Groovy Script:<pre class="language-Groovy z-code" data-lang=Groovy><code class=language-Groovy data-lang=Groovy><span class="z-source z-groovy"><span class="z-meta z-import z-groovy"><span class="z-keyword z-other z-import z-groovy">import</span> <span class="z-storage z-type z-import z-groovy">groovy.json.JsonSlurper
</span></span></span><span class="z-source z-groovy"><span class="z-storage z-type z-def z-groovy">def</span> selectedRepo <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-storage z-type z-class z-groovy">Repos</span>
</span><span class="z-source z-groovy"><span class="z-storage z-type z-def z-groovy">def</span> selectedVer <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-storage z-type z-class z-groovy">Versions</span>
</span><span class="z-source z-groovy"><span class="z-storage z-type z-def z-groovy">def</span> apiUrl <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>https://api.github.com/repos/<span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>selectedRepo<span class="z-punctuation z-section z-embedded z-groovy">}</span></span>/releases/tags/<span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>selectedVer<span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span><span class="z-source z-groovy"><span class="z-storage z-type z-def z-groovy">def</span> conn <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-constant z-other z-groovy">URL</span>(apiUrl)<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">openConnection</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span><span class="z-source z-groovy">conn<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">setRequestProperty</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>User-Agent<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Jenkins<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span><span class="z-source z-groovy"><span class="z-storage z-type z-def z-groovy">def</span> response <span class="z-keyword z-operator z-assignment z-groovy">=</span> conn<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">getInputStream</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">getText</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span><span class="z-source z-groovy"><span class="z-storage z-type z-def z-groovy">def</span> json <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">JsonSlurper</span>()<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">parseText</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span>response<span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span><span class="z-source z-groovy"><span class="z-storage z-type z-def z-groovy">def</span> data <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span>
</span><span class="z-source z-groovy"><span class="z-keyword z-control z-groovy">for</span> (file in json<span class="z-punctuation z-accessor z-dot z-groovy">.</span>assets) <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    data <span class="z-keyword z-operator z-arithmetic z-groovy">+</span><span class="z-keyword z-operator z-assignment z-groovy">=</span> file<span class="z-punctuation z-accessor z-dot z-groovy">.</span>name
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span><span class="z-source z-groovy"><span class="z-keyword z-control z-groovy">return</span> data
</span></code></pre><p>Referenced parameters: <code>Repos,Versions</code><p>Pipeline script:<pre class="language-Groovy z-code" data-lang=Groovy><code class=language-Groovy data-lang=Groovy><span class="z-source z-groovy">pipeline <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    agent any
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    stages <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">stage</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Selected parameters<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            steps <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                script <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Selected repository: https://github.com/<span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-storage z-type z-class z-groovy">params.Repos</span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Selected version: <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-storage z-type z-class z-groovy">params.Versions</span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Selected file: <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-storage z-type z-class z-groovy">params.Files</span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Url for download: https://github.com/<span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-storage z-type z-class z-groovy">params.Repos</span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span>/releases/download/<span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-storage z-type z-class z-groovy">params.Versions</span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span>/<span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-storage z-type z-class z-groovy">params.Files</span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></code></pre><h2 id=vault><a aria-label="Anchor link for: vault" class=zola-anchor href=#vault><i class=icon></i></a> Vault</h2><p>Интеграция <a href=https://github.com/hashicorp/vault>HashiCorp Vault</a> в Jenkins Pipeline через <code>REST API</code> для получения содержимого секретов и использовая в последующих стадиях/этапах сборки:<pre class="language-Groovy z-code" data-lang=Groovy><code class=language-Groovy data-lang=Groovy><span class="z-source z-groovy"><span class="z-meta z-definition z-method z-groovy"><span class="z-storage z-type z-return-type z-def z-groovy">def</span> <span class="z-entity z-name z-function z-groovy">getVaultSecrets</span><span class="z-punctuation z-definition z-parameters z-begin z-groovy">(</span><span class="z-meta z-definition z-method z-parameters z-groovy">
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-definition z-method z-groovy"><span class="z-meta z-definition z-method z-parameters z-groovy"><span class="z-meta z-definition z-method z-parameter z-groovy">    <span class="z-storage z-type z-parameter z-groovy">String</span> <span class="z-variable z-parameter z-groovy">address</span></span><span class="z-punctuation z-definition z-parameters z-separator z-groovy">,</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-definition z-method z-groovy"><span class="z-meta z-definition z-method z-parameters z-groovy"><span class="z-meta z-definition z-method z-parameter z-groovy">    <span class="z-storage z-type z-parameter z-groovy">String</span> <span class="z-variable z-parameter z-groovy">path</span></span><span class="z-punctuation z-definition z-parameters z-separator z-groovy">,</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-definition z-method z-groovy"><span class="z-meta z-definition z-method z-parameters z-groovy"><span class="z-meta z-definition z-method z-parameter z-groovy">    <span class="z-storage z-type z-parameter z-groovy">String</span> <span class="z-variable z-parameter z-groovy">token</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-definition z-method z-groovy"><span class="z-meta z-definition z-method z-parameters z-groovy"></span><span class="z-punctuation z-definition z-parameters z-end z-groovy">)</span> {</span>
</span><span class="z-source z-groovy">    <span class="z-storage z-type z-def z-groovy">def</span> url <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-constant z-other z-groovy">URL</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span><span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>address<span class="z-punctuation z-section z-embedded z-groovy">}</span></span>/<span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>path<span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>)
</span><span class="z-source z-groovy">    
</span><span class="z-source z-groovy">    <span class="z-storage z-type z-def z-groovy">def</span> connection <span class="z-keyword z-operator z-assignment z-groovy">=</span> url<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">openConnection</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span><span class="z-source z-groovy">    connection<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">setRequestMethod</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>GET<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span><span class="z-source z-groovy">    connection<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">setRequestProperty</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>X-Vault-Token<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> token<span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span><span class="z-source z-groovy">    connection<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">setRequestProperty</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Accept<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>application/json<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span><span class="z-source z-groovy">    
</span><span class="z-source z-groovy">    <span class="z-storage z-type z-def z-groovy">def</span> response <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">groovy.json.JsonSlurper</span>()<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">parse</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span>connection<span class="z-punctuation z-accessor z-dot z-groovy">.</span>inputStream<span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span><span class="z-source z-groovy">    <span class="z-storage z-type z-def z-groovy">def</span> user <span class="z-keyword z-operator z-assignment z-groovy">=</span> response<span class="z-punctuation z-accessor z-dot z-groovy">.</span>data<span class="z-punctuation z-accessor z-dot z-groovy">.</span>data<span class="z-punctuation z-accessor z-dot z-groovy">.</span>user
</span><span class="z-source z-groovy">    <span class="z-storage z-type z-def z-groovy">def</span> password <span class="z-keyword z-operator z-assignment z-groovy">=</span> response<span class="z-punctuation z-accessor z-dot z-groovy">.</span>data<span class="z-punctuation z-accessor z-dot z-groovy">.</span>data<span class="z-punctuation z-accessor z-dot z-groovy">.</span>password
</span><span class="z-source z-groovy">    <span class="z-keyword z-control z-groovy">return</span> <span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-structure z-groovy">        <span class="z-constant z-other z-key z-groovy">user</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> user<span class="z-punctuation z-definition z-separator z-groovy">,</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-structure z-groovy">        <span class="z-constant z-other z-key z-groovy">password</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> password
</span></span><span class="z-source z-groovy"><span class="z-meta z-structure z-groovy">    <span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span>
</span><span class="z-source z-groovy">}
</span><span class="z-source z-groovy">
</span><span class="z-source z-groovy"><span class="z-storage z-type z-def z-groovy">def</span> <span class="z-constant z-other z-groovy">USER_NAME</span>
</span><span class="z-source z-groovy"><span class="z-storage z-type z-def z-groovy">def</span> <span class="z-constant z-other z-groovy">USER_PASS</span>
</span><span class="z-source z-groovy">
</span><span class="z-source z-groovy">pipeline <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    agent any
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    parameters <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">string</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>url<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">defaultValue</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>http://192.168.3.101:8200<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">description</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Url адресс хранилища секретов<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">string</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>path<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">defaultValue</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>v1/kv/data/ssh-auth<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">description</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Путь для извлечения секретов<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">password</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>token<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">defaultValue</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>hvs.bySybhyYOxSWEVk4FQDdcyyg<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">description</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Токен доступа к API HashiCorp Vault<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    stages <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">stage</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Get vault secrets<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            steps <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                script <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-storage z-type z-def z-groovy">def</span> secrets <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">getVaultSecrets</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy">                        <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span><span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>url<span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy">                        <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span><span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>path<span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy">                        <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span><span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>token<span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy">                    <span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-constant z-other z-groovy">USER_NAME</span> <span class="z-keyword z-operator z-assignment z-groovy">=</span> secrets<span class="z-punctuation z-accessor z-dot z-groovy">.</span>user
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-constant z-other z-groovy">USER_PASS</span> <span class="z-keyword z-operator z-assignment z-groovy">=</span> secrets<span class="z-punctuation z-accessor z-dot z-groovy">.</span>password
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">stage</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Use secrets<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            steps <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                script <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>User: <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-constant z-other z-groovy">USER_NAME</span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Password: <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-constant z-other z-groovy">USER_PASS</span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></code></pre><h2 id=email-extension><a aria-label="Anchor link for: email-extension" class=zola-anchor href=#email-extension><i class=icon></i></a> Email Extension</h2><p>Для отправки на почту и настроить SMTP сервер в настройках Jenkins (<code>System</code> => <code>Extended E-mail Notification</code>)<p>SMTP server: <code>smtp.yandex.ru</code> SMTP port: <code>587</code> Credentials: <code>Username with password</code> (<code>username@yandex.ru</code> и <code>app-password</code>) <code>Use TLS</code> Default Content Type: <code>HTML (text/html)</code><p>Настройка логирования в System Log: <code>emailDebug</code> + фильтр <code>hudson.plugins.emailext</code> и уровень <code>ALL</code><pre class="language-Groovy z-code" data-lang=Groovy><code class=language-Groovy data-lang=Groovy><span class="z-source z-groovy">pipeline <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    agent any
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    parameters <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">string</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>emailTo<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">defaultValue</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>test@yandex.ru<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">description</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Почтовый адрес назначения<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    stages <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">stage</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Вывод всех переменных окружения<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            steps <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                script <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    env<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">getEnvironment</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span>each <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span> key, value <span class="z-keyword z-operator z-arrow z-groovy">-></span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span><span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>key<span class="z-punctuation z-section z-embedded z-groovy">}</span></span> = <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>value<span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">stage</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Отправка на почту<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            options <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">timeout</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">time</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-constant z-numeric z-groovy">1</span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">unit</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>MINUTES<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            steps <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                script <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    emailext (
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        <span class="z-constant z-other z-key z-groovy">to</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span>	<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span><span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>emailTo<span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>,
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        <span class="z-constant z-other z-key z-groovy">subject</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span><span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-storage z-type z-class z-groovy">env.JOB_NAME</span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span> - <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-constant z-other z-groovy">BUILD_NUMBER</span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>,
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        <span class="z-constant z-other z-key z-groovy">mimeType</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>text/html<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>,
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        <span class="z-constant z-other z-key z-groovy">body</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-double z-block z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"""</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                            &LThtml>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                                &LTbody>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                                    &LTdiv style="padding-left: 30px; padding-bottom: 15px;" color="blue">
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                                    &LTfont name="Arial" color="#906090" size="3" font-weight="normal">
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                                        &LTb> <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-storage z-type z-class z-groovy">env.JOB_NAME</span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span> - <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-storage z-type z-class z-groovy">env.BUILD_NUMBER</span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span> &LT/b>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                                    &LT/font>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                                    &LTbr>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                                    &LTdiv style="padding-left: 30px; padding-bottom: 15px;" color="black">
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                                    &LTbr>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                                    &LTfont name="Arial" color="black" size="2" font-weight="normal"> 
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                                        &LTpre> Build url: <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-storage z-type z-class z-groovy">env.BUILD_URL</span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span> &LT/pre>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                                    &LT/font>	
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                                &LT/body>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                            &LT/html>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                        <span class="z-punctuation z-definition z-string z-end z-groovy">"""</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    )
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></code></pre><h2 id=parallel><a aria-label="Anchor link for: parallel" class=zola-anchor href=#parallel><i class=icon></i></a> Parallel</h2><pre class="language-Groovy z-code" data-lang=Groovy><code class=language-Groovy data-lang=Groovy><span class="z-source z-groovy">pipeline <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    agent any
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    stages <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">stage</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Parallel sleeps<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            parallel <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">stage</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Task 1<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    steps <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        script <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                            <span class="z-storage z-type z-def z-groovy">def</span> currentTime <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">Date</span>()<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">format</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>yyyy-MM-dd HH:mm:ss<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                            echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>[<span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>currentTime<span class="z-punctuation z-section z-embedded z-groovy">}</span></span>] Начало задачи 1<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                            sh <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>sleep 10<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                            currentTime <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">Date</span>()<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">format</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>yyyy-MM-dd HH:mm:ss<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                            echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>[<span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>currentTime<span class="z-punctuation z-section z-embedded z-groovy">}</span></span>] Завершение задачи 1<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">stage</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Task 2<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    steps <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        script <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                            <span class="z-storage z-type z-def z-groovy">def</span> currentTime <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">Date</span>()<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">format</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>yyyy-MM-dd HH:mm:ss<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                            echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>[<span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>currentTime<span class="z-punctuation z-section z-embedded z-groovy">}</span></span>] Начало задачи 2<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                            sh <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>sleep 5<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                            currentTime <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">Date</span>()<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">format</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>yyyy-MM-dd HH:mm:ss<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                            echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>[<span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>currentTime<span class="z-punctuation z-section z-embedded z-groovy">}</span></span>] Завершение задачи 2<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">stage</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Parallel tasks via loop<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            steps <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                script <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Массив, где ключи содержит имя задачи, а значение содержит блоки кода для выполнения
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-storage z-type z-def z-groovy">def</span> tasks <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span>:<span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-storage z-type z-def z-groovy">def</span> taskNames <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Task 1<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Task 2<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Task 3<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    taskNames<span class="z-punctuation z-accessor z-dot z-groovy">.</span>each <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span> taskName <span class="z-keyword z-operator z-arrow z-groovy">-></span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        tasks<span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span>taskName<span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span> <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                            <span class="z-storage z-type z-def z-groovy">def</span> currentTime <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">Date</span>()<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">format</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>yyyy-MM-dd HH:mm:ss<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                            echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>[<span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>currentTime<span class="z-punctuation z-section z-embedded z-groovy">}</span></span>] Начало задачи: <span class="z-variable z-other z-interpolated z-groovy">$taskName</span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                            sh <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>sleep <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>taskName <span class="z-keyword z-operator z-comparison z-groovy">==</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Task 1<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span> <span class="z-meta z-evaluation z-ternary z-groovy"><span class="z-keyword z-operator z-ternary z-groovy">?</span> <span class="z-constant z-numeric z-groovy">10</span> <span class="z-keyword z-operator z-ternary z-expression-separator z-groovy">:</span> taskName <span class="z-keyword z-operator z-comparison z-groovy">==</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Task 2<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span> <span class="z-meta z-evaluation z-ternary z-groovy"><span class="z-keyword z-operator z-ternary z-groovy">?</span> <span class="z-constant z-numeric z-groovy">5</span> <span class="z-keyword z-operator z-ternary z-expression-separator z-groovy">:</span> <span class="z-constant z-numeric z-groovy">3</span></span></span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                            currentTime <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">Date</span>()<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">format</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>yyyy-MM-dd HH:mm:ss<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                            echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>[<span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>currentTime<span class="z-punctuation z-section z-embedded z-groovy">}</span></span>] Завершение задачи: <span class="z-variable z-other z-interpolated z-groovy">$taskName</span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    parallel tasks
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></code></pre><h2 id=groovy><a aria-label="Anchor link for: groovy" class=zola-anchor href=#groovy><i class=icon></i></a> Groovy</h2><p>Базовый синтаксис языка <code>Groovy</code><pre class="language-Groovy z-code" data-lang=Groovy><code class=language-Groovy data-lang=Groovy><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Переменные
</span></span><span class="z-source z-groovy">javaString <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>java<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span>
</span><span class="z-source z-groovy">javaString
</span><span class="z-source z-groovy"><span class="z-support z-function z-print z-groovy">println</span> javaString
</span><span class="z-source z-groovy">javaString<span class="z-punctuation z-accessor z-dot z-groovy">.</span>class    <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> class java.lang.String
</span></span><span class="z-source z-groovy"><span class="z-support z-function z-print z-groovy">println</span> <span class="z-constant z-numeric z-groovy">100.</span>class   <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> class java.lang.Integer
</span></span><span class="z-source z-groovy">j <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>${javaString}<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span> <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> не принимает переменные в одинарных кавычках
</span></span><span class="z-source z-groovy">groovyString <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span><span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>javaString<span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span><span class="z-source z-groovy">bigGroovyString <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-string z-quoted z-double z-block z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"""</span>
</span></span><span class="z-source z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">    <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>javaString<span class="z-punctuation z-section z-embedded z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">    <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>j<span class="z-punctuation z-section z-embedded z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">    <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>groovyString<span class="z-punctuation z-section z-embedded z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">    <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-constant z-numeric z-groovy">2</span> <span class="z-keyword z-operator z-arithmetic z-groovy">+</span> <span class="z-constant z-numeric z-groovy">2</span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-string z-quoted z-double z-block z-groovy"><span class="z-punctuation z-definition z-string z-end z-groovy">"""</span></span>
</span><span class="z-source z-groovy">
</span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> java
</span></span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> ${javaString}
</span></span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> java
</span></span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> 4
</span></span><span class="z-source z-groovy">
</span><span class="z-source z-groovy">a <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>a<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>   <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> a
</span></span><span class="z-source z-groovy">a <span class="z-keyword z-operator z-arithmetic z-groovy">+</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>123<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span> <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> a123
</span></span><span class="z-source z-groovy">a <span class="z-keyword z-operator z-arithmetic z-groovy">*</span> <span class="z-constant z-numeric z-groovy">5</span>     <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> aaaaa
</span></span><span class="z-source z-groovy">
</span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Массивы и списки
</span></span><span class="z-source z-groovy">list <span class="z-keyword z-operator z-assignment z-groovy">=</span><span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-constant z-numeric z-groovy">1</span><span class="z-punctuation z-definition z-separator z-groovy">,</span><span class="z-constant z-numeric z-groovy">2</span><span class="z-punctuation z-definition z-separator z-groovy">,</span><span class="z-constant z-numeric z-groovy">3</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span>
</span><span class="z-source z-groovy">list<span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-constant z-numeric z-groovy">0</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span>    <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> 1
</span></span><span class="z-source z-groovy">list<span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-constant z-numeric z-groovy">0</span><span class="z-keyword z-operator z-range z-groovy">..</span><span class="z-constant z-numeric z-groovy">1</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span> <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> [1, 2]
</span></span><span class="z-source z-groovy">range <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>0123456789<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span><span class="z-source z-groovy">range<span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-constant z-numeric z-groovy">1</span><span class="z-keyword z-operator z-range z-groovy">..</span><span class="z-constant z-numeric z-groovy">5</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span> <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> 12345
</span></span><span class="z-source z-groovy">map <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-constant z-other z-key z-groovy">key1</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-constant z-language z-groovy">true</span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">key2</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-constant z-language z-groovy">false</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span>
</span><span class="z-source z-groovy">map<span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>key1<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span> <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> true
</span></span><span class="z-source z-groovy">server <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span>:<span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span>
</span><span class="z-source z-groovy">server<span class="z-punctuation z-accessor z-dot z-groovy">.</span>ip <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>192.168.3.1<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span><span class="z-source z-groovy">server<span class="z-punctuation z-accessor z-dot z-groovy">.</span>port <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-constant z-numeric z-groovy">22</span>
</span><span class="z-source z-groovy"><span class="z-support z-function z-print z-groovy">println</span>(server) <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> [ip:192.168.3.1, port:22]
</span></span><span class="z-source z-groovy">
</span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Функции
</span></span><span class="z-source z-groovy"><span class="z-meta z-definition z-method z-groovy"><span class="z-storage z-type z-return-type z-def z-groovy">def</span> <span class="z-entity z-name z-function z-groovy">sum</span><span class="z-punctuation z-definition z-parameters z-begin z-groovy">(</span><span class="z-meta z-definition z-method z-parameters z-groovy"><span class="z-meta z-definition z-method z-parameter z-groovy"><span class="z-variable z-parameter z-groovy">a</span></span><span class="z-punctuation z-definition z-parameters z-separator z-groovy">,</span><span class="z-meta z-definition z-method z-parameter z-groovy"><span class="z-variable z-parameter z-groovy">b</span></span></span><span class="z-punctuation z-definition z-parameters z-end z-groovy">)</span> {</span>
</span><span class="z-source z-groovy">    <span class="z-support z-function z-print z-groovy">println</span> a<span class="z-keyword z-operator z-arithmetic z-groovy">+</span>b
</span><span class="z-source z-groovy">}
</span><span class="z-source z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">sum</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-numeric z-groovy">2</span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span><span class="z-constant z-numeric z-groovy">2</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> 4
</span></span><span class="z-source z-groovy">
</span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Условия
</span></span><span class="z-source z-groovy"><span class="z-meta z-definition z-method z-groovy"><span class="z-storage z-type z-return-type z-def z-groovy">def</span> <span class="z-entity z-name z-function z-groovy">diff</span><span class="z-punctuation z-definition z-parameters z-begin z-groovy">(</span><span class="z-meta z-definition z-method z-parameters z-groovy"><span class="z-meta z-definition z-method z-parameter z-groovy"><span class="z-variable z-parameter z-groovy">x</span></span></span><span class="z-punctuation z-definition z-parameters z-end z-groovy">)</span> {</span>
</span><span class="z-source z-groovy">    <span class="z-keyword z-control z-groovy">if</span> (x <span class="z-keyword z-operator z-comparison z-groovy"><</span> <span class="z-constant z-numeric z-groovy">10</span>) <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-support z-function z-print z-groovy">println</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span><span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>x<span class="z-punctuation z-section z-embedded z-groovy">}</span></span> < 10<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>)
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span> <span class="z-keyword z-control z-groovy">else</span> <span class="z-keyword z-control z-groovy">if</span> (x <span class="z-keyword z-operator z-comparison z-groovy">==</span> <span class="z-constant z-numeric z-groovy">10</span>) <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-support z-function z-print z-groovy">println</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span><span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>x<span class="z-punctuation z-section z-embedded z-groovy">}</span></span> = 10<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>)
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span> <span class="z-keyword z-control z-groovy">else</span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-support z-function z-print z-groovy">println</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span><span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>x<span class="z-punctuation z-section z-embedded z-groovy">}</span></span> > 10<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>)
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span><span class="z-source z-groovy">}
</span><span class="z-source z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">diff</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-numeric z-groovy">11</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> 11 > 10
</span></span><span class="z-source z-groovy">
</span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Циклы
</span></span><span class="z-source z-groovy">list<span class="z-punctuation z-accessor z-dot z-groovy">.</span>each <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span> l <span class="z-keyword z-operator z-arrow z-groovy">-></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-support z-function z-print z-groovy">print</span> l
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> 123
</span></span><span class="z-source z-groovy">
</span><span class="z-source z-groovy"><span class="z-keyword z-control z-groovy">for</span> (i in <span class="z-constant z-numeric z-groovy">0</span><span class="z-keyword z-operator z-range z-groovy">..</span><span class="z-constant z-numeric z-groovy">5</span>) <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span> 
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-support z-function z-print z-groovy">print</span> i
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> 012345
</span></span><span class="z-source z-groovy">
</span><span class="z-source z-groovy"><span class="z-keyword z-control z-groovy">for</span> (<span class="z-storage z-type z-primitive z-groovy">int</span> i <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-constant z-numeric z-groovy">0</span>; i <span class="z-keyword z-operator z-comparison z-groovy"><</span> <span class="z-constant z-numeric z-groovy">10</span>; i<span class="z-keyword z-operator z-increment-decrement z-groovy">++</span>) <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-support z-function z-print z-groovy">print</span> i
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> 0123456789
</span></span><span class="z-source z-groovy">
</span><span class="z-source z-groovy">i <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-constant z-numeric z-groovy">0</span>
</span><span class="z-source z-groovy"><span class="z-keyword z-control z-groovy">while</span> (i <span class="z-keyword z-operator z-comparison z-groovy"><</span> <span class="z-constant z-numeric z-groovy">3</span>) <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-support z-function z-print z-groovy">println</span>(i)
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    i<span class="z-keyword z-operator z-increment-decrement z-groovy">++</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> 0
</span></span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> 1
</span></span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> 2
</span></span></code></pre><h1 id=secret-manager><a aria-label="Anchor link for: secret-manager" class=zola-anchor href=#secret-manager><i class=icon></i></a> Secret Manager</h1><h2 id=bitwarden><a aria-label="Anchor link for: bitwarden" class=zola-anchor href=#bitwarden><i class=icon></i></a> Bitwarden</h2><p><code>choco install bitwarden-cli || npm install -g @bitwarden/cli || sudo snap install bw</code> установить bitwarden cli <br> <code>bw login &LTemail> --apikey</code> авторизвация в хранилище, используя client_id и client_secret <br> <code>$session = bw unlock --raw</code> получить токен сессии <br> <code>$items = bw list items --session $session | ConvertFrom-Json</code> получение всех элементов в хранилище с использованием мастер-пароля <br> <code>echo "master_password" | bw get item GitHub bw get password $items[0].name</code> получить пароль по названию секрета <br> <code>bw lock</code> завершить сессию<pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Авторизация в организации<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>client_id</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>organization.ClientId<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>client_secret</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>client_secret<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>deviceIdentifier</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">guid</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::NewGuid<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.ToString<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>deviceName</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>PowerShell-Client<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>response</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Uri <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>https://identity.bitwarden.com/connect/token<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Method POST <span class="z-keyword z-operator z-other z-powershell">`</span>
</span><span class="z-source z-powershell">    <span class="z-keyword z-operator z-assignment z-powershell">-</span>Headers <span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Content-Type<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>application/x-www-form-urlencoded<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span> <span class="z-keyword z-operator z-other z-powershell">`</span>
</span><span class="z-source z-powershell">    <span class="z-keyword z-operator z-assignment z-powershell">-</span>Body <span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">        <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">grant_type</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>client_credentials<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">        <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">scope</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>api.organization<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">        <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">client_id</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>client_id</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">        <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">client_secret</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>client_secret</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">        <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">deviceIdentifier</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>deviceIdentifier</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">        <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">deviceName</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>deviceName</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Получение токена доступа<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>accessToken</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>response<span class="z-variable z-other z-member z-powershell">.access_token</span></span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Название элемента в хранилище<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>itemName</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>GitHub<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Поиск элемента в хранилище<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>itemResponse</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Uri <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>https://api.bitwarden.com/v1/objects?search=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>itemName</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Method GET <span class="z-keyword z-operator z-other z-powershell">`</span>
</span><span class="z-source z-powershell">    <span class="z-keyword z-operator z-assignment z-powershell">-</span>Headers <span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Authorization<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Bearer <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>accessToken</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>item</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>itemResponse<span class="z-variable z-other z-member z-powershell">.data</span></span><span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-constant z-numeric z-integer z-powershell">0</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Получение информации об элементе<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>detailsResponse</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Uri <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>https://api.bitwarden.com/v1/objects/<span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-complex z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>item<span class="z-variable z-other z-member z-powershell">.id</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Method GET <span class="z-keyword z-operator z-other z-powershell">`</span>
</span><span class="z-source z-powershell">    <span class="z-keyword z-operator z-assignment z-powershell">-</span>Headers <span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Authorization<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Bearer <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>accessToken</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Получение логина и пароля<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>login</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>detailsResponse<span class="z-variable z-other z-member z-powershell">.login.username</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>password</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>detailsResponse<span class="z-variable z-other z-member z-powershell">.login.password</span></span>
</span></code></pre><h2 id=infisical><a aria-label="Anchor link for: infisical" class=zola-anchor href=#infisical><i class=icon></i></a> Infisical</h2><p><code>npm install -g @infisical/cli</code> <br> <code>infisical login</code> авторизоваться в хранилище (cloud или Self-Hosting) <br> <code>infisical init</code> инициализировать - выбрать организацию и проект <br> <code>infisical secrets</code> получить список секретов и их SECRET VALUE из добавленных групп Environments (Development, Staging, Production)<pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>clientId</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>&LTclient_id><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> создать организацию и клиент в Organization Access Control - Identities и предоставить права на Projects (Secret Management)<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>clientSecret</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>&LTclient_secret><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> на той же вкладке вкладке в Authentication сгенерировать секрет (Create Client Secret)<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>body</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">clientId</span>     <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>clientId</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">clientSecret</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>clientSecret</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>response</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Uri <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>https://app.infisical.com/api/v1/auth/universal-auth/login<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-other z-powershell">`</span>
</span><span class="z-source z-powershell">    <span class="z-keyword z-operator z-assignment z-powershell">-</span>Method POST <span class="z-keyword z-operator z-other z-powershell">`</span>
</span><span class="z-source z-powershell">    <span class="z-keyword z-operator z-assignment z-powershell">-</span>ContentType <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>application/x-www-form-urlencoded<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-other z-powershell">`</span>
</span><span class="z-source z-powershell">    <span class="z-keyword z-operator z-assignment z-powershell">-</span>Body <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>body</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>TOKEN</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>response<span class="z-variable z-other z-member z-powershell">.accessToken</span></span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> получить токен доступа<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Получить содержимое секрета<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>secretName</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>FOO<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> название секрета<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>workspaceId</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>82488c0a-6d3a-4220-9d69-19889f09c8c8<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> можно взять из url проекта Secret Management<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>environment</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>dev<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> группа<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>headers</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">Authorization</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Bearer <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>TOKEN</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>secrets</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Uri <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>https://app.infisical.com/api/v3/secrets/raw/<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-braces z-begin">{</span>secretName<span class="z-punctuation z-section z-braces z-end">}</span></span>?workspaceId=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-braces z-begin">{</span>workspaceId<span class="z-punctuation z-section z-braces z-end">}</span></span>&environment=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-braces z-begin">{</span>environment<span class="z-punctuation z-section z-braces z-end">}</span></span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Method GET <span class="z-keyword z-operator z-assignment z-powershell">-</span>Headers <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>headers</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>secrets<span class="z-variable z-other z-member z-powershell">.secret.secretKey</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>secrets<span class="z-variable z-other z-member z-powershell">.secret.secretValue</span></span>
</span></code></pre><h2 id=hashicorp-vault><a aria-label="Anchor link for: hashicorp-vault" class=zola-anchor href=#hashicorp-vault><i class=icon></i></a> HashiCorp/Vault</h2><p><code>mkdir vault && cd vault && mkdir vault_config</code><p>Создать конфигурацию:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell"># Использовать локальное файловое хранилище
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">storage "file" {
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">  path = "/vault/file"
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">}
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell"># Отключение режим dev (не будет выгружать данные в память)
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">disable_mlock = false
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell"># Настройка слушателя для REST API
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">listener "tcp" {
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">  address = "0.0.0.0:8200"
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">  tls_disable = 1  # Отключить TLS
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">}
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell"># Включение интерфейс
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">ui = true
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell"># Включение аутентификации в API по токену
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">api_addr = "http://localhost:8200"
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">auth "token" {}
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-end z-shell">'</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">></span> vault_config/vault.hcl</span>
</span></code></pre><p>Запускаем в контейнере:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> run<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>d</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>name</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>vault <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">  --</span>restart</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>unless-stopped <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">  -</span>e</span> VAULT_ADDR=http://0.0.0.0:8200 <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">  -</span>e</span> VAULT_API_ADDR=http://localhost:8200 <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">  -</span>p</span> 8200:8200 <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">  -</span>v</span> ./vault_config:/vault/config <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">  -</span>v</span> ./vault_data:/vault/file <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">  --</span>cap-add</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>IPC_LOCK <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell">  hashicorp/vault:latest <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell">  vault server<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>config</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>/vault/config/vault.hcl</span>
</span></code></pre><p>Получить ключи разблокировки и root ключ для первичной инициализации:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> exec<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>it</span> vault vault operator init</span>
</span></code></pre><p>Ввести любые 3 из 5 ключей для разблокировки после перезапуска контейнера:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> exec<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>it</span> vault vault operator unseal BPJSmuLvKAEr6wtE/8TOMRMM+x0fW3UhOxGFLn9Gmi5N</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> exec<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>it</span> vault vault operator unseal 44ntLYvSMN5FNLyddLo2IylRsLk7lqYXZOShvhV/2gbG</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> exec<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>it</span> vault vault operator unseal xP9+YTyW13W6xGz52mMut2MdOnzxtbhDW8dK9zdF4aLY</span>
</span></code></pre><p>Проверить статус (должно быть <code>Sealed: false</code>) и авторизацию по root ключу в хранилище:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> exec<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>it</span> vault vault status</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> exec<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>it</span> vault vault login hvs.rxlYkJujkX6Fdxq2XAP3cd3a</span>
</span></code></pre><p><code>Secrets Engines</code> -> <code>Enable new engine</code> + <code>KV</code> <br> API Swagger: http://192.168.3.100:8200/ui/vault/tools/api-explorer<pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>TOKEN</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>hvs.rxlYkJujkX6Fdxq2XAP3cd3a<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Headers</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>X-Vault-Token<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>TOKEN</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Указать путь до секретов (создается в корне kv)<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>main-path<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>url</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>http://192.168.3.101:8200/v1/kv/data/<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>data</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Uri <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>url</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Method GET <span class="z-keyword z-operator z-assignment z-powershell">-</span>Headers <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Headers</span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Получить содержимое ключа по его названию (key_name)<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>data<span class="z-variable z-other z-member z-powershell">.data.data.key_name</span></span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> secret_value<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Перезаписать все секреты<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Headers</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>X-Vault-Token<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>TOKEN</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Body</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">data</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-meta z-hashtable z-powershell">        <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">key_name_1</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>key_value_1<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-meta z-hashtable z-powershell">        <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">key_name_2</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>key_value_2<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">options</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">version</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-constant z-numeric z-integer z-powershell">0</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-support z-function z-powershell">ConvertTo-Json</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>urlUpdate</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>http://192.168.3.100:8200/v1/kv/data/main-path<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Uri <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>urlUpdate</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Method POST <span class="z-keyword z-operator z-assignment z-powershell">-</span>Headers <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Headers</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Body <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Body</span>
</span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Удалить все секреты<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Uri <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>http://192.168.3.100:8200/v1/kv/data/main-path<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Method DELETE <span class="z-keyword z-operator z-assignment z-powershell">-</span>Headers <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Headers</span>
</span></code></pre><p>Vault client:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Установить клиент в Linux (debian):</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">wget</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>O</span> - https://apt.releases.hashicorp.com/gpg</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> gpg<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>dearmor</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>o</span> /usr/share/keyrings/hashicorp-archive-keyring.gpg</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>deb [arch=<span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">dpkg</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>print-architecture</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span> signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com <span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">lsb_release</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>cs</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span> main<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> tee /etc/apt/sources.list.d/hashicorp.list</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> apt update</span> <span class="z-keyword z-operator z-logical z-and z-shell">&&</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> apt install vault</span>
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Включить механизм секретов KV</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">vault</span></span><span class="z-meta z-function-call z-arguments z-shell"> secrets enable<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>version</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>1 kv </span>
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Создать секрет</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">vault</span></span><span class="z-meta z-function-call z-arguments z-shell"> kv put kv/main-path key_name=secret_value</span>
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Список секретов</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">vault</span></span><span class="z-meta z-function-call z-arguments z-shell"> kv list kv/</span>
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Получить содержимое секрета</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">vault</span></span><span class="z-meta z-function-call z-arguments z-shell"> kv get<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>mount</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>kv<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>main-path<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Удалить секреты</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">vault</span></span><span class="z-meta z-function-call z-arguments z-shell"> kv delete kv/my-secret</span>
</span></code></pre><h2 id=hashicorp-consul><a aria-label="Anchor link for: hashicorp-consul" class=zola-anchor href=#hashicorp-consul><i class=icon></i></a> HashiCorp/Consul</h2><p><a href=https://github.com/hashicorp/consul>Consul</a> используется для кластеризации и централизованного хранения данных <code>Vault</code>, а также как самостоятельное <code>Key-Value</code> хранилище.<p>Создать конфигурацию:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">ui = true
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">log_level = "INFO"
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">acl {
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">  enabled = true
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">  default_policy = "deny"
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">  enable_token_persistence = true
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">}
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-end z-shell">'</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">></span> consul.hcl</span>
</span></code></pre><p>Запускаем в контейнере:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> run<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>d</span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">  --</span>name</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>consul <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">  --</span>restart</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>unless-stopped <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">  -</span>p</span> 8500:8500 <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">  -</span>v</span> ./consul_data:/consul/data <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">  -</span>v</span> ./consul.hcl:/consul/config/consul.hcl <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell">  hashicorp/consul:latest <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell">  agent<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>server</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>bootstrap-expect</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>1<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>client</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>0.0.0.0</span>
</span></code></pre><p>Создать <code>root token</code>, который будет использоваться для управления системой <code>ACL</code> и для создания политик доступа и других токенов доступа:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> exec<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>it</span> consul consul acl bootstrap</span>
</span></code></pre><p>Создать новую политику доступа:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> exec<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>it</span> consul consul acl policy create<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>name</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>default<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>rules</span> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>node_prefix "" { policy = "write" } service_prefix "" { policy = "write" } key_prefix "" { policy = "write" }<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>token</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>382834da-28b6-c72c-7ffb-11acf9bf20bc<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span></code></pre><p>Создать новый токен доступа:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> exec<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>it</span> consul consul acl token create<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>policy-name</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>default<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>token</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>382834da-28b6-c72c-7ffb-11acf9bf20bc<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span></code></pre><p><code>curl http://localhost:8500/v1/health/service/consul?pretty</code> <br> <code>curl --request PUT --data "ssh-rsa AAAA" http://localhost:8500/v1/kv/ssh/key</code> записать секрет KV Store Consul <br> <code>curl -s http://localhost:8500/v1/kv/ssh/key | jq -r .[].Value | base64 --decode</code> извлечь содержимое секрета<h1 id=pussh><a aria-label="Anchor link for: pussh" class=zola-anchor href=#pussh><i class=icon></i></a> pussh</h1><p><a href=https://github.com/bearstech/pussh>Pussh</a> — инструмент для параллельного выполнения команд через SSH на нескольких хостах одновременно, выводя результаты с указанием имени каждого хоста. Был внутренним инструментом Bearstech (хостинг-провайдер в Париже, Франция) примерно с 2008 года.<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> curl<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>s</span> https://raw.githubusercontent.com/bearstech/pussh/refs/heads/master/pussh<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>o</span> /usr/bin/pussh</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> chmod +x /usr/bin/pussh</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">bash</span></span><span class="z-meta z-function-call z-arguments z-shell"> pussh<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>h</span> root@192.168.3.102,root@192.168.3.103 uname<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>a</span></span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>e</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>root@192.168.3.102\nroot@192.168.3.103<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">></span> host.list</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">pussh</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>f</span> host.list uname<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>a</span></span>
</span></code></pre><h1 id=sake><a aria-label="Anchor link for: sake" class=zola-anchor href=#sake><i class=icon></i></a> Sake</h1><p><a href=https://github.com/alajmo/sake>Sake</a> - это командный раннер для локальных и удаленных хостов. Вы определяете серверы и задачи в файле <code>sake.yaml</code>, а затем запускаете задачи на серверах.<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">curl</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>sfL</span> https://raw.githubusercontent.com/alajmo/sake/main/install.sh</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sh</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sake</span></span><span class="z-meta z-function-call z-arguments z-shell"> init <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> инициализировать sake.yml файл</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sake</span></span><span class="z-meta z-function-call z-arguments z-shell"> list servers <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> вывести список машин</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sake</span></span><span class="z-meta z-function-call z-arguments z-shell"> list tags  <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> список тегов (группы серверов)</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sake</span></span><span class="z-meta z-function-call z-arguments z-shell"> list tasks <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> список задач</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sake</span></span><span class="z-meta z-function-call z-arguments z-shell"> run ping<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>all <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> запустить задачу на все хосты</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sake</span></span><span class="z-meta z-function-call z-arguments z-shell"> exec<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>all</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>uname -a && uptime<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> запустить команду на всех хостах</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span></code></pre><p>Пример конфигурации:<pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">servers</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">localhost</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">host</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-float z-decimal z-yaml">0<span class="z-punctuation z-separator z-decimal z-yaml">.</span>0.0.0</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">local</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-language z-boolean z-yaml">true</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">obsd</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">host</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">root@192.168.3.102:22</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tags</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-meta z-flow-sequence z-yaml"><span class="z-punctuation z-definition z-sequence z-begin z-yaml">[</span><span class="z-string z-unquoted z-plain z-in z-yaml">bsd</span><span class="z-punctuation z-definition z-sequence z-end z-yaml">]</span></span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">fbsd</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">host</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">root@192.168.3.103:22</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tags</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-meta z-flow-sequence z-yaml"><span class="z-punctuation z-definition z-sequence z-begin z-yaml">[</span><span class="z-string z-unquoted z-plain z-in z-yaml">bsd</span><span class="z-punctuation z-definition z-sequence z-end z-yaml">]</span></span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">work_dir</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">/tmp</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">env</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">DATE</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">$(date -u +"%Y-%m-%dT%H:%M:%S%Z")</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">specs</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">info</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">output</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">table</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ignore_errors</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-language z-boolean z-yaml">true</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">omit_empty_rows</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-language z-boolean z-yaml">true</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">omit_empty_columns</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-language z-boolean z-yaml">true</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">any_fatal_errors</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-language z-boolean z-yaml">false</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ignore_unreachable</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-language z-boolean z-yaml">true</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">strategy</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">free</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ping</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">desc</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Pong</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">spec</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">info</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">cmd</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">echo "pong"</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">uname</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">OS</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">desc</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Print OS</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">spec</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">info</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">cmd</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-keyword z-control z-flow z-block-scalar z-literal z-yaml">|</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">      os=$(uname -s)
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">      release=$(uname -r)
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">      echo "$os $release"
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml"></span>  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">uptime</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Uptime</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">desc</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Print uptime</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">spec</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">info</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">cmd</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">uptime</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">info</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">desc</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Get system overview</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">spec</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">info</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">task</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ping</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">date</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">cmd</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">echo $DATE</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">pwd</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">cmd</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">pwd</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">task</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">uname</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">task</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">uptime</span>
</span></code></pre><p><code>sake run info --tags bsd</code> запустить набор из 5 заданий из группы info<h1 id=puppet><a aria-label="Anchor link for: puppet" class=zola-anchor href=#puppet><i class=icon></i></a> Puppet</h1><h2 id=bolt><a aria-label="Anchor link for: bolt" class=zola-anchor href=#bolt><i class=icon></i></a> Bolt</h2><p><a href=https://github.com/puppetlabs/bolt>Bolt</a> - это инструмент оркестровки, который выполняет заданную команду или группу команд на локальной рабочей станции, а также напрямую подключается к удаленным целям с помощью SSH или WinRM, что не требует установки агентов.<p>Docs: https://www.puppet.com/docs/bolt/latest/getting_started_with_bolt.html<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">wget</span></span><span class="z-meta z-function-call z-arguments z-shell"> https://apt.puppet.com/puppet-tools-release-bullseye.deb</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> dpkg<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>i</span> puppet-tools-release-bullseye.deb</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> apt-get update</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> apt-get install puppet-bolt</span>
</span></code></pre><p><code>nano inventory.yaml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">groups</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">bsd</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">targets</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">uri</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">192.168.3.102:22</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">openbsd</span>
</span><span class="z-source z-yaml">    <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">uri</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">192.168.3.103:22</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">freebsd</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">config</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">transport</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ssh</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ssh</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">user</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">root</span>
</span><span class="z-source z-yaml">      <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> password: root
</span></span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">host-key-check</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-language z-boolean z-yaml">false</span>
</span></code></pre><p><code>bolt command run uptime --inventory inventory.yaml --targets bsd</code> выполнить команду uptime на группе хостов bsd, заданной в файле inventory<p><code>echo name: lazyjournal > bolt-project.yaml</code> создать файл проекта<p><code>mkdir plans && nano test.yaml</code> создать директорию и файл с планом работ<pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">parameters</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">targets</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">type</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">TargetSpec</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">steps</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">clone</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">command</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">rm -rf lazyjournal && git clone https://github.com/Lifailon/lazyjournal</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">targets</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">$targets</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">test</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">command</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">cd lazyjournal && go test -v -cover --run TestMainInterface</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">targets</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">$targets</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">remove</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">command</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">rm -rf lazyjournal</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">targets</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">$targets</span>
</span></code></pre><p><code>bolt plan show</code> вывести список всех планов<p><code>bolt plan run lazyjournal::test --inventory inventory.yaml --targets bsd -v</code> запустить план<h1 id=ansible><a aria-label="Anchor link for: ansible" class=zola-anchor href=#ansible><i class=icon></i></a> Ansible</h1><p><code>apt -y update && apt -y upgrade</code> <br> <code>apt -y install ansible</code> v2.10.8 <br> <code>apt -y install ansible-core</code> v2.12.0 <br> <code>apt -y install sshpass</code><p><code>ansible-galaxy collection install ansible.windows</code> установить коллекцию модулей <br> <code>ansible-galaxy collection install community.windows</code> <br> <code>ansible-galaxy collection list | grep windows</code> <br> <code>ansible-config dump | grep DEFAULT_MODULE_PATH</code> путь хранения модулей<p><code>apt-get -y install python-dev libkrb5-dev krb5-user</code> пакеты для Kerberos аутентификации <br> <code>apt install python3-pip</code> <br> <code>pip3 install requests-kerberos</code> <br> <code>nano /etc/krb5.conf</code> настроить [realms] и [domain_realm] <br> <code>kinit -C support4@domail.local</code> <br> <code>klist</code><p><code>ansible --version</code> <br> <code>config file = None</code> <br> <code>nano /etc/ansible/ansible.cfg</code> файл конфигурации<pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-meta z-flow-sequence z-yaml"><span class="z-punctuation z-definition z-sequence z-begin z-yaml">[</span><span class="z-string z-unquoted z-plain z-in z-yaml">defaults</span><span class="z-punctuation z-definition z-sequence z-end z-yaml">]</span></span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">inventory = /etc/ansible/hosts</span>
</span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> uncomment this to disable SSH key host checking
</span></span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Отключить проверку ключа ssh (для подключения используя пароль)
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">host_key_checking = False</span>
</span></code></pre><h2 id=hosts><a aria-label="Anchor link for: hosts" class=zola-anchor href=#hosts><i class=icon></i></a> Hosts</h2><p><code>nano /etc/ansible/hosts</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-meta z-flow-sequence z-yaml"><span class="z-punctuation z-definition z-sequence z-begin z-yaml">[</span><span class="z-string z-unquoted z-plain z-in z-yaml">us</span><span class="z-punctuation z-definition z-sequence z-end z-yaml">]</span></span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">pi-hole-01 ansible_host=192.168.3.101</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">zabbix-01 ansible_host=192.168.3.102</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">grafana-01 ansible_host=192.168.3.103</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">netbox-01 ansible_host=192.168.3.104</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-meta z-flow-sequence z-yaml"><span class="z-punctuation z-definition z-sequence z-begin z-yaml">[</span><span class="z-string z-unquoted z-plain z-in z-yaml">all:vars</span><span class="z-punctuation z-definition z-sequence z-end z-yaml">]</span></span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">ansible_ssh_port=2121</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">ansible_user=lifailon</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">ansible_password=123098</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">path_user=/home/lifailon</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">ansible_python_interpreter=/usr/bin/python3</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-meta z-flow-sequence z-yaml"><span class="z-punctuation z-definition z-sequence z-begin z-yaml">[</span><span class="z-string z-unquoted z-plain z-in z-yaml">ws</span><span class="z-punctuation z-definition z-sequence z-end z-yaml">]</span></span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">huawei-book-01 ansible_host=192.168.3.99</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">plex-01 ansible_host=192.168.3.100</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-meta z-flow-sequence z-yaml"><span class="z-punctuation z-definition z-sequence z-begin z-yaml">[</span><span class="z-string z-unquoted z-plain z-in z-yaml">ws:vars</span><span class="z-punctuation z-definition z-sequence z-end z-yaml">]</span></span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">ansible_port=5985</span>
</span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>ansible_port=5986
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">ansible_user=Lifailon</span>
</span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>ansible_user=support4@DOMAIN.LOCAL
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">ansible_password=123098</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">ansible_connection=winrm</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">ansible_winrm_scheme=http</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">ansible_winrm_transport=basic</span>
</span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>ansible_winrm_transport=kerberos
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">ansible_winrm_server_cert_validation=ignore</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">validate_certs=false</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-meta z-flow-sequence z-yaml"><span class="z-punctuation z-definition z-sequence z-begin z-yaml">[</span><span class="z-string z-unquoted z-plain z-in z-yaml">win_ssh</span><span class="z-punctuation z-definition z-sequence z-end z-yaml">]</span></span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">huawei-book-01 ansible_host=192.168.3.99</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">plex-01 ansible_host=192.168.3.100</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-meta z-flow-sequence z-yaml"><span class="z-punctuation z-definition z-sequence z-begin z-yaml">[</span><span class="z-string z-unquoted z-plain z-in z-yaml">win_ssh:vars</span><span class="z-punctuation z-definition z-sequence z-end z-yaml">]</span></span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">ansible_python_interpreter=C:\Users\Lifailon\AppData\Local\Programs\Python\Python311\` добавить переменную среды интерпритатора Python в Windows</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">ansible_connection=ssh</span>
</span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>ansible_shell_type=cmd
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">ansible_shell_type=powershell</span>
</span></code></pre><p><code>ansible-inventory --list</code> проверить конфигурацию (читает в формате JSON) или YAML (-y) с просмотром все применяемых переменных<h2 id=windows-modules><a aria-label="Anchor link for: windows-modules" class=zola-anchor href=#windows-modules><i class=icon></i></a> Windows Modules</h2><p><code>ansible us -m ping</code> <br> <code>ansible win_ssh -m ping</code> <br> <code>ansible us -m shell -a "uptime && df -h | grep lv"</code> <br> <code>ansible us -m setup | grep -iP "mem|proc"</code> информация о железе <br> <code>ansible us -m apt -a "name=mc" -b</code> повысить привилегии sudo (-b) <br> <code>ansible us -m service -a "name=ssh state=restarted enabled=yes" -b</code> перезапустить службу <br> <code>echo "echo test" > test.sh</code> <br> <code>ansible us -m copy -a "src=test.sh dest=/root mode=777" -b</code> <br> <code>ansible us -a "ls /root" -b</code> <br> <code>ansible us -a "cat /root/test.sh" -b</code><p><code>ansible-doc -l | grep win_</code> <a href=https://docs.ansible.com/ansible/latest/collections/ansible/windows/>список всех модулей Windows</a> <br> <code>ansible ws -m win_ping</code> windows модуль <br> <code>ansible ws -m win_ping -u WinRM-Writer</code> указать логин <br> <code>ansible ws -m setup</code> собрать подробную информацию о системе <br> <code>ansible ws -m win_whoami</code> информация о правах доступах, группах доступа <br> <code>ansible ws -m win_shell -a '$PSVersionTable'</code> <br> <code>ansible ws -m win_shell -a 'Get-Service | where name -match "ssh|winrm"'</code> <br> <code>ansible ws -m win_service -a "name=sshd state=stopped"</code> <br> <code>ansible ws -m win_service -a "name=sshd state=started"</code><ul><li>win_shell (vars/debug)</ul><p><code>nano /etc/ansible/PowerShell-Vars.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml"> ` <span class="z-string z-unquoted z-plain z-out z-yaml">Указать коллекцию модулей</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">collections</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ansible.windows</span>
</span><span class="z-source z-yaml"> ` <span class="z-string z-unquoted z-plain z-out z-yaml">Задать переменные</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">vars</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">SearchName</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">PermitRoot</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Get port ssh</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">win_shell</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-keyword z-control z-flow z-block-scalar z-literal z-yaml">|</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">      Get-Content "C:\Programdata\ssh\sshd_config" | Select-String "{{SearchName}}"
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml"></span>   ` <span class="z-string z-unquoted z-plain z-out z-yaml">Передать вывод в переменную</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">register</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">command_output</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Output port ssh</span>
</span><span class="z-source z-yaml">   ` <span class="z-string z-unquoted z-plain z-out z-yaml">Вывести переменную на экран</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">debug</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">var</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">command_output.stdout_lines</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/PowerShell-Vars.yml</code> <br> <code>ansible-playbook /etc/ansible/PowerShell-Vars.yml --extra-vars "SearchName='LogLevel|Syslog'"</code> передать переменную<ul><li>win_powershell</ul><p><code>nano /etc/ansible/powershell-param.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Run PowerShell script with parameters</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ansible.windows.win_powershell</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">parameters</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">Path</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">C:\Temp</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">Force</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-language z-boolean z-yaml">true</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">script</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-keyword z-control z-flow z-block-scalar z-literal z-yaml">|</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">        [CmdletBinding()]
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">        param (
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">          [String]$Path,
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">          [Switch]$Force
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">        )
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">        New-Item -Path $Path -ItemType Directory -Force:$Force
</span></span></code></pre><p><code>ansible-playbook /etc/ansible/powershell-param.yml</code><ul><li>win_chocolatey</ul><p><code>nano /etc/ansible/setup-adobe-acrobat.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Install Acrobat Reader</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">win_chocolatey</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">adobereader</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">state</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">present</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/setup-adobe-acrobat.yml</code><p><code>nano /etc/ansible/setup-openssh.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">install the Win32-OpenSSH service</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">win_chocolatey</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">openssh</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">package_params</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">/SSHServerFeature</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">state</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">present</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/setup-openssh.yml</code><ul><li>win_regedit</ul><p><code>nano /etc/ansible/win-set-shell-ssh-ps7.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Set the default shell to PowerShell 7 for Windows OpenSSH</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">win_regedit</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">path</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">HKLM:\SOFTWARE\OpenSSH</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">DefaultShell</span>
</span><span class="z-source z-yaml">     ` <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">data</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">data</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-single z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">'</span>C:\Program Files\PowerShell\7\pwsh.exe<span class="z-punctuation z-definition z-string z-end z-yaml">'</span></span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">type</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">string</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">state</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">present</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/win-set-shell-ssh-ps7.yml</code><ul><li>win_service</ul><p><code>nano /etc/ansible/win-service.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Start service</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">win_service</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">sshd</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">state</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">started</span>
</span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>     state: stopped
</span></span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>     state: restarted
</span></span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>     start_mode: auto
</span></span></code></pre><p><code>ansible-playbook /etc/ansible/win-service.yml</code><ul><li>win_service_info</ul><p><code>nano /etc/ansible/get-service.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Get info for a single service</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">win_service_info</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">sshd</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">register</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">service_info</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Print returned information</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ansible.builtin.debug</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">var</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">service_info.services</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/get-service.yml</code><ul><li>fetch/slurp</ul><p><code>nano /etc/ansible/copy-from-win-to-local.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Retrieve remote file on a Windows host</span>
</span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>   Скопировать файл из Windows-системы
</span></span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ansible.builtin.fetch</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>   Прочитать файл (передать в память в формате Base64)
</span></span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>   ansible.builtin.slurp:
</span></span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">src</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">C:\Telegraf\telegraf.conf</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">dest</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">/root/telegraf.conf</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">flat</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-language z-boolean z-yaml">yes</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">register</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">telegraf_conf</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Print returned information</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ansible.builtin.debug</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">msg</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>{{ telegraf_conf['content'] | b64decode }}<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/copy-from-win-to-local.yml</code><ul><li>win_copy</ul><p><code>echo "Get-Service | where name -eq vss | Start-Service" > /home/lifailon/Start-Service-VSS.ps1</code> <br> <code>nano /etc/ansible/copy-file-to-win.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Copy file to win hosts</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">win_copy</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">src</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">/home/lifailon/Start-Service-VSS.ps1</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">dest</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">C:\Users\Lifailon\Desktop\Start-Service-VSS.ps1</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/copy-file-to-win.yml</code><p><code>curl -OL https://github.com/PowerShell/PowerShell/releases/download/v7.3.6/PowerShell-7.3.6-win-x64.msi</code> <br> <code>nano /etc/ansible/copy-file-to-win.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Copy file to win hosts</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">win_copy</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">src</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">/home/lifailon/PowerShell-7.3.6-win-x64.msi</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">dest</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">C:\Install\PowerShell-7.3.6.msi</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/copy-file-to-win.yml</code><ul><li>win_command</ul><p><code>nano /etc/ansible/run-script-ps1.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Run PowerShell Script</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">win_command</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">powershell -ExecutionPolicy ByPass -File C:\Users\Lifailon\Desktop\Start-Service-VSS.ps1</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/run-script-ps1.yml</code><ul><li>win_package</ul><p><code>nano /etc/ansible/setup-msi-package.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Install MSI Package</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">win_package</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>     path: C:\Install\7z-23.01.msi
</span></span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">path</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">C:\Install\PowerShell-7.3.6.msi</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">arguments</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">/quiet</span>
</span><span class="z-source z-yaml">        <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">/passive</span>
</span><span class="z-source z-yaml">        <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">/norestart</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/setup-msi-package.yml</code><ul><li>win_firewall_rule</ul><p><code>nano /etc/ansible/win-fw-open.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Open RDP port</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">win_firewall_rule</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Open RDP port</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">localport</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">3389</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">action</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">allow</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">direction</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">in</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">protocol</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">tcp</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">state</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">present</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">enabled</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-language z-boolean z-yaml">yes</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/win-fw-open.yml</code><ul><li>win_group</ul><p><code>nano /etc/ansible/win-creat-group.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Create a new group</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">win_group</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">deploy</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">description</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Deploy Group</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">state</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">present</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/win-creat-group.yml</code><ul><li>win_group_membership</ul><p><code>nano /etc/ansible/add-user-to-group.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Add a local and domain user to a local group</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">win_group_membership</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">deploy</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">members</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">WinRM-Writer</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">state</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">present</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/add-user-to-group.yml</code><ul><li>win_user</ul><p><code>nano /etc/ansible/creat-win-user.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Creat user</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">win_user</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">test</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">password</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">123098</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">state</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">present</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">groups</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">deploy</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/creat-win-user.yml</code><p><code>nano /etc/ansible/delete-win-user.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Delete user</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ansible.windows.win_user</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">test</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">state</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">absent</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/delete-win-user.yml</code><ul><li>win_feature</ul><p><code>nano /etc/ansible/install-feature.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Install Windows Feature</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">win_feature</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">SNMP-Service</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">state</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">present</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/install-feature.yml</code><ul><li>win_reboot</ul><p><code>nano /etc/ansible/win-reboot.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Reboot a slow machine that might have lots of updates to apply</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">win_reboot</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">reboot_timeout</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">3600</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/win-reboot.yml</code><ul><li>win_find</ul><p><code>nano /etc/ansible/win-ls.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Find files in multiple paths</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ansible.windows.win_find</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">paths</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">D:\Install\OpenSource</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">patterns</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-meta z-flow-sequence z-yaml"><span class="z-punctuation z-definition z-sequence z-begin z-yaml">[</span><span class="z-string z-quoted z-single z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">'</span>*.rar<span class="z-punctuation z-definition z-string z-end z-yaml">'</span></span><span class="z-punctuation z-separator z-sequence z-yaml">,</span><span class="z-string z-quoted z-single z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">'</span>*.zip<span class="z-punctuation z-definition z-string z-end z-yaml">'</span></span><span class="z-punctuation z-separator z-sequence z-yaml">,</span><span class="z-string z-quoted z-single z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">'</span>*.msi<span class="z-punctuation z-definition z-string z-end z-yaml">'</span></span><span class="z-punctuation z-definition z-sequence z-end z-yaml">]</span></span>
</span><span class="z-source z-yaml">     ` <span class="z-string z-unquoted z-plain z-out z-yaml">Файл созданный менее 7 дней назад</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">age</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">-7d</span>
</span><span class="z-source z-yaml">     ` <span class="z-string z-unquoted z-plain z-out z-yaml">Размер файла больше 10MB</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">size</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">10485760</span>
</span><span class="z-source z-yaml">     ` <span class="z-string z-unquoted z-plain z-out z-yaml">Рекурсивный поиск (в дочерних директориях)</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">recurse</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-language z-boolean z-yaml">true</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">register</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">command_output</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Output</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">debug</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">var</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">command_output</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/win-ls.yml</code><ul><li>win_uri</ul><p><code>nano /etc/ansible/rest-get.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">REST GET request to endpoint github</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ansible.windows.win_uri</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">url</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">https://api.github.com/repos/Lifailon/pSyslog/releases/latest</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">register</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">http_output</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Output</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">debug</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">var</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">http_output</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/rest-get.yml</code><ul><li>win_updates</ul><p><code>nano /etc/ansible/win-update.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Install only particular updates based on the KB numbers</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ansible.windows.win_updates</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">category_names</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">SecurityUpdates</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">CriticalUpdates</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">UpdateRollups</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Drivers</span>
</span><span class="z-source z-yaml">     ` <span class="z-string z-unquoted z-plain z-out z-yaml">Фильтрация</span>
</span><span class="z-source z-yaml">     ` <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">accept_list</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">     ` <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">KB2267602</span>
</span><span class="z-source z-yaml">     ` <span class="z-string z-unquoted z-plain z-out z-yaml">Поиск обновлений</span>
</span><span class="z-source z-yaml">     ` <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">state</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">searched</span>
</span><span class="z-source z-yaml">     ` <span class="z-string z-unquoted z-plain z-out z-yaml">Загрузить обновления</span>
</span><span class="z-source z-yaml">     ` <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">state</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">downloaded</span>
</span><span class="z-source z-yaml">     ` <span class="z-string z-unquoted z-plain z-out z-yaml">Установить обновления</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">state</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">installed</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">log_path</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">C:\Ansible-Windows-Upadte-Log.txt</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">reboot</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-language z-boolean z-yaml">false</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">register</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">wu_output</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Output</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">debug</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">var</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">wu_output</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/win-update.yml</code><ul><li>win_chocolatey</ul><p><a href=https://chocolatey.org/install>Install</a> <br> <a href=https://community.chocolatey.org/api/v2/package/chocolatey>API</a> <br> <a href=https://docs.chocolatey.org/en-us/guides/organizations/organizational-deployment-guide>Deployment</a><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Ensure Chocolatey installed from internal repo</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">win_chocolatey</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">chocolatey</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">state</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">present</span>
</span><span class="z-source z-yaml">	<span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> source: URL-адрес внутреннего репозитория
</span></span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">source</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">https://community.chocolatey.org/api/v2/ChocolateyInstall.ps1</span>
</span></code></pre><h1 id=jinja><a aria-label="Anchor link for: jinja" class=zola-anchor href=#jinja><i class=icon></i></a> Jinja</h1><p>Локальное использование:<p><code>pip install jinja2 --break-system-packages</code><p><code>inventory.j2</code> шаблон для генерации<pre class=z-code><code><span class="z-text z-plain">[dev]
</span><span class="z-text z-plain">{% for host in hosts -%}
</span><span class="z-text z-plain">{{ host }} ansible_host={{ host }}
</span><span class="z-text z-plain">{% endfor %}
</span></code></pre><p><code>env.json</code> файл с переменными<pre class="language-json z-code" data-lang=json><code class=language-json data-lang=json><span class="z-source z-json"><span class="z-meta z-mapping z-json"><span class="z-punctuation z-section z-mapping z-begin z-json">{</span>
</span></span><span class="z-source z-json"><span class="z-meta z-mapping z-json">  </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>hosts<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-sequence z-json"><span class="z-punctuation z-section z-sequence z-begin z-json">[</span><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>192.168.3.101<span class="z-punctuation z-definition z-string z-end z-json">"</span></span><span class="z-punctuation z-separator z-sequence z-json">,</span> <span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>192.168.3.102<span class="z-punctuation z-definition z-string z-end z-json">"</span></span><span class="z-punctuation z-separator z-sequence z-json">,</span> <span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>192.168.3.103<span class="z-punctuation z-definition z-string z-end z-json">"</span></span><span class="z-punctuation z-section z-sequence z-end z-json">]</span></span>
</span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-section z-mapping z-end z-json">}</span></span>
</span></code></pre><p><code>render.py</code> скрипт для генерации файла inventory<pre class="language-Python z-code" data-lang=Python><code class=language-Python data-lang=Python><span class="z-source z-python"><span class="z-meta z-statement z-import z-python"><span class="z-keyword z-control z-import z-from z-python">from</span></span><span class="z-meta z-statement z-import z-python"><span class="z-meta z-import-source z-python"> <span class="z-meta z-import-path z-python"><span class="z-meta z-import-name z-python">jinja2</span></span> <span class="z-meta z-statement z-import z-python"><span class="z-keyword z-control z-import z-python">import</span></span></span></span><span class="z-meta z-statement z-import z-python"></span><span class="z-meta z-statement z-import z-python"> <span class="z-meta z-generic-name z-python">Environment</span><span class="z-punctuation z-separator z-import-list z-python">,</span> <span class="z-meta z-generic-name z-python">FileSystemLoader</span></span>
</span><span class="z-source z-python"><span class="z-meta z-statement z-import z-python"><span class="z-keyword z-control z-import z-python">import</span> <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">json</span></span></span>
</span><span class="z-source z-python"><span class="z-comment z-line z-number-sign z-python"><span class="z-punctuation z-definition z-comment z-python">#</span> Загружаем переменные из JSON
</span></span><span class="z-source z-python"><span class="z-meta z-statement z-with z-python"><span class="z-keyword z-control z-flow z-with z-python">with</span> <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-support z-function z-builtin z-python">open</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-single z-python"><span class="z-punctuation z-definition z-string z-begin z-python">'</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-single z-python">env.json<span class="z-punctuation z-definition z-string z-end z-python">'</span></span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span> <span class="z-meta z-statement z-with z-python"><span class="z-keyword z-control z-flow z-with z-as z-python">as</span></span></span><span class="z-meta z-statement z-with z-python"> <span class="z-meta z-generic-name z-python">f</span><span class="z-punctuation z-section z-block z-with z-python">:</span></span>
</span><span class="z-source z-python">    <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">data</span></span> <span class="z-keyword z-operator z-assignment z-python">=</span> <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">json</span></span><span class="z-meta z-qualified-name z-python"><span class="z-punctuation z-accessor z-dot z-python">.</span></span><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-meta z-generic-name z-python">load</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">f</span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span><span class="z-source z-python"><span class="z-comment z-line z-number-sign z-python"><span class="z-punctuation z-definition z-comment z-python">#</span> Настройка шаблонизатора
</span></span><span class="z-source z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">env</span></span> <span class="z-keyword z-operator z-assignment z-python">=</span> <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-meta z-generic-name z-python">Environment</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-variable z-parameter z-python">loader</span><span class="z-keyword z-operator z-assignment z-python">=</span><span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-meta z-generic-name z-python">FileSystemLoader</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-single z-python"><span class="z-punctuation z-definition z-string z-begin z-python">'</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-single z-python">.<span class="z-punctuation z-definition z-string z-end z-python">'</span></span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span><span class="z-source z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">template</span></span> <span class="z-keyword z-operator z-assignment z-python">=</span> <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">env</span></span><span class="z-meta z-qualified-name z-python"><span class="z-punctuation z-accessor z-dot z-python">.</span></span><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-meta z-generic-name z-python">get_template</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-single z-python"><span class="z-punctuation z-definition z-string z-begin z-python">'</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-single z-python">inventory.j2<span class="z-punctuation z-definition z-string z-end z-python">'</span></span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span><span class="z-source z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">output</span></span> <span class="z-keyword z-operator z-assignment z-python">=</span> <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">template</span></span><span class="z-meta z-qualified-name z-python"><span class="z-punctuation z-accessor z-dot z-python">.</span></span><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-meta z-generic-name z-python">render</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">data</span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span><span class="z-source z-python"><span class="z-comment z-line z-number-sign z-python"><span class="z-punctuation z-definition z-comment z-python">#</span> Сохраняем результат в файл
</span></span><span class="z-source z-python"><span class="z-meta z-statement z-with z-python"><span class="z-keyword z-control z-flow z-with z-python">with</span> <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-support z-function z-builtin z-python">open</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-single z-python"><span class="z-punctuation z-definition z-string z-begin z-python">'</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-single z-python">inventory.generated<span class="z-punctuation z-definition z-string z-end z-python">'</span></span></span><span class="z-punctuation z-separator z-arguments z-python">,</span> <span class="z-meta z-string z-python"><span class="z-string z-quoted z-single z-python"><span class="z-punctuation z-definition z-string z-begin z-python">'</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-single z-python">w<span class="z-punctuation z-definition z-string z-end z-python">'</span></span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span> <span class="z-meta z-statement z-with z-python"><span class="z-keyword z-control z-flow z-with z-as z-python">as</span></span></span><span class="z-meta z-statement z-with z-python"> <span class="z-meta z-generic-name z-python">f</span><span class="z-punctuation z-section z-block z-with z-python">:</span></span>
</span><span class="z-source z-python">    <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">f</span></span><span class="z-meta z-qualified-name z-python"><span class="z-punctuation z-accessor z-dot z-python">.</span></span><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-meta z-generic-name z-python">write</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">output</span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span></code></pre><p><code>python render.py</code><p>Использование в Ansible для обновления файла <code>hosts</code>:<p><code>inventory.ini</code><pre class=z-code><code><span class="z-text z-plain">[dev]
</span><span class="z-text z-plain">dev1 ansible_host=192.168.3.101
</span><span class="z-text z-plain">dev2 ansible_host=192.168.3.102
</span><span class="z-text z-plain">dev3 ansible_host=192.168.3.103
</span></code></pre><p><code>templates/hosts.j2</code><pre class=z-code><code><span class="z-text z-plain">127.0.0.1 localhost
</span><span class="z-text z-plain">{% for host in groups['all'] -%}
</span><span class="z-text z-plain">{{ hostvars[host]['ansible_host'] }} {{ host }}
</span><span class="z-text z-plain">{% endfor %}
</span></code></pre><p><code>playbook.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Update hosts file</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">all</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">become</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-language z-boolean z-yaml">true</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Generate hosts file</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">template</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">src</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">hosts.j2</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">dest</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">/etc/hosts</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">owner</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">root</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">group</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">root</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">mode</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-single z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">'</span>0644<span class="z-punctuation z-definition z-string z-end z-yaml">'</span></span>
</span></code></pre><p><code>ansible-playbook -i inventory.ini playbook.yml --check --diff</code> отобразит изменения без их реального применения <br> <code>ansible-playbook -i inventory.ini playbook.yml -K</code> позволяет передать пароль для root<h1 id=dsc><a aria-label="Anchor link for: dsc" class=zola-anchor href=#dsc><i class=icon></i></a> DSC</h1><p><code>Import-Module PSDesiredStateConfiguration</code> <br> <code>Get-Command -Module PSDesiredStateConfiguration</code> <br> <code>(Get-Module PSDesiredStateConfiguration).ExportedCommands</code> <br> <code>Get-DscLocalConfigurationManager</code><p><code>Get-DscResource</code> <br> <code>Get-DscResource -Name File -Syntax</code> <a href="https://learn.microsoft.com/ru-ru/powershell/dsc/reference/resources/windows/fileresource?view=dsc-1.1">синтаксис</a><p><code>Ensure = Present</code> настройка должна быть включена (каталог должен присутствовать, процесс должен быть запущен, если нет – создать, запустить) <br> <code>Ensure = Absent</code> настройка должна быть выключена (каталога быть не должно, процесс не должен быть запущен, если нет – удалить, остановить)<pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-meta z-function z-powershell"><span class="z-storage z-type z-powershell">Configuration</span> <span class="z-entity z-name z-function z-powershell">TestConfiguraion</span></span>
</span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    Ctrl<span class="z-keyword z-operator z-assignment z-powershell">+</span>Space
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-meta z-function z-powershell"><span class="z-storage z-type z-powershell">Configuration</span> <span class="z-entity z-name z-function z-powershell">DSConfigurationProxy</span></span> 
</span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    Node vproxy<span class="z-keyword z-operator z-assignment z-powershell">-</span><span class="z-constant z-numeric z-integer z-powershell">01</span> 
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        File CreateDir
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">            Ensure <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Present<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">            Type <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Directory<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">            DestinationPath <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>C:\Temp<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        Service StopW32time
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">            Name <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>w32time<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">            State <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Stopped<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-other z-powershell">`</span> Running
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">    WindowsProcess RunCalc
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">            Ensure <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Present<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">            Path <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>C:\WINDOWS\system32\calc.exe<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">            Arguments <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        Registry RegSettings
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">            Ensure <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Present<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">            Key <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>HKEY_LOCAL_MACHINE\SOFTWARE\MySoft<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">            ValueName <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>TestName<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">            ValueData <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>TestValue<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">            ValueType <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>String<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span>		WindowsFeature IIS<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span>       {<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span>            Ensure = "Present"<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span>            Name = "Web-Server"<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span>       }<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></code></pre><p><code>$Path = (DSConfigurationProxy).DirectoryName</code> <br> <code>Test-DscConfiguration -Path $Path | select *</code> ResourcesInDesiredState - уже настроено, ResourcesNotInDesiredState - не настроено (не соответствует) <br> <code>Start-DscConfiguration -Path $Path</code> <br> <code>Get-Job</code> <br> <code>$srv = "vproxy-01"</code> <br> <code>Get-Service -ComputerName $srv | ? name -match w32time # Start-Service</code> <br> <code>icm $srv {Get-Process | ? ProcessName -match calc} | ft # Stop-Process -Force</code> <br> <code>icm $srv {ls C:\ | ? name -match Temp} | ft</code> rm`<pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-meta z-function z-powershell"><span class="z-storage z-type z-powershell">Configuration</span> <span class="z-entity z-name z-function z-powershell">InstallPowerShellCore</span></span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-support z-function z-powershell">Import-DscResource</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>ModuleName PSDesiredStateConfiguration
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    Node localhost <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        Script InstallPowerShellCore <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">            GetScript <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">                <span class="z-keyword z-control z-powershell">return</span> <span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-hashtable z-powershell">                    <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">GetScript</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>GetScript</span>
</span></span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-hashtable z-powershell">                <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">            <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">            SetScript <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">string</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>url</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-group z-complex z-subexpression z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-support z-function z-powershell">Invoke-RestMethod</span> https:<span class="z-keyword z-operator z-assignment z-powershell">/</span><span class="z-keyword z-operator z-assignment z-powershell">/</span><span class="z-support z-function z-powershell">api.github.com</span><span class="z-keyword z-operator z-assignment z-powershell">/</span>repos<span class="z-keyword z-operator z-assignment z-powershell">/</span>PowerShell<span class="z-keyword z-operator z-assignment z-powershell">/</span>PowerShell<span class="z-keyword z-operator z-assignment z-powershell">/</span>releases<span class="z-keyword z-operator z-assignment z-powershell">/</span>latest<span class="z-punctuation z-section z-group z-end z-powershell">)</span></span>.assets.browser_download_url <span class="z-keyword z-operator z-comparison z-powershell">-match</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>win-x64.zip<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">                <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>downloadPath</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Downloads\PowerShell.zip<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">                <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>installPath</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-support z-variable z-drive z-powershell">env:</span>ProgramFiles</span>\PowerShell\7<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">                <span class="z-support z-function z-powershell">Invoke-WebRequest</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Uri <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>url</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>OutFile <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>downloadPath</span>
</span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">                <span class="z-support z-function z-powershell">Expand-Archive</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Path <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>downloadPath</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>DestinationPath <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>installPath</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Force
</span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">            <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">            TestScript <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">                <span class="z-keyword z-control z-powershell">return</span> <span class="z-support z-function z-powershell">Test-Path</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-support z-variable z-drive z-powershell">env:</span>ProgramFiles</span>\PowerShell\7\pwsh.exe<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">            <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></code></pre><p><code>$Path = (InstallPowerShellCore).DirectoryName</code> <br> <code>Test-DscConfiguration -Path $Path</code> <br> <code>Start-DscConfiguration -Path $path -Wait -Verbose</code> <br> <code>Get-Job</code><h1 id=psappdeploytoolkit><a aria-label="Anchor link for: psappdeploytoolkit" class=zola-anchor href=#psappdeploytoolkit><i class=icon></i></a> PSAppDeployToolkit</h1><h2 id=install-deploytoolkit><a aria-label="Anchor link for: install-deploytoolkit" class=zola-anchor href=#install-deploytoolkit><i class=icon></i></a> Install-DeployToolkit</h2><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>githubRepository</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>psappdeploytoolkit/psappdeploytoolkit<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>filenamePatternMatch</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>PSAppDeployToolkit*.zip<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>psadtReleaseUri</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>https://api.github.com/repos/<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>githubRepository</span>/releases/latest<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>psadtDownloadUri</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Method GET <span class="z-keyword z-operator z-assignment z-powershell">-</span>Uri <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>psadtReleaseUri</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.assets <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-support z-function z-powershell">Where-Object</span> name <span class="z-keyword z-operator z-comparison z-powershell">-like</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>filenamePatternMatch</span> </span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.browser_download_url
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>zipExtractionPath</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">Join-Path</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-support z-variable z-drive z-powershell">env:</span>USERPROFILE</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Downloads<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>PSAppDeployToolkit<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>zipTempDownloadPath</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">Join-Path</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Path <span class="z-meta z-group z-complex z-subexpression z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">System.IO.Path</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::GetTempPath<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>ChildPath <span class="z-meta z-group z-complex z-subexpression z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-support z-function z-powershell">Split-Path</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Path <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>psadtDownloadUri</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Leaf<span class="z-punctuation z-section z-group z-end z-powershell">)</span></span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span># Download to a temporary folder<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Invoke-WebRequest</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Uri <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>psadtDownloadUri</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Out <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>zipTempDownloadPath</span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span># Remove any Zone.Identifier alternate data streams to unblock the file (if required)<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Unblock-File</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Path <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>zipTempDownloadPath</span>
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">New-Item</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Type Directory <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>zipExtractionPath</span>
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Expand-Archive</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Path <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>zipTempDownloadPath</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>OutputPath <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>zipExtractionPath</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Force
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Write-Host</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>File: {0} extracted to Path: {1}<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-string-format z-powershell">-f</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>psadtDownloadUri</span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>zipExtractionPath</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>ForegroundColor Yellow
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Remove-Item</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>zipTempDownloadPath</span>
</span></code></pre><h2 id=deploy-notepad-plus-plus><a aria-label="Anchor link for: deploy-notepad-plus-plus" class=zola-anchor href=#deploy-notepad-plus-plus><i class=icon></i></a> Deploy-Notepad-Plus-Plus</h2><p><code>$url_notepad = "https://github.com/notepad-plus-plus/notepad-plus-plus/releases/download/v8.6.6/npp.8.6.6.Installer.x64.exe"</code> <br> <code>Invoke-RestMethod $url_notepad -OutFile "$home\Downloads\PSAppDeployToolkit\Toolkit\Files\npp.8.6.6.Installer.x64.exe"</code><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">'</span># Подключаем модуль PSAppDeployToolkit
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell">Import-Module "$PSScriptRoot\AppDeployToolkit\AppDeployToolkitMain.ps1"
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell"># Название приложения
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell">$AppName = "Notepad++"
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell"># Версия приложения
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell">$AppVersion = "8.6.6"
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell"># Путь к установщику Notepad++
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell">$InstallerPath = "$PSScriptRoot\Files\npp.$AppVersion.Installer.x64.exe"
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell"># Проверка существования установщика
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell">If (-not (Test-Path $InstallerPath)) {
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell">    Write-Host "Установщик Notepad++ не найден: $InstallerPath"
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell">    Exit-Script -ExitCode 1
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell">}
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell"># Настройки установки Notepad++
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell">$InstallerArguments = "/S /D=$ProgramFiles\Notepad++"
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell">Function Install-Application {
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell">    # Выводим сообщение о начале установки
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell">    Show-InstallationWelcome -CloseApps "iexplore" -CheckDiskSpace -PersistPrompt
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell">    # Запускаем установку
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell">    Execute-Process -Path $InstallerPath -Parameters $InstallerArguments -WindowStyle Hidden -IgnoreExitCodes "3010"
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell">    # Выводим сообщение об успешной установке
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell">    Show-InstallationPrompt -Message "Установка $AppName завершена." -ButtonRightText "Закрыть" -Icon Information -NoWait
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell">    # Завершаем процесс установки
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell">    Exit-Script -ExitCode $AppDependentExitCode
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell">}
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell">Install-Application<span class="z-punctuation z-definition z-string z-end z-powershell">'</span></span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-support z-function z-powershell">Out-File</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Downloads\PSAppDeployToolkit\Toolkit\Deploy-Application.ps1<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Encoding unicode
</span></code></pre><p><code>powershell -File "$home\Downloads\PSAppDeployToolkit\Toolkit\Deploy-Application.ps1"</code><h2 id=uninstall-notepad-plus-plus><a aria-label="Anchor link for: uninstall-notepad-plus-plus" class=zola-anchor href=#uninstall-notepad-plus-plus><i class=icon></i></a> Uninstall-Notepad-Plus-Plus</h2><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">'</span>Import-Module "$PSScriptRoot\AppDeployToolkit\AppDeployToolkitMain.ps1"
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell">$AppName = "Notepad++"
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell">$UninstallerPath = "C:\Program Files\Notepad++\uninstall.exe"
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell">If (-not (Test-Path $UninstallerPath)) {
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell">    Write-Host "Деинсталлятор Notepad++ не найден: $UninstallerPath"
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell">    Exit-Script -ExitCode 1
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell">}
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell">Function Uninstall-Application {
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell">    Show-InstallationWelcome -CloseApps "iexplore" -CheckDiskSpace -PersistPrompt
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell">    Execute-Process -Path $UninstallerPath -Parameters "/S" -WindowStyle Hidden -IgnoreExitCodes "3010"
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell">    Show-InstallationPrompt -Message "Программа $AppName удалена." -ButtonRightText "Закрыть" -Icon Information -NoWait
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell">    Exit-Script -ExitCode $AppDependentExitCode
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell">}
</span></span><span class="z-source z-powershell"><span class="z-string z-quoted z-single z-powershell">Uninstall-Application<span class="z-punctuation z-definition z-string z-end z-powershell">'</span></span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-support z-function z-powershell">Out-File</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Downloads\PSAppDeployToolkit\Toolkit\Deploy-Application.ps1<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Encoding unicode
</span></code></pre><p><code>powershell -File "$home\Downloads\PSAppDeployToolkit\Toolkit\Deploy-Application.ps1"</code><h2 id=deploy-winscp><a aria-label="Anchor link for: deploy-winscp" class=zola-anchor href=#deploy-winscp><i class=icon></i></a> Deploy-WinSCP</h2><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>PSAppDeployToolkit</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Downloads\PSAppDeployToolkit\<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>version</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>6.3.3<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>url_winscp</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>https://cdn.winscp.net/files/WinSCP-<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>version</span>.msi?secure=P2HLWGKaMDigpDQw-H9BgA==,1716466173<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>WinSCP_Template</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">Get-Content</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>PSAppDeployToolkit</span>\Examples\WinSCP\Deploy-Application.ps1<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> читаем пример конфигурации для WinSCP<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>WinSCP_Template_Latest</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>WinSCP_Template</span> <span class="z-keyword z-operator z-comparison z-powershell">-replace</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>6.3.2<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-other z-powershell">,</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>version</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> обновляем версию на актуальную<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>WinSCP_Template_Latest</span> <span class="z-keyword z-operator z-redirection z-powershell">></span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>PSAppDeployToolkit</span>\Toolkit\Deploy-Application.ps1<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> заменяем скрипт развертывания <span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>url_winscp</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>OutFile <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>PSAppDeployToolkit</span>\Toolkit\Files\WinSCP-<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>version</span>.msi<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> загружаем msi-пакет<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell">powershell <span class="z-keyword z-operator z-assignment z-powershell">-</span>File <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>PSAppDeployToolkit</span>\Toolkit\Deploy-Application.ps1<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> запускаем установку<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></code></pre><h1 id=atlassian><a aria-label="Anchor link for: atlassian" class=zola-anchor href=#atlassian><i class=icon></i></a> Atlassian</h1><h2 id=bitbucket><a aria-label="Anchor link for: bitbucket" class=zola-anchor href=#bitbucket><i class=icon></i></a> Bitbucket</h2><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>url</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>https://github.com/AtlassianPS/BitbucketPS/archive/refs/heads/master.zip<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>url</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>OutFile <span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Downloads\BitbucketPS.zip
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Expand-Archive</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Path <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Downloads\BitbucketPS.zip<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>OutputPath <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Downloads<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Copy-Item</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Path <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Downloads\BitbucketPS-master\*<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Destination <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-complex z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-support z-variable z-drive z-powershell">env:</span>PSModulePath<span class="z-variable z-other z-member z-powershell">.Split</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>;<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span><span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-constant z-numeric z-integer z-powershell">0</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>\PSBitBucket<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Recurse
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Remove-Item</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Downloads\Bitbucket*<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Recurse <span class="z-keyword z-operator z-assignment z-powershell">-</span>Force
</span></code></pre><p><code>Import-Module PSBitBucket</code> <br> <code>Get-Command -Module PSBitBucket</code> <br> <code>Set-BitBucketConfigServer -Url $url -User username -Password password</code> установить конфигурацию сервера BitBucket <br> <code>Get-BitBucketConfigServer</code> получить текущую конфигурацию сервера BitBucket <br> <code>Get-Repositories</code> получить список всех репозиториев для текущей конфигурации сервера BitBucket <br> <code>Get-ProjectKey</code> получить ключ проекта BitBucket <br> <code>Get-BranchList -Repository pSyslog</code> список всех веток в репозитории <br> <code>Get-Branch -Repository pSyslog -Branch main</code> получить информацию о конкретной ветке репозитория <br> <code>Get-CommitMessage -Repository pSyslog -CommitHash $hash</code> получить сообщение коммита по его хэшу <br> <code>Get-Commits -Repository pSyslog -Limit 10</code> список последних 10 коммитов в репозитории <br> <code>Get-CommitsForBranch -Repository pSyslog -Branch main</code> список коммитов для конкретной ветки в репозитории<h2 id=jira><a aria-label="Anchor link for: jira" class=zola-anchor href=#jira><i class=icon></i></a> Jira</h2><p><code>Install-Module JiraPS -Scope CurrentUser -Repository PSGallery -AllowClobber -Force</code> <br> <code>Get-Command -Module JiraPS</code> <br> <code>Get-JiraServerInfo</code> информация о сервере <br> <code>Add-JiraFilterPermission</code> добавить разрешения для фильтра <br> <code>Add-JiraGroupMember</code> добавить участника в группу <br> <code>Add-JiraIssueAttachment</code> добавить вложения к задаче <br> <code>Add-JiraIssueComment</code> добавить комментария к задаче <br> <code>Add-JiraIssueLink</code> добавить ссылки на задачу <br> <code>Add-JiraIssueWatcher</code> добавить наблюдателя к задаче <br> <code>Add-JiraIssueWorklog</code> добавить рабочего журнала к задаче <br> <code>Find-JiraFilter</code> поиск фильтра <br> <code>Format-Jira</code> форматирование данных Jira <br> <code>Get-JiraComponent</code> получение компонента проекта <br> <code>Get-JiraConfigServer</code> получение конфигурации сервера Jira <br> <code>Get-JiraField</code> получение поля Jira <br> <code>Get-JiraFilter</code> получение фильтра <br> <code>Get-JiraFilterPermission</code> получение разрешения фильтра <br> <code>Get-JiraGroup</code> получение группы <br> <code>Get-JiraGroupMember</code> получение участников группы <br> <code>Get-JiraIssue</code> получение задачи <br> <code>Get-JiraIssueAttachment</code> получение вложения задачи <br> <code>Get-JiraIssueAttachmentFile</code> получение файла вложения задачи <br> <code>Get-JiraIssueComment</code> получение комментария задачи <br> <code>Get-JiraIssueCreateMetadata</code> получение метаданных создания задачи <br> <code>Get-JiraIssueEditMetadata</code> получение метаданных редактирования задачи <br> <code>Get-JiraIssueLink</code> получение ссылки задачи <br> <code>Get-JiraIssueLinkType</code> получение типа ссылки задачи <br> <code>Get-JiraIssueType</code> получение типа задачи <br> <code>Get-JiraIssueWatcher</code> получение наблюдателя задачи <br> <code>Get-JiraIssueWorklog</code> получение рабочего журнала задачи <br> <code>Get-JiraPriority</code> получение приоритета задачи <br> <code>Get-JiraProject</code> получение проекта <br> <code>Get-JiraRemoteLink</code> получение удаленной ссылки <br> <code>Get-JiraServerInformation</code> получение информации о сервере Jira <br> <code>Get-JiraSession</code> получение сессии <br> <code>Get-JiraUser</code> получение пользователя <br> <code>Get-JiraVersion</code> получение версии проекта <br> <code>Invoke-JiraIssueTransition</code> выполнение перехода задачи <br> <code>Invoke-JiraMethod</code> выполнение метода Jira <br> <code>Move-JiraVersion</code> перемещение версии проекта <br> <code>New-JiraFilter</code> создание нового фильтра <br> <code>New-JiraGroup</code> создание новой группы <br> <code>New-JiraIssue</code> создание новой задачи <br> <code>New-JiraSession</code> создание новой сессии <br> <code>New-JiraUser</code> создание нового пользователя <br> <code>New-JiraVersion</code> создание новой версии проекта <br> <code>Remove-JiraFilter</code> удаление фильтра <br> <code>Remove-JiraFilterPermission</code> удаление разрешения фильтра <br> <code>Remove-JiraGroup</code> удаление группы <br> <code>Remove-JiraGroupMember</code> удаление участника группы <br> <code>Remove-JiraIssue</code> удаление задачи <br> <code>Remove-JiraIssueAttachment</code> удаление вложения задачи <br> <code>Remove-JiraIssueLink</code> удаление ссылки задачи <br> <code>Remove-JiraIssueWatcher</code> удаление наблюдателя задачи <br> <code>Remove-JiraRemoteLink</code> удаление удаленной ссылки <br> <code>Remove-JiraSession</code> удаление сессии <br> <code>Remove-JiraUser</code> удаление пользователя <br> <code>Remove-JiraVersion</code> удаление версии проекта <br> <code>Set-JiraConfigServer</code> установка конфигурации сервера Jira <br> <code>Set-JiraFilter</code> установка фильтра <br> <code>Set-JiraIssue</code> установка задачи <br> <code>Set-JiraIssueLabel</code> установка метки задачи <br> <code>Set-JiraUser</code> установка пользователя <br> <code>Set-JiraVersion</code> установка версии проекта<h2 id=confluence><a aria-label="Anchor link for: confluence" class=zola-anchor href=#confluence><i class=icon></i></a> Confluence</h2><p><code>Install-Module ConfluencePS -Scope CurrentUser -Repository PSGallery -AllowClobber -Force</code> <br> <code>Get-Command -Module ConfluencePS</code> <br> <code>Add-ConfluenceAttachment</code> добавить вложения к странице <br> <code>Add-ConfluenceLabel</code> добавить метки к странице <br> <code>ConvertTo-ConfluenceStorageFormat</code> конвертация содержимого в формат хранения Confluence <br> <code>ConvertTo-ConfluenceTable</code> конвертация данных в таблицу Confluence <br> <code>Get-ConfluenceAttachment</code> получение вложения страницы <br> <code>Get-ConfluenceAttachmentFile</code> получение файла вложения страницы <br> <code>Get-ConfluenceChildPage</code> получение дочерних страниц <br> <code>Get-ConfluenceLabel</code> получение меток страницы <br> <code>Get-ConfluencePage</code> получение информации о странице <br> <code>Get-ConfluenceSpace</code> получение информации о пространстве <br> <code>Invoke-ConfluenceMethod</code> выполнение метода Confluence <br> <code>New-ConfluencePage</code> создание новой страницы <br> <code>New-ConfluenceSpace</code> создание нового пространства <br> <code>Remove-ConfluenceAttachment</code> удаление вложения страницы <br> <code>Remove-ConfluenceLabel</code> удаление метки со страницы <br> <code>Remove-ConfluencePage</code> удаление страницы <br> <code>Remove-ConfluenceSpace</code> удаление пространства <br> <code>Set-ConfluenceAttachment</code> установка вложения страницы <br> <code>Set-ConfluenceInfo</code> установка информации о странице <br> <code>Set-ConfluenceLabel</code> установка метки страницы <br> <code>Set-ConfluencePage</code> установка страницы<h1 id=prometheus><a aria-label="Anchor link for: prometheus" class=zola-anchor href=#prometheus><i class=icon></i></a> Prometheus</h1><p>Пример создания экспортера для получения метрик температуры всех дисков из CrystalDiskInfo и отправки в <a href=https://github.com/prometheus/prometheus>Prometheus</a> через <a href=https://github.com/prometheus/pushgateway>PushGateway</a>.<ol><li>Запускаем <code>pushgateway</code> в контейнере:</ol><p><code>docker run -d --name pushgateway --restart unless-stopped -p 19091:9091 prom/pushgateway</code><ol start=2><li>Запускаем скрипт в консоли:</ol><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>instance</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">System.Net.Dns</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::GetHostName<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>pushgatewayUrl</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>http://192.168.3.100:19091/metrics/job/disk_temperature<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Изменить адрес шлюза на имя контейнера при запуске через compose<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> $pushgatewayUrl = "http://pushgateway:9091/metrics/job/disk_temperature"<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>C:/Program Files/CrystalDiskInfo/Smart<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Изменить путь при запуске в контейнере Docker через WSL<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> $path = "/mnt/c/Program Files/CrystalDiskInfo/Smart"<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Необходимо строго использовать синтаксис PowerShell (избегая псевдонимы ls)<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>diskArray</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-group z-complex z-subexpression z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-support z-function z-powershell">Get-ChildItem</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span>.Name
</span><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">while</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-constant z-language z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>true</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>metrics</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span># TYPE disk_temperature gauge<span class="z-constant z-character z-escape z-powershell">`n</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-keyword z-control z-powershell">foreach</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>diskName</span> <span class="z-keyword z-control z-powershell">in</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>diskArray</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>lastTemp</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-group z-complex z-subexpression z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-meta z-group z-array-expression z-powershell"><span class="z-keyword z-other z-array z-begin z-powershell">@</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Date,Value<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span><span class="z-keyword z-operator z-assignment z-powershell">+</span><span class="z-meta z-group z-complex z-subexpression z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-support z-function z-powershell">Get-Content</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path</span>/<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>diskName</span>/Temperature.csv<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-support z-function z-powershell">ConvertFrom-Csv</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span><span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-constant z-numeric z-integer z-powershell">-1</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>.Value
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>diskLabel</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>diskName</span> <span class="z-keyword z-operator z-comparison z-powershell">-replace</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>[^a-zA-Z0-9]<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>_<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>metrics</span> <span class="z-keyword z-operator z-assignment z-powershell">+=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>disk_temperature{disk=<span class="z-constant z-character z-escape z-powershell">`"</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>diskLabel</span><span class="z-constant z-character z-escape z-powershell">`"</span>,instance=<span class="z-constant z-character z-escape z-powershell">`"</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>instance</span><span class="z-constant z-character z-escape z-powershell">`"</span>} <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>lastTemp</span><span class="z-constant z-character z-escape z-powershell">`n</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>metrics</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Uri <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>pushgatewayUrl</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Method POST <span class="z-keyword z-operator z-assignment z-powershell">-</span>Body <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>metrics</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-support z-function z-powershell">Start-Sleep</span> <span class="z-constant z-numeric z-integer z-powershell">10</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></code></pre><ol start=3><li>Проверяем наличие метрик на конечной точке шлюза:</ol><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-meta z-group z-complex z-subexpression z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-support z-function z-powershell">Invoke-RestMethod</span> http:<span class="z-keyword z-operator z-assignment z-powershell">/</span><span class="z-keyword z-operator z-assignment z-powershell">/</span><span class="z-constant z-numeric z-integer z-powershell">192.168</span>.<span class="z-constant z-numeric z-integer z-powershell">3.100</span>:<span class="z-constant z-numeric z-integer z-powershell">9091</span><span class="z-keyword z-operator z-assignment z-powershell">/</span>metrics<span class="z-punctuation z-section z-group z-end z-powershell">)</span></span>.Split<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-constant z-character z-escape z-powershell">`n</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-support z-function z-powershell">Select-String</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>disk_temperature<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></code></pre><ol start=4><li>Добавляем конфигурацию в <code>prometheus.yml</code>:</ol><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">scrape_configs</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">job_name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">cdi-exporter</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">scrape_interval</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">10s</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">scrape_timeout</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">2s</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">metrics_path</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">/metrics</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">static_configs</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">targets</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-quoted z-single z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">'</span>192.168.3.100:19091<span class="z-punctuation z-definition z-string z-end z-yaml">'</span></span>
</span></code></pre><p><code>docker-compose kill -s SIGHUP prometheus</code> применяем изменения<ol start=5><li>Собираем контейнер в среде <code>WSL</code> с монтированием системного диска Windows:</ol><pre class="language-dockerfile z-code" data-lang=dockerfile><code class=language-dockerfile data-lang=dockerfile><span class="z-source z-dockerfile">Write-Output '
</span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">FROM</span> mcr.microsoft.com/powershell:<span class="z-entity z-name z-enum z-tag-digest">latest</span>
</span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">WORKDIR </span>/cdi-exporter
</span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">COPY</span> cdi-exporter.ps1 ./cdi-exporter.ps1
</span><span class="z-source z-dockerfile"><span class="z-keyword z-operator z-dockerfile">CMD </span>[<span class="z-string z-quoted z-double z-dockerfile"><span class="z-punctuation z-definition z-string z-begin z-dockerfile">"</span>pwsh<span class="z-punctuation z-definition z-string z-end z-dockerfile">"</span></span>, <span class="z-string z-quoted z-double z-dockerfile"><span class="z-punctuation z-definition z-string z-begin z-dockerfile">"</span>-File<span class="z-punctuation z-definition z-string z-end z-dockerfile">"</span></span>, <span class="z-string z-quoted z-double z-dockerfile"><span class="z-punctuation z-definition z-string z-begin z-dockerfile">"</span>cdi-exporter.ps1<span class="z-punctuation z-definition z-string z-end z-dockerfile">"</span></span>]
</span><span class="z-source z-dockerfile"><span class=z-invalid>' | Out-File -FilePath dockerfile</span>
</span></code></pre><p><code>docker build -t cdi-exporter .</code> <br> <code>docker run -d -v /mnt/c:/mnt/c --name cdi-exporter cdi-exporter</code><ol start=6><li>Собираем стек из шлюза и скрипта в <code>compose</code>:</ol><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">Write-Output '</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">services</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">cdi-exporter</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">build</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">context</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-float z-decimal z-yaml"><span class="z-punctuation z-separator z-decimal z-yaml">.</span></span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">dockerfile</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">dockerfile</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">container_name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">cdi-exporter</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">volumes</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">/mnt/c:/mnt/c</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">restart</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">unless-stopped</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">pushgateway</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">image</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">prom/pushgateway</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">container_name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">pushgateway</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ports</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>19091:9091<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">restart</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">unless-stopped</span>
</span><span class="z-source z-yaml"><span class="z-string z-quoted z-single z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">'</span> | Out-File -FilePath docker-compose.yml
</span></span></code></pre><p><code>docker-compose up -d</code><ol start=7><li>Настраиваем <code>Dashboard</code> в <code>Grafana</code>:</ol><p>Переменные для фильтрации запроса: <br> hostName: <code>label_values(exported_instance)</code> <br> diskName: <code>label_values(disk)</code> <br> Метрика температуры: <code>disk_temperature{exported_instance="$hostName", disk=~"$diskName"}</code><h1 id=zabbix><a aria-label="Anchor link for: zabbix" class=zola-anchor href=#zabbix><i class=icon></i></a> Zabbix</h1><h2 id=zabbix-agent><a aria-label="Anchor link for: zabbix-agent" class=zola-anchor href=#zabbix-agent><i class=icon></i></a> Zabbix Agent</h2><p><strong>Zabbix Agent Deploy:</strong><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>url</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>https://cdn.zabbix.com/zabbix/binaries/stable/6.4/6.4.5/zabbix_agent2-6.4.5-windows-amd64-static.zip<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Downloads\zabbix-agent2-6.4.5.zip<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>WebClient</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> System.Net.WebClient
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>WebClient<span class="z-variable z-other z-member z-powershell">.DownloadFile</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>url</span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> скачать файл<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Expand-Archive</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>DestinationPath <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>C:\zabbix-agent2-6.4.5\<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> разархивировать<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Remove-Item</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path</span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> удалить архив<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">New-NetFirewallRule</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>DisplayName <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Zabbix-Agent<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Profile Any <span class="z-keyword z-operator z-assignment z-powershell">-</span>Direction Inbound <span class="z-keyword z-operator z-assignment z-powershell">-</span>Action Allow <span class="z-keyword z-operator z-assignment z-powershell">-</span>Protocol TCP <span class="z-keyword z-operator z-assignment z-powershell">-</span>LocalPort <span class="z-constant z-numeric z-integer z-powershell">10050</span><span class="z-keyword z-operator z-other z-powershell">,</span><span class="z-constant z-numeric z-integer z-powershell">10051</span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> открыть порты в FW<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Zabbix_Server</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>192.168.3.102<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>conf</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>C:\zabbix-agent2-6.4.5\conf\zabbix_agent2.conf<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cat</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> cat <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>conf</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>rep</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cat</span> <span class="z-keyword z-operator z-comparison z-powershell">-replace</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Server=.+<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-other z-powershell">,</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Server=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Zabbix_Server</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>rep</span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-support z-function z-powershell">Select-String</span> Server<span class="z-keyword z-operator z-assignment z-powershell">=</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>rep</span> <span class="z-keyword z-operator z-redirection z-powershell">></span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>conf</span>
</span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>exe</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>C:\zabbix-agent2-6.4.5\bin\zabbix_agent2.exe<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell">.<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>exe</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span><span class="z-keyword z-operator z-assignment z-powershell">-</span>config <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>conf</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span><span class="z-keyword z-operator z-assignment z-powershell">-</span>install <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> установить службу<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Get-Service</span> <span class="z-keyword z-operator z-assignment z-powershell">*</span>Zabbix<span class="z-keyword z-operator z-assignment z-powershell">*</span>Agent<span class="z-keyword z-operator z-assignment z-powershell">*</span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-support z-function z-powershell">Start-Service</span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> запустить службу<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span>.$exe --config $conf --uninstall # удалить службу<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></code></pre><p><strong>zabbix_agent2.conf</strong><pre class="language-conf z-code" data-lang=conf><code class=language-conf data-lang=conf><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># Агент может работать в пассивном (сервер забирает сам информацию) и активном режиме (агент сам отправляет):
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">Server</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-meta z-ip z-genconfig"><span class="z-constant z-other z-genconfig">192.168.3.102</span></span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">ServerActive</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-meta z-ip z-genconfig"><span class="z-constant z-other z-genconfig">192.168.3.102</span></span>
</span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># Требуется указать hostname для ServerActive:
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">Hostname</span><span class="z-keyword z-operator z-genconfig">=</span></span>huawei<span class="z-keyword z-operator z-genconfig">-</span>book<span class="z-keyword z-operator z-genconfig">-</span><span class="z-constant z-numeric z-genconfig">01</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># Если не указано, используется для генерации имени хоста (игнорируется, если имя хоста определено):
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># HostnameItem=system.hostname
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># Как часто обновляется список активных проверок, в секундах (Range: 60-3600):
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">RefreshActiveChecks</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-numeric z-genconfig">120</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># IP-адрес источника для исходящих соединений:
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># SourceIP=
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># Агент будет слушать на этом порту соединения с сервером (Range: 1024-32767):
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># ListenPort=10050
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># Список IP-адресов, которые агент должен прослушивать через запятую
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># ListenIP=0.0.0.0
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># Агент будет прослушивать этот порт для запросов статуса HTTP (Range: 1024-32767):
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># StatusPort=
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">ControlSocket</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-keyword z-operator z-genconfig">\</span><span class="z-keyword z-operator z-genconfig">\</span><span class="z-keyword z-operator z-genconfig">.</span><span class="z-keyword z-operator z-genconfig">\</span>pipe<span class="z-keyword z-operator z-genconfig">\</span>agent<span class="z-keyword z-operator z-genconfig">.</span>sock
</span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># Куда вести журнал (file/syslog/console):
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">LogType</span><span class="z-keyword z-operator z-genconfig">=</span></span>file
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">LogFile</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-support z-constant z-genconfig">C</span><span class="z-keyword z-operator z-genconfig">:</span><span class="z-keyword z-operator z-genconfig">\</span>zabbix<span class="z-keyword z-operator z-genconfig">-</span>agent2<span class="z-keyword z-operator z-genconfig">-</span><span class="z-constant z-numeric z-genconfig">6</span><span class="z-keyword z-operator z-genconfig">.</span><span class="z-constant z-numeric z-genconfig">4</span><span class="z-keyword z-operator z-genconfig">.</span><span class="z-constant z-numeric z-genconfig">5</span><span class="z-keyword z-operator z-genconfig">\</span>zabbix_agent2<span class="z-keyword z-operator z-genconfig">.</span>log
</span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># Размер лога от 0-1024 MB (0 - отключить автоматическую ротацию логов)
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">LogFileSize</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-numeric z-genconfig">100</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># Уровень логирования. 4 - для отладки (выдает много информации)
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">DebugLevel</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-numeric z-genconfig">4</span>
</span></code></pre><h2 id=zabbix-sender><a aria-label="Anchor link for: zabbix-sender" class=zola-anchor href=#zabbix-sender><i class=icon></i></a> Zabbix Sender</h2><p>Используется для отправки данных на сервер<p>Создать host - задать произвольное имя (powershell-host) и добавить в группу на сервере<p>Создать Items вручную:<p><code>Name</code>: Service Count <br> <code>Type</code>: Zabbix trapper <br> <code>Key</code>: service.count <br> <code>Type of Information</code>: Numeric<pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>C:\zabbix-agent2-6.4.5\bin<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>scount</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">Get-Service</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.Count
</span><span class="z-source z-powershell">.<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path</span>\<span class="z-support z-function z-powershell">zabbix_sender.exe</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>z <span class="z-constant z-numeric z-integer z-powershell">192.168</span>.<span class="z-constant z-numeric z-integer z-powershell">3.102</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>s <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>powershell-host<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>k service.count <span class="z-keyword z-operator z-assignment z-powershell">-</span>o <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>scount</span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> отправить данные на сервер<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></code></pre><h2 id=zabbix-get><a aria-label="Anchor link for: zabbix-get" class=zola-anchor href=#zabbix-get><i class=icon></i></a> Zabbix Get</h2><p>Используется для получения данных с агента (как их запрашивает сервер)<p><code>apt install zabbix-get</code> <br> <code>nano /etc/zabbix/zabbix_agentd.conf</code> <br> <code>Server=127.0.0.1,192.168.3.102,192.168.3.99</code> добавить сервера для получения данных через zabbix_get с агента (как их запрашивает сервер)<p><code>.$path\zabbix_get -s 192.168.3.101 -p 10050 -k agent.version</code> проверить версию агента <br> <code>.$path\zabbix_get -s 192.168.3.101 -p 10050 -k agent.ping</code> 1 - ok <br> <code>.$path\zabbix_get -s 192.168.3.101 -p 10050 -k net.if.discovery</code> список сетевых интерфейсов <br> <code>.$path\zabbix_get -s 192.168.3.101 -p 10050 -k net.if.in["ens33"]</code> <br> <code>.$path\zabbix_get -s 192.168.3.101 -p 10050 -k net.if.out["ens33"]</code><h2 id=userparameter><a aria-label="Anchor link for: userparameter" class=zola-anchor href=#userparameter><i class=icon></i></a> UserParameter</h2><p>Пользовательские параметры<p><code>UserParameter=process.count,powershell -Command "(Get-Process).Count"</code> <br> <code>UserParameter=process.vm[*],powershell -Command "(Get-Process $1).ws"</code><p>Получение данных:<p><code>C:\zabbix-agent2-6.4.5\bin\zabbix_get.exe -s 127.0.0.1 -p 10050 -k process.count</code> <br> <code>C:\zabbix-agent2-6.4.5\bin\zabbix_get.exe -s 127.0.0.1 -p 10050 -k process.vm[zabbix_agent2] </code><br> <code>C:\zabbix-agent2-6.4.5\bin\zabbix_get.exe -s 127.0.0.1 -p 10050 -k process.vm[powershell]</code><p>Создать новые Items на сервере:<p>key: <code>process.count</code> <br> key: <code>process.vm[zabbix_agent2]</code><h2 id=include-plugins><a aria-label="Anchor link for: include-plugins" class=zola-anchor href=#include-plugins><i class=icon></i></a> Include Plugins</h2><ul><li>Добавить параметр Include для включения конфигурационных файлов подключаемых плагинов</ul><p><code>'Include=.\zabbix_agent2.d\plugins.d\*.conf' >> C:\zabbix-agent2-6.4.5\conf\zabbix_agent2.conf</code><ul><li>Создать конфигурационный файл с пользовательскими параметрами в каталоге, путь к которому указан в zabbix_agentd.conf</ul><p><code>'UserParameter=Get-Query-Param[*],powershell.exe -noprofile -executionpolicy bypass -File C:\zabbix-agent2-6.4.5\conf\zabbix_agent2.d\scripts\User-Sessions\Get-Query-Param.ps1 $1' > C:\zabbix-agent2-6.4.5\conf\zabbix_agent2.d\plugins.d\User-Sessions.conf</code><ul><li>Поместить скрипт Get-Query-Param.ps1 в каталог, путь к которому указан в User-Sessions.conf. Скрипт содержим пользовательские параметры, которые он принимает от Zabbix сервера для передачи их в функции скрипта.</ul><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">Param</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">string</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>select</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">if</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>select</span> <span class="z-keyword z-operator z-comparison z-powershell">-eq</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>ACTIVEUSER<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">Get-Query</span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-keyword z-control z-powershell">where</span> status <span class="z-keyword z-operator z-comparison z-powershell">-match</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Active<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.User
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">if</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>select</span> <span class="z-keyword z-operator z-comparison z-powershell">-eq</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>INACTIVEUSER<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">Get-Query</span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-keyword z-control z-powershell">where</span> status <span class="z-keyword z-operator z-comparison z-powershell">-match</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Disconnect<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.User
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">if</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>select</span> <span class="z-keyword z-operator z-comparison z-powershell">-eq</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>ACTIVECOUNT<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">Get-Query</span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-keyword z-control z-powershell">where</span> status <span class="z-keyword z-operator z-comparison z-powershell">-match</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Active<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.Status.Count
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">if</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>select</span> <span class="z-keyword z-operator z-comparison z-powershell">-eq</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>INACTIVECOUNT<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">Get-Query</span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-keyword z-control z-powershell">where</span> status <span class="z-keyword z-operator z-comparison z-powershell">-match</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Disconnect<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.Status.Count
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></code></pre><ul><li>Проверить работу скрипта:</ul><p><code>$path = "C:\zabbix-agent2-6.4.5\conf\zabbix_agent2.d\scripts\User-Sessions"</code> <br> <code>.$path\Get-Query-Param.ps1 ACTIVEUSER</code> <br> <code>.$path\Get-Query-Param.ps1 INACTIVEUSER</code> <br> <code>.$path\Get-Query-Param.ps1 ACTIVECOUNT</code> <br> <code>.$path\Get-Query-Param.ps1 INACTIVECOUNT</code><ul><li>Создать Items с ключами:</ul><p><code>Get-Query-Param[ACTIVEUSER]</code> Type: Text <br> <code>Get-Query-Param[INACTIVEUSER]</code> Type: Text <br> <code>Get-Query-Param[ACTIVECOUNT]</code> Type: Int <br> <code>Get-Query-Param[INACTIVECOUNT]</code> Type: Int<ul><li>Макросы:</ul><p><code>{$ACTIVEMAX} = 16</code> <br> <code>{$ACTIVEMIN} = 0</code><ul><li>Триггеры:</ul><p><code>last(/Windows-User-Sessions/Get-Query-Param[ACTIVECOUNT])>{$ACTIVEMAX}</code> <br> <code>min(/Windows-User-Sessions/Get-Query-Param[ACTIVECOUNT],24h)={$ACTIVEMIN}</code><h2 id=zabbix-api><a aria-label="Anchor link for: zabbix-api" class=zola-anchor href=#zabbix-api><i class=icon></i></a> Zabbix API</h2><p><a href=https://www.zabbix.com/documentation/current/en/manual/api/reference>Documentation</a><p><code>$ip = "192.168.3.102"</code> <br> <code>$url = "http://$ip/zabbix/api_jsonrpc.php"</code><p>Получение токена доступа:<pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>data</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>jsonrpc<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>2.0<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-punctuation z-terminator z-statement z-powershell">;</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>method<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>user.login<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-punctuation z-terminator z-statement z-powershell">;</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>params<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-meta z-hashtable z-powershell">        <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>username<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Admin<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-punctuation z-terminator z-statement z-powershell">;</span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> в версии до 6.4 параметр "user"<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-meta z-hashtable z-powershell">        <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>password<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>zabbix<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-punctuation z-terminator z-statement z-powershell">;</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span><span class="z-punctuation z-terminator z-statement z-powershell">;</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>id<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-constant z-numeric z-integer z-powershell">1</span><span class="z-punctuation z-terminator z-statement z-powershell">;</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>token</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Method POST <span class="z-keyword z-operator z-assignment z-powershell">-</span>Uri <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>url</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Body <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>data</span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-support z-function z-powershell">ConvertTo-Json</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>ContentType <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>application/json<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.Result
</span></code></pre><p><code>$token = "2eefd25fdf1590ebcdb7978b5bcea1fff755c65b255da8cbd723181b639bb789"</code> сгенерировать токен в UI (http://192.168.3.102/zabbix/zabbix.php?action=token.list)<ul><li>user.get method</ul><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>data</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>jsonrpc<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>2.0<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-punctuation z-terminator z-statement z-powershell">;</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>method<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>user.get<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-punctuation z-terminator z-statement z-powershell">;</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>params<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span><span class="z-punctuation z-terminator z-statement z-powershell">;</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>auth<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>token</span><span class="z-punctuation z-terminator z-statement z-powershell">;</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>id<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-constant z-numeric z-integer z-powershell">1</span><span class="z-punctuation z-terminator z-statement z-powershell">;</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>users</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Method POST <span class="z-keyword z-operator z-assignment z-powershell">-</span>Uri <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>url</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Body <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>data</span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-support z-function z-powershell">ConvertTo-Json</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>ContentType <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>application/json<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.Result
</span></code></pre><ul><li>problem.get method</ul><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>data</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>jsonrpc<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>2.0<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-punctuation z-terminator z-statement z-powershell">;</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>method<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>problem.get<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-punctuation z-terminator z-statement z-powershell">;</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>params<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span><span class="z-punctuation z-terminator z-statement z-powershell">;</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>auth<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>token</span><span class="z-punctuation z-terminator z-statement z-powershell">;</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>id<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-constant z-numeric z-integer z-powershell">1</span><span class="z-punctuation z-terminator z-statement z-powershell">;</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Method POST <span class="z-keyword z-operator z-assignment z-powershell">-</span>Uri <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>url</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Body <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>data</span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-support z-function z-powershell">ConvertTo-Json</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>ContentType <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>application/json<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.Result
</span></code></pre><ul><li>host.get method</ul><p>Получить список всех хостов (имя и id)<p><a href=https://www.zabbix.com/documentation/current/en/manual/api/reference/host>Endpoint host documentation</a><p><strong>host.create</strong> — создание новых хостов <br> <strong>host.delete</strong> — удаление хостов <br> <strong>host.get</strong> — получить список хостов <br> <strong>host.massadd</strong> - добавление (привязка) объектов на хосты <br> <strong>host.massremove</strong> - удаление объектов <br> <strong>host.massupdate</strong> - замена или обновление объектов <br> <strong>host.update</strong> - обновление хостов<pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>data</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>jsonrpc<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>2.0<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-punctuation z-terminator z-statement z-powershell">;</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>method<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>host.get<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-punctuation z-terminator z-statement z-powershell">;</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>params<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-meta z-hashtable z-powershell">        <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>output<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-meta z-group z-array-expression z-powershell"><span class="z-keyword z-other z-array z-begin z-powershell">@</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> отфильтровать вывод<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-meta z-group z-array-expression z-powershell">            <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>hostid<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-punctuation z-terminator z-statement z-powershell">;</span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-meta z-group z-array-expression z-powershell">            <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>host<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-punctuation z-terminator z-statement z-powershell">;</span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-meta z-group z-array-expression z-powershell">        <span class="z-punctuation z-section z-group z-end z-powershell">)</span></span><span class="z-punctuation z-terminator z-statement z-powershell">;</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span><span class="z-punctuation z-terminator z-statement z-powershell">;</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>id<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-constant z-numeric z-integer z-powershell">2</span><span class="z-punctuation z-terminator z-statement z-powershell">;</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>auth<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>token</span><span class="z-punctuation z-terminator z-statement z-powershell">;</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>hosts</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Method POST <span class="z-keyword z-operator z-assignment z-powershell">-</span>Uri <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>url</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Body <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>data</span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-support z-function z-powershell">ConvertTo-Json</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>ContentType <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>application/json<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.Result
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>host_id</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>hosts</span><span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-constant z-numeric z-integer z-powershell">3</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>.hostid <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> забрать id хоста по индексу<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></code></pre><ul><li>item.get</ul><p>Получить id элементов данных по наименованию ключа для конкретного хоста<pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>data</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>jsonrpc<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>2.0<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-punctuation z-terminator z-statement z-powershell">;</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>method<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>item.get<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-punctuation z-terminator z-statement z-powershell">;</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>params<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-meta z-hashtable z-powershell">        <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>hostids<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-meta z-group z-array-expression z-powershell"><span class="z-keyword z-other z-array z-begin z-powershell">@</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>host_id</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span><span class="z-punctuation z-terminator z-statement z-powershell">;</span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> отфильтровать по хосту<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span><span class="z-punctuation z-terminator z-statement z-powershell">;</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>auth<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>token</span><span class="z-punctuation z-terminator z-statement z-powershell">;</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>id<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-constant z-numeric z-integer z-powershell">1</span><span class="z-punctuation z-terminator z-statement z-powershell">;</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>items</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Method POST <span class="z-keyword z-operator z-assignment z-powershell">-</span>Uri <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>url</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Body <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>data</span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-support z-function z-powershell">ConvertTo-Json</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>ContentType <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>application/json<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.Result
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>items_id</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>items</span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-keyword z-control z-powershell">where</span> key_ <span class="z-keyword z-operator z-comparison z-powershell">-match</span> system.uptime</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.itemid <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> забрать id элемента данных<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></code></pre><ul><li>history.get</ul><p>Получить всю историю элемента данных по его id<pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>data</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>jsonrpc<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>2.0<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-punctuation z-terminator z-statement z-powershell">;</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>method<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>history.get<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-punctuation z-terminator z-statement z-powershell">;</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>params<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-meta z-hashtable z-powershell">        <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>hostids<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-meta z-group z-array-expression z-powershell"><span class="z-keyword z-other z-array z-begin z-powershell">@</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>host_id</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span><span class="z-punctuation z-terminator z-statement z-powershell">;</span>  <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> фильтрация по хосту<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-meta z-hashtable z-powershell">        <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>itemids<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-meta z-group z-array-expression z-powershell"><span class="z-keyword z-other z-array z-begin z-powershell">@</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>items_id</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span><span class="z-punctuation z-terminator z-statement z-powershell">;</span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> фильтрация по элементу данных<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span><span class="z-punctuation z-terminator z-statement z-powershell">;</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>auth<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>token</span><span class="z-punctuation z-terminator z-statement z-powershell">;</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>id<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-constant z-numeric z-integer z-powershell">1</span><span class="z-punctuation z-terminator z-statement z-powershell">;</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>items_data_uptime</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Method POST <span class="z-keyword z-operator z-assignment z-powershell">-</span>Uri <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>url</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Body <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>data</span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-support z-function z-powershell">ConvertTo-Json</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>ContentType <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>application/json<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.Result <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> получить все данные по ключу у конкретного хоста<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></code></pre><p>Ковенртация секунд в <code>TimeSpan</code>:<p><code>$sec = $items_data_uptime.value</code><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-meta z-function z-powershell"><span class="z-storage z-type z-powershell">function</span> <span class="z-entity z-name z-function z-powershell">ConvertSecondsTo-TimeSpan</span></span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-keyword z-control z-powershell">param</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-interpolated z-simple z-source z-powershell">        <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>insec</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-interpolated z-simple z-source z-powershell">    </span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>TimeSpan</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">TimeSpan</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::fromseconds<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>insec</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>{0:dd' day 'hh\:mm\:ss}<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-string-format z-powershell">-f</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>TimeSpan</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></code></pre><p><code>$UpTime = ConvertSecondsTo-TimeSpan $sec[-1]</code><p>Конвертация из времени <code>Unix</code>:<p><code>$time = $items_data_uptime.clock</code><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-meta z-function z-powershell"><span class="z-storage z-type z-powershell">function</span> <span class="z-entity z-name z-function z-powershell">ConvertFrom-UnixTime</span></span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-keyword z-control z-powershell">param</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-interpolated z-simple z-source z-powershell">        <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>intime</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-interpolated z-simple z-source z-powershell">    </span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>EpochTime</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">DateTime</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>1/1/1970<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>TimeZone</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">Get-TimeZone</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>UTCTime</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>EpochTime<span class="z-variable z-other z-member z-powershell">.AddSeconds</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>intime</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>UTCTime<span class="z-variable z-other z-member z-powershell">.AddMinutes</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>TimeZone<span class="z-variable z-other z-member z-powershell">.BaseUtcOffset.TotalMinutes</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></code></pre><p><code>$GetDataTime = ConvertFrom-UnixTime $time[-1]</code><p><code>($hosts | where hostid -eq $host_id).host</code> получить имя хоста <br> <code>$UpTime</code> последнее полученное значение времени работы хоста <br> <code>$GetDataTime</code> время последнего полученного значения<h1 id=load-testing><a aria-label="Anchor link for: load-testing" class=zola-anchor href=#load-testing><i class=icon></i></a> Load Testing</h1><h2 id=apache-benchmark><a aria-label="Anchor link for: apache-benchmark" class=zola-anchor href=#apache-benchmark><i class=icon></i></a> Apache Benchmark</h2><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>HOME</span>\Downloads\apache<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">New-Item</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Type Directory
</span><span class="z-source z-powershell">cd <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path</span>
</span><span class="z-source z-powershell">curl <span class="z-keyword z-operator z-assignment z-powershell">-</span>L <span class="z-keyword z-operator z-assignment z-powershell">-</span>o apache.zip <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>https://www.apachelounge.com/download/VS17/binaries/httpd-2.4.63-250207-win64-VS17.zip<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Expand-Archive</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Path apache.zip
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Copy-Item</span> .\Apache24\bin\ <span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>HOME</span>\Documents\apache\ <span class="z-keyword z-operator z-assignment z-powershell">-</span>Recurse
</span><span class="z-source z-powershell">cd .<span class="z-keyword z-operator z-other z-powershell">.</span> <span class="z-punctuation z-terminator z-statement z-powershell">&&</span> <span class="z-support z-function z-powershell">Remove-Item</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>HOME</span>\Downloads\apache<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Recurse
</span></code></pre><p><code>$ab = "$HOME\Documents\apache\ab.exe"</code> <br> <code>. $ab -n 10000 -c 100 http://192.168.3.100:8444/api/provider/list</code><pre class=z-code><code><span class="z-text z-plain">Количество одновременных запросов:  100
</span><span class="z-text z-plain">Время проведения тестов:            52,402 секунды
</span><span class="z-text z-plain">Выполненные запросы:                10000
</span><span class="z-text z-plain">Неудачные запросы:                  0
</span><span class="z-text z-plain">Передано всего:                     6830000 байтов
</span><span class="z-text z-plain">Передано HTML:                      3290000 байт
</span><span class="z-text z-plain">RPS (Requests Per Second):          190,83 [#/sec] (среднее)
</span><span class="z-text z-plain">Время одного запроса:               524.017 [MS] (среднее)
</span><span class="z-text z-plain">Время одного запроса:               5.240 [MS] (среднее, во всех одновременных запросах)
</span><span class="z-text z-plain">Скорость передачи:                  127,28 [Kbytes/Sec]
</span></code></pre><h2 id=locust><a aria-label="Anchor link for: locust" class=zola-anchor href=#locust><i class=icon></i></a> Locust</h2><p><a href=https://github.com/locustio/locust>Locust</a> - это инструмент нагрузочного тестирования для <code>HTTP</code> и других протоколов на <code>Python</code>.<p><code>pip3 install locust</code><pre class="language-Python z-code" data-lang=Python><code class=language-Python data-lang=Python><span class="z-source z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">echo</span></span> <span class="z-meta z-string z-python"><span class="z-string z-quoted z-single z-python"><span class="z-punctuation z-definition z-string z-begin z-python">'</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-single z-python"><span class="z-invalid z-illegal z-unclosed-string z-python">
</span></span></span></span><span class="z-source z-python"><span class="z-meta z-statement z-import z-python"><span class="z-keyword z-control z-import z-python">import</span> <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">os</span></span></span>
</span><span class="z-source z-python"><span class="z-meta z-statement z-import z-python"><span class="z-keyword z-control z-import z-from z-python">from</span></span><span class="z-meta z-statement z-import z-python"><span class="z-meta z-import-source z-python"> <span class="z-meta z-import-path z-python"><span class="z-meta z-import-name z-python">locust</span></span> <span class="z-meta z-statement z-import z-python"><span class="z-keyword z-control z-import z-python">import</span></span></span></span><span class="z-meta z-statement z-import z-python"></span><span class="z-meta z-statement z-import z-python"> <span class="z-meta z-generic-name z-python">HttpUser</span><span class="z-punctuation z-separator z-import-list z-python">,</span> <span class="z-meta z-generic-name z-python">task</span><span class="z-punctuation z-separator z-import-list z-python">,</span> <span class="z-meta z-generic-name z-python">between</span></span>
</span><span class="z-source z-python"><span class="z-meta z-class z-python"><span class="z-storage z-type z-class z-python"><span class="z-keyword z-declaration z-class z-python">class</span></span> <span class="z-entity z-name z-class z-python"><span class="z-meta z-generic-name z-python">TorApiUser</span></span><span class="z-meta z-class z-inheritance z-python"><span class="z-punctuation z-section z-inheritance z-begin z-python">(</span></span></span><span class="z-meta z-class z-inheritance z-python"><span class="z-entity z-other z-inherited-class z-python">HttpUser</span><span class="z-punctuation z-section z-inheritance z-end z-python">)</span></span><span class="z-meta z-class z-python"><span class="z-punctuation z-section z-class z-begin z-python">:</span></span>
</span><span class="z-source z-python">    <span class="z-comment z-line z-number-sign z-python"><span class="z-punctuation z-definition z-comment z-python">#</span> Каждый виртуальный пользователь будет ждать от 2 до 5 секунд перед выполнением следующего @task
</span></span><span class="z-source z-python">    <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">wait_time</span></span> <span class="z-keyword z-operator z-assignment z-python">=</span> <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-meta z-generic-name z-python">between</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-constant z-numeric z-integer z-decimal z-python">2</span><span class="z-punctuation z-separator z-arguments z-python">,</span> <span class="z-constant z-numeric z-integer z-decimal z-python">5</span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span><span class="z-source z-python">    <span class="z-comment z-line z-number-sign z-python"><span class="z-punctuation z-definition z-comment z-python">#</span> Определяем заголовки запросов
</span></span><span class="z-source z-python">    <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">headers</span></span> <span class="z-keyword z-operator z-assignment z-python">=</span> <span class="z-meta z-mapping-or-set z-python"><span class="z-punctuation z-section z-mapping-or-set z-begin z-python">{</span>
</span></span><span class="z-source z-python"><span class="z-meta z-mapping-or-set z-python"></span><span class="z-meta z-mapping z-python">        </span><span class="z-meta z-mapping z-key z-python"><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python"><span class="z-punctuation z-definition z-string z-begin z-python">"</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python">User-Agent<span class="z-punctuation z-definition z-string z-end z-python">"</span></span></span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-key-value z-python">:</span></span><span class="z-meta z-mapping z-python"> </span><span class="z-meta z-mapping z-value z-python"><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python"><span class="z-punctuation z-definition z-string z-begin z-python">"</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python">Locust<span class="z-punctuation z-definition z-string z-end z-python">"</span></span></span>
</span></span><span class="z-source z-python"><span class="z-meta z-mapping z-value z-python"></span><span class="z-meta z-mapping z-python">    <span class="z-punctuation z-section z-mapping z-end z-python">}</span></span>
</span><span class="z-source z-python">    <span class="z-comment z-line z-number-sign z-python"><span class="z-punctuation z-definition z-comment z-python">#</span> Получаем параметры из переменных окружения или использовать значение по умолчанию
</span></span><span class="z-source z-python">    <span class="z-meta z-qualified-name z-python"><span class="z-variable z-other z-constant z-python">QUERY</span></span> <span class="z-keyword z-operator z-assignment z-python">=</span> <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">os</span></span><span class="z-meta z-qualified-name z-python"><span class="z-punctuation z-accessor z-dot z-python">.</span></span><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-meta z-generic-name z-python">getenv</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python"><span class="z-punctuation z-definition z-string z-begin z-python">"</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python">QUERY<span class="z-punctuation z-definition z-string z-end z-python">"</span></span></span><span class="z-punctuation z-separator z-arguments z-python">,</span> <span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python"><span class="z-punctuation z-definition z-string z-begin z-python">"</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python">test<span class="z-punctuation z-definition z-string z-end z-python">"</span></span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span><span class="z-source z-python">    <span class="z-comment z-line z-number-sign z-python"><span class="z-punctuation z-definition z-comment z-python">#</span> GET запросы (вес приоритета задачи для частоты ее выполнения, чем выше, тем чаще выполнение)
</span></span><span class="z-source z-python">    <span class="z-meta z-annotation z-python"><span class="z-punctuation z-definition z-annotation z-python">@</span><span class="z-meta z-annotation z-function z-python"></span></span><span class="z-meta z-annotation z-function z-python"><span class="z-meta z-qualified-name z-python"><span class="z-variable z-annotation z-function z-python"><span class="z-meta z-generic-name z-python">task</span></span></span></span><span class="z-meta z-annotation z-function z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span></span><span class="z-meta z-annotation z-arguments z-python"><span class="z-constant z-numeric z-integer z-decimal z-python">1</span></span><span class="z-meta z-annotation z-function z-python"><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span><span class="z-source z-python"><span class="z-meta z-function z-python">    <span class="z-storage z-type z-function z-python"><span class="z-keyword z-declaration z-function z-python">def</span></span> <span class="z-entity z-name z-function z-python"><span class="z-meta z-generic-name z-python">test_status</span></span></span><span class="z-meta z-function z-parameters z-python"><span class="z-punctuation z-section z-parameters z-begin z-python">(</span></span><span class="z-meta z-function z-parameters z-python"><span class="z-variable z-parameter z-python">self</span><span class="z-punctuation z-section z-parameters z-end z-python">)</span></span><span class="z-meta z-function z-python"><span class="z-punctuation z-section z-function z-begin z-python">:</span></span>
</span><span class="z-source z-python">        <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-variable z-language z-python">self</span><span class="z-punctuation z-accessor z-dot z-python">.</span><span class="z-meta z-generic-name z-python">client</span></span><span class="z-meta z-qualified-name z-python"><span class="z-punctuation z-accessor z-dot z-python">.</span></span><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-meta z-generic-name z-python">get</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python"><span class="z-punctuation z-definition z-string z-begin z-python">"</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python">/api/provider/list<span class="z-punctuation z-definition z-string z-end z-python">"</span></span></span><span class="z-punctuation z-separator z-arguments z-python">,</span> <span class="z-variable z-parameter z-python">headers</span><span class="z-keyword z-operator z-assignment z-python">=</span><span class="z-meta z-qualified-name z-python"><span class="z-variable z-language z-python">self</span><span class="z-punctuation z-accessor z-dot z-python">.</span><span class="z-meta z-generic-name z-python">headers</span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span><span class="z-source z-python">    <span class="z-meta z-annotation z-python"><span class="z-punctuation z-definition z-annotation z-python">@</span><span class="z-meta z-annotation z-function z-python"></span></span><span class="z-meta z-annotation z-function z-python"><span class="z-meta z-qualified-name z-python"><span class="z-variable z-annotation z-function z-python"><span class="z-meta z-generic-name z-python">task</span></span></span></span><span class="z-meta z-annotation z-function z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span></span><span class="z-meta z-annotation z-arguments z-python"><span class="z-constant z-numeric z-integer z-decimal z-python">2</span></span><span class="z-meta z-annotation z-function z-python"><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span><span class="z-source z-python"><span class="z-meta z-function z-python">    <span class="z-storage z-type z-function z-python"><span class="z-keyword z-declaration z-function z-python">def</span></span> <span class="z-entity z-name z-function z-python"><span class="z-meta z-generic-name z-python">test_search</span></span></span><span class="z-meta z-function z-parameters z-python"><span class="z-punctuation z-section z-parameters z-begin z-python">(</span></span><span class="z-meta z-function z-parameters z-python"><span class="z-variable z-parameter z-python">self</span><span class="z-punctuation z-section z-parameters z-end z-python">)</span></span><span class="z-meta z-function z-python"><span class="z-punctuation z-section z-function z-begin z-python">:</span></span>
</span><span class="z-source z-python">        <span class="z-comment z-line z-number-sign z-python"><span class="z-punctuation z-definition z-comment z-python">#</span> Словарь параметров, который автоматически конвертируется в строку запроса (?key=value&key2=value2)
</span></span><span class="z-source z-python">        <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">searchParams</span></span> <span class="z-keyword z-operator z-assignment z-python">=</span> <span class="z-meta z-mapping-or-set z-python"><span class="z-punctuation z-section z-mapping-or-set z-begin z-python">{</span>
</span></span><span class="z-source z-python"><span class="z-meta z-mapping-or-set z-python"></span><span class="z-meta z-mapping z-python">            </span><span class="z-meta z-mapping z-key z-python"><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python"><span class="z-punctuation z-definition z-string z-begin z-python">"</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python">query<span class="z-punctuation z-definition z-string z-end z-python">"</span></span></span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-key-value z-python">:</span></span><span class="z-meta z-mapping z-python"> </span><span class="z-meta z-mapping z-value z-python"><span class="z-meta z-set z-python"><span class="z-punctuation z-section z-set z-begin z-python">{</span><span class="z-meta z-qualified-name z-python"><span class="z-variable z-language z-python">self</span><span class="z-punctuation z-accessor z-dot z-python">.</span><span class="z-variable z-other z-constant z-python">QUERY</span></span><span class="z-punctuation z-section z-set z-end z-python">}</span></span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-python">,</span>
</span></span><span class="z-source z-python"><span class="z-meta z-mapping z-python">            </span><span class="z-meta z-mapping z-key z-python"><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python"><span class="z-punctuation z-definition z-string z-begin z-python">"</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python">category<span class="z-punctuation z-definition z-string z-end z-python">"</span></span></span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-key-value z-python">:</span></span><span class="z-meta z-mapping z-python"> </span><span class="z-meta z-mapping z-value z-python"><span class="z-constant z-numeric z-integer z-decimal z-python">0</span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-python">,</span>
</span></span><span class="z-source z-python"><span class="z-meta z-mapping z-python">            </span><span class="z-meta z-mapping z-key z-python"><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python"><span class="z-punctuation z-definition z-string z-begin z-python">"</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python">page<span class="z-punctuation z-definition z-string z-end z-python">"</span></span></span></span><span class="z-meta z-mapping z-python"><span class="z-punctuation z-separator z-mapping z-key-value z-python">:</span></span><span class="z-meta z-mapping z-python"> </span><span class="z-meta z-mapping z-value z-python"><span class="z-constant z-numeric z-integer z-decimal z-python">0</span>
</span></span><span class="z-source z-python"><span class="z-meta z-mapping z-value z-python"></span><span class="z-meta z-mapping z-python">        <span class="z-punctuation z-section z-mapping z-end z-python">}</span></span>
</span><span class="z-source z-python">        <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-variable z-language z-python">self</span><span class="z-punctuation z-accessor z-dot z-python">.</span><span class="z-meta z-generic-name z-python">client</span></span><span class="z-meta z-qualified-name z-python"><span class="z-punctuation z-accessor z-dot z-python">.</span></span><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-meta z-generic-name z-python">get</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python"><span class="z-punctuation z-definition z-string z-begin z-python">"</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python">/api/search/title/rutracker<span class="z-punctuation z-definition z-string z-end z-python">"</span></span></span><span class="z-punctuation z-separator z-arguments z-python">,</span> <span class="z-variable z-parameter z-python">headers</span><span class="z-keyword z-operator z-assignment z-python">=</span><span class="z-meta z-qualified-name z-python"><span class="z-variable z-language z-python">self</span><span class="z-punctuation z-accessor z-dot z-python">.</span><span class="z-meta z-generic-name z-python">headers</span></span><span class="z-punctuation z-separator z-arguments z-python">,</span> <span class="z-variable z-parameter z-python">params</span><span class="z-keyword z-operator z-assignment z-python">=</span><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">searchParams</span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span><span class="z-source z-python">    <span class="z-comment z-line z-number-sign z-python"><span class="z-punctuation z-definition z-comment z-python">#</span> POST запрос с телом запроса
</span></span><span class="z-source z-python">    <span class="z-comment z-line z-number-sign z-python"><span class="z-punctuation z-definition z-comment z-python">#</span> @task(3)
</span></span><span class="z-source z-python">    <span class="z-comment z-line z-number-sign z-python"><span class="z-punctuation z-definition z-comment z-python">#</span> def test_post_auth(self):
</span></span><span class="z-source z-python">    <span class="z-comment z-line z-number-sign z-python"><span class="z-punctuation z-definition z-comment z-python">#</span>     self.client.post("/api/auth", json={"username": "admin", "password": "password"})
</span></span><span class="z-source z-python"><span class="z-meta z-string z-python"><span class="z-string z-quoted z-single z-python"><span class="z-punctuation z-definition z-string z-begin z-python">'</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-single z-python"> > locustfile.py<span class="z-invalid z-illegal z-unclosed-string z-python">
</span></span></span></span></code></pre><p><code>locust -f locustfile.py --host http://192.168.3.100:8444</code> <br> <code>$env:QUERY = "The+Rookie"</code> определяем переменную окружения для параметра запросов <br> <code>locust -f locustfile.py --host http://192.168.3.100:8444 -u 10 -r 2 -t 30s</code> количество виртуальных пользователей (VU), частота появления новых пользователей в секунду (10 пользователей будут созданы за 5 секунд) и длительность 30 секунд <br> <code>locust -f locustfile.py --host http://192.168.3.100:8444 -u 10 -r 2 -t 30s --headless --csv locustresult</code> запуск без веб-интерфейса с выгрузкой результатов в csv файлы<p>Запуск Web-интерфейса в контейнере Docker:<p><code>mkdir locust && cd locust</code><pre class="language-dockerfile z-code" data-lang=dockerfile><code class=language-dockerfile data-lang=dockerfile><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">FROM</span> alpine:<span class="z-entity z-name z-enum z-tag-digest">latest</span>
</span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">RUN </span>apk add --no-cache python3 py3-pip gcc musl-dev linux-headers python3-dev
</span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">RUN </span>python3 -m venv /venv
</span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">RUN </span>/venv/bin/pip install --no-cache-dir locust
</span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">ENV </span>PATH=<span class="z-string z-quoted z-double z-dockerfile"><span class="z-punctuation z-definition z-string z-begin z-dockerfile">"</span>/venv/bin:$PATH<span class="z-punctuation z-definition z-string z-end z-dockerfile">"</span></span>
</span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">COPY</span> locustfile.py .
</span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">EXPOSE </span>8089
</span><span class="z-source z-dockerfile"><span class="z-keyword z-operator z-dockerfile">CMD </span>[<span class="z-string z-quoted z-double z-dockerfile"><span class="z-punctuation z-definition z-string z-begin z-dockerfile">"</span>locust<span class="z-punctuation z-definition z-string z-end z-dockerfile">"</span></span>, <span class="z-string z-quoted z-double z-dockerfile"><span class="z-punctuation z-definition z-string z-begin z-dockerfile">"</span>-f<span class="z-punctuation z-definition z-string z-end z-dockerfile">"</span></span>, <span class="z-string z-quoted z-double z-dockerfile"><span class="z-punctuation z-definition z-string z-begin z-dockerfile">"</span>/locustfile.py<span class="z-punctuation z-definition z-string z-end z-dockerfile">"</span></span>]
</span></code></pre><p><code>sudo docker build -t locust-alpine-web . && sudo docker run -d --name locust -p 8089:8089 --restart=unless-stopped locust-alpine-web</code><h1 id=graylog><a aria-label="Anchor link for: graylog" class=zola-anchor href=#graylog><i class=icon></i></a> Graylog</h1><p><a href=https://hub.docker.com/r/itzg/graylog>Graylog Docker Image</a><ul><li>Установка MongoDB:</ul><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> run<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>name</span> mongo<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>d</span> mongo:3</span>
</span></code></pre><ul><li>Используем прокси для установки Elassticsearch:</ul><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> run<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>name</span> elasticsearch <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    -</span>e</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>http.host=0.0.0.0<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>e</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>xpack.security.enabled=false<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    -</span>d</span> dockerhub.timeweb.cloud/library/elasticsearch:5.5.1</span>
</span></code></pre><ul><li>Указать статический IP адрес для подключения к API</ul><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> run<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>name</span> Graylog <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>link</span> mongo <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>link</span> elasticsearch <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    -</span>p</span> 9000:9000<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span> 12201:12201<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span> 514:514<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span> 5044:5044 <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    -</span>e</span> GRAYLOG_WEB_ENDPOINT_URI=<span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>http://192.168.3.101:9000/api<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    -</span>d</span> graylog/graylog:2.3.2-1</span>
</span></code></pre><ul><li>Настройка syslog на клиенте Linux:</ul><p><code>nano /etc/rsyslog.d/graylog.conf</code><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">*.*</span></span><span class="z-meta z-function-call z-arguments z-shell"> @@192.168.3.101:514</span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">RSYSLOG_SyslogProtocol23Format</span></span>
</span></code></pre><p><code>systemctl restart rsyslog</code><ul><li>Создать входящий поток (inputs) для Syslog на порту 514 по протоколу TCP:</ul><p>http://192.168.3.101:9000/system/inputs<ul><li>Фильтр для логов Kinozal-Bot:</ul><p><code>facility:"system daemon" AND application_name:bash AND message:\[ AND message:\]</code><ul><li>Настройка Winlogbeat на клиенте Windows</ul><p>Установка агента:<pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell">irm https:<span class="z-keyword z-operator z-assignment z-powershell">/</span><span class="z-keyword z-operator z-assignment z-powershell">/</span>artifacts.elastic.co<span class="z-keyword z-operator z-assignment z-powershell">/</span>downloads<span class="z-keyword z-operator z-assignment z-powershell">/</span>beats<span class="z-keyword z-operator z-assignment z-powershell">/</span>winlogbeat<span class="z-keyword z-operator z-assignment z-powershell">/</span>winlogbeat<span class="z-keyword z-operator z-assignment z-powershell">-</span><span class="z-constant z-numeric z-integer z-powershell">8.15</span>.<span class="z-constant z-numeric z-integer z-powershell">0</span><span class="z-keyword z-operator z-assignment z-powershell">-</span>windows<span class="z-keyword z-operator z-assignment z-powershell">-</span>x86_64.zip <span class="z-keyword z-operator z-assignment z-powershell">-</span>OutFile <span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Documents\winlogbeat<span class="z-keyword z-operator z-assignment z-powershell">-</span><span class="z-constant z-numeric z-integer z-powershell">8.15</span>.<span class="z-constant z-numeric z-integer z-powershell">0.</span>zip
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Expand-Archive</span> <span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Documents\winlogbeat<span class="z-keyword z-operator z-assignment z-powershell">-</span><span class="z-constant z-numeric z-integer z-powershell">8.15</span>.<span class="z-constant z-numeric z-integer z-powershell">0.</span>zip
</span><span class="z-source z-powershell">cd <span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Documents\winlogbeat<span class="z-keyword z-operator z-assignment z-powershell">-</span><span class="z-constant z-numeric z-integer z-powershell">8.15</span>.<span class="z-constant z-numeric z-integer z-powershell">0</span><span class="z-keyword z-operator z-assignment z-powershell">-</span>windows<span class="z-keyword z-operator z-assignment z-powershell">-</span>x86_64
</span></code></pre><p>Добавить отправку в Logstash:<p><code>code winlogbeat.yml</code><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">output.logstash:</span></span>
</span><span class="z-source z-shell z-bash">  <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">hosts:</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>192.168.3.101:5044<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span><span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span></span>
</span></code></pre><p>И закомментировать отправку данных в Elasticsearch (output.elasticsearch)<p><code>.\winlogbeat.exe -c winlogbeat.yml</code> запустить агент с правами администратора в консоли<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">.<span class="z-constant z-character z-escape z-shell">\i</span>nstall-service-winlogbeat.ps1 <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> установить службу</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Get-Service</span></span><span class="z-meta z-function-call z-arguments z-shell"> winlogbeat</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Start-Service</span></span>
</span></code></pre><ul><li>Настроить Inputs для приема Beats на порту 5044</ul><span class=hidden id=copy-code-text>Copy Code</span><span class=hidden id=search-index>https://lifailon.github.io/search_index.en.json</span><span class=hidden id=more-matches-text>$MATCHES more matches</span></main><footer id=site-footer><nav><ul><li><a href=https://lifailon.github.io/powershell/>PowerShell</a><li><a href=https://lifailon.github.io/linux/>Linux</a><li><a href=https://lifailon.github.io/golang/>GoLang</a><li><a href=https://lifailon.github.io/node-js/>Node.js</a><li><a href=https://lifailon.github.io/docker/>Docker</a><li><a href=https://lifailon.github.io/network/>Network</a><li><a href=https://lifailon.github.io/windowsserver/>Windows Server</a><li><a href=https://lifailon.github.io/database/>Database</a><li><a href=https://lifailon.github.io/api/>API</a><li><a class=active href=https://lifailon.github.io/devops/>DevOps</a></ul></nav><p>© <strong>2023-2025</strong> <code>Lifailon</code><p><a class=external href=https://github.com/Lifailon/PS-Commands>Website source</a><p><small>Powered by <a class="link external" href=https://www.getzola.org>Zola</a> and <a class="link external" href=https://duckquill.daudix.one>Duckquill</a> </small><ul id=socials><li><a rel=" me" href=https://github.com/lifailon/PS-Commands title=GitHub> <i style="--icon:url(&#34data:image/svg+xml,%3Csvg role='img' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Ctitle%3EGitHub%3C/title%3E%3Cpath d='M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12'/%3E%3C/svg%3E&#34)" class=icon></i> <span>GitHub</span> </a><li><a rel=" me" href=https://www.nuget.org/profiles/Lifailon title=NuGet> <i style="--icon:url(&#34data:image/svg+xml,%3Csvg role='img' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Ctitle%3ENUGet%3C/title%3E%3Cpath d='M1.57 0A1.57 1.57 0 000 1.57v20.86A1.57 1.57 0 001.57 24h20.86A1.57 1.57 0 0024 22.43V1.57A1.57 1.57 0 0022.43 0zM7.5 1.5A2.5 2.5 0 0110 4a2.5 2.5 0 01-2.5 2.5A2.5 2.5 0 015 4a2.5 2.5 0 012.5-2.5zM12 6h9v12h-1.5a3.76 3.76 0 00-2.81-1.25A3.76 3.76 0 0012.5 20a3.76 3.76 0 002.19 3.25A3.76 3.76 0 0018.5 24H21V6z'/%3E%3C/svg%3E&#34)" class=icon></i> <span>NuGet</span> </a><li><a rel=" me" href=https://www.npmjs.com/~lifailon title=NPM> <i style="--icon:url(&#34data:image/svg+xml,%3Csvg role='img' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Ctitle%3ENPM%3C/title%3E%3Cpath d='M0 0v24h24V0zm14.74 14.74h-3.66v-5.5h-1.83v5.5H5.5V5.5h9.24z'/%3E%3C/svg%3E&#34)" class=icon></i> <span>NPM</span> </a><li><a rel=" me" title="Docker Hub" href=https://hub.docker.com/u/lifailon> <i style="--icon:url(&#34data:image/svg+xml,%3Csvg role='img' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Ctitle%3EDocker%3C/title%3E%3Cpath d='M22.149 10.74c-.111-.086-1.15-.86-3.3-.86-.26.002-.52.017-.78.045-.24-1.35-1.32-1.8-1.35-1.81l-.45-.17-.3.42c-.17.24-.65.88-.65 1.76.001.29.04.58.12.86-.66.19-1.3.35-1.95.48a9.72 9.72 0 0 1-1.95.22H.75c-.41 0-.75.34-.75.75 0 4.42 2.4 5.98 4.41 6.68.9.28 1.91.42 3.01.42 1.08 0 2.11-.14 3.01-.42 1.98-.61 3.51-2.01 4.14-4.01.34.04.68.07 1.02.07 1.35 0 2.61-.35 3.72-1.04 1.64-1.01 1.87-2.23 1.87-2.92.01-.96-.34-1.68-.35-1.7zM6.75 8.22h2.25c.14 0 .25-.11.25-.25V6.47c0-.14-.11-.25-.25-.25H6.75c-.14 0-.25.11-.25.25v1.5c0 .14.11.25.25.25zM12 8.22h2.25c.14 0 .25-.11.25-.25V6.47c0-.14-.11-.25-.25-.25H12c-.14 0-.25.11-.25.25v1.5c0 .14.11.25.25.25zM9.375 6.72h-2.25c-.14 0-.25.11-.25.25v1.5c0 .14.11.25.25.25h2.25c.14 0 .25-.11.25-.25v-1.5c0-.14-.11-.25-.25-.25zM12 5.47h-2.25c-.14 0-.25.11-.25.25v1.5c0 .14.11.25.25.25H12c.14 0 .25-.11.25-.25v-1.5c0-.14-.11-.25-.25-.25z'/%3E%3C/svg%3E&#34)" class=icon></i> <span>Docker Hub</span> </a></ul></footer>