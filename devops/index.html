<!doctype html><html data-theme=dark lang=en xmlns=http://www.w3.org/1999/xhtml><head><meta charset=UTF-8><meta content="Web version for PowerShell notes in Russian language (Сheat Sheet & Documentation), Linux commands and RuDocs for Node.js" name=description><meta content="width=device-width,initial-scale=1" name=viewport><meta content=#ff7800 name=theme-color><meta content=#ffa348 media=(prefers-color-scheme:dark) name=theme-color><meta content="default-src 'none';font-src 'self';img-src 'self' https: data:;media-src 'self' https:;style-src 'self' 'unsafe-inline';frame-src https://player.vimeo.com https://www.youtube-nocookie.com https://toot.community;frame-ancestors 'none';base-uri 'none';form-action 'none';connect-src 'self' https://toot.community;script-src 'self' 'self'" http-equiv=content-security-policy><title>DevOps - PowerShell Commands</title><link href=https://lifailon.github.io/devops/ rel=canonical><link href=https://lifailon.github.io/favicon.png rel=icon type=image/png><link href=https://lifailon.github.io/apple-touch-icon.png rel=apple-touch-icon sizes=180x180 type=image/png><link title="PowerShell Commands - RSS Feed" href=https://lifailon.github.io/rss.xml rel=alternate type=application/rss+xml><link title="PowerShell Commands - Atom Feed" href=https://lifailon.github.io/atom.xml rel=alternate type=application/atom+xml><style>:root{--accent-color:#ff7800}[data-theme=dark]{--accent-color:#ffa348}@media (prefers-color-scheme:dark){:root:not([data-theme=light]){--accent-color:#ffa348}}</style><link href=https://lifailon.github.io/style.css rel=stylesheet><link href=https://lifailon.github.io/icons.css rel=stylesheet><link href=https://lifailon.github.io/custom.css rel=stylesheet><link media="(prefers-color-scheme: light)" href=https://lifailon.github.io/syntax-theme-light.css rel=stylesheet><link media="(prefers-color-scheme: dark)" href=https://lifailon.github.io/syntax-theme-dark.css rel=stylesheet><script defer src=https://lifailon.github.io/closable.js></script><script defer src=https://lifailon.github.io/copy-button.js></script><script defer src=https://lifailon.github.io/fuse.js></script><script defer src=https://lifailon.github.io/search-fuse.js></script><script defer src=https://lifailon.github.io/theme-switcher.js></script><meta content="PowerShell Commands" property=og:site_name><meta content="DevOps - PowerShell Commands" property=og:title><meta content=https://lifailon.github.io/devops/ property=og:url><meta content="Web version for PowerShell notes in Russian language (Сheat Sheet & Documentation), Linux commands and RuDocs for Node.js" property=og:description><meta content=https://lifailon.github.io/card.png property=og:image><meta content=en_US property=og:locale><body><div id=handle></div><header id=site-nav><nav><a href=#main-content tabindex=0> Skip to Main Content </a><ul><li id=home><a href=https://lifailon.github.io> <i class=icon></i>PowerShell Commands</a><li class=divider><li><a href=https://lifailon.github.io/powershell/>PowerShell</a><li><a href=https://lifailon.github.io/linux/>Linux</a><li><a class=active href=https://lifailon.github.io/devops/>DevOps</a><li><a href=https://lifailon.github.io/golang/>GoLang</a><li><a href=https://lifailon.github.io/node-js/>Node.js</a><li id=search><button class=circle id=search-toggle title=Search><i class=icon></i></button><li id=theme-switcher><details class=closable><summary class=circle title=Theme><i class=icon></i></summary> <ul><li><button title="Switch to Light Theme" class=circle id=theme-light><i class=icon></i></button><li><button title="Switch to Dark Theme" class=circle id=theme-dark><i class=icon></i></button><li><button title="Use System Theme" class=circle id=theme-system><i class=icon></i></button></ul></details><li id=repo><a class=circle href=https://github.com/Lifailon/PS-Commands title=Repository> <i class=icon></i> </a></ul></nav><div id=search-container><label class=visually-hidden for=search-bar>Search</label><input placeholder="Search for…" autocomplete=off disabled id=search-bar type=search><div id=search-results-container><div id=search-results></div></div></div></header><div id=sidebar><div><h2>Table of Contents</h2><ul><li><a href=https://lifailon.github.io/devops/#git>Git</a><li><a href=https://lifailon.github.io/devops/#docker>Docker</a><ul><li><a href=https://lifailon.github.io/devops/#wsl>WSL</a><li><a href=https://lifailon.github.io/devops/#install>Install</a><li><a href=https://lifailon.github.io/devops/#proxy>Proxy</a><li><a href=https://lifailon.github.io/devops/#mirror>Mirror</a><li><a href=https://lifailon.github.io/devops/#nexus>Nexus</a><li><a href=https://lifailon.github.io/devops/#run>Run</a><li><a href=https://lifailon.github.io/devops/#alias>Alias</a><li><a href=https://lifailon.github.io/devops/#update>Update</a><li><a href=https://lifailon.github.io/devops/#stats>Stats</a><li><a href=https://lifailon.github.io/devops/#logs>Logs</a><li><a href=https://lifailon.github.io/devops/#volume>Volume</a><li><a href=https://lifailon.github.io/devops/#network>Network</a><li><a href=https://lifailon.github.io/devops/#inspect>Inspect</a><li><a href=https://lifailon.github.io/devops/#exec>Exec</a><li><a href=https://lifailon.github.io/devops/#prune>Prune</a><li><a href=https://lifailon.github.io/devops/#remove>Remove</a><li><a href=https://lifailon.github.io/devops/#diff>Diff</a><li><a href=https://lifailon.github.io/devops/#docker-socket-api>Docker Socket API</a><li><a href=https://lifailon.github.io/devops/#docker-tcp-api>Docker TCP API</a><li><a href=https://lifailon.github.io/devops/#context>Context</a><li><a href=https://lifailon.github.io/devops/#dcm>dcm</a><li><a href=https://lifailon.github.io/devops/#ctop>ctop</a><li><a href=https://lifailon.github.io/devops/#dockly>Dockly</a><li><a href=https://lifailon.github.io/devops/#lazydocker>LazyDocker</a><li><a href=https://lifailon.github.io/devops/#lazyjournal>Lazyjournal</a><li><a href=https://lifailon.github.io/devops/#push>Push</a><li><a href=https://lifailon.github.io/devops/#buildx>Buildx</a></ul><li><a href=https://lifailon.github.io/devops/#dockerfile>Dockerfile</a><li><a href=https://lifailon.github.io/devops/#docker-compose>Docker Compose</a><ul><li><a href=https://lifailon.github.io/devops/#uptime-kuma>Uptime-Kuma</a><li><a href=https://lifailon.github.io/devops/#dozzle>Dozzle</a><li><a href=https://lifailon.github.io/devops/#watchtower>Watchtower</a><li><a href=https://lifailon.github.io/devops/#portainer>Portainer</a></ul><li><a href=https://lifailon.github.io/devops/#docker-dotnet>Docker.DotNet</a><li><a href=https://lifailon.github.io/devops/#swarm>Swarm</a><li><a href=https://lifailon.github.io/devops/#kubernetes>Kubernetes</a><ul><li><a href=https://lifailon.github.io/devops/#minikube>Minikube</a><li><a href=https://lifailon.github.io/devops/#microk8s>Microk8s</a><li><a href=https://lifailon.github.io/devops/#k3s>K3s</a><li><a href=https://lifailon.github.io/devops/#dashboard>Dashboard</a><li><a href=https://lifailon.github.io/devops/#headlamp>Headlamp</a><li><a href=https://lifailon.github.io/devops/#k9s>k9s</a><li><a href=https://lifailon.github.io/devops/#kubectl>kubectl</a><li><a href=https://lifailon.github.io/devops/#deployment-and-service>Deployment and Service</a><li><a href=https://lifailon.github.io/devops/#proxy-and-forward>Proxy and forward</a><li><a href=https://lifailon.github.io/devops/#hpa>HPA</a><li><a href=https://lifailon.github.io/devops/#ingress>Ingress</a><li><a href=https://lifailon.github.io/devops/#metallb>MetalLB</a><li><a href=https://lifailon.github.io/devops/#kompose>Kompose</a><li><a href=https://lifailon.github.io/devops/#kustomize>Kustomize</a><li><a href=https://lifailon.github.io/devops/#helm>Helm</a></ul><li><a href=https://lifailon.github.io/devops/#github-api>GitHub API</a><li><a href=https://lifailon.github.io/devops/#github-actions>GitHub Actions</a><ul><li><a href=https://lifailon.github.io/devops/#runner-agent>Runner (Agent)</a><li><a href=https://lifailon.github.io/devops/#build-pipeline>Build (Pipeline)</a><li><a href=https://lifailon.github.io/devops/#ci>CI</a><li><a href=https://lifailon.github.io/devops/#logs-1>Logs</a><li><a href=https://lifailon.github.io/devops/#act>act</a></ul><li><a href=https://lifailon.github.io/devops/#vercel>Vercel</a><ul><li><a href=https://lifailon.github.io/devops/#cd>CD</a></ul><li><a href=https://lifailon.github.io/devops/#gitlab>GitLab</a><li><a href=https://lifailon.github.io/devops/#jenkins>Jenkins</a><ul><li><a href=https://lifailon.github.io/devops/#api>API</a><li><a href=https://lifailon.github.io/devops/#plugins>Plugins</a><li><a href=https://lifailon.github.io/devops/#ssh-steps-and-artifacts>SSH Steps and Artifacts</a><li><a href=https://lifailon.github.io/devops/#upload-file-parameter>Upload File Parameter</a><li><a href=https://lifailon.github.io/devops/#input-text-and-file>Input Text and File</a><li><a href=https://lifailon.github.io/devops/#httpurlconnection>HttpURLConnection</a><li><a href=https://lifailon.github.io/devops/#httprequest>httpRequest</a><li><a href=https://lifailon.github.io/devops/#active-choices-parameter>Active Choices Parameter</a><li><a href=https://lifailon.github.io/devops/#vault>Vault</a><li><a href=https://lifailon.github.io/devops/#email-extension>Email Extension</a><li><a href=https://lifailon.github.io/devops/#parallel>Parallel</a></ul><li><a href=https://lifailon.github.io/devops/#groovy>Groovy</a><li><a href=https://lifailon.github.io/devops/#ansible>Ansible</a><ul><li><a href=https://lifailon.github.io/devops/#hosts>Hosts</a><li><a href=https://lifailon.github.io/devops/#windows-modules>Windows Modules</a><li><a href=https://lifailon.github.io/devops/#jinja>Jinja</a></ul><li><a href=https://lifailon.github.io/devops/#puppet>Puppet</a><ul><li><a href=https://lifailon.github.io/devops/#bolt>Bolt</a></ul><li><a href=https://lifailon.github.io/devops/#sake>Sake</a><li><a href=https://lifailon.github.io/devops/#secret-manager>Secret Manager</a><ul><li><a href=https://lifailon.github.io/devops/#bitwarden>Bitwarden</a><li><a href=https://lifailon.github.io/devops/#infisical>Infisical</a><li><a href=https://lifailon.github.io/devops/#hashicorp-vault>HashiCorp/Vault</a><li><a href=https://lifailon.github.io/devops/#hashicorp-consul>HashiCorp/Consul</a></ul><li><a href=https://lifailon.github.io/devops/#prometheus>Prometheus</a><ul><li><a href=https://lifailon.github.io/devops/#promql-functions>PromQL Functions</a></ul><li><a href=https://lifailon.github.io/devops/#graylog>Graylog</a></ul></div></div><main id=main-content><div id=buttons-container><a title="Go to Top" href=#top id=go-to-top><i class=icon></i></a></div><h1>DevOps</h1><p align=center><a href=https://github.com/Lifailon/PS-Commands><img title="PS-Commands Logo" src=logo.png></a><p align=center>Заметки по инструментам направления <b>DevOps</b>.<hr><h2 id=git><a aria-label="Anchor link for: git" class=zola-anchor href=#git><i class=icon></i></a> Git</h2><p><code>git --version</code> <br> <code>git config --global user.name "Lifailon"</code> добавить имя для коммитов <br> <code>git config --global user.email "lifailon@yandex.ru"</code> <br> <code>git config --global --edit</code> <br> <code>git config --global core.editor "code --wait"</code> изменить редактор коммитов по умолчанию <br> <code>ssh-keygen -t rsa -b 4096</code> <br> <code>Get-Service | where name -match "ssh-agent" | Set-Service -StartupType Automatic</code> <br> <code>Get-Service | where name -match "ssh-agent" | Start-Service</code> <br> <code>Get-Service | where name -match "ssh-agent" | select Name,Status,StartType</code> <br> <code>ssh-agent</code> <br> <code>ssh-add C:\Users\Lifailon\.ssh\id_rsa</code> <br> <code>cat ~\.ssh\id_rsa.pub | Set-Clipboard</code> copy to <a href=https://github.com/settings/keys>settings keys</a> <br> <code>cd $home\Documents\Git</code> <br> <code>git clone git@github.com:Lifailon/lifailon.github.io</code> <br> <code>cd lifailon.github.io</code> <br> <code>git grep "ping ya.ru"</code> поиск текста в файлах <br> <code>git fetch</code> загрузить изменения из удаленного хранилища для обновления всех веток локального репозитория, не затрагивая текущую рабочую ветку (загружает все коммиты, ветки и т.д. которые не присутствуют в локальном репозитории) <br> <code>git fetch --all</code> загрузить все ветки с удаленного репозитория (обновляет информацию о состоянии удаленного репозитория и загружает все изменения ваших веток без автоматического объединения) <br> <code>git pull</code> загрузить изменения из удаленного хранилища для обновления локального репозитория (выполняет <code>git fetch</code>, чтобы получить последние изменения из удаленного репозитория, а затеим объеденяем изменения с локальной копией с помощью <code>git merge</code> для обновления текущей рабочей ветки) <br> <code>git stash</code> сохраняет текущие незакоммиченные изменения в временное хранилище (например, на время выполнения <code>git pull</code>), в т.ч. неотслеживаемые файлы и очищает рабочую директорию (вернет в состояние, соответствующее последнему коммиту) <br> <code>git stash pop</code> применяет последние изменения из стэша к текущей ветке (вернутся только измененные строки в файлах, при этом будут сохранены новые добавленные строки в файле без конфликтов) и удаляет их из стэша <br> <code>git stash apply</code> применяет изменения, но не удаляет их из стэша <br> <code>git status</code> отобразить статус изменений по файлам <br> <code>git diff</code> отобразить историю изменений построчно <br> <code>git diff pandoc</code> сравнивает изменения в текущей рабочей директории с последним коммитом в указанной ветке <code>pandoc</code> <br> <code>git add .</code> добавить (проиндексировать) изменения во всех файлах текущего каталога <br> <code>git commit -m "update powershell commands"</code> сохранить изменения с комментарием <br> <code>git push</code> синхронизировать локальные изменения с репозиторием на сервере <br> <code>git push origin mkdocs-material</code> отправить в конкретную ветку <br> <code>git push origin --delete mkdocs</code> удалить ветку на удаленном сервере <br> <code>git commit --amend</code> изменить комментарий в последнем коммите (до <code>push</code>) <br> <code>git commit --amend --no-edit --date="Sun Oct 27 23:20:00 2024 +0300"</code> изменить дату последнего коммита <br> <code>git branch -a</code> отобразить все ветки (в том числе удаленные remotes/origin) <br> <code>git branch hugo</code> создать новую ветку <br> <code>git branch -m hugo-public</code> переименовать текущую ветку <br> <code>git branch -d hugo-public</code> удалить ветку <br> <code>git switch hugo</code> переключиться на другую ветку <br> <code>git push origin hugo</code> отправить изменения в указанную ветку <br> <code>git branch --set-upstream-to=origin/hugo hugo</code> локальная ветка <code>hugo</code> будет отслеживать удаленную ветку <code>hugo</code> на удаленном сервере-репозитории <code>origin</code> (позволяет не указывать название удаленной ветки при каждом использовании команд <code>git push</code> или <code>git pull</code>) <br> <code>git switch pandoc</code> переключиться на другую ветку <br> <code>git merge hugo</code> слияние указанной ветки (<code>hugo</code>) в текущую ветку (<code>pandoc</code>) <br> <code>git log --oneline --all</code> отобразить список всех коммитов и их сообщений <br> <code>git log --graph</code> коммиты и следование веток <br> <code>git log --author="Lifailon"</code> показывает историю коммитов указанного пользователя <br> <code>git blame .\posh.md</code> показывает, кто и когда внес изменения в каждую строку указанного файла (<code>НОМЕР_КОММИТА (ИМЯ_ПОЛЬЗОВАТЕЛЯ ДАТА НОМЕР_СТРОКИ) ТЕКСТ.</code>) <br> <code>git show d01f09dead3a6a8d75dda848162831c58ca0ee13</code> отобразить подробный лог по номеру коммита <br> <code>git checkout filename</code> устаревшая команда, откатить не проиндексированные изменения для коммита, возвращая его к состоянию, каким оно было на момент последнего коммита (если не было индексации через <code>add</code>) <br> <code>git restore filename</code> отменить все локальные изменения в рабочей копии независимо от того, были они проиндексированы или нет (через <code>add</code>), возвращая его к состоянию на момент последнего коммита <br> <code>git restore --source d01f09dead3a6a8d75dda848162831c58ca0ee13 filename</code> восстановить файл на указанную версию по хэшу индентификатора коммита <br> <code>git reset HEAD filename</code> удалить указанный файл из индекса без удаления самих изменений в файле для последующей повторной индексации (если был <code>add</code> но не было <code>commit</code>, потом выполнить <code>checkout</code>) <br> <code>git reset --soft HEAD^</code> отменяет последний (^) коммит, сохраняя изменения из этого коммита в рабочем каталоге и индексе (подготовленной области), можно внести изменения в файлы и повторно их зафиксировать через <code>commit</code> <br> <code>git reset --hard HEAD^</code> полностью отменяет последний коммит, удаляя все его изменения из рабочего каталога и индекса до состояния предыдущего перед последним коммитом (аналогично <code>HEAD~1</code>) <br> <code>git push origin main --force</code> удалить последний коммит на удаленном сервере репозитория после <code>reset --hard HEAD^</code> <br> <code>git reset --hard d01f09dead3a6a8d75dda848162831c58ca0ee13</code> откатывает изменения к указанному коммиту и удаляет все коммиты, которые были сделаны после него (будут потеряны все незакоммиченные изменения и историю коммитов после указанного) <br> <code>git revert HEAD --no-edit</code> создает новый коммит, который отменяет последний коммит (<code>HEAD^</code>) и новый коммит будет добавлен поверх него (события записываются в <code>git log</code>) <br> <code>git revert d01f09dead3a6a8d75dda848162831c58ca0ee13</code> создает новый коммит, который отменяет изменения, внесенные в указанный коммит с хешем (не изменяет историю коммитов, а создает новый коммит с изменениями отмены)<h2 id=docker><a aria-label="Anchor link for: docker" class=zola-anchor href=#docker><i class=icon></i></a> Docker</h2><h3 id=wsl><a aria-label="Anchor link for: wsl" class=zola-anchor href=#wsl><i class=icon></i></a> WSL</h3><p><code>wsl --list</code> список установленных дистрибутивов Linux <br> <code>wsl --list --online</code> список доступных дистрибутивов <br> <code>wsl --install -d Ubuntu</code> установить Ubuntu в Windows Subsystem for Linux <br> <code>wsl --status</code> <br> <code>wsl --exec "htop"</code> выполнить команду в подсистеме Linux по умолчанию <br> <code>wsl -e bash -c "docker -v"</code> <br> <code>wsl -e bash -c "systemctl status docker"</code><h3 id=install><a aria-label="Anchor link for: install" class=zola-anchor href=#install><i class=icon></i></a> Install</h3><p><code>apt update && apt upgrade -y</code> <br> <code>apt install docker.io</code> <br> <code>systemctl status docker</code> <br> <code>systemctl start docker</code> <br> <code>systemctl enable docker</code> <br> <code>iptables -t nat -N DOCKER</code> <br> <code>docker -v</code> <br> <code>docker -h</code><p><code>sudo usermod -aG docker lifailon</code> добавить пльзователя в группу docker <br> <code>newgrp docker</code> применить изменения в группах<p><code>curl https://registry-1.docker.io/v2/</code> проверить доступ к Docker Hub <br> <code>curl -s -X POST -H "Content-Type: application/json" -d '{"username": "lifailon", "password": "password"}' https://hub.docker.com/v2/users/login | jq -r .token > dockerToken.txt</code> получить временный токен доступа для авторизации <br> <code>sudo docker login</code> вход в реестр репозитория hub.docker.com <br> <code>cat dockerToken.txt | sudo docker login --username lifailon --password-stdin</code> передать токен авторизации (https://hub.docker.com/settings/security) из файла через stdin <br> <code>cat /root/.docker/config.json | jq -r .auths[].auth</code> место хранения токена авторизации в системе <br> <code>cat /root/.docker/config.json | python3 -m json.tool</code><h3 id=proxy><a aria-label="Anchor link for: proxy" class=zola-anchor href=#proxy><i class=icon></i></a> Proxy</h3><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">mkdir</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span> /etc/systemd/system/docker.service.d</span>
</span></code></pre><p>Создаем дополнительную конфигурацию для службы Docker в файле <code>/etc/systemd/system/docker.service.d/http-proxy.conf</code>:<pre class=z-code><code><span class="z-text z-plain">[Service]
</span><span class="z-text z-plain">Environment="HTTP_PROXY=http://docker:password@192.168.3.100:9090"
</span><span class="z-text z-plain">Environment="HTTPS_PROXY=http://docker:password@192.168.3.100:9090"
</span></code></pre><p><code>systemctl daemon-reload</code> <br> <code>systemctl restart docker</code><h3 id=mirror><a aria-label="Anchor link for: mirror" class=zola-anchor href=#mirror><i class=icon></i></a> Mirror</h3><p><code>echo '{ "registry-mirrors": ["https://dockerhub.timeweb.cloud"] }' > "/etc/docker/daemon.json"</code> <br> <code>echo '{ "registry-mirrors": ["https://huecker.io"] }' > "/etc/docker/daemon.json"</code> <br> <code>echo '{ "registry-mirrors": ["https://mirror.gcr.io"] }' > "/etc/docker/daemon.json"</code> <br> <code>echo '{ "registry-mirrors": ["https://daocloud.io"] }' > "/etc/docker/daemon.json"</code> <br> <code>echo '{ "registry-mirrors": ["https://c.163.com"] }' > "/etc/docker/daemon.json"</code><p><code>systemctl restart docker</code><h3 id=nexus><a aria-label="Anchor link for: nexus" class=zola-anchor href=#nexus><i class=icon></i></a> Nexus</h3><p>Разрешает небезопасные HTTP-соединения с Nexus сервером (если не использует HTTPS):<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>e</span> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>{\n  "insecure-registries": ["http://192.168.3.105:8882"]\n}<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> tee <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>/etc/docker/daemon.json<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> systemctl restart docker</span>
</span></code></pre><p><code>docker login 192.168.3.105:8882</code> авторизируемся в репозитории Docker Registry на сервере Nexus <br> <code>docker tag lifailon/docker-web-manager:latest 192.168.3.105:8882/docker-web-manager:latest</code> создаем тег с прявязкой сервера <br> <code>docker push 192.168.3.105:8882/docker-web-manager:latest</code> загружаем образ на сервер Nexus<p><code>curl -sX GET http://192.168.3.105:8882/v2/docker-web-manager/tags/list | jq</code> отобразить список доступных тегов <br> <code>docker pull 192.168.3.105:8882/docker-web-manager:latest</code> загрузить образ из Nexus<h3 id=run><a aria-label="Anchor link for: run" class=zola-anchor href=#run><i class=icon></i></a> Run</h3><p>Commands: <code>search/pull/images/creat/start/ps/restart/pause/unpause/rename/stop/kill/rm/rmi</code><p><code>docker search speedtest</code> поиск образа в реестре <br> <code>docker pull adolfintel/speedtest</code> скачать образ LibreSpeed из реестра Docker Hub (https://hub.docker.com/r/adolfintel/speedtest) <br> <code>docker images (docker image ls)</code> отобразить все локальные (уже загруженные) образы docker (<code>image ls</code>) <br> <code>docker images --format "table {{.ID}}\t{{.Repository}}\t{{.Tag}}"</code> отфильтровать вывод (json-формат) <br> <code>docker create -it --name speedtest -p 8080:80 adolfintel/speedtest</code> создать контейнер из образа adolfintel/speedtest с именем speedtest и проброс 80 порта контейнера на 8080 порт хоста <br> <code>docker start speedtest</code> запустить созданный контейнер <br> <code>ss -ltp | grep 8080</code> проверить, что порт открыт <br> <code>docker ps</code> отобразить все запущенные докер контейнеры <br> <code>docker ps -a</code> список всех существующих контейнеров (для их запуска/удаления по NAMES/ID и код выхода Exited 0 - успешная остановка) <br> <code>docker ps -s</code> размер контейнеров (–size) <br> <code>docker restart speedtest</code> перезапустить контейнер <br> <code>docker pause speedtest</code> приостановить контейнер <br> <code>docker unpause uptime-kuma</code> возобновить работу контейнера <br> <code>docker rename speedtest speedtest-2</code> переименоввать контейнер (<code>docker rename old_name new_name</code>) <br> <code>docker stop speedtest-2</code> остановить работающий контейнер с отправкой главному процессу контейнера сигнал <code>SIGTERM</code>, и через время <code>SIGKILL</code> <br> <code>docker kill uptime-kuma</code> остановить работающий контейнер с отправкой главному процессу контейнера сигнал <code>SIGKILL</code> <br> <code>docker kill $(docker ps -q)</code> остановить все контейнеры <br> <code>docker rm speedtest-2</code> удалить контейнер <br> <code>docker rmi adolfintel/speedtest</code> удалить образ <br> <code>docker run -p 8443:8443 -it --entrypoint /bin/sh container_name</code> запустить контейнер и подключиться к нему (даже если контейнер уходит в ошибку при запуске) <br> <code>docker run -d --restart=unless-stopped --name openspeedtest -p 3000:3000 -p 3001:3001 openspeedtest/latest</code> загрузить образ OpenSpeedTest (https://hub.docker.com/r/openspeedtest/latest), создать контейнер и запустить в одну команду в фоновом режиме (-d/–detach, терминал возвращает контроль сразу после запуска контейнера, если не используется, можно видеть логи, но придется остановить контейнер для выхода) <br> <code>docker rm openspeedtest && docker rmi openspeedtest/latest</code> удаляем контейнер и образ в одну команду <br> <code>docker run --name pg1 -p 5433:5432 -e POSTGRES_PASSWORD=PassWord -d postgres</code> создать контейнер postgres (https://hub.docker.com/_/postgres) с параметрами (-e) <br> <code>docker run -d --restart=always --name uptime-kuma -p 8080:3001 louislam/uptime-kuma:1</code> создать и запустить контейнер Uptime-Kuma (https://hub.docker.com/r/elestio/uptime-kuma) в режиме always, при котором контейнер должен перезапускаться автоматически, если он остановится или если перезапустится Docker (например, после перезагрузки хоста) <br> <code>docker history openspeedtest:latest</code> отображает слои образа, их размер и команды, которые были выполнены при его создании<h3 id=alias><a aria-label="Anchor link for: alias" class=zola-anchor href=#alias><i class=icon></i></a> Alias</h3><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-alias z-shell">alias</span> <span class="z-entity z-name z-function z-alias z-shell">docker-all-start</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>docker ps -aq --filter "status=exited" | xargs -P 4 -I {} docker start {}<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span></span> <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> параллельный запуск всех остановленных контейнеров со статус выхода exited</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-alias z-shell">alias</span> <span class="z-entity z-name z-function z-alias z-shell">docker-all-stop</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>docker ps -aq | xargs -P 4 -I {} docker stop {}<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span></span> <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> остановить все работающие контейнеры</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-alias z-shell">alias</span> <span class="z-entity z-name z-function z-alias z-shell">docker-all-restart</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>docker ps -aq | xargs -P 4 -I {} docker restart {}<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span></span> <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> перезапустить все контейнеры</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></code></pre><h3 id=update><a aria-label="Anchor link for: update" class=zola-anchor href=#update><i class=icon></i></a> Update</h3><p><code>docker update --restart unless-stopped uptime-kuma</code> изменить режим перезапуска контейнера после его остановки на unless-stopped (режим аналогичен always, но контейнер не будет перезапущен, если он был остановлен вручную с помощью docker stop) <br> <code>docker update --restart on-failure uptime-kuma</code> контейнер будет перезапущен только в случае его завершения с ошибкой, когда код завершения отличается от 0, через двоеточие можно указать количество попыток перезапуска (например, on-failure:3) <br> <code>docker update --cpu-shares 512 --memory 500M uptime-kuma</code> задать ограничения по CPU, контейнер будет иметь доступ к указанной доле процессорного времени в диапазоне от 2 до 262,144 (2^18) или –cpus (количество процессоров), –memory/–memory-swap и –blkio-weight для IOps (относительный вес от 10 до 1000)<h3 id=stats><a aria-label="Anchor link for: stats" class=zola-anchor href=#stats><i class=icon></i></a> Stats</h3><p><code>docker stats</code> посмотреть статистику потребляемых ресурсов запущенными контейнерами (top) <br> <code>docker stats --no-stream --format json</code> вывести результат один раз в формате json<h3 id=logs><a aria-label="Anchor link for: logs" class=zola-anchor href=#logs><i class=icon></i></a> Logs</h3><p><code>docker logs uptime-kuma --tail 100</code> показать логи конкретного запущенного контейнера в терминале (последние 100 строк) <br> <code>docker system events</code> предоставляют события от демона dockerd в реальном времени <br> <code>journalctl -xeu docker.service</code> <br> <code>docker system df</code> отобразить сводную информацию занятого пространства образами и контейнерами <br> <code>du -h --max-depth=1 /var/lib/docker</code> <br> <code>du -h --max-depth=2 /var/lib/docker/containers</code><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> run <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">  --</span>log-driver</span> json-file <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">  --</span>log-opt</span> max-size=10m <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">  --</span>log-opt</span> max-file=3 <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell">  container_name</span>
</span></code></pre><p>Настройка логирования в docker compose:<pre class="language-yml z-code" data-lang=yml><code class=language-yml data-lang=yml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">logging</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">driver</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>json-file<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span> <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Стандартный драйвер логов Docker
</span></span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">options</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">max-size</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>10m<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>   <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Максимальный размер каждого лог-файла (10 МБайт)
</span></span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">max-file</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>3<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>     <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Максимальное количество файлов с логами (текущий и два предыдущих, Docker автоматически удаляет старые логи)
</span></span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> systemd/journald
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">logging</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">driver</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>journald<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">options</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tag</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>app_name<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> syslog/rsyslog
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">logging</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">driver</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>syslog<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">options</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">syslog-address</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>udp://127.0.0.1:514<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tag</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>app_name<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Отправка логов в Graylog, Logstash или другие GELF-совместимые системы
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">logging</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">driver</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>gelf<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">options</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">gelf-address</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>udp://1.2.3.4:12201<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tag</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>app_name<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span></code></pre><h3 id=volume><a aria-label="Anchor link for: volume" class=zola-anchor href=#volume><i class=icon></i></a> Volume</h3><p><code>docker volume ls</code> показывает список томов и место хранения (механизмы хранения постояннымх данных контейнера на хостовой машине, которые сохраняются между перезапусками или пересозданиями контейнеров) <br> <code>docker volume inspect uptime-kuma</code> подробная информация конфигурации тома (отображает локальный путь к данным в системе, Mountpoint: /var/lib/docker/volumes/uptime-kuma/_data) <br> <code>docker volume create test</code> создать том <br> <code>docker volume rm test</code> удалить том <br> <code>docker run -d --restart=always --name uptime-kuma -p 8080:3001 -v uptime-kuma:/app/data louislam/uptime-kuma:1</code> создать и запустить контейнер на указанном томе (том создается автоматически, в дальнейшем его можно указывать при создании контейнера, если необходимо загружать из него сохраненные данные)<p>Временная файловая система для хранения данных в оперативной памяти (исчезают после остановки контейнера):<pre class="language-yml z-code" data-lang=yml><code class=language-yml data-lang=yml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">volumes</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ram_disk</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">driver_opts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">type</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>tmpfs<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">device</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>tmpfs<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">o</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>size=512m,uid=1000<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span></code></pre><p>Монтирование <code>NFS</code> (без необходимости предварительного монтирования на хосте) через драйвер <code>opts</code>:<pre class="language-yml z-code" data-lang=yml><code class=language-yml data-lang=yml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">volumes</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">nfs_volume</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">driver_opts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">type</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>nfs<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">o</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>addr=192.168.3.106,nolock,soft,nfsvers=4<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">device</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>:/backup<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span> <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> путь к NFS-шаре на сервере
</span></span></code></pre><p>Монтирование <code>SMB</code> каталога:<p><code>sudo apt install cifs smbclient -y</code> <br> <code>smbclient //192.168.3.100/backup -U guest%</code> првоерить гостевой доступ <br> <code>sudo mkdir /mnt/smb_backup && sudo chown -R 1000:1000 /mnt/smb_backup</code> создать директорию для монтирования <br> <code>echo "//192.168.3.100/backup /mnt/smb_backup cifs username=guest,password=,uid=1000,gid=1000,rw,vers=3.0 0 0" | sudo tee -a /etc/fstab</code> <br> <code>mount -a && systemctl daemon-reload && df -h</code> примонтировать (применить все записи из fstab)<pre class="language-yml z-code" data-lang=yml><code class=language-yml data-lang=yml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">volumes</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">/mnt/smb_backup:/data</span>
</span></code></pre><h3 id=network><a aria-label="Anchor link for: network" class=zola-anchor href=#network><i class=icon></i></a> Network</h3><p><code>docker network ls</code> список сетей <br> <code>docker network inspect bridge</code> подробная информация о сети bridge <br> <code>docker inspect uptime-kuma | jq .[].NetworkSettings.Networks</code> узнать наименование сетевого адаптера указанного контейнера <br> <code>docker run -d --name uptime-kuma --network host nginx louislam/uptime-kuma:1</code> запуск контейнера с использованием host сети, которая позволяет контейнеру использовать сеть хостовой машины <br> <code>docker network create network_test</code> создать новую сеть <br> <code>docker network connect network_test uptime-kuma</code> подключить работающий контейнер к указанной сети <br> <code>docker network disconnect network_test uptime-kuma</code> отключить от сети<h3 id=inspect><a aria-label="Anchor link for: inspect" class=zola-anchor href=#inspect><i class=icon></i></a> Inspect</h3><p><code>docker inspect uptime-kuma</code> подробная информация о контейнере (например, конфигурация NetworkSettings) <br> <code>docker inspect uptime-kuma --format='{{.LogPath}}'</code> показать, где хранятся логи для конкретного контейнера в локальной системе <br> <code>docker inspect uptime-kuma | grep LogPath</code> <br> <code>docker inspect $(docker ps -q) --format='{{.NetworkSettings.Ports}}'</code> отобразить TCP порты всех запущенных контейнеров <br> <code>docker inspect $(docker ps -q) --format='{{.NetworkSettings.Ports}}' | grep -Po "[0-9]+(?=}])"</code> отобразить порты хоста (внешние) <br> <code>docker port uptime-kuma</code> отобразить проброшенные порты контейнера <br> <code>for ps in $(docker ps -q); do docker port $ps | sed -n 2p | awk -F ":" '{print $NF}'; done</code> отобразить внешние порты всех запущенных контейнеров <br> <code>id=$(docker inspect uptime-kuma | jq -r .[].Id)</code> узнать ID контейнера по его имени в конфигурации <br> <code>cat /var/lib/docker/containers/$id/config.v2.json | jq .</code> прочитать конфигурационный файл контейнера<h3 id=exec><a aria-label="Anchor link for: exec" class=zola-anchor href=#exec><i class=icon></i></a> Exec</h3><p><code>docker exec -it uptime-kuma /bin/bash</code> подключиться к работающему контейнеру (при выходе из оболочки, контейнер будет работать), используя интерпритатор bash <br> <code>docker top uptime-kuma</code> отобразить работающие процессы контейнера <br> <code>docker exec -it --user root uptime-kuma bash apt-get install -y procps</code> авторизоваться под пользователем root и установить procps <br> <code>docker exec -it uptime-kuma ps -aux</code> отобразить работающие процессы внутри контейнера <br> <code>docker exec uptime-kuma kill -9 25055</code> убить процесс внутри контейнера <br> <code>docker exec -it uptime-kuma ping 8.8.8.8</code> <br> <code>docker exec -it uptime-kuma pwd</code> <br> <code>docker cp ./Console-Performance.sh uptime-kuma:/app</code> скопировать из локальной системы в контейнер <br> <code>docker exec -it uptime-kuma ls</code> <br> <code>docker cp uptime-kuma:/app/db/ backup/db</code> сокпировать из контейнера в локальную систему <br> <code>ls backup/db</code><h3 id=prune><a aria-label="Anchor link for: prune" class=zola-anchor href=#prune><i class=icon></i></a> Prune</h3><p><code>docker network prune && docker image prune && docker volume prune && docker container prune</code> удалить все неиспользуемые сети, висящие образа, остановленные контейнеры, все неиспользуемые тома <br> <code>system prune –volumes</code> заменяет все четыре команды для очистки и дополнительно очищает кеш сборки<h3 id=remove><a aria-label="Anchor link for: remove" class=zola-anchor href=#remove><i class=icon></i></a> Remove</h3><p><code>systemctl stop docker.service</code> <br> <code>systemctl stop docker.socket</code> <br> <code>pkill -f docker</code> <br> <code>pkill -f containerd</code> <br> <code>apt purge docker.io -y || dpkg --purge docker.io</code> <br> <code>dpkg -l | grep docker</code> <br> <code>rm -rf /var/lib/docker</code> <br> <code>rm -rf /run/docker</code> <br> <code>rm -rf /run/docker.sock</code><h3 id=diff><a aria-label="Anchor link for: diff" class=zola-anchor href=#diff><i class=icon></i></a> Diff</h3><p><code>docker diff &LTcontainer_id_or_name></code> отображает изменения, внесённые в файловую систему контейнера по сравнению с исходным образом<p><code>A</code> — добавленные файлы <br> <code>C</code> — изменённые файлы <br> <code>D</code> — удалённые файлы<h3 id=docker-socket-api><a aria-label="Anchor link for: docker-socket-api" class=zola-anchor href=#docker-socket-api><i class=icon></i></a> Docker Socket API</h3><p><code>curl --silent -XGET --unix-socket /run/docker.sock http://localhost/version | jq .</code> использовать локальный сокет (/run/docker.sock) для взаимодействия с Docker daemon через его API <br> <code>curl --silent -XGET --unix-socket /run/docker.sock http://localhost/info | jq .</code> количество образов, запущенных и остановленных контейнеров и остальные метрики ОС <br> <code>curl --silent -XGET --unix-socket /run/docker.sock http://localhost/events</code> логи Docker daemon <br> <code>curl --silent -XGET --unix-socket /run/docker.sock -H "Content-Type: application/json" http://localhost/containers/json | jq .</code> список работающих контейнеров и их параметры конфигурации <br> <code>curl --silent -XGET --unix-socket /run/docker.sock http://localhost/containers/uptime-kuma/json | jq .</code> подробные сведения (конфигурация) контейнера <br> <code>curl --silent -XPOST --unix-socket /run/docker.sock -d "{"Image":"nginx:latest"}" http://localhost/containers/create?name=nginx</code> создать контейнер с указанным образом в теле запроса (должен уже присутствовать образ) <br> <code>curl --silent -XPOST --unix-socket /run/docker.sock http://localhost/containers/17fab06a820debf452fe685d1522a9dd1611daa3a5087ff006c2dabbe25e52a1/start</code> запустить контейнер по Id <br> <code>curl --silent -XPOST --unix-socket /run/docker.sock http://localhost/containers/17fab06a820debf452fe685d1522a9dd1611daa3a5087ff006c2dabbe25e52a1/stop</code> остановить контейнер <br> <code>curl --silent -XDELETE --unix-socket /run/docker.sock http://localhost/containers/17fab06a820debf452fe685d1522a9dd1611daa3a5087ff006c2dabbe25e52a1</code> удалить контейнер<h3 id=docker-tcp-api><a aria-label="Anchor link for: docker-tcp-api" class=zola-anchor href=#docker-tcp-api><i class=icon></i></a> Docker TCP API</h3><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>{
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">    "hosts": ["tcp://0.0.0.0:2375", "unix:///var/run/docker.sock"]
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">}<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">></span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>/etc/docker/daemon.json<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">service</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">cat</span></span><span class="z-meta z-function-call z-arguments z-shell"> /lib/systemd/system/docker.service</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sed</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>s/ -H fd:\/\///<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-printf z-shell">printf</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>%s\n<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">service</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">></span> /lib/systemd/system/docker.service</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">systemctl</span></span><span class="z-meta z-function-call z-arguments z-shell"> daemon-reload</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">systemctl</span></span><span class="z-meta z-function-call z-arguments z-shell"> restart docker</span>
</span></code></pre><p><code>curl --silent -XGET http://192.168.3.102:2375/version | jq .</code><p>Конечная точка <code>/metrics</code> для Prometheus:<pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span>
</span></span><span class="z-source z-yaml"><span class="z-meta z-flow-mapping z-yaml">  <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>metrics-addr<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span><span class="z-meta z-flow-pair z-yaml"><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span></span><span class="z-meta z-flow-pair z-value z-yaml"> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>0.0.0.0:9323<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span></span></span><span class="z-source z-yaml"><span class="z-meta z-flow-mapping z-yaml"><span class="z-meta z-flow-pair z-value z-yaml"></span><span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span>
</span></code></pre><p><code>curl http://192.168.3.102:9323/metrics</code><h3 id=context><a aria-label="Anchor link for: context" class=zola-anchor href=#context><i class=icon></i></a> Context</h3><p><code>docker context create rpi-106 --docker "host=tcp://192.168.3.106:2375"</code> добавить подключение к удаленному хосту через протокол <code>TCP</code> <br> <code>docker context create rpi-106 --docker "host=ssh://lifailon@192.168.3.106:2121"</code> добавить подключение к удаленному хосту через протокол <code>SSH</code> <br> <code>docker context ls</code> список всех доступных контекстов (<code>*</code> отображается текущий) <br> <code>docker context inspect rpi-106</code> конфигурация указанного контекста <br> <code>docker context use rpi-106</code> переключиться на выбранный контекст (возможно на прямую взаимосдействовать с удаленным Docker Engine через cli, за исключением взаимодействия через Socket) <br> <code>docker context rm rpi-106</code> удалить контекст<h3 id=dcm><a aria-label="Anchor link for: dcm" class=zola-anchor href=#dcm><i class=icon></i></a> dcm</h3><p><code>dcm</code> (Docker Context Manager) - это простая реализация TUI интерфейса на базе <a href=https://github.com/junegunn/fzf>fzf</a>, для переключения контекста из перечисленного списка хостов. Т.к. для использовать TUI интерфейсов требуется взаимодействие с сокетом, недостаточно изменить только переменную <code>DOCKER_HOST</code> или использовать команду <code>docker context</code>, по этому используется механиз <code>ssh forwarding</code>, который пробрасывает сокета с удаленной машины в локальную систему (используется временный файл, с изменением пути в переменной окружения).<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">DCM_SSH_HOSTS</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell">localhost,192.168.3.105,192.168.3.106</span>
</span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">DCM_SSH_USER</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell">lifailon</span>
</span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">DCM_SSH_PORT</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell">2121</span>
</span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">DCM_SOCKET_PATH</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell">/tmp/remote-docker.sock</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> dcm (Docker Context Manager)</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-storage z-type z-function z-shell">function</span> <span class="z-entity z-name z-function z-shell">dcm</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span> <span class="z-punctuation z-section z-braces z-begin z-shell">{</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-variable z-other z-readwrite z-assignment z-shell">DCM_SSH_HOST</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-printf z-shell">printf</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>%s\n<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-expansion z-parameter z-begin z-shell">{</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-variable z-other z-readwrite z-shell">DCM_SSH_HOSTS</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-keyword z-operator z-substitution z-shell">/</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-variable z-parameter z-switch z-shell">/</span></span><span class="z-meta z-group z-expansion z-parameter z-shell">,<span class="z-keyword z-operator z-substitution z-shell">/</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"> </span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-section z-expansion z-parameter z-end z-shell">}</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">fzf</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>exact</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>no-sort</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>height</span> 20<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>reverse</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-keyword z-control z-conditional z-if z-shell">if</span> <span class="z-support z-function z-test z-begin z-shell">[</span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>n</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">DCM_SSH_HOST</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-support z-function z-test z-end z-shell">]</span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-conditional z-then z-shell">then</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">        <span class="z-keyword z-control z-conditional z-if z-shell">if</span> <span class="z-support z-function z-test z-begin z-shell">[</span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">DCM_SSH_HOST</span></span> <span class="z-keyword z-operator z-logical z-shell">==</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>localhost<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-support z-function z-test z-end z-shell">]</span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-conditional z-then z-shell">then</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">            <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">pkill</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>f</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>ssh -fNL <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">DCM_SOCKET_PATH</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">            <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ps</span></span><span class="z-meta z-function-call z-arguments z-shell"> aux</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">grep</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>[s]sh -fNL<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">></span> /dev/null <span class="z-constant z-numeric z-integer z-decimal z-file-descriptor z-shell">2</span><span class="z-keyword z-operator z-assignment z-redirection z-shell">>&</span><span class="z-constant z-numeric z-integer z-decimal z-file-descriptor z-shell">1</span></span> <span class="z-keyword z-operator z-logical z-and z-shell">&&</span> <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>e</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>\e[31mError: socket not stopped\e[0m<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">            <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">rm</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>f</span> /tmp/remote-docker.sock</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">            <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ls</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">DCM_SOCKET_PATH</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">></span> /dev/null <span class="z-constant z-numeric z-integer z-decimal z-file-descriptor z-shell">2</span><span class="z-keyword z-operator z-assignment z-redirection z-shell">>&</span><span class="z-constant z-numeric z-integer z-decimal z-file-descriptor z-shell">1</span></span> <span class="z-keyword z-operator z-logical z-and z-shell">&&</span> <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>e</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>\e[31mError: socket not deleted\e[0m<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">            <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-unset z-shell">unset</span></span><span class="z-meta z-function-call z-arguments z-shell"> DOCKER_HOST</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">        <span class="z-keyword z-control z-conditional z-else z-shell">else</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">            <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">pkill</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>f</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>ssh -fNL <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">DCM_SOCKET_PATH</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">            <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ps</span></span><span class="z-meta z-function-call z-arguments z-shell"> aux</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">grep</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>[s]sh -fNL<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">></span> /dev/null <span class="z-constant z-numeric z-integer z-decimal z-file-descriptor z-shell">2</span><span class="z-keyword z-operator z-assignment z-redirection z-shell">>&</span><span class="z-constant z-numeric z-integer z-decimal z-file-descriptor z-shell">1</span></span> <span class="z-keyword z-operator z-logical z-and z-shell">&&</span> <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>e</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>\e[31mError: socket not stopped\e[0m<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">            <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">rm</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>f</span> /tmp/remote-docker.sock</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">            <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ls</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">DCM_SOCKET_PATH</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">></span> /dev/null <span class="z-constant z-numeric z-integer z-decimal z-file-descriptor z-shell">2</span><span class="z-keyword z-operator z-assignment z-redirection z-shell">>&</span><span class="z-constant z-numeric z-integer z-decimal z-file-descriptor z-shell">1</span></span> <span class="z-keyword z-operator z-logical z-and z-shell">&&</span> <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>e</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>\e[31mError: socket not deleted\e[0m<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">            <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ssh</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>fNL</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">DCM_SOCKET_PATH</span></span>:/var/run/docker.sock <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">DCM_SSH_USER</span></span>@<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">DCM_SSH_HOST</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">DCM_SSH_PORT</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-meta z-function-call z-shell">            <span class="z-storage z-modifier z-shell">export</span> <span class="z-variable z-other z-readwrite z-assignment z-shell">DOCKER_HOST</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>unix://<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">DCM_SOCKET_PATH</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">            <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ps</span></span><span class="z-meta z-function-call z-arguments z-shell"> aux</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">grep</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>[s]sh -fNL<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-constant z-numeric z-integer z-decimal z-file-descriptor z-shell">1</span><span class="z-keyword z-operator z-assignment z-redirection z-shell">></span> /dev/null</span> <span class="z-keyword z-operator z-logical z-or z-shell">||</span> <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>e</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>\e[31mError: socket not forwarded\e[0m<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">        <span class="z-keyword z-control z-conditional z-end z-shell">fi</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-keyword z-control z-conditional z-end z-shell">fi</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-punctuation z-section z-braces z-end z-shell">}</span></span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> lazydocker over dcm</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-alias z-shell">alias</span> <span class="z-entity z-name z-function z-alias z-shell">ld</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell">lazydocker</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-storage z-type z-function z-shell">function</span> <span class="z-entity z-name z-function z-shell">dcl</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span> <span class="z-punctuation z-section z-braces z-begin z-shell">{</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-variable z-other z-readwrite z-assignment z-shell">DCM_SSH_HOST</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-printf z-shell">printf</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>%s\n<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-expansion z-parameter z-begin z-shell">{</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-variable z-other z-readwrite z-shell">DCM_SSH_HOSTS</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-keyword z-operator z-substitution z-shell">/</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-variable z-parameter z-switch z-shell">/</span></span><span class="z-meta z-group z-expansion z-parameter z-shell">,<span class="z-keyword z-operator z-substitution z-shell">/</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"> </span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-section z-expansion z-parameter z-end z-shell">}</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">fzf</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>exact</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>no-sort</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>height</span> 20<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>reverse</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-keyword z-control z-conditional z-if z-shell">if</span> <span class="z-support z-function z-test z-begin z-shell">[</span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>n</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">DCM_SSH_HOST</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-support z-function z-test z-end z-shell">]</span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-conditional z-then z-shell">then</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">        <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Delete socket </span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">pkill</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>f</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>ssh -fNL <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">DCM_SOCKET_PATH</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ps</span></span><span class="z-meta z-function-call z-arguments z-shell"> aux</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">grep</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>[s]sh -fNL<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">></span> /dev/null <span class="z-constant z-numeric z-integer z-decimal z-file-descriptor z-shell">2</span><span class="z-keyword z-operator z-assignment z-redirection z-shell">>&</span><span class="z-constant z-numeric z-integer z-decimal z-file-descriptor z-shell">1</span></span> <span class="z-keyword z-operator z-logical z-and z-shell">&&</span> <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>e</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>\e[31mError: socket not stopped\e[0m<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">rm</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>f</span> /tmp/remote-docker.sock</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ls</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">DCM_SOCKET_PATH</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">></span> /dev/null <span class="z-constant z-numeric z-integer z-decimal z-file-descriptor z-shell">2</span><span class="z-keyword z-operator z-assignment z-redirection z-shell">>&</span><span class="z-constant z-numeric z-integer z-decimal z-file-descriptor z-shell">1</span></span> <span class="z-keyword z-operator z-logical z-and z-shell">&&</span> <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>e</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>\e[31mError: socket not deleted\e[0m<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">        <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Create socket</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ssh</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>fNL</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">DCM_SOCKET_PATH</span></span>:/var/run/docker.sock <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">DCM_SSH_USER</span></span>@<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">DCM_SSH_HOST</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">DCM_SSH_PORT</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-meta z-function-call z-shell">        <span class="z-storage z-modifier z-shell">export</span> <span class="z-variable z-other z-readwrite z-assignment z-shell">DOCKER_HOST</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>unix://<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">DCM_SOCKET_PATH</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ps</span></span><span class="z-meta z-function-call z-arguments z-shell"> aux</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">grep</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>[s]sh -fNL<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-constant z-numeric z-integer z-decimal z-file-descriptor z-shell">1</span><span class="z-keyword z-operator z-assignment z-redirection z-shell">></span> /dev/null</span> <span class="z-keyword z-operator z-logical z-or z-shell">||</span> <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>e</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>\e[31mError: socket not forwarded\e[0m<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ld</span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">        <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Delete socket </span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">pkill</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>f</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>ssh -fNL <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">DCM_SOCKET_PATH</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ps</span></span><span class="z-meta z-function-call z-arguments z-shell"> aux</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">grep</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>[s]sh -fNL<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">></span> /dev/null <span class="z-constant z-numeric z-integer z-decimal z-file-descriptor z-shell">2</span><span class="z-keyword z-operator z-assignment z-redirection z-shell">>&</span><span class="z-constant z-numeric z-integer z-decimal z-file-descriptor z-shell">1</span></span> <span class="z-keyword z-operator z-logical z-and z-shell">&&</span> <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>e</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>\e[31mError: socket not stopped\e[0m<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">rm</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>f</span> /tmp/remote-docker.sock</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ls</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">DCM_SOCKET_PATH</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">></span> /dev/null <span class="z-constant z-numeric z-integer z-decimal z-file-descriptor z-shell">2</span><span class="z-keyword z-operator z-assignment z-redirection z-shell">>&</span><span class="z-constant z-numeric z-integer z-decimal z-file-descriptor z-shell">1</span></span> <span class="z-keyword z-operator z-logical z-and z-shell">&&</span> <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>e</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>\e[31mError: socket not deleted\e[0m<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">        <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-unset z-shell">unset</span></span><span class="z-meta z-function-call z-arguments z-shell"> DOCKER_HOST</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-keyword z-control z-conditional z-end z-shell">fi</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-punctuation z-section z-braces z-end z-shell">}</span></span>
</span></code></pre><h3 id=ctop><a aria-label="Anchor link for: ctop" class=zola-anchor href=#ctop><i class=icon></i></a> ctop</h3><p><code>scoop install ctop</code> установка в Windows (https://github.com/bcicen/ctop)<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">wget</span></span><span class="z-meta z-function-call z-arguments z-shell"> https://github.com/bcicen/ctop/releases/download/v0.7.7/ctop-0.7.7-linux-amd64<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>O</span> /usr/local/bin/ctop</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">chmod</span></span><span class="z-meta z-function-call z-arguments z-shell"> +x /usr/local/bin/ctop</span>
</span></code></pre><p><code>ctop</code> отображает сводную таблицу (top) CPU, MEM, NET RX/TX, IO R/W <br> <code>o</code> - графики <br> <code>l</code> - логи контейнера в реальном времени <br> <code>s</code> - stop/start <br> <code>R</code> - remove после stop <br> <code>p</code> - pause/unpause <br> <code>r</code> - restart <br> <code>e</code> - exec shell<h3 id=dockly><a aria-label="Anchor link for: dockly" class=zola-anchor href=#dockly><i class=icon></i></a> Dockly</h3><p><code>npm install -g dockly</code> TUI интерфейс на базе Node.js и Blessed.js <br> <code>docker run -it --rm -v /var/run/docker.sock:/var/run/docker.sock lirantal/dockly</code> запуск в Docker <br> <code>dockly</code><h3 id=lazydocker><a aria-label="Anchor link for: lazydocker" class=zola-anchor href=#lazydocker><i class=icon></i></a> LazyDocker</h3><p><code>scoop install lazydocker || choco install lazydocker</code> установка в Windows (https://github.com/jesseduffield/lazydocker)<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">wget</span></span><span class="z-meta z-function-call z-arguments z-shell"> https://github.com/jesseduffield/lazydocker/releases/download/v0.23.1/lazydocker_0.23.1_Linux_x86.tar.gz<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>O</span> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>/lazydocker.tar.gz</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">tar</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>xzf</span> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>/lazydocker.tar.gz lazydocker</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">rm</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>/lazydocker.tar.gz</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">mv</span></span><span class="z-meta z-function-call z-arguments z-shell"> lazydocker /usr/local/bin/lazydocker</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">chmod</span></span><span class="z-meta z-function-call z-arguments z-shell"> +x /usr/local/bin/lazydocker</span>
</span></code></pre><p>lazydocker<h3 id=lazyjournal><a aria-label="Anchor link for: lazyjournal" class=zola-anchor href=#lazyjournal><i class=icon></i></a> Lazyjournal</h3><p><code>curl -sS https://raw.githubusercontent.com/Lifailon/lazyjournal/main/install.sh | bash</code> установка в Unix <br> <code>Invoke-RestMethod https://raw.githubusercontent.com/Lifailon/lazyjournal/main/install.ps1 | Invoke-Expression</code> установка в Windows <br> <code>lazyjournal</code> <br> <code>lazyjournal --help</code> <br> <code>lazyjournal --version</code><h3 id=push><a aria-label="Anchor link for: push" class=zola-anchor href=#push><i class=icon></i></a> Push</h3><p><code>docker login</code> <br> <code>git clone https://github.com/Lifailon/TorAPI</code> <br> <code>cd TorAPI</code> <br> <code>docker build -t lifailon/torapi .</code> собрать образ для публикации на Docker Hub <br> <code>docker push lifailon/torapi</code> загрузить образ на Docker Hub<p><code>docker pull lifailon/torapi:latest</code> загрузить образ из Docker Hub <br> <code>docker run -d --name TorAPI -p 8443:8443 lifailon/torapi:latest</code> загрузить образ и создать контейнер<h3 id=buildx><a aria-label="Anchor link for: buildx" class=zola-anchor href=#buildx><i class=icon></i></a> Buildx</h3><p><code>sudo apt install docker-buildx -y</code> установить систему для мультиплатформенной сборки <br> <code>docker buildx create --use --name multiarch-builder --driver docker-container</code> оздать и запустить сборщик в контейнере <br> <code>docker buildx ls</code> <br> <code>docker buildx rm multiarch-builder</code><p><code>go list -u -m all && go get -u ./...</code> обновить пакеты приложения на Go<p>Добавить аргументы в Dockerfile и передать их в переменные для сборки:<pre class="language-Dockerfile z-code" data-lang=Dockerfile><code class=language-Dockerfile data-lang=Dockerfile><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">ARG </span>TARGETOS TARGETARCH
</span><span class="z-source z-dockerfile">RUN CGO_ENABLED=0 GOOS=${TARGETOS} GOARCH=${TARGETARCH} go build -o /logporter
</span></code></pre><p>docker buildx build –platform linux/amd64,linux/arm64 . docker buildx build –platform linux/amd64,linux/arm64 -t lifailon/logporter –push .<p><code>npm outdated && npm update --save</code> обновить паеты node.jd приложения<p>Передаем аргументы в параметры платформы для образа:<pre class="language-Dockerfile z-code" data-lang=Dockerfile><code class=language-Dockerfile data-lang=Dockerfile><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">ARG </span>TARGETOS TARGETARCH
</span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">FROM</span> --platform=${TARGETOS}/${TARGETARCH} node:alpine AS build
</span></code></pre><h2 id=dockerfile><a aria-label="Anchor link for: dockerfile" class=zola-anchor href=#dockerfile><i class=icon></i></a> Dockerfile</h2><p><code>FROM</code> указывает базовый образ, на основе которого будет создаваться новый образ <br> <code>LABEL</code> добавляет метаданные к образу в формате ключ-значение <br> <code>ENV</code> устанавливает переменные окружения, которые будут доступны внутри контейнера со значениями по умолчанию (можно переопределить через <code>-e</code>, который имеет повышенный приоритет) <br> <code>ARG</code> определяет переменные, которые могут быть переданы и доступны только на этапе сборки образа (выполнения инструкций в dockerfile через <code>docker build --build-arg</code>) и недоступны в контейнере <br> <code>USER</code> устанавливает пользователя, от имени которого будут выполняться следующие команды <br> <code>WORKDIR</code> устанавливает рабочий каталог внутри контейнера для последующих команд <br> <code>SHELL</code> задает командную оболочку, которая будет использоваться для выполнения команд RUN, CMD и ENTRYPOINT (по умолчанию <code>/bin/sh -c</code>, например на <code>SHELL ["/bin/bash", "-c"]</code>) <br> <code>RUN</code> выполняет команды в контейнере во время сборки образа <br> <code>COPY</code> копирует файлы и каталоги из указанного источника на локальной машине в файловую систему контейнера <br> <code>ADD</code> копирует файлы и каталоги в контейнер, поддерживает загрузку файлов из URL и автоматическое извлечение архивов <br> <code>CMD</code> определяет команду, которая будет выполняться при запуске контейнера, может быть переопределена при запуске <br> <code>ENTRYPOINT</code> задает основную команду, которая будет выполняться при запуске контейнера без возможности ее переопредиления, но с возможностью передачи аргументов <br> <code>VOLUME</code> создает точку монтирования для хранения данных в хостовой системе <br> <code>EXPOSE</code> указывает, какие порты контейнера будут доступны извне <br> <code>HEALTHCHECK</code> определяет команду для проверки состояния работающего контейнера <br> <code>ONBUILD</code> задает команды, которые будут автоматически выполнены при сборке дочерних образов <br> <code>STOPSIGNAL</code> определяет сигнал, который будет отправлен контейнеру для его остановки<p>Пример использования <code>ADD</code> для загрузки из <code>url</code>:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">FROM</span></span><span class="z-meta z-function-call z-arguments z-shell"> alpine:latest</span>
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Загрузка и распаковка архива напрямую из GitHub</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ADD</span></span><span class="z-meta z-function-call z-arguments z-shell"> https://github.com/<span class="z-keyword z-operator z-assignment z-redirection z-shell"><</span>username<span class="z-keyword z-operator z-assignment z-redirection z-shell">></span>/<span class="z-keyword z-operator z-assignment z-redirection z-shell"><</span>repository<span class="z-keyword z-operator z-assignment z-redirection z-shell">></span>/archive/refs/heads/main.zip /app/</span>
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Установка инструмента для работы с архивами</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">RUN</span></span><span class="z-meta z-function-call z-arguments z-shell"> apk add<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>no-cache</span> unzip</span> <span class="z-keyword z-operator z-logical z-and z-shell">&&</span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">unzip</span></span><span class="z-meta z-function-call z-arguments z-shell"> /app/main.zip<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>d</span> /app/</span> <span class="z-keyword z-operator z-logical z-and z-shell">&&</span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">rm</span></span><span class="z-meta z-function-call z-arguments z-shell"> /app/main.zip</span>
</span></code></pre><p>Пример сборки приложения на <code>node.js</code>:<p><code>git clone https://github.com/Lifailon/TorAPI</code> <br> <code>cd TorAPI</code> <br> <code>nano Dockerfile</code><pre class="language-Dockerfile z-code" data-lang=Dockerfile><code class=language-Dockerfile data-lang=Dockerfile><span class="z-source z-dockerfile"><span class="z-comment z-dockerfile"><span class="z-punctuation z-definition z-comment z-dockerfile">#</span> Указать базовый образ для сборки, который содержит последнюю версию Node.js и npm
</span></span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">FROM</span> node:<span class="z-entity z-name z-enum z-tag-digest">alpine</span> <span class="z-keyword z-control z-dockerfile">AS</span> <span class="z-variable z-stage-name">build</span>
</span><span class="z-source z-dockerfile"><span class="z-comment z-dockerfile"><span class="z-punctuation z-definition z-comment z-dockerfile">#</span> Установить рабочую директорию для контейнера (все последующие команды будут выполняться относительно этой директории)
</span></span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">WORKDIR </span>/torapi
</span><span class="z-source z-dockerfile"><span class="z-comment z-dockerfile"><span class="z-punctuation z-definition z-comment z-dockerfile">#</span> Копирует файл package.json из текущей директории на хосте в рабочую директорию
</span></span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">COPY</span> package.json ./
</span><span class="z-source z-dockerfile"><span class="z-comment z-dockerfile"><span class="z-punctuation z-definition z-comment z-dockerfile">#</span> Запускает команду (используя оболочку по умолчанию) для установки зависимостей, указанных в package.json
</span></span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">RUN </span>npm install && npm update && npm cache clean --force
</span><span class="z-source z-dockerfile"><span class="z-comment z-dockerfile"><span class="z-punctuation z-definition z-comment z-dockerfile">#</span> Копирует все файлы из текущей директории на хосте в рабочую директорию контейнера
</span></span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">COPY</span> . .
</span><span class="z-source z-dockerfile"><span class="z-comment z-dockerfile"><span class="z-punctuation z-definition z-comment z-dockerfile">#</span> Создает новый рабочий образ для создания контейнера
</span></span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">FROM</span> node:<span class="z-entity z-name z-enum z-tag-digest">alpine</span>
</span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">WORKDIR </span>/torapi
</span><span class="z-source z-dockerfile"><span class="z-comment z-dockerfile"><span class="z-punctuation z-definition z-comment z-dockerfile">#</span> Копирует только те файлы, которые необходимые для работы приложения
</span></span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">COPY</span> --from=<span class="z-variable z-stage-name">build</span> /torapi/node_modules ./node_modules
</span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">COPY</span> --from=<span class="z-variable z-stage-name">build</span> /torapi/package.json ./package.json
</span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">COPY</span> --from=<span class="z-variable z-stage-name">build</span> /torapi/main.js ./main.js
</span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">COPY</span> --from=<span class="z-variable z-stage-name">build</span> /torapi/swagger/swagger.js ./swagger/swagger.js
</span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">COPY</span> --from=<span class="z-variable z-stage-name">build</span> /torapi/category.json ./category.json
</span><span class="z-source z-dockerfile"><span class="z-comment z-dockerfile"><span class="z-punctuation z-definition z-comment z-dockerfile">#</span> Определить переменные окружения по умолчанию, которые могут быть переопределены при запуске контейнера
</span></span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">ENV </span>PORT=8443
</span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">ENV </span>PROXY_ADDRESS=<span class="z-string z-quoted z-double z-dockerfile"><span class="z-punctuation z-definition z-string z-begin z-dockerfile">"</span><span class="z-punctuation z-definition z-string z-end z-dockerfile">"</span></span>
</span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">ENV </span>PROXY_PORT=<span class="z-string z-quoted z-double z-dockerfile"><span class="z-punctuation z-definition z-string z-begin z-dockerfile">"</span><span class="z-punctuation z-definition z-string z-end z-dockerfile">"</span></span>
</span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">ENV </span>USERNAME=<span class="z-string z-quoted z-double z-dockerfile"><span class="z-punctuation z-definition z-string z-begin z-dockerfile">"</span><span class="z-punctuation z-definition z-string z-end z-dockerfile">"</span></span>
</span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">ENV </span>PASSWORD=<span class="z-string z-quoted z-double z-dockerfile"><span class="z-punctuation z-definition z-string z-begin z-dockerfile">"</span><span class="z-punctuation z-definition z-string z-end z-dockerfile">"</span></span>
</span><span class="z-source z-dockerfile"><span class="z-comment z-dockerfile"><span class="z-punctuation z-definition z-comment z-dockerfile">#</span> Открывает порт 8443 для доступа к приложению из контейнера
</span></span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">EXPOSE </span>$PORT
</span><span class="z-source z-dockerfile"><span class="z-comment z-dockerfile"><span class="z-punctuation z-definition z-comment z-dockerfile">#</span> Определить команду для проверки работоспособности контейнера (для примера)
</span></span><span class="z-source z-dockerfile"><span class="z-comment z-dockerfile"><span class="z-punctuation z-definition z-comment z-dockerfile">#</span> Проверка будет запускаться каждые 120 секунд, если команда не завершится за 30 секунд, она будет считаться неуспешной, если команда не проходит 3 раза подряд, контейнер будет помечен как нездоровый
</span></span><span class="z-source z-dockerfile"><span class="z-comment z-dockerfile"><span class="z-punctuation z-definition z-comment z-dockerfile">#</span> Docker будет ждать 5 секунд после старта контейнера перед тем, как начать проверки здоровья
</span></span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">HEALTHCHECK </span>--interval=120s --timeout=30s --retries=3 --start-period=10s \
</span><span class="z-source z-dockerfile">    CMD [<span class="z-string z-quoted z-double z-dockerfile"><span class="z-punctuation z-definition z-string z-begin z-dockerfile">"</span>sh<span class="z-punctuation z-definition z-string z-end z-dockerfile">"</span></span>, <span class="z-string z-quoted z-double z-dockerfile"><span class="z-punctuation z-definition z-string z-begin z-dockerfile">"</span>-c<span class="z-punctuation z-definition z-string z-end z-dockerfile">"</span></span>, <span class="z-string z-quoted z-double z-dockerfile"><span class="z-punctuation z-definition z-string z-begin z-dockerfile">"</span>npm start -- --test<span class="z-punctuation z-definition z-string z-end z-dockerfile">"</span></span>]
</span><span class="z-source z-dockerfile"><span class="z-comment z-dockerfile"><span class="z-punctuation z-definition z-comment z-dockerfile">#</span> Устанавливает команду по умолчанию для запуска приложения при запуске контейнера
</span></span><span class="z-source z-dockerfile"><span class="z-keyword z-operator z-dockerfile">ENTRYPOINT </span>[<span class="z-string z-quoted z-double z-dockerfile"><span class="z-punctuation z-definition z-string z-begin z-dockerfile">"</span>sh<span class="z-punctuation z-definition z-string z-end z-dockerfile">"</span></span>, <span class="z-string z-quoted z-double z-dockerfile"><span class="z-punctuation z-definition z-string z-begin z-dockerfile">"</span>-c<span class="z-punctuation z-definition z-string z-end z-dockerfile">"</span></span>, <span class="z-string z-quoted z-double z-dockerfile"><span class="z-punctuation z-definition z-string z-begin z-dockerfile">"</span>npm start -- --port $PORT --proxyAddress $PROXY_ADDRESS --proxyPort $PROXY_PORT --username $USERNAME --password $PASSWORD<span class="z-punctuation z-definition z-string z-end z-dockerfile">"</span></span>]
</span></code></pre><p><code>docker build -t torapi .</code> собрать образ из dockerfile<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> run<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>d</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>name</span> TorAPI<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span> 8443:8443<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>restart</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>unless-stopped <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">  -</span>e</span> PROXY_ADDRESS=<span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>192.168.3.100<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">  -</span>e</span> PROXY_PORT=<span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>9090<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">  -</span>e</span> USERNAME=<span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>TorAPI<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">  -</span>e</span> PASSWORD=<span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>TorAPI<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell">  torapi</span>
</span></code></pre><h2 id=docker-compose><a aria-label="Anchor link for: docker-compose" class=zola-anchor href=#docker-compose><i class=icon></i></a> Docker Compose</h2><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">mkdir</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">HOME</span></span>/.local/bin</span>
</span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">version</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">curl</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>s</span> https://api.github.com/repos/docker/compose/releases/latest</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">jq</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>r</span> .tag_name</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">curl</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>sSL</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>https://github.com/docker/compose/releases/download/<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">version</span></span>/docker-compose-<span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">uname</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>s</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span>-<span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">uname</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>m</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>o</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">HOME</span></span>/.local/bin/docker-compose</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">chmod</span></span><span class="z-meta z-function-call z-arguments z-shell"> +x <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">HOME</span></span>/.local/bin/docker-compose</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">mkdir</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">HOME</span></span>/.docker/cli-plugins</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">cp</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">HOME</span></span>/.local/bin/docker-compose <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">HOME</span></span>/.docker/cli-plugins/docker-compose</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> compose version</span>
</span></code></pre><h3 id=uptime-kuma><a aria-label="Anchor link for: uptime-kuma" class=zola-anchor href=#uptime-kuma><i class=icon></i></a> Uptime-Kuma</h3><p><a href=https://github.com/louislam/uptime-kuma>Uptime-Kuma</a> - веб-интерфейс для мониторинга доступности хостов (ICMP), портов (TCP), веб-контент (HTTP/HTTPS запросы), gRPC, DNS, контейнеры Docker, базы данных и т.д с поддержкой уведомлений в Telegram.<p><code>nano docker-compose.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">services</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">uptime-kuma</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">image</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">louislam/uptime-kuma:latest</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">container_name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">uptime-kuma</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">volumes</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">uptime-kuma:/app/data</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ports</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>8081:3001<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">restart</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">unless-stopped</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">volumes</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">uptime-kuma</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span></code></pre><p><code>docker-compose up -d</code><p><code>kuma_db=$(docker inspect uptime-kuma | jq -r .[].Mounts.[].Source)</code> место хранения конфигураций в базе SQLite <br> <code>cp $kuma_db/kuma.db $HOME/uptime-kuma-backup.db</code><p>Сгенерировать API ключ: <code>http://192.168.3.101:8081/settings/api-keys</code> <br> <code>curl -u":uk1_fl3JxkSDwGLzQuHk2FVb8z89SCRYq0_3JbXsy73t" http://192.168.3.101:8081/metrics</code><p>Пример конфигурации для Prometheus:<pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">scrape_configs</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">job_name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">uptime-kuma</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">scrape_interval</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">30s</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">metrics_path</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">/metrics</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">static_configs</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">targets</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-quoted z-single z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">'</span>192.168.3.101:8081<span class="z-punctuation z-definition z-string z-end z-yaml">'</span></span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">basic_auth</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">password</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">uk1_fl3JxkSDwGLzQuHk2FVb8z89SCRYq0_3JbXsy73t</span>
</span></code></pre><p>Dashboard для Grafana - <a href=https://grafana.com/grafana/dashboards/18667-uptime-kuma-metrics>Uptime Kuma - SLA/Latency/Certs</a> (id 18667)<p><a href=https://github.com/MedAziz11/Uptime-Kuma-Web-API>Uptime-Kuma-Web-API</a> - оболочка API и Swagger документация написанная на Python с использованием FastAPI и <a href=https://github.com/lucasheld/uptime-kuma-api>Uptime-Kuma-API</a>.<p><code>nano docker-compose.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">services</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Web (frontend)
</span></span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">uptime-kuma</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">container_name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">uptime-kuma</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">image</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">louislam/uptime-kuma:latest</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ports</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>8081:3001<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">restart</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">unless-stopped</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">volumes</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">./kuma_data:/app/data</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> API (backend)
</span></span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">uptime-kuma-api</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">container_name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">uptime-kuma-api</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">image</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">medaziz11/uptimekuma_restapi</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">volumes</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">./kuma_api:/db</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">restart</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">unless-stopped</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">environment</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">KUMA_SERVER=http://uptime-kuma:3001</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">KUMA_USERNAME=admin</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">KUMA_PASSWORD=KumaAdmin</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ADMIN_PASSWORD=KumaApiAdmin</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">depends_on</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">uptime-kuma</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ports</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>8082:8000<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span></code></pre><p><code>docker-compose up -d</code><p>OpenAPI Docs (Swagger): http://192.168.3.101:8082/docs<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">TOKEN</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">curl</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>sS</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>X</span> POST http://192.168.3.101:8082/login/access-token<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>data</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>username=admin<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>data</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>password=KumaApiAdmin<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">jq</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>r</span> .access_token</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">curl</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>s</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>X</span> GET<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>H</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>Authorization: Bearer <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-expansion z-parameter z-begin z-shell">{</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-variable z-other z-readwrite z-shell">TOKEN</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-section z-expansion z-parameter z-end z-shell">}</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> http://192.168.3.101:8082/monitors</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">jq</span></span><span class="z-meta z-function-call z-arguments z-shell"> .</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">curl</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>s</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>X</span> GET<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>H</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>Authorization: Bearer <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-expansion z-parameter z-begin z-shell">{</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-variable z-other z-readwrite z-shell">TOKEN</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-section z-expansion z-parameter z-end z-shell">}</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> http://192.168.3.101:8082/monitors/1</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">jq</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>.monitor | "\(.name) - \(.active)"<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span>
</span></code></pre><h3 id=dozzle><a aria-label="Anchor link for: dozzle" class=zola-anchor href=#dozzle><i class=icon></i></a> Dozzle</h3><p>Dozzle (https://github.com/amir20/dozzle) - легковесное приложение с веб-интерфейсом для мониторинга журналов Docker (без хранения).<p><code>mkdir dozzle && cd dozzle && mkdir dozzle_data</code><p><code>echo -n DozzleAdmin | shasum -a 256</code> получить пароль в формате sha-256 и передать в конфигурацию<p><code>nano ./dozzle_data/users.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">users</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">admin</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>admin<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">password</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>a800c3ee4dac5102ed13ba673589077cf0a87a7ddaff59882bb3c08f275a516e<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span></code></pre><p>Запускаем контейнер:<pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">services</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">dozzle</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">image</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">amir20/dozzle:latest</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">container_name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">dozzle</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">restart</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">unless-stopped</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">volumes</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">/var/run/docker.sock:/var/run/docker.sock</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">./dozzle_data:/data</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">environment</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">VIRTUAL_HOST=dozzle.local</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">DOZZLE_AUTH_PROVIDER=simple</span>
</span><span class="z-source z-yaml">      <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Подключиться к удаленному хосту через Docker API (tcp socket)
</span></span><span class="z-source z-yaml">      <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> - DOZZLE_REMOTE_HOST=tcp://192.168.3.101:2375|us-101
</span></span><span class="z-source z-yaml">      <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Подключиться к удаленному хосту через Dozzle Agent
</span></span><span class="z-source z-yaml">      <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> - DOZZLE_REMOTE_AGENT=192.168.3.106:7007
</span></span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ports</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">9090:8080</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Контейнер для мониторинга файла syslog на хостовой системе
</span></span><span class="z-source z-yaml">  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> dozzle-syslog:
</span></span><span class="z-source z-yaml">  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>   image: alpine
</span></span><span class="z-source z-yaml">  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>   container_name: dozzle-syslog
</span></span><span class="z-source z-yaml">  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>   restart: unless-stopped
</span></span><span class="z-source z-yaml">  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>   volumes:
</span></span><span class="z-source z-yaml">  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>     - /var/log/syslog:/var/log/custom.log
</span></span><span class="z-source z-yaml">  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>   command:
</span></span><span class="z-source z-yaml">  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>     - tail
</span></span><span class="z-source z-yaml">  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>     - -f
</span></span><span class="z-source z-yaml">  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>     - /var/log/custom.log
</span></span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Контейнер для мониторинга файлов из директории /var/log на хостовой системе
</span></span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">dozzle-varlog</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">image</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">lifailon/dozzle-varlog:latest</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">container_name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">dozzle-varlog</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">restart</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">unless-stopped</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">volumes</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">/var/log:/logs</span>
</span></code></pre><p><code>docker-compose up -d</code><p>Контейнер на агенте:<pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">services</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">dozzle-agent</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">image</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">amir20/dozzle:latest</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">container_name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">dozzle-agent</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">restart</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">unless-stopped</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">command</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">agent</span>
</span><span class="z-source z-yaml">    <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> environment:
</span></span><span class="z-source z-yaml">    <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>   - DOZZLE_HOSTNAME=dozzle-agent-01
</span></span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">volumes</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">/var/run/docker.sock:/var/run/docker.sock:ro</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">healthcheck</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">test</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-meta z-flow-sequence z-yaml"><span class="z-punctuation z-definition z-sequence z-begin z-yaml">[</span><span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>CMD<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span><span class="z-punctuation z-separator z-sequence z-yaml">,</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>/dozzle<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span><span class="z-punctuation z-separator z-sequence z-yaml">,</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>healthcheck<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span><span class="z-punctuation z-definition z-sequence z-end z-yaml">]</span></span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">interval</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">5s</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">retries</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">5</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">start_period</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">5s</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">start_interval</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">5s</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ports</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">7007:7007</span>
</span></code></pre><h3 id=watchtower><a aria-label="Anchor link for: watchtower" class=zola-anchor href=#watchtower><i class=icon></i></a> Watchtower</h3><p><a href=https://github.com/containrrr/watchtower>Watchtower</a> - следит за тегом <code>latest</code> в реестре Docker Hub и обновлять контейнер, если он станет устаревшим.<pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">services</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">watchtower</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">image</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">containrrr/watchtower</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">container_name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">watchtower</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">restart</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">unless-stopped</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">volumes</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">/var/run/docker.sock:/var/run/docker.sock</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">environment</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">WATCHTOWER_NOTIFICATIONS=shoutrrr</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">WATCHTOWER_NOTIFICATIONS_HOSTNAME=&LTHOST_NAME></span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">WATCHTOWER_NOTIFICATION_URL=telegram://&LTBOT_API_KEY>@telegram/?channels=&LTCHAT/CHANNEL_ID></span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">WATCHTOWER_HTTP_API_TOKEN=demotoken</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">command</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">--interval 600</span> <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> --http-api-metrics # --http-api-token demotoken # --http-api-update
</span></span><span class="z-source z-yaml">    <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> ports:
</span></span><span class="z-source z-yaml">    <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>   - 9095:8080
</span></span></code></pre><p><code>docker-compose up -d</code><p>Проброс потра используется для получения метрик через Prometheus (команда <code>--http-api-metrics</code>) с токеном доступа. Если нужно запускать обновления только через API, нужно добавить команду <code>--http-api-update</code>, или указать команду <code>--http-api-periodic-polls</code>, что бы использовать ручное и автоматическое обновление.<p><code>curl -H "Authorization: Bearer demotoken" http://192.168.3.101:8070/v1/metrics</code> получить метрики <br> <code>curl -H "Authorization: Bearer demotoken" http://192.168.3.101:8070/v1/update</code> проверить и запустить обновления<p>Добавить <code>scrape_configs</code> в <code>prometheus.yml</code> для сбора метрик:<pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">scrape_configs</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">job_name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">watchtower</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">scrape_interval</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">5s</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">metrics_path</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">/v1/metrics</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">bearer_token</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">demotoken</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">static_configs</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">targets</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-quoted z-single z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">'</span>192.168.3.101:8070<span class="z-punctuation z-definition z-string z-end z-yaml">'</span></span>
</span></code></pre><p><code>docker-compose restart prometheus</code><p>Чтобы исключить обновления, нужно добавить “lable” при запуске контейнера:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> run<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>d</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>name</span> kinozal-bot <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">  -</span>v</span> /home/lifailon/kinozal-bot/torrents:/home/lifailon/kinozal-bot/torrents <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">  --</span>restart</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>unless-stopped <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">  --</span>label</span> com.centurylinklabs.watchtower.enable=false <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell">  kinozal-bot</span>
</span></code></pre><h3 id=portainer><a aria-label="Anchor link for: portainer" class=zola-anchor href=#portainer><i class=icon></i></a> Portainer</h3><p><code>curl -L https://downloads.portainer.io/portainer-agent-stack.yml -o portainer-agent-stack.yml</code> скачать yaml файл <br> <code>version_update=$(cat portainer-agent-stack.yml | sed "s/2.11.1/latest/g")</code> <br> <code>printf "%s\n" "$version_update" > portainer-agent-stack.yml</code> обновить версию в yaml файле на последнюю доступную в Docker Hub (2.19.5) <br> <code>docker stack deploy -c portainer-agent-stack.yml portainer</code> развернуть в кластере swarm (на каждом node будет установлен агент, который будет собирать данные, а на manager будет установлен сервер с web панелью) <br> https://192.168.3.101:9443<p><code>docker run -d --name portainer_agent -p 9001:9001 --restart=always -v /var/run/docker.sock:/var/run/docker.sock -v /var/lib/docker/volumes:/var/lib/docker/volumes portainer/agent:2.19.5</code> установить агент на удаленный хост <br> https://192.168.3.101:9443/#!/endpoints добавить удаленный хост по URL 192.168.3.102:9001<p><code>docker volume create portainer_data</code> создать volume для установки локального контейнера (не в кластер swarm) <br> <code>docker create -it --name=portainer -p 9000:9000 --restart=always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer</code> создать локальный контейнер <br> <code>docker start portainer</code> <br> http://192.168.3.101:9000<h2 id=docker-dotnet><a aria-label="Anchor link for: docker-dotnet" class=zola-anchor href=#docker-dotnet><i class=icon></i></a> Docker.DotNet</h2><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Импорт библиотеки Docker.DotNet (https://nuget.info/packages/Docker.DotNet/3.125.15)<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Add-Type</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Path <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Documents\Docker.DotNet-3.125.15\lib\netstandard2.1\Docker.DotNet.dll<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Указываем адрес удаленного сервера Docker, на котором слушает сокет Docker API<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>config</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">Docker.DotNet.DockerClientConfiguration</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::new<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>http://192.168.3.102:2375<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Подключаемся клиентом<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>client</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>config<span class="z-variable z-other z-member z-powershell">.CreateClient</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Получить список методов класса клиента<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>client</span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-support z-function z-powershell">Get-Member</span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Выводим список контейнеров<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>containers</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>client<span class="z-variable z-other z-member z-powershell">.Containers.ListContainersAsync</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">Docker.DotNet.Models.ContainersListParameters</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::new<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.GetAwaiter<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.GetResult<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Забираем id по имени<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>kuma_id</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-group z-complex z-subexpression z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>containers</span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-support z-function z-powershell">Where-Object</span> names <span class="z-keyword z-operator z-comparison z-powershell">-match</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>uptime-kuma-front<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span>.id
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Получить список дочерних методов<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>client<span class="z-variable z-other z-member z-powershell">.Containers</span></span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-support z-function z-powershell">Get-Member</span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Остановить контейнер по его id<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>StopParameters</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">Docker.DotNet.Models.ContainerStopParameters</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::new<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>client<span class="z-variable z-other z-member z-powershell">.Containers.StopContainerAsync</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>kuma_id</span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>StopParameters</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Запустить контейнер<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>StartParameters</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">Docker.DotNet.Models.ContainerStartParameters</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::new<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>client<span class="z-variable z-other z-member z-powershell">.Containers.StartContainerAsync</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>kuma_id</span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>StartParameters</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></code></pre><h2 id=swarm><a aria-label="Anchor link for: swarm" class=zola-anchor href=#swarm><i class=icon></i></a> Swarm</h2><p><code>docker swarm init</code> инициализировать <code>manager node</code> и получить токен для подключения <code>worker node</code> (на сервере) <br> <code>docker swarm join-token worker</code> получить токен для подключения <code>worker</code> или <code>manager</code> <br> <code>docker swarm join --token SWMTKN-1-1a078rm7vuenefp6me84t4swqtvdoveu6dh2pw34xjcf2gyw33-81f8r32jt3kkpk4dqnt0oort9 192.168.3.101:2377</code> подключение на worker node (на клиенте) <br> <code>docker node ls</code> отобразить список node на manager node <br> <code>docker node inspect u4u897mxb1oo39pbj5oezd3um</code> подробная информация (конфигурация) о node по id <br> <code>docker swarm leave --force</code> выйти из кластера на <code>worker node</code> (на <code>manager node</code> изменится статус с <code>Ready</code> на <code>Down</code>) <br> <code>docker node rm u4u897mxb1oo39pbj5oezd3um</code> удалить node (со статусом <code>Down</code>) на <code>manager node</code> <br> <code>docker swarm init --force-new-cluster</code> заново инициализировать кластер (если упал, при наличии одного менеджера)<p><code>docker pull lifailon/torapi:latest</code> <br> <code>nano docker-stack.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">services</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">torapi</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">image</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">lifailon/torapi:latest</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">labels</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">          <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">com.centurylinklabs.watchtower.enable=false</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">deploy</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Режим развертывания
</span></span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">mode</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">replicated</span>                  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Фиксированное число реплик (по умолчанию)
</span></span><span class="z-source z-yaml">      <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> mode: global                    # Одна копия на каждой ноде
</span></span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">replicas</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">2</span>                       <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Суммарное количество реплик на всех нодах (только в режиме replicated)
</span></span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">      <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Политика перезапуска
</span></span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">restart_policy</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">condition</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">on-failure</span>           <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Перезапускать только при ошибках (ненулевой код выхода)
</span></span><span class="z-source z-yaml">        <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> condition: any                # Всегда перезапускать (аналог always в docker-compose)
</span></span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">delay</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">5s</span>                       <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Задержка перед перезапуском (по умолчанию, 5 секунд)
</span></span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">max_attempts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">3</span>                 <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Максимум попыток перезапуска (по умолчанию, бесконечно)
</span></span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">window</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">30s</span>                     <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Время для оценки успешности перезапуска (по умолчанию, 0)
</span></span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">      <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Политика обновления (старые контейнеры не удаляются сразу, а только останавливаются и создаются новые с обновленными образами)
</span></span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">update_config</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">parallelism</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">1</span>                  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Количество реплик для одновременного обновения (по умолчанию, 1)
</span></span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">delay</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">10s</span>                      <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Задержка между обновлениями (по умолчанию, 0 секунд)
</span></span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">order</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">start-first</span>              <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Порядок: start-first (сначала новый) или stop-first (сначала старый, по умолчанию)
</span></span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">failure_action</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">rollback</span>        <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Действие при ошибке: continue, rollback, pause (по умолчанию, pause)
</span></span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">monitor</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">60s</span>                    <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Время мониторинга после обновления (по умолчанию, 0)
</span></span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">      <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Политика отката (конфигурация аналогична update_config) при статусе unhealthy на новых контейнерах после update_config
</span></span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">rollback_config</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">parallelism</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">1</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">delay</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">10s</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">order</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">stop-first</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">failure_action</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">pause</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">monitor</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">60s</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">      <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Ограничения размещения
</span></span><span class="z-source z-yaml">      <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>   placement:
</span></span><span class="z-source z-yaml">      <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>     constraints:
</span></span><span class="z-source z-yaml">      <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>       - "node.role==worker"     # Только на worker-нодах
</span></span><span class="z-source z-yaml">      <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>       - "node.labels.env==dev"  # Только на нодах с указаной меткой
</span></span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">      <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Ограничения ресурсов
</span></span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">resources</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">limits</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">          <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">cpus</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>0.5<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>                   <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Лимит CPU (0.5 = 50%)
</span></span><span class="z-source z-yaml">          <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">memory</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">256M</span>                  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Лимит RAM
</span></span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">reservations</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">          <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">cpus</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>0.1<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>                   <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Гарантированные CPU
</span></span><span class="z-source z-yaml">          <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">memory</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">128M</span>                  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Гарантированная RAM
</span></span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">      <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Режим балансировки (конечной точки)
</span></span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">endpoint_mode</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">vip</span>                <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Балансировка через виртуальный IP внутри сети swarm
</span></span><span class="z-source z-yaml">      <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> endpoint_mode: dnsrr            # Балансировка через DNS в режиме Round-Robin
</span></span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">    <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Проверка здоровья (задается вне deploy)
</span></span><span class="z-source z-yaml">    <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Необходимо для работы:
</span></span><span class="z-source z-yaml">    <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> 1. endpoint_mode - при статусе unhealthy исключает контейнер из балансировки
</span></span><span class="z-source z-yaml">    <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> 2. restart_policy - пытается перезапустить контейнер
</span></span><span class="z-source z-yaml">    <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> 3. update_config - ждет успешного прохождения healthcheck (статус healthy) перед обновлением следующей реплики или запускает rollback_config
</span></span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">healthcheck</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">test</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-meta z-flow-sequence z-yaml"><span class="z-punctuation z-definition z-sequence z-begin z-yaml">[</span><span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>CMD<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span><span class="z-punctuation z-separator z-sequence z-yaml">,</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>curl<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span><span class="z-punctuation z-separator z-sequence z-yaml">,</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>-f<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span><span class="z-punctuation z-separator z-sequence z-yaml">,</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>http://127.0.0.1:8443/api/provider/list<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span><span class="z-punctuation z-definition z-sequence z-end z-yaml">]</span></span> <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> HTTP проверка статуса ответа (0 = успех, 1 = ошибка)
</span></span><span class="z-source z-yaml">    <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> test: ["CMD", "nc", "-z", "127.0.0.1 8443"] # TCP проверка порта
</span></span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">interval</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">30s</span>                     <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Интервал между проверками (по умолчанию, 30  секунд)
</span></span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">timeout</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">10s</span>                      <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Время ожидания ответа (по умолчанию, 30 секунд)
</span></span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">retries</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">3</span>                        <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Количество попыток перед объявлением статуса unhealthy
</span></span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">start_period</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">15s</span>                 <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Время на инициализацию перед проверками (по умолчанию, 0 секунд)
</span></span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ports</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">target</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">8443</span>                    <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Порт контейнера
</span></span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">published</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">8443</span>                 <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Порт на хосте
</span></span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">protocol</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">tcp</span>                   <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Протокол (tcp/udp)
</span></span><span class="z-source z-yaml">        <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Режим балансировки
</span></span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">mode</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ingress</span>                   <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Балансировка через Swarm (только в режиме vip)
</span></span><span class="z-source z-yaml">        <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> mode: host                    # Балансировка через хостовую систему (прямой проброс, только в режиме dnsrr)
</span></span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">volumes</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> - type: config                    # Swarm Configs (статические конфиги, права только на чтение)
</span></span><span class="z-source z-yaml">    <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> - type: secret                    # Swarm Secrets (пароли, TLS-ключи. и т.п.)
</span></span><span class="z-source z-yaml">    <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> - type: nfs                       # Удалённый NFS-сервер для общих данных в кластере
</span></span><span class="z-source z-yaml">    <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> - type: tmpfs                     # RAM Временные файлы (/tmp)
</span></span><span class="z-source z-yaml">    <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> - type: bind                      # Файлы на хосте (только если файлы есть на всех нодах)
</span></span><span class="z-source z-yaml">    <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">type</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">volume</span>                    <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Управляется Docker (данные БД, кеш)
</span></span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">source</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">torapi</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">target</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">/rotapi</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">volumes</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">torapi</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span></code></pre><p><code>docker stack deploy -c docker-stack.yml TorAPI</code> собрать стек сервисов (на <code>worker node</code> появится контейнер <code>TorAPI_torapi.1.ug5ngdlqkl76dt</code>)<p><code>docker stack ls</code> отобразить список стеков (название стека и количество в нем сервисов, без учета реплик) <br> <code>docker stack services TorAPI</code> аналог <code>docker service ls</code>, но для отображения списока сервисов указанного стека <br> <code>docker service ls</code> отобразить список всех сервисов для всех стеков (имя формате <code>&LTstackName_serviceName></code>, с количеством и статусом реплик)<p><code>docker stack ps TorAPI</code> статистика работы всех сервисов внутри стека (аналог <code>docker ps</code>) <br> <code>docker service ps TorAPI_torapi</code> аналог <code>docker stack ps</code>, но для отображения статистики указанного сервиса <br> <code>docker service logs TorAPI_torapi -fn 0</code> просмотреть логи сервиса по всех репликам кластера одновременно<p><code>docker node update --label-add dev=true iebj3itgan6xso8px00i3nizc</code> добавить ноду в группу по метке для линковки при запуске <br> <code>docker service update --image lifailon/torapi:fake TorAPI_torapi</code> запустить обновление образа для сервиса <br> <code>docker service scale TorAPI_torapi=3</code> масштабировать сервис до указанного числа реплик<p><code>docker service inspect --pretty TorAPI_torapi</code> отобразить конфигурацию сервиса <br> <code>docker service inspect TorAPI_torapi</code> отобразить подробную конфигурацию сервиса в формате <code>json</code> <br> <code>docker stack rm TorAPI</code> удалить стек (не требует остановки контейнеров)<h2 id=kubernetes><a aria-label="Anchor link for: kubernetes" class=zola-anchor href=#kubernetes><i class=icon></i></a> Kubernetes</h2><p><code>Node</code> - Физическая или виртуальная машина, входящая в состав кластера. На каждом узле работает kubelet (агент Kubernetes) и контейнерная среда. <br> <code>Pod</code> - наименьшая и самая простая единица в Kubernetes. Содержит один или несколько контейнеров, которые разделяют одно сетевое пространство (общий IP и порты) и имеют общие тома (volumes) для хранения данных. <br> <code>Deployment</code> - управляет состоянием группы идентичных подов (реплик). Отвечает за их масштабируемость (увеличение или уменьшение числа подов), восстановление (перезапуск подов при сбоях), обновление (rolling updates) и откат (rollback) версий приложения. <br> <code>Service</code> - отвечает за балансировку нагрузки (обрабатывает входящий трафик и распределяет его между подами), а также обеспечивая постоянный IP-адрес и DNS-имя, даже в случае их пересоздания. <br> <code>ConfigMap</code> и <code>Secret</code> – хранит конфигурационные данные (например, настройки приложения) в виде пар “ключ-значение” или содержимого файлов (в открытом или зашифрованном виде).<h3 id=minikube><a aria-label="Anchor link for: minikube" class=zola-anchor href=#minikube><i class=icon></i></a> Minikube</h3><p><a href=https://github.com/kubernetes/minikube>Minikube</a> - это локальный кластер (одноузловой экземпляр, запускаемый в виртуальной среде) Kubernetes от создателя оригинального k8s.<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">curl</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>LO</span> https://storage.googleapis.com/minikube/releases/latest/minikube-windows-amd64.exe</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">mv</span></span><span class="z-meta z-function-call z-arguments z-shell"> minikube-windows-amd64.exe minikube.exe</span>
</span></code></pre><p><code>sudo cp ~/.minikube/ca.crt /usr/local/share/ca-certificates/minikube.crt && update-ca-certificates && openssl verify /usr/local/share/ca-certificates/minikube.crt</code> установка сертификатов в Linux <br> <code>Import-Certificate -FilePath "$HOME\.minikube\ca.crt" -CertStoreLocation Cert:\LocalMachine\Root && Import-Certificate -FilePath "$HOME\.minikube\profiles\minikube\client.crt" -CertStoreLocation Cert:\CurrentUser\My && ls Cert:\LocalMachine\Root | Where-Object Subject -Match "minikube"</code> установка сертификатов в Windows<p><code>minikube start --vm-driver=hyperv --memory=4g --cpus=2</code> запустить кластер и создать виртуальную машину <br> <code>minikube status</code> статус работы кластера <br> <code>minikube stop</code> остановить кластер <br> <code>minikube delete</code> удалить виртуальную машину <br> <code>minikube profile list</code> узнать информацию о драйвере, ip, версии и количество Nodes <br> <code>minikube dashboard --port 8085</code> запустить api сервер и интерфейс состояния<p><code>minikube addons list</code> список доступных дополнений и их статус работы <br> <code>minikube addons enable metrics-server</code> активировать дополнение, которое предоставляет метрики для HPA, такие как загрузка процессора и использование памяти <br> <code>kubectl get deployment metrics-server -n kube-system</code> текущее состояние развертывания metrics-server в кластере <br> <code>kubectl get pod,svc -n kube-system</code> отобразить список системных подов и сервисов в кластере (pod/metrics-server-7fbb699795-wvfxb) <br> <code>kubectl logs -n kube-system deployment/metrics-server</code> отобразить логи metrics-server <br> <code>kubectl top pods</code> отобразить метрики на подах (CPU/MEM) <br> <code>minikube addons disable metrics-server</code> отключить дополнение<p><code>minikube addons enable ingress</code> включить Nginx Ingress Controller <br> <code>kubectl get pods -n kube-system</code> отобразить список системных подов (должен появиться ingress-nginx-controller) <br> <code>minikube tunnel --alsologtostderr</code> создает виртуальный LoadBalancer в Minikube, для перенаправления трафика на нужный сервис, вместо использования NodePort<h3 id=microk8s><a aria-label="Anchor link for: microk8s" class=zola-anchor href=#microk8s><i class=icon></i></a> Microk8s</h3><p><a href=https://github.com/canonical/microk8s>Microk8s</a> - это полностью совместимый и легкий Kubernetes в одном пакете, работающий на 42 разновидностях Linux от компании Canonical.<p><code>snap install microk8s --classic</code> установка <br> <code>microk8s status --wait-ready</code> отобразить статус работы (дождаться инициализации служб Kubernetes) и список дополнений <br> <code>microk8s start</code> запустить или остановить (<code>stop</code>) MicroK8s и его службы <br> <code>microk8s enable dashboard</code> запустить dashboard <br> <code>microk8s enable dns</code> установка обновлений <br> <code>sudo usermod -a -G microk8s $USER && mkdir -p ~/.kube && chmod 0700 ~/.kube</code> добавить текущего пользователя в группу управления microk8s (создается при установке) <br> <code>alias kubectl='microk8s kubectl'</code> добавить псевдоним, для использования команды kubectl через microk8s <br> <code>kubectl get nodes</code> отобразить список нод <br> <code>kubectl config view --raw > $HOME/.kube/config</code> передать конфигурацию в MicroK8s, для использования с существующим kubectl<h3 id=k3s><a aria-label="Anchor link for: k3s" class=zola-anchor href=#k3s><i class=icon></i></a> K3s</h3><p><a href=https://github.com/k3s-io/k3s>K3s</a> — это полностью совместимый дистрибутив Kubernetes в формате единого двоичного файле, который удаляет хранение драйверов и поставщика облачных услуг, а также добавляет поддержку <code>sqlite3</code> для <code>backend</code> хранилища от компании Rancher Labs (SUSE).<p><code>curl -sfL https://get.k3s.io | sh -</code> установка службы в systemd и утилит <code>kubectl</code>, <code>crictl</code>, <code>k3s-killall.sh</code> и <code>k3s-uninstall.sh</code> <br> <code>sudo chmod 644 /etc/rancher/k3s/k3s.yaml && sudo chown $(id -u):$(id -g) /etc/rancher/k3s/k3s.yaml</code> назначить права на конфигурацию текущему пользователю <br> <code>sudo cat /var/lib/rancher/k3s/server/node-token</code> токен авторизации <br> <code>curl -sfL https://get.k3s.io | K3S_URL=https://192.168.3.101:6443 K3S_TOKEN=&LTTOKEN> sh -</code> передать переменные окружения <code>K3S_URL</code> и <code>K3S_TOKEN</code> токен для установки на рабочие ноды (команда удаления: <code>sudo /usr/local/bin/k3s-agent-uninstall.sh</code>) <br> <code>sudo nano /boot/firmware/cmdline.txt</code> включить cgroups v1 вместо v2 => <code>systemd.unified_cgroup_hierarchy=0 cgroup_enable=memory cgroup_memory=1</code> <br> <code>k3s kubectl get nodes</code> отобразить список нод в кластере <br> <code>sudo k3s crictl ps</code> отобразить список всех запущенных контейнеров, включая системные для работы класетра <br> <code>sudo k3s etcd-snapshot save</code> создать снапшот etcd (распределённого <code>key-value</code> хранилища, которое отвечает за состояние всего кластера Kubernetes) <br> <code>sudo k3s etcd-snapshot restor</code> восстановление кластера из снапшота<h3 id=dashboard><a aria-label="Anchor link for: dashboard" class=zola-anchor href=#dashboard><i class=icon></i></a> Dashboard</h3><p>Пример развертывания Kubernetes Dashboard в кластере k3s:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">kubectl</span></span><span class="z-meta z-function-call z-arguments z-shell"> apply<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>f</span> https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> загружаем deployment</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">kubectl</span></span><span class="z-meta z-function-call z-arguments z-shell"> create serviceaccount dashboard-admin<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>n</span> kubernetes-dashboard <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> создаем сервисный аккаунт</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">kubectl</span></span><span class="z-meta z-function-call z-arguments z-shell"> create clusterrolebinding dashboard-admin<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>clusterrole</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>cluster-admin<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>serviceaccount</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>kubernetes-dashboard:dashboard-admin <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> выдаем права cluster-admin</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">kubectl</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>n</span> kubernetes-dashboard create token dashboard-admin <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> получаем JWT-токен сервисного аккаунта для авторизации</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">kubectl</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>n</span> kubernetes-dashboard patch svc kubernetes-dashboard-kong-proxy<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>{"spec":{"type":"NodePort"}}<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span> <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> меняем тип сервиса на NodePort</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">kubectl</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>n</span> kubernetes-dashboard get svc kubernetes-dashboard-kong-proxy <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> узнаем назначенный порт (в диапазоне 30000-32767) для внешнего подключения</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span></code></pre><h3 id=headlamp><a aria-label="Anchor link for: headlamp" class=zola-anchor href=#headlamp><i class=icon></i></a> Headlamp</h3><p><a href=https://github.com/kubernetes-sigs/headlamp>Headlamp</a> - это современная альтернатива Dashboard c расширенным функционалом, созданная сообществом Kubernetes Special Interest Groups.<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">kubectl</span></span><span class="z-meta z-function-call z-arguments z-shell"> apply<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>f</span> https://raw.githubusercontent.com/kubernetes-sigs/headlamp/main/kubernetes-headlamp.yaml <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> установка в кластер</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">kubectl</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>n</span> kube-system create serviceaccount headlamp-admin <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> создать сервисный аккаунт</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">kubectl</span></span><span class="z-meta z-function-call z-arguments z-shell"> create clusterrolebinding headlamp-admin<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>serviceaccount</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>kube-system:headlamp-admin<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>clusterrole</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>cluster-admin <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> назначить права администратора кластера для сервисного аккаунта</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">kubectl</span></span><span class="z-meta z-function-call z-arguments z-shell"> create token headlamp-admin<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>n</span> kube-system<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>duration</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>43800h <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> выпустить токен для авторизации сроком действия 5 лет</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span></code></pre><h3 id=k9s><a aria-label="Anchor link for: k9s" class=zola-anchor href=#k9s><i class=icon></i></a> k9s</h3><p><a href=https://github.com/derailed/k9s>K9s</a> - это TUI интерфейс для взаимодействия с кластерами Kubernetes (управление и чтение логов).<p><code>wget https://github.com/derailed/k9s/releases/latest/download/k9s_linux_amd64.deb && sudo apt install ./k9s_linux_amd64.deb && rm k9s_linux_amd64.deb</code> установка в системе с архитектурой <code>amd64</code> <br> <code>wget https://github.com/derailed/k9s/releases/latest/download/k9s_linux_arm64.deb && sudo apt install ./k9s_linux_arm64.deb && rm k9s_linux_arm64.deb</code> установка в системе с архитектурой <code>arm64</code> <br> <code>winget install k9s || scoop install k9s || choco install k9s || curl.exe -A MS https://webinstall.dev/k9s | powershell</code> установка в Windows<h3 id=kubectl><a aria-label="Anchor link for: kubectl" class=zola-anchor href=#kubectl><i class=icon></i></a> kubectl</h3><p><code>kubectl get nodes</code> отобразить список <code>node</code> и их статус работы, роль (<code>master</code> или <code>node</code>), время запуска и версию<p><code>kubectl get namespaces</code> вывести список все доступных пространств имен (<code>namespace</code>) <code>kubectl config view</code> отобразить текущую конфигурацию (настройка подключения kubectl к Kubernetes, которое взаимодействует с приложением через конечные точки <code>REST API</code>) <br> <code>kubectl config set-context --current --namespace=kubernetes-dashboard</code> сменить context в конфигурации<p><code>kubectl create deployment torapi --image=torapi --replicas=3 --dry-run=client -o yaml</code> генерация манифеста <code>deployment.yaml</code> <br> <code>kubectl create service loadbalancer torapi --tcp=8444:8443 --dry-run=client -o yaml</code> генерация манифеста <code>service.yaml</code> (<code>&LTport>:&LTtargetPort></code>)<p><code>kubectl get deployments</code> отобразить статус всех Deployments в указанном namespace (<code>-n kubernetes-dashboard</code>), которые в свою очередь управляют Pod-ами (<code>RADY</code> - текущее количество желаемых реплик в рабочем состояние, например, 2 из 2 и <code>UP-TO-DATE</code> — количество реплик, обновленных до последней версии)<p><code>kubectl get pods</code> статус всех подов <br> <code>kubectl get pods -o wide</code> отобразить количество всех подов и на какой ноде он работает (у каждого пода свой ip-адрес) <br> <code>kubectl get pods -o json</code> отобразить подробный вывод в формате <code>json</code> <br> <code>kubectl get pods -o jsonpath='{range .items[*]}{.spec.nodeName}{": "}{.metadata.name}{"\n"}{end}'</code> фильтрация по <code>json</code> как в <code>jq</code> <br> <code>kubectl get pods -o go-template --template '{{range .items}}{{.metadata.name}}{{"\n"}}{{end}}'</code> получить список имен всех под через шаблон фильтра<p><code>kubectl get services</code> отобразить список сервисов (их <code>TYPE</code>, <code>CLUSTER-IP</code>, <code>EXTERNAL-IP</code> и <code>PORT(S)</code>), которые принимают внешний трафик <br> <code>kubectl describe services torapi-service</code> отобразить настройки сервиса для внешнего доступа (ip, тип сервиса и конечные точки) <br> <code>kubectl get endpoints torapi-service</code> отобразить на какие адреса (ip и порт) подов перенаправляется трафик сервиса<p><code>kubectl describe pods torapi-54775d94b8-t2dhm</code> отобразить какие контейнеры находятся внутри пода и на каких нодах запущены <br> <code>kubectl logs torapi-54775d94b8-t2dhm</code> отобразить логи выбранного контейнера в поде (сообщения, которые приложение отправляет в <code>stdout</code>) <br> <code>kubectl logs -l app=torapi --follow</code> выводить лог для всех запущенных репликах подов в реальном времени<p><code>kubectl exec torapi-54775d94b8-t2dhm -c torapi -- ls -lha</code> выполнить команду в указанноv контейнере внутри пода <br> <code>kubectl exec torapi-54775d94b8-t2dhm -c torapi -- env</code> отобразить список глобальных переменных в контейнере <br> <code>kubectl exec -it torapi-54775d94b8-t2dhm -c torapi -- curl http://localhost:8443/api/provider/list</code> проверить доступность приложения внутри контейнера <br> <code>kubectl exec -it torapi-54775d94b8-t2dhm -c torapi -- sh</code> запустить <code>sh</code> или <code>bash</code> сессию в контейнере пода<p><code>kubectl get rs</code> состояние реплик (<code>ReplicaSet</code>) для всех deployment (<code>DESIRED</code> - желаемое количество экземпляров-реплик и <code>CURRENT</code> - текущее количество реплик) <br> <code>kubectl scale deployments/torapi --replicas=3</code> масштабировать (или уменьшить) deployment до указанного числа реплик подов <br> <code>kubectl describe deployments/torapi</code> изменения фиксируется в конфигурации deployment - Events: <code>Scaled up replica set torapi-54775d94b8 from 2 to 3</code><p><code>kubectl delete service torapi-service</code> удалить service <br> <code>kubectl delete deployment torapi</code> удалить deployment<p><code>kubectl create deployment kubernetes-bootcamp --image=gcr.io/google-samples/kubernetes-bootcamp:v1</code> <br> <code>kubectl expose deployment/kubernetes-bootcamp --type="NodePort" --port 3088</code> <br> <code>kubectl set image deployments/kubernetes-bootcamp kubernetes-bootcamp=docker.io/jocatalin/kubernetes-bootcamp:v2</code> выполнение плавающего обновления версии образа работающего контейнера <br> <code>kubectl rollout status deployments/kubernetes-bootcamp</code> проверить статус обновления <br> <code>kubectl set image deployments/kubernetes-bootcamp kubernetes-bootcamp=gcr.io/google-samples/kubernetes-bootcamp:v10</code> выполнить обновление на несуществующую версию <br> <code>kubectl rollout undo deployments/kubernetes-bootcamp</code> откатить deployment к последней работающей версии (к предыдущему известному состоянию в образе v2)<p><code>kubectl get configmap</code> получить все ConfigMap <br> <code>kubectl describe configmap kube-root-ca.crt</code> отобразить содержимое ConfigMap (на примере корневого сертифика)<p><code>kubectl create secret generic admin-password --from-literal=username=admin --from-literal=password=pass</code> создать секрет в формате ключ-значение <br> <code>kubectl create secret generic api-key --from-file=api-key.txt</code> создать секрет из содержимого файла <br> <code>kubectl get secret</code> получить список всех секретов <br> <code>kubectl describe secret admin-password</code> получить информацию о секрете (размер в байтах) <br> <code>kubectl get secret admin-password -o yaml</code> получить содержимое секретов в кодировке base64 <br> <code>kubectl get secret admin-password -o jsonpath="{.data.password}" | base64 --decode</code> декодировать содержимое секрета <br> <code>kubectl delete secret admin-password</code> удалить секрет<p><code>kubectl get jobs -n kube-system</code> проверить статус выполнения заданий (job)<h3 id=deployment-and-service><a aria-label="Anchor link for: deployment-and-service" class=zola-anchor href=#deployment-and-service><i class=icon></i></a> Deployment and Service</h3><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">apiVersion</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">v1</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">kind</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Namespace</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">metadata</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">rest-api</span>
</span></code></pre><p><code>kubectl apply -f namespace.yaml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">apiVersion</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">apps/v1</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">kind</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Deployment</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">metadata</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">torapi</span>        <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Имя Deployment, который управляет созданием подов
</span></span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">namespace</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">rest-api</span> <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Новое пространство имен
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">spec</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">replicas</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">2</span>         <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Количество реплик (2 пода с одинаковыми настройками)
</span></span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">selector</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">matchLabels</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">app</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">torapi</span>     <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Определяет, какие поды будут управляться этим Deployment
</span></span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">template</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">metadata</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">labels</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">app</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">torapi</span>   <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Метка, которая связывает этот шаблон (template) с селектором выше
</span></span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">spec</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">containers</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">torapi</span>                    <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Имя контейнера внутри пода
</span></span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">image</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">lifailon/torapi:latest</span>   <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Используемый образ контейнера
</span></span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ports</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">containerPort</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">8443</span>           <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Порт, который будет открыт внутри контейнера
</span></span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">resources</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>                      <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Ограничения и гарантируемые ресурсы
</span></span><span class="z-source z-yaml">          <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">requests</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">            <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">cpu</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>100m<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>                 <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Минимальный запрашиваемый процессор (0.1 ядра = 100 милли-ядер)
</span></span><span class="z-source z-yaml">            <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">memory</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>128Mi<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>             <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Минимальный запрашиваемый объем оперативной памяти (128 МБайт)
</span></span><span class="z-source z-yaml">          <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">limits</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">            <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">cpu</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>200m<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>                 <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Максимально доступное процессорное время 
</span></span><span class="z-source z-yaml">            <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">memory</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>256Mi<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>             <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Максимальный объем памяти
</span></span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">livenessProbe</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>                  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Проверка работоспособности контейнера
</span></span><span class="z-source z-yaml">          <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">httpGet</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">            <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">path</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">/api/provider/list</span>    <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Конечная точка в контейнере, по которому будет проверяться работоспособность
</span></span><span class="z-source z-yaml">            <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">port</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">8443</span>                  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Порт, на котором доступен этот endpoint внутри контейнера
</span></span><span class="z-source z-yaml">          <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">initialDelaySeconds</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">5</span>        <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Ждет 5 секунд после запуска контейнера перед первой проверкой
</span></span><span class="z-source z-yaml">          <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">periodSeconds</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">10</span>             <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Интервал проверки (повторять проверку каждые 10 секунд)
</span></span><span class="z-source z-yaml">          <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">timeoutSeconds</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">3</span>             <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Максимальное время ожидания ответа в секундах
</span></span><span class="z-source z-yaml">          <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">failureThreshold</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">3</span>           <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Количество неудачных попыток перед рестартом
</span></span></code></pre><p><code>kubectl apply -f deployment.yaml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">apiVersion</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">v1</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">kind</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Service</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">metadata</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">torapi-service</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">namespace</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">rest-api</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">spec</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">selector</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">app</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">torapi</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ports</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">protocol</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">TCP</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">targetPort</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">8443</span>    <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Порт, который слушают поды (контейнеры)
</span></span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">port</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">8444</span>          <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Порт, на котором сервис доступен внутри кластера (ClusterIP)
</span></span><span class="z-source z-yaml">      <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> nodePort: 30443   # Порт, открытый на каждой ноде кластера для доступа извне (единственная точка входа в режиме type: nodePort)
</span></span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">type</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">LoadBalancer</span>      <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Порт ClusterIP (указанный в targetPort) становится доступен из вне на всех нодах
</span></span><span class="z-source z-yaml">  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> type: ClusterIP       # Значение по умолчанию, используется для общения сервисов только внутри кластера
</span></span><span class="z-source z-yaml">  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> type: NodePort        # Единственная точка входа через NodePort
</span></span></code></pre><p><code>kubectl apply -f service.yaml</code><p><code>kubectl get pods</code> будет создано два пода <br> <code>kubectl logs torapi-54775d94b8-t2dhm</code> отобразить логи пода, будут идти запросы от ip kube-probe/1.32 для проверки здоровья <br> <code>kubectl exec -it torapi-54775d94b8-t2dhm -- npm --version</code> вывести версию npm внутри контейнера<h3 id=proxy-and-forward><a aria-label="Anchor link for: proxy-and-forward" class=zola-anchor href=#proxy-and-forward><i class=icon></i></a> Proxy and forward</h3><p>Проверить распредиление нагрузки в режиме <code>LoadBalancer</code>:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-loop z-for z-shell">for</span><span class="z-meta z-group z-for z-shell"> i <span class="z-keyword z-control z-in z-shell">in</span> <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span>1..20<span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-loop z-do z-shell">do</span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">curl</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>s</span> http://192.168.3.105:8444/api/provider/list</span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-loop z-end z-shell">done</span>
</span></code></pre><p><code>kubectl proxy</code> запустить прокси сервер для локального взаимодействия с частной сетью кластера Kubernetes через API (без авторизации), где автоматически создаются конечные точки для каждого пода в соответствии с его именем <br> <code>curl http://localhost:8001</code> отобразить список всех доступных конечных точек (endpoints) <br> <code>curl -s http://localhost:8001/api/v1/namespaces/rest-api/pods | jq -r .items[].metadata.name</code> вывести список всех имен подов в указанном namespace <br> <code>curl -s http://localhost:8001/api/v1/namespaces/rest-api/services/torapi-service:8444/proxy/api/provider/list</code> конечная точка, которая напрямую проксирует запрос внутрь пода (к конечной точке приложения в контейнере)<p><code>kubectl port-forward -n rest-api pods/torapi-54775d94b8-t2dhm 8443:8443</code> запустить проброс порта из пода <br> <code>curl http://localhost:8443/api/provider/list</code><p><code>curl http://torapi-service.rest-api.svc.cluster.local:8444/api/provider/list</code> запрос к поду из контейнера любого друго namespace внутри кластера (Использует Cluster-IP)<h3 id=hpa><a aria-label="Anchor link for: hpa" class=zola-anchor href=#hpa><i class=icon></i></a> HPA</h3><p><code>HPA</code> (Horizontal Pod Autoscaling) - горизонтальное масштабирование позволяет автоматически увеличивать или уменьшать количество реплик (подов) в зависимости от текущей нагрузки по показателям метрик, получаемых из <code>metrics-server</code>. Если нагрузка на одну поду увеличивается, то реплика должна снять нагрузку с первого пода, тем самым средняя нагрузка на 1 под будет ниже.<p><code>kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml</code> установить <code>metrics-server</code> в кластер<p><code>kubectl top nodes</code> отобразить метрики ресурсов для всех узлов в кластере <br> <code>kubectl get deployment metrics-server -n kube-system</code> отобразить статус работы metrics-server <br> <code>kubectl logs -n kube-system deployment/metrics-server</code> проверить логи metrics-server<p><code>kubectl edit deployment metrics-server -n kube-system</code> отключить проверку TLS<pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">spec</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">containers</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">args</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">--kubelet-insecure-tls</span>
</span></code></pre><p><code>kubectl rollout restart deployment metrics-server -n kube-system</code> перезапустить metrics-server<pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">apiVersion</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">autoscaling/v2</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">kind</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">HorizontalPodAutoscaler</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">metadata</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">torapi-hpa</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">namespace</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">rest-api</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">spec</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">scaleTargetRef</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">apiVersion</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">apps/v1</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">kind</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Deployment</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">torapi</span>  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Имя Deployment, который будем масштабировать
</span></span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">minReplicas</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">1</span>  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Минимальное количество реплик
</span></span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">maxReplicas</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">5</span>  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Максимальное количество реплик
</span></span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">metrics</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">type</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Resource</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">resource</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">cpu</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">target</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">type</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Utilization</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">averageUtilization</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">50</span>  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> когда среднее использование CPU превышает 50%, будет увеличено количество реплик, чтобы уменьшить нагрузку на поды
</span></span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">behavior</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">scaleDown</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">stabilizationWindowSeconds</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">300</span>  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> задержка в 5 минут перед уменьшением реплик
</span></span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">scaleUp</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">stabilizationWindowSeconds</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">60</span>   <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> задержка в 1 1 минуту перед увеличением реплик
</span></span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">policies</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">type</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Pods</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">value</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">1</span>            <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Добавлять по 1 поду за шаг
</span></span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">periodSeconds</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">60</span>   <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Интервал между магом в секундах
</span></span></code></pre><p><code>kubectl apply -f torapi-hpa.yaml</code><p><code>kubectl top pods -n rest-api</code> отобразить нагрузку на подах по cpu и memory <br> <code>kubectl get --raw "/apis/metrics.k8s.io/v1beta1/namespaces/rest-api/pods" | jq .</code> получить метрики напрямую из API<p><code>kubectl get hpa</code> отобразить статус работы всех HPA и текущие таргеты (cpu: 1%/50%) <br> <code>kubectl get pods</code> будет активен 1 под из 5 подов (вместо двух, изначально определенных в Deployment)<p><code>kubectl describe hpa -n rest-api torapi-hpa</code> отобразить статус работы HPA (текущее и тригерное значение для масштабирования)<pre class=z-code><code><span class="z-text z-plain">Metrics:                                               ( current / target )
</span><span class="z-text z-plain">  resource cpu on pods  (as a percentage of request):    3% (3m) / 10%
</span></code></pre><h3 id=ingress><a aria-label="Anchor link for: ingress" class=zola-anchor href=#ingress><i class=icon></i></a> Ingress</h3><p><code>Ingress</code> - это балансировщик нагрузки, который управляет HTTP или HTTPS трафиком в кластер и направляет его к нужным логическим сервисам (балансировка между нодами по имени и маршрутизация запросов к разным конечным точкам в пути).<p><code>kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/deploy/static/provider/cloud/deploy.yaml</code> установить <code>Ingress Controller</code> в кластер <br> <code>kubectl get pods -n ingress-nginx</code> <br> <code>kubectl get svc -n ingress-nginx</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">apiVersion</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">networking.k8s.io/v1</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">kind</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Ingress</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">metadata</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">torapi-ingress</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">namespace</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">rest-api</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">annotations</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">nginx.ingress.kubernetes.io/rewrite-target</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">/</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">spec</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ingressClassName</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">nginx</span>
</span><span class="z-source z-yaml">  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> ingressClassName: traefik
</span></span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">rules</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">host</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">torapi.local</span> <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> доменное имя (которое необходимо прописать на DNS сервере)
</span></span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">http</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">paths</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">path</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">/</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">pathType</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Prefix</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">backend</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">          <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">service</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">            <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">torapi-service</span>
</span><span class="z-source z-yaml">            <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">port</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">              <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">number</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">8444</span>
</span></code></pre><p><code>kubectl apply -f ingress.yaml</code><p><code>kubectl get ingress</code> отобразить статус работы ingress (используемое proxy приложение, внешние адреса в балансировке и общий порт)<p>Изменить работу масштабирования <code>HPA</code> на основе 50 и выше HTTP-запросов в секунду через метрику <code>nginx_ingress_controller_requests</code>:<pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">apiVersion</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">autoscaling/v2</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">kind</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">HorizontalPodAutoscaler</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">metadata</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">torapi-hpa</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">namespace</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">rest-api</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">spec</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">scaleTargetRef</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">apiVersion</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">apps/v1</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">kind</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Deployment</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">torapi</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">minReplicas</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">1</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">maxReplicas</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">5</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">metrics</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">type</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">External</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">external</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">metric</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">nginx_ingress_controller_requests</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">target</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">type</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Value</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">value</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">50</span>
</span></code></pre><p><code>kubectl apply -f hpa.yaml</code><p><code>kubectl get hpa</code> отобразить статус работы HPA<h3 id=metallb><a aria-label="Anchor link for: metallb" class=zola-anchor href=#metallb><i class=icon></i></a> MetalLB</h3><p><a href=https://github.com/metallb/metallb>MetalLB</a> - балансировщик нагрузки для локальных кластеров, эмулирующий работу облачных провайдеров. Настраивается пул адресов, и в случае падения ноды, переводит IP-адреса сервисов на другую ноду. Для сервисов LoadBalancer (включая Ingress-контроллер) выдается один внешний виртуальный ip-адрес, который прописывается на внешнем DNS сервере.<p><code>kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.15.2/config/manifests/metallb-native.yaml</code> установка в кластер из манифеста<p>Настройка пула адресов:<pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">apiVersion</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">metallb.io/v1beta1</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">kind</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">IPAddressPool</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">metadata</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">default-pool</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">namespace</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">metallb-system</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">spec</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">addresses</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">192.168.3.201/32</span>
</span><span class="z-source z-yaml">  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> - 192.168.3.201-192.168.3.210
</span></span><span class="z-source z-yaml">  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> autoAssign: false # требует аннотации пула или указания адреса в Service
</span></span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> apiVersion: v1
</span></span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> kind: Service
</span></span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> metadata:
</span></span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>   name: torapi-service
</span></span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>   namespace: rest-api
</span></span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>   annotations:
</span></span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>     metallb.universe.tf/address-pool: "default-pool"      # Использовать указанный пул
</span></span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>     metallb.universe.tf/loadBalancerIPs: "192.168.3.201"  # Привязка адреса из пула
</span></span></code></pre><p><code>kubectl apply -f ip-address-pool.yaml</code><p>Анонсировать адреса из <code>default-pool</code> в сети через протокол ARP на уровне L2/Ethernet:<pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">apiVersion</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">metallb.io/v1beta1</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">kind</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">L2Advertisement</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">metadata</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">default</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">namespace</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">metallb-system</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">spec</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ipAddressPools</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">default-pool</span>
</span></code></pre><p><code>kubectl apply -f l2-advertisement.yaml</code><h3 id=kompose><a aria-label="Anchor link for: kompose" class=zola-anchor href=#kompose><i class=icon></i></a> Kompose</h3><p><a href=https://github.com/kubernetes/kompose>Kompose</a> - инструмент, который конвертируемт спецификацию <code>docker-compose</code> в манифесты Kubernetes.<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">mkdir</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">HOME</span></span>/.local/bin</span>
</span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">arch</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">uname</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>m</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-conditional z-case z-shell"><span class="z-keyword z-control z-conditional z-case z-shell">case</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">arch</span></span> <span class="z-keyword z-control z-in z-shell">in</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-conditional z-case z-shell">    </span><span class="z-meta z-conditional z-case z-clause z-patterns z-shell">x86_64<span class="z-keyword z-operator z-logical z-shell">|</span>amd64<span class="z-meta z-conditional z-case z-shell"><span class="z-keyword z-control z-conditional z-patterns z-end z-shell">)</span></span></span><span class="z-meta z-conditional z-case z-clause z-commands z-shell"> <span class="z-variable z-other z-readwrite z-assignment z-shell">arch</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>amd64<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span> </span><span class="z-meta z-conditional z-case z-clause z-commands z-shell"><span class="z-punctuation z-terminator z-case z-clause z-shell">;;</span></span><span class="z-meta z-conditional z-case z-clause z-patterns z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-conditional z-case z-clause z-patterns z-shell">    </span><span class="z-meta z-conditional z-case z-clause z-patterns z-shell">aarch64<span class="z-meta z-conditional z-case z-clause z-patterns z-shell"><span class="z-keyword z-control z-conditional z-patterns z-end z-shell">)</span></span></span><span class="z-meta z-conditional z-case z-clause z-commands z-shell"> <span class="z-variable z-other z-readwrite z-assignment z-shell">arch</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>arm64<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span> </span><span class="z-meta z-conditional z-case z-clause z-commands z-shell"><span class="z-punctuation z-terminator z-case z-clause z-shell">;;</span></span><span class="z-meta z-conditional z-case z-clause z-patterns z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-conditional z-case z-clause z-patterns z-shell"><span class="z-keyword z-control z-conditional z-end z-shell">esac</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">version</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">curl</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>s</span> https://api.github.com/repos/kubernetes/kompose/releases/latest</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">jq</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>r</span> .tag_name</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">curl</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>sSL</span> https://github.com/kubernetes/kompose/releases/download/<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">version</span></span>/kompose-linux-<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">arch</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>o</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">HOME</span></span>/.local/bin/kompose</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">chmod</span></span><span class="z-meta z-function-call z-arguments z-shell"> +x <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">HOME</span></span>/.local/bin/kompose</span>
</span></code></pre><p><code>kompose --file docker-compose.yaml convert</code> конвертация<h3 id=kustomize><a aria-label="Anchor link for: kustomize" class=zola-anchor href=#kustomize><i class=icon></i></a> Kustomize</h3><p><a href=https://github.com/kubernetes-sigs/kustomize>Kustomize</a> — это встроенный в <code>kubectl</code> (с версии 1.14) инструмент для управления и слияния конфигураций Kubernetes без использования шаблонизаторов (как в <a href=https://github.com/helm/helm>Helm</a>). Он похож на Make, т.к. его действия объявлены в файле <code>kustomization.yaml</code>, и на <code>sed</code>, т.к. он выводит отредактированный текст (без создания новых и изменения исходных манифестов).<p><code>kubectl version --client</code><p><code>curl -sSL "https://raw.githubusercontent.com/kubernetes-sigs/kustomize/master/hack/install_kustomize.sh" | bash && mv kustomize $HOME/.local/bin/</code> установить внешний исполняемый файл<pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">apiVersion</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">kustomize.config.k8s.io/v1beta1</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">kind</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Kustomization</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">namespace</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">rest-api</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">resources</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">namespace.yaml</span>
</span><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">deployment.yaml</span>
</span><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">service.yaml</span>
</span><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">hpa.yaml</span>
</span><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ingress.yaml</span>
</span></code></pre><p>Формат запуска: <code>kustomize build &LTpath_dir/url> || kubectl kustomize &LTpath_dir/url></code><p><code>kubectl kustomize ./base</code> объеденить все манифесты перечисленные в <code>resources</code> в один <code>yaml</code> файл (в правильном порядке), где к каждому ресурсу автоматически добавляется <code>namespace</code>, указанный в <code>kustomization</code> файле<p><code>kubectl apply -k ./base</code> применить все перечисленные манифесты в файле <code>kustomization.yaml</code><p>Kustomize работает по принципу наследования конфигураций, где директория <code>base/</code> содержит базовые манифесты (например, <code>deployment.yaml</code> и <code>service.yaml</code>), а директория <code>overlays/</code> — содержит изменения для разных окружений (например, <code>overlays/dev</code> и <code>overlays/test</code>), переопределяя только указанные параметры.<p>Пример структуры:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">├──</span></span><span class="z-meta z-function-call z-arguments z-shell"> base</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">│</span></span><span class="z-meta z-function-call z-arguments z-shell">   ├── deployment.yaml</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">│</span></span><span class="z-meta z-function-call z-arguments z-shell">   ├── hpa.yaml</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">│</span></span><span class="z-meta z-function-call z-arguments z-shell">   ├── ingress.yaml</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">│</span></span><span class="z-meta z-function-call z-arguments z-shell">   ├── kustomization.yaml</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">│</span></span><span class="z-meta z-function-call z-arguments z-shell">   ├── namespace.yaml</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">│</span></span><span class="z-meta z-function-call z-arguments z-shell">   └── service.yaml</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">└──</span></span><span class="z-meta z-function-call z-arguments z-shell"> overlays</span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">├──</span></span><span class="z-meta z-function-call z-arguments z-shell"> dev</span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">│</span></span><span class="z-meta z-function-call z-arguments z-shell">   ├── kustomization.yaml</span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">│</span></span><span class="z-meta z-function-call z-arguments z-shell">   └── patch-hpa.yaml</span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">└──</span></span><span class="z-meta z-function-call z-arguments z-shell"> test</span>
</span><span class="z-source z-shell z-bash">        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">├──</span></span><span class="z-meta z-function-call z-arguments z-shell"> kustomization.yaml</span>
</span><span class="z-source z-shell z-bash">        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">└──</span></span><span class="z-meta z-function-call z-arguments z-shell"> patch-hpa.yaml</span>
</span></code></pre><p>Пример дочернего файла <code>overlays/test/kustomization.yaml</code>:<pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">apiVersion</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">kustomize.config.k8s.io/v1beta1</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">kind</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Kustomization</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Наследуем все манифесты из base
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">resources</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">../../base</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Добавляем патч для HPA
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">patches</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">path</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">patch-hpa.yaml</span>
</span></code></pre><p>Пример конфигурации для <code>overlays/test/path-hpa.yaml</code>:<pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">apiVersion</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">autoscaling/v2</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">kind</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">HorizontalPodAutoscaler</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">metadata</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">torapi-hpa</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">namespace</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">rest-api</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">spec</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">metrics</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">type</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Resource</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">resource</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">cpu</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">target</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">type</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Utilization</span>         <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Утилизация в процентах
</span></span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">averageUtilization</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">5</span>     <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> 5% = 5m от 100m в spec.containers.resources.requests.cpu (0.005 ядра на один под)
</span></span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">type</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Resource</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">resource</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">memory</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">target</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">type</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Utilization</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">averageUtilization</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">50</span>
</span><span class="z-source z-yaml">        <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> type: AverageValue      # Абсолютное значение
</span></span><span class="z-source z-yaml">        <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> averageValue: 60Mi      # 60 МБайт
</span></span></code></pre><p><code>kubectl kustomize overlays/test/</code> проверить конфигурацию <br> <code>kubectl apply -k overlays/test</code> применить конфигурацию<p>Генерация <code>configMap</code> из файлов и переменных окружения:<pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">apiVersion</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">kustomize.config.k8s.io/v1beta1</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">kind</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Kustomization</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">namespace</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">telegram</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">resources</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> - configmap.yaml
</span></span><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">deployment.yaml</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">configMapGenerator</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">openrouter-bot-config</span>
</span><span class="z-source z-yaml">  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Передать содержимое файла в configMap
</span></span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">files</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">.env</span>
</span><span class="z-source z-yaml">  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Определить переменные окружения вручную (- key=value)
</span></span><span class="z-source z-yaml">  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> literals:
</span></span><span class="z-source z-yaml">  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>   - LOG_MODE=DEBUG
</span></span><span class="z-source z-yaml">  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Определить переменные окружения из env файла
</span></span><span class="z-source z-yaml">  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> envs:
</span></span><span class="z-source z-yaml">  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>   - .env
</span></span></code></pre><h3 id=helm><a aria-label="Anchor link for: helm" class=zola-anchor href=#helm><i class=icon></i></a> Helm</h3><p><a href=https://github.com/helm/helm>Helm</a> - это шаблонизатор для управления конфигурациями и менеджер пакетов Kubernetes, использующий чарты (charts, которые являются пакетами), содержащими всю информацию для установки и управления приложениями в Kubernetes.<p><code>curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash</code><p>Пример базовой структуры:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">├──</span></span><span class="z-meta z-function-call z-arguments z-shell"> Chart.yaml</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">├──</span></span><span class="z-meta z-function-call z-arguments z-shell"> values.yaml</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">└──</span></span><span class="z-meta z-function-call z-arguments z-shell"> templates</span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">├──</span></span><span class="z-meta z-function-call z-arguments z-shell"> deployment.yaml</span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">└──</span></span><span class="z-meta z-function-call z-arguments z-shell"> service.yaml</span>
</span></code></pre><p><code>Chart.yaml</code>:<pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">apiVersion</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">v2</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">torapi</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">description</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Unofficial API for torrent trackers</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">version</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-float z-decimal z-yaml">0<span class="z-punctuation z-separator z-decimal z-yaml">.</span>1.0</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">appVersion</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>0.5.2<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span></code></pre><p><code>values.yaml</code>:<pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Deployment
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">replicaCount</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">2</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">image</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>lifailon/torapi:latest<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">containerPort</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">8443</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">resources</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">requests</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">cpu</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>100m<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">memory</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>128Mi<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">limits</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">cpu</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>200m<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">memory</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>256Mi<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">probe</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">path</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>/api/provider/list<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">port</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">8443</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">initialDelaySeconds</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">5</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">periodSeconds</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">10</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">timeoutSeconds</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">3</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">failureThreshold</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">3</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Service
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">service</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">type</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">LoadBalancer</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">port</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">8444</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">targetPort</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">8443</span>
</span></code></pre><p><code>templates/deployment.yaml</code>:<pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">apiVersion</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">apps/v1</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">kind</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Deployment</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">metadata</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span><span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span> <span class="z-string z-unquoted z-plain z-in z-yaml">.Release.Name</span> <span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span><span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">namespace</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">rest-api</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">spec</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">replicas</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span><span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span> <span class="z-string z-unquoted z-plain z-in z-yaml">.Values.replicaCount</span> <span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span><span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">selector</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">matchLabels</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">app</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span><span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span> <span class="z-string z-unquoted z-plain z-in z-yaml">.Release.Name</span> <span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span><span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">template</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">metadata</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">labels</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">app</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span><span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span> <span class="z-string z-unquoted z-plain z-in z-yaml">.Release.Name</span> <span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span><span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">spec</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">containers</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span><span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span> <span class="z-string z-unquoted z-plain z-in z-yaml">.Release.Name</span> <span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span><span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">image</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span><span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span> <span class="z-string z-unquoted z-plain z-in z-yaml">.Values.image</span> <span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span><span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ports</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">containerPort</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span><span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span> <span class="z-string z-unquoted z-plain z-in z-yaml">.Values.containerPort</span> <span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span><span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">resources</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">          <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">requests</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">            <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">cpu</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>{{ .Values.resources.requests.cpu | default <span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span><span class="z-string z-unquoted z-plain z-out z-yaml">100m" }}"</span>
</span><span class="z-source z-yaml">            <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">memory</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>{{ .Values.resources.requests.memory | default <span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span><span class="z-string z-unquoted z-plain z-out z-yaml">128Mi" }}"</span>
</span><span class="z-source z-yaml">          <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">limits</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">            <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">cpu</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>{{ .Values.resources.limits.cpu | default <span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span><span class="z-string z-unquoted z-plain z-out z-yaml">200m" }}"</span>
</span><span class="z-source z-yaml">            <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">memory</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>{{ .Values.resources.limits.memory | default <span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span><span class="z-string z-unquoted z-plain z-out z-yaml">256Mi" }}"</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">livenessProbe</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">          <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">httpGet</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">            <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">path</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span><span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span> <span class="z-string z-unquoted z-plain z-in z-yaml">.Values.probe.path</span> <span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span><span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span>
</span><span class="z-source z-yaml">            <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">port</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span><span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span> <span class="z-string z-unquoted z-plain z-in z-yaml">.Values.probe.port</span> <span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span><span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span>
</span><span class="z-source z-yaml">          <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">initialDelaySeconds</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span><span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span> <span class="z-string z-unquoted z-plain z-in z-yaml">.Values.probe.initialDelaySeconds</span> <span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span><span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span>
</span><span class="z-source z-yaml">          <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">periodSeconds</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span><span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span> <span class="z-string z-unquoted z-plain z-in z-yaml">.Values.probe.periodSeconds</span> <span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span><span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span>
</span><span class="z-source z-yaml">          <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">timeoutSeconds</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span><span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span> <span class="z-string z-unquoted z-plain z-in z-yaml">.Values.probe.timeoutSeconds</span> <span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span><span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span>
</span><span class="z-source z-yaml">          <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">failureThreshold</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span><span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span> <span class="z-string z-unquoted z-plain z-in z-yaml">.Values.probe.failureThreshold</span> <span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span><span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span>
</span></code></pre><p><code>service.yaml</code>:<pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">apiVersion</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">v1</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">kind</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Service</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">metadata</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span><span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span> <span class="z-string z-unquoted z-plain z-in z-yaml">.Release.Name</span> <span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span><span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span><span class="z-string z-unquoted z-plain z-out z-yaml">-service</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">namespace</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">rest-api</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">spec</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">selector</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">app</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span><span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span> <span class="z-string z-unquoted z-plain z-in z-yaml">.Release.Name</span> <span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span><span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ports</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">protocol</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">TCP</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">targetPort</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span><span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span> <span class="z-string z-unquoted z-plain z-in z-yaml">.Values.service.targetPort</span> <span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span><span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">port</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span><span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span> <span class="z-string z-unquoted z-plain z-in z-yaml">.Values.service.port</span> <span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span><span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">type</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span><span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span> <span class="z-string z-unquoted z-plain z-in z-yaml">.Values.service.type</span> <span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span><span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span>
</span></code></pre><p><code>helm template torapi-app .</code> напечатать итоговую спецификацию (проверить подстановку переменных) <br> <code>helm install torapi-app .</code> установка в кластер <br> <code>helm upgrade torapi-app .</code> обновление релиза (при изменение значение в <code>values.yaml</code>) <br> <code>helm uninstall torapi-app .</code> удалить<h2 id=github-api><a aria-label="Anchor link for: github-api" class=zola-anchor href=#github-api><i class=icon></i></a> GitHub API</h2><p><code>$user = "Lifailon"</code> <br> <code>$repository = "ReverseProxyNET"</code> <br> <code>Invoke-RestMethod https://api.github.com/users/$($user)</code> получаем информацию о пользователе <br> <code>Invoke-RestMethod https://api.github.com/users/$($user)/repos</code> получаем список последних (актуальные коммиты) 30 репозиториев указанного пользователя <br> <code>Invoke-RestMethod https://api.github.com/users/$($user)/repos?per_page=100</code> получаем список последних (актуальные коммиты) 100 репозиториев указанного пользователя <br> <code>Invoke-RestMethod https://api.github.com/repos/$($user)/$($repository)/contents</code> получаем содержимое корневой директории репозитория <br> <code>Invoke-RestMethod https://api.github.com/repos/$($user)/$($repository)/contents/source/rpnet.cs</code> получаем содержимое файла в формате Base64 <br> <code>$commits = Invoke-RestMethod https://api.github.com/repos/$($user)/$($repository)/commits</code> получаем список коммитов <br> <code>$commits[0].commit.message</code> читаем комментарий последнего коммита <br> <code>$commits[0].commit.committer.date</code> получаем дату последнего коммита <br> <code>Invoke-RestMethod https://api.github.com/repos/$($user)/$($repository)/commits/$($commits[0].sha)</code> получаем подробную информацию изменений о последнем коммите в репозитории <br> <code>$releases_latest = Invoke-RestMethod "https://api.github.com/repos/$($user)/$($repository)/releases/latest"</code> получаем информацию о последнем релизе в репозитории <br> <code>$releases_latest.assets.name</code> список приложенных файлов последнего релиза <br> <code>$releases_latest.assets.browser_download_url</code> получаем список url для загрузки файлов <br> <code>$($releases_latest.assets | Where-Object name -like "*win*x64*exe*").browser_download_url</code> фильтруем по ОС и разрядности <br> <code>$(Invoke-RestMethod -Uri "https://api.github.com/repos/Lifailon/epic-games-radar/commits?path=api/giveaway/index.json")[0].commit.author.date</code> узнать дату последнего обновления файла в репозитории <br> <code>$issues = Invoke-RestMethod https://api.github.com/repos/LibreHardwareMonitor/LibreHardwareMonitor/issues?per_page=500</code> получаем список открытых проблем в репозитории (получаем максимум 100 последних, по умолчанию забираем последние 30 issues) <br> <code>$issue_number = $($issues | Where-Object title -match "PowerShell").number</code> получаем номер issue, в заголовке которого есть слово “PowerShell” <br> <code>Invoke-RestMethod https://api.github.com/repos/LibreHardwareMonitor/LibreHardwareMonitor/issues/$($issue_number)/comments</code> отобразить список комментарием указанного issues <br> <code>Invoke-RestMethod https://api.github.com/repos/LibreHardwareMonitor/LibreHardwareMonitor/languages</code> получаем список языков программирования, используемых в репозитории <br> <code>Invoke-RestMethod https://api.github.com/repos/LibreHardwareMonitor/LibreHardwareMonitor/pulls</code> получаем список всех pull requests в репозитории <br> <code>Invoke-RestMethod https://api.github.com/repos/LibreHardwareMonitor/LibreHardwareMonitor/forks</code> получаем список форков (forks) <br> <code>Invoke-RestMethod https://api.github.com/repos/LibreHardwareMonitor/LibreHardwareMonitor/stargazers?per_page=4000</code> получаем список пользователей, которые поставили звезды репозиторию <br> <code>Invoke-RestMethod https://api.github.com/repos/LibreHardwareMonitor/LibreHardwareMonitor/subscribers</code> получаем список подписчиков (watchers) репозитория<h2 id=github-actions><a aria-label="Anchor link for: github-actions" class=zola-anchor href=#github-actions><i class=icon></i></a> GitHub Actions</h2><h3 id=runner-agent><a aria-label="Anchor link for: runner-agent" class=zola-anchor href=#runner-agent><i class=icon></i></a> Runner (Agent)</h3><p><code>mkdir actions-runner; cd actions-runner</code> <br> <code>Invoke-WebRequest -Uri https://github.com/actions/runner/releases/download/v2.316.1/actions-runner-win-x64-2.316.1.zip -OutFile actions-runner-win-x64-2.316.1.zip</code> загрузить пакет с Runner последней версии <br> <code>if((Get-FileHash -Path actions-runner-win-x64-2.316.1.zip -Algorithm SHA256).Hash.ToUpper() -ne 'e41debe4f0a83f66b28993eaf84dad944c8c82e2c9da81f56a850bc27fedd76b'.ToUpper()){ throw 'Computed checksum did not match' }</code> проверить валидность пакета с помощью hash-суммы <br> <code>Add-Type -AssemblyName System.IO.Compression.FileSystem ; [System.IO.Compression.ZipFile]::ExtractToDirectory("$PWD/actions-runner-win-x64-2.316.1.zip", "$PWD")</code> разархивировать <br> <code>Remove-Item *.zip</code> удалить архив <br> <code>./config.cmd --url https://github.com/Lifailon/egapi --token XXXXXXXXXXXXXXXXXXXXXXXXXXXXX</code> авторизовать и сконфигурировать сборщика с помощью скрипта (что бы на последнем пункте создать службу для управления сборщиком, нужно запустить консоль с правами администратора) <br> <code>./run.cmd</code> запустить процесс (если не используется служба) <br> <code>Get-Service *actions* | Start-Service</code> запустить службу <br> <code>Get-Process *Runner.Listener*</code> <br> <code>./config.cmd remove --token XXXXXXXXXXXXXXXXXXXXXXXXXXXXX</code> удалить конфигурацию<h3 id=build-pipeline><a aria-label="Anchor link for: build-pipeline" class=zola-anchor href=#build-pipeline><i class=icon></i></a> Build (Pipeline)</h3><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">build-game-list</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-constant z-language z-boolean z-yaml">on</span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Разрешить ручной запуск workflow через интерфейс GitHub
</span></span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">workflow_dispatch</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  
</span><span class="z-source z-yaml">  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Запускать workflow по расписанию каждый час в 00 минут
</span></span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">schedule</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">cron</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-single z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">'</span>00 * * * *<span class="z-punctuation z-definition z-string z-end z-yaml">'</span></span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">jobs</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">Job_01</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Указываем, что job будет выполняться на последней версии Ubuntu
</span></span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">runs-on</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ubuntu-latest</span>
</span><span class="z-source z-yaml">    
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">steps</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Шаги, которые будут выполнены в рамках этого job
</span></span><span class="z-source z-yaml">    <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Checkout repository</span>
</span><span class="z-source z-yaml">      <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Клонирования репозиторий
</span></span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">uses</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">actions/checkout@v2</span>
</span><span class="z-source z-yaml">    
</span><span class="z-source z-yaml">    <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Get content and write to file</span>
</span><span class="z-source z-yaml">      <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Выполняем скрипт PowerShell, расположенный в ./scripts/Get-GameList.ps1
</span></span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">run</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">pwsh -File ./scripts/Get-GameList.ps1</span>
</span><span class="z-source z-yaml">      <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Указываем, что команда должна выполняться в оболочке bash
</span></span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">shell</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">bash</span> 
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">    <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Commit and push changes</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">run</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-keyword z-control z-flow z-block-scalar z-literal z-yaml">|</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">        # Задаем имя пользователя и email для коммитов
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">        git config --global user.name 'GitHub Actions'
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">        git config --global user.email 'actions@github.com'
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">        # Добавляем все изменения в индекс
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">        git add .
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">        # Делаем коммит с комментарием
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">        git commit -m "update game list"
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">        # Отправляем коммит в удаленный репозиторий
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">        git push
</span></span></code></pre><h3 id=ci><a aria-label="Anchor link for: ci" class=zola-anchor href=#ci><i class=icon></i></a> CI</h3><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Docker Build and Push Image</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-constant z-language z-boolean z-yaml">on</span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Запусать при git push в ветку main
</span></span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">push</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">branches</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">main</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">jobs</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">build</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">runs-on</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ubuntu-latest</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">steps</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Клонируем репозиторий</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">uses</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">actions/checkout@v2</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">    <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Авторизация в Docker Hub</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">uses</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">docker/login-action@v3</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">with</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">username</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">${{ secrets.DOCKER_USERNAME }}</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">password</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">${{ secrets.DOCKER_PASSWORD }}</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">    <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Сборка образа и отправка в Docker Hub</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">run</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-keyword z-control z-flow z-block-scalar z-literal z-yaml">|</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">        docker build -t lifailon/torapi:latest .
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">        docker push lifailon/torapi:latest
</span></span></code></pre><h3 id=logs-1><a aria-label="Anchor link for: logs-1" class=zola-anchor href=#logs-1><i class=icon></i></a> Logs</h3><p><code>$(Invoke-RestMethod https://api.github.com/repos/Lifailon/TorAPI/actions/workflows).total_count</code> получить количество запусков всех рабочих процессов <br> <code>$(Invoke-RestMethod https://api.github.com/repos/Lifailon/TorAPI/actions/workflows).workflows</code> подробная информации о запускаемых рабочих процессах <br> <code>$actions_last_id = $(Invoke-RestMethod https://api.github.com/repos/Lifailon/TorAPI/actions/workflows).workflows[-1].id</code> получить идентификатор последнего события <br> <code>$(Invoke-RestMethod https://api.github.com/repos/Lifailon/TorAPI/actions/workflows/$actions_last_id/runs).workflow_runs</code> подробная информация о последней сборке <br> <code>$run_id = $(Invoke-RestMethod https://api.github.com/repos/Lifailon/TorAPI/actions/workflows/$actions_last_id/runs).workflow_runs.id</code> получить идентификатор запуска рабочего процесса <br> <code>$(Invoke-RestMethod "https://api.github.com/repos/Lifailon/TorAPI/actions/runs/$run_id/jobs").jobs.steps</code> подробная информация для всех шагов выполнения (время работы и статус выполнения) <br> <code>$jobs_id = $(Invoke-RestMethod "https://api.github.com/repos/Lifailon/TorAPI/actions/runs/$run_id/jobs").jobs[0].id</code> получить идентификатор последнего задания указанного рабочего процесса<pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>url</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>https://api.github.com/repos/Lifailon/TorAPI/actions/jobs/<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>jobs_id</span>/logs<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>headers</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">Authorization</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>token ghp_XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Uri <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>url</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Headers <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>headers</span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> получить логи задания<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></code></pre><h3 id=act><a aria-label="Anchor link for: act" class=zola-anchor href=#act><i class=icon></i></a> act</h3><p><a href=https://github.com/nektos/act>act</a> - пользволяет запускать действия GitHub Actions локально.<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">version</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">curl</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>s</span> https://api.github.com/repos/nektos/act/releases/latest</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">jq</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>r</span> .tag_name</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">curl</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>L</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>https://github.com/nektos/act/releases/download/<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">version</span></span>/act_<span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">uname</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>s</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span>_<span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">uname</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>m</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span>.tar.gz<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>o</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">HOME</span></span>/.local/bin/act.tar.gz</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">tar</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>xzf</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">HOME</span></span>/.local/bin/act.tar.gz<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>C</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">HOME</span></span>/.local/bin</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">chmod</span></span><span class="z-meta z-function-call z-arguments z-shell"> +x <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">HOME</span></span>/.local/bin/act</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">rm</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">HOME</span></span>/.local/bin/act.tar.gz</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">act</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>version</span></span>
</span></code></pre><p><code>act --list</code> список доступных действий, указаных в файлах .github/workflows <br> <code>act -j build</code> запуск указанного действия по Job ID (имя файла, не путать с названием Workflow) <br> <code>act -n -j build</code> пробный запуск (–dry-run), без выполнения команд, для отображения всех выполняемых jobs и steps<pre class="language-json z-code" data-lang=json><code class=language-json data-lang=json><span class="z-source z-json"><span class="z-meta z-mapping z-json"><span class="z-punctuation z-section z-mapping z-begin z-json">{</span>
</span></span><span class="z-source z-json"><span class="z-meta z-mapping z-json">  </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>inputs<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-json"><span class="z-punctuation z-section z-mapping z-begin z-json">{</span>
</span></span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-json">    </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>Distro<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>ubuntu-24.04<span class="z-punctuation z-definition z-string z-end z-json">"</span></span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
</span></span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-value z-json">    </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>Update<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>false<span class="z-punctuation z-definition z-string z-end z-json">"</span></span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
</span></span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-value z-json">    </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>Linter<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>true<span class="z-punctuation z-definition z-string z-end z-json">"</span></span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
</span></span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-value z-json">    </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>Test<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>false<span class="z-punctuation z-definition z-string z-end z-json">"</span></span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
</span></span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-value z-json">    </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>Release<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>false<span class="z-punctuation z-definition z-string z-end z-json">"</span></span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
</span></span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-value z-json">    </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>Binary<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>true<span class="z-punctuation z-definition z-string z-end z-json">"</span></span>
</span></span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-mapping z-value z-json">  <span class="z-punctuation z-section z-mapping z-end z-json">}</span></span>
</span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-section z-mapping z-end z-json">}</span></span>
</span></code></pre><p><code>act -e event.json -W .github/workflows/build.yml -P ubuntu-24.04=catthehacker/ubuntu:act-latest</code> запустить указанный файл workflow с переданным файлом переменных (предварительно определенных параметров) и указанным сборщиком <br> <code>act -e event.json -W .github/workflows/build.yml -P ubuntu-24.04=catthehacker/ubuntu:act-latest --artifact-server-path $PWD/artifacts</code> примонтировать рабочий каталог в контейнер для сохранения артефактов<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>DOCKER_HUB_USERNAME=username<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">>></span> .secrets</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>DOCKER_HUB_PASSWORD=password<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">>></span> .secrets</span>
</span></code></pre><p><code>act --secret-file .secrets</code> <br> <code>act -s DOCKER_HUB_USERNAME=username -s DOCKER_HUB_PASSWORD=password</code> передать содержимое секретов <br> <code>act push</code> симуляция push-ивента (имитация коммита и запуск workflow, который реагирует на push) <br> <code>act --reuse</code> не удалять контейнер из успешно завершенных рабочих процессов для сохранения состояния между запусками (кэширование) <br> <code>act --parallel</code> запуск всех jobs одновременно или последовательно (–no-parallel, по умолчанию)<h2 id=vercel><a aria-label="Anchor link for: vercel" class=zola-anchor href=#vercel><i class=icon></i></a> Vercel</h2><p><code>npm i -g vercel</code> установить глобально в систему Vercel CLI <br> <code>vercel --version</code> выводит текущую версию установленного Vercel CLI <br> <code>vercel login</code> выполняет вход в аккаунт Vercel (<code>> Continue with GitHub</code>) <br> <code>vercel logout</code> выполняет выход из аккаунта Vercel <br> <code>vercel init</code> инициализирует новый проект в текущей директории (создает файл конфигурации vercel.json и другие файлы, необходимые для проекта) <br> <code>vercel dev</code> запускает локальный сервер для проверки работоспособности (http://localhost:3000) <br> <code>vercel deploy</code> загружает проект на серверы Vercel и развертывает его <br> <code>vercel link</code> привязывает текущую директорию к существующему проекту на сервере Vercel (выбрать из списка) <br> <code>vercel unlink</code> отменяет привязку текущей директории от проекта Vercel <br> <code>vercel env</code> управляет переменными окружения для проекта <br> <code>vercel env pull</code> подтягивает переменные окружения с Vercel в локальный .env файл <br> <code>vercel env ls</code> показывает список всех переменных окружения для проекта <br> <code>vercel env add &LTkey> &LTenvironment></code> добавляет новую переменную окружения для указанного окружения (production, preview, development) <br> <code>vercel env rm &LTkey> &LTenvironment></code> удаляет переменную окружения из указанного окружения <br> <code>vercel projects</code> управляет проектами Vercel <br> <code>vercel projects ls</code> показывает список всех проектов <br> <code>vercel projects add</code> добавляет новый проект <br> <code>vercel projects rm &LTproject></code> удаляет указанный проект <br> <code>vercel pull</code> подтягивает последние настройки окружения с Vercel <br> <code>vercel alias</code> управляет алиасами доменов для проектов <br> <code>vercel alias ls</code> показывает список всех алиасов для текущего проекта <br> <code>vercel alias set &LTalias></code> устанавливает алиас для указанного проекта <br> <code>vercel alias rm &LTalias></code> удаляет указанный алиас <br> <code>vercel domains</code> управляет доменами, привязанными к проекту <br> <code>vercel domains ls</code> показывает список всех доменов <br> <code>vercel domains add &LTdomain></code> добавляет новый домен к проекту <br> <code>vercel domains rm &LTdomain></code> удаляет указанный домен <br> <code>vercel teams</code> управляет командами и членами команд на Vercel <br> <code>vercel teams ls</code> показывает список всех команд <br> <code>vercel teams add &LTteam></code> добавляет новую команду <br> <code>vercel teams rm &LTteam></code> удаляет указанную команду <br> <code>vercel logs &LTdeployment></code> выводит логи для указанного деплоя <br> <code>vercel secrets</code> управляет секретами, используемыми в проектах <br> <code>vercel secrets add &LTname> &LTvalue></code> добавляет новый секрет <br> <code>vercel secrets rm &LTname></code> удаляет указанный секрет <br> <code>vercel secrets ls</code> показывает список всех секретов <br> <code>vercel switch &LTteam></code> переключается между командами и аккаунтами Vercel<h3 id=cd><a aria-label="Anchor link for: cd" class=zola-anchor href=#cd><i class=icon></i></a> CD</h3><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Deploy to Vercel</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-constant z-language z-boolean z-yaml">on</span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">workflow_dispatch</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">jobs</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">deploy</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">runs-on</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ubuntu-latest</span>
</span><span class="z-source z-yaml">    
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">steps</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Clone repository</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">uses</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">actions/checkout@v4</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">    <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Install Node.js</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">uses</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">actions/setup-node@v4</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">with</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">node-version</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-single z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">'</span>20<span class="z-punctuation z-definition z-string z-end z-yaml">'</span></span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">    <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Install dependencies</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">run</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">npm install</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">    <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Deploy to Vercel</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">uses</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">amondnet/vercel-action@v25</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">with</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">vercel-token</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">${{ secrets.VERCEL_TOKEN }}</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">vercel-org-id</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">${{ secrets.VERCEL_ORG_ID }}</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">vercel-project-id</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">${{ secrets.VERCEL_PROJECT_ID }}</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">vercel-args</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-single z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">'</span>--prod<span class="z-punctuation z-definition z-string z-end z-yaml">'</span></span>
</span></code></pre><h2 id=gitlab><a aria-label="Anchor link for: gitlab" class=zola-anchor href=#gitlab><i class=icon></i></a> GitLab</h2><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> run<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>detach</span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>hostname</span> 192.168.3.101 <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>publish</span> 443:443<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>publish</span> 80:80<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>publish</span> 2222:22 <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>name</span> gitlab <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>restart</span> always <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>volume</span> /srv/gitlab/config:/etc/gitlab <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>volume</span> /srv/gitlab/logs:/var/log/gitlab <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>volume</span> /srv/gitlab/data:/var/opt/gitlab <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell">    gitlab/gitlab-ee:latest</span>
</span></code></pre><p><code>docker logs -f gitlab</code> логи контейнера <br> <code>docker exec -it gitlab cat /etc/gitlab/initial_root_password</code> получить пароль для root <br> <code>docker exec -it gitlab cat /etc/gitlab/gitlab.rb</code> конфигурация сервера<p>Получить токен регистрации Runner: http://192.168.3.101/root/torapi/-/settings/ci_cd#js-runners-settings<p><code>curl -L --output /usr/local/bin/gitlab-runner https://gitlab-runner-downloads.s3.amazonaws.com/latest/binaries/gitlab-runner-linux-amd64</code> загрузить исполняемый файл Runner <code>chmod +x /usr/local/bin/gitlab-runner</code><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> run<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>d</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>name</span> gitlab-runner<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>restart</span> always <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    -</span>v</span> /srv/gitlab-runner/config:/etc/gitlab-runner <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell">    gitlab/gitlab-runner:latest</span>
</span></code></pre><p><code>docker exec -it gitlab-runner bash</code> <br> <code>gitlab-runner list</code> список сборщиков <br> <code>gitlab-runner verify</code> проверка <br> <code>gitlab-runner restart</code> применить настройки <br> <code>gitlab-runner status</code> статус <br> <code>gitlab-runner unregister --all-runners</code> удалить все регистрации <br> <code>gitlab-runner install</code> установить службу <br> <code>gitlab-runner run</code> запустить с выводом в консоль<p><code>gitlab-runner register</code><pre class=z-code><code><span class="z-text z-plain">Enter the GitLab instance URL (for example, https://gitlab.com/): http://192.168.3.101/
</span><span class="z-text z-plain">Enter the registration token: GR1348941enqAxqQgm8AZJD_g7vme
</span><span class="z-text z-plain">Enter an executor: shell
</span></code></pre><p><code>cat /etc/gitlab-runner/config.toml</code> конфигурация<p>Включить импорт проектов из GitHub: http://192.168.3.101/admin/application_settings/general#js-import-export-settings<pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">variables</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">PORT</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">2024</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">TITLE</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>The+Rookie<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">stages</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">test</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">test</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">stage</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">test</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">script</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-keyword z-control z-flow z-block-scalar z-literal z-yaml">|</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">        pwsh -Command "
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">            Write-Host PORT - $env:PORT
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">            Write-Host TITLE - $env:TITLE
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">            npm install
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">            Start-Process -NoNewWindow -FilePath 'npm' -ArgumentList 'start -- --port $env:PORT' -RedirectStandardOutput 'torapi.log'
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">            Start-Sleep -Seconds 5
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">            Invoke-RestMethod -Uri http://localhost:$env:PORT/api/search/title/all?query=$env:TITLE | Format-List
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">            Get-Content torapi.log
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">            Stop-Process -Name 'node' -Force -ErrorAction SilentlyContinue
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">        "
</span></span></code></pre><h2 id=jenkins><a aria-label="Anchor link for: jenkins" class=zola-anchor href=#jenkins><i class=icon></i></a> Jenkins</h2><p><code>docker run -d --name=jenkins -p 8080:8080 -p 50000:50000 --restart=unless-stopped -v jenkins_home:/var/jenkins_home jenkins/jenkins:latest</code> <br> <code>ls /var/lib/docker/volumes/jenkins_home/_data/jobs</code> директория хранящая историю сборок в хостовой системе <br> <code>docker exec -it jenkins /bin/bash</code> подключиться к контейнеру <br> <code>cat /var/jenkins_home/secrets/initialAdminPassword</code> получить токен инициализации<pre class=z-code><code><span class="z-text z-plain">docker run -d \
</span><span class="z-text z-plain">  --name jenkins-remote-agent-01 \
</span><span class="z-text z-plain">  --restart unless-stopped \
</span><span class="z-text z-plain">  -e JENKINS_URL=http://192.168.3.101:8080 \
</span><span class="z-text z-plain">  -e JENKINS_AGENT_NAME=remote-agent-01 \
</span><span class="z-text z-plain">  -e JENKINS_SECRET=3ad54fc9f914957da8205f8b4e88ff8df20d54751545f34f22f0e28c64b1fb29 \
</span><span class="z-text z-plain">  -v jenkins_agent:/home/jenkins \
</span><span class="z-text z-plain">  jenkins/inbound-agent:latest
</span><span class="z-text z-plain">
</span><span class="z-text z-plain"># Или ссылаться на локальный контейнер сервера по имени
</span><span class="z-text z-plain"># --link jenkins:jenkins
</span><span class="z-text z-plain"># -e JENKINS_URL=http://jenkins:8080
</span></code></pre><p><code>docker exec -u root -it jenkins-remote-agent-01 /bin/bash</code> подключиться к slave агенту под root <br> <code>apt-get update && apt-get install -y iputils-ping netcat-openbsd</code> установить ping и nc на машину сборщика (slave)<p><code>jenkinsVolumePath=$(docker inspect jenkins | jq -r .[].Mounts.[].Source)</code> получить путь к директории Jenkins в хостовой системе <br> <code>sudo tar -czf $HOME/jenkins-backup.tar.gz -C $jenkinsVolumePath .</code> резервная копия всех файлов <br> <code>(crontab -l ; echo "0 23 * * * sudo tar -czf /home/lifailon/jenkins-backup.tar.gz -C /var/lib/docker/volumes/jenkins_home/_data .") | crontab -</code> <br> <code>sudo tar -xzf $HOME/jenkins-backup.tar.gz -C /var/lib/docker/volumes/jenkins_home/_data</code> восстановление<p><code>wget http://127.0.0.1:8080/jnlpJars/jenkins-cli.jar -P $HOME/</code> скачать jenkins-cli (http://127.0.0.1:8080/manage/cli) <br> <code>apt install openjdk-17-jre-headless</code> установить java runtime <br> <code>java -jar jenkins-cli.jar -auth lifailon:password -s http://127.0.0.1:8080 -webSocket help</code> получить список команд <br> <code>java -jar jenkins-cli.jar -auth lifailon:password -s http://127.0.0.1:8080 groovysh</code> запустить консоль Groovy <br> <code>java -jar jenkins-cli.jar -auth lifailon:password -s http://127.0.0.1:8080 install-plugin ssh-steps -deploy</code> устанавливаем плагин SSH Pipeline Steps<h3 id=api><a aria-label="Anchor link for: api" class=zola-anchor href=#api><i class=icon></i></a> API</h3><pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>username</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Lifailon<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>password</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>password<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>base64AuthInfo</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">Convert</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::ToBase64String<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">Text.Encoding</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::ASCII.GetBytes<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>{0}:{1}<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-string-format z-powershell">-f</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>username</span><span class="z-keyword z-operator z-other z-powershell">,</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>password</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>headers</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span><span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">Authorization</span><span class="z-keyword z-operator z-assignment z-powershell">=</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Basic {0}<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-string-format z-powershell">-f</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>base64AuthInfo</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>http://192.168.3.101:8080/rssAll<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Headers <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>headers</span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> RSS лента всех сборок и их статус в title<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>http://192.168.3.101:8080/rssFailed<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Headers <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>headers</span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> RSS лента всех неудачных сборок<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-group z-complex z-subexpression z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>http://192.168.3.101:8080/computer/local-agent/api/json<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Headers <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>headers</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span>.offline <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> проверить статус работы slave агента<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>jobs</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>http://192.168.3.101:8080/api/json/job<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Headers <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>headers</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>jobs<span class="z-variable z-other z-member z-powershell">.jobs.name</span></span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> список всех проектов<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>jobName</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Update SSH authorized_keys<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>job</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>http://192.168.3.101:8080/job/<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-braces z-begin">{</span>jobName<span class="z-punctuation z-section z-braces z-end">}</span></span>/api/json<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Headers <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>headers</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>job<span class="z-variable z-other z-member z-powershell">.builds</span></span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> список всех сборок<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>buildNumber</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>job<span class="z-variable z-other z-member z-powershell">.lastUnsuccessfulBuild.number</span></span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> последняя неуспешная сборка<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>http://192.168.3.101:8080/job/<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-braces z-begin">{</span>jobName<span class="z-punctuation z-section z-braces z-end">}</span></span>/<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-braces z-begin">{</span>buildNumber<span class="z-punctuation z-section z-braces z-end">}</span></span>/consoleText<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Headers <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>headers</span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> вывести лог указанной сборки<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>lastCompletedBuild</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>job<span class="z-variable z-other z-member z-powershell">.lastCompletedBuild.number</span></span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> последняя успешная сборка<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>crumb</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-group z-complex z-subexpression z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>http://192.168.3.101:8080/crumbIssuer/api/json<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Headers <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>headers</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span>.crumb <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> получаем временный токен доступа (crumb)<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>headers</span><span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Jenkins-Crumb<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>crumb</span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> добавляем crumb в заголовки<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>body</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>.crumb<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>crumb</span><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> добавляем crumb в тело запроса<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>http://192.168.3.101:8080/job/<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-braces z-begin">{</span>jobName<span class="z-punctuation z-section z-braces z-end">}</span></span>/<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-braces z-begin">{</span>lastCompletedBuild<span class="z-punctuation z-section z-braces z-end">}</span></span>/rebuild<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Headers <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>headers</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Method POST <span class="z-keyword z-operator z-assignment z-powershell">-</span>Body <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>body</span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> перезапустить сборку<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></code></pre><h3 id=plugins><a aria-label="Anchor link for: plugins" class=zola-anchor href=#plugins><i class=icon></i></a> Plugins</h3><table><thead><tr><th>Плагин<th>Описание<tbody><tr><td><a href=https://plugins.jenkins.io/pipeline-stage-view>Pipeline: Stage View</a><td>Визуализация шагов (stages) в интерфейсе проекта с временем их выполнения.<tr><td><a href=https://plugins.jenkins.io/rebuild>Rebuilder</a><td>Позволяет перезапускать параметризованную сборку с предустановленными параметрами в выбранной сборке.<tr><td><a href=https://plugins.jenkins.io/schedule-build>Schedule Build</a><td>Позволяет запланировать сборку на указанный момент времени.<tr><td><a href=https://plugins.jenkins.io/jobConfigHistory>Job Configuration History</a><td>Сохраняет копию файла сборки в формате <code>xml</code> (который хранится на сервере) и позволяет производить сверку.<tr><td><a href=https://plugins.jenkins.io/export-job-parameters>Export Job Parameters</a><td>Добавляет кнопку <code>Export Job Parameters</code> для конвертации все параметров в декларативный синтаксис Pipeline.<tr><td><a href=https://plugins.jenkins.io/ssh-steps>SSH Pipeline Steps</a><td>Плагин для подключения к удаленным машинам через протокол ssh по ключу или паролю.<tr><td><a href=https://plugins.jenkins.io/uno-choice>Active Choices</a><td>Активные параметры, которые позволяют динамически обновлять содержимое параметров.<tr><td><a href=https://plugins.jenkins.io/file-parameters>File Parameters</a><td>Поддержка параметров для загрузки файлов (перезагрузить Jenkins для использования нового параметра).<tr><td><a href=https://plugins.jenkins.io/ansible>Ansible</a><td>Параметраризует запуск <code>ansible-playbook</code> (требуется установка на агенте) через метод <code>ansiblePlaybook</code>.<tr><td><a href=https://plugins.jenkins.io/http_request>HTTP Request</a><td>Простой REST API Client для отправки и обработки <code>GET</code> и <code>POST</code> запросов через метод <code>httpRequest</code>.<tr><td><a href=https://plugins.jenkins.io/pipeline-utility-steps>Pipeline Utility Steps</a><td>Добавляет методы <code>readJSON</code> и <code>writeJSON</code>.<tr><td><a href=https://plugins.jenkins.io/ansicolor>ANSI Color</a><td>Добавляет поддержку стандартных escape-последовательностей ANSI для покраски вывода.<tr><td><a href=https://plugins.jenkins.io/email-ext>Email Extension</a><td>Отправка сообщений на почту из Pipeline.<tr><td><a href=https://plugins.jenkins.io/test-results-analyzer>Test Results Analyzer</a><td>Показывает историю результатов сборки <code>junit</code> тестов в табличном древовидном виде.<tr><td><a href=https://plugins.jenkins.io/embeddable-build-status>Embeddable Build Status</a><td>Предоставляет настраиваемые значки (like <code>shields.io</code>), который возвращает статус сборки.<tr><td><a href=https://plugins.jenkins.io/prometheus>Prometheus Metrics</a><td>Предоставляет конечную точку <code>/prometheus</code> с метриками, которые используются для сбора данных.<tr><td><a href=https://plugins.jenkins.io/monitoring>Web Monitoring</a><td>Добавляет конечную точку <code>/monitoring</code> для отображения графиков мониторинга в веб-интерфейсе.<tr><td><a href=https://plugins.jenkins.io/cloudbees-disk-usage-simple>CloudBees Disk Usage</a><td>Отображает использование диска всеми заданиями во вкладке <code>Manage-> Disk usage</code>.</table><h3 id=ssh-steps-and-artifacts><a aria-label="Anchor link for: ssh-steps-and-artifacts" class=zola-anchor href=#ssh-steps-and-artifacts><i class=icon></i></a> SSH Steps and Artifacts</h3><p>Добавляем логин и <code>Private Key</code> для авторизации по ssh: <code>Manage (Settings)</code> => <code>Credentials</code> => <code>Global</code> => <code>Add credentials</code> => Kind: <code>SSH Username with private key</code><p>Сценарий проверяет доступность удаленной машины, подключается к ней по ssh, выполняет скрипт <a href=https://github.com/Lifailon/hwstat>hwstat</a> для сбора метрик и выгружает json отчет в артефакты:<pre class="language-Groovy z-code" data-lang=Groovy><code class=language-Groovy data-lang=Groovy><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Глобальный массив для хранения данных подключения по ssh 
</span></span><span class="z-source z-groovy"><span class="z-storage z-type z-def z-groovy">def</span> remote <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span>:<span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span>
</span><span class="z-source z-groovy">
</span><span class="z-source z-groovy">pipeline <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    agent <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span> label <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>local-agent<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span> <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    parameters <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">string</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>address<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">defaultValue</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>192.168.3.105<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">description</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Адрес удаленного сервера<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> choice(name: "addresses", choices: ["192.168.3.101","192.168.3.102"], description: "Выберите сервер из выпадающего списка")
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">string</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>port<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">defaultValue</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>2121<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">description</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Порт ssh<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">string</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>credentials<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">defaultValue</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>d5da50fc-5a98-44c4-8c55-d009081a861a<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">description</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Идентификатор учетных данных из Jenkins<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">booleanParam</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>root<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">defaultValue</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-constant z-language z-groovy">false</span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">description</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Запуск с повышенными привилегиями<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">booleanParam</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>report<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">defaultValue</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-constant z-language z-groovy">true</span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">description</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Выгружать отчет в формате json<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> triggers {
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span>     cron('H */6 * * 1-5') // выполнять запуск каждын 6 часов с понедельника по пятницу
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> }
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    options <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">timeout</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">time</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-constant z-numeric z-groovy">5</span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">unit</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>MINUTES<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> период ожидания, после которого нужно прервать Pipeline
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">retry</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-numeric z-groovy">2</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> в случае неудачи повторить весь Pipeline указанное количество раз
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    environment <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Переменная окружения для хранения пути временного файла с содержимым приватного ключа
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-constant z-other z-groovy">SSH_KEY_FILE</span> <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>/tmp/ssh_key_<span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-constant z-other z-groovy">UUID</span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">randomUUID</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">toString</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    stages <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">stage</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Проверка доступности хоста (icmp и tcp)<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            steps <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                script <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-storage z-type z-def z-groovy">def</span> check <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">sh</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy">                        <span class="z-constant z-other z-key z-groovy">script</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-double z-block z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"""</span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                            ping -c 1 <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>address<span class="z-punctuation z-section z-embedded z-groovy">}</span></span> > /dev/null || exit 1
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                            nc -z <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>address<span class="z-punctuation z-section z-embedded z-groovy">}</span></span> <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>port<span class="z-punctuation z-section z-embedded z-groovy">}</span></span> || exit 2
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                        <span class="z-punctuation z-definition z-string z-end z-groovy">"""</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy">                        <span class="z-constant z-other z-key z-groovy">returnStatus</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-constant z-language z-groovy">true</span> <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> исключить завершение Pipeline с ошибкой
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy">                    <span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-keyword z-control z-groovy">if</span> (check <span class="z-keyword z-operator z-comparison z-groovy">==</span> <span class="z-constant z-numeric z-groovy">1</span>) <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">error</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Сервер <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>address<span class="z-punctuation z-section z-embedded z-groovy">}</span></span> недоступен (icmp ping)<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span> <span class="z-keyword z-control z-groovy">else</span> <span class="z-keyword z-control z-groovy">if</span> (check <span class="z-keyword z-operator z-comparison z-groovy">==</span> <span class="z-constant z-numeric z-groovy">2</span>) <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">error</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Порт <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>port<span class="z-punctuation z-section z-embedded z-groovy">}</span></span> закрыт (tcp check)<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span> <span class="z-keyword z-control z-groovy">else</span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Сервер <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>address<span class="z-punctuation z-section z-embedded z-groovy">}</span></span> доступен и порт <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>port<span class="z-punctuation z-section z-embedded z-groovy">}</span></span> открыт<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">stage</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Извлечение данных для авторизации по ключу<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            steps <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                script <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">withCredentials</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">sshUserPrivateKey</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">credentialsId</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>credentials<span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">usernameVariable</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>SSH_USER<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">keyFileVariable</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>SSH_KEY<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">passphraseVariable</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span><span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Записываем содержимое приватного ключа во временный файл
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">writeFile</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">file</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-storage z-type z-class z-groovy">env.SSH_KEY_FILE</span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">text</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">readFile</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-groovy">SSH_KEY</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        sh <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>chmod 600 <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-storage z-type z-class z-groovy">env.SSH_KEY_FILE</span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        remote<span class="z-punctuation z-accessor z-dot z-groovy">.</span>name <span class="z-keyword z-operator z-assignment z-groovy">=</span> params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>address
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        remote<span class="z-punctuation z-accessor z-dot z-groovy">.</span>host <span class="z-keyword z-operator z-assignment z-groovy">=</span> params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>address
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        remote<span class="z-punctuation z-accessor z-dot z-groovy">.</span>port <span class="z-keyword z-operator z-assignment z-groovy">=</span> params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>port<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">toInteger</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        remote<span class="z-punctuation z-accessor z-dot z-groovy">.</span>user <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-constant z-other z-groovy">SSH_USER</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        remote<span class="z-punctuation z-accessor z-dot z-groovy">.</span>identityFile <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-storage z-type z-class z-groovy">env.SSH_KEY_FILE</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        remote<span class="z-punctuation z-accessor z-dot z-groovy">.</span>allowAnyHosts <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-constant z-language z-groovy">true</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">stage</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Запуск скрипта через через ssh<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            steps <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                script <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-storage z-type z-def z-groovy">def</span> runCommand
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-keyword z-control z-groovy">if</span> (params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>root) <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        runCommand <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-string z-quoted z-double z-block z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"""</span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                            curl -sS https://raw.githubusercontent.com/Lifailon/hwstat/rsa/hwstat.sh | sudo bash -s -- "json" > "hwstat-report.json"
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                        <span class="z-punctuation z-definition z-string z-end z-groovy">"""</span></span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span> <span class="z-keyword z-control z-groovy">else</span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        runCommand <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-string z-quoted z-double z-block z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"""</span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                            curl -sS https://raw.githubusercontent.com/Lifailon/hwstat/rsa/hwstat.sh | bash -s -- "json" > "hwstat-report.json"
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                        <span class="z-punctuation z-definition z-string z-end z-groovy">"""</span></span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-storage z-type z-def z-groovy">def</span> jsonOutput <span class="z-keyword z-operator z-assignment z-groovy">=</span> sshCommand <span class="z-constant z-other z-key z-groovy">remote</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> remote, <span class="z-constant z-other z-key z-groovy">command</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> runCommand
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-keyword z-control z-groovy">if</span> (params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>report) <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Записать содержимое переменной в файл
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> writeFile file: 'hwstat-report.json', text: jsonOutput
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Загрузить файл из удаленной машины
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        sshGet <span class="z-constant z-other z-key z-groovy">remote</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> remote, <span class="z-constant z-other z-key z-groovy">from</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>hwstat-report.json<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>, <span class="z-constant z-other z-key z-groovy">into</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span><span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-storage z-type z-class z-groovy">env.WORKSPACE</span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span>/hwstat-report.json<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>, <span class="z-constant z-other z-key z-groovy">override</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-constant z-language z-groovy">true</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    sshCommand <span class="z-constant z-other z-key z-groovy">remote</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> remote, <span class="z-constant z-other z-key z-groovy">command</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>rm hwstat-report.json<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">stage</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Загрузка json отчета в Jenkins<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Проверка условия перед выполнением шага (пропуск если false)
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            when <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                expression <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span> params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>report <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            steps <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                archiveArtifacts <span class="z-constant z-other z-key z-groovy">artifacts</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>hwstat-report.json<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span>, <span class="z-constant z-other z-key z-groovy">allowEmptyArchive</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-constant z-language z-groovy">true</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    post <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Выполнять независимо от успеха или ошибки
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        always <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            script <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                sh <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>rm -f <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-storage z-type z-class z-groovy">env.SSH_KEY_FILE</span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        success   <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span> echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Сборка завершена успешно<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span> <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        failure   <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span> echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Сборка завершилась с ошибкой<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span> <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        unstable  <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span> echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Сборка завершилась с предупреждениями<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span> <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        changed   <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span> echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Текущий статус завершения изменился по сравнению с предыдущим запуском<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span> <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        fixed     <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span> echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Сборка завершена успешно по сравнению с предыдущим запуском<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span> <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        aborted   <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span> echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Запуск был прерван<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span> <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></code></pre><h3 id=upload-file-parameter><a aria-label="Anchor link for: upload-file-parameter" class=zola-anchor href=#upload-file-parameter><i class=icon></i></a> Upload File Parameter</h3><p>Передача файла через параметр и чтение его содержимого:<pre class="language-Groovy z-code" data-lang=Groovy><code class=language-Groovy data-lang=Groovy><span class="z-source z-groovy">pipeline <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    agent any
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    parameters <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        base64File <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>UPLOAD_FILE<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    stages <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">stage</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Читаем содержимое файла<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            steps <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Переменная хранит содержимое файла в формате base64
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> echo UPLOAD_FILE
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Декодируем base64
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">withFileParameter</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>UPLOAD_FILE<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    sh <span class="z-string z-quoted z-double z-block z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"""</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                        echo "<span class="z-variable z-other z-interpolated z-groovy">$UPLOAD_FILE</span>" # выводим путь к временному файлу с содержимым переданного файла
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                        cat "<span class="z-variable z-other z-interpolated z-groovy">$UPLOAD_FILE</span>"  # читаем содержимое файла
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                    <span class="z-punctuation z-definition z-string z-end z-groovy">"""</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></code></pre><h3 id=input-text-and-file><a aria-label="Anchor link for: input-text-and-file" class=zola-anchor href=#input-text-and-file><i class=icon></i></a> Input Text and File</h3><p>Останавливает выполнение <code>Pipeline</code> и заставляет пользователя передать текстовый параметр и файл:<pre class="language-Groovy z-code" data-lang=Groovy><code class=language-Groovy data-lang=Groovy><span class="z-source z-groovy">pipeline <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    agent any
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    stages <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">stage</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Input text<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            input <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                message <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Что бы продолжить, передайте текст в поле ввода<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                ok <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Передать<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                parameters <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">string</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>TEXT<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">defaultValue</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>test<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">description</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Введите текст<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            steps <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Переданный текст в параметре input: <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-constant z-other z-groovy">TEXT</span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">stage</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Input file<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            steps <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                script <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-storage z-type z-def z-groovy">def</span> fileBase64 <span class="z-keyword z-operator z-assignment z-groovy">=</span> input <span class="z-constant z-other z-key z-groovy">message</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Передайте файл<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>, <span class="z-constant z-other z-key z-groovy">parameters</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">base64File</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>file<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    sh <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>echo <span class="z-variable z-other z-interpolated z-groovy">$fileBase64</span> | base64 -d<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></code></pre><h3 id=httpurlconnection><a aria-label="Anchor link for: httpurlconnection" class=zola-anchor href=#httpurlconnection><i class=icon></i></a> HttpURLConnection</h3><p>Любой код Groovy возможно запустить и проверить через <code>Script Console</code> (http://127.0.0.1:8080/manage/script)<p>Пример <code>API</code> запроса к репозиторию PowerShell на GitHub для получения последней версии и всех доступных версий:<pre class="language-Groovy z-code" data-lang=Groovy><code class=language-Groovy data-lang=Groovy><span class="z-source z-groovy"><span class="z-meta z-import z-groovy"><span class="z-keyword z-other z-import z-groovy">import</span> <span class="z-storage z-type z-import z-groovy">groovy.json.JsonSlurper
</span></span></span><span class="z-source z-groovy"><span class="z-storage z-type z-def z-groovy">def</span> url <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-constant z-other z-groovy">URL</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>https://api.github.com/repos/PowerShell/PowerShell/tags<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>)
</span><span class="z-source z-groovy"><span class="z-storage z-type z-def z-groovy">def</span> connection <span class="z-keyword z-operator z-assignment z-groovy">=</span> url<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">openConnection</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span><span class="z-source z-groovy">connection<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">setRequestMethod</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>GET<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span><span class="z-source z-groovy">connection<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">setRequestProperty</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Accept<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>application/json<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span><span class="z-source z-groovy"><span class="z-storage z-type z-def z-groovy">def</span> responseCode <span class="z-keyword z-operator z-assignment z-groovy">=</span> connection<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">getResponseCode</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span><span class="z-source z-groovy"><span class="z-keyword z-control z-groovy">if</span> (responseCode <span class="z-keyword z-operator z-comparison z-groovy">==</span> <span class="z-constant z-numeric z-groovy">200</span>) <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Получаем данные ответа
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-storage z-type z-def z-groovy">def</span> response <span class="z-keyword z-operator z-assignment z-groovy">=</span> connection<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">getInputStream</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">getText</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Парсим JSON ответ
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-storage z-type z-def z-groovy">def</span> jsonSlurper <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">JsonSlurper</span>()
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-storage z-type z-def z-groovy">def</span> tags <span class="z-keyword z-operator z-assignment z-groovy">=</span> jsonSlurper<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">parseText</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span>response<span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Проверяем количество элементов в массиве
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-keyword z-control z-groovy">if</span> (tags<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">size</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-keyword z-operator z-comparison z-groovy">></span> <span class="z-constant z-numeric z-groovy">0</span>) <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Забираем последний тег из списка
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-storage z-type z-def z-groovy">def</span> latestTag <span class="z-keyword z-operator z-assignment z-groovy">=</span> tags<span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-constant z-numeric z-groovy">0</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span>name
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-support z-function z-print z-groovy">println</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Latest version: <span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span> <span class="z-keyword z-operator z-arithmetic z-groovy">+</span> latestTag)
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-support z-function z-print z-groovy">println</span>()
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Проходимся по всем тегам
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-support z-function z-print z-groovy">println</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>List of all versions:<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>)
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-keyword z-control z-groovy">for</span> (tag in tags) <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-support z-function z-print z-groovy">println</span>(tag<span class="z-punctuation z-accessor z-dot z-groovy">.</span>name)
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span> <span class="z-keyword z-control z-groovy">else</span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">error</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>No tags found in the response<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-end z-groovy">}</span></span> <span class="z-keyword z-control z-groovy">else</span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">error</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Failed to call API, response code: <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>responseCode<span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span><span class="z-source z-groovy">connection<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">disconnect</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></code></pre><h3 id=httprequest><a aria-label="Anchor link for: httprequest" class=zola-anchor href=#httprequest><i class=icon></i></a> httpRequest</h3><p>Пример HTTP запроса и чтения <code>json</code> файла с помощью плагинов <code>HTTP Request</code> и <code>Pipeline Utility Steps</code>:<pre class="language-groovy z-code" data-lang=groovy><code class=language-groovy data-lang=groovy><span class="z-source z-groovy">pipeline <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    agent any
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    stages <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">stage</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>HTTP Request and Read JSON<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            steps <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                script <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-storage z-type z-def z-groovy">def</span> url <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>https://torapi.vercel.app/api/provider/list<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-storage z-type z-def z-groovy">def</span> response <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">httpRequest</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">url</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> url<span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">httpMode</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>GET<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">contentType</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>APPLICATION_JSON<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span><span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>response<span class="z-punctuation z-accessor z-dot z-groovy">.</span>status<span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span><span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>response<span class="z-punctuation z-accessor z-dot z-groovy">.</span>headers<span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span><span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>response<span class="z-punctuation z-accessor z-dot z-groovy">.</span>content<span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-storage z-type z-def z-groovy">def</span> jsonData <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">readJSON</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">text</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> response<span class="z-punctuation z-accessor z-dot z-groovy">.</span>content<span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Url array: <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>jsonData<span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-constant z-numeric z-groovy">0</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-storage z-type z-class z-groovy">Urls</span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>One url: <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>jsonData<span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-constant z-numeric z-groovy">0</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-storage z-type z-class z-groovy">Urls</span><span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-constant z-numeric z-groovy">0</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-keyword z-control z-groovy">for</span> (u in jsonData<span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-constant z-numeric z-groovy">0</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-storage z-type z-class z-groovy">Urls</span>) <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        echo u
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">writeJSON</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">file</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>debug.json<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">json</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> jsonData<span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    archiveArtifacts <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>debug.json<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></code></pre><h3 id=active-choices-parameter><a aria-label="Anchor link for: active-choices-parameter" class=zola-anchor href=#active-choices-parameter><i class=icon></i></a> Active Choices Parameter</h3><p>Пример получения списка доступных версий в выбранном репозитории и содержимого файлов для выбранного релиза, а также загрузка указанного файла:<pre class="language-Groovy z-code" data-lang=Groovy><code class=language-Groovy data-lang=Groovy><span class="z-source z-groovy">pipeline <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    agent any
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">        parameters <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">activeChoice</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy">            <span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Repos<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy">            <span class="z-constant z-other z-key z-groovy">description</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Select repository.<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy">            <span class="z-constant z-other z-key z-groovy">choiceType</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>PT_RADIO<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy">            <span class="z-constant z-other z-key z-groovy">filterable</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-constant z-language z-groovy">false</span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy">            <span class="z-constant z-other z-key z-groovy">script</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy">                $<span class="z-constant z-other z-key z-groovy">class</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>GroovyScript<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-groovy">,</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy">                <span class="z-constant z-other z-key z-groovy">script</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy">                    <span class="z-constant z-other z-key z-groovy">sandbox</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-constant z-language z-groovy">true</span><span class="z-punctuation z-definition z-separator z-groovy">,</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy">                    <span class="z-constant z-other z-key z-groovy">script</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-block z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'''</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-string z-quoted z-single z-block z-groovy">                        return [
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-string z-quoted z-single z-block z-groovy">                            'Lifailon/lazyjournal',
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-string z-quoted z-single z-block z-groovy">                            'jesseduffield/lazydocker'
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-string z-quoted z-single z-block z-groovy">                        ]
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-string z-quoted z-single z-block z-groovy">                    <span class="z-punctuation z-definition z-string z-end z-groovy">'''</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy">                <span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy">            <span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy">        <span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">reactiveChoice</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy">            <span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Versions<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy">            <span class="z-constant z-other z-key z-groovy">description</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Select version.<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy">            <span class="z-constant z-other z-key z-groovy">choiceType</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>PT_SINGLE_SELECT<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy">            <span class="z-constant z-other z-key z-groovy">filterable</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-constant z-language z-groovy">true</span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy">            <span class="z-constant z-other z-key z-groovy">filterLength</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-constant z-numeric z-groovy">1</span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy">            <span class="z-constant z-other z-key z-groovy">script</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy">                $<span class="z-constant z-other z-key z-groovy">class</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>GroovyScript<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-groovy">,</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy">                <span class="z-constant z-other z-key z-groovy">script</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy">                    <span class="z-constant z-other z-key z-groovy">sandbox</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-constant z-language z-groovy">true</span><span class="z-punctuation z-definition z-separator z-groovy">,</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy">                    <span class="z-constant z-other z-key z-groovy">script</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-block z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'''</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-string z-quoted z-single z-block z-groovy">                        import groovy.json.JsonSlurper
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-string z-quoted z-single z-block z-groovy">                        def selectedRepo = Repos
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-string z-quoted z-single z-block z-groovy">                        def apiUrl = "https://api.github.com/repos/${selectedRepo}/tags"
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-string z-quoted z-single z-block z-groovy">                        def conn = new URL(apiUrl).openConnection()
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-string z-quoted z-single z-block z-groovy">                        conn.setRequestProperty("User-Agent", "Jenkins")
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-string z-quoted z-single z-block z-groovy">                        def response = conn.getInputStream().getText()
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-string z-quoted z-single z-block z-groovy">                        def json = new JsonSlurper().parseText(response)
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-string z-quoted z-single z-block z-groovy">                        def versionsCount = json.size()
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-string z-quoted z-single z-block z-groovy">                        def data = []
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-string z-quoted z-single z-block z-groovy">                        for (int i = 0; i < versionsCount; i++) {
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-string z-quoted z-single z-block z-groovy">                            data += json.name[i]
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-string z-quoted z-single z-block z-groovy">                        }
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-string z-quoted z-single z-block z-groovy">                        return data
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-string z-quoted z-single z-block z-groovy">                    <span class="z-punctuation z-definition z-string z-end z-groovy">'''</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy">                <span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy">            <span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy">            <span class="z-constant z-other z-key z-groovy">referencedParameters</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Repos<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy">        <span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">reactiveChoice</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy">            <span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Files<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy">            <span class="z-constant z-other z-key z-groovy">description</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Select file.<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy">            <span class="z-constant z-other z-key z-groovy">choiceType</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>PT_SINGLE_SELECT<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy">            <span class="z-constant z-other z-key z-groovy">filterable</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-constant z-language z-groovy">true</span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy">            <span class="z-constant z-other z-key z-groovy">filterLength</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-constant z-numeric z-groovy">1</span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy">            <span class="z-constant z-other z-key z-groovy">script</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy">                $<span class="z-constant z-other z-key z-groovy">class</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>GroovyScript<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-groovy">,</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy">                <span class="z-constant z-other z-key z-groovy">script</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy">                    <span class="z-constant z-other z-key z-groovy">sandbox</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-constant z-language z-groovy">true</span><span class="z-punctuation z-definition z-separator z-groovy">,</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy">                    <span class="z-constant z-other z-key z-groovy">script</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-block z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'''</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-string z-quoted z-single z-block z-groovy">                        import groovy.json.JsonSlurper
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-string z-quoted z-single z-block z-groovy">                        def selectedRepo = Repos
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-string z-quoted z-single z-block z-groovy">                        def selectedVer = Versions
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-string z-quoted z-single z-block z-groovy">                        def apiUrl = "https://api.github.com/repos/${selectedRepo}/releases/tags/${selectedVer}"
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-string z-quoted z-single z-block z-groovy">                        def conn = new URL(apiUrl).openConnection()
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-string z-quoted z-single z-block z-groovy">                        conn.setRequestProperty("User-Agent", "Jenkins")
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-string z-quoted z-single z-block z-groovy">                        def response = conn.getInputStream().getText()
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-string z-quoted z-single z-block z-groovy">                        def json = new JsonSlurper().parseText(response)
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-string z-quoted z-single z-block z-groovy">                        def data = []
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-string z-quoted z-single z-block z-groovy">                        for (file in json.assets) {
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-string z-quoted z-single z-block z-groovy">                            data += file.name
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-string z-quoted z-single z-block z-groovy">                        }
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-string z-quoted z-single z-block z-groovy">                        return data
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-string z-quoted z-single z-block z-groovy">                    <span class="z-punctuation z-definition z-string z-end z-groovy">'''</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-meta z-structure z-groovy">                <span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-structure z-groovy">            <span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy">            <span class="z-constant z-other z-key z-groovy">referencedParameters</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Repos,Versions<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy">        <span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    stages <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">stage</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Selected parameters<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            steps <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                script <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Selected repository: https://github.com/<span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-storage z-type z-class z-groovy">params.Repos</span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Selected version: <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-storage z-type z-class z-groovy">params.Versions</span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Selected file: <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-storage z-type z-class z-groovy">params.Files</span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-storage z-type z-def z-groovy">def</span> downloadUrl <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>https://github.com/<span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-storage z-type z-class z-groovy">params.Repos</span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span>/releases/download/<span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-storage z-type z-class z-groovy">params.Versions</span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span>/<span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-storage z-type z-class z-groovy">params.Files</span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Url for download: <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>downloadUrl<span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">httpRequest</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">url</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> downloadUrl<span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">outputFile</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-storage z-type z-class z-groovy">params.Files</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    archiveArtifacts <span class="z-storage z-type z-class z-groovy">params.Files</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></code></pre><h3 id=vault><a aria-label="Anchor link for: vault" class=zola-anchor href=#vault><i class=icon></i></a> Vault</h3><p>Интеграция <a href=https://github.com/hashicorp/vault>HashiCorp Vault</a> в Jenkins Pipeline через <code>REST API</code> для получения содержимого секретов и использовая в последующих стадиях/этапах сборки:<pre class="language-Groovy z-code" data-lang=Groovy><code class=language-Groovy data-lang=Groovy><span class="z-source z-groovy"><span class="z-meta z-definition z-method z-groovy"><span class="z-storage z-type z-return-type z-def z-groovy">def</span> <span class="z-entity z-name z-function z-groovy">getVaultSecrets</span><span class="z-punctuation z-definition z-parameters z-begin z-groovy">(</span><span class="z-meta z-definition z-method z-parameters z-groovy">
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-definition z-method z-groovy"><span class="z-meta z-definition z-method z-parameters z-groovy"><span class="z-meta z-definition z-method z-parameter z-groovy">    <span class="z-storage z-type z-parameter z-groovy">String</span> <span class="z-variable z-parameter z-groovy">address</span></span><span class="z-punctuation z-definition z-parameters z-separator z-groovy">,</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-definition z-method z-groovy"><span class="z-meta z-definition z-method z-parameters z-groovy"><span class="z-meta z-definition z-method z-parameter z-groovy">    <span class="z-storage z-type z-parameter z-groovy">String</span> <span class="z-variable z-parameter z-groovy">path</span></span><span class="z-punctuation z-definition z-parameters z-separator z-groovy">,</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-definition z-method z-groovy"><span class="z-meta z-definition z-method z-parameters z-groovy"><span class="z-meta z-definition z-method z-parameter z-groovy">    <span class="z-storage z-type z-parameter z-groovy">String</span> <span class="z-variable z-parameter z-groovy">token</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-definition z-method z-groovy"><span class="z-meta z-definition z-method z-parameters z-groovy"></span><span class="z-punctuation z-definition z-parameters z-end z-groovy">)</span> {</span>
</span><span class="z-source z-groovy">    <span class="z-storage z-type z-def z-groovy">def</span> url <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-constant z-other z-groovy">URL</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span><span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>address<span class="z-punctuation z-section z-embedded z-groovy">}</span></span>/<span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>path<span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>)
</span><span class="z-source z-groovy">    
</span><span class="z-source z-groovy">    <span class="z-storage z-type z-def z-groovy">def</span> connection <span class="z-keyword z-operator z-assignment z-groovy">=</span> url<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">openConnection</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span><span class="z-source z-groovy">    connection<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">setRequestMethod</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>GET<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span><span class="z-source z-groovy">    connection<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">setRequestProperty</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>X-Vault-Token<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> token<span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span><span class="z-source z-groovy">    connection<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">setRequestProperty</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Accept<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>application/json<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span><span class="z-source z-groovy">    
</span><span class="z-source z-groovy">    <span class="z-storage z-type z-def z-groovy">def</span> response <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">groovy.json.JsonSlurper</span>()<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">parse</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span>connection<span class="z-punctuation z-accessor z-dot z-groovy">.</span>inputStream<span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span><span class="z-source z-groovy">    <span class="z-storage z-type z-def z-groovy">def</span> user <span class="z-keyword z-operator z-assignment z-groovy">=</span> response<span class="z-punctuation z-accessor z-dot z-groovy">.</span>data<span class="z-punctuation z-accessor z-dot z-groovy">.</span>data<span class="z-punctuation z-accessor z-dot z-groovy">.</span>user
</span><span class="z-source z-groovy">    <span class="z-storage z-type z-def z-groovy">def</span> password <span class="z-keyword z-operator z-assignment z-groovy">=</span> response<span class="z-punctuation z-accessor z-dot z-groovy">.</span>data<span class="z-punctuation z-accessor z-dot z-groovy">.</span>data<span class="z-punctuation z-accessor z-dot z-groovy">.</span>password
</span><span class="z-source z-groovy">    <span class="z-keyword z-control z-groovy">return</span> <span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-structure z-groovy">        <span class="z-constant z-other z-key z-groovy">user</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> user<span class="z-punctuation z-definition z-separator z-groovy">,</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-structure z-groovy">        <span class="z-constant z-other z-key z-groovy">password</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> password
</span></span><span class="z-source z-groovy"><span class="z-meta z-structure z-groovy">    <span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span>
</span><span class="z-source z-groovy">}
</span><span class="z-source z-groovy">
</span><span class="z-source z-groovy"><span class="z-storage z-type z-def z-groovy">def</span> <span class="z-constant z-other z-groovy">USER_NAME</span>
</span><span class="z-source z-groovy"><span class="z-storage z-type z-def z-groovy">def</span> <span class="z-constant z-other z-groovy">USER_PASS</span>
</span><span class="z-source z-groovy">
</span><span class="z-source z-groovy">pipeline <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    agent any
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    parameters <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">string</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>url<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">defaultValue</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>http://192.168.3.101:8200<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">description</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Url адресс хранилища секретов<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">string</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>path<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">defaultValue</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>v1/kv/data/ssh-auth<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">description</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Путь для извлечения секретов<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">password</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>token<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">defaultValue</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>hvs.bySybhyYOxSWEVk4FQDdcyyg<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">description</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Токен доступа к API HashiCorp Vault<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    stages <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">stage</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Get vault secrets<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            steps <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                script <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-storage z-type z-def z-groovy">def</span> secrets <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">getVaultSecrets</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy">                        <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span><span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>url<span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy">                        <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span><span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>path<span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy">                        <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span><span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>token<span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-method-call z-groovy">                    <span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-constant z-other z-groovy">USER_NAME</span> <span class="z-keyword z-operator z-assignment z-groovy">=</span> secrets<span class="z-punctuation z-accessor z-dot z-groovy">.</span>user
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-constant z-other z-groovy">USER_PASS</span> <span class="z-keyword z-operator z-assignment z-groovy">=</span> secrets<span class="z-punctuation z-accessor z-dot z-groovy">.</span>password
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">stage</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Use secrets<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            steps <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                script <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>User: <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-constant z-other z-groovy">USER_NAME</span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Password: <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-constant z-other z-groovy">USER_PASS</span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></code></pre><h3 id=email-extension><a aria-label="Anchor link for: email-extension" class=zola-anchor href=#email-extension><i class=icon></i></a> Email Extension</h3><p>Для отправки на почту и настроить SMTP сервер в настройках Jenkins (<code>System</code> => <code>Extended E-mail Notification</code>)<p>SMTP server: <code>smtp.yandex.ru</code> SMTP port: <code>587</code> Credentials: <code>Username with password</code> (<code>username@yandex.ru</code> и <code>app-password</code>) <code>Use TLS</code> Default Content Type: <code>HTML (text/html)</code><p>Настройка логирования в System Log: <code>emailDebug</code> + фильтр <code>hudson.plugins.emailext</code> и уровень <code>ALL</code><pre class="language-Groovy z-code" data-lang=Groovy><code class=language-Groovy data-lang=Groovy><span class="z-source z-groovy">pipeline <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    agent any
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    parameters <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">string</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>emailTo<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">defaultValue</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>test@yandex.ru<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">description</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Почтовый адрес назначения<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    stages <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">stage</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Вывод всех переменных окружения<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            steps <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                script <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    env<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">getEnvironment</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span>each <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span> key, value <span class="z-keyword z-operator z-arrow z-groovy">-></span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span><span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>key<span class="z-punctuation z-section z-embedded z-groovy">}</span></span> = <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>value<span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">stage</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Отправка на почту<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            options <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">timeout</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-other z-key z-groovy">time</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-constant z-numeric z-groovy">1</span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">unit</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>MINUTES<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            steps <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                script <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    emailext (
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        <span class="z-constant z-other z-key z-groovy">to</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span>	<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span><span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>params<span class="z-punctuation z-accessor z-dot z-groovy">.</span>emailTo<span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>,
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        <span class="z-constant z-other z-key z-groovy">subject</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span><span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-storage z-type z-class z-groovy">env.JOB_NAME</span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span> - <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-constant z-other z-groovy">BUILD_NUMBER</span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>,
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        <span class="z-constant z-other z-key z-groovy">mimeType</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>text/html<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>,
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        <span class="z-constant z-other z-key z-groovy">body</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-double z-block z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"""</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                            &LThtml>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                                &LTbody>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                                    &LTdiv style="padding-left: 30px; padding-bottom: 15px;" color="blue">
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                                    &LTfont name="Arial" color="#906090" size="3" font-weight="normal">
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                                        &LTb> <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-storage z-type z-class z-groovy">env.JOB_NAME</span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span> - <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-storage z-type z-class z-groovy">env.BUILD_NUMBER</span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span> &LT/b>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                                    &LT/font>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                                    &LTbr>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                                    &LTdiv style="padding-left: 30px; padding-bottom: 15px;" color="black">
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                                    &LTbr>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                                    &LTfont name="Arial" color="black" size="2" font-weight="normal"> 
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                                        &LTpre> Build url: <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-storage z-type z-class z-groovy">env.BUILD_URL</span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span> &LT/pre>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                                    &LT/font>	
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                                &LT/body>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                            &LT/html>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">                        <span class="z-punctuation z-definition z-string z-end z-groovy">"""</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    )
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></code></pre><h3 id=parallel><a aria-label="Anchor link for: parallel" class=zola-anchor href=#parallel><i class=icon></i></a> Parallel</h3><pre class="language-Groovy z-code" data-lang=Groovy><code class=language-Groovy data-lang=Groovy><span class="z-source z-groovy">pipeline <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    agent any
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    stages <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">stage</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Parallel sleeps<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            parallel <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">stage</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Task 1<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    steps <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        script <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                            <span class="z-storage z-type z-def z-groovy">def</span> currentTime <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">Date</span>()<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">format</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>yyyy-MM-dd HH:mm:ss<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                            echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>[<span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>currentTime<span class="z-punctuation z-section z-embedded z-groovy">}</span></span>] Начало задачи 1<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                            sh <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>sleep 10<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                            currentTime <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">Date</span>()<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">format</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>yyyy-MM-dd HH:mm:ss<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                            echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>[<span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>currentTime<span class="z-punctuation z-section z-embedded z-groovy">}</span></span>] Завершение задачи 1<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">stage</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Task 2<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    steps <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        script <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                            <span class="z-storage z-type z-def z-groovy">def</span> currentTime <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">Date</span>()<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">format</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>yyyy-MM-dd HH:mm:ss<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                            echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>[<span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>currentTime<span class="z-punctuation z-section z-embedded z-groovy">}</span></span>] Начало задачи 2<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                            sh <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>sleep 5<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                            currentTime <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">Date</span>()<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">format</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>yyyy-MM-dd HH:mm:ss<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                            echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>[<span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>currentTime<span class="z-punctuation z-section z-embedded z-groovy">}</span></span>] Завершение задачи 2<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">stage</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Parallel tasks via loop<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            steps <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                script <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Массив, где ключи содержит имя задачи, а значение содержит блоки кода для выполнения
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-storage z-type z-def z-groovy">def</span> tasks <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span>:<span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-storage z-type z-def z-groovy">def</span> taskNames <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Task 1<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Task 2<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Task 3<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    taskNames<span class="z-punctuation z-accessor z-dot z-groovy">.</span>each <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span> taskName <span class="z-keyword z-operator z-arrow z-groovy">-></span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        tasks<span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span>taskName<span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span> <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                            <span class="z-storage z-type z-def z-groovy">def</span> currentTime <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">Date</span>()<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">format</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>yyyy-MM-dd HH:mm:ss<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                            echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>[<span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>currentTime<span class="z-punctuation z-section z-embedded z-groovy">}</span></span>] Начало задачи: <span class="z-variable z-other z-interpolated z-groovy">$taskName</span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                            sh <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>sleep <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>taskName <span class="z-keyword z-operator z-comparison z-groovy">==</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Task 1<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span> <span class="z-meta z-evaluation z-ternary z-groovy"><span class="z-keyword z-operator z-ternary z-groovy">?</span> <span class="z-constant z-numeric z-groovy">10</span> <span class="z-keyword z-operator z-ternary z-expression-separator z-groovy">:</span> taskName <span class="z-keyword z-operator z-comparison z-groovy">==</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>Task 2<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span> <span class="z-meta z-evaluation z-ternary z-groovy"><span class="z-keyword z-operator z-ternary z-groovy">?</span> <span class="z-constant z-numeric z-groovy">5</span> <span class="z-keyword z-operator z-ternary z-expression-separator z-groovy">:</span> <span class="z-constant z-numeric z-groovy">3</span></span></span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                            currentTime <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">Date</span>()<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">format</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>yyyy-MM-dd HH:mm:ss<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                            echo <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>[<span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>currentTime<span class="z-punctuation z-section z-embedded z-groovy">}</span></span>] Завершение задачи: <span class="z-variable z-other z-interpolated z-groovy">$taskName</span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                    parallel tasks
</span></span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">                <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></code></pre><h2 id=groovy><a aria-label="Anchor link for: groovy" class=zola-anchor href=#groovy><i class=icon></i></a> Groovy</h2><p>Базовый синтаксис языка <code>Groovy</code>:<pre class="language-Groovy z-code" data-lang=Groovy><code class=language-Groovy data-lang=Groovy><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Переменные
</span></span><span class="z-source z-groovy">javaString <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>java<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span>
</span><span class="z-source z-groovy">javaString
</span><span class="z-source z-groovy"><span class="z-support z-function z-print z-groovy">println</span> javaString
</span><span class="z-source z-groovy">javaString<span class="z-punctuation z-accessor z-dot z-groovy">.</span>class    <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> class java.lang.String
</span></span><span class="z-source z-groovy"><span class="z-support z-function z-print z-groovy">println</span> <span class="z-constant z-numeric z-groovy">100.</span>class   <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> class java.lang.Integer
</span></span><span class="z-source z-groovy">j <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>${javaString}<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span> <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> не принимает переменные в одинарных кавычках
</span></span><span class="z-source z-groovy">groovyString <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span><span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>javaString<span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span><span class="z-source z-groovy">bigGroovyString <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-string z-quoted z-double z-block z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"""</span>
</span></span><span class="z-source z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">    <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>javaString<span class="z-punctuation z-section z-embedded z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">    <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>j<span class="z-punctuation z-section z-embedded z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">    <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>groovyString<span class="z-punctuation z-section z-embedded z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-string z-quoted z-double z-block z-groovy">    <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-constant z-numeric z-groovy">2</span> <span class="z-keyword z-operator z-arithmetic z-groovy">+</span> <span class="z-constant z-numeric z-groovy">2</span><span class="z-punctuation z-section z-embedded z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-string z-quoted z-double z-block z-groovy"><span class="z-punctuation z-definition z-string z-end z-groovy">"""</span></span>
</span><span class="z-source z-groovy">
</span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> java
</span></span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> ${javaString}
</span></span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> java
</span></span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> 4
</span></span><span class="z-source z-groovy">
</span><span class="z-source z-groovy">a <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>a<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>   <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> a
</span></span><span class="z-source z-groovy">a <span class="z-keyword z-operator z-arithmetic z-groovy">+</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>123<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span> <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> a123
</span></span><span class="z-source z-groovy">a <span class="z-keyword z-operator z-arithmetic z-groovy">*</span> <span class="z-constant z-numeric z-groovy">5</span>     <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> aaaaa
</span></span><span class="z-source z-groovy">
</span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Массивы и списки
</span></span><span class="z-source z-groovy">list <span class="z-keyword z-operator z-assignment z-groovy">=</span><span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-constant z-numeric z-groovy">1</span><span class="z-punctuation z-definition z-separator z-groovy">,</span><span class="z-constant z-numeric z-groovy">2</span><span class="z-punctuation z-definition z-separator z-groovy">,</span><span class="z-constant z-numeric z-groovy">3</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span>
</span><span class="z-source z-groovy">list<span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-constant z-numeric z-groovy">0</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span>    <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> 1
</span></span><span class="z-source z-groovy">list<span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-constant z-numeric z-groovy">0</span><span class="z-keyword z-operator z-range z-groovy">..</span><span class="z-constant z-numeric z-groovy">1</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span> <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> [1, 2]
</span></span><span class="z-source z-groovy">range <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>0123456789<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span><span class="z-source z-groovy">range<span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-constant z-numeric z-groovy">1</span><span class="z-keyword z-operator z-range z-groovy">..</span><span class="z-constant z-numeric z-groovy">5</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span> <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> 12345
</span></span><span class="z-source z-groovy">map <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-constant z-other z-key z-groovy">key1</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-constant z-language z-groovy">true</span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">key2</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-constant z-language z-groovy">false</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span>
</span><span class="z-source z-groovy">map<span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>key1<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span> <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> true
</span></span><span class="z-source z-groovy">server <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span>:<span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span>
</span><span class="z-source z-groovy">server<span class="z-punctuation z-accessor z-dot z-groovy">.</span>ip <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>192.168.3.1<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span><span class="z-source z-groovy">server<span class="z-punctuation z-accessor z-dot z-groovy">.</span>port <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-constant z-numeric z-groovy">22</span>
</span><span class="z-source z-groovy"><span class="z-support z-function z-print z-groovy">println</span>(server) <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> [ip:192.168.3.1, port:22]
</span></span><span class="z-source z-groovy">
</span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Функции
</span></span><span class="z-source z-groovy"><span class="z-meta z-definition z-method z-groovy"><span class="z-storage z-type z-return-type z-def z-groovy">def</span> <span class="z-entity z-name z-function z-groovy">sum</span><span class="z-punctuation z-definition z-parameters z-begin z-groovy">(</span><span class="z-meta z-definition z-method z-parameters z-groovy"><span class="z-meta z-definition z-method z-parameter z-groovy"><span class="z-variable z-parameter z-groovy">a</span></span><span class="z-punctuation z-definition z-parameters z-separator z-groovy">,</span><span class="z-meta z-definition z-method z-parameter z-groovy"><span class="z-variable z-parameter z-groovy">b</span></span></span><span class="z-punctuation z-definition z-parameters z-end z-groovy">)</span> {</span>
</span><span class="z-source z-groovy">    <span class="z-support z-function z-print z-groovy">println</span> a<span class="z-keyword z-operator z-arithmetic z-groovy">+</span>b
</span><span class="z-source z-groovy">}
</span><span class="z-source z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">sum</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-numeric z-groovy">2</span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span><span class="z-constant z-numeric z-groovy">2</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> 4
</span></span><span class="z-source z-groovy">
</span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Условия
</span></span><span class="z-source z-groovy"><span class="z-meta z-definition z-method z-groovy"><span class="z-storage z-type z-return-type z-def z-groovy">def</span> <span class="z-entity z-name z-function z-groovy">diff</span><span class="z-punctuation z-definition z-parameters z-begin z-groovy">(</span><span class="z-meta z-definition z-method z-parameters z-groovy"><span class="z-meta z-definition z-method z-parameter z-groovy"><span class="z-variable z-parameter z-groovy">x</span></span></span><span class="z-punctuation z-definition z-parameters z-end z-groovy">)</span> {</span>
</span><span class="z-source z-groovy">    <span class="z-keyword z-control z-groovy">if</span> (x <span class="z-keyword z-operator z-comparison z-groovy"><</span> <span class="z-constant z-numeric z-groovy">10</span>) <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-support z-function z-print z-groovy">println</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span><span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>x<span class="z-punctuation z-section z-embedded z-groovy">}</span></span> < 10<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>)
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span> <span class="z-keyword z-control z-groovy">else</span> <span class="z-keyword z-control z-groovy">if</span> (x <span class="z-keyword z-operator z-comparison z-groovy">==</span> <span class="z-constant z-numeric z-groovy">10</span>) <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-support z-function z-print z-groovy">println</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span><span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>x<span class="z-punctuation z-section z-embedded z-groovy">}</span></span> = 10<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>)
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span> <span class="z-keyword z-control z-groovy">else</span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-support z-function z-print z-groovy">println</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span><span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>x<span class="z-punctuation z-section z-embedded z-groovy">}</span></span> > 10<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>)
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span><span class="z-source z-groovy">}
</span><span class="z-source z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">diff</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-constant z-numeric z-groovy">11</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> 11 > 10
</span></span><span class="z-source z-groovy">
</span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Циклы
</span></span><span class="z-source z-groovy">list<span class="z-punctuation z-accessor z-dot z-groovy">.</span>each <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span> l <span class="z-keyword z-operator z-arrow z-groovy">-></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-support z-function z-print z-groovy">print</span> l
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> 123
</span></span><span class="z-source z-groovy">
</span><span class="z-source z-groovy"><span class="z-keyword z-control z-groovy">for</span> (i in <span class="z-constant z-numeric z-groovy">0</span><span class="z-keyword z-operator z-range z-groovy">..</span><span class="z-constant z-numeric z-groovy">5</span>) <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span> 
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-support z-function z-print z-groovy">print</span> i
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> 012345
</span></span><span class="z-source z-groovy">
</span><span class="z-source z-groovy"><span class="z-keyword z-control z-groovy">for</span> (<span class="z-storage z-type z-primitive z-groovy">int</span> i <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-constant z-numeric z-groovy">0</span>; i <span class="z-keyword z-operator z-comparison z-groovy"><</span> <span class="z-constant z-numeric z-groovy">10</span>; i<span class="z-keyword z-operator z-increment-decrement z-groovy">++</span>) <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-support z-function z-print z-groovy">print</span> i
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> 0123456789
</span></span><span class="z-source z-groovy">
</span><span class="z-source z-groovy">i <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-constant z-numeric z-groovy">0</span>
</span><span class="z-source z-groovy"><span class="z-keyword z-control z-groovy">while</span> (i <span class="z-keyword z-operator z-comparison z-groovy"><</span> <span class="z-constant z-numeric z-groovy">3</span>) <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-support z-function z-print z-groovy">println</span>(i)
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    i<span class="z-keyword z-operator z-increment-decrement z-groovy">++</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> 0
</span></span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> 1
</span></span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> 2
</span></span><span class="z-source z-groovy">
</span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Классы
</span></span><span class="z-source z-groovy"><span class="z-storage z-type z-def z-groovy">def</span> str <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>start<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span><span class="z-source z-groovy"><span class="z-support z-function z-print z-groovy">println</span> str
</span><span class="z-source z-groovy"><span class="z-meta z-definition z-class z-groovy"><span class="z-storage z-type z-class z-groovy">class</span> <span class="z-entity z-name z-type z-class z-groovy">Main</span> {</span>
</span><span class="z-source z-groovy"><span class="z-meta z-definition z-method z-groovy">    <span class="z-storage z-type z-return-type z-def z-groovy">def</span> <span class="z-entity z-name z-function z-groovy">echo</span> <span class="z-punctuation z-definition z-parameters z-begin z-groovy">(</span><span class="z-meta z-definition z-method z-parameters z-groovy"><span class="z-meta z-definition z-method z-parameter z-groovy"><span class="z-variable z-parameter z-groovy">param</span></span></span><span class="z-punctuation z-definition z-parameters z-end z-groovy">)</span> {</span>
</span><span class="z-source z-groovy">        <span class="z-support z-function z-print z-groovy">println</span> param
</span><span class="z-source z-groovy">    }
</span><span class="z-source z-groovy">}
</span><span class="z-source z-groovy"><span class="z-storage z-type z-def z-groovy">def</span> main <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">Main</span>()
</span><span class="z-source z-groovy"><span class="z-storage z-type z-def z-groovy">def</span> array <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-constant z-numeric z-groovy">1</span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-constant z-numeric z-groovy">2</span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-constant z-numeric z-groovy">3</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span>
</span><span class="z-source z-groovy"><span class="z-keyword z-control z-groovy">for</span> (element in array) <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    main<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">echo</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span>element<span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> 1
</span></span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> 2
</span></span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> 3
</span></span><span class="z-source z-groovy">
</span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Обработка ошибок
</span></span><span class="z-source z-groovy"><span class="z-storage z-type z-def z-groovy">def</span> newList <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span>:<span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span>
</span><span class="z-source z-groovy">newList<span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-constant z-numeric z-groovy">0</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span> <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-constant z-numeric z-groovy">1</span>
</span><span class="z-source z-groovy">newList<span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-constant z-numeric z-groovy">1</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span> <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-constant z-numeric z-groovy">2</span>
</span><span class="z-source z-groovy"><span class="z-keyword z-control z-groovy">for</span> (index in <span class="z-constant z-numeric z-groovy">0</span><span class="z-keyword z-operator z-range z-groovy">..</span><span class="z-constant z-numeric z-groovy">1</span>) <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-keyword z-control z-exception z-groovy">try</span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        newList<span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span>index<span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span> <span class="z-keyword z-operator z-arithmetic z-groovy">+</span><span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-constant z-numeric z-groovy">3</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        main<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">echo</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span>newList<span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span>index<span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span> <span class="z-keyword z-control z-exception z-groovy">catch</span> (<span class="z-storage z-type z-class z-groovy">Exception</span> e) <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        main<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">echo</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Ошибка: <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>e<span class="z-punctuation z-accessor z-dot z-groovy">.</span>message<span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span> <span class="z-keyword z-control z-exception z-groovy">finally</span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-keyword z-control z-groovy">if</span> (newList<span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span>index<span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span> <span class="z-keyword z-operator z-comparison z-groovy">>=</span> <span class="z-constant z-numeric z-groovy">5</span>) <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            main<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">echo</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span>newList<span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span>index<span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-constant z-numeric z-groovy">+1</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> 4
</span></span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> 5
</span></span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> 6
</span></span><span class="z-source z-groovy">
</span><span class="z-source z-groovy"><span class="z-support z-function z-print z-groovy">println</span> str<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">replace</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>start<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>final<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span><span class="z-source z-groovy">
</span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Коллекция для синхронизации сохранения данных в потоках
</span></span><span class="z-source z-groovy"><span class="z-storage z-type z-def z-groovy">def</span> sharedList <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-storage z-type z-class z-groovy">Collections</span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">synchronizedList</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Анонимная функция для обработки данных в потоке
</span></span><span class="z-source z-groovy"><span class="z-storage z-type z-def z-groovy">def</span> runTask <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span> name, delay <span class="z-keyword z-operator z-arrow z-groovy">-></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-storage z-type z-class z-groovy">Thread</span><span class="z-punctuation z-accessor z-dot z-groovy">.</span>start <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-support z-function z-print z-groovy">println</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span><span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>name<span class="z-punctuation z-section z-embedded z-groovy">}</span></span> запущена в потоке <span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span><span class="z-storage z-type z-class z-groovy">Thread</span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">currentThread</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span>name<span class="z-punctuation z-section z-embedded z-groovy">}</span></span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-support z-function z-other z-groovy">sleep</span>(delay)
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-support z-function z-print z-groovy">println</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span><span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>name<span class="z-punctuation z-section z-embedded z-groovy">}</span></span> завершена<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">synchronized</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span>sharedList<span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span> <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">            sharedList <span class="z-keyword z-operator z-leftshift z-groovy"><<</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span><span class="z-source z-groovy z-embedded z-source"><span class="z-punctuation z-section z-embedded z-groovy">${</span>name<span class="z-punctuation z-section z-embedded z-groovy">}</span></span> завершена<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span></span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">        <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-meta z-block z-groovy">    <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span><span class="z-source z-groovy">
</span><span class="z-source z-groovy"><span class="z-storage z-type z-def z-groovy">def</span> threads <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span>
</span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Ждём завершения всех потоков
</span></span><span class="z-source z-groovy">threads <span class="z-keyword z-operator z-leftshift z-groovy"><<</span> <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">runTask</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Задача 1<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-numeric z-groovy">3000</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span><span class="z-source z-groovy">threads <span class="z-keyword z-operator z-leftshift z-groovy"><<</span> <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">runTask</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Задача 2<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-numeric z-groovy">2000</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span><span class="z-source z-groovy">threads <span class="z-keyword z-operator z-leftshift z-groovy"><<</span> <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">runTask</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Задача 3<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-numeric z-groovy">1000</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span><span class="z-source z-groovy">
</span><span class="z-source z-groovy">threads<span class="z-keyword z-operator z-arithmetic z-groovy">*</span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">join</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span><span class="z-source z-groovy"><span class="z-support z-function z-print z-groovy">println</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Результат: <span class="z-variable z-other z-interpolated z-groovy">$sharedList</span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>
</span><span class="z-source z-groovy">
</span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Функции строк
</span></span><span class="z-source z-groovy"><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span> text <span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">trim</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>                     <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> удаляет пробелы в начале и конце => "text"
</span></span><span class="z-source z-groovy"><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>ping<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">replace</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>i<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>o<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>            <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> заменяет буквы в строке => pong
</span></span><span class="z-source z-groovy"><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>a,b,c<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">split</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>,<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>                  <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> разбивает строку по разделителю => ["a", "b", "c"]
</span></span><span class="z-source z-groovy"><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>abc<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">size</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>                        <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> возвращает длину строки или размер списка (кол-во элементов) => 3
</span></span><span class="z-source z-groovy"><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>abc<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">reverse</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>                     <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> переворачивает строку => "cba"
</span></span><span class="z-source z-groovy"><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>abc<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">contains</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>b<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>                 <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> проверяет наличие подстроки => true
</span></span><span class="z-source z-groovy"><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>abc<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">startsWith</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>a<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>               <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> проверяет начало строки => true
</span></span><span class="z-source z-groovy"><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>abc<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">endsWith</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>c<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>                 <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> проверяет конец строки => true
</span></span><span class="z-source z-groovy"><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>123<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">isNumber</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>                    <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> проверяет, является ли строка числом => true
</span></span><span class="z-source z-groovy"><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>abc<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">matches</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>a.*<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>                <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> проверяет соответствие регулярному выражения => true
</span></span><span class="z-source z-groovy"><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>hello<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">toUpperCase</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>               <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> преобразует строку в верхний регистр => "HELLO"
</span></span><span class="z-source z-groovy"><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>HELLO<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">toLowerCase</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>               <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> преобразует строку в нижний регистр => "hello"
</span></span><span class="z-source z-groovy">
</span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Функции массивов
</span></span><span class="z-source z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>a<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-separator z-groovy">,</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>b<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-separator z-groovy">,</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>c<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">join</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>,<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>             <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> объединяет элементы в строку => "a,b,c"
</span></span><span class="z-source z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>a<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-separator z-groovy">,</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>b<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-separator z-groovy">,</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>c<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">contains</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>b<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>         <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> проверяет наличие элемента => true
</span></span><span class="z-source z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-constant z-numeric z-groovy">1</span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-constant z-numeric z-groovy">2</span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-constant z-numeric z-groovy">3</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">sum</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>                     <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> суммирует элементы => 6
</span></span><span class="z-source z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-constant z-numeric z-groovy">1</span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-constant z-numeric z-groovy">2</span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-constant z-numeric z-groovy">3</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">max</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>                     <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> находит максимум => 3
</span></span><span class="z-source z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-constant z-numeric z-groovy">1</span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-constant z-numeric z-groovy">2</span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-constant z-numeric z-groovy">3</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">min</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>                     <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> находит минимум => 1
</span></span><span class="z-source z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-constant z-numeric z-groovy">1</span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-constant z-numeric z-groovy">2</span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-constant z-numeric z-groovy">3</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">average</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>                 <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> вычисляет среднее => 2
</span></span><span class="z-source z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-constant z-numeric z-groovy">1</span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-constant z-numeric z-groovy">2</span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-constant z-numeric z-groovy">3</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">reverse</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>                 <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> переворачивает список => [3, 2, 1]
</span></span><span class="z-source z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-constant z-numeric z-groovy">3</span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-constant z-numeric z-groovy">2</span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-constant z-numeric z-groovy">1</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">sort</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>                    <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> сортирует список => [1, 2, 3]
</span></span><span class="z-source z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-constant z-numeric z-groovy">1</span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-constant z-numeric z-groovy">2</span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-constant z-numeric z-groovy">2</span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-constant z-numeric z-groovy">3</span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-constant z-numeric z-groovy">3</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">unique</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>            <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> удаляет дубли => [1, 2, 3]
</span></span><span class="z-source z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-constant z-numeric z-groovy">1</span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-constant z-numeric z-groovy">2</span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-constant z-numeric z-groovy">3</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span>findAll <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span> it <span class="z-keyword z-operator z-comparison z-groovy">></span> <span class="z-constant z-numeric z-groovy">1</span> <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>        <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> фильтрует элементы => [2, 3]
</span></span><span class="z-source z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-constant z-numeric z-groovy">1</span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-constant z-numeric z-groovy">2</span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-constant z-numeric z-groovy">3</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span>collect <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span> it <span class="z-keyword z-operator z-arithmetic z-groovy">*</span> <span class="z-constant z-numeric z-groovy">2</span> <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>        <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> преобразует элементы => [2, 4, 6]
</span></span><span class="z-source z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>1<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-separator z-groovy">,</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>2<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span>collect <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span>it<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">toInteger</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span><span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>  <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> строки => числа => [1, 2]
</span></span><span class="z-source z-groovy">
</span><span class="z-source z-groovy"><span class="z-storage z-type z-def z-groovy">def</span> users <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-structure z-groovy">    <span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Alex<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">age</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-constant z-numeric z-groovy">30</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-punctuation z-definition z-separator z-groovy">,</span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-structure z-groovy">    <span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-constant z-other z-key z-groovy">name</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>Jack<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-constant z-other z-key z-groovy">age</span><span class="z-punctuation z-definition z-separator z-key-value z-groovy">:</span> <span class="z-constant z-numeric z-groovy">35</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span>
</span></span><span class="z-source z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span>  
</span><span class="z-source z-groovy">users<span class="z-punctuation z-accessor z-dot z-groovy">.</span>collect <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span> it<span class="z-punctuation z-accessor z-dot z-groovy">.</span>name <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>
</span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> ["Alex", "Jack"]
</span></span><span class="z-source z-groovy">
</span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Функции карт (map)
</span></span><span class="z-source z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>a<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>: <span class="z-constant z-numeric z-groovy">1</span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>b<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>: <span class="z-constant z-numeric z-groovy">2</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">get</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>a<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>                       <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> получает значение по ключу => 1
</span></span><span class="z-source z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>a<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>: <span class="z-constant z-numeric z-groovy">1</span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>b<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>: <span class="z-constant z-numeric z-groovy">2</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">keySet</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>                       <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> возвращает все ключи => ["a", "b"]
</span></span><span class="z-source z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>a<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>: <span class="z-constant z-numeric z-groovy">1</span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>b<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>: <span class="z-constant z-numeric z-groovy">2</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">values</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>                       <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> возвращает все значения => [1, 2]
</span></span><span class="z-source z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>a<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>: <span class="z-constant z-numeric z-groovy">1</span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>b<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>: <span class="z-constant z-numeric z-groovy">2</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">containsKey</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>a<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>               <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> проверяет наличие ключа => true
</span></span><span class="z-source z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>a<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>: <span class="z-constant z-numeric z-groovy">1</span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>b<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>: <span class="z-constant z-numeric z-groovy">2</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span>findAll <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span> k, v <span class="z-keyword z-operator z-arrow z-groovy">-></span> v <span class="z-keyword z-operator z-comparison z-groovy">></span> <span class="z-constant z-numeric z-groovy">1</span> <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>      <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> фильтрует записи => ["b": 2]
</span></span><span class="z-source z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>a<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>: <span class="z-constant z-numeric z-groovy">1</span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>b<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>: <span class="z-constant z-numeric z-groovy">2</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span>collect <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span> k, v <span class="z-keyword z-operator z-arrow z-groovy">-></span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span><span class="z-variable z-other z-interpolated z-groovy">$k</span>-<span class="z-variable z-other z-interpolated z-groovy">$v</span><span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span> <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>    <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> преобразует => ["a-1", "b-2"]
</span></span><span class="z-source z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>a<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>: <span class="z-constant z-numeric z-groovy">1</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">put</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>b<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-separator z-parameter z-groovy">,</span> <span class="z-constant z-numeric z-groovy">2</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>                            <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> добавляет новую пару ключ-значение => ["a": 1, "b": 2]
</span></span><span class="z-source z-groovy"><span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>a<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>: <span class="z-constant z-numeric z-groovy">1</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">plus</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>b<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>: <span class="z-constant z-numeric z-groovy">2</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>                         <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> объединяет мапы => ["a": 1, "b": 2]
</span></span><span class="z-source z-groovy">
</span><span class="z-source z-groovy"><span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> Директории и файлы
</span></span><span class="z-source z-groovy"><span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">File</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>dir<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>)<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">mkdir</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>                         <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> создает директорию => boolean
</span></span><span class="z-source z-groovy"><span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">File</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>dir/subdir<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>)<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">mkdirs</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>                 <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> создает все недостающие директории d genb => boolean
</span></span><span class="z-source z-groovy"><span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">File</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>dir<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>)<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">list</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>                          <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> список имен файлов => String[]
</span></span><span class="z-source z-groovy"><span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">File</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>dir<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>)<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">listFiles</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>                     <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> возвращает список файлов в директории => File[]
</span></span><span class="z-source z-groovy"><span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">File</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>dir<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>)<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">deleteDir</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>                     <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> удаляет директорию (рекурсивно) => boolean
</span></span><span class="z-source z-groovy"><span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">File</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>dir<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>)<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">isDirectory</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>                   <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> проверяет, что это директория => boolean
</span></span><span class="z-source z-groovy"><span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">File</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>file.txt<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>)<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">createNewFile</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>            <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> создает пустой файл => boolean
</span></span><span class="z-source z-groovy"><span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">File</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>file.txt<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>)<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">delete</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>                   <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> удаляет файл => boolean
</span></span><span class="z-source z-groovy"><span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">File</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>file.txt<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>)<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">exists</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>                   <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> проверяет существование файла => boolean
</span></span><span class="z-source z-groovy"><span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">File</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>file.txt<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>)<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">isFile</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>                   <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> проверяет, что это файл => boolean
</span></span><span class="z-source z-groovy"><span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">File</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>file.txt<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>)<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">length</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>                   <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> возвращает размер файла в байтах => long
</span></span><span class="z-source z-groovy"><span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">File</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>file.txt<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>)<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">lastModified</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>             <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> возвращает время последнего изменения => long (timestamp)
</span></span><span class="z-source z-groovy"><span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">File</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>file.txt<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>)<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">getName</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>                  <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> возвращает имя файла (без пути) => String
</span></span><span class="z-source z-groovy"><span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">File</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>file.txt<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>)<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">getPath</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>                  <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> возвращает относительный путь => String
</span></span><span class="z-source z-groovy"><span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">File</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>file.txt<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>)<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">getAbsolutePath</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>          <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> возвращает абсолютный путь => String
</span></span><span class="z-source z-groovy"><span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">File</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>file.txt<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>)<span class="z-punctuation z-accessor z-dot z-groovy">.</span>text                       <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> читает содержимое файла в строку
</span></span><span class="z-source z-groovy"><span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">File</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>file.txt<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>)<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">getText</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>UTF-8<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>           <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> указать кодировку при чтение
</span></span><span class="z-source z-groovy"><span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">File</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>file.txt<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>)<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">readBytes</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>                <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> читает файл как массив байтов => byte[]
</span></span><span class="z-source z-groovy"><span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">File</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>file.txt<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>)<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">readLines</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>                <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> читает файл построчно (получаем массив из строк) => List&LTString>
</span></span><span class="z-source z-groovy"><span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">File</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>file.txt<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>)<span class="z-punctuation z-accessor z-dot z-groovy">.</span>eachLine <span class="z-meta z-block z-groovy"><span class="z-punctuation z-section z-block z-begin z-groovy">{</span> it <span class="z-punctuation z-section z-block z-end z-groovy">}</span></span>            <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> обработать каждую строку
</span></span><span class="z-source z-groovy"><span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">File</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>file.txt<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>)<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">write</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>text<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>              <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> перезаписывает файл (если существует) => void
</span></span><span class="z-source z-groovy"><span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">File</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>file.txt<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>)<span class="z-punctuation z-accessor z-dot z-groovy">.</span><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">setText</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>text<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>            <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> аналог write() => void
</span></span><span class="z-source z-groovy"><span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">File</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>file.txt<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>)<span class="z-punctuation z-accessor z-dot z-groovy">.</span>bytes <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-meta z-structure z-groovy"><span class="z-punctuation z-definition z-structure z-begin z-groovy">[</span><span class="z-constant z-numeric z-groovy">1</span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-constant z-numeric z-groovy">2</span><span class="z-punctuation z-definition z-separator z-groovy">,</span> <span class="z-constant z-numeric z-groovy">3</span><span class="z-punctuation z-definition z-structure z-end z-groovy">]</span></span>          <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> записывает массив байтов => void
</span></span><span class="z-source z-groovy"><span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">File</span>(<span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>file.txt<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>) <span class="z-keyword z-operator z-leftshift z-groovy"><<</span> <span class="z-string z-quoted z-double z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">"</span>text<span class="z-punctuation z-definition z-string z-end z-groovy">"</span></span>                  <span class="z-comment z-line z-double-slash z-groovy"><span class="z-punctuation z-definition z-comment z-groovy">//</span> добавляет текст в конец файла => void
</span></span></code></pre><h2 id=ansible><a aria-label="Anchor link for: ansible" class=zola-anchor href=#ansible><i class=icon></i></a> Ansible</h2><p><code>apt -y update && apt -y upgrade</code> <br> <code>apt -y install ansible</code> v2.10.8 <br> <code>apt -y install ansible-core</code> v2.12.0 <br> <code>apt -y install sshpass</code><p><code>ansible-galaxy collection install ansible.windows</code> установить коллекцию модулей <br> <code>ansible-galaxy collection install community.windows</code> <br> <code>ansible-galaxy collection list | grep windows</code> <br> <code>ansible-config dump | grep DEFAULT_MODULE_PATH</code> путь хранения модулей<p><code>apt-get -y install python-dev libkrb5-dev krb5-user</code> пакеты для Kerberos аутентификации <br> <code>apt install python3-pip</code> <br> <code>pip3 install requests-kerberos</code> <br> <code>nano /etc/krb5.conf</code> настроить [realms] и [domain_realm] <br> <code>kinit -C support4@domail.local</code> <br> <code>klist</code><p><code>ansible --version</code> <br> <code>config file = None</code> <br> <code>nano /etc/ansible/ansible.cfg</code> файл конфигурации<pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-meta z-flow-sequence z-yaml"><span class="z-punctuation z-definition z-sequence z-begin z-yaml">[</span><span class="z-string z-unquoted z-plain z-in z-yaml">defaults</span><span class="z-punctuation z-definition z-sequence z-end z-yaml">]</span></span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">inventory = /etc/ansible/hosts</span>
</span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> uncomment this to disable SSH key host checking
</span></span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> Отключить проверку ключа ssh (для подключения используя пароль)
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">host_key_checking = False</span>
</span></code></pre><h3 id=hosts><a aria-label="Anchor link for: hosts" class=zola-anchor href=#hosts><i class=icon></i></a> Hosts</h3><p><code>nano /etc/ansible/hosts</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-meta z-flow-sequence z-yaml"><span class="z-punctuation z-definition z-sequence z-begin z-yaml">[</span><span class="z-string z-unquoted z-plain z-in z-yaml">us</span><span class="z-punctuation z-definition z-sequence z-end z-yaml">]</span></span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">pi-hole-01 ansible_host=192.168.3.101</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">zabbix-01 ansible_host=192.168.3.102</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">grafana-01 ansible_host=192.168.3.103</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">netbox-01 ansible_host=192.168.3.104</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-meta z-flow-sequence z-yaml"><span class="z-punctuation z-definition z-sequence z-begin z-yaml">[</span><span class="z-string z-unquoted z-plain z-in z-yaml">all:vars</span><span class="z-punctuation z-definition z-sequence z-end z-yaml">]</span></span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">ansible_ssh_port=2121</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">ansible_user=lifailon</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">ansible_password=123098</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">path_user=/home/lifailon</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">ansible_python_interpreter=/usr/bin/python3</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-meta z-flow-sequence z-yaml"><span class="z-punctuation z-definition z-sequence z-begin z-yaml">[</span><span class="z-string z-unquoted z-plain z-in z-yaml">ws</span><span class="z-punctuation z-definition z-sequence z-end z-yaml">]</span></span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">huawei-book-01 ansible_host=192.168.3.99</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">plex-01 ansible_host=192.168.3.100</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-meta z-flow-sequence z-yaml"><span class="z-punctuation z-definition z-sequence z-begin z-yaml">[</span><span class="z-string z-unquoted z-plain z-in z-yaml">ws:vars</span><span class="z-punctuation z-definition z-sequence z-end z-yaml">]</span></span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">ansible_port=5985</span>
</span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>ansible_port=5986
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">ansible_user=Lifailon</span>
</span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>ansible_user=support4@DOMAIN.LOCAL
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">ansible_password=123098</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">ansible_connection=winrm</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">ansible_winrm_scheme=http</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">ansible_winrm_transport=basic</span>
</span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>ansible_winrm_transport=kerberos
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">ansible_winrm_server_cert_validation=ignore</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">validate_certs=false</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-meta z-flow-sequence z-yaml"><span class="z-punctuation z-definition z-sequence z-begin z-yaml">[</span><span class="z-string z-unquoted z-plain z-in z-yaml">win_ssh</span><span class="z-punctuation z-definition z-sequence z-end z-yaml">]</span></span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">huawei-book-01 ansible_host=192.168.3.99</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">plex-01 ansible_host=192.168.3.100</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-meta z-flow-sequence z-yaml"><span class="z-punctuation z-definition z-sequence z-begin z-yaml">[</span><span class="z-string z-unquoted z-plain z-in z-yaml">win_ssh:vars</span><span class="z-punctuation z-definition z-sequence z-end z-yaml">]</span></span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">ansible_python_interpreter=C:\Users\Lifailon\AppData\Local\Programs\Python\Python311\` добавить переменную среды интерпритатора Python в Windows</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">ansible_connection=ssh</span>
</span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>ansible_shell_type=cmd
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">ansible_shell_type=powershell</span>
</span></code></pre><p><code>ansible-inventory --list</code> проверить конфигурацию (читает в формате JSON) или YAML (-y) с просмотром все применяемых переменных<h3 id=windows-modules><a aria-label="Anchor link for: windows-modules" class=zola-anchor href=#windows-modules><i class=icon></i></a> Windows Modules</h3><p><code>ansible us -m ping</code> <br> <code>ansible win_ssh -m ping</code> <br> <code>ansible us -m shell -a "uptime && df -h | grep lv"</code> <br> <code>ansible us -m setup | grep -iP "mem|proc"</code> информация о железе <br> <code>ansible us -m apt -a "name=mc" -b</code> повысить привилегии sudo (-b) <br> <code>ansible us -m service -a "name=ssh state=restarted enabled=yes" -b</code> перезапустить службу <br> <code>echo "echo test" > test.sh</code> <br> <code>ansible us -m copy -a "src=test.sh dest=/root mode=777" -b</code> <br> <code>ansible us -a "ls /root" -b</code> <br> <code>ansible us -a "cat /root/test.sh" -b</code><p><code>ansible-doc -l | grep win_</code> <a href=https://docs.ansible.com/ansible/latest/collections/ansible/windows/>список всех модулей Windows</a> <br> <code>ansible ws -m win_ping</code> windows модуль <br> <code>ansible ws -m win_ping -u WinRM-Writer</code> указать логин <br> <code>ansible ws -m setup</code> собрать подробную информацию о системе <br> <code>ansible ws -m win_whoami</code> информация о правах доступах, группах доступа <br> <code>ansible ws -m win_shell -a '$PSVersionTable'</code> <br> <code>ansible ws -m win_shell -a 'Get-Service | where name -match "ssh|winrm"'</code> <br> <code>ansible ws -m win_service -a "name=sshd state=stopped"</code> <br> <code>ansible ws -m win_service -a "name=sshd state=started"</code><ul><li>win_shell (vars/debug)</ul><p><code>nano /etc/ansible/PowerShell-Vars.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml"> ` <span class="z-string z-unquoted z-plain z-out z-yaml">Указать коллекцию модулей</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">collections</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ansible.windows</span>
</span><span class="z-source z-yaml"> ` <span class="z-string z-unquoted z-plain z-out z-yaml">Задать переменные</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">vars</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">SearchName</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">PermitRoot</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Get port ssh</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">win_shell</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-keyword z-control z-flow z-block-scalar z-literal z-yaml">|</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">      Get-Content "C:\Programdata\ssh\sshd_config" | Select-String "{{SearchName}}"
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml"></span>   ` <span class="z-string z-unquoted z-plain z-out z-yaml">Передать вывод в переменную</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">register</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">command_output</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Output port ssh</span>
</span><span class="z-source z-yaml">   ` <span class="z-string z-unquoted z-plain z-out z-yaml">Вывести переменную на экран</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">debug</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">var</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">command_output.stdout_lines</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/PowerShell-Vars.yml</code> <br> <code>ansible-playbook /etc/ansible/PowerShell-Vars.yml --extra-vars "SearchName='LogLevel|Syslog'"</code> передать переменную<ul><li>win_powershell</ul><p><code>nano /etc/ansible/powershell-param.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Run PowerShell script with parameters</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ansible.windows.win_powershell</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">parameters</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">Path</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">C:\Temp</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">Force</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-language z-boolean z-yaml">true</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">script</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-keyword z-control z-flow z-block-scalar z-literal z-yaml">|</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">        [CmdletBinding()]
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">        param (
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">          [String]$Path,
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">          [Switch]$Force
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">        )
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">        New-Item -Path $Path -ItemType Directory -Force:$Force
</span></span></code></pre><p><code>ansible-playbook /etc/ansible/powershell-param.yml</code><ul><li>win_chocolatey</ul><p><code>nano /etc/ansible/setup-adobe-acrobat.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Install Acrobat Reader</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">win_chocolatey</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">adobereader</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">state</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">present</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/setup-adobe-acrobat.yml</code><p><code>nano /etc/ansible/setup-openssh.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">install the Win32-OpenSSH service</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">win_chocolatey</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">openssh</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">package_params</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">/SSHServerFeature</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">state</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">present</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/setup-openssh.yml</code><ul><li>win_regedit</ul><p><code>nano /etc/ansible/win-set-shell-ssh-ps7.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Set the default shell to PowerShell 7 for Windows OpenSSH</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">win_regedit</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">path</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">HKLM:\SOFTWARE\OpenSSH</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">DefaultShell</span>
</span><span class="z-source z-yaml">     ` <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">data</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">data</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-single z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">'</span>C:\Program Files\PowerShell\7\pwsh.exe<span class="z-punctuation z-definition z-string z-end z-yaml">'</span></span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">type</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">string</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">state</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">present</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/win-set-shell-ssh-ps7.yml</code><ul><li>win_service</ul><p><code>nano /etc/ansible/win-service.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Start service</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">win_service</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">sshd</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">state</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">started</span>
</span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>     state: stopped
</span></span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>     state: restarted
</span></span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>     start_mode: auto
</span></span></code></pre><p><code>ansible-playbook /etc/ansible/win-service.yml</code><ul><li>win_service_info</ul><p><code>nano /etc/ansible/get-service.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Get info for a single service</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">win_service_info</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">sshd</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">register</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">service_info</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Print returned information</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ansible.builtin.debug</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">var</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">service_info.services</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/get-service.yml</code><ul><li>fetch/slurp</ul><p><code>nano /etc/ansible/copy-from-win-to-local.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Retrieve remote file on a Windows host</span>
</span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>   Скопировать файл из Windows-системы
</span></span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ansible.builtin.fetch</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>   Прочитать файл (передать в память в формате Base64)
</span></span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>   ansible.builtin.slurp:
</span></span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">src</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">C:\Telegraf\telegraf.conf</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">dest</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">/root/telegraf.conf</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">flat</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-language z-boolean z-yaml">yes</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">register</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">telegraf_conf</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Print returned information</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ansible.builtin.debug</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">msg</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>{{ telegraf_conf['content'] | b64decode }}<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/copy-from-win-to-local.yml</code><ul><li>win_copy</ul><p><code>echo "Get-Service | where name -eq vss | Start-Service" > /home/lifailon/Start-Service-VSS.ps1</code> <br> <code>nano /etc/ansible/copy-file-to-win.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Copy file to win hosts</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">win_copy</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">src</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">/home/lifailon/Start-Service-VSS.ps1</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">dest</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">C:\Users\Lifailon\Desktop\Start-Service-VSS.ps1</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/copy-file-to-win.yml</code><p><code>curl -OL https://github.com/PowerShell/PowerShell/releases/download/v7.3.6/PowerShell-7.3.6-win-x64.msi</code> <br> <code>nano /etc/ansible/copy-file-to-win.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Copy file to win hosts</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">win_copy</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">src</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">/home/lifailon/PowerShell-7.3.6-win-x64.msi</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">dest</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">C:\Install\PowerShell-7.3.6.msi</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/copy-file-to-win.yml</code><ul><li>win_command</ul><p><code>nano /etc/ansible/run-script-ps1.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Run PowerShell Script</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">win_command</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">powershell -ExecutionPolicy ByPass -File C:\Users\Lifailon\Desktop\Start-Service-VSS.ps1</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/run-script-ps1.yml</code><ul><li>win_package</ul><p><code>nano /etc/ansible/setup-msi-package.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Install MSI Package</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">win_package</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml"><span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span>     path: C:\Install\7z-23.01.msi
</span></span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">path</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">C:\Install\PowerShell-7.3.6.msi</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">arguments</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">/quiet</span>
</span><span class="z-source z-yaml">        <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">/passive</span>
</span><span class="z-source z-yaml">        <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">/norestart</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/setup-msi-package.yml</code><ul><li>win_firewall_rule</ul><p><code>nano /etc/ansible/win-fw-open.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Open RDP port</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">win_firewall_rule</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Open RDP port</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">localport</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">3389</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">action</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">allow</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">direction</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">in</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">protocol</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">tcp</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">state</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">present</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">enabled</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-language z-boolean z-yaml">yes</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/win-fw-open.yml</code><ul><li>win_group</ul><p><code>nano /etc/ansible/win-creat-group.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Create a new group</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">win_group</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">deploy</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">description</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Deploy Group</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">state</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">present</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/win-creat-group.yml</code><ul><li>win_group_membership</ul><p><code>nano /etc/ansible/add-user-to-group.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Add a local and domain user to a local group</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">win_group_membership</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">deploy</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">members</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">WinRM-Writer</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">state</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">present</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/add-user-to-group.yml</code><ul><li>win_user</ul><p><code>nano /etc/ansible/creat-win-user.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Creat user</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">win_user</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">test</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">password</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">123098</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">state</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">present</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">groups</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">deploy</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/creat-win-user.yml</code><p><code>nano /etc/ansible/delete-win-user.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Delete user</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ansible.windows.win_user</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">test</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">state</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">absent</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/delete-win-user.yml</code><ul><li>win_feature</ul><p><code>nano /etc/ansible/install-feature.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Install Windows Feature</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">win_feature</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">SNMP-Service</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">state</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">present</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/install-feature.yml</code><ul><li>win_reboot</ul><p><code>nano /etc/ansible/win-reboot.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Reboot a slow machine that might have lots of updates to apply</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">win_reboot</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">reboot_timeout</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">3600</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/win-reboot.yml</code><ul><li>win_find</ul><p><code>nano /etc/ansible/win-ls.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Find files in multiple paths</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ansible.windows.win_find</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">paths</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">D:\Install\OpenSource</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">patterns</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-meta z-flow-sequence z-yaml"><span class="z-punctuation z-definition z-sequence z-begin z-yaml">[</span><span class="z-string z-quoted z-single z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">'</span>*.rar<span class="z-punctuation z-definition z-string z-end z-yaml">'</span></span><span class="z-punctuation z-separator z-sequence z-yaml">,</span><span class="z-string z-quoted z-single z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">'</span>*.zip<span class="z-punctuation z-definition z-string z-end z-yaml">'</span></span><span class="z-punctuation z-separator z-sequence z-yaml">,</span><span class="z-string z-quoted z-single z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">'</span>*.msi<span class="z-punctuation z-definition z-string z-end z-yaml">'</span></span><span class="z-punctuation z-definition z-sequence z-end z-yaml">]</span></span>
</span><span class="z-source z-yaml">     ` <span class="z-string z-unquoted z-plain z-out z-yaml">Файл созданный менее 7 дней назад</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">age</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">-7d</span>
</span><span class="z-source z-yaml">     ` <span class="z-string z-unquoted z-plain z-out z-yaml">Размер файла больше 10MB</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">size</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">10485760</span>
</span><span class="z-source z-yaml">     ` <span class="z-string z-unquoted z-plain z-out z-yaml">Рекурсивный поиск (в дочерних директориях)</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">recurse</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-language z-boolean z-yaml">true</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">register</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">command_output</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Output</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">debug</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">var</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">command_output</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/win-ls.yml</code><ul><li>win_uri</ul><p><code>nano /etc/ansible/rest-get.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">REST GET request to endpoint github</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ansible.windows.win_uri</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">url</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">https://api.github.com/repos/Lifailon/pSyslog/releases/latest</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">register</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">http_output</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Output</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">debug</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">var</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">http_output</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/rest-get.yml</code><ul><li>win_updates</ul><p><code>nano /etc/ansible/win-update.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ws</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Install only particular updates based on the KB numbers</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ansible.windows.win_updates</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">category_names</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">SecurityUpdates</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">CriticalUpdates</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">UpdateRollups</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Drivers</span>
</span><span class="z-source z-yaml">     ` <span class="z-string z-unquoted z-plain z-out z-yaml">Фильтрация</span>
</span><span class="z-source z-yaml">     ` <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">accept_list</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">     ` <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">KB2267602</span>
</span><span class="z-source z-yaml">     ` <span class="z-string z-unquoted z-plain z-out z-yaml">Поиск обновлений</span>
</span><span class="z-source z-yaml">     ` <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">state</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">searched</span>
</span><span class="z-source z-yaml">     ` <span class="z-string z-unquoted z-plain z-out z-yaml">Загрузить обновления</span>
</span><span class="z-source z-yaml">     ` <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">state</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">downloaded</span>
</span><span class="z-source z-yaml">     ` <span class="z-string z-unquoted z-plain z-out z-yaml">Установить обновления</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">state</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">installed</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">log_path</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">C:\Ansible-Windows-Upadte-Log.txt</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">reboot</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-language z-boolean z-yaml">false</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">register</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">wu_output</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Output</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">debug</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">var</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">wu_output</span>
</span></code></pre><p><code>ansible-playbook /etc/ansible/win-update.yml</code><ul><li>win_chocolatey</ul><p><a href=https://chocolatey.org/install>Install</a> <br> <a href=https://community.chocolatey.org/api/v2/package/chocolatey>API</a> <br> <a href=https://docs.chocolatey.org/en-us/guides/organizations/organizational-deployment-guide>Deployment</a><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Ensure Chocolatey installed from internal repo</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">win_chocolatey</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">chocolatey</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">state</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">present</span>
</span><span class="z-source z-yaml">	<span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> source: URL-адрес внутреннего репозитория
</span></span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">source</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">https://community.chocolatey.org/api/v2/ChocolateyInstall.ps1</span>
</span></code></pre><h3 id=jinja><a aria-label="Anchor link for: jinja" class=zola-anchor href=#jinja><i class=icon></i></a> Jinja</h3><p>Локальное использование:<p><code>pip install jinja2 --break-system-packages</code><p><code>inventory.j2</code> шаблон для генерации<pre class=z-code><code><span class="z-text z-plain">[dev]
</span><span class="z-text z-plain">{% for host in hosts -%}
</span><span class="z-text z-plain">{{ host }} ansible_host={{ host }}
</span><span class="z-text z-plain">{% endfor %}
</span></code></pre><p><code>env.json</code> файл с переменными<pre class="language-json z-code" data-lang=json><code class=language-json data-lang=json><span class="z-source z-json"><span class="z-meta z-mapping z-json"><span class="z-punctuation z-section z-mapping z-begin z-json">{</span>
</span></span><span class="z-source z-json"><span class="z-meta z-mapping z-json">  </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>hosts<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-sequence z-json"><span class="z-punctuation z-section z-sequence z-begin z-json">[</span><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>192.168.3.101<span class="z-punctuation z-definition z-string z-end z-json">"</span></span><span class="z-punctuation z-separator z-sequence z-json">,</span> <span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>192.168.3.102<span class="z-punctuation z-definition z-string z-end z-json">"</span></span><span class="z-punctuation z-separator z-sequence z-json">,</span> <span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>192.168.3.103<span class="z-punctuation z-definition z-string z-end z-json">"</span></span><span class="z-punctuation z-section z-sequence z-end z-json">]</span></span>
</span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-section z-mapping z-end z-json">}</span></span>
</span></code></pre><p><code>render.py</code> скрипт для генерации файла inventory<pre class="language-Python z-code" data-lang=Python><code class=language-Python data-lang=Python><span class="z-source z-python"><span class="z-meta z-statement z-import z-python"><span class="z-keyword z-control z-import z-from z-python">from</span></span><span class="z-meta z-statement z-import z-python"><span class="z-meta z-import-source z-python"> <span class="z-meta z-import-path z-python"><span class="z-meta z-import-name z-python">jinja2</span></span> <span class="z-meta z-statement z-import z-python"><span class="z-keyword z-control z-import z-python">import</span></span></span></span><span class="z-meta z-statement z-import z-python"></span><span class="z-meta z-statement z-import z-python"> <span class="z-meta z-generic-name z-python">Environment</span><span class="z-punctuation z-separator z-import-list z-python">,</span> <span class="z-meta z-generic-name z-python">FileSystemLoader</span></span>
</span><span class="z-source z-python"><span class="z-meta z-statement z-import z-python"><span class="z-keyword z-control z-import z-python">import</span> <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">json</span></span></span>
</span><span class="z-source z-python"><span class="z-comment z-line z-number-sign z-python"><span class="z-punctuation z-definition z-comment z-python">#</span> Загружаем переменные из JSON
</span></span><span class="z-source z-python"><span class="z-meta z-statement z-with z-python"><span class="z-keyword z-control z-flow z-with z-python">with</span> <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-support z-function z-builtin z-python">open</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-single z-python"><span class="z-punctuation z-definition z-string z-begin z-python">'</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-single z-python">env.json<span class="z-punctuation z-definition z-string z-end z-python">'</span></span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span> <span class="z-meta z-statement z-with z-python"><span class="z-keyword z-control z-flow z-with z-as z-python">as</span></span></span><span class="z-meta z-statement z-with z-python"> <span class="z-meta z-generic-name z-python">f</span><span class="z-punctuation z-section z-block z-with z-python">:</span></span>
</span><span class="z-source z-python">    <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">data</span></span> <span class="z-keyword z-operator z-assignment z-python">=</span> <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">json</span></span><span class="z-meta z-qualified-name z-python"><span class="z-punctuation z-accessor z-dot z-python">.</span></span><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-meta z-generic-name z-python">load</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">f</span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span><span class="z-source z-python"><span class="z-comment z-line z-number-sign z-python"><span class="z-punctuation z-definition z-comment z-python">#</span> Настройка шаблонизатора
</span></span><span class="z-source z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">env</span></span> <span class="z-keyword z-operator z-assignment z-python">=</span> <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-meta z-generic-name z-python">Environment</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-variable z-parameter z-python">loader</span><span class="z-keyword z-operator z-assignment z-python">=</span><span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-meta z-generic-name z-python">FileSystemLoader</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-single z-python"><span class="z-punctuation z-definition z-string z-begin z-python">'</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-single z-python">.<span class="z-punctuation z-definition z-string z-end z-python">'</span></span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span><span class="z-source z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">template</span></span> <span class="z-keyword z-operator z-assignment z-python">=</span> <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">env</span></span><span class="z-meta z-qualified-name z-python"><span class="z-punctuation z-accessor z-dot z-python">.</span></span><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-meta z-generic-name z-python">get_template</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-single z-python"><span class="z-punctuation z-definition z-string z-begin z-python">'</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-single z-python">inventory.j2<span class="z-punctuation z-definition z-string z-end z-python">'</span></span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span><span class="z-source z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">output</span></span> <span class="z-keyword z-operator z-assignment z-python">=</span> <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">template</span></span><span class="z-meta z-qualified-name z-python"><span class="z-punctuation z-accessor z-dot z-python">.</span></span><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-meta z-generic-name z-python">render</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">data</span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span><span class="z-source z-python"><span class="z-comment z-line z-number-sign z-python"><span class="z-punctuation z-definition z-comment z-python">#</span> Сохраняем результат в файл
</span></span><span class="z-source z-python"><span class="z-meta z-statement z-with z-python"><span class="z-keyword z-control z-flow z-with z-python">with</span> <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-support z-function z-builtin z-python">open</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-single z-python"><span class="z-punctuation z-definition z-string z-begin z-python">'</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-single z-python">inventory.generated<span class="z-punctuation z-definition z-string z-end z-python">'</span></span></span><span class="z-punctuation z-separator z-arguments z-python">,</span> <span class="z-meta z-string z-python"><span class="z-string z-quoted z-single z-python"><span class="z-punctuation z-definition z-string z-begin z-python">'</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-single z-python">w<span class="z-punctuation z-definition z-string z-end z-python">'</span></span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span> <span class="z-meta z-statement z-with z-python"><span class="z-keyword z-control z-flow z-with z-as z-python">as</span></span></span><span class="z-meta z-statement z-with z-python"> <span class="z-meta z-generic-name z-python">f</span><span class="z-punctuation z-section z-block z-with z-python">:</span></span>
</span><span class="z-source z-python">    <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">f</span></span><span class="z-meta z-qualified-name z-python"><span class="z-punctuation z-accessor z-dot z-python">.</span></span><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-meta z-generic-name z-python">write</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">output</span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span></code></pre><p><code>python render.py</code><p>Использование в Ansible для обновления файла <code>hosts</code>:<p><code>inventory.ini</code><pre class=z-code><code><span class="z-text z-plain">[dev]
</span><span class="z-text z-plain">dev1 ansible_host=192.168.3.101
</span><span class="z-text z-plain">dev2 ansible_host=192.168.3.102
</span><span class="z-text z-plain">dev3 ansible_host=192.168.3.103
</span></code></pre><p><code>templates/hosts.j2</code><pre class=z-code><code><span class="z-text z-plain">127.0.0.1 localhost
</span><span class="z-text z-plain">{% for host in groups['all'] -%}
</span><span class="z-text z-plain">{{ hostvars[host]['ansible_host'] }} {{ host }}
</span><span class="z-text z-plain">{% endfor %}
</span></code></pre><p><code>playbook.yml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Update hosts file</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">hosts</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">all</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">become</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-language z-boolean z-yaml">true</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Generate hosts file</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">template</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">src</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">hosts.j2</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">dest</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">/etc/hosts</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">owner</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">root</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">group</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">root</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">mode</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-single z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">'</span>0644<span class="z-punctuation z-definition z-string z-end z-yaml">'</span></span>
</span></code></pre><p><code>ansible-playbook -i inventory.ini playbook.yml --check --diff</code> отобразит изменения без их реального применения <br> <code>ansible-playbook -i inventory.ini playbook.yml -K</code> позволяет передать пароль для root<h2 id=puppet><a aria-label="Anchor link for: puppet" class=zola-anchor href=#puppet><i class=icon></i></a> Puppet</h2><h3 id=bolt><a aria-label="Anchor link for: bolt" class=zola-anchor href=#bolt><i class=icon></i></a> Bolt</h3><p><a href=https://github.com/puppetlabs/bolt>Bolt</a> - это инструмент оркестровки, который выполняет заданную команду или группу команд на локальной рабочей станции, а также напрямую подключается к удаленным целям с помощью SSH или WinRM, что не требует установки агентов.<p>Docs: https://www.puppet.com/docs/bolt/latest/getting_started_with_bolt.html<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">wget</span></span><span class="z-meta z-function-call z-arguments z-shell"> https://apt.puppet.com/puppet-tools-release-bullseye.deb</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> dpkg<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>i</span> puppet-tools-release-bullseye.deb</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> apt-get update</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> apt-get install puppet-bolt</span>
</span></code></pre><p><code>nano inventory.yaml</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">groups</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml"><span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">bsd</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">targets</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">uri</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">192.168.3.102:22</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">openbsd</span>
</span><span class="z-source z-yaml">    <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">uri</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">192.168.3.103:22</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">freebsd</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">config</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">transport</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ssh</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ssh</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">user</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">root</span>
</span><span class="z-source z-yaml">      <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> password: root
</span></span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">host-key-check</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-language z-boolean z-yaml">false</span>
</span></code></pre><p><code>bolt command run uptime --inventory inventory.yaml --targets bsd</code> выполнить команду uptime на группе хостов bsd, заданной в файле inventory<p><code>echo name: lazyjournal > bolt-project.yaml</code> создать файл проекта<p><code>mkdir plans && nano test.yaml</code> создать директорию и файл с планом работ<pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">parameters</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">targets</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">type</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">TargetSpec</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">steps</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">clone</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">command</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">rm -rf lazyjournal && git clone https://github.com/Lifailon/lazyjournal</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">targets</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">$targets</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">test</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">command</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">cd lazyjournal && go test -v -cover --run TestMainInterface</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">targets</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">$targets</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">remove</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">command</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">rm -rf lazyjournal</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">targets</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">$targets</span>
</span></code></pre><p><code>bolt plan show</code> вывести список всех планов<p><code>bolt plan run lazyjournal::test --inventory inventory.yaml --targets bsd -v</code> запустить план<h2 id=sake><a aria-label="Anchor link for: sake" class=zola-anchor href=#sake><i class=icon></i></a> Sake</h2><p><a href=https://github.com/alajmo/sake>Sake</a> - это командный раннер для локальных и удаленных хостов. Вы определяете серверы и задачи в файле <code>sake.yaml</code>, а затем запускаете задачи на серверах.<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">curl</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>sfL</span> https://raw.githubusercontent.com/alajmo/sake/main/install.sh</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sh</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sake</span></span><span class="z-meta z-function-call z-arguments z-shell"> init <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> инициализировать sake.yml файл</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sake</span></span><span class="z-meta z-function-call z-arguments z-shell"> list servers <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> вывести список машин</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sake</span></span><span class="z-meta z-function-call z-arguments z-shell"> list tags  <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> список тегов (группы серверов)</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sake</span></span><span class="z-meta z-function-call z-arguments z-shell"> list tasks <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> список задач</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sake</span></span><span class="z-meta z-function-call z-arguments z-shell"> run ping<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>all <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> запустить задачу на все хосты</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sake</span></span><span class="z-meta z-function-call z-arguments z-shell"> exec<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>all</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>uname -a && uptime<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> запустить команду на всех хостах</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span></code></pre><p>Пример конфигурации:<pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">servers</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">localhost</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">host</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-float z-decimal z-yaml">0<span class="z-punctuation z-separator z-decimal z-yaml">.</span>0.0.0</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">local</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-language z-boolean z-yaml">true</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">obsd</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">host</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">root@192.168.3.102:22</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tags</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-meta z-flow-sequence z-yaml"><span class="z-punctuation z-definition z-sequence z-begin z-yaml">[</span><span class="z-string z-unquoted z-plain z-in z-yaml">bsd</span><span class="z-punctuation z-definition z-sequence z-end z-yaml">]</span></span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">fbsd</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">host</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">root@192.168.3.103:22</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tags</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-meta z-flow-sequence z-yaml"><span class="z-punctuation z-definition z-sequence z-begin z-yaml">[</span><span class="z-string z-unquoted z-plain z-in z-yaml">bsd</span><span class="z-punctuation z-definition z-sequence z-end z-yaml">]</span></span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">work_dir</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">/tmp</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">env</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">DATE</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">$(date -u +"%Y-%m-%dT%H:%M:%S%Z")</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">specs</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">info</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">output</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">table</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ignore_errors</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-language z-boolean z-yaml">true</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">omit_empty_rows</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-language z-boolean z-yaml">true</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">omit_empty_columns</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-language z-boolean z-yaml">true</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">any_fatal_errors</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-language z-boolean z-yaml">false</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ignore_unreachable</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-language z-boolean z-yaml">true</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">strategy</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">free</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ping</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">desc</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Pong</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">spec</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">info</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">cmd</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">echo "pong"</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">uname</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">OS</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">desc</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Print OS</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">spec</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">info</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">cmd</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-keyword z-control z-flow z-block-scalar z-literal z-yaml">|</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">      os=$(uname -s)
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">      release=$(uname -r)
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">      echo "$os $release"
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml"></span>  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">uptime</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Uptime</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">desc</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Print uptime</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">spec</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">info</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">cmd</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">uptime</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">info</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">desc</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Get system overview</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">spec</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">info</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">tasks</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">task</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ping</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">date</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">cmd</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">echo $DATE</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">pwd</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">cmd</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">pwd</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">task</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">uname</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">task</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">uptime</span>
</span></code></pre><p><code>sake run info --tags bsd</code> запустить набор из 5 заданий из группы info<h2 id=secret-manager><a aria-label="Anchor link for: secret-manager" class=zola-anchor href=#secret-manager><i class=icon></i></a> Secret Manager</h2><h3 id=bitwarden><a aria-label="Anchor link for: bitwarden" class=zola-anchor href=#bitwarden><i class=icon></i></a> Bitwarden</h3><p><code>choco install bitwarden-cli || npm install -g @bitwarden/cli || sudo snap install bw</code> установить bitwarden cli <br> <code>bw login &LTemail> --apikey</code> авторизвация в хранилище, используя client_id и client_secret <br> <code>$session = bw unlock --raw</code> получить токен сессии <br> <code>$items = bw list items --session $session | ConvertFrom-Json</code> получение всех элементов в хранилище с использованием мастер-пароля <br> <code>echo "master_password" | bw get item GitHub bw get password $items[0].name</code> получить пароль по названию секрета <br> <code>bw lock</code> завершить сессию<pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Авторизация в организации<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>client_id</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>organization.ClientId<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>client_secret</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>client_secret<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>deviceIdentifier</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">guid</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::NewGuid<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.ToString<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>deviceName</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>PowerShell-Client<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>response</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Uri <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>https://identity.bitwarden.com/connect/token<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Method POST <span class="z-keyword z-operator z-other z-powershell">`</span>
</span><span class="z-source z-powershell">    <span class="z-keyword z-operator z-assignment z-powershell">-</span>Headers <span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Content-Type<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>application/x-www-form-urlencoded<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span> <span class="z-keyword z-operator z-other z-powershell">`</span>
</span><span class="z-source z-powershell">    <span class="z-keyword z-operator z-assignment z-powershell">-</span>Body <span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">        <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">grant_type</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>client_credentials<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">        <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">scope</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>api.organization<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">        <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">client_id</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>client_id</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">        <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">client_secret</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>client_secret</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">        <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">deviceIdentifier</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>deviceIdentifier</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">        <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">deviceName</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>deviceName</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Получение токена доступа<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>accessToken</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>response<span class="z-variable z-other z-member z-powershell">.access_token</span></span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Название элемента в хранилище<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>itemName</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>GitHub<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Поиск элемента в хранилище<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>itemResponse</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Uri <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>https://api.bitwarden.com/v1/objects?search=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>itemName</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Method GET <span class="z-keyword z-operator z-other z-powershell">`</span>
</span><span class="z-source z-powershell">    <span class="z-keyword z-operator z-assignment z-powershell">-</span>Headers <span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Authorization<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Bearer <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>accessToken</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>item</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>itemResponse<span class="z-variable z-other z-member z-powershell">.data</span></span><span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-constant z-numeric z-integer z-powershell">0</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Получение информации об элементе<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>detailsResponse</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Uri <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>https://api.bitwarden.com/v1/objects/<span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-complex z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>item<span class="z-variable z-other z-member z-powershell">.id</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Method GET <span class="z-keyword z-operator z-other z-powershell">`</span>
</span><span class="z-source z-powershell">    <span class="z-keyword z-operator z-assignment z-powershell">-</span>Headers <span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Authorization<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Bearer <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>accessToken</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Получение логина и пароля<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>login</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>detailsResponse<span class="z-variable z-other z-member z-powershell">.login.username</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>password</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>detailsResponse<span class="z-variable z-other z-member z-powershell">.login.password</span></span>
</span></code></pre><h3 id=infisical><a aria-label="Anchor link for: infisical" class=zola-anchor href=#infisical><i class=icon></i></a> Infisical</h3><p><code>npm install -g @infisical/cli</code> <br> <code>infisical login</code> авторизоваться в хранилище (cloud или Self-Hosting) <br> <code>infisical init</code> инициализировать - выбрать организацию и проект <br> <code>infisical secrets</code> получить список секретов и их SECRET VALUE из добавленных групп Environments (Development, Staging, Production)<pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>clientId</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>&LTclient_id><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> создать организацию и клиент в Organization Access Control - Identities и предоставить права на Projects (Secret Management)<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>clientSecret</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>&LTclient_secret><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> на той же вкладке вкладке в Authentication сгенерировать секрет (Create Client Secret)<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>body</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">clientId</span>     <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>clientId</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">clientSecret</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>clientSecret</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>response</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Uri <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>https://app.infisical.com/api/v1/auth/universal-auth/login<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-other z-powershell">`</span>
</span><span class="z-source z-powershell">    <span class="z-keyword z-operator z-assignment z-powershell">-</span>Method POST <span class="z-keyword z-operator z-other z-powershell">`</span>
</span><span class="z-source z-powershell">    <span class="z-keyword z-operator z-assignment z-powershell">-</span>ContentType <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>application/x-www-form-urlencoded<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-other z-powershell">`</span>
</span><span class="z-source z-powershell">    <span class="z-keyword z-operator z-assignment z-powershell">-</span>Body <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>body</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>TOKEN</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>response<span class="z-variable z-other z-member z-powershell">.accessToken</span></span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> получить токен доступа<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Получить содержимое секрета<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>secretName</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>FOO<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> название секрета<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>workspaceId</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>82488c0a-6d3a-4220-9d69-19889f09c8c8<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> можно взять из url проекта Secret Management<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>environment</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>dev<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> группа<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>headers</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">Authorization</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Bearer <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>TOKEN</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>secrets</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Uri <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>https://app.infisical.com/api/v3/secrets/raw/<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-braces z-begin">{</span>secretName<span class="z-punctuation z-section z-braces z-end">}</span></span>?workspaceId=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-braces z-begin">{</span>workspaceId<span class="z-punctuation z-section z-braces z-end">}</span></span>&environment=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-braces z-begin">{</span>environment<span class="z-punctuation z-section z-braces z-end">}</span></span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Method GET <span class="z-keyword z-operator z-assignment z-powershell">-</span>Headers <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>headers</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>secrets<span class="z-variable z-other z-member z-powershell">.secret.secretKey</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>secrets<span class="z-variable z-other z-member z-powershell">.secret.secretValue</span></span>
</span></code></pre><h3 id=hashicorp-vault><a aria-label="Anchor link for: hashicorp-vault" class=zola-anchor href=#hashicorp-vault><i class=icon></i></a> HashiCorp/Vault</h3><p><code>mkdir vault && cd vault && mkdir vault_config</code><p>Создать конфигурацию:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell"># Использовать локальное файловое хранилище
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">storage "file" {
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">  path = "/vault/file"
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">}
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell"># Отключение режим dev (не будет выгружать данные в память)
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">disable_mlock = false
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell"># Настройка слушателя для REST API
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">listener "tcp" {
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">  address = "0.0.0.0:8200"
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">  tls_disable = 1  # Отключить TLS
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">}
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell"># Включение интерфейс
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">ui = true
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell"># Включение аутентификации в API по токену
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">api_addr = "http://localhost:8200"
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">auth "token" {}
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-end z-shell">'</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">></span> vault_config/vault.hcl</span>
</span></code></pre><p>Запускаем в контейнере:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> run<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>d</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>name</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>vault <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">  --</span>restart</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>unless-stopped <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">  -</span>e</span> VAULT_ADDR=http://0.0.0.0:8200 <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">  -</span>e</span> VAULT_API_ADDR=http://localhost:8200 <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">  -</span>p</span> 8200:8200 <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">  -</span>v</span> ./vault_config:/vault/config <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">  -</span>v</span> ./vault_data:/vault/file <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">  --</span>cap-add</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>IPC_LOCK <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell">  hashicorp/vault:latest <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell">  vault server<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>config</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>/vault/config/vault.hcl</span>
</span></code></pre><p>Получить ключи разблокировки и root ключ для первичной инициализации:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> exec<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>it</span> vault vault operator init</span>
</span></code></pre><p>Ввести любые 3 из 5 ключей для разблокировки после перезапуска контейнера:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> exec<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>it</span> vault vault operator unseal BPJSmuLvKAEr6wtE/8TOMRMM+x0fW3UhOxGFLn9Gmi5N</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> exec<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>it</span> vault vault operator unseal 44ntLYvSMN5FNLyddLo2IylRsLk7lqYXZOShvhV/2gbG</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> exec<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>it</span> vault vault operator unseal xP9+YTyW13W6xGz52mMut2MdOnzxtbhDW8dK9zdF4aLY</span>
</span></code></pre><p>Проверить статус (должно быть <code>Sealed: false</code>) и авторизацию по root ключу в хранилище:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> exec<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>it</span> vault vault status</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> exec<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>it</span> vault vault login hvs.rxlYkJujkX6Fdxq2XAP3cd3a</span>
</span></code></pre><p><code>Secrets Engines</code> -> <code>Enable new engine</code> + <code>KV</code> <br> API Swagger: http://192.168.3.100:8200/ui/vault/tools/api-explorer<pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>TOKEN</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>hvs.rxlYkJujkX6Fdxq2XAP3cd3a<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Headers</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>X-Vault-Token<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>TOKEN</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Указать путь до секретов (создается в корне kv)<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>main-path<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>url</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>http://192.168.3.101:8200/v1/kv/data/<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>data</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Uri <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>url</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Method GET <span class="z-keyword z-operator z-assignment z-powershell">-</span>Headers <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Headers</span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Получить содержимое ключа по его названию (key_name)<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>data<span class="z-variable z-other z-member z-powershell">.data.data.key_name</span></span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> secret_value<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Перезаписать все секреты<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Headers</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>X-Vault-Token<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>TOKEN</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Body</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">data</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-meta z-hashtable z-powershell">        <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">key_name_1</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>key_value_1<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-meta z-hashtable z-powershell">        <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">key_name_2</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>key_value_2<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">options</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">version</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-constant z-numeric z-integer z-powershell">0</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-support z-function z-powershell">ConvertTo-Json</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>urlUpdate</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>http://192.168.3.100:8200/v1/kv/data/main-path<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Uri <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>urlUpdate</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Method POST <span class="z-keyword z-operator z-assignment z-powershell">-</span>Headers <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Headers</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Body <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Body</span>
</span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Удалить все секреты<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Uri <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>http://192.168.3.100:8200/v1/kv/data/main-path<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Method DELETE <span class="z-keyword z-operator z-assignment z-powershell">-</span>Headers <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Headers</span>
</span></code></pre><p>Vault client:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Установить клиент в Linux (debian):</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">wget</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>O</span> - https://apt.releases.hashicorp.com/gpg</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> gpg<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>dearmor</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>o</span> /usr/share/keyrings/hashicorp-archive-keyring.gpg</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>deb [arch=<span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">dpkg</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>print-architecture</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span> signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com <span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">lsb_release</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>cs</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span> main<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> tee /etc/apt/sources.list.d/hashicorp.list</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> apt update</span> <span class="z-keyword z-operator z-logical z-and z-shell">&&</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> apt install vault</span>
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Включить механизм секретов KV</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">vault</span></span><span class="z-meta z-function-call z-arguments z-shell"> secrets enable<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>version</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>1 kv </span>
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Создать секрет</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">vault</span></span><span class="z-meta z-function-call z-arguments z-shell"> kv put kv/main-path key_name=secret_value</span>
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Список секретов</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">vault</span></span><span class="z-meta z-function-call z-arguments z-shell"> kv list kv/</span>
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Получить содержимое секрета</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">vault</span></span><span class="z-meta z-function-call z-arguments z-shell"> kv get<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>mount</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>kv<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>main-path<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Удалить секреты</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">vault</span></span><span class="z-meta z-function-call z-arguments z-shell"> kv delete kv/my-secret</span>
</span></code></pre><h3 id=hashicorp-consul><a aria-label="Anchor link for: hashicorp-consul" class=zola-anchor href=#hashicorp-consul><i class=icon></i></a> HashiCorp/Consul</h3><p><a href=https://github.com/hashicorp/consul>Consul</a> используется для кластеризации и централизованного хранения данных <code>Vault</code>, а также как самостоятельное <code>Key-Value</code> хранилище.<p>Создать конфигурацию:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">ui = true
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">log_level = "INFO"
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">acl {
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">  enabled = true
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">  default_policy = "deny"
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">  enable_token_persistence = true
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell">}
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-end z-shell">'</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">></span> consul.hcl</span>
</span></code></pre><p>Запускаем в контейнере:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> run<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>d</span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">  --</span>name</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>consul <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">  --</span>restart</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>unless-stopped <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">  -</span>p</span> 8500:8500 <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">  -</span>v</span> ./consul_data:/consul/data <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">  -</span>v</span> ./consul.hcl:/consul/config/consul.hcl <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell">  hashicorp/consul:latest <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell">  agent<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>server</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>bootstrap-expect</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>1<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>client</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>0.0.0.0</span>
</span></code></pre><p>Создать <code>root token</code>, который будет использоваться для управления системой <code>ACL</code> и для создания политик доступа и других токенов доступа:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> exec<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>it</span> consul consul acl bootstrap</span>
</span></code></pre><p>Создать новую политику доступа:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> exec<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>it</span> consul consul acl policy create<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>name</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>default<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>rules</span> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>node_prefix "" { policy = "write" } service_prefix "" { policy = "write" } key_prefix "" { policy = "write" }<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>token</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>382834da-28b6-c72c-7ffb-11acf9bf20bc<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span></code></pre><p>Создать новый токен доступа:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> exec<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>it</span> consul consul acl token create<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>policy-name</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>default<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>token</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>382834da-28b6-c72c-7ffb-11acf9bf20bc<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span></code></pre><p><code>curl http://localhost:8500/v1/health/service/consul?pretty</code> <br> <code>curl --request PUT --data "ssh-rsa AAAA" http://localhost:8500/v1/kv/ssh/key</code> записать секрет KV Store Consul <br> <code>curl -s http://localhost:8500/v1/kv/ssh/key | jq -r .[].Value | base64 --decode</code> извлечь содержимое секрета<h2 id=prometheus><a aria-label="Anchor link for: prometheus" class=zola-anchor href=#prometheus><i class=icon></i></a> Prometheus</h2><p>Пример создания экспортера для получения метрик температуры всех дисков из <a href=https://crystalmark.info/en/software/crystaldiskinfo>CrystalDiskInfo</a> и отправки в <a href=https://github.com/prometheus/prometheus>Prometheus</a> через <a href=https://github.com/prometheus/pushgateway>PushGateway</a>.<p>Формат метрик:<pre class=z-code><code><span class="z-text z-plain"># HELP название_метрики Описание метрики
</span><span class="z-text z-plain"># TYPE название_метрики ТИП-ДАННЫХ
</span><span class="z-text z-plain">название_метрики{лейбл="НАЗВАНИЕ ДИСКА 1", instance="HOSTNAME"} ЗНАЧЕНИЕ
</span><span class="z-text z-plain">название_метрики{лейбл="НАЗВАНИЕ ДИСКА 2", instance="HOSTNAME"} ЗНАЧЕНИЕ
</span></code></pre><p>Типы данных:<ul><li><code>counter</code> - возрастающее значение (например, количество запросов, ошибок, завершенных задач)<li><code>gauge</code> - переменное значение (может увеличиваться или уменьшаться, например, нагрузка CPU, объем свободной памяти, температура)<li><code>histogram</code> - разделенные данные на корзины (buckets, с помощью лэйбла <code>le</code>) и подсчет наблюдения в них (автоматически создает три метрики: <name>_bucket, <name>_sum, <name>_count) <li><code>summary</code> - аналогичен гистограмме, но вычисляет квантили</li> <p>Строки метрик содержат имя, лейблы (в фигурных скобках) и значение.</p> <ol><li>Запускаем <code>pushgateway</code> в контейнере:</ol> <p><code>docker run -d --name pushgateway --restart unless-stopped -p 19091:9091 prom/pushgateway</code></p> <ol start=2><li>Запускаем скрипт в консоли:</ol> <pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>instance</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">System.Net.Dns</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::GetHostName<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>pushgatewayUrl</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>http://192.168.3.100:19091/metrics/job/disk_temperature<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Изменить адрес шлюза на имя контейнера при запуске через compose<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> $pushgatewayUrl = "http://pushgateway:9091/metrics/job/disk_temperature"<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>C:/Program Files/CrystalDiskInfo/Smart<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Изменить путь при запуске в контейнере Docker через WSL<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> $path = "/mnt/c/Program Files/CrystalDiskInfo/Smart"<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Необходимо строго использовать синтаксис PowerShell (избегая псевдонимы ls)<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>diskArray</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-group z-complex z-subexpression z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-support z-function z-powershell">Get-ChildItem</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span>.Name
</span><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">while</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-constant z-language z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>true</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>metrics</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span># TYPE disk_temperature gauge<span class="z-constant z-character z-escape z-powershell">`n</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-keyword z-control z-powershell">foreach</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>diskName</span> <span class="z-keyword z-control z-powershell">in</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>diskArray</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>lastTemp</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-group z-complex z-subexpression z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-meta z-group z-array-expression z-powershell"><span class="z-keyword z-other z-array z-begin z-powershell">@</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Date,Value<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span><span class="z-keyword z-operator z-assignment z-powershell">+</span><span class="z-meta z-group z-complex z-subexpression z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-support z-function z-powershell">Get-Content</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path</span>/<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>diskName</span>/Temperature.csv<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-support z-function z-powershell">ConvertFrom-Csv</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span><span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-constant z-numeric z-integer z-powershell">-1</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>.Value
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>diskLabel</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>diskName</span> <span class="z-keyword z-operator z-comparison z-powershell">-replace</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>[^a-zA-Z0-9]<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>_<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>metrics</span> <span class="z-keyword z-operator z-assignment z-powershell">+=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>disk_temperature{disk=<span class="z-constant z-character z-escape z-powershell">`"</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>diskLabel</span><span class="z-constant z-character z-escape z-powershell">`"</span>,instance=<span class="z-constant z-character z-escape z-powershell">`"</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>instance</span><span class="z-constant z-character z-escape z-powershell">`"</span>} <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>lastTemp</span><span class="z-constant z-character z-escape z-powershell">`n</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>metrics</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Uri <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>pushgatewayUrl</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Method POST <span class="z-keyword z-operator z-assignment z-powershell">-</span>Body <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>metrics</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-support z-function z-powershell">Start-Sleep</span> <span class="z-constant z-numeric z-integer z-powershell">10</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></code></pre> <ol start=3><li>Проверяем наличие метрик на конечной точке шлюза:</ol> <pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell"><span class="z-meta z-group z-complex z-subexpression z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-support z-function z-powershell">Invoke-RestMethod</span> http:<span class="z-keyword z-operator z-assignment z-powershell">/</span><span class="z-keyword z-operator z-assignment z-powershell">/</span><span class="z-constant z-numeric z-integer z-powershell">192.168</span>.<span class="z-constant z-numeric z-integer z-powershell">3.100</span>:<span class="z-constant z-numeric z-integer z-powershell">9091</span><span class="z-keyword z-operator z-assignment z-powershell">/</span>metrics<span class="z-punctuation z-section z-group z-end z-powershell">)</span></span>.Split<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-constant z-character z-escape z-powershell">`n</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-support z-function z-powershell">Select-String</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>disk_temperature<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></code></pre> <ol start=4><li>Добавляем конфигурацию в <code>prometheus.yml</code>:</ol> <pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">scrape_configs</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">job_name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">cdi-exporter</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">scrape_interval</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">10s</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">scrape_timeout</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">2s</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">metrics_path</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">/metrics</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">static_configs</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">targets</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-quoted z-single z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">'</span>192.168.3.100:19091<span class="z-punctuation z-definition z-string z-end z-yaml">'</span></span>
</span></code></pre> <p><code>docker-compose kill -s SIGHUP prometheus</code> применяем изменения</p> <ol start=5><li>Собираем контейнер в среде <code>WSL</code> с помощью <code>dockerfile</code> монтированием системного диска Windows:</ol> <pre class="language-dockerfile z-code" data-lang=dockerfile><code class=language-dockerfile data-lang=dockerfile><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">FROM</span> mcr.microsoft.com/powershell:<span class="z-entity z-name z-enum z-tag-digest">latest</span>
</span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">WORKDIR </span>/cdi-exporter
</span><span class="z-source z-dockerfile"><span class="z-keyword z-control z-dockerfile">COPY</span> cdi-exporter.ps1 ./cdi-exporter.ps1
</span><span class="z-source z-dockerfile"><span class="z-keyword z-operator z-dockerfile">CMD </span>[<span class="z-string z-quoted z-double z-dockerfile"><span class="z-punctuation z-definition z-string z-begin z-dockerfile">"</span>pwsh<span class="z-punctuation z-definition z-string z-end z-dockerfile">"</span></span>, <span class="z-string z-quoted z-double z-dockerfile"><span class="z-punctuation z-definition z-string z-begin z-dockerfile">"</span>-File<span class="z-punctuation z-definition z-string z-end z-dockerfile">"</span></span>, <span class="z-string z-quoted z-double z-dockerfile"><span class="z-punctuation z-definition z-string z-begin z-dockerfile">"</span>cdi-exporter.ps1<span class="z-punctuation z-definition z-string z-end z-dockerfile">"</span></span>]
</span></code></pre> <p><code>docker build -t cdi-exporter .</code> <br> <code>docker run -d -v /mnt/c:/mnt/c --name cdi-exporter cdi-exporter</code></p> <ol start=6><li>Собираем стек из шлюза и скрипта в <code>docker-compose.yml</code>:</ol> <pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">services</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">cdi-exporter</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">build</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">context</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-float z-decimal z-yaml"><span class="z-punctuation z-separator z-decimal z-yaml">.</span></span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">dockerfile</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">dockerfile</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">container_name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">cdi-exporter</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">volumes</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">/mnt/c:/mnt/c</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">restart</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">unless-stopped</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">pushgateway</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">image</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">prom/pushgateway</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">container_name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">pushgateway</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ports</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>19091:9091<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">restart</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">unless-stopped</span>
</span></code></pre> <p><code>docker-compose up -d</code></p> <ol start=7><li>Настраиваем <code>Dashboard</code> в <code>Grafana</code>:</ol> <p>Переменные для фильтрации запроса: <br> hostName: <code>label_values(exported_instance)</code> <br> diskName: <code>label_values(disk)</code> <br> Метрика температуры: <code>disk_temperature{exported_instance="$hostName", disk=~"$diskName"}</code></p> <h3 id=promql-functions><a aria-label="Anchor link for: promql-functions" class=zola-anchor href=#promql-functions><i class=icon></i></a> PromQL Functions</h3> <table><thead><tr><th>Функция<th>Тип данных<th>Описание<th>Пример<tbody><tr><td><code>rate()</code><td><code>counter</code><td>Средняя скорость роста метрики за интервал (increase / seconds)<td><code>rate(http_requests_total[$__rate_interval])</code><tr><td><code>irate()</code><td><code>counter</code><td>Мгновенная скорость роста (использует последние 2 точки)<td><code>irate(http_requests_total[1m])</code><tr><td><code>increase()</code><td><code>counter</code><td>Абсолютный прирост метрики за интервал (end time - start time)<td><code>increase(http_requests_total[5m])</code><tr><td><code>resets()</code><td><code>counter</code><td>Количество сбросов counter-метрики за интервал.<td><code>resets(process_cpu_seconds_total[1h])</code><tr><td><code>delta()</code><td><code>gauge</code><td>Разница между первым и последним значением метрики за интервал<td><code>delta(node_memory_free[[5m]])</code><tr><td><code>idelta()</code><td><code>gauge</code><td>Разница между последними двумя точками<td><code>delta(node_memory_free[1m])</code><tr><td><code>avg_over_time()</code><td><code>gauge</code><td>Среднее значение за интервал<td><code>avg_over_time(temperature[5m])</code><tr><td><code>max_over_time()</code><td><code>gauge</code><td>Максимальное значение за интервал<td><code>max_over_time(temperature[5m])</code><tr><td><code>predict_linear()</code><td><code>gauge</code><td>Предсказывает значение метрики через N секунд (для прогнозирования)<td><code>predict_linear(disk_free[1h], 3600)</code><tr><td><code>count()</code><td><code>counter</code>/<code>gauge</code><td>Количество элементов метрики<td><code>count(http_requests_total) by (status_code)</code><tr><td><code>sum()</code><td><code>counter</code>/<code>gauge</code><td>Суммирует значения метрик по указанным labels<td><code>sum(rate(cpu_usage[5m])) by (pod)</code><tr><td><code>avg()</code><td><code>counter</code>/<code>gauge</code><td>Среднее значение метрики по указанным labels<td><code>avg(node_memory_usage_bytes) by (instance)</code><tr><td><code>min() / max()</code><td><code>counter</code>/<code>gauge</code><td>Возвращает минимальное/максимальное значение<td><code>max(container_cpu_usage) by (namespace)</code><tr><td><code>round()</code><td><code>counter</code>/<code>gauge</code><td>Округляет значения до указанного числа дробных знаков<td><code>round(container_memory_usage / 1e9, 2)</code><tr><td><code>floor() / ceil()</code><td><code>counter</code>/<code>gauge</code><td>Округляет вниз/вверх до целого числа<td><code>floor(disk_usage_percent)</code><tr><td><code>absent()</code><td><code>counter</code>/<code>gauge</code><td>Возвращает 1, если метрика отсутствует (для алертинга)<td><code>absent(up{job="node-exporter"})</code><tr><td><code>clamp_min() / clamp_max()</code><td><code>counter</code>/<code>gauge</code><td>Ограничивает значения минимумом/максимумом (уменьшает если больше)<td><code>clamp_max(disk_usage_percent, 100)</code><tr><td><code>label_replace()</code><td><code>counter</code>/<code>gauge</code><td>Изменяет или добавляет labels в метрике<td><code>label_replace(metric, "new_label", "$1", "old_label", "(.*)")</code><tr><td><code>sort() / sort_desc()</code><td><code>counter</code>/<code>gauge</code><td>Сортирует метрики по возрастанию/убыванию<td><code>sort(node_filesystem_free_bytes)</code></table> <h2 id=graylog><a aria-label="Anchor link for: graylog" class=zola-anchor href=#graylog><i class=icon></i></a> Graylog</h2> <p><a href=https://hub.docker.com/r/itzg/graylog>Graylog Docker Image</a></p> <ul><li>Устанавливаем MongoDB:</ul> <pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> run<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>name</span> mongo<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>d</span> mongo:3</span>
</span></code></pre> <ul><li>Используем прокси для установки Elassticsearch:</ul> <pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> run<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>name</span> elasticsearch <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    -</span>e</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>http.host=0.0.0.0<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>e</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>xpack.security.enabled=false<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    -</span>d</span> dockerhub.timeweb.cloud/library/elasticsearch:5.5.1</span>
</span></code></pre> <ul><li>Указываем статический IP адрес для подключения к API</ul> <pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">docker</span></span><span class="z-meta z-function-call z-arguments z-shell"> run<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>name</span> Graylog <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>link</span> mongo <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    --</span>link</span> elasticsearch <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    -</span>p</span> 9000:9000<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span> 12201:12201<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span> 514:514<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span> 5044:5044 <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    -</span>e</span> GRAYLOG_WEB_ENDPOINT_URI=<span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>http://192.168.3.101:9000/api<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">    -</span>d</span> graylog/graylog:2.3.2-1</span>
</span></code></pre> <ul><li>Настройка Syslog на клиенте Linux:</ul> <p><code>nano /etc/rsyslog.d/graylog.conf</code></p> <pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">*.*</span></span><span class="z-meta z-function-call z-arguments z-shell"> @@192.168.3.101:514</span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">RSYSLOG_SyslogProtocol23Format</span></span>
</span></code></pre> <p><code>systemctl restart rsyslog</code></p> <ul><li>Создать входящий поток (<code>inputs</code>) для Syslog на порту 514 по протоколу TCP:</ul> <p>http://192.168.3.101:9000/system/inputs</p> <ul><li>Пример фильтра для логов:</ul> <p><code>facility:"system daemon" AND application_name:bash AND message:\[ AND message:\]</code></p> <ul><li>Настройка Winlogbeat на клиенте Windows</ul> <p>Установка агента:</p> <pre class="language-PowerShell z-code" data-lang=PowerShell><code class=language-PowerShell data-lang=PowerShell><span class="z-source z-powershell">irm https:<span class="z-keyword z-operator z-assignment z-powershell">/</span><span class="z-keyword z-operator z-assignment z-powershell">/</span>artifacts.elastic.co<span class="z-keyword z-operator z-assignment z-powershell">/</span>downloads<span class="z-keyword z-operator z-assignment z-powershell">/</span>beats<span class="z-keyword z-operator z-assignment z-powershell">/</span>winlogbeat<span class="z-keyword z-operator z-assignment z-powershell">/</span>winlogbeat<span class="z-keyword z-operator z-assignment z-powershell">-</span><span class="z-constant z-numeric z-integer z-powershell">8.15</span>.<span class="z-constant z-numeric z-integer z-powershell">0</span><span class="z-keyword z-operator z-assignment z-powershell">-</span>windows<span class="z-keyword z-operator z-assignment z-powershell">-</span>x86_64.zip <span class="z-keyword z-operator z-assignment z-powershell">-</span>OutFile <span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Documents\winlogbeat<span class="z-keyword z-operator z-assignment z-powershell">-</span><span class="z-constant z-numeric z-integer z-powershell">8.15</span>.<span class="z-constant z-numeric z-integer z-powershell">0.</span>zip
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Expand-Archive</span> <span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Documents\winlogbeat<span class="z-keyword z-operator z-assignment z-powershell">-</span><span class="z-constant z-numeric z-integer z-powershell">8.15</span>.<span class="z-constant z-numeric z-integer z-powershell">0.</span>zip
</span><span class="z-source z-powershell">cd <span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Documents\winlogbeat<span class="z-keyword z-operator z-assignment z-powershell">-</span><span class="z-constant z-numeric z-integer z-powershell">8.15</span>.<span class="z-constant z-numeric z-integer z-powershell">0</span><span class="z-keyword z-operator z-assignment z-powershell">-</span>windows<span class="z-keyword z-operator z-assignment z-powershell">-</span>x86_64
</span></code></pre> <p>Добавить отправку в Logstash:</p> <p><code>code winlogbeat.yml</code></p> <pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">output.logstash:</span></span>
</span><span class="z-source z-shell z-bash">  <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">hosts:</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>192.168.3.101:5044<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span><span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span></span>
</span></code></pre> <p>И закомментировать отправку данных в Elasticsearch (output.elasticsearch)</p> <p><code>.\winlogbeat.exe -c winlogbeat.yml</code> запустить агент с правами администратора в консоли</p> <pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">.<span class="z-constant z-character z-escape z-shell">\i</span>nstall-service-winlogbeat.ps1 <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> установить службу</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Get-Service</span></span><span class="z-meta z-function-call z-arguments z-shell"> winlogbeat</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Start-Service</span></span>
</span></code></pre> <ul><li>Настроить Inputs для приема Beats на порту 5044</ul> <footer id=site-footer><nav><ul><li><a href=https://lifailon.github.io/powershell/>PowerShell</a><li><a href=https://lifailon.github.io/linux/>Linux</a><li><a class=active href=https://lifailon.github.io/devops/>DevOps</a><li><a href=https://lifailon.github.io/golang/>GoLang</a><li><a href=https://lifailon.github.io/node-js/>Node.js</a></ul></nav><p><strong>2023-2025</strong> © <em>Lifailon</em><p><small>Powered by <a class="link external" href=https://www.getzola.org>Zola</a> and <a class="link external" href=https://duckquill.daudix.one>Duckquill</a> </small><ul id=socials><li><a rel=" me" href=https://github.com/lifailon/PS-Commands title=GitHub> <i style="--icon:url(&#34data:image/svg+xml,%3Csvg role='img' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Ctitle%3EGitHub%3C/title%3E%3Cpath d='M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12'/%3E%3C/svg%3E&#34)" class=icon></i> <span>GitHub</span> </a><li><a rel=" me" href=https://www.nuget.org/profiles/Lifailon title=NuGet> <i style="--icon:url(&#34data:image/svg+xml,%3Csvg role='img' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Ctitle%3ENUGet%3C/title%3E%3Cpath d='M1.57 0A1.57 1.57 0 000 1.57v20.86A1.57 1.57 0 001.57 24h20.86A1.57 1.57 0 0024 22.43V1.57A1.57 1.57 0 0022.43 0zM7.5 1.5A2.5 2.5 0 0110 4a2.5 2.5 0 01-2.5 2.5A2.5 2.5 0 015 4a2.5 2.5 0 012.5-2.5zM12 6h9v12h-1.5a3.76 3.76 0 00-2.81-1.25A3.76 3.76 0 0012.5 20a3.76 3.76 0 002.19 3.25A3.76 3.76 0 0018.5 24H21V6z'/%3E%3C/svg%3E&#34)" class=icon></i> <span>NuGet</span> </a><li><a rel=" me" href=https://www.npmjs.com/~lifailon title=NPM> <i style="--icon:url(&#34data:image/svg+xml,%3Csvg role='img' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Ctitle%3ENPM%3C/title%3E%3Cpath d='M0 0v24h24V0zm14.74 14.74h-3.66v-5.5h-1.83v5.5H5.5V5.5h9.24z'/%3E%3C/svg%3E&#34)" class=icon></i> <span>NPM</span> </a><li><a rel=" me" title="Docker Hub" href=https://hub.docker.com/u/lifailon> <i style="--icon:url(&#34data:image/svg+xml,%3Csvg role='img' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Ctitle%3EDocker%3C/title%3E%3Cpath d='M22.149 10.74c-.111-.086-1.15-.86-3.3-.86-.26.002-.52.017-.78.045-.24-1.35-1.32-1.8-1.35-1.81l-.45-.17-.3.42c-.17.24-.65.88-.65 1.76.001.29.04.58.12.86-.66.19-1.3.35-1.95.48a9.72 9.72 0 0 1-1.95.22H.75c-.41 0-.75.34-.75.75 0 4.42 2.4 5.98 4.41 6.68.9.28 1.91.42 3.01.42 1.08 0 2.11-.14 3.01-.42 1.98-.61 3.51-2.01 4.14-4.01.34.04.68.07 1.02.07 1.35 0 2.61-.35 3.72-1.04 1.64-1.01 1.87-2.23 1.87-2.92.01-.96-.34-1.68-.35-1.7zM6.75 8.22h2.25c.14 0 .25-.11.25-.25V6.47c0-.14-.11-.25-.25-.25H6.75c-.14 0-.25.11-.25.25v1.5c0 .14.11.25.25.25zM12 8.22h2.25c.14 0 .25-.11.25-.25V6.47c0-.14-.11-.25-.25-.25H12c-.14 0-.25.11-.25.25v1.5c0 .14.11.25.25.25zM9.375 6.72h-2.25c-.14 0-.25.11-.25.25v1.5c0 .14.11.25.25.25h2.25c.14 0 .25-.11.25-.25v-1.5c0-.14-.11-.25-.25-.25zM12 5.47h-2.25c-.14 0-.25.11-.25.25v1.5c0 .14.11.25.25.25H12c.14 0 .25-.11.25-.25v-1.5c0-.14-.11-.25-.25-.25z'/%3E%3C/svg%3E&#34)" class=icon></i> <span>Docker Hub</span> </a></ul></footer> <span class=hidden id=copy-code-text>Copy Code</span> <span class=hidden id=search-index>https://lifailon.github.io/search_index.en.json</span> <span class=hidden id=more-matches-text>$MATCHES more matches</span> <style>:root{--alert-note-text:"Note";--alert-tip-text:"Tip";--alert-important-text:"Important";--alert-warning-text:"Warning";--alert-caution-text:"Caution"}</style> 