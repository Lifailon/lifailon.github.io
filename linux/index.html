<!doctype html><html data-theme=dark lang=en xmlns=http://www.w3.org/1999/xhtml><head><meta charset=UTF-8><meta content="Web version for PowerShell notes in Russian language (Сheat Sheet & Documentation), Linux commands and RuDocs for Node.js" name=description><meta content="width=device-width,initial-scale=1" name=viewport><meta content=#ff7800 name=theme-color><meta content=#ffa348 media=(prefers-color-scheme:dark) name=theme-color><meta content="default-src 'none';font-src 'self';img-src 'self' https: data:;media-src 'self' https:;style-src 'self' 'unsafe-inline';frame-src https://player.vimeo.com https://www.youtube-nocookie.com https://toot.community;frame-ancestors 'none';base-uri 'none';form-action 'none';connect-src 'self' https://toot.community;script-src 'self' 'self'" http-equiv=content-security-policy><title>Linux - PowerShell Commands</title><link href=https://lifailon.github.io/linux/ rel=canonical><link href=https://lifailon.github.io/favicon.png rel=icon type=image/png><link href=https://lifailon.github.io/apple-touch-icon.png rel=apple-touch-icon sizes=180x180 type=image/png><link title="PowerShell Commands - RSS Feed" href=https://lifailon.github.io/rss.xml rel=alternate type=application/rss+xml><link title="PowerShell Commands - Atom Feed" href=https://lifailon.github.io/atom.xml rel=alternate type=application/atom+xml><style>:root{--accent-color:#ff7800}[data-theme=dark]{--accent-color:#ffa348}@media (prefers-color-scheme:dark){:root:not([data-theme=light]){--accent-color:#ffa348}}</style><link href=https://lifailon.github.io/style.css rel=stylesheet><link media="(prefers-color-scheme: light)" href=https://lifailon.github.io/syntax-theme-light.css rel=stylesheet><link media="(prefers-color-scheme: dark)" href=https://lifailon.github.io/syntax-theme-dark.css rel=stylesheet><script defer src=https://lifailon.github.io/closable.js></script><script defer src=https://lifailon.github.io/copy-button.js></script><script defer src=https://lifailon.github.io/fuse.js></script><script defer src=https://lifailon.github.io/search-fuse.js></script><script defer src=https://lifailon.github.io/theme-switcher.js></script><meta content="PowerShell Commands" property=og:site_name><meta content="Linux - PowerShell Commands" property=og:title><meta content=https://lifailon.github.io/linux/ property=og:url><meta content="Web version for PowerShell notes in Russian language (Сheat Sheet & Documentation), Linux commands and RuDocs for Node.js" property=og:description><meta content=https://lifailon.github.io/card.png property=og:image><meta content=en_US property=og:locale><body><div id=handle></div><header id=site-nav><nav><a href=#main-content tabindex=0> Skip to Main Content </a><ul><li id=home><a href=https://lifailon.github.io> <i class=icon></i>PowerShell Commands</a><li class=divider><li><a href=https://lifailon.github.io/powershell/>PowerShell</a><li><a class=active href=https://lifailon.github.io/linux/>Linux</a><li><a href=https://lifailon.github.io/golang/>GoLang</a><li><a href=https://lifailon.github.io/node-js/>Node.js</a><li><a href=https://lifailon.github.io/docker/>Docker</a><li><a href=https://lifailon.github.io/network/>Network</a><li><a href=https://lifailon.github.io/windowsserver/>Windows Server</a><li><a href=https://lifailon.github.io/database/>Database</a><li><a href=https://lifailon.github.io/api/>API</a><li><a href=https://lifailon.github.io/devops/>DevOps</a><li id=search><button class=circle id=search-toggle title=Search><i class=icon></i></button><li id=theme-switcher><details class=closable><summary class=circle title=Theme><i class=icon></i></summary> <ul><li><button title="Switch to Light Theme" class=circle id=theme-light><i class=icon></i></button><li><button title="Switch to Dark Theme" class=circle id=theme-dark><i class=icon></i></button><li><button title="Use System Theme" class=circle id=theme-system><i class=icon></i></button></ul></details><li id=repo><a class=circle href=https://github.com/Lifailon/PS-Commands title=Repository> <i class=icon></i> </a></ul></nav><div id=search-container><label class=visually-hidden for=search-bar>Search</label><input placeholder="Search for…" autocomplete=off disabled id=search-bar type=search><div id=search-results-container><div id=search-results></div></div></div></header><div id=sidebar><div><h2>Table of Contents</h2><ul><li><a href=https://lifailon.github.io/linux/#bash>bash</a><li><a href=https://lifailon.github.io/linux/#filesystem>filesystem</a><ul><li><a href=https://lifailon.github.io/linux/#ln>ln</a><li><a href=https://lifailon.github.io/linux/#zip>zip</a><li><a href=https://lifailon.github.io/linux/#gpg>gpg</a></ul><li><a href=https://lifailon.github.io/linux/#api>api</a><ul><li><a href=https://lifailon.github.io/linux/#curl>curl</a><li><a href=https://lifailon.github.io/linux/#influxdb>influxdb</a><li><a href=https://lifailon.github.io/linux/#wget>wget</a><li><a href=https://lifailon.github.io/linux/#curlie>curlie</a><li><a href=https://lifailon.github.io/linux/#httpie>httpie</a></ul><li><a href=https://lifailon.github.io/linux/#json>json</a><ul><li><a href=https://lifailon.github.io/linux/#jq>jq</a><li><a href=https://lifailon.github.io/linux/#netcheck>netcheck</a><li><a href=https://lifailon.github.io/linux/#jc>jc</a><li><a href=https://lifailon.github.io/linux/#brew>brew</a><li><a href=https://lifailon.github.io/linux/#fx>fx</a><li><a href=https://lifailon.github.io/linux/#jid>jid</a><li><a href=https://lifailon.github.io/linux/#jqp>jqp</a><li><a href=https://lifailon.github.io/linux/#xmllint>xmllint</a><li><a href=https://lifailon.github.io/linux/#dasel>dasel</a><li><a href=https://lifailon.github.io/linux/#xq>xq</a><li><a href=https://lifailon.github.io/linux/#htmlq>htmlq</a><li><a href=https://lifailon.github.io/linux/#yq>yq</a><li><a href=https://lifailon.github.io/linux/#yamllint>yamllint</a><li><a href=https://lifailon.github.io/linux/#jsonlint>jsonlint</a><li><a href=https://lifailon.github.io/linux/#csv>csv</a><li><a href=https://lifailon.github.io/linux/#sttr>sttr</a></ul><li><a href=https://lifailon.github.io/linux/#grep>grep</a><ul><li><a href=https://lifailon.github.io/linux/#ripgrep>ripgrep</a><li><a href=https://lifailon.github.io/linux/#sig>sig</a></ul><li><a href=https://lifailon.github.io/linux/#sed>sed</a><li><a href=https://lifailon.github.io/linux/#awk>awk</a><li><a href=https://lifailon.github.io/linux/#printf>printf</a><li><a href=https://lifailon.github.io/linux/#cut>cut</a><ul><li><a href=https://lifailon.github.io/linux/#rev>rev</a></ul><li><a href=https://lifailon.github.io/linux/#tr>tr</a><li><a href=https://lifailon.github.io/linux/#man>man</a><ul><li><a href=https://lifailon.github.io/linux/#cheat-sh>cheat sh</a><li><a href=https://lifailon.github.io/linux/#tldr>tldr</a></ul><li><a href=https://lifailon.github.io/linux/#debug>debug</a><li><a href=https://lifailon.github.io/linux/#tools>tools</a><li><a href=https://lifailon.github.io/linux/#dust>dust</a><li><a href=https://lifailon.github.io/linux/#find>find</a><ul><li><a href=https://lifailon.github.io/linux/#exec>exec</a><li><a href=https://lifailon.github.io/linux/#locate>locate</a><li><a href=https://lifailon.github.io/linux/#fd>fd</a></ul><li><a href=https://lifailon.github.io/linux/#bashrc>bashrc</a><ul><li><a href=https://lifailon.github.io/linux/#oh-my-bash>oh-my-bash</a><li><a href=https://lifailon.github.io/linux/#fzf>fzf</a><li><a href=https://lifailon.github.io/linux/#fzf-obc>fzf-obc</a><li><a href=https://lifailon.github.io/linux/#hstr>hstr</a><li><a href=https://lifailon.github.io/linux/#mcfly>mcfly</a></ul><li><a href=https://lifailon.github.io/linux/#compgen>compgen</a><li><a href=https://lifailon.github.io/linux/#cron>cron</a><li><a href=https://lifailon.github.io/linux/#systemctl>systemctl</a><ul><li><a href=https://lifailon.github.io/linux/#systemctl-tui>systemctl-tui</a><li><a href=https://lifailon.github.io/linux/#unit>unit</a></ul><li><a href=https://lifailon.github.io/linux/#journalctl>journalctl</a><li><a href=https://lifailon.github.io/linux/#dmesg>dmesg</a><li><a href=https://lifailon.github.io/linux/#hardware>hardware</a><li><a href=https://lifailon.github.io/linux/#sysctl>sysctl</a><li><a href=https://lifailon.github.io/linux/#limits>limits</a><li><a href=https://lifailon.github.io/linux/#quota>quota</a><li><a href=https://lifailon.github.io/linux/#fetch>fetch</a><li><a href=https://lifailon.github.io/linux/#networkmanager>networkmanager</a><li><a href=https://lifailon.github.io/linux/#wireless>wireless</a><li><a href=https://lifailon.github.io/linux/#networking>networking</a><li><a href=https://lifailon.github.io/linux/#netplan>netplan</a><li><a href=https://lifailon.github.io/linux/#ip>ip</a><ul><li><a href=https://lifailon.github.io/linux/#net-tools>net-tools</a><li><a href=https://lifailon.github.io/linux/#networkd>networkd</a></ul><li><a href=https://lifailon.github.io/linux/#ss>ss</a><li><a href=https://lifailon.github.io/linux/#dns>dns</a><ul><li><a href=https://lifailon.github.io/linux/#resolv>resolv</a><li><a href=https://lifailon.github.io/linux/#resolved>resolved</a><li><a href=https://lifailon.github.io/linux/#dig>dig</a><li><a href=https://lifailon.github.io/linux/#mtr>mtr</a><li><a href=https://lifailon.github.io/linux/#doggo>doggo</a></ul><li><a href=https://lifailon.github.io/linux/#vnstat>vnstat</a><li><a href=https://lifailon.github.io/linux/#netcat>netcat</a><ul><li><a href=https://lifailon.github.io/linux/#socket-api>socket api</a><li><a href=https://lifailon.github.io/linux/#socket-proxy>socket proxy</a></ul><li><a href=https://lifailon.github.io/linux/#proxy>proxy</a><li><a href=https://lifailon.github.io/linux/#nmap>nmap</a><ul><li><a href=https://lifailon.github.io/linux/#masscan>masscan</a><li><a href=https://lifailon.github.io/linux/#rustscan>rustscan</a><li><a href=https://lifailon.github.io/linux/#tcp>tcp</a></ul><li><a href=https://lifailon.github.io/linux/#tcpdump>tcpdump</a><li><a href=https://lifailon.github.io/linux/#tshark>tshark</a><li><a href=https://lifailon.github.io/linux/#ping>ping</a><ul><li><a href=https://lifailon.github.io/linux/#fping>fping</a><li><a href=https://lifailon.github.io/linux/#netping>netping</a></ul><li><a href=https://lifailon.github.io/linux/#firewall>firewall</a><ul><li><a href=https://lifailon.github.io/linux/#ufw>ufw</a><li><a href=https://lifailon.github.io/linux/#show>show</a><li><a href=https://lifailon.github.io/linux/#firewalld>firewalld</a><li><a href=https://lifailon.github.io/linux/#iptables>iptables</a><li><a href=https://lifailon.github.io/linux/#nftables>nftables</a></ul><li><a href=https://lifailon.github.io/linux/#ssh>ssh</a><ul><li><a href=https://lifailon.github.io/linux/#keygen>keygen</a><li><a href=https://lifailon.github.io/linux/#x11>x11</a><li><a href=https://lifailon.github.io/linux/#scp>scp</a><li><a href=https://lifailon.github.io/linux/#sshpass>sshpass</a></ul><li><a href=https://lifailon.github.io/linux/#sudoers>sudoers</a><li><a href=https://lifailon.github.io/linux/#strace>strace</a><li><a href=https://lifailon.github.io/linux/#apt>apt</a><li><a href=https://lifailon.github.io/linux/#snap>snap</a><li><a href=https://lifailon.github.io/linux/#dpkg>dpkg</a><li><a href=https://lifailon.github.io/linux/#ntp>ntp</a><ul><li><a href=https://lifailon.github.io/linux/#time>time</a><li><a href=https://lifailon.github.io/linux/#language>language</a><li><a href=https://lifailon.github.io/linux/#timesyncd>timesyncd</a><li><a href=https://lifailon.github.io/linux/#ntpd>ntpd</a></ul><li><a href=https://lifailon.github.io/linux/#top>top</a><ul><li><a href=https://lifailon.github.io/linux/#htop>htop</a><li><a href=https://lifailon.github.io/linux/#bpytop>bpytop</a><li><a href=https://lifailon.github.io/linux/#atop>atop</a><li><a href=https://lifailon.github.io/linux/#iftop>iftop</a><li><a href=https://lifailon.github.io/linux/#iotop>iotop</a><li><a href=https://lifailon.github.io/linux/#top-other>top other</a></ul><li><a href=https://lifailon.github.io/linux/#ps>ps</a><ul><li><a href=https://lifailon.github.io/linux/#kill>kill</a><li><a href=https://lifailon.github.io/linux/#procs>procs</a></ul><li><a href=https://lifailon.github.io/linux/#jobs>jobs</a><ul><li><a href=https://lifailon.github.io/linux/#nohub>nohub</a></ul><li><a href=https://lifailon.github.io/linux/#mem>mem</a><ul><li><a href=https://lifailon.github.io/linux/#fincore>fincore</a><li><a href=https://lifailon.github.io/linux/#lspage>lspage</a></ul><li><a href=https://lifailon.github.io/linux/#lsof>lsof</a><ul><li><a href=https://lifailon.github.io/linux/#descriptor>descriptor</a></ul><li><a href=https://lifailon.github.io/linux/#vmstat>vmstat</a><li><a href=https://lifailon.github.io/linux/#sysstat>sysstat</a><ul><li><a href=https://lifailon.github.io/linux/#iostat>iostat</a><li><a href=https://lifailon.github.io/linux/#mpstat>mpstat</a><li><a href=https://lifailon.github.io/linux/#pidstat>pidstat</a></ul><li><a href=https://lifailon.github.io/linux/#stress>stress</a><ul><li><a href=https://lifailon.github.io/linux/#stress-ng>stress-ng</a></ul><li><a href=https://lifailon.github.io/linux/#smart>smart</a><ul><li><a href=https://lifailon.github.io/linux/#smartmontools>smartmontools</a><li><a href=https://lifailon.github.io/linux/#sensors>sensors</a><li><a href=https://lifailon.github.io/linux/#badblocks>badblocks</a><li><a href=https://lifailon.github.io/linux/#hdparm>hdparm</a></ul><li><a href=https://lifailon.github.io/linux/#disk>disk</a><ul><li><a href=https://lifailon.github.io/linux/#parted>parted</a><li><a href=https://lifailon.github.io/linux/#fdisk>fdisk</a><li><a href=https://lifailon.github.io/linux/#sfdisk>sfdisk</a><li><a href=https://lifailon.github.io/linux/#swap>swap</a></ul><li><a href=https://lifailon.github.io/linux/#lvm>lvm</a><li><a href=https://lifailon.github.io/linux/#md>md</a><li><a href=https://lifailon.github.io/linux/#tgt>tgt</a><li><a href=https://lifailon.github.io/linux/#dd>dd</a><ul><li><a href=https://lifailon.github.io/linux/#backup>backup</a><li><a href=https://lifailon.github.io/linux/#iso>iso</a><li><a href=https://lifailon.github.io/linux/#rdiff>rdiff</a></ul><li><a href=https://lifailon.github.io/linux/#users>users</a><ul><li><a href=https://lifailon.github.io/linux/#passwd>passwd</a><li><a href=https://lifailon.github.io/linux/#chage>chage</a><li><a href=https://lifailon.github.io/linux/#id>id</a><li><a href=https://lifailon.github.io/linux/#usermod>usermod</a><li><a href=https://lifailon.github.io/linux/#profile>profile</a><li><a href=https://lifailon.github.io/linux/#bashrc-1>bashrc</a><li><a href=https://lifailon.github.io/linux/#useradd>useradd</a><li><a href=https://lifailon.github.io/linux/#adduser>adduser</a></ul><li><a href=https://lifailon.github.io/linux/#chmod>chmod</a><ul><li><a href=https://lifailon.github.io/linux/#chown>chown</a><li><a href=https://lifailon.github.io/linux/#groups>groups</a><li><a href=https://lifailon.github.io/linux/#usermod-1>usermod</a></ul><li><a href=https://lifailon.github.io/linux/#domain>domain</a><ul><li><a href=https://lifailon.github.io/linux/#realmd>realmd</a><li><a href=https://lifailon.github.io/linux/#sssd>sssd</a></ul><li><a href=https://lifailon.github.io/linux/#syslog>syslog</a><ul><li><a href=https://lifailon.github.io/linux/#server>server</a><li><a href=https://lifailon.github.io/linux/#client>client</a><li><a href=https://lifailon.github.io/linux/#zabbix-agent>zabbix-agent</a><li><a href=https://lifailon.github.io/linux/#ommail>ommail</a></ul><li><a href=https://lifailon.github.io/linux/#logrotate>logrotate</a><li><a href=https://lifailon.github.io/linux/#log>log</a><li><a href=https://lifailon.github.io/linux/#smb>smb</a><ul><li><a href=https://lifailon.github.io/linux/#cifs>cifs</a><li><a href=https://lifailon.github.io/linux/#samba>samba</a><li><a href=https://lifailon.github.io/linux/#client-cifs>client cifs</a><li><a href=https://lifailon.github.io/linux/#client-samba-client>client samba-client</a><li><a href=https://lifailon.github.io/linux/#recycle>recycle</a></ul><li><a href=https://lifailon.github.io/linux/#nfs>nfs</a><ul><li><a href=https://lifailon.github.io/linux/#server-1>server</a><li><a href=https://lifailon.github.io/linux/#client-1>client</a></ul><li><a href=https://lifailon.github.io/linux/#ftp>ftp</a><ul><li><a href=https://lifailon.github.io/linux/#ftp-client>ftp client</a><li><a href=https://lifailon.github.io/linux/#ftps>ftps</a></ul><li><a href=https://lifailon.github.io/linux/#rsync>rsync</a><li><a href=https://lifailon.github.io/linux/#apache>apache</a><ul><li><a href=https://lifailon.github.io/linux/#api-server>api server</a><li><a href=https://lifailon.github.io/linux/#status>status</a><li><a href=https://lifailon.github.io/linux/#webdav>webdav</a></ul><li><a href=https://lifailon.github.io/linux/#haproxy>haproxy</a><li><a href=https://lifailon.github.io/linux/#keepalive>keepalive</a></ul></div></div><main id=main-content><div id=buttons-container><a title="Go to Top" href=#top id=go-to-top><i class=icon></i></a></div><h1>Linux</h1><p align=center><a href=https://github.com/Lifailon/PS-Commands/blob/rsa/linux.md><img title="Linux Commands Logo" src=Linux-Commands-Logo.png></a><p align=center>Заметки по работе с системными командами и консольными утилитами 🐧 <b>Linux</b>.<hr><h2 id=bash><a aria-label="Anchor link for: bash" class=zola-anchor href=#bash><i class=icon></i></a> bash</h2><ul><li>Переменные</ul><p><code>text="(ip a)"</code> передает текст <br> <code>echo $text</code> <br> <code>ipaddr=$(ip a)</code> передает вывод команды <br> <code>echo $ipaddr</code> <br> <code>echo '$ipaddr'</code> в одинарных кавычках не происходит подстановка переменных <br> <code>var=$((5+5))</code> <br> <code>echo $var</code> <br> <code>read -p "Enter: " enter</code> ручной ввод переменной <code>echo $enter</code> <br> <code>read -s -p "Enter password: " pass</code> ввод пароля <br> <code>echo $pass</code> <br> <code>echo -e "text\ntext"</code> экранирование <br> <code>echo -e "# comment\nparam comment" > ~/test.txt</code> записать в файл <br> <code>cat ~/test.txt | grep -v "^#"</code> прочитать без комментариев в начале строки<p><code>original_value="Это длинная строка, которую нужно сократить до 50 символов."</code> <br> <code>shortened_value="${original_value:0:50}"</code> обрезаем до 50 символов<p><code>true ; echo $?</code> код возврата 0 (успех) <br> <code>false ; echo $?</code> код возврата 1 (ошибка)<ul><li>Массивы</ul><p><code>range={1..254}</code> создать срез от 1 до 254 <br> <code>array=(1 2 3 4 5)</code> создать массив <br> <code>array=($(ls /))</code> передает вывод команды <code>$(command)</code> разделенных через пробел <br> <code>echo ${array[@]}</code> отобразить содержимое всего массива <code>@/*</code> <br> <code>echo ${array[0]}</code> отобразить первый индекс в массиве <br> <code>echo ${array[-1]}</code> отобразить последний индекс <br> <code>echo ${array[@]:1:3}</code> вывести 3 элемента (срез) <br> <code>echo ${#array[@]}</code> отобразить кол-во (<code>#</code>) элементов в массиве <br> <code>echo ${#array[0]}</code> отобразить длинну (<code>#</code>) первого элемента в массиве <br> <code>array[1]="22"</code> изменить значение по номеру индекса<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-storage z-modifier z-shell">declare</span> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>A</span> <span class="z-variable z-other z-readwrite z-assignment z-shell">dict</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell">    <span class="z-punctuation z-section z-brackets z-begin z-shell">[</span><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>key 1<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span><span class="z-punctuation z-section z-brackets z-end z-shell">]</span><span class="z-keyword z-operator z-assignment z-shell">=</span>1
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell">    <span class="z-punctuation z-section z-brackets z-begin z-shell">[</span><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>key 2<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span><span class="z-punctuation z-section z-brackets z-end z-shell">]</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>text<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-expansion z-parameter z-begin z-shell">{</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-variable z-other z-readwrite z-shell">dict<span class="z-punctuation z-section z-braces z-begin z-shell">[</span>key <span class="z-constant z-numeric z-integer z-decimal z-shell">1</span><span class="z-punctuation z-section z-braces z-end z-shell">]</span></span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-section z-expansion z-parameter z-end z-shell">}</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-expansion z-parameter z-begin z-shell">{</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-variable z-other z-readwrite z-shell">dict<span class="z-punctuation z-section z-braces z-begin z-shell">[</span>key <span class="z-constant z-numeric z-integer z-decimal z-shell">2</span><span class="z-punctuation z-section z-braces z-end z-shell">]</span></span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-section z-expansion z-parameter z-end z-shell">}</span></span></span>
</span></code></pre><ul><li>Цикл for</ul><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-loop z-for z-shell">for</span><span class="z-meta z-group z-for z-shell"> <span class="z-meta z-group z-arithmetic z-shell"><span class="z-punctuation z-section z-arithmetic z-begin z-shell">((</span>i<span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-constant z-numeric z-integer z-decimal z-shell">1</span><span class="z-punctuation z-separator z-shell">;</span> i <span class="z-keyword z-operator z-logical z-shell"><=</span> <span class="z-constant z-numeric z-integer z-decimal z-shell">10</span><span class="z-punctuation z-separator z-shell">;</span> i<span class="z-keyword z-operator z-arithmetic z-shell">++</span><span class="z-punctuation z-section z-arithmetic z-end z-shell">))</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-loop z-do z-shell">do</span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">i</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-loop z-end z-shell">done</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">array</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ls</span></span><span class="z-meta z-function-call z-arguments z-shell"> /</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-loop z-for z-shell">for</span><span class="z-meta z-group z-for z-shell"> arr <span class="z-keyword z-control z-in z-shell">in</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-expansion z-parameter z-begin z-shell">{</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-variable z-other z-readwrite z-shell">array<span class="z-punctuation z-section z-braces z-begin z-shell">[</span><span class="z-variable z-language z-array z-shell">@</span><span class="z-punctuation z-section z-braces z-end z-shell">]</span></span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-section z-expansion z-parameter z-end z-shell">}</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-loop z-do z-shell">do</span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">arr</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-loop z-end z-shell">done</span>
</span></code></pre><p><code>break</code> прерывает цикл <br> <code>continue</code> прерывает текущую интерацию в цикле и переходит к следующей<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">array</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span>1 2 3 4 5<span class="z-punctuation z-section z-parens z-end z-shell">)</span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-loop z-for z-shell">for</span><span class="z-meta z-group z-for z-shell"> var <span class="z-keyword z-control z-in z-shell">in</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-expansion z-parameter z-begin z-shell">{</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-variable z-other z-readwrite z-shell">array<span class="z-punctuation z-section z-braces z-begin z-shell">[</span><span class="z-variable z-language z-array z-shell">@</span><span class="z-punctuation z-section z-braces z-end z-shell">]</span></span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-section z-expansion z-parameter z-end z-shell">}</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-loop z-do z-shell">do</span>
</span><span class="z-source z-shell z-bash">    <span class="z-keyword z-control z-conditional z-if z-shell">if</span> <span class="z-support z-function z-test z-begin z-shell">[</span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">var</span></span> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>gt</span> 4 <span class="z-support z-function z-test z-end z-shell">]</span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-conditional z-then z-shell">then</span>
</span><span class="z-source z-shell z-bash">        <span class="z-keyword z-control z-flow z-break z-shell">break</span>
</span><span class="z-source z-shell z-bash">    <span class="z-keyword z-control z-conditional z-elseif z-shell">elif</span> <span class="z-support z-function z-test z-begin z-shell">[</span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">var</span></span> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>gt</span> 3 <span class="z-support z-function z-test z-end z-shell">]</span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-conditional z-then z-shell">then</span>
</span><span class="z-source z-shell z-bash">        <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>Last number: <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">var</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash">        <span class="z-keyword z-control z-flow z-continue z-shell">continue</span>
</span><span class="z-source z-shell z-bash">    <span class="z-keyword z-control z-conditional z-end z-shell">fi</span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>Number: <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">var</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-loop z-end z-shell">done</span>
</span></code></pre><ul><li>Цикл while</ul><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">p</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell">1</span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-loop z-while z-shell">while</span> <span class="z-support z-function z-test z-begin z-shell">[</span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">p</span></span> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>le</span> 101 <span class="z-support z-function z-test z-end z-shell">]</span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-loop z-do z-shell">do</span>
</span><span class="z-source z-shell z-bash">    <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> если условие истинно, выполнять цикл в блоке do, пока не станет ложным</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>Значение переменной: <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">p</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> ((p++)) # увеличить на +1</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash">    <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> p=$(($p+10)) # прибавлять +10</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash">    <span class="z-variable z-other z-readwrite z-assignment z-shell">p</span><span class="z-keyword z-operator z-assignment z-shell">+=</span><span class="z-string z-unquoted z-shell">0</span> <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> добавить текст в конец переменной</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-loop z-end z-shell">done</span>
</span></code></pre><ul><li>Построчная передача вывода через pipe</ul><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">num</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell">0</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ps</span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sed</span></span><span class="z-meta z-function-call z-arguments z-shell"> 1d</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-keyword z-control z-loop z-while z-shell">while</span> <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-read z-shell">read</span></span><span class="z-meta z-function-call z-arguments z-shell"> line</span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-loop z-do z-shell">do</span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-group z-arithmetic z-shell"><span class="z-punctuation z-section z-arithmetic z-begin z-shell">((</span>num<span class="z-keyword z-operator z-arithmetic z-shell">++</span><span class="z-punctuation z-section z-arithmetic z-end z-shell">))</span></span> <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> ((num+=1))</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>Line <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">num</span></span> : <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">line</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-loop z-end z-shell">done</span>
</span></code></pre><ul><li>Условия</ul><p><code>if []</code> если <br> <code>then</code> условие истинно <br> <code>elif []</code> дополнительное условие <br> <code>then</code> дополнительное условие истинно <br> <code>else</code> условие ложно <br> <code>fi</code> больше нет условий<p><code>-z</code> строка пуста <br> <code>-n</code> строка не пуста <br> <code>=, (==)</code> строки равны <br> <code>!=</code> строки неравны <br> <code>-eq</code> равно <br> <code>-ne</code> неравно <br> <code>-lt, (<)</code> меньше <br> <code>-le, (<=)</code> меньше или равно <br> <code>-gt, (>)</code> больше <br> <code>-ge, (>=)</code> больше или равно <br> <code>!</code> отрицание логического выражения <br> <code>-a, (&&)</code> логическое «и» (первая команда исполняется всегда, вторая — только в случае успешного завершения первой) <br> <code>-o, (||)</code> логическое «или» (первая команда исполняется всегда, вторая — только в случае неудачного завершения первой)<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-conditional z-if z-shell">if</span> <span class="z-meta z-function-call z-arguments z-shell"><span class="z-support z-function z-double-brace z-begin z-shell">[[</span> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>z</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">variable</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-support z-function z-double-brace z-end z-shell">]]</span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-conditional z-then z-shell">then</span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>Переменная пустая<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-conditional z-else z-shell">else</span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>Переменная не пустая<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-conditional z-end z-shell">fi</span>
</span></code></pre><ul><li>Функции</ul><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-storage z-type z-function z-shell">function</span> <span class="z-entity z-name z-function z-shell">calc</span> <span class="z-punctuation z-section z-braces z-begin z-shell">{</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-keyword z-control z-conditional z-if z-shell">if</span> <span class="z-support z-function z-test z-begin z-shell">[</span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">2</span></span> <span class="z-keyword z-operator z-logical z-shell">=</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>+<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-support z-function z-test z-end z-shell">]</span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">        <span class="z-keyword z-control z-conditional z-then z-shell">then</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">        <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-arithmetic z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">((</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">1</span></span> <span class="z-keyword z-operator z-arithmetic z-shell">+</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">3</span></span> <span class="z-punctuation z-section z-parens z-end z-shell">))</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-keyword z-control z-conditional z-elseif z-shell">elif</span> <span class="z-support z-function z-test z-begin z-shell">[</span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">2</span></span> <span class="z-keyword z-operator z-logical z-shell">=</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>-<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-support z-function z-test z-end z-shell">]</span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">        <span class="z-keyword z-control z-conditional z-then z-shell">then</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">        <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-arithmetic z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">((</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">1</span></span> <span class="z-keyword z-operator z-arithmetic z-shell">-</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">3</span></span> <span class="z-punctuation z-section z-parens z-end z-shell">))</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-keyword z-control z-conditional z-end z-shell">fi</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-punctuation z-section z-braces z-end z-shell">}</span></span>
</span></code></pre><p><code>calc 3 + 2</code> <br> <code>calc 3 - 2</code><ul><li>Параметры</ul><p><code>nano script.sh</code><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell">!/bin/bash</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-conditional z-if z-shell">if</span> <span class="z-support z-function z-test z-begin z-shell">[</span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>n</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">1</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>a</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">2</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-support z-function z-test z-end z-shell">]</span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-conditional z-then z-shell">then</span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> Имя исполняемого файла: <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">0</span></span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> Первый переданный параметр: <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">1</span></span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> Второй переданный параметр <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">2</span></span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> Кол-во переданных параметров: <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-language z-shell">#</span></span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> Значение последнего переданного параметра: <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-expansion z-parameter z-begin z-shell">{</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-keyword z-operator z-indirection z-shell">!</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-variable z-other z-readwrite z-shell">#</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-section z-expansion z-parameter z-end z-shell">}</span></span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> Массив: <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-language z-shell">@</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-conditional z-else z-shell">else</span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>Параметры не заданы<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-conditional z-end z-shell">fi</span>
</span></code></pre><p><code>chmod +x script.sh</code> сделать скрипт исполняемым <br> <code>bash script.sh 1 2 3 4 5</code> передать параметры в скрипт<p><code>-e file</code> проверяет, существует ли файл <br> <code>-d file</code> проверяет, существует ли файл, и является ли он директорией <br> <code>-f file</code> проверяет, существует ли файл, и является ли он файлом <br> <code>-r file</code> проверяет, существует ли файл, и доступен ли он для чтения <br> <code>-w file</code> проверяет, существует ли файл, и доступен ли он для записи <br> <code>-x file</code> проверяет, существует ли файл, и является ли он исполняемым <br> <code>-s file</code> проверяет, существует ли файл, и не является ли он пустым<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Получить список директорий и исполняемых файлов в дочерних директориях</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">path</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>/etc/*<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-loop z-for z-shell">for</span><span class="z-meta z-group z-for z-shell"> folder <span class="z-keyword z-control z-in z-shell">in</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">path</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-loop z-do z-shell">do</span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">folder</span></span>:<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-keyword z-control z-loop z-for z-shell">for</span><span class="z-meta z-group z-for z-shell"> file <span class="z-keyword z-control z-in z-shell">in</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">folder</span></span>/<span class="z-keyword z-operator z-regexp z-quantifier z-shell">*</span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-loop z-do z-shell">do</span>
</span><span class="z-source z-shell z-bash">        <span class="z-keyword z-control z-conditional z-if z-shell">if</span> <span class="z-support z-function z-test z-begin z-shell">[</span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>x</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">file</span></span> <span class="z-support z-function z-test z-end z-shell">]</span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-conditional z-then z-shell">then</span>
</span><span class="z-source z-shell z-bash">            <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>- <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">file</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash">        <span class="z-keyword z-control z-conditional z-end z-shell">fi</span>
</span><span class="z-source z-shell z-bash">    <span class="z-keyword z-control z-loop z-end z-shell">done</span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-loop z-end z-shell">done</span>
</span></code></pre><ul><li>case</ul><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-read z-shell">read</span></span><span class="z-meta z-function-call z-arguments z-shell"> -rsn1 key</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-conditional z-case z-shell"><span class="z-keyword z-control z-conditional z-case z-shell">case</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">key</span></span> <span class="z-keyword z-control z-in z-shell">in</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-conditional z-case z-shell">  </span><span class="z-meta z-conditional z-case z-clause z-patterns z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>1<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span><span class="z-meta z-conditional z-case z-shell"><span class="z-keyword z-control z-conditional z-patterns z-end z-shell">)</span></span></span><span class="z-meta z-conditional z-case z-clause z-commands z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-conditional z-case z-clause z-commands z-shell">    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> выполнить действия, если <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">key</span></span> равно 1</span> </span><span class="z-meta z-conditional z-case z-clause z-commands z-shell"><span class="z-punctuation z-terminator z-case z-clause z-shell">;;</span></span><span class="z-meta z-conditional z-case z-clause z-patterns z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-conditional z-case z-clause z-patterns z-shell">  </span><span class="z-meta z-conditional z-case z-clause z-patterns z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>2<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span><span class="z-meta z-conditional z-case z-clause z-patterns z-shell"><span class="z-keyword z-control z-conditional z-patterns z-end z-shell">)</span></span></span><span class="z-meta z-conditional z-case z-clause z-commands z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-conditional z-case z-clause z-commands z-shell">    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> выполнить действия, если <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">key</span></span> равно 2</span> </span><span class="z-meta z-conditional z-case z-clause z-commands z-shell"><span class="z-punctuation z-terminator z-case z-clause z-shell">;;</span></span><span class="z-meta z-conditional z-case z-clause z-patterns z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-conditional z-case z-clause z-patterns z-shell">  </span><span class="z-meta z-conditional z-case z-clause z-patterns z-shell"><span class="z-keyword z-operator z-regexp z-quantifier z-shell">*</span><span class="z-meta z-conditional z-case z-clause z-patterns z-shell"><span class="z-keyword z-control z-conditional z-patterns z-end z-shell">)</span></span></span><span class="z-meta z-conditional z-case z-clause z-commands z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-conditional z-case z-clause z-commands z-shell">    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> выполнить действия по умолчанию, если значение <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">key</span></span> не соответствует ни одному условию</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-conditional z-case z-clause z-commands z-shell">  </span><span class="z-meta z-conditional z-case z-clause z-commands z-shell"><span class="z-punctuation z-terminator z-case z-clause z-shell">;;</span></span><span class="z-meta z-conditional z-case z-clause z-patterns z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-conditional z-case z-clause z-patterns z-shell"><span class="z-keyword z-control z-conditional z-end z-shell">esac</span></span>
</span></code></pre><h2 id=filesystem><a aria-label="Anchor link for: filesystem" class=zola-anchor href=#filesystem><i class=icon></i></a> filesystem</h2><p><code>file Console-Performance.sh</code> узнать тип файла (текстовый, исполняемый файл, архив или другой) <br> <code>stat Console-Performance.sh</code> узнать размер файла, количество блоков, занятых файлом на диске, количество жестких ссылок, права доступа и временные метки <br> <code>pwd</code> текущая директория <br> <code>ls -lh *</code> отобразить содержимое каждого подкаталога отдельно <br> <code>ls -lhaF</code> отобразить скрытые директории (-a) с точкой и выделит директории (/) <br> <code>which top</code> узнать путь до исполняемого файла <br> <code>stat $(which top)</code> узнать дату последнего доступа к файлу <br> <code>cat -n /etc/passwd</code> просмотр содержимого файла с отображением номеров строк <br> <code>mkdir</code> создать директорию <br> <code>mktemp -d</code> создать временный файл/каталог (-d) <br> <code>touch -t 202106222200.15 test.file</code> создать файл и указать дату создания <br> <code>cp test.file test.file2</code> копировать файла/каталог <br> <code>mv test.file2 test.file3</code> переименовать/переместить файл/каталог <br> <code>rm -r test.file</code> удалить каталог с файлами (-r)<h3 id=ln><a aria-label="Anchor link for: ln" class=zola-anchor href=#ln><i class=icon></i></a> ln</h3><p><code>echo "test" > testfile</code> <br> <code>ln /test/testfile /test/testlink</code> создать жестку (hard) ссылку, которая указывает на один и тот же inode, т.е. они делят одно и то же физическое местоположение на диске <br> <code>rm testfile</code> при удалении одного из файлов не приводит к удалению содержимого, пока существует хотя бы одна жесткая ссылка <br> <code>ln -s /test/testfile /test/testlink</code> создать символическую (-s - soft) ссылку, которая ссылается на файл testfile <br> <code>echo "test" >> testfile</code> при добавлении в оригинальный файл, все изменения будут отражены в testlink <br> <code>rm testfile</code> при удалении исходного файла у ссылки будет ошибка (No such file or directory)<h3 id=zip><a aria-label="Anchor link for: zip" class=zola-anchor href=#zip><i class=icon></i></a> zip</h3><p><code>rar a test.rar filename filename2</code> создать архив test.rar и добавить туда два файла (файлы копируются в архив) <br> <code>unrar x test.rar</code> разархивировать <br> <code>zip -r test.zip filename</code> архивировать (файлы копируются в архив) <br> <code>unzip test.zip</code> разархивировать <br> <code>bzip2 filename</code> архивировать в filename.bz2 (файлы перепещаются в архив) <br> <code>bunzip2 filename.bz2</code> разархивировать <br> <code>gzip filename</code> архивировать в filename.gz (файлы перепещаются в архив) <br> <code>tar --totals -cvf archive.tar file1 file2 file3</code> архивировать три файла <br> <code>wget https://github.com/librespeed/speedtest-cli/releases/download/v1.0.10/librespeed-cli_1.0.10_linux_amd64.tar.gz</code> загрузить архив <br> <code>gunzip librespeed-cli_1.0.10_linux_amd64.tar.gz</code> извлечь из gz в tar <br> <code>tar -tf librespeed-cli_1.0.10_linux_amd64.tar</code> отобразить содержимое архива <br> <code>tar -xvf librespeed-cli_1.0.10_linux_amd64.tar</code> разархивировать <br> <code>./librespeed-cli --help</code> <br> <code>./librespeed-cli --json</code><h3 id=gpg><a aria-label="Anchor link for: gpg" class=zola-anchor href=#gpg><i class=icon></i></a> gpg</h3><p><code>gpg -c filename</code> зашифровать данные <br> <code>gpg filename.gpg</code> расшифровать данные <br> <code>gpg --gen-key</code> создавать пару ключей (публичный и приватный ключи) <br> <code>gpg --export -a 'User Name' > publickey.asc</code> экспорт публичного ключа <br> <code>gpg --import publickey.asc</code> импорт на второй стороне <br> <code>gpg --encrypt --recipient 'Recipient Name' filename</code> зашифровать данные с использованием публичного ключа получателя, только владелец приватного ключа сможет расшифровать эти данные <br> <code>gpg --decrypt encryptedfile.gpg</code> расшифровать данные можно с помощью приватного ключа <br> <code>gpg --sign filename</code> подписывать данные с использованием приватного ключа для подтверждения их подлинности и целостности <br> <code>gpg --verify signedfile.gpg</code> проверка подписи с использованием публичного ключа отправителя<h2 id=api><a aria-label="Anchor link for: api" class=zola-anchor href=#api><i class=icon></i></a> api</h2><h3 id=curl><a aria-label="Anchor link for: curl" class=zola-anchor href=#curl><i class=icon></i></a> curl</h3><p><code>curl ifconfig.me</code> узнать внешний ip <br> <code>curl -v telnet://192.168.3.100:22</code> првоерить доступность порта и отобразить кому он принадлежит <br> <code>curl -s -o /dev/null http://google.com</code> подавить весь вывод (статистику –silent и –output) <br> <code>curl -s -o /dev/null --show-error --fail http://google.com</code> оставить вывод ошибок <br> <code>curl http://192.168.3.101:8081/api/ --connect-timeout 5</code> задать timeout ожидания ответа в секундах <br> <code>curl -IL https://github.com/Lifailon/hwstat/archive/refs/tags/hwstat-0.0.8.zip</code> получить информацию о файле перед скачиванием (–head/–location) <br> <code>curl -O https://raw.githubusercontent.com/Lifailon/hwstat/rsa/hwstat.sh</code> скачать файл <br> <code>curl -o /tmp/hwstat.sh https://raw.githubusercontent.com/Lifailon/hwstat/rsa/hwstat.sh</code> указать путь <br> <code>curl -Ik https://192.168.3.104:9443/</code> игнорировать ошибку самоподписанного сертификата SSL (–insecure) <br> <code>curl -u &LTuser:password> https://test.com/endpoint</code> авторизация <br> <code>curl -x "http://Proxy:Proxy@192.168.3.100:9090" "https://kinozal.tv/rss.xml"</code> использовать Proxy-сервер <br> <code>curl --insecure --ssl-reqd "smtps://smtp.yandex.ru" --mail-from "src@yandex.ru" --mail-rcpt "dst@yandex.ru" --user "src@yandex.ru" --upload-file out.txt</code> отправка email через SMTPS (SMTP over SSL/TLS) сервер<h3 id=influxdb><a aria-label="Anchor link for: influxdb" class=zola-anchor href=#influxdb><i class=icon></i></a> influxdb</h3><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">ip</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>192.168.3.104<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">db</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>dbash<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">table</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>icmp_metrics_table<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">server</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>google.com<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">host</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">hostname</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">date</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">EPOCHREALTIME</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sed</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>E</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>s/\..+//<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>000000000<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">ping</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ping</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">server</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>c</span> 1</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">loss</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-printf z-shell">printf</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>%s\n<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-expansion z-parameter z-begin z-shell">{</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-variable z-other z-readwrite z-shell">ping<span class="z-punctuation z-section z-braces z-begin z-shell">[</span><span class="z-variable z-language z-array z-shell">@</span><span class="z-punctuation z-section z-braces z-end z-shell">]</span></span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-section z-expansion z-parameter z-end z-shell">}</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">grep</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>Eo</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>[0-9]+%<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sed</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>s/%//<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-conditional z-if z-shell">if</span> <span class="z-meta z-group z-arithmetic z-shell"><span class="z-punctuation z-section z-arithmetic z-begin z-shell">((</span> <span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">loss</span></span> != 100<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">bc</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span> <span class="z-punctuation z-section z-arithmetic z-end z-shell">))</span></span><span class="z-meta z-function-call z-shell"></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-conditional z-then z-shell">then</span>
</span><span class="z-source z-shell z-bash">    <span class="z-variable z-other z-readwrite z-assignment z-shell">status</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>true<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-variable z-other z-readwrite z-assignment z-shell">rtt</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-printf z-shell">printf</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>%s\n<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-expansion z-parameter z-begin z-shell">{</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-variable z-other z-readwrite z-shell">ping<span class="z-punctuation z-section z-braces z-begin z-shell">[</span><span class="z-variable z-language z-array z-shell">@</span><span class="z-punctuation z-section z-braces z-end z-shell">]</span></span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-section z-expansion z-parameter z-end z-shell">}</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">grep</span></span><span class="z-meta z-function-call z-arguments z-shell"> rtt</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">awk</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>F</span><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>/<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>{print $5}<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-conditional z-else z-shell">else</span>
</span><span class="z-source z-shell z-bash">    <span class="z-variable z-other z-readwrite z-assignment z-shell">status</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>false<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-variable z-other z-readwrite z-assignment z-shell">rtt</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>0<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-conditional z-end z-shell">fi</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">curl</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>i</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>XPOST</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>http://<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">ip</span></span>:8086/write?db=<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">db</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>data-binary</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">table</span></span>,host=<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">host</span></span>,server=<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">server</span></span> status=<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">status</span></span>,rtt=<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">rtt</span></span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">date</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span></code></pre><h3 id=wget><a aria-label="Anchor link for: wget" class=zola-anchor href=#wget><i class=icon></i></a> wget</h3><p><code>wget --spider https://download.nextcloud.com/server/releases/nextcloud-21.0.1.tar.bz2</code> проверить (–spider) работоспособность URL и узнать размер файла (Length) <br> <code>wget -O nextcloud.tar.bz2 https://download.nextcloud.com/server/releases/nextcloud-21.0.1.tar.bz2</code> скачать с указанным именем (-O) <br> <code>wget -P /tmp https://download.nextcloud.com/server/releases/nextcloud-21.0.1.tar.bz2</code> скачать в указанную директорию (-P) <br> <code>wget -b -o ~/wget.log https://download.nextcloud.com/server/releases/nextcloud-21.0.1.tar.bz2</code> загрузить в фоновом режиме (-b) и записать вывод в лог-файл (-o)<h3 id=curlie><a aria-label="Anchor link for: curlie" class=zola-anchor href=#curlie><i class=icon></i></a> curlie</h3><p><code>curl -sS https://webinstall.dev/curlie | bash</code> альтернатива curl и httpie (https://github.com/rs/curlie) <br> <code>curlie get https://jsonplaceholder.typicode.com/posts</code> возвращает заголовки ответа и отформатированный вывод JSON <br> <code>curlie get https://jsonplaceholder.typicode.com/posts/1</code> <br> <code>curlie get https://jsonplaceholder.typicode.com/posts -H "Authorization: Bearer YOUR_TOKEN"</code> <br> <code>curlie post https://jsonplaceholder.typicode.com/posts -d '{"title": "foo", "body": "bar", "userId": 1}'</code><h3 id=httpie><a aria-label="Anchor link for: httpie" class=zola-anchor href=#httpie><i class=icon></i></a> httpie</h3><p><code>sudo snap install httpie</code> HTTP-клиент командной строки (https://github.com/httpie/cli) <br> <code>https httpie.io/hello</code> <br> <code>https POST pie.dev/post X-API-Token:123 name=John</code><h2 id=json><a aria-label="Anchor link for: json" class=zola-anchor href=#json><i class=icon></i></a> json</h2><h3 id=jq><a aria-label="Anchor link for: jq" class=zola-anchor href=#jq><i class=icon></i></a> jq</h3><p><code>apt install jq</code> установить jq (https://github.com/jqlang/jq) <br> <code>nodes=$(curl -s -H "Accept: application/json" https://check-host.net/nodes/ips)</code> получить список node <br> <code>echo $nodes | jq</code> обработка входных данных командой jq (вывод отображается в правильно структурированном формате, а все элементы подсвечиваются соответствующим цветом) <br> <code>echo $nodes | jq '.nodes | length'</code> количество дочерних объектов в блоке node[] <br> <code>echo $nodes | jq -r .nodes[1]</code> получить значение второго объекта массива в формате raw string (not JSON) <br> <code>echo $nodes | jq -r .nodes[-1]</code> получить значение последнего объекта массива <br> <code>hosts=$(curl -s -H "Accept: application/json" https://check-host.net/nodes/hosts)</code> получить список всех хостов <br> <code>echo $hosts | jq -r '.nodes | to_entries[].key'</code> получить список всех вложенных ключей (адреса хостов) из объека (не является массивом) <br> <code>echo $hosts | jq -r '.nodes | to_entries[].value'</code> получить только значения всех вложанных ключей <br> <code>echo $hosts | jq '.nodes."bg1.node.check-host.net"'</code> получить значение дочернего ключа nodes по имени <br> <code>echo $hosts | jq '.nodes | [.[]] | last'</code> преобразовать отдельные объекты внутри nodes в массив, и передать полученный вывод в функцию last для получения значений последнего объекта <br> <code>echo $hosts | jq '.nodes | to_entries[].value.location[0] == "ru"'</code> проверить каждый элемент объекта в условии на true/false (вернет массив) <br> <code>echo $hosts | jq '.nodes | to_entries[] | {Host: .key, Country: .value.location[1], City: .value.location[2]}'</code> получить данные key-value из объекта nodes и пересобрать массив с новыми значениями ключей <br> <code>echo $hosts | jq -r '.nodes | to_entries[] | "\(.key) (\(.value.location[1]), \(.value.location[2]))"'</code> собрать массив строки из содержимого ключей <br> <code>var="-" && echo $hosts | jq --arg v "$var" -r '.nodes | to_entries[] | "\(.key) \($v) \(.value.location[1]) \($v) \(.value.location[2])"'</code> передать внешнюю переменную, которая будет использоваться внутри запроса <br> <code>echo $hosts | jq -r '.nodes | to_entries[] | select(.value.location[0] == "ru") | .key'</code> произвести фильтрацию (select), что бы получить только нужные объекты <br> <code>echo $hosts | jq '.nodes | to_entries[] | select(.value.location[0] != "ru") | .key'</code> вывести объекты, которые не равны значению <br> <code>echo $hosts | jq '.nodes | length'</code> вывести общее количество объектов <br> <code>echo $hosts | jq '.nodes | to_entries | map(select(.value.location[0] != "ru")) | length'</code> создать массив функцией map() (объеденяет отдельные объекты {}{} группируются в один массив [{},{}]) только из тех объектов, которые соответствуют условию select() и вывести количество найденных объектов <br> <code>echo $hosts | jq -r '.nodes | to_entries[] | select(.value.location[0] == "ru" or .value.location[0] == "tr") | .key'</code> проверить два условия через or или and (для проверяемого типа данных int кавычки не используются) <br> <code>echo $hosts | jq -r '.nodes | to_entries[] | select(.key | index("jp")) | .key'</code> вывести список хостов региона Japan, которые в названии ключа содержат ключевое слово jp (частичное совпадение в значении)<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">host</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>yandex.ru<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">protocol</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>ping<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">host</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>yandex.ru:443<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">protocol</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>tcp<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span> <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> udp/http/dns</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Забрать id для получения результатов</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">check_id</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">curl</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>s</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>H</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>Accept: application/json<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>https://check-host.net/check-<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">protocol</span></span>?host=<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">host</span></span>&max_nodes=3<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">jq</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>r</span> .request_id</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Функция получения результатов проверки по id</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-storage z-type z-function z-shell">function</span> <span class="z-entity z-name z-function z-shell">check-result</span> <span class="z-punctuation z-section z-braces z-begin z-shell">{</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">curl</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>s</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>H</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>Accept: application/json<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> https://check-host.net/check-result/<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">1</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">jq</span></span><span class="z-meta z-function-call z-arguments z-shell"> .</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-punctuation z-section z-braces z-end z-shell">}</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Получить суммарное количество хостов, с которых производится проверка</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">hosts_length</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">check-result</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">check_id</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">jq</span></span><span class="z-meta z-function-call z-arguments z-shell"> length</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-loop z-while z-shell">while</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">true</span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-loop z-do z-shell">do</span>
</span><span class="z-source z-shell z-bash">    <span class="z-variable z-other z-readwrite z-assignment z-shell">check_result</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">check-result</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">check_id</span></span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Забираем результат и проверем, что содержимое всех проверок не равны null</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash">    <span class="z-variable z-other z-readwrite z-assignment z-shell">check_values_not_null</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">check_result</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">jq</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>e</span> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>to_entries | map(select(.value != null)) | length<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-keyword z-control z-conditional z-if z-shell">if</span> <span class="z-meta z-function-call z-arguments z-shell"><span class="z-support z-function z-double-brace z-begin z-shell">[[</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">check_values_not_null</span></span> <span class="z-keyword z-operator z-logical z-shell">==</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">hosts_length</span></span> <span class="z-support z-function z-double-brace z-end z-shell">]]</span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-conditional z-then z-shell">then</span>
</span><span class="z-source z-shell z-bash">        <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">check_result</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">jq</span></span>
</span><span class="z-source z-shell z-bash">        <span class="z-keyword z-control z-flow z-break z-shell">break</span>
</span><span class="z-source z-shell z-bash">    <span class="z-keyword z-control z-conditional z-end z-shell">fi</span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sleep</span></span><span class="z-meta z-function-call z-arguments z-shell"> 1</span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-loop z-end z-shell">done</span>
</span></code></pre><p><code>echo '{"iso": [{"name": "Ubuntu", "size": 4253212899}, {"name": "Debian", "size": 3221225472}]}' | jq '.iso[] | {name: .name, size: (.size / 1024 / 1024 / 1024 | tonumber * 100 | floor / 100 | tostring + " GB")}'</code> получить ГБ из байт и округлить вывод до 2 символом после запятой <br> <code>echo '{"iso": [{"name": "Ubuntu", "progress": 0.333}]}' | jq '.iso[] | {name: .name, progress: (.progress * 100 | floor / 100 * 100 | tostring + " %")}'</code> получить процент из дробной части (33%) <br> <code>echo '[{"name": "Ubuntu", "added_on": 1625072400}, {"name": "Debian", "added_on": 1625158800}]' | jq '.[] | {name: .name, date: (.added_on + 3 * 3600 | strftime("%H:%M:%S %d.%m.%Y"))}'</code> получить дату<h3 id=netcheck><a aria-label="Anchor link for: netcheck" class=zola-anchor href=#netcheck><i class=icon></i></a> netcheck</h3><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> curl<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>s</span> https://raw.githubusercontent.com/Lifailon/Check-Host/rsa/netcheck/netcheck.sh<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>o</span> /usr/bin/netcheck</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> chmod +x /usr/bin/netcheck</span>
</span></code></pre><p><code>netcheck -t ping yandex.ru</code> <br> <code>netcheck -n</code> <br> <code>netcheck -t ping yandex.ru ru1.node.check-host.net</code> <br> <code>netcheck -t dns yandex.ru</code> <br> <code>netcheck -t http yandex.ru:443 5</code> <br> <code>netcheck -t tcp yandex.ru:443</code><h3 id=jc><a aria-label="Anchor link for: jc" class=zola-anchor href=#jc><i class=icon></i></a> jc</h3><p><code>apt install jc</code> установить jc (https://github.com/kellyjonbrazil/jc) для преобразования вывода популярных инструментов командной строки, типов файлов и общих строк в JSON, YAML или словари Python, что позволяет передавать вывод в инструменты, такие как jq <br> <code>dig google.com | jc --dig</code> <br> <code>dig example.com | jc --dig | jq -r '.[].answer[].data'</code> <br> <code>jc --pretty /proc/meminfo</code> <br> <code>systemctl list-units --all --plain --no-legend --no-pager | jc --systemctl -p</code><h3 id=brew><a aria-label="Anchor link for: brew" class=zola-anchor href=#brew><i class=icon></i></a> brew</h3><p><code>/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"</code> установить менеджер пакетов brew (https://github.com/Homebrew/brew) для macOS/Linux <br> <code>echo 'eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"' >> ~/.profile</code> <br> <code>eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"</code> <br> <code>brew --version</code><h3 id=fx><a aria-label="Anchor link for: fx" class=zola-anchor href=#fx><i class=icon></i></a> fx</h3><p><code>brew install fx || snap install fx</code> установить fx (https://github.com/antonmedv/fx) TUI интерфейс для JSON на GoLang <br> <code>hosts=$(curl -s -H "Accept: application/json" https://check-host.net/nodes/hosts)</code> <br> <code>echo $hosts | fx</code> доступна навигация с раскрытием блоков и отображает ключи доступа для jq <br> <code>source <(fx --comp bash)</code> добавить autocomplete в интерпритатор bash <br> <code>echo $hosts > hosts.json</code> <br> <code>fx hosts.json .nodes .\[\"ru1.node.check-host.net\"\] .ip</code> происходит автоматический вывод ключей и подстановка<h3 id=jid><a aria-label="Anchor link for: jid" class=zola-anchor href=#jid><i class=icon></i></a> jid</h3><p><code>brew install jid</code> установить jid (https://github.com/simeji/jid) для интерактивной фильтрации JSON данных с использованием автозавершения на GoLang <br> <code>echo '{"info":{"date":"2016-10-23","version":1.0},"users":[{"name":"simeji","uri":"https://github.com/simeji","id":1},{"name":"simeji2","uri":"https://example.com/simeji","id":2},{"name":"simeji3","uri":"https://example.com/simeji3","id":3}],"userCount":3}}' | jid</code> .users[1].uri<h3 id=jqp><a aria-label="Anchor link for: jqp" class=zola-anchor href=#jqp><i class=icon></i></a> jqp</h3><p><code>brew install noahgorstein/tap/jqp</code> установить jqp (https://github.com/noahgorstein/jqp) TUI интерфейс для отображения jq запросов на GoLang <br> <code>curl -s https://api.github.com/repos/Lifailon/PS-Commands/contents | jqp</code> слева отображается исходный файл, справа отфильтрованный вывод <br> <code>curl -s https://check-host.net/nodes/hosts | jqp</code> # пример для фильтрации: <code>.nodes | to_entries[] | select(.value.location[0] == "ru") | .key</code><h3 id=xmllint><a aria-label="Anchor link for: xmllint" class=zola-anchor href=#xmllint><i class=icon></i></a> xmllint</h3><p><code>apt-get install libxml2-utils || snap install libxml2 || brew install libxml2</code> <br> <code>curl -s https://kinozal.tv/rss.xml -x kinozal:proxy@192.168.3.100:9090 | xmllint --xpath '//rss/channel/item/link/text()' -</code> <br> <code>curl -s https://kinozal.tv/rss.xml -x kinozal:proxy@192.168.3.100:9090 | xmllint --xpath '//rss/channel/item[1]/link/text()' -</code><h3 id=dasel><a aria-label="Anchor link for: dasel" class=zola-anchor href=#dasel><i class=icon></i></a> dasel</h3><p><code>brew install dasel</code> установить dasel (https://github.com/TomWright/dasel) для обработки JSON, YAML, TOML, XML и CSV (поддерживает преобразование между форматами) на GoLang <br> <code>echo '{"name": "Tom"}' | dasel -r json 'name'</code> <br> <code>echo '{"name": "Tom"}' | dasel -r json -w yaml</code> конвертировать json в yaml <br> <code>echo '{"name": "Tom"}' | dasel -r json -w xml</code> конвертировать json в xml <br> <code>echo '{"name": "Tom"}' | dasel put -r json -t string -v 'contact@tomwright.me' 'email'</code> добавить свойство <br> <code>echo '{"email": "contact@tomwright.me","name": "Tom"}' | dasel delete -r json '.email'</code> удалить свойство<pre class="language-json z-code" data-lang=json><code class=language-json data-lang=json><span class="z-source z-json">tee users.json <&LTEOF
</span><span class="z-source z-json"><span class="z-meta z-mapping z-json"><span class="z-punctuation z-section z-mapping z-begin z-json">{</span>
</span></span><span class="z-source z-json"><span class="z-meta z-mapping z-json">    </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>users<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-sequence z-json"><span class="z-punctuation z-section z-sequence z-begin z-json">[</span>
</span></span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-sequence z-json">      <span class="z-meta z-mapping z-json"><span class="z-punctuation z-section z-mapping z-begin z-json">{</span>
</span></span></span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-sequence z-json"><span class="z-meta z-mapping z-json">        </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>name<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>Иван Иванов<span class="z-punctuation z-definition z-string z-end z-json">"</span></span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
</span></span></span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-sequence z-json"><span class="z-meta z-mapping z-value z-json">        </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>email<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>ivan.ivanov@example.com<span class="z-punctuation z-definition z-string z-end z-json">"</span></span>
</span></span></span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-sequence z-json"><span class="z-meta z-mapping z-value z-json">      <span class="z-punctuation z-section z-mapping z-end z-json">}</span></span><span class="z-punctuation z-separator z-sequence z-json">,</span>
</span></span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-sequence z-json">      <span class="z-meta z-mapping z-json"><span class="z-punctuation z-section z-mapping z-begin z-json">{</span>
</span></span></span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-sequence z-json"><span class="z-meta z-mapping z-json">        </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>name<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>Мария Петрова<span class="z-punctuation z-definition z-string z-end z-json">"</span></span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
</span></span></span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-sequence z-json"><span class="z-meta z-mapping z-value z-json">        </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>email<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>maria.petrova@example.com<span class="z-punctuation z-definition z-string z-end z-json">"</span></span>
</span></span></span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-sequence z-json"><span class="z-meta z-mapping z-value z-json">      <span class="z-punctuation z-section z-mapping z-end z-json">}</span></span>
</span></span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-sequence z-json">    <span class="z-punctuation z-section z-sequence z-end z-json">]</span></span>
</span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-section z-mapping z-end z-json">}</span></span>
</span><span class="z-source z-json">EOF
</span></code></pre><p><code>dasel -f users.json -r json ".users.[0].email"</code><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">tee users.yaml <&LTEOF</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">users</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Иван Иванов</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">email</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ivan.ivanov@example.com</span>
</span><span class="z-source z-yaml">  <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Мария Петрова</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">email</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">maria.petrova@example.com</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml">EOF</span>
</span></code></pre><p><code>dasel -f users.yaml -r yaml ".users.[1].email"</code><pre class="language-toml z-code" data-lang=toml><code class=language-toml data-lang=toml><span class="z-source z-toml"><span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">tee</span><span class="z-invalid z-illegal z-key z-toml"> </span><span class="z-entity z-name z-tag z-toml">users</span><span class="z-punctuation z-separator z-key z-toml">.</span><span class="z-entity z-name z-tag z-toml">toml</span><span class="z-invalid z-illegal z-key z-toml"> </span><span class="z-invalid z-illegal z-key z-toml"><</span></span><span class="z-invalid z-illegal z-keyval z-toml">&LTEOF</span>
</span><span class="z-source z-toml"><span class="z-punctuation z-definition z-table z-array z-begin z-toml">[[</span><span class="z-meta z-tag z-table z-array z-toml"><span class="z-entity z-name z-table z-toml">users</span></span><span class="z-punctuation z-definition z-table z-array z-end z-toml">]]</span>
</span><span class="z-source z-toml"><span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">name</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-string z-quoted z-double z-basic z-toml"><span class="z-punctuation z-definition z-string z-begin z-toml">"</span>Иван Иванов<span class="z-punctuation z-definition z-string z-end z-toml">"</span></span>
</span><span class="z-source z-toml"><span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">email</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-string z-quoted z-double z-basic z-toml"><span class="z-punctuation z-definition z-string z-begin z-toml">"</span>ivan.ivanov@example.com<span class="z-punctuation z-definition z-string z-end z-toml">"</span></span>
</span><span class="z-source z-toml"><span class="z-punctuation z-definition z-table z-array z-begin z-toml">[[</span><span class="z-meta z-tag z-table z-array z-toml"><span class="z-entity z-name z-table z-toml">users</span></span><span class="z-punctuation z-definition z-table z-array z-end z-toml">]]</span>
</span><span class="z-source z-toml"><span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">name</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-string z-quoted z-double z-basic z-toml"><span class="z-punctuation z-definition z-string z-begin z-toml">"</span>Мария Петрова<span class="z-punctuation z-definition z-string z-end z-toml">"</span></span>
</span><span class="z-source z-toml"><span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">email</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-string z-quoted z-double z-basic z-toml"><span class="z-punctuation z-definition z-string z-begin z-toml">"</span>maria.petrova@example.com<span class="z-punctuation z-definition z-string z-end z-toml">"</span></span>
</span><span class="z-source z-toml"><span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">EOF</span></span>
</span></code></pre><p><code>dasel -f users.toml -r toml ".users.[1].email"</code><pre class="language-xml z-code" data-lang=xml><code class=language-xml data-lang=xml><span class="z-text z-xml">tee users.xml <span class="z-invalid z-illegal z-missing-entity z-xml"><</span><span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml"><</span><span class="z-entity z-name z-tag z-localname z-xml">EOF</span>
</span></span><span class="z-text z-xml"><span class="z-meta z-tag z-xml"></span><span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml"><</span><span class="z-entity z-name z-tag z-localname z-xml">users</span><span class="z-punctuation z-definition z-tag z-end z-xml">></span></span>
</span><span class="z-text z-xml">  <span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml"><</span><span class="z-entity z-name z-tag z-localname z-xml">user</span><span class="z-punctuation z-definition z-tag z-end z-xml">></span></span>
</span><span class="z-text z-xml">    <span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml"><</span><span class="z-entity z-name z-tag z-localname z-xml">name</span><span class="z-punctuation z-definition z-tag z-end z-xml">></span></span>Иван Иванов<span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml">&LT/</span><span class="z-entity z-name z-tag z-localname z-xml">name</span><span class="z-punctuation z-definition z-tag z-end z-xml">></span></span>
</span><span class="z-text z-xml">    <span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml"><</span><span class="z-entity z-name z-tag z-localname z-xml">email</span><span class="z-punctuation z-definition z-tag z-end z-xml">></span></span>ivan.ivanov@example.com<span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml">&LT/</span><span class="z-entity z-name z-tag z-localname z-xml">email</span><span class="z-punctuation z-definition z-tag z-end z-xml">></span></span>
</span><span class="z-text z-xml">  <span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml">&LT/</span><span class="z-entity z-name z-tag z-localname z-xml">user</span><span class="z-punctuation z-definition z-tag z-end z-xml">></span></span>
</span><span class="z-text z-xml">  <span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml"><</span><span class="z-entity z-name z-tag z-localname z-xml">user</span><span class="z-punctuation z-definition z-tag z-end z-xml">></span></span>
</span><span class="z-text z-xml">    <span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml"><</span><span class="z-entity z-name z-tag z-localname z-xml">name</span><span class="z-punctuation z-definition z-tag z-end z-xml">></span></span>Мария Петрова<span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml">&LT/</span><span class="z-entity z-name z-tag z-localname z-xml">name</span><span class="z-punctuation z-definition z-tag z-end z-xml">></span></span>
</span><span class="z-text z-xml">    <span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml"><</span><span class="z-entity z-name z-tag z-localname z-xml">email</span><span class="z-punctuation z-definition z-tag z-end z-xml">></span></span>maria.petrova@example.com<span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml">&LT/</span><span class="z-entity z-name z-tag z-localname z-xml">email</span><span class="z-punctuation z-definition z-tag z-end z-xml">></span></span>
</span><span class="z-text z-xml">  <span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml">&LT/</span><span class="z-entity z-name z-tag z-localname z-xml">user</span><span class="z-punctuation z-definition z-tag z-end z-xml">></span></span>
</span><span class="z-text z-xml"><span class="z-meta z-tag z-xml"><span class="z-punctuation z-definition z-tag z-begin z-xml">&LT/</span><span class="z-entity z-name z-tag z-localname z-xml">users</span><span class="z-punctuation z-definition z-tag z-end z-xml">></span></span>
</span><span class="z-text z-xml">EOF
</span></code></pre><p><code>dasel -f users.xml -r xml ".users.user.[0].email"</code><h3 id=xq><a aria-label="Anchor link for: xq" class=zola-anchor href=#xq><i class=icon></i></a> xq</h3><p><code>apt-get install xq || brew install xq</code> установить xq (https://github.com/sibprogrammer/xq) для XML и HTML на GoLang <br> <code>curl -s https://kinozal.tv/rss.xml -x kinozal:proxy@192.168.3.100:9090 | xq -nx /rss/channel/item</code> вывод содержимого дочерних элементов с тегами <br> <code>curl -s https://kinozal.tv/rss.xml -x kinozal:proxy@192.168.3.100:9090 | xq -x /rss/channel/item/link</code> вывести только содержимое (массив ссылок) <br> <code>curl -s https://kinozal.tv -x kinozal:proxy@192.168.3.100:9090 | xq -nq "head"</code> вывести блок head целиком (с тегами) <br> <code>curl -s https://kinozal.tv -x kinozal:proxy@192.168.3.100:9090 | xq -q "head"</code> вывести только текст из дочерних элементов выбранного тега (содержимое title) <br> <code>curl -s https://kinozal.tv/browse.php?s=the+rookie -x kinozal:proxy@192.168.3.100:9090 | xq -nq "body > div > div > div > div > table > tbody > tr > td"</code> <br> <code>curl -s -X POST -u "Login:Password" "http://localhost:9091/transmission/rpc" | xq -q a -a href</code> забрать X-Transmission-Session-Id для дальнейших запросов к API (обратиться к тэгу a и атрибуту href)<h3 id=htmlq><a aria-label="Anchor link for: htmlq" class=zola-anchor href=#htmlq><i class=icon></i></a> htmlq</h3><p><code>brew install htmlq</code> установить htmlq (https://github.com/mgdm/htmlq) like jq for HTML <br> <code>curl -s https://kinozal.tv/browse.php?s=the+rookie -x kinozal:proxy@192.168.3.100:9090 | htmlq table tr td a -t</code> получить содержимое таблицы (вывести только текст содержимого) <br> <code>curl -s https://kinozal.tv/browse.php?s=the+rookie -x kinozal:proxy@192.168.3.100:9090 | htmlq table tr td a -a href</code> получить только ссылки <br> <code>curl -s -X POST -u "Login:Password" "http://localhost:9091/transmission/rpc" | htmlq a -a href</code> забрать X-Transmission-Session-Id для дальнейших запросов к API (обратиться к тэгу a и атрибуту href)<h3 id=yq><a aria-label="Anchor link for: yq" class=zola-anchor href=#yq><i class=icon></i></a> yq</h3><p><code>snap install yq || pip install yq</code> установить yq (https://github.com/kislyuk/yq) для YAML/XML/TOML на Python <br> <code>cat /etc/netplan/*.yaml | yq .network.ethernets</code> список адаптеров netplan <br> <code>cat /etc/netplan/*.yaml | yq .network.ethernets.eth0.nameservers.addresses[]</code> вывести массив dns адресов, настроенные на адаптере <br> <code>curl -s https://kinozal.tv/rss.xml -x kinozal:proxy@192.168.3.100:9090 | yq -p xml .rss.channel.item[1].link</code> вывести ссылку из первого элемента <br> <code>curl -s https://raw.githubusercontent.com/JingWangTW/dark-theme-editor/main/hugo.toml | yq -p toml .params.footer.socialLink</code> прочитать конфигурацию Hugo<h3 id=yamllint><a aria-label="Anchor link for: yamllint" class=zola-anchor href=#yamllint><i class=icon></i></a> yamllint</h3><p><code>apt install yamllint</code> установить yamllint (https://github.com/adrienverge/yamllint) для проверки синтаксических ошибки YAML-файла <br> <code>yamllint /etc/netplan/*.yaml</code><h3 id=jsonlint><a aria-label="Anchor link for: jsonlint" class=zola-anchor href=#jsonlint><i class=icon></i></a> jsonlint</h3><p><code>apt-get install -y nodejs</code> установить Node.js <br> <code>npm install jsonlint -g</code> установить jsonlint (https://github.com/zaach/jsonlint) для проверки синтаксических ошибок JSON <br> <code>echo '{"name":"example","value":"test",}' | jsonlint</code> <br> <code>echo '{"name":"example","value":"test"}' | jsonlint</code><h3 id=csv><a aria-label="Anchor link for: csv" class=zola-anchor href=#csv><i class=icon></i></a> csv</h3><p><code>brew install csvlens</code> установить csvlens (https://github.com/YS-L/csvlens) для взаимодестия в csv через TUR на Rust <br> <code>pwsh -Command "Get-Process | ConvertTo-Csv | Out-File process.csv"</code> <br> <code>csvlens process.csv</code><h3 id=sttr><a aria-label="Anchor link for: sttr" class=zola-anchor href=#sttr><i class=icon></i></a> sttr</h3><p><code>snap install sttr</code> установить sttr (https://github.com/abhimanyu003/sttr) для конвертации и работы данными на GoLang <br> <code>curl -s curl -s -H "Accept: application/json" https://check-host.net/nodes/hosts | sttr json-yaml</code> конвертировать JSON в YAML <br> <code>cat /etc/netplan/*.yaml | sttr yaml-json | jq</code> конвертировать YAML в JSON <br> <code>curl -s https://raw.githubusercontent.com/Lifailon/hwstat/rsa/README.md | sttr markdown-html</code> конвертировать Markdown в HTML <br> <code>echo "test" | sttr hex-encode</code> кодировать в HEX формат <br> <code>echo "74657374" | sttr hex-decode</code> декодировать HEX <br> <code>echo "Test" | sttr upper</code> поднять регистр (TEST) <br> <code>echo "Test" | sttr lower</code> опустить регистр (test) <br> <code>echo -e "test1\ntest1\ntest2" | sttr unique-lines</code> получить уникальные строки <br> <code>echo -e "a\nz\nb" | sttr sort-lines</code> сортировать строки по алфавиту <br> <code>echo -e "test1 \ntest2" | sttr remove-newlines</code> удалить новые строки <br> <code>echo -e "test1\ntest2" | sttr count-chars</code> посчитать количество символов <br> <code>echo -e "test1\ntest2" | sttr count-lines</code> посчитать количество строк<h2 id=grep><a aria-label="Anchor link for: grep" class=zola-anchor href=#grep><i class=icon></i></a> grep</h2><p><code>cat /var/log/auth.log | grep sshd</code> логи всех SSH-подключений <br> <code>cat /etc/passwd | grep -w sys</code> поиск целого слова, окруженное пробелами (<code>-w</code>) <br> <code>cat /etc/ssh/sshd_config | grep -win port</code> не учитывать регистр (<code>-i</code>) и отобразить номера строк (<code>-n</code>) <br> <code>ss -n | grep -P ":22|:80|:443|:8080"</code> искать по нескольким шаблонам, использовать Regex (<code>-E</code>) <br> <code>ss -n | grep -Pc ":22|:80"</code> вывести кол-во (<code>--count</code>) совпадений <br> <code>ss -n | grep "192.168.3...:"</code> поиск любых двух символов (<code>.</code>) <br> <code>ss -n | grep "192.168.3.*:"</code> поиск любого кол-ва (<code>*</code>) <br> <code>cat /etc/ssh/sshd_config | grep -v "#"</code> вывести значения, не подходящие под критерии поиска (<code>-v</code>) <br> <code>cat /etc/zabbix/zabbix_agentd.conf | grep -v "^#"</code> отсеить только в начале строки (<code>^</code>) <br> <code>cat /etc/zabbix/zabbix_agentd.conf | grep "=$"</code> найти строки, которые кончаются <code>$</code> на символ <code>=</code> (получить все параметры) <br> <code>cat /etc/zabbix/zabbix_agentd.conf | grep -Pv "^$|^#"</code> удалить пустые строки <code>^$</code> и комментарии (<code>^#</code>) <br> <code>cat /etc/zabbix/zabbix_agentd.conf | grep -E "#+{5}"</code> регулярное выражение (<code>-E</code>), где последний символ <code>#</code> повторяется 5 или более раз <br> <code>echo -e "Test\ntest\n123-45" | grep -E "[a-zA-Z\-]"</code> искать только текст (где есть буквы и тире) <br> <code>echo 'test&LTversion>1.2.3&LT/version>test' | grep -P -o "(?<=&LTversion>).*(?=&LT/version>)"</code> найти неизвестное значение (<code>.*</code>) между известными и вывести только найденное (<code>-o</code>) <br> <code>echo "test&LTversion>3.6.4&LT/version>test" | grep -Eo '[0-9.]+'</code> найти любую цифру и точку на конце, которые повторяются любое кол-во раз подряд <br> <code>echo $(lshw -class bus) | grep -P -o "(?<=Motherboard product: ).*(?=serial)"</code> с применение группировки (<code>-P</code>) <br> <code>zabbix_path=$(systemctl status zabbix-agent | grep -Po "(?<=-c ).*(?=.conf)" | sed "s/$/.conf/")</code> забрать путь до конфигурационного файла Zabbix агента <br> <code>cat $zabbix_path | grep -E "^Server=|^ServerActive="</code> найти имя сервера <br> <code>cat $zabbix_path | grep -Po "(?<=^Server=).+"</code> вывести только имя сервера <br> <code>resolvectl | grep "DNS Servers" -m 1</code> напечатать только первое совпадение (<code>-m int</code>) <br> <code>networkctl status | grep -A 3 "DNS:"</code> найти строку и напечатать три строки после нее (<code>-A</code>) <br> <code>networkctl status | grep -B 3 "DNS:"</code> найти строку и напечатать три строки до нее (<code>-B</code>) <br> <code>networkctl status | grep -C 1 "DNS:"</code> найти строку и напечатать одну строки до нее и одну после (<code>-C</code>) <br> <code>resolvectl | grep -Ex ".+DNS Servers:.+"</code> вывести строки с точным совпадение (<code>-x/like</code>), сопоставлять только целые строки <br> <code>if echo "GET" | grep -Eq "^GET"; then echo da; else echo net; fi</code> подавлять вывод (<code>-q</code>) для проверки условия <br> <code>curl https://api.github.com/repos/PowerShell/PowerShell/releases/latest | grep -Eom 1 "https://.+.deb"</code> забрать только первый подходящий под поиск<h3 id=ripgrep><a aria-label="Anchor link for: ripgrep" class=zola-anchor href=#ripgrep><i class=icon></i></a> ripgrep</h3><p><code>apt-get install ripgrep</code> установить ripgrep (https://github.com/BurntSushi/ripgrep), аналог grep на Rust <br> <code>cat /var/log/auth.log | rg sshd</code> вывести журнал логов аудентификации фильтрацией по названию <br> <code>cat /var/log/auth.log | rg "Accepted password for \w+ from \d+\.\d+\.\d+\.\d+"</code> вывести строки, где указано <code>Accepted password for</code>, далее любое слово (имя пользователя) и IP-адрес в формате x.x.x.x <br> <code>cat /var/log/auth.log | rg "user \w+\(uid=\d+\)"</code> вывести строки с текстом user, затем имя пользователя (любое слово), и далее <code>uid</code> с числовым значением в скобках <br> <code>cat /var/log/auth.log | rg "192\.168\.\d+\.\d+"</code> вывести строки, где первые два октета соответствуют <code>192.168</code> <br> <code>cat /var/log/auth.log | rg "sshd\[\d+\]: .* port \d+"</code> вывести строки, содержащие sshd с идентификатором процесса (например, <code>sshd[4188420]</code>), а затем текст <code>port</code> и номер порта <br> <code>cat /var/log/auth.log | rg "\b12:\d{2}:\d{2}\b"</code> фильтрация по времени за последние 12 часов (время начинается с <code>12:</code>, затем две цифры для минут и две для секунд)<h3 id=sig><a aria-label="Anchor link for: sig" class=zola-anchor href=#sig><i class=icon></i></a> sig</h3><p><code>brew install ynqa/tap/sigrs</code> установить sig (https://github.com/ynqa/sig) интерактивный grep на Rust <br> <code>curl -s https://raw.githubusercontent.com/Lifailon/hwstat/rsa/README.md > README.md</code> <br> <code>cat README.md |& sig -a</code><h2 id=sed><a aria-label="Anchor link for: sed" class=zola-anchor href=#sed><i class=icon></i></a> sed</h2><p><code>cat /etc/passwd | sed -n "1,5p"</code> отобразить с первой по пятую строку (<code>p</code>) <br> <code>cat /etc/passwd | sed "$ d"</code> удалить (<code>d</code>) последнюю строку <br> <code>cat /etc/passwd | sed "1,3d"</code> удалить c первой по третью строку (<code>2,3d</code>) <br> <code>echo "One 1" | sed "s/One/Two/; s/1/2/"</code> заменить One на Two и 1 на 2 <br> <code>cat /etc/zabbix/zabbix_agentd.conf | sed "s/127.0.0.1/192.168.3.102/" #  > /etc/zabbix/zabbix_agentd.conf</code> заменить (<code>s</code>) ip-адрес <br> <code>cat /etc/zabbix/zabbix_agentd.conf | sed "/^#\|^$/d"</code> удалить пустые строки <code>^$</code> и комментарии <code>^#</code> <br> <code>timedatectl | grep zone | sed -E "s/.+zone: //"</code> удалить любое кол-во лимволов до слова “zone: “ включительно, используя Regex (<code>-E/-r</code>) <br> <code>echo -e "test\ntest" | sed "2s/test/test2/"</code> заменить во второй строке (<code>2s</code>) <br> <code>echo -e "test\ntest\ntest\ntest" | sed "2,3s/test/test2/"</code> заменить во второй и третей строке (<code>2,3s</code>) <br> <code>echo -e "test\ntest\ntest\ntest" | sed "2ctest2"</code> заменить вторую строку (<code>2c</code>) <br> <code>echo "The test and test" | sed "s/test/test2/g"</code> заменить для каждого совпадения (<code>/global</code>) <br> <code>echo "The test and test" | sed "s/test/test2/2"</code> заменить для второго совпадения (<code>/2</code>) <br> <code>echo "line2" | sed "i\line1"</code> добавить строку в начало (<code>i</code>) <br> <code>echo "line1" | sed "a\line2"</code> добавить строку в конец (<code>a</code>) или в после указанной строки (<code>2a</code>) <br> <code>echo "11 22 33 34" | sed "y/123/234/"</code> заменить 1 на 2, 2 на 3, 3 на 4 (<code>y</code>) <br> <code>ls -R | grep ':' | sed "s/:$//; s/[^\/]*\// - /g"</code> удалить <code>:</code> в конце и заменить вначале строки <code>"/любое кол-во символов между/"</code> на <code>" - "</code> для всех (<code>/g</code> global) <br> <code>echo "test&LTversion>3.6.4&LT/version>test" | sed -r 's/[^<]*<(.*)>.*/\1/;s/<.*//;s/.*>//'</code> использовать regex (<code>-r</code>) <br> <code>ps aux | grep -E "^zabbix .+ -c" | sed -E "s/^zabbix.+-c //"</code> найти процесс zabbix с ключем <code>-c</code> и оставить путь <code>conf</code> <br> <code>echo "MPEG-H HEVC, 88.5 Мбит/с, 3840x2160, 23.976 кадр/с, 10 бит" | sed -nr 's/.* ([0-9]+x[0-9]+).*/\1/p'</code> выводить только найденные строки (<code>-n</code>) с заменой (<code>s/</code>), ищем только цифры <code>[0-9]</code> где одно или более вхождений (<code>+</code>) и между ними <code>x</code>, вывести только первую группу поиска (то, что в скобках) на печать (<code>/p</code>)<h2 id=awk><a aria-label="Anchor link for: awk" class=zola-anchor href=#awk><i class=icon></i></a> awk</h2><p><code>cat /etc/passwd | awk -F: '{print "name: " $1 " \t Dir: " $NF}'</code> вывести содержимое первого и последнего <code>$NF</code> элемента в строке, используя разделитель “:” и табуляцию (\t) <br> <code>echo 'one two three four' | awk '{print $(NF-1)}'</code> вывести содержимое преподследнего элемента <br> <code>echo 'one two three four five' | awk '{print $((NF/2)+1)}'</code> вывести содержимое из середины <br> <code>echo "One Two Three" | awk '{$3="Four"; print $0}'</code> заменить третье значение/переменную в строке <br> <code>cat /etc/passwd | awk 'BEGIN{FS=":"; OFS=" - "} {print $1,$7}'</code> указать разделитель послей (элементов) на вход (<code>FS</code>) и заменить его на выходе (<code>OFS</code>) <br> <code>uptime | awk 'BEGIN{RS=" "; ORS="\n"} {print $0}'</code> указать разделитель записей (строк) на входе (<code>RS</code>) и заменить его на выходе (<code>ORS</code>) <br> <code>echo -e "12345\n54321" | awk 'BEGIN{FIELDWIDTHS="2 3"}{print $1,$2}'</code> указать фиксированное кол-во символов для разделения <br> <code>lsof | awk '{if($7=="REG")print $0}'</code> условие для выборки по столбцу <br> <code>cat /etc/ssh/sshd_config | awk '/Port / {print $2}'</code> условие поиска для вывода <br> <code>cat /etc/ssh/sshd_config | awk 'length $0 > 1'</code> вывести строки, которые длиннее, чем 1 символ (удалить пустые строки) <br> <code>cat /var/log/syslog | grep "$date" | awk '{print length($6)}'</code> вывести длинну значения <br> <code>awk 'BEGIN{x = "low"; print toupper(x)}'</code> использовать функцию для перевода в вверхний регистр <br> <code>awk 'BEGIN{x = "LOW"; print tolower(x)}'</code> использовать функцию для перевода в нижний регистр <br> <code>echo "1 2 3 4:5:6" | awk '{item=$4; split(item,array,":"); print array[2]}'</code> разбить 4 значение на массив (используя функцию <code>split</code>) и забрать значение по 2-му индексу <br> <code>free | awk '{if (NR == 2) print $0}'</code> вывести только вторую строку <br> <code>free | awk '{if (NR >= 2) print $0}'</code> вывести втроую и последующие строки <br> <code>free | awk '{if (NF >= 5) print $0}'</code> вывести строки, где 5 или больше значений <br> <code>cat /etc/passwd | awk '{ if (NR >= 10 && NR <= 20) print $0}'</code> вывести с 10 по 20 строки <br> <code>last | sed -n 1p | awk '$2=" ",$4=" "{print $0}'</code> вывести все, кроме 2 и 4 значения (заменить) <br> <code>ps -A | awk '{sum=""; for(i=1;i<=NF;i++) { if (i != 2) {sum=sum" "$i} } print sum}'</code> вывести все, кроме 2-го значения<p><code>cut -d',' -f2,4 file.csv</code> взять второй и четвертый столбцы <br> <code>awk -F',' '{if (NF >= 4) print $2, $4}' file.csv</code><p><code>grep "Error" logs.txt</code> <br> <code>awk '/Error/' logs.txt</code> <br> <code>awk '/^Error [0-9]{3}:/' logs.txt</code><p><code>grep -c "Success" logs.txt</code> посчитать количество совпадений <br> <code>awk '/Success/ {count++} END {print count}' logs.txt</code><p><code>sed 's/Error/Success/g' file.txt</code> замена слов <br> <code>awk '{gsub(/Error/, "Success"); print}' file.txt</code><p><code>sort file.txt | uniq</code> <br> <code>awk '!seen[$0]++' file.txt</code> заполняем уникальный массив строк<p><code>wc -w file.txt</code> посчитать количество слов в файле <br> <code>awk '{count += NF} END {print count}' file.txt</code><p><code>sed -n '10,20p' file.txt</code> вывести с 10 по 20 строку <br> <code>awk 'NR>=10 && NR<=20' file.txt</code><p><code>awk '{sum += $1} END {print sum/NR}' numbers.txt</code> получить среднее значение чисел в первом столбце <br> <code>awk '{ if ($2 > 50000) print $1, "> 50K"; else print $1, "< 50K" }' data.txt</code> вывести значение первого столбца, если значение второго столбца выше или ниже 50 тысяч <br> <code>awk '{ sum = 0; for (i = 1; i <= NF; i++) sum += $i; print "сумма:", sum }' data.txt</code> посчитать сумму числе в каждой строке <br> <code>awk '{ for (i = 1; i <= NF; i++) sum[i] += $i } END { for (i in sum) print "Столбец", i, "сумма:", sum[i] }' data.txt</code> посчитать сумму числе в каждом столбце<h2 id=printf><a aria-label="Anchor link for: printf" class=zola-anchor href=#printf><i class=icon></i></a> printf</h2><p><code>top=$(top -bn1)</code> <br> <code>printf "%s\n" "${top[@]}"</code> вывести вывод массива построчно <br> <code>printf "%.2f \n" 1.1111</code> округлить до 2 символов после запятой <br> <code>printf "%.0f \n" 1.6</code> удалить дробную часть (округлить до 2) <br> <code>printf "Arg1: %s\nArg2: %s\n" "10" "20"</code> принимает и выводит аргументы (%s) в виде строки<h2 id=cut><a aria-label="Anchor link for: cut" class=zola-anchor href=#cut><i class=icon></i></a> cut</h2><p><code>echo "1 2 3" | cut -c 1,5</code> вывести первый и пятый симов (<code>--bytes</code>/<code>--characters</code>) <br> <code>echo "1 2 3" | cut -c 1-3</code> вывести с первой по третий символ <br> <code>echo "1 2 3" | cut -c3-</code> удалить первые 2 символа <br> <code>echo -e "test1,test2,test3\ntest1,test2,test3" | cut -d , -f 2-100</code> указать разделитель полей/столбцов (<code>--delimiter</code>) и какие столбцы вывести (<code>--fields</code>) с 2 по 100 <br> <code>echo -e "test1,test2,test3\ntest1,test2,test3" | cut -d , -f 1,3 | sed "s/,/ /"</code> вывести 1 и 3 <br> <code>echo -e "test1,test2,test3\ntest1 test2 test3" | cut -d , -f 1,3 -s</code> печатать строки, где есть разделитель (<code>-s</code>)<h3 id=rev><a aria-label="Anchor link for: rev" class=zola-anchor href=#rev><i class=icon></i></a> rev</h3><p><code>echo "D:\plex-content\Rick.and.Morty.S07.2023.WEBDLRip.MegaPeer" | rev | cut -d \\ -f 1 | rev</code> забрать последний элемент в пути (вначале разворачивает всю строку, забирает первый элемент и разворачивает строку обратно) <br> <code>echo "D:\plex-content\Rick.and.Morty.S07.2023.WEBDLRip.MegaPeer" | sed -r 's/.+\\//'</code> удалить все до последнего слеша <br> <code>echo "D:\plex-content\Rick.and.Morty.S07.2023.WEBDLRip.MegaPeer" | sed 's/.*\\\(.*\)/\1/'</code> удаляет все до последнего слеша и забирает одну группу захвата, что остается после удаления, и заменяет вывод на первую группу (1) <br> <code>echo "D:\plex-content\Rick.and.Morty.S07.2023.WEBDLRip.MegaPeer" | awk -F '\\' '{print $NF}'</code> забрать последний элемент массива (NF)<h2 id=tr><a aria-label="Anchor link for: tr" class=zola-anchor href=#tr><i class=icon></i></a> tr</h2><p><code>echo "10 20 100 200" | tr 1 2</code> translate заменяет 1 на 2 для всех подходящих сомволов (20 20 200 200) <br> <code>echo "1 2 3" | tr " " ","</code> заменить пробелы на запятые (1,2,3) <br> <code>echo "1 2 3" | tr -d " "</code> удалить пробелы (123)<h2 id=man><a aria-label="Anchor link for: man" class=zola-anchor href=#man><i class=icon></i></a> man</h2><h3 id=cheat-sh><a aria-label="Anchor link for: cheat-sh" class=zola-anchor href=#cheat-sh><i class=icon></i></a> cheat sh</h3><p><code>curl cheat.sh/curl</code> <br> <code>curl cheat.sh/grep</code> <br> <code>curl cheat.sh/sed</code> <br> <code>curl cheat.sh/awk</code> <br> <code>curl cheat.sh/jq</code> <br> <code>curl cheat.sh/iptables</code> <br> <code>curl cheat.sh/find</code><h3 id=tldr><a aria-label="Anchor link for: tldr" class=zola-anchor href=#tldr><i class=icon></i></a> tldr</h3><p><code>pip3 install tldr</code> упрощенный вариант man с примерами использования <br> <code>tldr curl</code> веб-версия: https://manned.org/man/curl<h2 id=debug><a aria-label="Anchor link for: debug" class=zola-anchor href=#debug><i class=icon></i></a> debug</h2><p><code>trap 'echo "$BASH_COMMAND"' DEBUG</code> построчная отладка скриптов bash, команда trap перехватывает сигнал DEBUG, посылаемый перед выполнением команды и выводит команду на экран <br> <code>trap 'echo "$BASH_COMMAND";read' DEBUG</code> read ожидает ввода с клавиатуры (Enter или Ctrl+C) перед выполнением каждой командой <br> <code>bash -x script.sh</code> отладка (печать команд и их аргументов по мере их выполнения) <br> <code>bash -x -c "ls -l" | grep *.sh | awk '{print $5,$NF}'</code> запуск команды через интерпритатор bash и вывод отладки <br> <code>bash --debug script.sh</code> проверка на ошибки <br> <code>apt-get install shellcheck</code> установить shellcheck <br> <code>shellcheck -S error hwstat.sh</code> error/warning/info/style <br> <code>pip3 install thefuck</code> установить thefuck <br> <code>bas hwstat.sh</code> запустить команду с ошибкой <br> <code>fuck</code> автоматически исправляет последнюю ошибочную команду из выпадающего списка (up/down)<h2 id=tools><a aria-label="Anchor link for: tools" class=zola-anchor href=#tools><i class=icon></i></a> tools</h2><p><code>pip install toolong</code> <br> <code>tl /var/log/auth.log</code> интерактивный просмотр логов в консоли с фильтрацией <br> <code>tl access.log* --merge</code> просмотр нескольких файлов<p><code>apt install bat</code> аналог cat (https://github.com/sharkdp/bat) с подсветкой синтаксиса <code>bat /etc/netplan/*.yaml</code><p><code>tree /var/log/</code> древовидный просмотр директорий и дочерних файлов<p><code>cargo install --locked broot</code> установить broot (https://github.com/Canop/broot), аналог tree <br> <code>broot kinozal-bot/</code><p><code>echo 'deb http://cz.archive.ubuntu.com/ubuntu jammy main universe' >> /etc/apt/sources.list && apt update</code> <br> <code>apt install exa</code> установить аналог ls (https://github.com/ogham/exa) <br> <code>exa $(pwd) -l --icons</code> отобразить иконки с подсветкой прав доступа<p><code>cargo install eza</code> аналог ls (https://github.com/eza-community/eza) на базе exa <br> <code>eza -l --icons</code> <br> <code>eza --tree kinozal-bot/</code><p><code>cargo install lsd</code> аналог ls (https://github.com/lsd-rs/lsd) <br> <code>lsd -l kinozal-bot/</code><p><code>column /etc/passwd -t -s ":"</code> <br> <code>netcheck -t ping yandex.ru us1.node.check-host.net | sed -r 's/"//g; s/,$//; s/\{|\}|\[|\]//' | column -t -s ":"</code> распарсить JSON и добавить отступ (табуляцию) для колонок<p><code>ls /home | wc -l</code> word count выводит количество строк (<code>--line</code>) <br> <code>ls /home | wc -w</code> количество слов (<code>--words</code>) <br> <code>ls /home | wc -m</code> количество символом (<code>--chars</code>) <br> <code>ls /home | wc -c</code> количество символов/байт (<code>--bytes</code>)<p><code>echo "(5.5-2.2)" | bc</code> математические вычисления <br> <code>echo "(5.5-2.2)" | bc | sed -E "s/\..+//"</code> удалить дробную часть <br> <code>echo "1 < 2" | bc</code> возвращает булевое значение (1 - да или 0 - нет) <br> <code>echo "1 > 2" | bc</code> false (0) <br> <code>icmp_ignore=$(cat /proc/sys/net/ipv4/icmp_echo_ignore_all)</code> забрать значение <br> <code>if (( $(echo "$icmp_ignore == 1" | bc) )); then echo "true"; else echo "false"; fi</code> проверить в условии арефметическое значение на равенство (возвращает 0 - <code>false</code> или 1 - <code>true</code>)<p><code>a=1</code> <br> <code>b=0.55</code> <br> <code>echo $(bc <<< "scale=2; $a+$b")</code> <br> <code>echo "print $a+$b" | perl</code> <br> <code>echo "print($a+$b)" | python3</code> <br> <code>echo "print($a+$b)" | lua</code> <br> <code>echo "puts $a+$b" | ruby</code> <br> <code>pwsh -Command $a+$b</code><p><code>echo -e "key1\nkey2\nkey3" > 1.txt</code> <br> <code>echo -e "value1\nvalue2\nvalue3" > 2.txt</code> <br> <code>paste 1.txt 2.txt -d :</code> объединяет два файла в один многоколоночный вывод <br> <code>cat /etc/passwd | paste -s -d +</code> объеденить (join) многострочный файл, используя указанный delimiter<p><code>echo -e "test1\ntest2" > 1.txt \ </code>echo -e “test\ntest2\ntest3” > 2.txt <br> <code>diff 1.txt 2.txt -c</code> ! есть изменения, + есть новая строка <br> <code>diff 1.txt 2.txt -yi</code> сравнивает в две колонки (| есть изменения, + есть новая строка) и игнорировать регистр (-i) <br> <code>diff 1.txt 2.txt -u</code> объеденяет два файла в один вывод с отображением изменений (+/) <br> <code>diff 1.txt 2.txt -ibBEt</code> не учитывать пробелы (-b) и пустые строки (-B), игнорировать изменения в табуляциях (-E) и заменить табуляции на пробелы в выводе (-t) <br> <code>diff -c <(echo "$predu") <(echo "$du")</code> сравнить содержимое переменных<p><code>snap install diff-so-fancy</code> <br> <code>diff -u file-1.txt file-2.txt | diff-so-fancy</code><p><code>apt install jdupes</code> <br> <code>jdupes .</code> поиск дубликатов<p><code>cat /etc/passwd | sort -r</code> отсортировать вывод по алфовиту в обратном порядке (-r) <br> <code>du -h ~ | sort -n</code> сортировать по арифметическому значению (-n) размер файлов и директорий <br> <code>ls -l | sed 1d | sort -nk5</code> сортировка по пятой колонке (-k) <br> <code>cat $tmp | sort -t "." -nk4</code> сортировать по четвертой колонке, используя разделитель (-t) точку<p><code>echo -e "1 2\n1 2\n2 1\n1 2" | uniq</code> удаляет соседние одинаковые строки <br> <code>echo -e "1 2\n1 2\n2 1\n1 2" | sort | uniq</code> удалить все дубликаты <br> <code>echo -e "1 2\n1 2\n2 1\n1 2" | sort | uniq -c</code> добавляет в начало каждой строки кол-во повторений <br> <code>echo -e "1 2\n1 2\n2 1\n1 2" | sort | uniq -u</code> отобразить только уникальные строки, без строк с повторениями<p><code>ls -l | fold -w 50</code> задать ширину вывода каждой строки, выпадающее за указанный предел переносится на новую строку <br> <code>ls -l | fold -w 50 -s</code> разбивать строки только на символах пробела (–space)<p><code>cat /var/log/syslog | head -n 5</code> выводит первые 5 строк файла<p><code>cat /var/log/syslog | tail -n 5 </code> просмотр последних 5 строк файла <br> <code>tail -f /var/log/syslog</code> просмотр содержимого файла в реальном времени<p><code>apt install multitail</code> <br> <code>multitail -f /var/log/auth.log -f /var/log/kern.log</code> <br> <code>multitail -l "journalctl -fu ssh" -l "journalctl -fu cron"</code><p><code>less /var/log/dmesg</code> вывести лог ядра с возможностью пролистывания<p><code>watch df -h</code> выводит на экран и обновляет состояния подключенных устройств каждые 2 секунды<p><code>echo "line1" | tee test.txt</code> перезаписать файл (>) <br> <code>ls > /dev/null</code> перенаправить вывод в null <br> <code>echo "line2" | tee -a test.txt</code> добавить (>>) текст новой стройокй в конец файла <br> <code>echo -e "line3\nline4" >> test.txt</code> добавить две новые строки<p><code>du -a /var/log | awk '{print $2}' | xargs fincore</code> передать вывод первой команды построчно в аргументы следующей<p><code>split -l 100 input_file.txt output_prefix</code> разделить файл на части по 100 строк в каждой <br> <code>split -b 10M input_file.txt output_prefix</code> разделить файл на части по указанному размеру (например, 10MB)<p><code>yes</code> предназначена для автоматического вывода строки или символа, повторяющегося бесконечно (для нагрузки системы), либо для автоматического подтверждения запросов в других командах<h2 id=dust><a aria-label="Anchor link for: dust" class=zola-anchor href=#dust><i class=icon></i></a> dust</h2><p><code>snap install dust</code> аналог du на Rust (https://github.com/bootandy/dust) <br> <code>dust /home/lifailon</code> выводит график используемого пространства по директориям и файлам для анализа занятого пространства <br> <code>dust -s</code> показывает размер файла, а не объем используемого им дискового пространства <br> <code>dust -n 30</code> выводит 30 каталогов (по умолчанию — высота терминала) <br> <code>dust -d 3</code> показывает 3 уровня подкаталогов <br> <code>dust -D</code> отобразить только директории <br> <code>dust -F</code> отобразить только файлы <br> <code>dust -f</code> считайте файлы вместо дискового пространства <br> <code>dust -i</code> не показывать скрытые файлы <br> <code>dust -z 10M</code> минимальный размер, включать только файлы размером более 10 МБ <br> <code>dust -z 40000/30MB/20kib</code> исключить выходные файлы/каталоги размером менее 40 000 байт/30 МБ/20 КБ <br> <code>dust -o si/b/kb/kib/mb/mib/gb/gib</code> формат вывода <br> <code>dust -e "\.png$"</code> включать только те файлы, которые соответствуют регулярному выражению (например, только файлы <code>png</code>) <br> <code>dust -v "\.png$"</code> регулярное выражение для игнорирования файлов с разрешением <code>png</code> <br> <code>dust -j  | jq</code> вывод в формате <code>JSON</code> <br> <code>dust -P</code> отключить индикатор прогресса<h2 id=find><a aria-label="Anchor link for: find" class=zola-anchor href=#find><i class=icon></i></a> find</h2><p><code>find / -name "*.sql"</code> найти файлы, начать поиск с корня (/) <br> <code>find / -iname "mysql"</code> найти файлы не учитывая регистр (-i) <br> <code>find ~ -name "test.*" -not -name "*.conf"</code> найти все файлы с наименование test, которые имеют любое расширение, за исключением (-not) расширения .conf <br> <code>find ~ -amin -10</code> поиск файлов по дате последнего чтения (-amin) которые просматривались (cat/nano) за последние 10 минут <br> <code>find ~ -type f -mmin -10</code> найти файлы (-type f), которые были модифицированны за последние 10 минут (-nmin) <br> <code>find ~ -type f -mtime +1 -mtime -7</code> найти все файлы, модифицированные между 1 и 7 днями назад <br> <code>find ~ -type d -mtime +1 -mtime -7</code> поиск директорий <br> <code>find ~ -size +50M -size -100M</code> поиск файлов в Linux по их размеру, от 50 до 100 мегабайт <br> <code>find / -perm 444</code> поиск файлов по режиму доступа (только чтение для всех) <br> <code>find /home/lifailon/ -user root</code> поиск файлов по владельцу <br> <code>find /home/lifailon/ -group root</code> поиск по группе <br> <code>find /root/ -empty</code> поиск пустых файлов или директорий<h3 id=exec><a aria-label="Anchor link for: exec" class=zola-anchor href=#exec><i class=icon></i></a> exec</h3><p><code>touch -t 202306222200.15 /tmp/test.txt</code> создать файл с указанной датой создания <br> <code>find /tmp -type f -mtime +30 -exec rm -f {} \;</code> удалить все файлы, котоыре не изменялись больше 30 дней <br> <code>find /tmp -type f -name "*.txt" -exec rm -f {} \;</code> удалить все текстовые файлы в директории tmp <br> <code>dd if=/dev/zero of=/var/log/test.log count=11 bs=1M</code> создать файл заполненный нулями указанного размера <br> <code>find /var/log -type f -name "*.log" -size +10M -exec rm -f {} \;</code> удалить все лог-файлы, объёмом больше 10 Мбайт<h3 id=locate><a aria-label="Anchor link for: locate" class=zola-anchor href=#locate><i class=icon></i></a> locate</h3><p><code>apt install plocate</code> <br> <code>updatedb</code> обновить индексы базы данных <br> <code>locate .torrent</code> найти по частичному совпадению в имени или расширению <br> <code>locate .torrent -c</code> отображает количество найденных результатов <br> <code>locate -n 10 .torrent</code> вывести 10 результатов <br> <code>locate -i Kinozal-Bot</code> игнорировать регистр <br> <code>locate -r "\.log$"</code> использовать регулярные выражения<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> curl<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>s</span> https://github.com/pr4k/locate/releases/download/v0.1.1/locate-linux<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>o</span> /usr/bin/locate<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>o</span> /usr/bin/locate</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> chmod +x /usr/bin/locate</span>
</span></code></pre><p><code>locate-linux -p /home/lifailon/ -q /qbittorrent</code> <br> <code>locate-linux -p /home/lifailon/.bash_history -q /qbittorrent</code><h3 id=fd><a aria-label="Anchor link for: fd" class=zola-anchor href=#fd><i class=icon></i></a> fd</h3><p><code>apt install fd-find</code> установка (https://github.com/sharkdp/fd) <br> <code>fdfind</code> без аргументов заменяет ls -R для рекурсивного поиска в текущем каталоге <br> <code>fdfind pass /etc</code> ищет в указанной директории по частичному совпадению <br> <code>fdfind -H pre-commit</code> поиск скрытых файлов <br> <code>fdfind .yaml / | fzf</code> ищет все файлы с корня с выводов в fzf <br> <code>sudo fdfind .yaml / | fzf</code> отобразит все результаты поиска <br> <code>fdfind --type f -e pdf . $HOME | rofi -keep-right -dmenu -i -p FILES -multi-select | xargs -I {} xdg-open {}</code> интеграция с rofi (графическое меню) <br> <code>fd -e zip -x unzip</code> рекурсивно найти все zip-архивы и распаковать их<h2 id=bashrc><a aria-label="Anchor link for: bashrc" class=zola-anchor href=#bashrc><i class=icon></i></a> bashrc</h2><p><code>nano ~/.bashrc</code><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Псевдонимы для команды или набора команд с флагами для сокращения ввода </span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-alias z-shell">alias</span> <span class="z-entity z-name z-function z-alias z-shell">tspin</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell">tailspin</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-alias z-shell">alias</span> <span class="z-entity z-name z-function z-alias z-shell">ts</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell">tailspin</span></span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-storage z-type z-function z-shell">function</span> <span class="z-entity z-name z-function z-shell">Out-TailSpin</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span> <span class="z-punctuation z-section z-braces z-begin z-shell">{</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">     <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-language z-shell">@</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ts</span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-punctuation z-section z-braces z-end z-shell">}</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-alias z-shell">alias</span> <span class="z-entity z-name z-function z-alias z-shell">cot</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>Out-TailSpin cat<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span></span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Забиндить очистку ввода на Ctrl+C</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-bind z-shell">bind</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>"\C-l": "^\C-u\C-mclear\C-m"<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Определить переменную окружения, доступную для дочерних процессов, запущенных в текущей сессии</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Игнорировать запись в историю команд, которые начинаются с пробела</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-storage z-modifier z-shell">export</span> <span class="z-variable z-other z-readwrite z-assignment z-shell">HISTCONTROL</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell">ignorespace</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Добавить фильтрацию по введеному тексту в истории команд при испоьзовании стрелочек вверх и вниз</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-conditional z-if z-shell">if</span> <span class="z-meta z-function-call z-arguments z-shell"><span class="z-support z-function z-double-brace z-begin z-shell">[[</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-language z-shell">-</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-keyword z-operator z-logical z-shell">==</span> <span class="z-keyword z-operator z-regexp z-quantifier z-shell">*</span>i<span class="z-keyword z-operator z-regexp z-quantifier z-shell">*</span> <span class="z-support z-function z-double-brace z-end z-shell">]]</span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-conditional z-then z-shell">then</span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-bind z-shell">bind</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>"\e[A": history-search-backward<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-bind z-shell">bind</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>"\e[B": history-search-forward<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-conditional z-end z-shell">fi</span>
</span></code></pre><p><code>source ~/.bashrc</code> применить политики<h3 id=oh-my-bash><a aria-label="Anchor link for: oh-my-bash" class=zola-anchor href=#oh-my-bash><i class=icon></i></a> oh-my-bash</h3><p>Установить <code>oh-my-bash</code> (обновляет профиль, делая рядом резервную копию старого файла в <code>.bashrc.omb-TIMESTAMP</code>):<p><code>bash -c "$(curl -fsSL https://raw.githubusercontent.com/ohmybash/oh-my-bash/master/tools/install.sh)"</code><p>Настроить динамический профиль:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-storage z-type z-function z-shell">function</span> <span class="z-entity z-name z-function z-shell">sysStat</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span> <span class="z-punctuation z-section z-braces z-begin z-shell">{</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-variable z-other z-readwrite z-assignment z-shell">top</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">top</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>bn1</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-variable z-other z-readwrite z-assignment z-shell">cpu</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">top</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">grep</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>%Cpu(s)<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">awk</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>{printf "%.0f%%", 100-$8}<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> sys=$(echo "$top" | grep "%Cpu(s)" | awk '{printf "%.0f%%", $4}')</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> usr=$(echo "$top" | grep "%Cpu(s)" | awk '{printf "%.0f%%", $2}')</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-variable z-other z-readwrite z-assignment z-shell">avg</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">top</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">grep</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>load average<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">awk</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>F</span> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>: <span class="z-punctuation z-definition z-string z-end z-shell">'</span></span> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>{print $2}<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">awk</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>F</span> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>, <span class="z-punctuation z-definition z-string z-end z-shell">'</span></span> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>{print $1"/"$2"/"$3}<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-variable z-other z-readwrite z-assignment z-shell">mem</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">top</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">grep</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>MiB Mem<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">awk</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>{printf "%.1fG/%.1fG", ($8)/1024, $4/1024}<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-variable z-other z-readwrite z-assignment z-shell">disk</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">df</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>h</span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">awk</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>$NF=="/"{print $3"/"$2}<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>📊 <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">cpu</span></span> (<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">avg</span></span>) <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">mem</span></span> 💾 <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">disk</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-punctuation z-section z-braces z-end z-shell">}</span></span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-storage z-type z-function z-shell">function</span> <span class="z-entity z-name z-function z-shell">gitStatus</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span> <span class="z-punctuation z-section z-braces z-begin z-shell">{</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-variable z-other z-readwrite z-assignment z-shell">status</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">git</span></span><span class="z-meta z-function-call z-arguments z-shell"> status<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>porcelain</span> <span class="z-constant z-numeric z-integer z-decimal z-file-descriptor z-shell">2</span><span class="z-keyword z-operator z-assignment z-redirection z-shell">></span>/dev/null</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-keyword z-control z-conditional z-if z-shell">if</span> <span class="z-support z-function z-test z-begin z-shell">[</span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>z</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">status</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-support z-function z-test z-end z-shell">]</span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-conditional z-then z-shell">then</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">        <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">        <span class="z-meta z-function-call z-shell"><span class="z-keyword z-control z-flow z-return z-shell">return</span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-keyword z-control z-conditional z-end z-shell">fi</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-variable z-other z-readwrite z-assignment z-shell">branch</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">git</span></span><span class="z-meta z-function-call z-arguments z-shell"> rev-parse<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>abbrev-ref</span> HEAD</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-variable z-other z-readwrite z-assignment z-shell">result</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>🔸 (<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">branch</span></span>) <span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-variable z-other z-readwrite z-assignment z-shell">added</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">status</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">grep</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>c</span> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>^?<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-variable z-other z-readwrite z-assignment z-shell">modified</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">status</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">grep</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>c</span> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>^ M<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-variable z-other z-readwrite z-assignment z-shell">deleted</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">status</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">grep</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>c</span> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>^ D<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-support z-function z-test z-begin z-shell">[</span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">added</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>gt</span> 0 <span class="z-support z-function z-test z-end z-shell">]</span></span> <span class="z-keyword z-operator z-logical z-and z-shell">&&</span> <span class="z-variable z-other z-readwrite z-assignment z-shell">result</span><span class="z-keyword z-operator z-assignment z-shell">+=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>\e[32m+<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-expansion z-parameter z-begin z-shell">{</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-variable z-other z-readwrite z-shell">added</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-section z-expansion z-parameter z-end z-shell">}</span></span> \e[0m<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-support z-function z-test z-begin z-shell">[</span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">modified</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>gt</span> 0 <span class="z-support z-function z-test z-end z-shell">]</span></span> <span class="z-keyword z-operator z-logical z-and z-shell">&&</span> <span class="z-variable z-other z-readwrite z-assignment z-shell">result</span><span class="z-keyword z-operator z-assignment z-shell">+=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>\e[33m~<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-expansion z-parameter z-begin z-shell">{</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-variable z-other z-readwrite z-shell">modified</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-section z-expansion z-parameter z-end z-shell">}</span></span> \e[0m<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-support z-function z-test z-begin z-shell">[</span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">deleted</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>gt</span> 0 <span class="z-support z-function z-test z-end z-shell">]</span></span> <span class="z-keyword z-operator z-logical z-and z-shell">&&</span> <span class="z-variable z-other z-readwrite z-assignment z-shell">result</span><span class="z-keyword z-operator z-assignment z-shell">+=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>\e[31m-<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-expansion z-parameter z-begin z-shell">{</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-variable z-other z-readwrite z-shell">deleted</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-section z-expansion z-parameter z-end z-shell">}</span></span> \e[0m<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">result</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-punctuation z-section z-braces z-end z-shell">}</span></span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-storage z-modifier z-shell">export</span> <span class="z-variable z-other z-readwrite z-assignment z-shell">PROMPT_COMMAND</span><span class="z-keyword z-operator z-assignment z-shell">+=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>
</span></span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-single z-shell">    SYSSTAT=$(sysStat);
</span></span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-single z-shell">    GITSTATUS=$(gitStatus);
</span></span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span></span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">PS1</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>\[\e[34m\]$SYSSTAT \[\e[0m\]<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">PS1</span><span class="z-keyword z-operator z-assignment z-shell">+=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>\[\e[32m\]👤 \u \[\e[0m\]<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">PS1</span><span class="z-keyword z-operator z-assignment z-shell">+=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>\[\e[33m\]📁 \w \[\e[0m\]<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">PS1</span><span class="z-keyword z-operator z-assignment z-shell">+=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>$(echo -e "$GITSTATUS")<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">PS1</span><span class="z-keyword z-operator z-assignment z-shell">+=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>\[\e[34m\]> \[\e[0m\]<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span>
</span></code></pre><h3 id=fzf><a aria-label="Anchor link for: fzf" class=zola-anchor href=#fzf><i class=icon></i></a> fzf</h3><p><code>apt install fzf</code> установить <a href=https://github.com/junegunn/fzf>fzf</a> <br> <code>history | fzf</code> интерактивный поиск с фильтрацией <br> <code>eval $(history | fzf | awk '{print $2}')</code> выполнить (eval) выбранную команду из списка (добавить в макрос) <br> <code>find / -name "*.yaml" | fzf | xargs cat</code> найти в системе все файлы yaml и запустить по ним поиск<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">tee</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>a</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">HOME</span></span>/.bashrc<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-string z-unquoted z-heredoc z-shell"><span class="z-keyword z-operator z-assignment z-redirection z-shell"><<</span> <span class="z-punctuation z-definition z-string z-begin z-shell">'</span><span class="z-keyword z-control z-heredoc-token z-shell">EOF</span><span class="z-punctuation z-definition z-string z-end z-shell">'</span></span><span class="z-string z-unquoted z-heredoc z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell"># Поиск по истории команд с помощью команды h и комбинации Ctrl+R через fzf
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">export PROMPT_COMMAND='history -a;'
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">if command -v fzf > /dev/null; then
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">    function hstr {
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">        local current_input="$READLINE_LINE"
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">        command=$(tac $HOME/.bash_history | sed '/^#/d' | awk '!seen[$0]++' |  fzf --height 20 --reverse --query="$current_input" | sed -r "s/^\s+[0-9]+\s+[0-9]{4}-[0-9]{2}-[0-9]{2}\s+[0-9]{2}:[0-9]{2}:[0-9]{2}\s//")
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">        if [[ -n "$command" ]]; then
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">            READLINE_LINE="$command"
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">            READLINE_POINT=${#READLINE_LINE}
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">        fi
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">    }
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">    alias h=hstr
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">    bind -x '"\C-r": h'
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">fi
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell"># Kill jobs over fzf
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">if command -v fzf > /dev/null; then
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">    function jobKill {
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">        pid=$(jobs -l | fzf --height 20 --reverse --preview "echo {}" --preview-window down | awk '{print $2}')
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">        if [[ -n "$pid" ]]; then
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">            READLINE_LINE="kill -9 $pid"
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">            READLINE_POINT=${#READLINE_LINE}
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">        fi
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">    }
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">    bind -x '"\C-j": jobKill'
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell">fi
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell"><span class="z-string z-unquoted z-heredoc z-shell"><span class="z-keyword z-control z-heredoc-token z-shell">EOF</span></span></span>
</span></code></pre><h3 id=fzf-obc><a aria-label="Anchor link for: fzf-obc" class=zola-anchor href=#fzf-obc><i class=icon></i></a> fzf-obc</h3><p>Установить <a href=https://github.com/rockandska/fzf-obc>fzf over bash complete</a> (выпадающий список автодополнения команд) и добавить в профиль <code>bash</code>:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">git</span></span><span class="z-meta z-function-call z-arguments z-shell"> clone https://github.com/rockandska/fzf-obc <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">HOME</span></span>/.local/opt/fzf-obc</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>source <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">HOME</span></span>/.local/opt/fzf-obc/bin/fzf-obc.bash<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">>></span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">HOME</span></span>/.bashrc</span>
</span></code></pre><h3 id=hstr><a aria-label="Anchor link for: hstr" class=zola-anchor href=#hstr><i class=icon></i></a> hstr</h3><p><code>sudo apt install hstr</code> установить hstr (https://github.com/dvorka/hstr) <br> <code>hstr -f</code> избранное (Ctrl+F добавить в избранное) <br> <code>hstr -n bash log</code> вывести на экран отфильтрованную историю<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-conditional z-if z-shell">if</span> <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-command z-shell">command</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>v</span> hstr <span class="z-keyword z-operator z-assignment z-redirection z-shell">></span> /dev/null</span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-conditional z-then z-shell">then</span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-bind z-shell">bind</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>x</span> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>"\C-r": hstr<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-conditional z-end z-shell">fi</span>
</span></code></pre><h3 id=mcfly><a aria-label="Anchor link for: mcfly" class=zola-anchor href=#mcfly><i class=icon></i></a> mcfly</h3><p>Установить <a href=https://brew.sh>homebrew</a> и <a href=https://github.com/cantino/mcfly>mcfly</a>, который заменяет поиск истории через <code>Ctrl-R</code> на интеллектуальную поисковую систему, которая учитывает рабочий каталог и контекст недавно выполненных команд:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">/bin/bash</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>c</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">curl</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>fsSL</span> https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">>></span> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>/.bashrc</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-eval z-shell">eval</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">/home/linuxbrew/.linuxbrew/bin/brew</span></span><span class="z-meta z-function-call z-arguments z-shell"> shellenv</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-source z-shell">source</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>/.bashrc</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">brew</span></span><span class="z-meta z-function-call z-arguments z-shell"> install mcfly</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>eval "$(mcfly init bash)"<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">>></span> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>/.bashrc</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-source z-shell">source</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>/.bashrc</span>
</span></code></pre><h2 id=compgen><a aria-label="Anchor link for: compgen" class=zola-anchor href=#compgen><i class=icon></i></a> compgen</h2><p><code>compgen -c</code> выводит все команды, доступные в текущей оболочке <br> <code>compgen -a</code> выводит все алиасы, определенные в текущей оболочке <br> <code>compgen -b</code> выводит все встроенные команды Bash <br> <code>compgen -k</code> выводит все зарезервированные слова Bash <br> <code>compgen -v</code> выводит все переменные, определенные в текущей оболочке <br> <code>compgen -A export</code> выводит все экспортированные переменные <br> <code>compgen -A function</code> выводит все функции, определенные в текущей оболочке <br> <code>compgen -A arrayvar</code> выводит все массивы, определенные в текущей оболочке (echo ${BASH_ALIASES[@]}) <br> <code>compgen -A hostname</code> выводит все известные хосты <br> <code>compgen -A job</code> выводит все активные задания (ping ya.ru > /dev/null &) <br> <code>compgen -A service</code> выводит все службы (для систем, поддерживающих службы, например, через systemd) <br> <code>compgen -d</code> выводит все директории в текущем каталоге <br> <code>compgen -f</code> выводит все файлы и директории в текущем каталоге <br> <code>compgen -u</code> выводит всех пользователей системы <br> <code>compgen -g</code> выводит все группы системы <br> <code>compgen -W "start stop status restart" st</code> выводит список слов из wordlist, которые начинаются с prefix “st”<h2 id=cron><a aria-label="Anchor link for: cron" class=zola-anchor href=#cron><i class=icon></i></a> cron</h2><p><code>ls /etc/cron.d/</code> директория хранения задач различных пакетов (atop, sysstat) <br> <code>ls -l /etc/cron.hourly && ls -l /etc/cron.daily && ls -l /etc/cron.weekly && ls -l /etc/cron.monthly</code> директории для скриптов, которые надо выполнять раз в час, день, неделю и месяц <br> <code>crontab -l</code> просмотр задач <br> <code>crontab -l | grep -Pv "^$|^#"</code> отобразить только активные задания <br> <code>crontab -u lifailon -l</code> отобразить задачи пользователя root <br> <code>crontab -e</code> создать задачу от текущего пользователя <br> <code>sudo crontab -u root -e</code> создать задачу от пользователя root <br> <code>crontab -r</code> очистить все задачи<p><code>cat /etc/crontab</code><pre class=z-code><code><span class="z-text z-plain">#### # .---------------- минута (0 - 59)
</span><span class="z-text z-plain">#### # |  .------------- час (0 - 23)
</span><span class="z-text z-plain">#### # |  |  .---------- мень месяца (1 - 31)
</span><span class="z-text z-plain">#### # |  |  |  .------- месяц (1 - 12) или jan,feb,mar,apr...
</span><span class="z-text z-plain">#### # |  |  |  |  .---- день недели (0 - 6) (Воскресень 0 или 7) или sun,mon,tue,wed,thu,fri,sat
</span><span class="z-text z-plain">#### # |  |  |  |  |
</span><span class="z-text z-plain">#### # *  *  *  *  * user-name command to be executed
</span><span class="z-text z-plain">####  17  *  *  *  *   root    cd / && run-parts --report /etc/cron.hourly
</span><span class="z-text z-plain">####  25  6  *  *  *   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.daily )
</span><span class="z-text z-plain">####  47  6  *  *  7   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.weekly )
</span><span class="z-text z-plain">####  52  6  1  *  *   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.monthly )
</span></code></pre><p><code>0,14,29,44 * * * *</code> каждые 15 минут <br> <code>*/15 * * * *</code> каждые 15 минут<p><code>00 23 * * * systemctl restart zabbix-agent && echo $(date): Reboot Zabbix Agent use cron >> /var/log/reboot.log</code> выполнять перезапуск службы каждый день в 23:00 и писать в лог <br> <code>00 03 * * 6 echo $(date): Reboot Operating System use cron >> /var/log/reboot.log && /sbin/reboot</code> выполнять перезагрузку системы один раз в субботу в 3 часа ночи <br> <code>@reboot date >> ~/date-reboot.log</code> выполнять один раз после перезагрузки<p><code>journalctl -eu cron</code> <br> <code>cat /var/log/syslog | grep -i cron</code><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell">!/bin/bash</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">addr</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>google.com<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">path</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>/var/log/icmp-test.log<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">date</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">date</span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">awk</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>{print $3,$2,$4}<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">loss</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ping</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>c</span> 2 <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">addr</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">grep</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>Ewo</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>[0-9]+%<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-conditional z-if z-shell">if</span> <span class="z-support z-function z-test z-begin z-shell">[</span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">loss</span></span> <span class="z-keyword z-operator z-logical z-shell">=</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>100%<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-support z-function z-test z-end z-shell">]</span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-conditional z-then z-shell">then</span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">date</span></span>: <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">addr</span></span> - unavailable<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">>></span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">path</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-conditional z-else z-shell">else</span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">date</span></span>: <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">addr</span></span> - available<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">>></span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">path</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-conditional z-end z-shell">fi</span>
</span></code></pre><p><code>echo "*/1 * * * * bash /root/google-icmp-test.sh" >> /var/spool/cron/crontabs/root</code> добавить задачу в планироващик на выполнение скрипта каждую минуту<p><code>cp /etc/hosts /etc/hosts.bak</code> backup файла <br> <code>echo "11.11.11.11 google.com" >> /etc/hosts</code> изменить адрес для недоступности хоста <br> <code>cp /etc/hosts.bak /etc/hosts</code> восстановить файл <br> <code>cat /var/log/icmp-test.log | grep unavailable</code> отфильтровать лог по unavailable<h2 id=systemctl><a aria-label="Anchor link for: systemctl" class=zola-anchor href=#systemctl><i class=icon></i></a> systemctl</h2><p><code>systemctl reload ssh</code> обновить конфигурацию сервиса из файла юнита (если у юнита есть эта функция) <br> <code>systemctl status ssh</code> отображает состояние системы, юнитов (в том числе Failed) и запущенные процессы пользователей <br> <code>systemctl status sshd | grep -P "Active.+;" | sed -r "s/.+; | ago//g"</code> время работы службы <br> <code>systemctl start ssh</code> запустить юнит (до перезагрузки) <br> <code>systemctl stop ssh</code> остановить юнит (до перезагрузки) <br> <code>systemctl restart ssh</code> перезапустить сервис <br> <code>systemctl enable ssh</code> добавить в автозагрузку <br> <code>systemctl disable ssh</code> удалить из автозагрузки <br> <code>systemctl mask ssh</code> выключить юнит, который нельзя будет запустить вручную или как зависимость (создает симлинк на /dev/null) <br> <code>systemctl unmask ssh</code> включить юнит (удалить симлинк) <br> <code>systemctl daemon-reload</code> перезапустить юнит systemd <br> <code>systemctl cat ssh</code> отобразить путь и содержимое unit-файла <br> <code>systemctl edit --full ssh</code> открыть для редактирования файл юнита <br> <code>systemctl list-dependencies ssh</code> дерево зависимостей <br> <code>systemctl list-dependencies ssh --reverse</code> зависящие сервисы от указанного юнита <br> <code>systemctl list-units --type service --all</code> отображение статуса всех сервисов <br> <code>systemctl list-unit-files | sed "1d;$ d" | sed "$ d" | wc</code> отобразить кол-во всех файлов конфигурации сервисов на диске <br> <code>systemctl list-unit-files | grep zabbix</code> отфильтровать по имени <br> <code>systemctl list-unit-files --type=service</code> список всех сервисов <br> <code>systemctl list-unit-files --type=service --state=enabled</code> список сервисов, добавленных в автозагрузку <br> <code>systemctl list-units --all --type=service --plain --no-legend --no-pager --output=json</code> <br> <code>--all</code> выводить все типы юнитов, включая активные, неактивные и остановленные <br> <code>--type=service</code> выводить только системные службы управляемые systemd (не ключает в вывод другие типы юнитов, такие как socket или device) <br> <code>--plain</code> вывод в текстовом формате без форматирования <br> <code>--no-legend</code> отключает вывод заголовков для столбцов <br> <code>--no-pager</code> отключает использование постраничного вывода (less) <br> <code>ls /usr/lib/systemd/system</code> юниты поставляемые вместе с системой и устанавливаемыми приложениями <br> <code>ls /run/systemd/system</code> юниты созданные динамически в runtime <br> <code>ls /etc/systemd/system</code> юниты системного администратора<h3 id=systemctl-tui><a aria-label="Anchor link for: systemctl-tui" class=zola-anchor href=#systemctl-tui><i class=icon></i></a> systemctl-tui</h3><p><code>cargo install systemctl-tui --locked</code> быстрый и простой TUI-интерфейс для взаимодействия с службами и журналами systemd на Rust (https://github.com/rgwood/systemctl-tui), от создателя NuShell <br> <code>systemctl-tui</code><h3 id=unit><a aria-label="Anchor link for: unit" class=zola-anchor href=#unit><i class=icon></i></a> unit</h3><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell">!/bin/bash</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-loop z-while z-shell">while</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">true</span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-loop z-do z-shell">do</span>
</span><span class="z-source z-shell z-bash">    <span class="z-variable z-other z-readwrite z-assignment z-shell">addr</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>google.com<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-variable z-other z-readwrite z-assignment z-shell">path</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>/var/log/icmp-test.log<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-variable z-other z-readwrite z-assignment z-shell">date</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">date</span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">awk</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>{print $3,$2,$4}<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-variable z-other z-readwrite z-assignment z-shell">loss</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ping</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>c</span> 2 <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">addr</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">grep</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>Ewo</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>[0-9]+%<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-keyword z-control z-conditional z-if z-shell">if</span> <span class="z-support z-function z-test z-begin z-shell">[</span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">loss</span></span> <span class="z-keyword z-operator z-logical z-shell">=</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>100%<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-support z-function z-test z-end z-shell">]</span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-conditional z-then z-shell">then</span>
</span><span class="z-source z-shell z-bash">        <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">date</span></span>: <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">addr</span></span> - unavailable<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">>></span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">path</span></span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-keyword z-control z-conditional z-else z-shell">else</span>
</span><span class="z-source z-shell z-bash">        <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">date</span></span>: <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">addr</span></span> - available<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">>></span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">path</span></span></span>
</span><span class="z-source z-shell z-bash">        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">tail</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>n</span> 1 <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">path</span></span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-keyword z-control z-conditional z-end z-shell">fi</span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sleep</span></span><span class="z-meta z-function-call z-arguments z-shell"> 5</span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-loop z-end z-shell">done</span>
</span></code></pre><p><code>nano /etc/systemd/system/icmp-test-log.service</code><pre class="language-conf z-code" data-lang=conf><code class=language-conf data-lang=conf><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">[Unit]
</span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">Description</span><span class="z-keyword z-operator z-genconfig">=</span></span>icmp test output to log
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">After</span><span class="z-keyword z-operator z-genconfig">=</span></span>network<span class="z-keyword z-operator z-genconfig">.</span>target
</span><span class="z-source z-genconfig">
</span><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">[Service]
</span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">ExecStart</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-keyword z-operator z-genconfig">/</span>bin<span class="z-keyword z-operator z-genconfig">/</span>bash <span class="z-string z-quoted z-double z-genconfig">"/root/google-icmp-test.sh"</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">ExecReload</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-keyword z-operator z-genconfig">/</span>bin<span class="z-keyword z-operator z-genconfig">/</span>kill <span class="z-keyword z-operator z-genconfig">-</span><span class="z-support z-constant z-genconfig">HUP</span> <span class="z-storage z-source z-genconfig">$MAINPID</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">KillMode</span><span class="z-keyword z-operator z-genconfig">=</span></span>process
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">Restart</span><span class="z-keyword z-operator z-genconfig">=</span></span>on<span class="z-keyword z-operator z-genconfig">-</span>failure
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">Type</span><span class="z-keyword z-operator z-genconfig">=</span></span>simple
</span><span class="z-source z-genconfig">
</span><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">[Install]
</span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">WantedBy</span><span class="z-keyword z-operator z-genconfig">=</span></span>multi<span class="z-keyword z-operator z-genconfig">-</span>user<span class="z-keyword z-operator z-genconfig">.</span>target
</span></code></pre><p><code>systemctl daemon-reload</code> <br> <code>systemctl enable icmp-test-log.service</code> <br> <code>systemctl start icmp-test-log</code> <br> <code>systemctl status icmp-test-log</code> <br> <code>tail -f /var/log/icmp-test.log</code><h2 id=journalctl><a aria-label="Anchor link for: journalctl" class=zola-anchor href=#journalctl><i class=icon></i></a> journalctl</h2><p><code>journalctl --system</code> отобразить системный журнал <br> <code>journalctl --user</code> отобразить пользовательский журнал текущего пользователя <br> <code>journalctl -m</code> отобразить записи из всех доступных журналов (–merge) <br> <code>journalctl -ek</code> отобразить только сообщения ядра (kernel, –dmesg) из текущей загрузки <br> <code>journalctl -t systemd</code> показать записи с указанным идентификатором системного журнала <br> <code>journalctl _PID=3972315</code> отобразить сообщения по PID процесса <br> <code>journalctl -eu ssh</code> отобразить сообщения с конца (–pager-end) для выбранного сервиса (–unit)<p><code>g</code> перейти в начало листинга <br> <code>G</code> перейти в конец<p><code>journalctl -fu ssh</code> выводить новые сообщения в реальном времени (-f/–follow) <br> <code>journalctl -fu ssh</code> выводить новые сообщения в реальном времени (-f/–follow) <br> <code>journalctl -ru ssh</code> вывести сообщения с конца (сверху новые записи, –reverse) <br> <code>journalctl -n 100 -u ssh --no-pager</code> вывести 100 строк (–lines) из журнала и не передавать вывод на автоматический скроллинг <br> <code>journalctl -p 3</code> вывести записи с указанным приоритетом, например, только ошибки и выше по важности: неработоспособность(0), alerts(1), critical(2), errors(3), warning(4), notice(5), info(6), debug(7) <br> <code>journalctl -S "2023-09-01 12:00:00" -U "2023-09-01 15:00:00"</code> отобразить сообщения от (–since) 1 сентября c 12:00:00 по (–until) 15:00:00 <br> <code>journalctl --since today</code> отобразить сообщения за сегодня <br> <code>journalctl -b</code> отобразить сообщения с момента последней загрузки системы (boot) <br> <code>journalctl --list-boots</code> показать список сохраненных загрузок системы <br> <code>journalctl -b ba6b2292a0e84d83a81cedfaa221926f</code> показать сообщения с момента конкретной загрузки системы (–boot) <br> <code>journalctl --quiet</code> не показывать информационные сообщения и предупреждения о привилегиях <br> <code>journalctl --no-hostname</code> подавить вывод поля имени хоста <br> <code>journalctl -n 1 --no-pager --output=json-pretty</code> вывод в формате JSON (json-sse, json-seq) <br> <code>journalctl -n 1 --no-pager --output=json-pretty --output-fields=PRIORITY,MESSAGE</code> отфильтровать вывод<p><code>journalctl --fields</code> вывести список всех используемых полей (UNIT, USER_UNIT, _SYSTEMD_UNIT, _SYSTEMD_USER_UNIT и т.д.)<p><code>journalctl --field=UNIT > system_units.log</code> вывести список всех юнитов в системе <br> <code>journalctl --field=USER_UNIT > user_units.log</code> вывести список всех пользовательских юнитов в системе <br> <code>comm -12 <(sort system_units.log) <(sort user_units.log)</code> построчное сравнение двух отсортированных файлов со списком журналов без вывода общих строк в 1 и 2 файлах (-12)<p><code>journalctl --disk-usage</code> вывести общее использование диска всеми файлами журнала (Archived and active journals take up 2.3G in the file system) <br> <code>journalctl --flush</code> очистить все данные журнала из директорий /run в /var <br> <code>journalctl --vacuum-time=1month</code> удалить файлы журнала, старше указанного времени (1-го месяца) <br> <code>journalctl --vacuum-size=100M</code> очистить логи, чтобы размер хранилища соответствовал указанному размеру <br> <code>journalctl --vacuum-files=100</code> оставить только указанное количество файлов журнала <br> <code>journalctl --rotate</code> запустить немедленную ротацию файлов журнала <br> <code>journalctl --sync</code> синхронизировать незаписанные сообщения журнала на диск <br> <code>journalctl --relinquish-var</code> прекратить запись на диск, войти во временную файловую систему <br> <code>journalctl --verify</code> проверить целостность файла журнала<p><code>journalctl --header</code> вывести список журналов <br> <strong>File path</strong> - путь к файлу журнала на диске <br> <strong>Incompatible flags</strong> - несовместимые флаги с этим журналом <br> <strong>Rotate suggested</strong> - применяется ли ротация к журналу <br> <strong>Tail sequential number</strong> - последовательный номер для конца журнала (указывает на последнее событие в журнале) <br> <strong>Head realtime timestamp</strong> - время первого события в журнале <br> <strong>Tail realtime timestamp</strong> - время последнего события в журнале <br> <strong>Objects</strong> - количество объектов, находящихся в журнале (таких как записи, и не только) <br> <strong>Entry objects</strong> - количество объектов, представляющих записи в журнале <br> <strong>Data objects</strong> - количество объектов данных, хранящихся в журнале <br> <strong>Field objects</strong> - Количество объектов полей (список полей можно получить через –fields) <br> <strong>Disk usage</strong> - используемое пространство на диске для этого журнала<p><code>nano /etc/systemd/journald.conf</code><pre class="language-conf z-code" data-lang=conf><code class=language-conf data-lang=conf><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">Storage</span><span class="z-keyword z-operator z-genconfig">=</span></span>auto<span class="z-meta z-comment z-genconfig"> <span class="z-comment z-line z-number-sign z-genconfig"># журналы сохраняются в /var/log/journal на диске (если доступно достаточно места), или в памяти (/run/log/journal) при недостатке места на диске
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">Storage</span><span class="z-keyword z-operator z-genconfig">=</span></span>persistent<span class="z-meta z-comment z-genconfig"> <span class="z-comment z-line z-number-sign z-genconfig"># журналы всегда сохраняются на диске
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">Storage</span><span class="z-keyword z-operator z-genconfig">=</span></span>volatile<span class="z-meta z-comment z-genconfig"> <span class="z-comment z-line z-number-sign z-genconfig"># журналы хранятся только в памяти (не сохраняются на диск)
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">Storage</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-language z-genconfig">none</span><span class="z-meta z-comment z-genconfig"> <span class="z-comment z-line z-number-sign z-genconfig"># журналы не сохраняются
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">Seal</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-language z-genconfig">yes</span><span class="z-meta z-comment z-genconfig"> <span class="z-comment z-line z-number-sign z-genconfig"># включает подписание журналов для обеспечения их целостности. Это добавляет цифровую подпись в журналы, чтобы защитить их от изменений
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">SyncIntervalSec</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-numeric z-genconfig">5m</span><span class="z-meta z-comment z-genconfig"> <span class="z-comment z-line z-number-sign z-genconfig"># интервал между синхронизациями журнала с диском (5 минут)
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">RateLimitIntervalSec</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-numeric z-genconfig">30s</span><span class="z-meta z-comment z-genconfig"> <span class="z-comment z-line z-number-sign z-genconfig"># временной интервал, в течение которого будет ограничено количество записей журнала, если они приходят слишком часто
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">RateLimitBurst</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-numeric z-genconfig">10000</span><span class="z-meta z-comment z-genconfig"> <span class="z-comment z-line z-number-sign z-genconfig"># максимальное количество записей, которое можно сделать в журнал за интервал RateLimitIntervalSec
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">SystemMaxUse</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-numeric z-genconfig">500M</span><span class="z-meta z-comment z-genconfig"> <span class="z-comment z-line z-number-sign z-genconfig"># ограничивает максимальное количество дискового пространства, которое могут занимать системные журналы, если пространство превышает этот лимит, старые журналы будут удаляться
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">SystemKeepFree</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-numeric z-genconfig">1G</span><span class="z-meta z-comment z-genconfig"> <span class="z-comment z-line z-number-sign z-genconfig"># минимальное количество свободного места на диске, которое должно оставаться для других системных задач, если места на диске становится меньше, система начнет удалять старые журналы
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">SystemMaxFileSize</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-meta z-comment z-genconfig"> <span class="z-comment z-line z-number-sign z-genconfig"># ограничивает размер одного файла журнала на диске. Если файл превышает этот размер, он будет разделен
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">SystemMaxFiles</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-numeric z-genconfig">100</span><span class="z-meta z-comment z-genconfig"> <span class="z-comment z-line z-number-sign z-genconfig"># максимальное количество файлов журнала, которые могут быть созданы, старые файлы будут удаляться, чтобы освободить место для новых
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">MaxRetentionSec</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-numeric z-genconfig">1month</span><span class="z-meta z-comment z-genconfig"> <span class="z-comment z-line z-number-sign z-genconfig"># максимальный срок хранения журналов (например, журналы будут храниться не более месяца)
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">ForwardToSyslog</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-language z-genconfig">yes</span><span class="z-meta z-comment z-genconfig"> <span class="z-comment z-line z-number-sign z-genconfig"># должны ли записи журнала перенаправляться в системный журнал (syslog), это позволяет перенаправлять журнал в другие системы, например, rsyslog
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">orwardToKMsg</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-language z-genconfig">no</span><span class="z-meta z-comment z-genconfig"> <span class="z-comment z-line z-number-sign z-genconfig"># должны ли записи журнала перенаправляться в буфер ядра (KMsg)
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">ForwardToConsole</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-language z-genconfig">no</span><span class="z-meta z-comment z-genconfig"> <span class="z-comment z-line z-number-sign z-genconfig"># должны ли записи журнала отображаться на консоли работающего в системе через TTY (не в терминал других пользователей)
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">ForwardToWall</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-language z-genconfig">yes</span><span class="z-meta z-comment z-genconfig"> <span class="z-comment z-line z-number-sign z-genconfig"># должны ли записи журнала отображаться всем пользователям, работающим в системе (уведомления будут выводиться всем пользователям через команду wall)
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">MaxLevelStore</span><span class="z-keyword z-operator z-genconfig">=</span></span>debug<span class="z-meta z-comment z-genconfig"> <span class="z-comment z-line z-number-sign z-genconfig"># максимальный уровень журналируемых записей, которые будут сохраняться (emerg, alert, crit, error, warning, notice, info, debug)
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">MaxLevelSyslog</span><span class="z-keyword z-operator z-genconfig">=</span></span>debug<span class="z-meta z-comment z-genconfig"> <span class="z-comment z-line z-number-sign z-genconfig"># максимальный уровень журналируемых записей, которые будут отправляться в syslog
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">MaxLevelWall</span><span class="z-keyword z-operator z-genconfig">=</span></span>emerg<span class="z-meta z-comment z-genconfig"> <span class="z-comment z-line z-number-sign z-genconfig"># максимальный уровень журналируемых записей, которые будут выводиться всем пользователям через команду wall
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">LineMax</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-numeric z-genconfig">48K</span><span class="z-meta z-comment z-genconfig"> <span class="z-comment z-line z-number-sign z-genconfig"># максимальный размер строки, которая может быть записана в журнал (по умолчанию 48 КБ)
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">Audit</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-language z-genconfig">no</span><span class="z-meta z-comment z-genconfig"> <span class="z-comment z-line z-number-sign z-genconfig"># журналировать события аудита (связанных с безопасностью, например, вход в систему, попытки доступа к файлам и изменения файловых прав, Запуск и завершение процессов и т.п.)
</span></span></span></code></pre><p><code>sudo systemctl restart systemd-journald</code><h2 id=dmesg><a aria-label="Anchor link for: dmesg" class=zola-anchor href=#dmesg><i class=icon></i></a> dmesg</h2><p><code>dmesg -Tx</code> прочитать логи буфера сообщений ядра (/var/log/dmesg), используется для записи во время загрузки системы пока сервис Syslog ещё не запущен <br> <code>dmesg -Tx -l crit,err</code> отфильтровать вывод <br> <code>dmesg -E</code> включить логирвоание ядра в консоль (–console-on) <br> <code>dmesg -D</code> отключить (–console-off) <br> <code>dmesg -n 1</code> изменить уровень логирования для печати в консоль <br> <code>dmesg -u</code> отображать вывод из программ окружения пользователя <br> <code>dmesg -w</code> выводить журнал в реальном времени (ждать новых сообщений)<h2 id=hardware><a aria-label="Anchor link for: hardware" class=zola-anchor href=#hardware><i class=icon></i></a> hardware</h2><p><code>systemd-analyze</code> отображает статистику времени загрузки ОС (Kernel - время загрузки ядра) и userspace <br> <code>systemd-analyze blame</code> отобразить все процессы и отсортировать по времени загрузки <br> <code>systemd-analyze blame | grep zabbix</code> <br> <code>systemd-analyze plot > graph.svg</code> создать векторный отчет в формате Scalable Vector Graphics описанный XML<p><code>history</code> история команд <br> <code>history -c</code> очистить историю<p><code>who -b</code> время последнего включения <br> <code>last</code> история авторизации <br> <code>last -n 5 reboot</code> история перезагрузки <br> <code>last shutdown</code> история выключений<p><code>arch</code> архитектура системы <br> <code>lsb_release -a</code> версия дистрибутива <br> <code>uname -srv</code> версия ядра <br> <code>cat /proc/version</code> версия ядра и дистрибутива <br> <code>cat /etc/os-release</code> описание дистрибутива и версия ОС <br> <code>hostnamectl</code> подробная информация (Operating System, Kernel, Architecture, Hardware Vendor/Model)<p><code>uptime</code> время работы системы, кол-во залогиненных пользователей, Load average - средняя загрузка системы за последние 1, 5 и 15 минут (2.00 - это 100% на два ядра) <br> <code>dmidecode -t bios</code> информация о системе (system/baseboard/processor/memory) <br> <code>dmidecode -s bios-vendor</code> информация о системе (bios-version/bios-release-date/baseboard-manufacturer/system-manufacturer/processor-version) <br> <code>dmidecode -t baseboard</code> версия материнской платы, Video и Sound и их статус<p><code>nproc</code> кол-во ядер <br> <code>lscpu</code> информация о процессоре <br> <code>cat /proc/cpuinfo</code> информация о процессоре <br> <code>cat /proc/cpuinfo | grep "core id" | wc -l</code> количество уникальных ядер (без учета потоков) <br> <code>cat /proc/partitions</code> перечисляет все устройства хранения и разделы на этих устройствах хранения <br> <code>cat /proc/asound/cards</code> Audio PCI <br> <code>cat /proc/cmdline</code> содержит имя файла образа ядра и его параметры запуска, которые были указаны в приглашении загрузчика GRUB (позволяет идентифицировать параметры загрузки, которые были введены вручную) <br> <code>cat /etc/default/grub</code> содержит конфигурацию, которую использует команда update-grub для создания файла /boot/grub/grub.cfg <br> <code>cat /boot/grub/grub.cfg</code> команда update-grub генерирует этот файл автоматически в соответствии с настройками, заданными в файле /etc/default/grub <br> <code>cat /proc/loadavg</code> среднее количество процессов или потоков, которые выполняются, находятся в очереди на выполнение или ждут завершения операций ввода/вывода за последние 1, 5 и 15 минут. 4-е значение, это количество процессов выполняемых в данный момент/общее количество процессов в системе. Последнее значение, это PID последнего созданного процесса.<p><code>lspci</code> информация о устройствах, подключенные к материнской плате компьютера по шине PCIe <br> <code>lspci | grep -i vga</code> узнать какая используется видеокарта (VGA controller) <br> <code>lspci | grep -i audio</code> Audio controller <br> <code>lspci | grep -i ethernet</code> Ethernet controller <br> <code>lspci | grep -i scsi</code> SCSI storage controller <br> <code>lspci | grep -i sata</code> SATA storage controller <br> <code>lspci | grep "USB controller"</code> <br> <code>lspci | grep 02:00.0</code> фильтровать информацию по слоту устройства <br> <code>lspci -vv | grep -iE "driver"</code> отобразить список загруженных драйверов ядра для устройств <br> <code>lsusb -vt</code> информация о USB устойствах (принтеры, Bluetooth адаптер, мышка, клавиатура)<p><code>lshw -short</code> информацию по каждому устройству <br> <code>lshw -class bus</code> Motherboard/USB <br> <code>lshw -class display</code> VGA controller <br> <code>lshw -class network</code> <br> <code>lshw -class disk</code> информация о жестком диске (product, vendor, size, capabilities: 7200rpm) <br> <code>lshw | grep product</code><p><code>ls /sys/class/net</code> список сетевых интерфейсов <br> <code>cat /proc/net/dev</code> список сетевых интерфейсов и их статистика (bytes, packets, errs, drop) для Receive (Прием) и Transmit (Передача) <br> <code>ethtool -S ens33</code> статистика сетевого интерфейса (для сброса статистики нужно ip down и выгрузить модуль ядра с драйверов modprobe -r module и вернуть обратно) <br> <code>ethtool ens33 | grep -Ei "wake-on|speed"</code> поддержка Wake-on-Lan и скорость сетевого интерфейса <br> <code>ethtool -i ens33</code> драйвер сетевой карты <br> <code>ethtool ens33 -p 100</code> включить светодиод на сетевой карте на 100 секунд<p><code>cat /sys/block/sda/stat</code> статистика диска sda <br> <code>lsmod</code> список всех загруженных модулей ядра вместе с зависимостями <br> <code>/proc/modules</code> содержится список всех загруженных модулей ядра <br> <code>modinfo ip_tables</code> информация о конкретном модуле <br> <code>ls /etc/*modprobe*</code> содержит конфигурационные файлы со списками модулей ядра <br> <code>cat /etc/modprobe.d/mdadm.conf \ </code>/etc/modules-load.d/` директория, которая содержит файлы со списками модулей, которые должны быть загружены при запуске системы<p><code>ls -l /var/lib/apt/periodic/update-success-stamp</code> дата последнего выполнения apt update <br> <code>ls -l /var/cache/apt/pkgcache.bin</code> местоположение кэша пакетов apt <br> <code>HISTTIMEFORMAT="%d/%m/%y %T " history | grep "apt update"</code> история команды обновления с точкой времени<p><code>cat /etc/hostname</code> имя хоста <br> <code>cat /etc/services | grep -iE "ntp|zabbix"</code> список всех сервисов и сопоставленных им портов в системе <br> <code>cat /etc/mime.types | grep -Ew "json|csv"</code> список сопосталвения файлов и их программ для открытия в системе<p><code>cat /etc/hosts</code> локальная таблица преобразовани ip в имя <br> <code>cat /etc/hosts.allow && cat /etc/hosts.deny</code> ограничить доступ к внешним сервисам <br> <code>cat /etc/hosts.{allow,deny} | grep -Pv "^$|^#"</code> <br> <code>echo "in.telnetd: 192.168.3., .domain.ru" >> /etc/hosts.allow</code> разрешить соединение только для указанной подсети и домена<p><code>ls -l /dev | grep sd</code> вывести список всех дисков и разделов в файловой системе <br> <code>ls -l /dev | grep -wo sd.</code> вывести только список дисков <br> <code>cat /proc/diskstats</code> статистика дисков <br> <code>cat /proc/stat</code> cpu user/nice/system/idle/iowait/irq/softirq/steal_time, ctxt - общее количество переключений контекста на всех процессорах, btime - время загрузки системы в секундах с начала эпохи unix, processes - указывается количество созданных процессов и потоков, включая (но не ограничиваясь ими) те, которые созданы вызовами системных вызовов fork() и clone(), procs_blocked - количество процессов, заблокированных в данный момент и ожидающих завершения ввода-вывода <br> <code>stat -f /dev/sda</code> <br> <code>cat /proc/buddyinfo</code> информация о фрагментации памяти в ядре Linux, спользуется для диагностики проблем с фрагментацией памяти <br> <code>cat /proc/cgroups</code> система контейнеризации и управления ресурсами доступными для процессов cgroups, позволяет ограничить доступ к любым ресурсам для процесса, а также контролировать его поведение в системе<h2 id=sysctl><a aria-label="Anchor link for: sysctl" class=zola-anchor href=#sysctl><i class=icon></i></a> sysctl</h2><p><code>sysctl -a</code> отобразить все параметры/настройки ядра Linux (Kernel), где представленны все параметры в виде переменных, имена переменных соответствуют пути файла в директории /proc/sys (вместо слеша в переменной используется точка) <br> <code>sysctl net.ipv6.conf.all</code> <br> <code>sysctl net.ipv6.conf.all.disable_ipv6=1</code> отключить протокол IPv6 (> /proc/sys/net/ipv6/conf/ens33/disable_ipv6) <br> <code>sysctl net.ipv6.conf.ens33.disable_ipv6=1</code> для интерфейса ens33 <br> <code>sysctl --system</code> обновление информации из файлов/вернуть значения переменных до состояния сохраненного в файлах (удалить временные изменения из sysctl) <br> <code>sysctl -w net.ipv6.conf.ens33.disable_ipv6=1</code> сохранить настройку после перезагрузки (-w записать в файл) <br> <code>sysctl fs.file-nr</code> кол-во открытых файловых дескрипторов в текущий момент, открытые файлы которые сейчас не используются, максимальное количество для открытия <br> <code>sysctl -a | grep fs.file-max</code> максимальное количество открытых файлов (дескрипторов), которые могут быть открыты в файловой системе всеми процессами на уровне ядра ОС <br> <code>nano /proc/sys/fs/file-max</code> изменить значение кол-ва дескрипторов <br> <code>echo "fs.file-max=500000" >> /etc/sysctl.conf</code> добавить в конфигурацию sysctl.conf <br> <code>sysctl -p</code> применить настройки <br> <code>sysctl fs.nr_open</code> лимит открытия файлов для каждого процесса отдельно <br> <code>ls /proc/1/fd/ | wc -l</code> узнать кол-во открытых дескрипторов у процессора с PID 1 <br> <code>sysctl fs.aio-nr</code> количество асинхронных операций ввода и вывода файловой системе в масштабе всей системы (Asynchronous IO number requests) <br> <code>sysctl fs.aio-max-nr</code> максимальное количество асинхронных операций ввода-вывода, рекомендуемое минимальное значение для fs.aio-max-nr — 1048576, но в загруженной среде ASE со многими ядрами может потребоваться настроить большее число <br> <code>sysctl fs.inotify.max_queued_events</code> подсистема ядра inotify позволяет следить за изменениями в файловой системе, устанавливает максимальное количество событий, которые могут находиться в очереди, перед тем как их обработает программа <br> <code>sysctl fs.inotify.max_user_watches</code> максимальное количество файлов и директорий, за которыми может наблюдать один объект inotify <br> <code>sysctl fs.inotify.max_user_instances</code> максимальное количество объектов inotify, которые может создать один пользователь <br> <code>sysctl fs.mqueue.queues_max</code> максимальное количества очередей сообщений POSIX, разрешенных в системе, которые позволяют процессам (и их потокам) обмениваться данными в виде сообщений (создаются и открываются с помощью функции mq_open) <br> <code>sysctl fs.mqueue.msg_max</code> максимального количества сообщений в значении очереди <br> <code>sysctl fs.mqueue.msgsize_max</code> максимальный размера сообщения <br> <code>sysctl vm.min_free_kbytes</code> минимальный размер свободной оперативной памяти который необходимо поддерживать <br> <code>sysctl vm.swappiness</code> процент свободной памяти, по достижении которого данные начинают переноситься на SWAP раздел <br> <code>sysctl -w vm.swappiness=80</code> при 80% свободной памяти (свыше 20% занятой оперативной памяти) начнет использоваться SWAP, в котоый помещяются неиспользуемые процессами страницы памяти на текущий момент, если приложению потребуются эти страницы, процесс их перенесения из раздела подкачки обратно в оперативную память (данные нужно обратно считать с диска в память) <br> <code>sysctl -w vm.swappiness=10</code> файл подкачки (выгрузка в виртуальную память) активируется только в том случае, если свободно 10% оперативной памяти <br> <code>sysctl vm.vfs_cache_pressure</code> скорость удаления dentry и inode из кэша (100 по умолчанию) <br> <code>sysctl vm.dirty_background_ratio</code> процент от общей оперативной памяти который может быть заполнен страничным кэшем, по достижении которой демон pdflush (dirty page flush) начинает сбрасывать данные из кэша оперативной памяти на диск. Когда объем свободной памяти становится меньше этого порога, ядро вызывает функцию wakeup_bdflush() для перевода в состояние выполнения потока pdflush, который выполняет функцию обратной записи измененных страниц памяти background_writeout() на диск, эта функция получает один параметр количества страниц, которые функция должна попытаться записать на диск. <br> <code>sysctl -w vm.dirty_background_ratio=5</code> <br> <code>sysctl vm.dirty_ratio</code> вернхний предел объема оперативной памяти в процентах от free Available который может быть выделен под PageCache до их записи на диск, на этом уровне все новые операции ввода-вывода приостанавливаются до тех пор, пока на диск не будут записаны грязные (Dirty) страницы, значение должно быть выше чем dirty_background_ratio <br> <code>sysctl vm.dirty_expire_centisecs</code> время хранения грязных (Dirty) страниц в кэше в сотых долях секунд (3000 = 30 секунд) для их записи на диск с целью. Функция wb_kupdate() демона pdflush выполняет обратную запись данных на диск, которые были изменены более чем dirty_expire_centisecs для синхронизации страничного кэша с данными на диске, т.к. при сбое, т.к. содержимое памяти после перегрузки не сохраняется. <br> <code>sysctl vm.dirty_writeback_centisecs</code> интервал процесса проверки данных, которые подлежат записи на диск (500 - 5 секунд) <br> <code>sysctl abi.vsyscall32</code> разрешает выполнение 32 битных программ в 64 битной системе (по умолчанию 1 - разрешает) <br> <code>sysctl kernel.hostname</code> изменить имя компьютера без перезагрузки <br> <code>sysctl kernel.printk</code> уровень логирования <br> <code>sysctl -w kernel.printk="2 4 1 7"</code> <br> <code>sysctl net.ipv4.ip_default_ttl</code> значение по-умолчанию для величины Time To Live исходящих пакетов (продолжительность жизни пакета в Internet - каждый раз, когда пакет попадает на очередной роутер, брандмауэр и т.п. величина TTL пакета уменьшается на 1) <br> <code>sysctl net.ipv4.ip_no_pmtu_disc</code> запрещает поиск Path Maximum Transfer Unit (максимальный размер пакета для выбранного пути, это не MTU), когда система будет пытаться определить максимальный размер пакета, при котором не потребуется выполнять их фрагментацию, для передачи на заданный хост <br> <code>sysctl net.ipv4.tcp_mem</code> векторная переменная (минимум, режим нагрузки, максимум), которая cодержит общие настройки потребления памяти для протокола TCP, измеряется в страницах (обычно 4Кб), а не байтах. Пока общий размер памяти для целей протокола TCP ниже минимального количества страниц, операционная система ничего не делает с памятью используемой различными TCP сокетами, в режиме нагрузки TCP начинает быстро освобождать память, и последний максимальный - объем памяти, который может использоваться для нужд TCP и при его достижении, начинаются потери пакетов. <br> <code>sysctl net.ipv4.tcp_rmem</code> векторная величина размера буфера сокетов TCP для приема. Каждый сокет TCP имеет право использовать минимальную память по факту своего создания (по умолчанию – 4096 байт, 4 Кб) и его не стоит увеличивать, т.к. при высокой нагрузки займут много памяти. Значение по умолчанию применяется взамен параметра rmem_default (который используется другими протоколами), второй параметр - по умолчанию имеет удвоенное значение, 87380 * 2 bytes, или 174760 байт (170 Кб). Максимально возможный размер приемного буфера, это значение не отменяет максимума, заданного в rmem_max <br> <code>sysctl net.ipv4.tcp_wmem</code> векторная величина размера буфера сокетов TCP для передачи <br> <code>sysctl net.core.rmem_default</code> значение по умолчанию (имеет ниже приоритет, чем tcp_rmem) <br> <code>sysctl net.core.wmem_default</code> значение по умолчанию <br> <code>sysctl net.core.rmem_max</code> максимальный размер буфера на сокете получения данных в байтах (глобальный параметр, имеет выше приоритет, чем tcp_rmem) <br> <code>sysctl net.core.wmem_max</code> максимальный размер буфера на сокете передачи данных в байтах <br> <code>sysctl net.core.optmem_max</code> максимальный объём опциональных буферов памяти <br> <code>sysctl -w net.core.rmem_max=26214400 && sysctl -w net.core.rmem_default=26214400</code> увеличить до 25 МБайт <br> <code>sysctl -w net.core.wmem_max=26214400 && sysctl -w net.core.wmem_default=26214400</code> увеличить до 25 МБайт <br> <code>sysctl net.ipv4.tcp_no_metrics_save</code> по умолчанию (0) TCP сохраняет различные метрики соединения в кэше маршрута при закрытии соединения, при включении (1) TCP не будет кэшировать метрики при закрытии соединений <br> <code>sysctl net.ipv4.icmp_echo_ignore_all</code> если включено, ядро будет игнорировать все icmp запросы (рекомендуется для защиты от DOS атак) <br> <code>sysctl net.ipv4.icmp_echo_ignore_broadcasts</code> игнорировать запросы ICMP ECHO, переданные широковещательными пакетами <br> <code>sysctl net.ipv4.icmp_ignore_bogus_error_responses</code> игнорировать ошибочные ICMP запросы <br> <code>sysctl net.ipv4.conf.all.accept_source_route</code> разрешать маршрутизацию от источников, при включении, позволяет отправителю определить путь, по которому пакет должен пройти по сети Internet, чтобы достигнуть пункта назначения. Это удобно для изучения и отладки работы сети, но нарушитель получает возможность подмены адресов компьютеров локальной сети и может попытаться подсунуть поддельные маршруты для того, чтобы перенаправить весть трафик через узел, который он контролирует (атака Man In The Middle). <br> <code>sysctl net.ipv4.conf.all.accept_redirects</code> запретить(0)/разрешить(1) принимать и отправлять ICMP пакеты перенаправления <br> <code>sysctl net.ipv4.conf.all.send_redirects</code> <br> <code>sysctl net.ipv4.conf.all.secure_redirects</code> <br> <code>sysctl net.ipv4.ip_forward</code> разрешает (1) или запрещает (0) маршрутизацию пакетов через текущий хост <br> <code>sysctl net.ipv4.conf.default.forwarding</code> включить форвардинг пакетов - разрешить ядру операционной системы осущетсвлять проброс трафика с одного интерфейса на другой <br> <code>sysctl net.ipv4.ip_local_port_range</code> диапазон локальных портов, доступных для установки исходящих подключений (создания локальных клиентских сокетов) <br> <code>sysctl net.ipv4.tcp_max_tw_buckets</code> максимальное число сокетов, находящихся в состоянии TIME-WAIT одновременно, для предотвращения простейших разновидностей DoS-атак <br> <code>sysctl net.ipv4.tcp_tw_recycle</code> разрешает/запрещает быструю утилизацию сокетов, находящихся в состоянии TIME-WAIT <br> <code>sysctl net.ipv4.tcp_tw_reuse</code> позволять повторное использование TIME-WAIT сокетов в случаях, если протокол считает это безопасным <br> <code>sysctl net.ipv4.tcp_rfc1337</code> защита от TIME-WAIT атак <br> <code>sysctl net.ipv4.tcp_max_orphans</code> максимальное число “осиротевших” TCP сокетов, не связанных каким-либо идентификатором пользовательского файла (user file handle), при достижение этого значения, соединения сбрасываются. Этот порог помогает предотвращать простые атаки DoS и увеличение параметра влияет на ОЗУ, каждое orphan-соединение поглощает около 64 Кбайт не сбрасываемой на диск (unswappable) памяти и не может быть сброшена в SWAP. При возникновении проблем, связанных с этим ограничением – в системный журнал будет подобное сообщение: TCP: too many of orphaned sockets, и это может служить поводом пересмотреть значения tcp_fin_timeout или tcp_orphan_retries. <br> <code>sysctl -w net.ipv4.tcp_max_orphans=65536</code> <br> <code>sysctl net.ipv4.tcp_orphan_retries</code> число попыток закрыть соединение перед тем как оно будет разорвано принудительно и уничтожается TCP соединение, закрытое на локальной стороне сервера. По умолчанию используется значение 7, соответствующее приблизительно периоду от 50 секунд до 16 минут в зависимости от RTO (Retransmission Timeout). <br> <code>sysctl net.ipv4.tcp_fin_timeout</code> задает максимальное время пребывания сокета в состоянии FIN-WAIT-2 и используется если другая сторона не закрыла соединение со своей стороны. Каждый сокет занимает в памяти 1.5 Кб, что может привести к значительным утечкам памяти в некоторых случаях. <br> <code>sysctl net.ipv4.tcp_syncookies</code> помогает защититься от атак SYN flood, срабатывает только при достижении значения net.ipv4.tcp_max_syn_backlog, если количество SYN пакетов забивает всю очередь, включается механизм Syn cookies. SYN cookies вообще не использует очередь SYN, вместо этого ядро отвечает на каждый SYN пакет, как обычно SYN/ACK, но туда будет включено специально сгенерированное число на основе IP адресов и портов источника и получателя, а также времени посылки пакета. Атакующий никогда не получит эти пакеты, а поэтому и не ответит на них. При нормальном соединении, будет послан третий пакет, содержащий число, а сервер проверит был ли это ответ на SYN cookie и, если да, то разрешит соединение даже в том случае, если в очереди SYN нет соответствующей записи. <br> <code>sysctl net.ipv4.tcp_fastopen</code> помогает уменьшить задержки в сети, позволяя начать передачу данных сразу при отправке клиентом первого TCP SYN (3 - включает для входящих и исходящих) <br> <code>sysctl net.ipv4.tcp_max_syn_backlog</code> размер очереди (максимальное число) запоминаемых запросов на попытку установки TCP соединений (SYN-пакета в состоянии Waiting Acknowledgment) при отправки клиентом TCP SYN пакета, для которых не было получено сервером подтверждения от клиента (полуоткрытых соединений) <br> <code>sysctl -w net.ipv4.tcp_max_syn_backlog=4096</code> увеличить, если на сервере возникают перегрузки <br> <code>sysctl net.core.somaxconn</code> размер очереди (максимальное число) полуоткрытых соединений (открытых сокетов) ожидающих установки соединения. Если в ответ на SYN-пакета (synchronize) клиентом был получен от сервера пакет SYN-ACK (acknowledges), сервер ожидает от клиента отправки ACK пакета, после чего соединение считается установленным. <br> <code>sysctl net.ipv4.tcp_syn_retries</code> количество попыток передачи SYN-пакета при установлении нового соединения, на каждую попытку отводится примерно 30-40 секунд. Значение по-умолчанию 5 = 180 секундам. <br> <code>sysctl net.ipv4.tcp_synack_retries</code> количество попыток передачи SYN-ACK-пакета в ответ на SYN-запрос для установки пассивного TCP-соединение, инициированное другим хостом, если уменьшить до одного, будет примерно 9 секунд <br> <code>sysctl net.core.netdev_max_backlog</code> регулирует размер очереди пакетов между сетевой картой и ядром, если ядро не успевает обрабатывать пакеты (если сетевой интерфейс получает пакеты быстрее, чем ядро может их обработать) и очередь переполняется, то новые пакеты отбрасываются, если увеличить значение, можно справиться с пиковыми нагрузками <br> <code>sysctl -a | grep net.ipv4.tcp_keepalive</code> после неактивности сокета посылает пакет keepalive на второую сторону, содержащий нулевые данные, после отправки первого пакета через время, указанное в tcp_keepalive_time отправляет повторно пакеты через каждые tcp_keepalive_intvl секунд tcp_keepalive_probes раз, если другая сторона не отвечает, сокет автоматически закрывается <br> <code>tcp_keepalive=$(sysctl -a | grep net.ipv4.tcp_keepalive | grep -Po "(?<=\=\s)[0-9]+")</code> забрать массив значений <br> <code>echo $tcp_keepalive | awk '{print $3+($1*$2)}'</code> 7200+(75*7) <br> <code>sysctl net.ipv4.conf.all.rp_filter</code> 1 - строгий режим проверки и 2 - свободный режим проверки, включает фильтр обратного пути (reverse path filter) или защита от подмены адресов (спуфинга), все что поступает на сервер, проходит проверку на соответствие исходящего адреса с таблицей маршрутизации и такая проверка считается успешной, если принятый пакет предполагает передачу ответа через тот же самый интерфейс. Например, когда входящий трафик идет через один маршрутизатор, а исходящий через другой, могут теряться пакеты, поскольку обратный маршрут в таблице маршрутизации, задан через другой интерфейс. <br> <code>sysctl -w net.ipv4.conf.ens33.rp_filter=1</code> включает строгую проверку на интерфейсе ens33 <br> <code>sysctl net.ipv4.conf.all.log_martians</code> включает/отключает логирование пакетов <br> <code>sysctl net.ipv4.tcp_window_scaling</code> разрешает/запрещает масштабирование TCP-окна, как определено в RFC 1323. При передаче TCP-пакетов по толстым каналам возникают потери пропускной способности из-за того, что они не загружены полностью во время ожидания подтверждения о приеме предыдущего TCP-окна. Основная проблема состоит в том, что окно не может иметь размер больше, чем 216 байт (65 Кб). Разрешая масштабирование TCP-окна можно увеличить его размер и таким образом уменьшить потери пропускной способности. <br> <code>sysctl net.ipv4.tcp_retries2</code> <br> <code>sysctl net.ipv4.tcp_abort_on_overflow</code> заставляет ядро отвергать новые соединения, если их поступаемое количество выше, с чем система в состоянии справиться <br> <code>sysctl net.ipv4.ip_nonlocal_bind</code> позволяет отдельным локальным процессам выступать от имени внешнего (чужого) IP адреса, может потребоваться, когда необходимо прослушивать внешние IP адреса, например, сниффинг чужого траффика <br> <code>net.ipv4.ipfrag_low_thresh</code> максимальный объем памяти, выделяемый под очередь фрагментированных пакетов в диапазоне от 0 до 2147483647, когда длина очереди достигает этого порога, то обработчик фрагментов будет отвергать все фрагментированные пакеты и после уменьшения очереди они должны быть повторно переданы узлом-отправителем. <br> <code>sysctl net.ipv4.netfilter.ip_conntrack_max</code> максимальное количество соединений для работы механизма connection tracking (используется в iptables)<h2 id=limits><a aria-label="Anchor link for: limits" class=zola-anchor href=#limits><i class=icon></i></a> limits</h2><p><code>cat /etc/security/limits.conf | grep -Ev "^$|^#"</code><pre class=z-code><code><span class="z-text z-plain">&LTuser/@group>  &LTsoft/hard>  &LTcore/rss/as/nproc/cpu>  &LTvalue>
</span><span class="z-text z-plain">@zabbix           soft              nofile          65535 # установить soft ограничение на кол-во открытых файлов (nofile) для группы zabbix (можно менять в любую сторону, пока оно не превышает hard)
</span><span class="z-text z-plain">@zabbix           hard              nofile          65535 # ограничение hard можно менять только в меньшую сторону от имени обычного пользователя
</span><span class="z-text z-plain">*                 soft              nofile          2048 # ограничение для всех пользователей (-n)
</span><span class="z-text z-plain">*                 hard              nofile          8192
</span><span class="z-text z-plain">zabbix            soft              as              100 # максимальное кол-во оперативной памяти в КБ (-m)
</span><span class="z-text z-plain">zabbix            hard              as              100
</span><span class="z-text z-plain">*                 soft              msgqueue        unlimited # снятие ограничения очереди сообщений памяти (-q)
</span><span class="z-text z-plain">*                 hard              msgqueue        unlimited
</span><span class="z-text z-plain">*                 soft              nproc           unlimited # ограничение на количество процессов для всех пользователей (-u)
</span><span class="z-text z-plain">*                 hard              nproc           unlimited
</span><span class="z-text z-plain">user              hard              maxlogins       1 # ограничить количество SSH-соединений/сессий для конкретного пользователя (максимальное количество сеансов SSH под одним и тем же пользователем)
</span><span class="z-text z-plain">*                 hard              maxsyslogins    1 # ограничить общее количество сеансов/активных соединений SSH (за исключением root)
</span></code></pre><p><code>ulimit -a</code> отобразить список ограничений<pre class=z-code><code><span class="z-text z-plain">core file size              (blocks, -c) 0
</span><span class="z-text z-plain">data seg size               (kbytes, -d) unlimited
</span><span class="z-text z-plain">scheduling priority                 (-e) 0
</span><span class="z-text z-plain">file size                   (blocks, -f) unlimited
</span><span class="z-text z-plain">pending signals                     (-i) 15052
</span><span class="z-text z-plain">max locked memory           (kbytes, -l) 496180
</span><span class="z-text z-plain">max memory size             (kbytes, -m) unlimited
</span><span class="z-text z-plain">open files                          (-n) 1024
</span><span class="z-text z-plain">pipe size                (512 bytes, -p) 8
</span><span class="z-text z-plain">POSIX message queues         (bytes, -q) 819200
</span><span class="z-text z-plain">real-time priority                  (-r) 0
</span><span class="z-text z-plain">stack size                  (kbytes, -s) 8192
</span><span class="z-text z-plain">cpu time                   (seconds, -t) unlimited
</span><span class="z-text z-plain">max user processes                  (-u) 15052
</span><span class="z-text z-plain">virtual memory              (kbytes, -v) unlimited
</span><span class="z-text z-plain">file locks                          (-x) unlimited
</span></code></pre><p><code>ulimit -Sn</code> отобразить значение текущего ограничения Soft (-S) для nofile (-n) <br> <code>ulimit -Hn</code> ограничение Hard (-H) <br> <code>ulimit -n 3000</code> изменить ограничение количества открытых файлов для одного процесса (до перезагрузки) <br> <code>ulimit -Sm 1500000</code> ограничение soft (-S) оперативной памяти (-m) в 1500 Мб для пользователя <br> <code>ulimit -u 5000</code> ограничение максимального количества запущенных пользовательских процессов (-u) <br> <code>ulimit -s</code> ограничение места для размера аргументов (stack size) команды/скрипта (bash: /usr/bin/diff: Argument list too long) <br> <code>ulimit -m</code> максимальный объем оперативной памяти <br> <code>ulimit -v</code> максимальный объем виртуальной памяти <br> <code>ulimit -f</code> максимальный размер создаваемых файлов <br> <code>ulimit -t</code> максимальное количество процессорного времени<p><code>systemctl edit rsyslog</code> ограничения на уровне Unit для конкретного сервиса<pre class=z-code><code><span class="z-text z-plain">[Service]
</span><span class="z-text z-plain">LimitNOFILE=1617596
</span><span class="z-text z-plain">LimitNOFILESoft=1617596
</span></code></pre><p><code>systemctl restart rsyslog</code> <br> <code>pid=$(ps -A | grep rsyslogd | awk '{print $1}')</code> получить pid процесса <br> <code>cat /proc/$pid/limits</code> проверить применение ограничений после перезапуска сервиса<h2 id=quota><a aria-label="Anchor link for: quota" class=zola-anchor href=#quota><i class=icon></i></a> quota</h2><p><code>nano /etc/fstab</code> примонтировать раздел на который необходимо установить квоту с указанными опциями<pre class=z-code><code><span class="z-text z-plain">/dev/sda  /  ext4  defaults,usrquota,grpquota  0 0
</span></code></pre><p><code>mount -o remount,rw /</code> перемонтировать файловую систему в режиме read and write <br> <code>mount | grep quota</code> <br> <code>quotacheck -favugm</code> выполнить проверку наличия служебных файлов aquota.user и aquota.group — если их нет, команда их создаст автоматически <br> <code>quotaon -avug</code> включить квоту <br> <code>edquota -u lifailon</code> создать квоту для пользователя или для группы (-g) на размер данных и кол-во файлов<pre class=z-code><code><span class="z-text z-plain">Disk quotas for user lifailon (uid 1000):
</span><span class="z-text z-plain">  Filesystem                            blocks       soft       hard     inodes     soft     hard
</span><span class="z-text z-plain">  /dev/mapper/ubuntu--vg-ubuntu--lv     397112       400M       500M      3004       0        0
</span></code></pre><p><code>edquota -p lifailon user</code> скопировать квоту на другого пользователя <br> <code>edquota -t</code> изменить период отсрочки soft квоты до момента, когда она станет hard (по умолчанию 7 дней) <br> <code>quota lifailon -s</code> отобразить квоты для пользователя <br> <code>repquota -us /</code> отчет для пользователей и групп (-u/-g), текущий used и soft/hard для Space limits и File limits, +-/-+/++ означает, что один из пределов достигнут максимума<pre class=z-code><code><span class="z-text z-plain">lifailon  --     388M     400M     500M     3004     0     0
</span></code></pre><p><code>su lifailon</code> <br> <code>dd if=/dev/zero of=/tmp/test.file bs=1024000 count=400</code> создать файл размером 400MB<pre class=z-code><code><span class="z-text z-plain">dd: error writing '/tmp/test.file': Disk quota exceeded
</span><span class="z-text z-plain">117645312 bytes (118 MB, 112 MiB) copied, 0.158031 s, 744 MB/s
</span></code></pre><p><code>ls -lh /tmp/test.file</code><pre class=z-code><code><span class="z-text z-plain">-rw-rw-r-- 1 lifailon lifailon 113M Sep 26 14:37 /tmp/test.file
</span></code></pre><h2 id=fetch><a aria-label="Anchor link for: fetch" class=zola-anchor href=#fetch><i class=icon></i></a> fetch</h2><p>Набор скриптов, для быстрого получения информации о системе без установки:<p><code>curl -s https://raw.githubusercontent.com/dylanaraps/neofetch/refs/heads/master/neofetch | bash</code> <br> <code>curl -s https://raw.githubusercontent.com/dylanaraps/pfetch/refs/heads/master/pfetch | bash</code> <br> <code>curl -s https://raw.githubusercontent.com/KittyKatt/screenFetch/refs/heads/master/screenfetch-dev | bash</code> <br> <code>curl -s https://raw.githubusercontent.com/ThatOneCalculator/NerdFetch/refs/heads/main/nerdfetch | bash</code> <br> <code>curl -s https://raw.githubusercontent.com/m0zgen/system-checks/master/system-check.sh | sudo bash</code> <br> <code>curl -s https://raw.githubusercontent.com/Lifailon/hwstat/refs/heads/rsa/hwstat.sh | bash</code><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">curl</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>s</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>L</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>https://github.com/fastfetch-cli/fastfetch/releases/download/2.40.1/fastfetch-linux-amd64.deb<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>o</span> /tmp/fastfetch.deb</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> dpkg<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>i</span> /tmp/fastfetch.deb</span> <span class="z-keyword z-operator z-logical z-and z-shell">&&</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">rm</span></span><span class="z-meta z-function-call z-arguments z-shell"> /tmp/fastfetch.deb</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">fastfetch</span></span>
</span></code></pre><h2 id=networkmanager><a aria-label="Anchor link for: networkmanager" class=zola-anchor href=#networkmanager><i class=icon></i></a> networkmanager</h2><p><code>apt install network-manager</code> <br> <code>systemctl status NetworkManager</code> <br> <code>nmcli device status</code> состояние интерфейсов <br> <code>nmcli general status</code> <br> <code>nmcli connection show</code> список доступных подключений (ethernet, vpn и WiFi-сетей) <br> <code>nmcli device wifi list</code> список доступных Wi-Fi-сетей <br> <code>nmcli connection show "Проводное соединение 2"</code> информация о сети <br> <code>nmcli connection up "Проводное соединение 2"</code> подключиться <br> <code>nmcli conn down "Проводное соединение 2"</code> отключиться <br> <code>nmcli radio wifi</code> состояние Wi-Fi <br> <code>nmcli connection add con-name "dhcp" type ethernet ifname ens33</code> создать подключение, передать тип устройства ethernet (Проводное соединение) и ifname, название сетевого интерфейса <br> <code>nmcli conn modify "dhcp" ipv4.dns 8.8.8.8</code> настройки подключения (modify) <br> <code>nmcli radio wifi on</code> включить или выключить (off) Wi-Fi <br> <code>nmcli device wifi connect "TP-Link" password 12345678 name "TP-Link Wifi"</code> подключиться к Wi-Fi сети <br> <code>nmcli networking off</code> отключить сеть через (если управление через Network Manager, указывается в блоке конфигурации renderer для netplan) <br> <code>nmcli networking on</code> включить сеть <br> <code>systemctl restart NetworkManager</code><h2 id=wireless><a aria-label="Anchor link for: wireless" class=zola-anchor href=#wireless><i class=icon></i></a> wireless</h2><p><code>apt install wireless-tools</code> <br> <code>iwconfig</code> <br> <code>apt install iw</code> <br> <code>iw list</code> <br> <code>apt install wavemon</code> <br> <code>wavemon</code> отобразить качество соединения и мощность передатчика<h2 id=networking><a aria-label="Anchor link for: networking" class=zola-anchor href=#networking><i class=icon></i></a> networking</h2><p><code>nano /etc/network/interfaces</code><p><code>auto ens33</code> активировать интерфейс при загрузке <br> <code>iface ens33 inet static</code> статический <br> <code>address 192.168.1.50/24</code> <br> <code>#netmask 255.255.255.0</code> <br> <code>gateway 192.168.1.254</code> <br> <code>dns-nameservers 8.8.8.8 1.1.1.1</code><p><code>auto ens33</code> <br> <code>iface ens33 inet dhcp</code> динамический<p><code>service networking restart</code> перезагрузка сети <br> <code>systemctl restart networking.service</code><h2 id=netplan><a aria-label="Anchor link for: netplan" class=zola-anchor href=#netplan><i class=icon></i></a> netplan</h2><p><code>netplan --debug generate</code> проверка конфигурации на ошибки <br> <code>netplan apply</code> применить изменения (перезапускает сеть) <br> <code>netplan get</code> прочитать конфигурацию<p><code>nano /etc/netplan/*.yaml</code><ul><li>Динамический адрес (использовать два сетевых интерфейса):</ul><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">network</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">version</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">2</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ethernets</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ens33</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">dhcp4</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-language z-boolean z-yaml">yes</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ens36</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">dhcp4</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-language z-boolean z-yaml">yes</span>
</span></code></pre><ul><li>Статический адрес:</ul><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">network</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">version</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">2</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">renderer</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">networkd</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ethernets</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ens33</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">dhcp4</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-language z-boolean z-yaml">no</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">addresses</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-meta z-flow-sequence z-yaml"><span class="z-punctuation z-definition z-sequence z-begin z-yaml">[</span><span class="z-string z-unquoted z-plain z-in z-yaml">192.168.3.105/24</span><span class="z-punctuation z-definition z-sequence z-end z-yaml">]</span></span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">routes</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">to</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">default</span>
</span><span class="z-source z-yaml">          <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">via</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-float z-decimal z-yaml">192<span class="z-punctuation z-separator z-decimal z-yaml">.</span>168.3.1</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">nameservers</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">addresses</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-meta z-flow-sequence z-yaml"><span class="z-punctuation z-definition z-sequence z-begin z-yaml">[</span><span class="z-constant z-numeric z-float z-decimal z-yaml">192<span class="z-punctuation z-separator z-decimal z-yaml">.</span>168.3.101</span><span class="z-punctuation z-separator z-sequence z-yaml">,</span> <span class="z-constant z-numeric z-float z-decimal z-yaml">8<span class="z-punctuation z-separator z-decimal z-yaml">.</span>8.8.8</span><span class="z-punctuation z-separator z-sequence z-yaml">,</span> <span class="z-constant z-numeric z-float z-decimal z-yaml">1<span class="z-punctuation z-separator z-decimal z-yaml">.</span>1.1.1</span><span class="z-punctuation z-definition z-sequence z-end z-yaml">]</span></span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">search</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-meta z-flow-sequence z-yaml"><span class="z-punctuation z-definition z-sequence z-begin z-yaml">[</span><span class="z-string z-unquoted z-plain z-in z-yaml">domain.local</span><span class="z-punctuation z-definition z-sequence z-end z-yaml">]</span></span>
</span></code></pre><p>renderer указывает, кому передать управление сетью NetworkManager (nmcli) в средах с графическим интерфейсом или networkd (networkctl)<p><code>netplan status</code> в релизе netplan 0.106 от февраля 2023 (Ubuntu 23.04) может получить статус используемого renderer<ul><li>MAC и MTU:</ul><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">network</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ethernets</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ens33</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">dhcp4</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-language z-boolean z-yaml">no</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">match</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">macaddress</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-other z-yaml">54:43:32:21:10:09</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">mtu</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">1500</span>
</span></code></pre><ul><li>Подключение к WiFi:</ul><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">network</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">version</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">2</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">wifis</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">wlp33</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">dhcp4</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-language z-boolean z-yaml">yes</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">dhcp6</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-language z-boolean z-yaml">no</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">nameservers</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">addresses</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-meta z-flow-sequence z-yaml"><span class="z-punctuation z-definition z-sequence z-begin z-yaml">[</span><span class="z-constant z-numeric z-float z-decimal z-yaml">8<span class="z-punctuation z-separator z-decimal z-yaml">.</span>8.8.8</span><span class="z-punctuation z-definition z-sequence z-end z-yaml">]</span></span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">access-points</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">        <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>wifi-ssid<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">          <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">password</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-quoted z-double z-yaml"><span class="z-punctuation z-definition z-string z-begin z-yaml">"</span>12345678<span class="z-punctuation z-definition z-string z-end z-yaml">"</span></span>
</span></code></pre><ul><li>Bonding для объединения физических сетевых интерфейсов в один логический:</ul><pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">network</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">version</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">2</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ethernets</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ens33</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span><span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">ens36</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-meta z-flow-mapping z-yaml"><span class="z-punctuation z-definition z-mapping z-begin z-yaml">{</span><span class="z-punctuation z-definition z-mapping z-end z-yaml">}</span></span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">bonds</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">bond0</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">dhcp4</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-language z-boolean z-yaml">no</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">interfaces</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">          <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ens33</span>
</span><span class="z-source z-yaml">          <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ens36</span>
</span><span class="z-source z-yaml">          <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">parameters</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">            <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">mode</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">active-backup</span> <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> используется только один интерфейс, второй активируется в случае неработоспособности первого
</span></span><span class="z-source z-yaml">            <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">mode</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">broadcast</span> <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> задействуются оба интерфейса одновременно, пакеты передают все интерфейсы
</span></span><span class="z-source z-yaml">            <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">mode</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">balance-rr</span> <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> задействуются оба интерфейса по очереди с распределением пакетов
</span></span><span class="z-source z-yaml">            <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">mode</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">balance-tlb</span> <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> задействуются оба интерфейса по очереди, пакеты распределяются в соответствии с текущей нагрузкой
</span></span><span class="z-source z-yaml">            <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">mode</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">balance-xor</span> <span class="z-comment z-line z-number-sign z-yaml"><span class="z-punctuation z-definition z-comment z-line z-number-sign z-yaml">#</span> задействуются оба интерфейса по очереди, распределение пакетов на основе политики хеширования
</span></span><span class="z-source z-yaml">          <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">addresses</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">            <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">192.168.1.150/24</span>
</span><span class="z-source z-yaml">          <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">gateway4</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-float z-decimal z-yaml">192<span class="z-punctuation z-separator z-decimal z-yaml">.</span>168.1.1</span>
</span><span class="z-source z-yaml">          <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">mtu</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-numeric z-integer z-decimal z-yaml">1500</span>
</span><span class="z-source z-yaml">          <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">nameservers</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">            <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">addresses</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">              <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-constant z-numeric z-float z-decimal z-yaml">8<span class="z-punctuation z-separator z-decimal z-yaml">.</span>8.8.8</span>
</span></code></pre><h2 id=ip><a aria-label="Anchor link for: ip" class=zola-anchor href=#ip><i class=icon></i></a> ip</h2><p><code>ip a</code> ip addr show <br> <code>ip -s link</code> вывести ститстику всех сетевых интерфейсов <br> <code>ip -br a show</code> вывести только название интерфейса, статус работы и ip-адрес <br> <code>ip link set dev ens33 up</code> включить сетевой интерфейс <br> <code>ip link set dev ens33 down</code> выключить сетевой интерфейс <br> <code>ip link set mtu 1550 dev ens33</code> изменить mtu <br> <code>ip link set dev ens33 address AA:BB:CC:DD:EE:FF</code> изменить mac-адрес (предварительно нужно отключить интерфейс, работает до перезагрузки) <br> <code>ip addr add 192.168.3.106/24 broadcast 192.168.3.255 dev ens33</code> добавить адрес <br> <code>ip addr del 192.168.3.106/24 dev ens33</code> удалить адрес <br> <code>ip route show</code> отобразить таблицу маршрутизации <br> <code>ip route add 192.168.4.0 via 192.168.3.100</code> добавить маршрут <br> <code>ip route del 192.168.4.0 via 192.168.3.100</code> удалить маршрут <br> <code>ip route add 192.168.4.0 dev ens33</code> указать сетевой интерфейс, через который отправлять пакеты в определенную подсеть <br> <code>ip neigh show</code> отобразить ARP-таблицу <br> <code>ip neigh add 192.168.3.110 lladdr b0:be:76:43:21:41 dev ens33</code> <br> <code>ip neigh del dev end33 192.168.3.110</code> <br> <code>ip neigh flush</code> очистить ARP-таблицу<h3 id=net-tools><a aria-label="Anchor link for: net-tools" class=zola-anchor href=#net-tools><i class=icon></i></a> net-tools</h3><p><code>ifconfig ens33</code> up/down <br> <code>ifdown -a</code> выключить все сетевые интерфейсы (пропадут из списка ifconfig) и включить (ifup -a) <br> <code>ifconfig ens33 192.168.3.106 netmask 255.255.255.0 broadcast 192.168.3.255</code> <br> <code>ifconfig -s || netstat -i</code> список сетевых интерфейсов <br> <code>netstat -atu</code> ALL (-a) tcp (-t) и udp (-u) <br> <code>netstat -lntup</code> LISTEN (-l) dont resolve names (-n) и сканирует директорию /proc для вывода PID/Program name (-p) <br> <code>arp -a</code> таблица сопоставления ip и mac адресов <br> <code>route -e</code> отобразить таблицу маршрутизации <br> <code>route add -net 192.168.4.0 netmask 255.255.255.0 gw 192.168.3.100</code> добавить маршрут в подсеть 192.168.4.0 через шлюз 192.168.3.100 <br> <code>route del -net 192.168.4.0 netmask 255.255.255.0</code> удалить маршрут<h3 id=networkd><a aria-label="Anchor link for: networkd" class=zola-anchor href=#networkd><i class=icon></i></a> networkd</h3><p><code>systemctl status systemd-networkd</code> <br> <code>networkctl list</code> список всех адаптеров, тип и состояния <br> <code>networkctl status</code> статус службы, Address и Gateway адаптера, DNS-адреса и лог systemd-networkd <br> <code>networkctl status ens33</code> характеристики адаптера (Network File, Driver, Vendor, Model, MTU, Speed)<h2 id=ss><a aria-label="Anchor link for: ss" class=zola-anchor href=#ss><i class=icon></i></a> ss</h2><p><code>ss -a</code> All отобразить все сокеты <br> <code>ss -l</code> показать только прослушиваемые сокеты (LISTEN) <br> <code>ss -t</code> отобразить только установленные TCP соединения (ESTAB/ESTABLISHED) <br> <code>ss -ua</code> отобразить все открытые UDP сокеты <br> <code>ss -da</code> DHCP сокеты <br> <code>ss -x</code> отобразить только локальные UNIX соединения <br> <code>ss -r</code> Resolve, определять сетевые имена адресов с помощью DNS <br> <code>ss -p</code> Processes, показать процессы, использующие сокет <br> <code>ss -n</code> Numeric не определять имена служб (отображать только номер порта в числовом формате) <br> <code>ss -ltp | grep 8080</code> <br> <code>ss -tna | grep 22</code><h2 id=dns><a aria-label="Anchor link for: dns" class=zola-anchor href=#dns><i class=icon></i></a> dns</h2><h3 id=resolv><a aria-label="Anchor link for: resolv" class=zola-anchor href=#resolv><i class=icon></i></a> resolv</h3><p><code>cat /etc/resolv.conf | grep nameserver</code> <br> <code>nano /etc/resolv.conf</code> работает до перезагрузки <br> <code>domain domain.local</code> <br> <code>search domain.local</code> <br> <code>nameserver 8.8.8.8</code> <br> <code>nameserver 1.1.1.1</code><h3 id=resolved><a aria-label="Anchor link for: resolved" class=zola-anchor href=#resolved><i class=icon></i></a> resolved</h3><p><code>networkctl status</code> отображает список всех настроенные DNS-серверов в системе через netplan (или другое) для всех адаптеров <br> <code>resolvectl status</code> в systemd 239 (ubuntu 22.04) systemd-resolve переименован в resolvectl, выводит настроенные сервера для global и список все адресов для конкретного сетевого интерфейса Link (ens33) <br> <code>resolvectl status | grep "Current DNS"</code> отображает текущие используемые DNS-сервер <br> <code>systemd-resolve --status</code> служба локального DNS сервера <br> <code>resolvectl flush-caches && systemd-resolve --flush-caches</code> очистить локальный кэш DNS <br> <code>journalctl -u systemd-resolved | grep -E "IN A|IN PTR|IN AAAA|IN PTR|IN MX"</code> логи кэша DNS <br> <code>systemctl status systemd-resolved</code> статус службы и его лог <br> <code>cat /run/systemd/resolve/stub-resolv.conf</code> файл-заглушка для демона systemd-resolved, по умолчанию nameserver 127.0.0.53, который перенаправляет обращения к локальному DNS серверу, а он, в свою очередь уже получает информацию от других серверов в интернете<p><code>nano /etc/systemd/resolved.conf</code> конфигурационный файл, отвечающий за настройку DNS-серверов<p>Включить кэширование:<pre class=z-code><code><span class="z-text z-plain">[Resolve]
</span><span class="z-text z-plain">DNS=8.8.8.8, 192.168.3.101
</span><span class="z-text z-plain">Cache=yes
</span></code></pre><p><code>ln -svi /run/systemd/resolve/resolv.conf /etc/resolv.conf</code> создать симлинк для совместимости с приложениями, которые не используют библиотечные вызовы, а обращаются к DNS серверам напрямую, получая их из <code>/etc/resolv.conf</code> <br> <code>ls -la /etc/resolv.conf</code><p><code>nano /etc/resolv.conf</code> не управляется напрямую службой systemd-resolved, а иногда с помощью использования initscripts или NetworkManager, и любые пользовательские изменения могут быть изменены через время или после перезагрузки<pre class=z-code><code><span class="z-text z-plain">nameserver 8.8.8.8
</span></code></pre><p><code>apt install resolvconf</code> сервис для обновления списа адресов в /etc/resolv.conf (что бы он не перезаписывался) <br> <code>systemctl status resolvconf</code><p><code>nano /etc/resolvconf/resolv.conf.d/head</code><pre class=z-code><code><span class="z-text z-plain">nameserver 8.8.8.8
</span><span class="z-text z-plain">nameserver 1.1.1.1
</span></code></pre><h3 id=dig><a aria-label="Anchor link for: dig" class=zola-anchor href=#dig><i class=icon></i></a> dig</h3><p><code>dig</code> <br> <code>dig google.com</code> <br> <code>dig @1.1.1.1 google.com a</code> использовать DNS сервер Cloudflare для преобразования имени <br> <code>dig @9.9.9.9 google.com mx</code> использовать DNS сервер Quad9 для получения MX записи (A, NS, TXT) <br> <code>dig -x 8.8.8.8 @9.9.9.9</code> разрешить ip в имя<h3 id=mtr><a aria-label="Anchor link for: mtr" class=zola-anchor href=#mtr><i class=icon></i></a> mtr</h3><p><code>mtr google.com</code> объединяет traceroute и ping каждого узла в трассеровке <br> <code>mtr -I ens33 google.com</code> указать интерфейс для проверки <br> <code>mtr -b google.com</code> отображать имя и ip <br> <code>mtr --tcp google.com</code> использовать TCP SYN-пакеты или UDP-дейтаграммы (–udp) <br> <code>mtr -s 1000 google.com</code> указать размер пакета <br> <code>mtr -r -c 1 google.com --json</code> указать кол-во ping пакетов (-c 1 и -i 2 изменить интервал) и вывести в виде отчета (–report) в формате json/xml/csv/raw<h3 id=doggo><a aria-label="Anchor link for: doggo" class=zola-anchor href=#doggo><i class=icon></i></a> doggo</h3><p><code>curl -sS https://raw.githubusercontent.com/mr-karan/doggo/main/install.sh | sh</code> DNS cli client (https://github.com/mr-karan/doggo) <br> <code>doggo yandex.ru</code> запросить домен, используя настройки по умолчанию <br> <code>doggo yandex.ru MX</code> запросить MX записи домена <br> <code>doggo yandex.ru MX @8.8.8.8</code> использует указанный сервер для преобразования имен DNS <br> <code>doggo -q yandex.ru -t MX --nameserver 1.1.1.1</code> <br> <code>doggo yandex.ru --aa --ad</code> запрос с установленными флагами авторитетного ответа и аутентифицированных данных <br> <code>doggo yandex.ru --cd --do</code> запрос с отключенной проверкой и установленными флагами <code>DNSSEC OK</code> <br> <code>doggo yandex.ru --gp-from Germany</code> Запрос с использованием API Globalping из указанной локации<h2 id=vnstat><a aria-label="Anchor link for: vnstat" class=zola-anchor href=#vnstat><i class=icon></i></a> vnstat</h2><p><code>apt install vnstat</code> журнал часового, ежедневного и ежемесячного сетевого трафика <br> <code>systemctl status vnstat</code> проверить службу <br> <code>vnstat -l</code> мониторинг в реальном режиме <br> <code>vnstat -h</code> ежедневная почасовая история<h2 id=netcat><a aria-label="Anchor link for: netcat" class=zola-anchor href=#netcat><i class=icon></i></a> netcat</h2><p><code>nc -zv 192.168.3.100 5985</code> проверить порт без попытки соединения (-z) в подробном режиме (-v) <br> <code>nc -zvn 192.168.3.100 1-1000</code> сканирование tcp-портов, не используя преобразование DNS (-n) <br> <code>nc -zvn 192.168.3.100 1-1000 2>&1 | grep succeeded</code> перенаправить вывод ошибок в stdout и отфильтровать вывод <br> <code>nc -zvnu 192.168.3.100 5550-5560</code> сканирование udp-портов (-u) <br> <code>nc -lp 8081</code> открыть сокет (чат сервер) в режиме прослушивания (-listen) с указанием номера порта (-p) <br> <code>nc 192.168.3.101 8081</code> подключиться к сокету (чат-клиент) <br> <code>nc -lp 8081 > out.txt</code> все поступившие данные на сокет записываются в файл (вместо вывода в консоль) <br> <code>cat /etc/passwd | nc -N 192.168.3.101 8081</code> передать содержимое файла на удаленный сокет принимающей стороны (содержимое /etc/passwd запишется в out.txt) и закрыть удаленный сокет (-N) <br> <code>nc -l -w 1 -p 8081</code> задать timeout (-w) ожидания, в течении которого сервер слушает запрос, если будет 0, может не успеть считать запрос, на стороне клиента timeout должен быть не ниже <br> <code>nc -w 5 -Uvl server.sock > out.txt</code> создать UNIX-сокет и передать вывод в файл, сокет закроется через 5 секунд (-w 5) или если будет задан параметр -N на стороне клиента <br> <code>lsblk | nc -Uv server.sock</code> подключиться к локальному сокету с второго терминала и отправить вывод команды в файл сокета приема <br> <code>while true; do echo -e "HTTP/1.1 200 OK\n\n$(systemd-analyze plot)" | nc -l -w 1 -p 8085; done</code> HTTP-сервер с выводом анализа загрузки системы<h3 id=socket-api><a aria-label="Anchor link for: socket-api" class=zola-anchor href=#socket-api><i class=icon></i></a> socket api</h3><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">port</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell">8085</span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-loop z-while z-shell">while</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">true</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-loop z-do z-shell">do</span>
</span><span class="z-source z-shell z-bash">    <span class="z-variable z-other z-readwrite z-assignment z-shell">request</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">nc</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>l</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>w</span> 1<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">port</span></span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-variable z-other z-readwrite z-assignment z-shell">request</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">request</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">head</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>n</span> 1</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-variable z-other z-readwrite z-assignment z-shell">method</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">request</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">cut</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>d</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span> <span class="z-punctuation z-definition z-string z-end z-shell">"</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>f</span> 1</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-variable z-other z-readwrite z-assignment z-shell">endpoint</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">request</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">cut</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>d</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span> <span class="z-punctuation z-definition z-string z-end z-shell">"</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>f</span> 2</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-keyword z-control z-conditional z-if z-shell">if</span> <span class="z-meta z-function-call z-arguments z-shell"><span class="z-support z-function z-double-brace z-begin z-shell">[[</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">endpoint</span></span> <span class="z-keyword z-operator z-logical z-shell">==</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>/api/date<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-support z-function z-double-brace z-end z-shell">]]</span></span>
</span><span class="z-source z-shell z-bash">        <span class="z-keyword z-control z-conditional z-then z-shell">then</span>
</span><span class="z-source z-shell z-bash">        <span class="z-variable z-other z-readwrite z-assignment z-shell">response</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>HTTP/1.1 200 OK\nContent-Type: application/text\n\n<span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">date</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-keyword z-control z-conditional z-elseif z-shell">elif</span> <span class="z-meta z-function-call z-arguments z-shell"><span class="z-support z-function z-double-brace z-begin z-shell">[[</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">endpoint</span></span> <span class="z-keyword z-operator z-logical z-shell">==</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>/api/disk<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-support z-function z-double-brace z-end z-shell">]]</span></span>
</span><span class="z-source z-shell z-bash">        <span class="z-keyword z-control z-conditional z-then z-shell">then</span>
</span><span class="z-source z-shell z-bash">        <span class="z-variable z-other z-readwrite z-assignment z-shell">response</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>HTTP/1.1 200 OK\nContent-Type: application/json\n\n<span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">lsblk</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>e7</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>json</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-keyword z-control z-conditional z-else z-shell">else</span>
</span><span class="z-source z-shell z-bash">        <span class="z-variable z-other z-readwrite z-assignment z-shell">response</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>HTTP/1.1 404 Not Found\n\n404 Not Found\n<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-keyword z-control z-conditional z-end z-shell">fi</span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>e</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">response</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">nc</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>l</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>w</span> 1<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">port</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-loop z-end z-shell">done</span>
</span></code></pre><p>curl -s http://192.168.3.101:8085/api/date <br> curl -s http://192.168.3.101:8085/api/disk | jq .blockdevices[]<h3 id=socket-proxy><a aria-label="Anchor link for: socket-proxy" class=zola-anchor href=#socket-proxy><i class=icon></i></a> socket proxy</h3><p><code>ncat -l 8080 -k --sh-exec "ncat 192.168.3.101 80"</code> <br> <code>socat TCP-LISTEN:8080,fork,reuseaddr TCP:192.168.3.101:80</code><h2 id=proxy><a aria-label="Anchor link for: proxy" class=zola-anchor href=#proxy><i class=icon></i></a> proxy</h2><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> apt-get install<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>y</span> dotnet-runtime-8.0</span>
</span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">arch</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>x64<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span> <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> или "arm64"</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> curl<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>s</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>L</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>https://github.com/Lifailon/froxy/releases/download/0.4.0/froxy-0.4.0-linux-<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">arch</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>o</span> /usr/local/bin/froxy</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> chmod +x /usr/local/bin/froxy</span>
</span></code></pre><p><code>froxy --socks 1080</code> запустить SOCKS прокси на порту 1080 <br> <code>froxy --forward 8080</code> запустить HTTP/HTTPS прокси на порту 1080 <br> <code>froxy --forward 8080 >> froxy.log &</code> запустить фоновый процесс и передать вывод логов в файл <br> <code>froxy --local 5514 --remote 192.168.3.100:514</code> запустить обратный прокси сервер на порту 5514, который перенаправляет на хост 192.168.3.100 и порт 514 (syslog) <br> <code>froxy --local 192.168.3.100:2121 --remote 192.168.3.101:21</code> TCP туннелирование для RDP <br> <code>froxy --local 127.0.0.1:8443 --remote https://example.com</code> принимать HTTPS трафик на порту 8443 и переадресовать на указанный URL (поддерживаются GET и POST запросы с передачей заголовков и тела запроса от клиента, для использования API запросы и прохождения авторизации на сайтах) <br> <code>froxy --local *:8443 --remote https://example.com --user admin --pass admin</code> слушать на всех интерфейсах и использовать авторизацию<h2 id=nmap><a aria-label="Anchor link for: nmap" class=zola-anchor href=#nmap><i class=icon></i></a> nmap</h2><p><code>nmap localhost</code> узнать какие локальные порты прослушиваются <br> <code>nmap -sV localhost</code> определить какое какая ОС и ПО работает на портах и их версия <br> <code>nmap -sL 192.168.3.0/24</code> список хостов с разрешением имен без пинга <br> <code>nmap -sP 192.168.3.0/24</code> ping метод host discovery (TCP ACK SYN пакет, используя системныей вызов connect) с отображением производителя сетевой платы <br> <code>nmap -F 192.168.3.0/24</code> fast mode port <br> <code>nmap -A 192.168.3.100</code> подробное сканирование ОС и ПО (ssh на другом порту, version, ad sites, rdp-ntlm-info) <br> <code>nmap -sA 192.168.3.100</code> обнаружить фильтрацию пакетов fw (filtered/unfiltered) с помощью TCP ACK <br> <code>nmap -PN 192.168.3.100</code> сканировании защищенного хоста без ping <br> <code>nmap -sO 192.168.3.100</code> определить какие именно IP-протоколы доступны и их статус, если отсутствует, значит фильтруется <br> <code>nmap -PU 192.168.3.100</code> обойти межсетевой экран с помощью UDP-пинга <br> <code>nmap -sS 192.168.3.100</code> выполнить полуоткрытое сканирование (TCP SYN) без установки подключения <br> <code>nmap -sU 192.168.3.100</code> проверка только UDP-портов<h3 id=masscan><a aria-label="Anchor link for: masscan" class=zola-anchor href=#masscan><i class=icon></i></a> masscan</h3><p><code>apt install masscan</code> асинхронный (отправляет пакеты SYN) сканер TCP портов (https://github.com/robertdavidgraham/masscan) <br> <code>masscan 192.168.3.100 -p80</code> <br> <code>masscan 192.168.3.100 -p0-65535 --rate 100</code> <br> <code>masscan 192.168.3.100 -p0-65535 --rate 100 --ping-timeout 1000</code> <br> <code>masscan 192.168.3.1-100 -p80</code> <br> <code>masscan 192.168.3.0/24 -p80,443</code> <br> <code>masscan 192.168.3.100 -p80 --output-format json --output-file result.json</code><h3 id=rustscan><a aria-label="Anchor link for: rustscan" class=zola-anchor href=#rustscan><i class=icon></i></a> rustscan</h3><p><code>wget https://github.com/RustScan/RustScan/releases/download/2.0.1/rustscan_2.0.1_amd64.deb \ </code>snap install nmap<code>требуется установить пакет зависимости \</code>apt-get install -f<code>разрешить зависимости \</code>dpkg –install rustscan_2.0.1_amd64.deb<code>\</code>rustscan -a 127.0.0.1<code>\</code>rustscan -a 192.168.3.100` 32400/tcp open plex<h3 id=tcp><a aria-label="Anchor link for: tcp" class=zola-anchor href=#tcp><i class=icon></i></a> tcp</h3><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-storage z-type z-function z-shell">function</span> <span class="z-entity z-name z-function z-shell">tcp-scan</span> <span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span> <span class="z-punctuation z-section z-braces z-begin z-shell">{</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">  <span class="z-keyword z-control z-conditional z-if z-shell">if</span> <span class="z-support z-function z-test z-begin z-shell">[</span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">1</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-keyword z-operator z-logical z-shell">==</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-support z-function z-test z-end z-shell">]</span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-conditional z-then z-shell">then</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">      <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-exit z-shell">exit</span></span><span class="z-meta z-function-call z-arguments z-shell"> 1</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">  <span class="z-keyword z-control z-conditional z-end z-shell">fi</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">  <span class="z-variable z-other z-readwrite z-assignment z-shell">START_PORT</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">2</span></span></span><span class="z-meta z-function-call z-shell"></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-support z-function z-test z-begin z-shell">[</span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>z</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">START_PORT</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-support z-function z-test z-end z-shell">]</span></span> <span class="z-keyword z-operator z-logical z-and z-shell">&&</span> <span class="z-variable z-other z-readwrite z-assignment z-shell">START_PORT</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell">1</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">  <span class="z-variable z-other z-readwrite z-assignment z-shell">END_PORT</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">3</span></span></span><span class="z-meta z-function-call z-shell"></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-support z-function z-test z-begin z-shell">[</span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>z</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">END_PORT</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-support z-function z-test z-end z-shell">]</span></span> <span class="z-keyword z-operator z-logical z-and z-shell">&&</span> <span class="z-variable z-other z-readwrite z-assignment z-shell">END_PORT</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell">65535</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">  <span class="z-variable z-other z-readwrite z-assignment z-shell">PORT_PROTOCOL</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>tcp<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-meta z-function z-shell">  <span class="z-entity z-name z-function z-shell">scan_port</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span><span class="z-punctuation z-section z-braces z-begin z-shell">{</span>
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-meta z-function z-shell">      <span class="z-variable z-other z-readwrite z-assignment z-shell">PORT_NUMBER</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">1</span></span></span>
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-meta z-function z-shell">      <span class="z-variable z-other z-readwrite z-assignment z-shell">PORT_SCAN_RESULT</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-meta z-function-call z-shell"></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-meta z-group z-expansion z-command z-backticks z-shell"><span class="z-punctuation z-section z-group z-begin z-shell">`</span><span class="z-constant z-numeric z-integer z-decimal z-file-descriptor z-shell">2</span><span class="z-keyword z-operator z-assignment z-redirection z-shell">>&</span><span class="z-constant z-numeric z-integer z-decimal z-file-descriptor z-shell">1</span> <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">></span> /dev/<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">PORT_PROTOCOL</span></span>/<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">TARGET_NAME_OR_IP</span></span>/<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">PORT_NUMBER</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">grep</span></span><span class="z-meta z-function-call z-arguments z-shell"> connect</span><span class="z-punctuation z-section z-group z-end z-shell">`</span></span></span>
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-meta z-function z-shell">      <span class="z-support z-function z-test z-begin z-shell">[</span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">PORT_SCAN_RESULT</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-keyword z-operator z-logical z-shell">==</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-support z-function z-test z-end z-shell">]</span></span> <span class="z-keyword z-operator z-logical z-and z-shell">&&</span> <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>e</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">PORT_NUMBER</span></span><span class="z-constant z-character z-escape z-shell">\/</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">PORT_PROTOCOL</span></span><span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span> \t <span class="z-punctuation z-definition z-string z-end z-shell">'</span></span>open<span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span> \t\t <span class="z-punctuation z-definition z-string z-end z-shell">'</span></span><span class="z-meta z-group z-expansion z-command z-backticks z-shell"><span class="z-punctuation z-section z-group z-begin z-shell">`</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">grep</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">PORT_NUMBER</span></span>/<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">PROTOCOL</span></span> /etc/services</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">head</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>n1</span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">awk</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>{print $1}<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span><span class="z-punctuation z-section z-group z-end z-shell">`</span></span></span>
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-meta z-function z-shell">  <span class="z-punctuation z-section z-braces z-end z-shell">}</span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">  <span class="z-variable z-other z-readwrite z-assignment z-shell">TARGET_NAME_OR_IP</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">1</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">  <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>e</span> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>PORT \t\t STATE \t\t SERVICE<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">  <span class="z-keyword z-control z-loop z-for z-shell">for</span><span class="z-meta z-group z-for z-shell"> PORT_NUMBER <span class="z-keyword z-control z-in z-shell">in</span> <span class="z-meta z-group z-expansion z-command z-backticks z-shell"><span class="z-punctuation z-section z-group z-begin z-shell">`</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">seq</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">START_PORT</span></span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">END_PORT</span></span></span><span class="z-punctuation z-section z-group z-end z-shell">`</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-loop z-do z-shell">do</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">      <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">scan_port</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">PORT_NUMBER</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">  <span class="z-keyword z-control z-loop z-end z-shell">done</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-punctuation z-section z-braces z-end z-shell">}</span></span>
</span></code></pre><p><code>tcp-scan 192.168.3.100 1024 5000</code><h2 id=tcpdump><a aria-label="Anchor link for: tcpdump" class=zola-anchor href=#tcpdump><i class=icon></i></a> tcpdump</h2><p><code>tcpdump -D</code> список доступных сетевых интерфейсов <br> <code>tcpdump -n -i ens33 icmp</code> слушать icmp-пакеты от всех на указанном интерфейсе (-i) без отображения доменных имен (-n) <br> <code>tcpdump -n -i ens33 udp -e</code> слушать udp-пакеты и отображать MAC-адреса (-e) <br> <code>tcpdump -n -i ens33 port 8080</code> слушать трафик 8080 порта <br> <code>tcpdump -n -i ens33 port 80 or 443</code> <br> <code>tcpdump -n -i ens33 portrange 21-80</code> <br> <code>tcpdump -n -i ens33 ip src 192.168.3.99 and dst 192.168.3.103</code> отобразить ip пакеты, которые отправлены с указанного (src) ip-адреса на указанный (dst) ip-адрес <br> <code>tcpdump -n -i ens33 -X host 192.168.3.100 and port 32400</code> отобразить содержимое пакетов (-X) для хоста и порта<h2 id=tshark><a aria-label="Anchor link for: tshark" class=zola-anchor href=#tshark><i class=icon></i></a> tshark</h2><p><code>apt install tshark</code> <br> <code>apt install termshark</code> terminal UI for tshark (https://github.com/gcla/termshark) <br> <code>tshark -D</code> список интерфейсов <br> <code>tshark -i 1</code> <br> <code>disown</code> <br> <code>tshark -i 1 -Y "syslog"</code> захват пакетов syslog (udp.port == 514) <br> <code>tshark -i 1 host 192.168.3.104</code> захват пакетов для конкретного IP-адреса <br> <code>tshark -i 1 net 192.168.3.0/24</code> захват пакетов указанной подсети <br> <code>tshark -i 1 src host 192.168.3.104</code> захват исходящих пакетов <br> <code>tshark -i 1 dst host 192.168.3.104</code> захват входящих пакетов <br> <code>tshark -i 1 dst host 192.168.3.104 and port 8086</code> отфильтровать по входящему хосту и порту <br> <code>tshark -i 1 dst host 192.168.3.104 and port 8086 and src host 192.168.3.99</code> отфильтровать по исходящему хосту <br> <code>tshark -i 1 -x dst host 192.168.3.104 and port 8086 and src host 192.168.3.101</code> прочитать пакеты в шестнадцатеричном формате (-x) <br> <code>tshark -i 1 -O TCP dst host 192.168.3.104 and port 8086 and src host 192.168.3.101</code> прочитать TCP-заголовки <br> <code>tshark -i 1 -a duration:10 -w ~/192.168.3.0.pcap</code> сохранить захват <br> <code>tshark -Y 'ip.addr == 192.168.3.106' -r ~/192.168.3.0.pcap</code> прочитать файл захвата с использованием фильтра <br> <code>tshark -Y "(ip.addr == 192.168.3.106) or (ip.addr == 192.168.3.107)" -r ~/192.168.3.0.pcap</code> отфильтровать по двум адресам (или) <br> <code>tshark -Y "(ip.addr == 192.168.3.104) and (tcp.port == 8086)" -r ~/192.168.3.0.pcap</code> отфильтровать по двум параметрам (и) <br> <code>tshark -Y "!(ip.addr == 192.168.3.104)" -r ~/192.168.3.0.pcap</code> исключить <br> <code>tshark -Y "not arp and not (udp.port == 53)" -r ~/192.168.3.0.pcap</code> отобразить весь udp-трафик, исключив ping и dns пакеты<h2 id=ping><a aria-label="Anchor link for: ping" class=zola-anchor href=#ping><i class=icon></i></a> ping</h2><h3 id=fping><a aria-label="Anchor link for: fping" class=zola-anchor href=#fping><i class=icon></i></a> fping</h3><p><code>fping yandex.ru google.com</code> параллельная проверка доступности двух хостов <br> <code>fping -p 5 yandex.ru google.com</code> 5 параллельных запросов к каждому хосту <br> <code>fping -ag 192.168.3.0/24</code> icmp проверка все подсети <br> <code>fping < hosts.txt</code> произвести ping всех хостов указанных в файле с новой строки<h3 id=netping><a aria-label="Anchor link for: netping" class=zola-anchor href=#netping><i class=icon></i></a> netping</h3><p><code>sudo curl -s https://raw.githubusercontent.com/Lifailon/net-tools/rsa/netping.sh -o /usr/bin/netping</code> <br> <code>sudo chmod +x /usr/bin/netping</code> <br> <code>netping 192.168.3.0</code><h2 id=firewall><a aria-label="Anchor link for: firewall" class=zola-anchor href=#firewall><i class=icon></i></a> firewall</h2><h3 id=ufw><a aria-label="Anchor link for: ufw" class=zola-anchor href=#ufw><i class=icon></i></a> ufw</h3><p><code>systemctl status ufw</code> <br> <code>ufw status</code> <br> <code>ufw enable</code> включить ufw (Uncomplicated Firewall) <br> <code>ufw disable</code> отключить <br> <code>ufw reload</code> перезапустить/применить настройки <br> <code>ufw reset</code> сбросить настройки (отключить ufw и удалить все правила) <br> <code>ufw default deny incoming</code> все входящие пакеты отклонять (политика по умолчанию, какие действия будут применяться к пакетам, если они не подпадают под созданные правила) <br> <code>ufw default allow outgoing</code> все исходящие разрешать <br> <code>ufw allow in 22</code> разрешить входящий трафик на порт 22 <br> <code>ufw allow out 22</code> разрешить исходящий трафик на порт 22 <br> <code>ufw deny in 80/tcp</code> запретить входящий TCP-трафик на 80 порт <br> <code>ufw delete deny in 80/tcp</code> удалить правило <br> <code>ufw allow 161,10050,10051/tcp</code> открыть несколько портов <br> <code>ufw allow proto tcp from 0.0.0.0/24 to 192.168.3.100 port 3389</code> разрешить доступ со всех IP-адресов по TCP-протоколу к IP-адресу и порту 3389 <br> <code>ufw allow from 192.168.3.0/24 to 192.168.3.110</code> разрешить подключение всем с подсети 192.168.1.0 к интерфейсу 192.168.1.2 (для Proxmox MGW) <br> <code>ufw allow 25/tcp</code> открыть для всех направлений 25 порт <br> <code>ufw limit ssh</code> лимт подключений к определенному порту с одного IP-адреса (для защиты от перебора), по умолчанию подключения блокируются, если пользователь пытается создать шесть и больше подключений за 30 секунд (настроить время и количество запросов можно только через iptables) <br> <code>ufw logging on</code> включить логирование <br> <code>ufw logging medium</code> выбрать уровень логирования (low/medium/high) <br> <code>cat /var/log/ufw</code> директория хранения логов. Синтаксис: [UFW ALLOW/BLOCK/AUDIT] IN=интерфейс OUT=итерфейс SRC=ip_источника DST=ip_назначения LEN=размер_пакета TOS=0x10 PREC=0x00 TTL=64 ID=728 DF PROTO=протокол SPT=порт_источника DPT=порт назначения LEN=размер_пакета<h3 id=show><a aria-label="Anchor link for: show" class=zola-anchor href=#show><i class=icon></i></a> show</h3><p><code>ufw show listening</code> отображает все прослушиваемые порты и правила для них (с указанием очередного номера в списке: [20] allow 161,10050,10051/tcp) <br> <code>ufw show raw</code> все активные правила в формате iptables <br> <code>ufw show added</code> недавно добавленные правила <br> <code>ufw show builtins</code> правила, добавленные по умолчанию <br> <code>ufw show user-rules</code> правила, добавленные пользователем <br> <code>ufw show before-rules</code> правила, которые выполняются перед принятием пакета <br> <code>ufw show after-rules</code> правила, которые выполняются после принятия пакета <br> <code>ufw show logging-rules</code> правила логгирования пакетов<h3 id=firewalld><a aria-label="Anchor link for: firewalld" class=zola-anchor href=#firewalld><i class=icon></i></a> firewalld</h3><p><code>apt install firewalld</code> <br> <code>systemctl status firewalld</code> <br> <code>systemctl start firewalld</code> <br> <code>pkill -f firewalld</code> убить процесс, если при запуске failed <br> <code>firewall-cmd --state</code> статус работы <br> <code>firewall-cmd --reload</code> применить настройки (перечитать) <br> <code>firewall-cmd --list-all</code> список созданных правил (для services и ports) <br> <code>firewall-cmd --list-port</code> только открытые порты <br> <code>firewall-cmd --list-service</code> только открытые службы <br> <code>firewall-cmd --list-all-zones</code> отобразить список зон <br> <code>firewall-cmd --get-active-zones</code> список используемых зон <br> <code>firewall-cmd --list-all --zone=public</code> информация о конкретной зоне <br> <code>firewall-cmd --permanent --add-port=22/tcp</code> открыть 22 порт <br> <code>firewall-cmd --permanent --add-port=8000-8080/udp</code> открыть диапазон портов <br> <code>firewall-cmd --get-services | grep ssh</code> отобразить список доступных служб <br> <code>firewall-cmd --permanent --add-service=ssh</code> разрешить порты для сервиса ssh <br> <code>firewall-cmd --permanent --new-service=speedtest</code> добавить службу <br> <code>firewall-cmd --permanent --service=speedtest --add-port=80/tcp</code> добавить порт к службе <br> <code>firewall-cmd --info-service=speedtest</code> информация о службе <br> <code>firewall-cmd --permanent --add-rich-rule 'rule family="ipv4" source address="192.168.3.0/24" service name="speedtest" accept'</code> открыть доступ для подсети <br> <code>firewall-cmd --permanent --add-rich-rule 'rule family="ipv4" source address="192.168.3.0/24" port port="22" protocol="tcp" accept'</code> <br> <code>firewall-cmd --permanent --add-rich-rule="rule family='ipv4' source address='192.168.21.0/24' reject"</code> закрыть доступ для подсети <br> <code>firewall-cmd --list-rich-rules</code> список правил с условиями <br> <code>firewall-cmd --permanent --remove-port=22/tcp</code> удалить правило<h3 id=iptables><a aria-label="Anchor link for: iptables" class=zola-anchor href=#iptables><i class=icon></i></a> iptables</h3><p><code>iptables -L -v</code> выводит все существующие правила для каждой цепочки <br> <code>iptables -L | grep -E "tcp|udp"</code> <br> <code>if (( $(iptables -L | wc -l | bc) == 8)); then echo active; else echo inactive; fi</code> <br> <code>iptables -A INPUT -p tcp --dport 22 -j ACCEPT</code> открыть входящий порт ssh <br> <code>iptables -A INPUT -p tcp -s !192.168.3.99 --dport 22 -j DROP</code> закрыть входящий порт ssh, исключить 192.168.3.99 <br> <code>iptables-save</code> сохранить настройки, что бы они были активны после перезагрузки <br> <code>iptables -F</code> удалить все правила текущей таблицы<h3 id=nftables><a aria-label="Anchor link for: nftables" class=zola-anchor href=#nftables><i class=icon></i></a> nftables</h3><p><code>nft -a list ruleset</code> список существующих правил <br> <code>nft list tables</code> список существующих таблиц <br> <code>nft flush ruleset</code> очистить правила <br> <code>nft add table inet filter</code> создать таблицу filter <br> <code>nft add chain inet filter input { type filter hook input priority 0\; }</code> добавить цепочку input <br> <code>nft add rule inet filter input ct state related,established counter accept</code> <br> <code>nft add rule inet filter input iifname "lo" counter accept</code> <br> <code>nft add rule inet filter input ip protocol icmp counter accept</code> разрешить icmp <br> <code>nft add rule inet filter input tcp dport {80, 443} counter accept</code> открыть порты <br> <code>nft add rule inet filter input ip saddr { 192.168.100.0/24, 1.1.1.1/32 } tcp dport 22 counter accept</code> открыть 22 порт для подсетей <br> <code>nft chain inet filter input { policy drop \; }</code> остальное блокировать <br> <code>echo "flush ruleset" > /etc/nftables.conf</code> очистить все правила <br> <code>nft -s list ruleset >> /etc/nftables.conf</code> добавить правила в конфигурацию <br> <code>systemctl enable nftables.service</code> <br> <code>nft delete rule inet filter input handle 5</code> удалить правило по номеру <br> <code>nft add rule inet filter input position 5 tcp dport 22 counter accept</code> добавить правило в конкретное место с номером в списке<h2 id=ssh><a aria-label="Anchor link for: ssh" class=zola-anchor href=#ssh><i class=icon></i></a> ssh</h2><p><code>w</code> отобразить активные сессии и их активность (время/дата входа, IDLE время простоя и последняя выполняемая команда) <br> <code>who</code> отобразить активные сессии, время/дата входа и ip с которого подключен пользователь <br> <code>last -a</code> история всех последних входов пользователей в систему <br> <code>lastlog</code> дата последнего входа каждого пользователя в систему <br> <code>last reboot</code> история перезагрузки <br> <code>id -G</code> получить список id крупп в которых состоит текущий пользователь<p><code>apt install xclip xsel</code> буфер обмена <br> <code>cat /etc/ssh/sshd_config | xclip</code> <br> <code>xsel > sshd_config.bak</code> <br> <code>nano /etc/ssh/sshd_config</code> <br> <code>Port 2121</code> изменить порт <br> <code>PermitRootLogin yes</code> включить возможность подключения пользователем root <br> <code>PasswordAuthentication no</code> отключить аудентификацию по паролю <br> <code>X11Forwarding yes</code> включить X11 <br> <code>TCPKeepAlive yes</code> отвечает за проверку активности соединения (отправка пустых keep-alive пакетов для сохранения соединения) <br> <code>ClientAliveInterval 60</code> задать интервал ожидания в секундах, через который sshd запросит ответ от клиента <br> <code>ClientAliveCountMax 3</code> количество запросов без ответа до завешрения сеанса (ClientAliveInterval * ClientAliveCountMax = 180 секунд) <br> <code>systemctl restart sshd</code> <br> <code>systemctl status sshd</code><h3 id=keygen><a aria-label="Anchor link for: keygen" class=zola-anchor href=#keygen><i class=icon></i></a> keygen</h3><p><code>ssh-keygen -t rsa -b 4096</code> сгенерировать пару ключей <br> <code>id_rsa</code> приватный/закрытый ключ хранится на клиенте, от кого происходит подключение (для подключения без пароля имя файла должно быть по умолчанию) <br> <code>cat ~/.ssh/id_rsa.pub | xclip</code> публичный/открытый ключ, для передачи на сервер, куда будем подключаться3 <br> <code>xsel > ~/.ssh/authorized_keys</code> передать содержимое публичного ключа (id_rsa.pub) на сервер, куда подключаться<h3 id=x11><a aria-label="Anchor link for: x11" class=zola-anchor href=#x11><i class=icon></i></a> x11</h3><p><code>apt-get install virt-manager ssh-askpass</code> <br> <code>virt-manager</code> <br> <code>export DISPLAY=username-VirtualBox:10.0 && firefox</code><h3 id=scp><a aria-label="Anchor link for: scp" class=zola-anchor href=#scp><i class=icon></i></a> scp</h3><p><code>ssh-copy-id root@192.168.3.105 -p 2121</code> скопировать публичный ключ на удаленный сервер (добавить новой строкой), утилита будет искать в директории текущего локального пользователя файл публичного ключа и скопирует содержимое файла ключа ~/.ssh/id_rsa.pub указанному при подключение пользователю на удаленный компьютер в файл authorized_keys <br> <code>scp -P 2121 /home/lifailon/files/* lifailon@192.168.3.105:/home/lifailon/downaload/</code> скопировать содержимое каталога files на удаленный компьютер в директорию downaload <br> <code>scp -P 2121 -r kup@192.168.3.105:/home/lifailon/downaload /home/lifailon/files/</code> скачать (-r) данные с удаленного сервера на локальный<h3 id=sshpass><a aria-label="Anchor link for: sshpass" class=zola-anchor href=#sshpass><i class=icon></i></a> sshpass</h3><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">hosts</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span>192.168.3.101 192.168.3.102 192.168.3.103 192.168.3.104<span class="z-punctuation z-section z-parens z-end z-shell">)</span>
</span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">username</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>lifailon<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">port</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell">2121</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-read z-shell">read</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>s</span> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>p</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>Введите пароль пользователя <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">username</span></span>: <span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> password</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-loop z-for z-shell">for</span><span class="z-meta z-group z-for z-shell"> host <span class="z-keyword z-control z-in z-shell">in</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-expansion z-parameter z-begin z-shell">{</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-variable z-other z-readwrite z-shell">hosts<span class="z-punctuation z-section z-braces z-begin z-shell">[</span><span class="z-variable z-language z-array z-shell">@</span><span class="z-punctuation z-section z-braces z-end z-shell">]</span></span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-section z-expansion z-parameter z-end z-shell">}</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-loop z-do z-shell">do</span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sshpass</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">password</span></span> ssh<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">port</span></span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">username</span></span>@<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">host</span></span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>echo <span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">uname</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>n</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span> <span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">free</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>m</span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">grep</span></span><span class="z-meta z-function-call z-arguments z-shell"> Mem:</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">awk</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>{print $3"/"$2}<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-loop z-end z-shell">done</span>
</span></code></pre><h2 id=sudoers><a aria-label="Anchor link for: sudoers" class=zola-anchor href=#sudoers><i class=icon></i></a> sudoers</h2><p><code>cat /etc/sudoers</code> конфигурационный файл настройки прав доступа утилиты sudo <br> <code>visudo</code> открыть sudoers в режиме проверки синтаксиса <br> <code>Defaults env_reset, timestamp_timeout=10</code> задать ограничение времени для sudo на 10 минут <br> <code>echo "lifailon ALL=(ALL) NOPASSWD:ALL" > /etc/sudoers.d/lifailon</code> создать конфигурацию пользователя для использования sudo без пароля <br> <code>chmod 644 /etc/sudoers.d/lifailon</code> <br> <code>lifailon ALL=NOPASSWD: /usr/bin/service memcahched restart, /usr/bin/apt-get update, /usr/bin/apt-get upgrade</code> разрешить перезапуск определенного сервиса, обновление списка пакетов и установку обновлений системы <br> <code>%powerusers ALL=NOPASSWD: /usr/bin/service memcahched restart</code> доступ на группу <br> <code>visudo --check</code> проверка синтаксиса и всех прав доступа (0440) <br> <code>sudo -l</code> проверка прав доступа (выводит список команд, которые текущий пользователь может выполнять с использованием sudo)<h2 id=strace><a aria-label="Anchor link for: strace" class=zola-anchor href=#strace><i class=icon></i></a> strace</h2><p><code>strace -c top -n 1 > /dev/null</code> показывает статистику системных вызовов программы (time - процент от времени общего выполнения, call - кол-во обращений и ошибки) <br> <code>pid=$(pidof dd)</code> узнать pid процесса по имени <br> <code>strace -p $pid</code> показывает системные вызовы процесса (читает данные из одного места с помощью вызова read и записывает в другое через write) <br> <code>strace -f -p $(pgrep -o sshd) -o ~/passwd.txt -v -e trace=write -s 64</code> следим за всеми процессами sshd (-f), ищем все PID sshd процессов (-p), триггер только на запись данных (-e) и ограничиваем вывод 64 байтами <br> <code>cat ~/passwd.txt | grep "[1-32][1-32]) = [1-32][1-32]"</code><h2 id=apt><a aria-label="Anchor link for: apt" class=zola-anchor href=#apt><i class=icon></i></a> apt</h2><p><code>apt-mark showauto</code> список установленных автоматически пакетов <br> <code>apt-mark showmanual</code> список установленных пакетов вручную <br> <code>echo $(($(apt-mark showauto | wc -l) + $(apt-mark showmanual | wc -l)))</code> количество всех установленных пакетов <br> <code>apt list --installed</code> список установленных пакетов apt (Advanced Package Tool) <br> <code>apt update</code> обновить список всех установленных пакетов системы из источников, указанных в файле конфигурации /etc/apt/sources.list <br> <code>cat /etc/apt/sources.list | grep -Ev "^#"</code> список источников <br> <code>apt list --upgradable</code> отобразить список, для каких пакетов доступны обновления <br> <code>apt list --upgradable -a</code> upgradable from, installed и все доступные версии <br> <code>apt install --only-upgrade powershell</code> обновить один выбранный пакет <br> <code>apt --fix-broken install</code> исправить проблемы и ошибки с зависимостями <br> <code>apt full-upgrade</code> обновляет все пакеты, которые уже установлены в системе, доставляет новые пакеты зависимости и удаляет пакеты, которые устанавливались в систему и уже не используются <br> <code>apt install net-tools</code> установить пакет <br> <code>apt download net-tools</code> скачать пакет без установки <br> <code>apt install net-tools --reinstall</code> переустановить пакет <br> <code>apt remove net-tools</code> удалить пакет (конфигурационные файлы, которые были изменены в системе удалены не будут) <br> <code>apt purge net-tools</code> полностью удалить пакет, вместе со всеми его конфигурационными файлами <br> <code>apt policy net-tools</code> какая версия установленна и какие доступны <br> <code>apt install net-tools=number ver.</code> установить конкретную версию <br> <code>apt autoremove</code> очистить ненужные пакеты, которые система не использует <br> <code>apt autoclean</code> очистить кэш пакетов<h2 id=snap><a aria-label="Anchor link for: snap" class=zola-anchor href=#snap><i class=icon></i></a> snap</h2><p>Содержат саму программу (deb-пакет), а также все её зависимости и библитотеки необходимых версий для данной программы. <br> <code>ls /snap</code> директория пакетов <br> <code>ls /var/lib/snapd/snaps</code> расположение загруженных пакетов .snap <br> <code>snap install snap-store</code> установка магазина приложений <br> <code>snap find nmap</code> поиск приложения в магазине snap <br> <code>snap info nmap</code> информация о пакете (его наличии, версия, дата релиза и размер) <br> <code>snap list</code> список установленных в системе пакетов <br> <code>snap list | sed 1d | wc -l</code> количество установленных пакетов <br> <code>snap list --all nmap</code> все доступные версии определенного пакета <br> <code>snap refresh nmap</code> обновить пакет до последней версии <br> <code>snap revert nmap</code> откатить версию до предыдущей <br> <code>snap install nmap --stable</code> установить конкретную версию пакета <br> <code>snap connections nmap</code> посмотреть доступность приложения к интерфейсам системы <br> <code>snap remove nmap</code> удалить пакет<h2 id=dpkg><a aria-label="Anchor link for: dpkg" class=zola-anchor href=#dpkg><i class=icon></i></a> dpkg</h2><p><code>dpkg -i spark.deb</code> установить пакет <br> <code>dpkg -l</code> список установленных deb-пакетов <br> <code>dpkg -l | wc -l</code> количество установленных пакетов <br> <code>dpkg -l spark</code> проверить, установлен ли пакет в системе и его версию <br> <code>dpkg -s spark</code> проверить статус пакета <br> <code>dpkg -r spark</code> удалить (–remove) .deb пакет <br> <code>dpkg -P spark</code> удалить пакет вместе с фаилами конфигурации <br> <code>dpkg -L spark</code> куда установлен пакет (opt/Spark)<h2 id=ntp><a aria-label="Anchor link for: ntp" class=zola-anchor href=#ntp><i class=icon></i></a> ntp</h2><h3 id=time><a aria-label="Anchor link for: time" class=zola-anchor href=#time><i class=icon></i></a> time</h3><p><code>timedatectl</code> текущее время <br> <code>timedatectl set-timezone 'Europe/Moscow'</code> изменить временную зону на MSK, +0300 (изменится Local time) <br> <code>timedatectl list-timezones</code> список часовых поясов <br> <code>timedatectl set-ntp no</code> отключить NTP service <br> <code>timedatectl set-time "13:00:00"</code> после отключения NTP указать время в ручную <br> <code>timedatectl set-ntp yes</code> включить NTP service (NTP service: active)<h3 id=language><a aria-label="Anchor link for: language" class=zola-anchor href=#language><i class=icon></i></a> language</h3><p><code>locale</code> установленные в системе локализации <br> <code>update-locale LANG=en_US.UTF-8</code> изменить локализацию <br> <code>apt-get install language-pack-en language-pack-en-base</code> установить пакет локализаций <br> <code>nano /etc/default/locale</code> <br> <code>LANG=en_US.UTF-8</code> <br> <code>dpkg-reconfigure locales</code><h3 id=timesyncd><a aria-label="Anchor link for: timesyncd" class=zola-anchor href=#timesyncd><i class=icon></i></a> timesyncd</h3><p><code>systemctl status systemd-timesyncd</code> <br> <code>systemctl status systemd-timesyncd | grep "Status": | sed -E "s/^.+server //; "s/.\"//""</code> узнать адрес сервера синхронизации времени <br> <code>apt install systemd-timesyncd</code> установить службу, если unit не запускается <br> <code>apt-get remove ntp ntpstat --purge && apt autoremove</code> удалить ntpd (если был установлен) <br> <code>nano /etc/systemd/timesyncd.conf</code> <br> <code>NTP=192.168.3.233</code> DC (Domain Controller) <br> <code>NTP=0.debian.pool.ntp.org 1.debian.pool.ntp.org 2.debian.pool.ntp.org 3.debian.pool.ntp.org</code> <br> <code>FallbackNTP=ntp.ubuntu.com</code> резерв <br> <code>systemctl restart systemd-timesyncd</code> <br> <code>timedatectl set-ntp true</code> включить использование systemd-timesyncd для синхронизации времени (вместо ntpd) <br> <code>timedatectl status</code><h3 id=ntpd><a aria-label="Anchor link for: ntpd" class=zola-anchor href=#ntpd><i class=icon></i></a> ntpd</h3><p><code>apt install ntp</code> установить NTP-сервер/клиент, при установке будет удален пакет systemd-timesyncd <br> <code>systemctl status ntp</code> <br> <code>sntp --version</code> <br> <code>ufw allow 123/udp && ufw reload</code> <br> <code>timedatectl set-ntp false</code> отключить синхронизацию через systemd-timesyncd на клиенте <br> <code>nano /etc/ntp.conf</code> <br> <code>pool 0.ubuntu.pool.ntp.org</code> указать пул серверов <br> <code>server 0.ru.pool.ntp.org</code> указать на конкретный сервер (если это pool, возьмет один) <br> <code>restrict default kod notrap nomodify nopeer noquery limited</code> настройки/ограничения для локального NTP сервера <br> <code>systemctl restart ntp</code> <br> <code>systemctl status ntp</code> <br> <code>timedatectl status</code> <br> <code>ntpq -p</code> проверка синхронизации времени (+ сервер можно использовать для сверки часов, * синхронизирует сейчас, - не рекомандован, st - уровень stratum, when — когда последний раз сверялось время, delay - время задержки, offset - разница между локальным временем и временем на сервере - отстают от сервера или спешат)<h2 id=top><a aria-label="Anchor link for: top" class=zola-anchor href=#top><i class=icon></i></a> top</h2><p><code>top -c</code> выводит полный путь к исполняемым файлам с ключами, вместо названия <br> <code>top -H</code> выводит потоки процессов <br> <code>top -i</code> не выводит процессы, которые не используют ресурсы процессора <br> <code>top -o %CPU</code> отсортировать по CPU <br> <code>top -o %MEM</code> отсортировать по Memory<h3 id=htop><a aria-label="Anchor link for: htop" class=zola-anchor href=#htop><i class=icon></i></a> htop</h3><p><code>space</code> выделить несколько процессов (отменить Shift+U) <br> <code>u</code> выбрать конкретного пользователя <br> <code>l</code> посмотреть файлы, которые использует процесс <br> <code>s</code> отобразить статистику системных вызовов (strace PID attached) F8 - AutoScroll, F4 - Filter, F9 - Stop/Start Tracing <br> <code>F4</code> фильтр по ключевому слову (например, cron) <br> <code>F5</code> древовидная структура <br> <code>F6</code> сортировка (PERCENT_CPU/PERCENT_MEM/USER/PRIORITY/TIME) <br> <code>F7</code> повысить приортите (до -20), чем меньше приоритет, тем больше процессорного времени отводится процессу <br> <code>F8</code> понизить приоритет (до 19) <br> <code>F9/K</code> действие с процессом (сигналы), для завершения процесса: 15, 2, 3, 9 или 19 <br> <code>S (STATE)</code> состояние процесса <br> <code>R</code> [running or runnable] запущенные или находятся в очереди на запуск <br> <code>S</code> [interruptible sleep] прерываемый сон (не исполняется процессором и ждет события или условия для запуска) <br> <code>D</code> [uninterruptible sleep] непрерываемый сон (кратковременное состояние, которое невозможно остановить сигналом, т.к. процесс не может на него ответить) <br> <code>Z</code> [zombie] завершенный процесс, ожидающий пока родительский процесс примет результат <br> <code>T</code> остановленный сигналом SIGSTOP (-19/CTRL+Z) <br> <code>X</code> мертвый (не должен показываться)<h3 id=bpytop><a aria-label="Anchor link for: bpytop" class=zola-anchor href=#bpytop><i class=icon></i></a> bpytop</h3><p><code>sudo apt install bpytop</code> <br> <code>pip3 list | grep psutil</code> проверить пакет <br> <code>pip3 install psutil --break-system-packages</code> установить пакет в обход ограничений <br> <code>python3 -m venv myenv</code> создать виртуальное окружение <br> <code>source myenv/bin/activate</code> активировать виртуальное окружение <br> <code>pip install psutil</code> установить библиотеку для получения информации о системе <br> <code>bpytop</code> <br> <code>deactivate</code><h3 id=atop><a aria-label="Anchor link for: atop" class=zola-anchor href=#atop><i class=icon></i></a> atop</h3><p><code>apt install atop</code> <br> <code>nano /etc/default/atop</code> <br> <code>LOGINTERVAL=10</code> <br> <code>systemctl restart atop</code> <br> <code>atop -g</code> показать общую информацию о процессе (по умолчанию) <br> <code>atop -m</code> показать информацию о процессах, связанных с памятью <br> <code>atop -d</code> показать информацию о процессах, связанных с дисками <br> <code>atop -n</code> показать информацию о процессах, связанных с сетью <br> <code>atop -v</code> показывать различную информацию о процессах (PPID родителя, пользователь/группа, дата/время) <br> <code>atop -c</code> показать командную строку для каждого процесса <br> <code>atop -A</code> сортировать процессы в порядке наибольшей активности ресурсов (автоматический режим) <br> <code>atop -C</code> сортировать процессы в порядке потребления процессора (по умолчанию) <br> <code>atop -M</code> сортировать процессы в порядке потребления памяти <br> <code>atop -D</code> сортировать процессы в порядке дисковой активности <br> <code>atop -N</code> сортировать процессы в порядке сетевой активности <br> <code>atop -E</code> сортировать процессы в порядке активности GPU<h3 id=iftop><a aria-label="Anchor link for: iftop" class=zola-anchor href=#iftop><i class=icon></i></a> iftop</h3><p><code>apt install iftop</code> установить пакет <br> <code>iftop -ti ens33</code> использовать текстовый интерфейс без ncurses <br> <code>iftop -ts 1 -i ens33</code> печать одного единственного текстового вывода (-s) через 1 секунд, затем выход из системы <br> <code>iftop -tL 0 -s 1 -i ens33</code> количество строк (-L) для печати <br> <code>iftop -ni ens33</code> не преобразовывать имена хостов <br> <code>iftop -Ni ens33</code> не преобразовывать номера портов в сервисы <br> <code>iftop -pi ens33</code> работать в режиме promiscuous (показывать трафик между другими хостами в одном сегменте сети) <br> <code>iftop -bi ens33</code> не отображать гистограмму трафика <br> <code>iftop -Bi ens33</code> отображать пропускную способность в байтах <br> <code>iftop -o 10si ens33</code> сортировка по второму столбцу (среднее значение трафика за 10 секунд, значение по умолчанию)<h3 id=iotop><a aria-label="Anchor link for: iotop" class=zola-anchor href=#iotop><i class=icon></i></a> iotop</h3><p><code>apt install iotop</code> <br> <code>iotop -o</code> показывать только процессы или потоки, фактически выполняющие ввод-вывод <br> <code>iotop -ou mysql</code> показывать активные процессы от пользователя <br> <code>iotop -P</code> показывать только процессы, без потоков <br> <code>iotop -p PID</code><h3 id=top-other><a aria-label="Anchor link for: top-other" class=zola-anchor href=#top-other><i class=icon></i></a> top other</h3><p><code>pip install --user glances</code> кроссплатформенный инструмент мониторинга системы на Python (https://github.com/nicolargo/glances) <br> <code>glances</code><p><code>snap install bashtop</code> монитор ресурсов на Bash (https://github.com/aristocratos/bashtop) <br> <code>bashtop</code><p><code>npm install gtop -g</code> панель мониторинга системы для терминала на JavaScript (https://github.com/aksakalli/gtop) <br> <code>gtop</code><p><code>snap install bottom</code> кроссплатформенный графический монитор системы и процессов на Rust (https://github.com/ClementTsang/bottom) <br> <code>bottom</code><p><code>curl -sL https://raw.githubusercontent.com/wimpysworld/deb-get/main/deb-get | sudo -E bash -s install deb-get && deb-get install zenith</code> как top, но с масштабируемыми графиками, а также использованием CPU, GPU, сети и дисков на Rust (https://github.com/bvaisvil/zenith) <br> <code>zenith</code><h2 id=ps><a aria-label="Anchor link for: ps" class=zola-anchor href=#ps><i class=icon></i></a> ps</h2><p><code>apt-get install -y procps</code> установить пакет procps <br> <code>pstree -a</code> отобразить все (-a) работающие процессы (демоны) и их дочерние в виде дерева <br> <code>ps -FA</code> отобразить подробный вывод (-F, PPID - родительский процесс) всех (-A) работающих процессов <br> <code>ps -LFC mysqld</code> отобразить потоки (-L) в колонках LWP и NLWP конкретного процесса по имени (-C) <br> <code>ps -Fl</code> отобразить приостановленные процессы (фоновые задания &) <br> <code>ps f -F</code> отображает активные процессы текущего пользователя <br> <code>ps f -u root</code> активные процессы указанного пользователя <br> <code>ps -o pid -u lifailon</code> вывести только pid процессов запущенных конкретным пользователем <br> <code>ps -p 3618275</code> найти процесс по его PID (-p/-s) <br> <code>ps -aux --sort -rss</code> выбрать все процессы, кроме фоновых (-a), сопоставлять с именем пользователя (-u), все процессы вне терминала (-x) и отсортировать по RSS, добавляется %CPU и %MEM <br> <code>ps -lax</code> не сопоставляются идентификаторы процессов с именами пользователей, к выводу добавляется WCHAN - ресурс, которого ожидает процесс <br> <code>ps -FA --sort time</code> сортировать по времени работы процесса <br> <code>ps -Ao comm,user,rss,vsz,command</code> отфильтровать вывод по потреблению памяти, названию команды/процесса и полному вызову команды с ключами <br> <code>PRI</code> приоритет процесса <br> <code>NI</code> уступчивость процесса (nice value от 19 до -20) <br> <code>(($PRI+$NI))=((39+-20))=19</code> <br> <code>TTY</code> терминал, из под которого запущен процесс <br> <code>TIME</code> общее время процессора, затраченное на работу процесса (bsdtime/cputime/time) или накопленное процессорное время (пользовательское + системное) <br> <code>STIME</code> время запуска команды (bsdstart), если процесс был запущен менее 24 часов назад, то формат вывода будет HH:MM, если больше, то Mmm:SS (Sep 18) <br> <code>C</code> целочисленное значение процента времени процессора (%CPU) за время жизни процесса <br> <code>%CPU</code> процент времени центрального процесса выделенного процессу или использование процессорного времени деленное на время работы процесса (pcpu) <br> <code>%MEM</code> процент реальной памяти, используемой процессом или отношение размера резидентного набора процесса к объему физической памяти на машине (pmem) <br> <code>SZ</code> размер в физических страницах образа ядра процесса. Сюда входят текст, данные и пространство стека <br> <code>RSS</code> постоянное потребление физической памяти (Resident Set Size non-swapped), реальный размер процесса в оперативной памяти, которую процесс занял (то есть что-то сохранил в память) <br> <code>VSZ</code> виртуальная память (Virtual Memory Size) в килобайтах (1024-байтных единицах), которую выделили процессу, но это не означает, что он успел в эту память что-то записать <br> <code>LWP</code> идентификатор дочернего потока (Light-Weight Process), будет выведен текущий ID если один или первый поток <br> <code>NLWP</code> количество (Number) дочерних потоков (ps -LFC mysqld | sed 1d | wc -l) <br> <code>PSR</code> ядро процессора, на котором выполняется процесс <br> <code>STAT</code> R - выполняется, D - ожидает записи на диск, S - неактивен (&LT20 с), T - приостановлен, Z - зомби, с дополнительными флагами (W - процесс выгружен на диск, < - процесс имеет повышенный приоритет, N - процесс имеет пониженный приоритет, L - некоторые процессы блокированы в ядре, s - процесс является лидером сеанса) <br> <code>maj_flt</code> количество крупных страничных ошибок, произошедших с данным процессом <br> <code>min_flt</code> количество мелких ошибок страниц <br> <code>ps -Ao comm,user,cputime,pcpu,pmem,sz,rss,vsz,nlwp,psr,pri,ni --sort cputime</code><h3 id=kill><a aria-label="Anchor link for: kill" class=zola-anchor href=#kill><i class=icon></i></a> kill</h3><p><code>kill -INT (-2) PID</code> прерывания с терминала, bash пошлёт сигнал SIGINT процессу (аналогично CTRL+C) <br> <code>kill -KILL (-9) PID</code> принудительно завершить процесс <br> <code>kill -STOP (-19) PID</code> остановить процесс, bash пошлёт сигнал SIGSTOP процессу (аналогично CTRL+Z) <br> <code>kill -CONT (-18) PID</code> продолжить остановленный процесс<h3 id=procs><a aria-label="Anchor link for: procs" class=zola-anchor href=#procs><i class=icon></i></a> procs</h3><p><code>snap install procs</code> современная замена ps, написанная на Rust (https://github.com/dalance/procs) <br> <code>procs</code><h2 id=jobs><a aria-label="Anchor link for: jobs" class=zola-anchor href=#jobs><i class=icon></i></a> jobs</h2><p><code>(ping google.com) &</code> запустить задачу в фоне (отображается [job] - номер задачи и PID процесса) <br> <code>jobs</code> отобразить список фоновых задач (+ задача активна) <br> <code>jobs -l | wc -l</code> получить список всех запущенных заданий <br> <code>fg 1</code> открыть задачу по номеру <br> <code>disown</code> завершить все фоновые задачи (удалить/очистить всю очередь заданий) <br> <code>disown %1</code> завершить последнию (если она первая) запущенную задачу <br> <code>kill %1</code> завершить последнию запущенную задачу<h3 id=nohub><a aria-label="Anchor link for: nohub" class=zola-anchor href=#nohub><i class=icon></i></a> nohub</h3><p><code>nohup ping ya.ru > ping.log &</code> используется для запуска процесса, который продолжает работать, даже если пользователь выйдет из сеанса (например, при закрытии терминала) <br> <code>ps -ef | grep "ping ya.ru"</code> найти процесс <br> <code>kill $(pgrep ping)</code> завершить процесс<h2 id=mem><a aria-label="Anchor link for: mem" class=zola-anchor href=#mem><i class=icon></i></a> mem</h2><p><code>free -m</code> объем оперативной памяти и SWAP в МБайт <br> <code>swapon</code> точка монтирования SWAP, type, size, used, priority (берет информацию из /proc/swaps) <br> <code>ipcs -lm</code> объем страниц разделяемой памяти (shared memory) <br> <code>cat /proc/meminfo | grep Dirty</code> отобразить объем грязных (Dirty) страниц в кэше (еще не записанных на диск) <br> <code>sync</code> записать все кэшированные, но еще не записанные данные на диск (вместо кэша данные будут читаться из диска) <br> <code>cat /proc/meminfo | grep -iE "^cache|^buff"</code> объем кэша и буфера <br> <code>echo 1 > /proc/sys/vm/drop_caches</code> отправить сигнал на вход drop_caches для очистки страничного кэша (free buff/cache) - PageCache (сигнал 1) <br> <code>echo 2 > /proc/sys/vm/drop_caches</code> очистка кэша структуры файловой системы - inode, dentrie (сигнал 2)<h3 id=fincore><a aria-label="Anchor link for: fincore" class=zola-anchor href=#fincore><i class=icon></i></a> fincore</h3><p><code>fincore /var/log/*</code> отобразить все файлы, которые находятся в кэше страниц оперативной памяти (page cache) <br> <code>fincore /var/log/syslog</code> 4.3M (данные файла, хранящиеся в памяти) 1100 (кол-во страниц хранящиеся в памяти PageCache) 199.7M (размер файла) <br> <code>fincore /var/log/syslog -J</code> вывод в JSON (–raw вывод без табулияции, –noheadings без заголовков, –byte размер файла в байтах) <br> <code>apt install vmtouch</code> <br> <code>vmtouch /var/log/syslog</code> узнать какой процент указанного файла находится в страничном кеше (Resident Pages: 1100/51119 4M/199M 2.15%)<h3 id=lspage><a aria-label="Anchor link for: lspage" class=zola-anchor href=#lspage><i class=icon></i></a> lspage</h3><p><code>fc=$(du -a $1 2> /dev/null | awk '{print $2}' | xargs fincore 2> /dev/null)</code> <br> <code>echo -e "PAGE\tSIZE\tPATH"</code> <br> <code>printf "%s\n" "${fc[@]}" | grep -wvE "0B|SIZE" | awk 'BEGIN {OFS="\t"}; {print $1,$3,$4}'</code><h2 id=lsof><a aria-label="Anchor link for: lsof" class=zola-anchor href=#lsof><i class=icon></i></a> lsof</h2><p><code>PID</code> идентификационный номер процесса, который открыл файл <br> <code>TID</code> идентификационный номер задачи/потока, пустой столбец означает, что это не задача а процесс <br> <code>FD</code> файловый дескриптор файла (r - доступ для чтения, w - доступ для записи, u - доступ для чтения и записи, -r - режим неизвестен и есть символ блокировки на чтение часть файла, R - на весь файл) <br> <code>TYPE</code> тип узла, связанного с файлом (REG - обычный файл файловой системы, DIR - директория, CHR - символьный файл, BLK - блочный файл, INET - Интернет-сокет, unix - доменный сокет UNIX, IPv4 - IPv4 сокет, sock - неизвестный сокет, DEL - указатель Linux для удалённого файла, LINK - файл символьной ссылки, PIPE: — способ обмена данными между процессами) <br> <code>SIZE/OFF</code> размер файла или смещение файла в байтах <br> <code>lsof | sed 1d | wc -l</code> кол-во открытых файлов/дескрипторов <br> <code>cat /proc/sys/fs/file-nr</code> кол-во открытых файловых дескрипторов в текущий момент, открытые файлы которые сейчас не используются, максимальное количество для открытия <br> <code>lsof +D /var/log/</code> отобразить каким процессом и пользователем используются файлы в каталоге (+D dir) FD: r/w/u <br> <code>dd if=/dev/zero of=~/dd-zero-file</code> занять файл процессом dd и Ctrl+Z остановить процесс (отправить в jobs) <br> <code>ls -lh ~/dd*</code> <br> <code>lsof ~/dd-zero-file</code> отобразить каким процессом занят файл (List Open Files) <br> <code>lsof -c dd</code> отобразить все файлы запущенные по имени процесса/команды (в формате wildcard) <br> <code>lsof -p 1832509</code> отобразить все открытые файлы по номеру PID-процесса (-p) <br> <code>lsof -c mysql</code> отобразить все файлы которые держит открытыми процесс по названию процесса (-c) <br> <code>lsof -c bash | grep "\.sh"</code> найти все запущенные скрипты <br> <code>kill -9 $(lsof -t ~/dd-zero-file)</code> отфильтровать для вывода уникальных номеров PID-процесса (-t) использующие файл, для их завершения (kill) <br> <code>kill -9 $(lsof -t +D /smb/backup)</code> убить все процессы использующие файлы в директории для дальнейшего umount /smb/backup <br> <code>lsof -u root</code> отобразить все файлы открытые пользователем <br> <code>lsof -u^root | wc -l</code> исключить пользователя (^) из поиска и отобразить кол-во открытых файлов <br> <code>lsof -i:8080</code> проверить открыт ли порт (-i:)<h3 id=descriptor><a aria-label="Anchor link for: descriptor" class=zola-anchor href=#descriptor><i class=icon></i></a> descriptor</h3><p><code>lsof -a -p $$ -d 0,1,2</code> отобразить дескрипторы текущего интерпритатора <code>ps $$</code> <br> <code>0u</code> STDIN — стандартный поток ввода (с клавиатуры) <br> <code>1u</code> STDOUT — стандартный поток вывода (на экран/в файл) <br> <code>2u</code> STDERR — стандартный поток ошибок <br> <code>cat test.txt 1> out.txt 2> error.txt</code> перенаправить успешный вывод (если файл существует) в out.txt, если ошибка в error.txt <br> <code>cat test2.txt 2> /dev/null</code> не выводить ошибки <br> <code>cat=$(cat test 2>&1)</code> используется для перенаправления стандартного вывода ошибок (stderr - standard error) в стандартный вывод (stdout - standard output) с указанием файлового дескриптора (&) вместо файла<h2 id=vmstat><a aria-label="Anchor link for: vmstat" class=zola-anchor href=#vmstat><i class=icon></i></a> vmstat</h2><p><code>cat /proc/vmstat</code> отображает nr_free_pages, inactive/active anon, file <br> <code>cat /proc/zoneinfo</code> с разбиением на зоны памяти в зависимости от ее назначения <br> <code>vmstat -V</code> procps-ng 3.3.17 (разработчик top) <br> <code>vmstat -s</code> статистика memory/swap/io/system/cpu <br> <code>vmstat -d | grep sda</code> статистика диска <br> <code>vmstat -D</code> суммарная статистика дисков <br> <code>vmstat -t 1 2</code> отобразить 2 отчета (суммарный и текущий) с частатой обновления 1 секунда и timestamp (-t) <br> <code>r</code> количество запущенных процессов (работающих или ожидающих выполнения) <br> <code>b</code> количество спящих процессов <br> <code>swpd</code> объем используемой виртуальной памяти <br> <code>free</code> объем свободной памяти <br> <code>buff</code> количество памяти, используемой в качестве буферов <br> <code>cache</code> объем памяти, используемой в качестве кеша <br> <code>inact</code> количество неактивной памяти (-a) <br> <code>active</code> количество активной памяти (-a) <br> <code>si</code> объем памяти, выгруженный с диска (/s) <br> <code>so</code> объем памяти, перенесенный на диск (/s) <br> <code>bi</code> IOPS (Input/Output Operations Per Second) блоки, полученные от блочного устройства (block input/sec) <br> <code>bo</code> IOPS блоки, отправленные на блочное устройство (block output/sec) <br> <code>in</code> количество прерываний в секунду, включая часы <br> <code>cs</code> количество переключений контекста в секунду <br> <code>us</code> время, потраченное на запуск кода, не относящегося к ядру (время пользователя) <br> <code>sy</code> время, потраченное на выполнение кода ядра (системное время) <br> <code>id</code> время бездействия <br> <code>wa</code> время, проведенное в ожидании ввода/вывода <br> <code>st</code> время, украденное из виртуальной машины<h2 id=sysstat><a aria-label="Anchor link for: sysstat" class=zola-anchor href=#sysstat><i class=icon></i></a> sysstat</h2><p><code>apt install sysstat</code><h3 id=iostat><a aria-label="Anchor link for: iostat" class=zola-anchor href=#iostat><i class=icon></i></a> iostat</h3><p><code>iostat -h</code> выводить данные в kb/mb/gb (avg-cpu: %user %system %idle, tps - количество запросов на чтение и запись к устройству в секунду) <br> <code>iostat -hp</code> вывести статистику по устройству и всех его разделам (-p) <br> <code>iostat -ky /dev/sd* 1 1 | grep -w sd.</code> выводить статистику в КБайт (-k), при отображении нескольких записей с заданным интервалом первый отчет со статистикой с момента загрузки системы опускается (-y) <br> <code>iostat -h /dev/sda3 -o JSON</code> вывод в формате JSON<h3 id=mpstat><a aria-label="Anchor link for: mpstat" class=zola-anchor href=#mpstat><i class=icon></i></a> mpstat</h3><p><code>mpstat</code> отобразить подробную статистику по использованию процессора по каждому ядру, и куда используются ресурсы <br> <code>mpstat -P ALL</code> отобразить отдельно для каждого ядра. <br> <code>mpstat 2 10</code> отобразить 10 раз с обновлением каждые 2 секунды <br> <code>%user</code> процент использования процессора программами, запущенными на уровне пользователя <br> <code>%nice</code> процент использования процессора программами запущенными в пространстве пользователя, с изменённым приоритетом <br> <code>%system</code> процент использования процессора ядром <br> <code>%iowait</code> процент времени затраченного на ожидание завершения операций ввода/вывода, если значение параметра слишком большое, значит много времени тратится на ожидание завершения ввода/вывода <br> <code>%steal</code> процент простоя виртуального процессора, пока гипервизор отдаёт мощность другому виртуальному процессору <br> <code>%idle</code> процент времени пока процессор не занят ничем<h3 id=pidstat><a aria-label="Anchor link for: pidstat" class=zola-anchor href=#pidstat><i class=icon></i></a> pidstat</h3><p><code>pidstat</code> используется для мониторинга родительских и дочерних процессов и текущих потоков <br> <code>pidstat -p ALL</code> вывести все активные и неактивные задачи<h2 id=stress><a aria-label="Anchor link for: stress" class=zola-anchor href=#stress><i class=icon></i></a> stress</h2><p><code>stress --cpu 2 --timeout 10</code> загрузить выбранное количество ядер в течении 10 секунд <br> <code>stress -v N</code> нагрузить виртуальную память <br> <code>stress --io 100 &</code> количество процессов нагрузки на ввод-вывод <br> <code>iostat -d /dev/sda 1</code> <br> <code>stress --hdd 100 &</code> нагрузка на диск <br> <code>vmstat 1 100</code><h3 id=stress-ng><a aria-label="Anchor link for: stress-ng" class=zola-anchor href=#stress-ng><i class=icon></i></a> stress-ng</h3><p><code>apt-get install stress-ng</code> <br> <code>stress-ng --sequential 0 --class io --timeout 60s --metrics-brie</code> тест ввода вывода <br> <code>stress-ng --hdd 5 --hdd-ops 100000</code> будет запущено 5 стрессоров для жёстких дисков, которые будут остановлены по завершении 100 тыс. bogo-операций <br> <code>stress-ng --cpu 1 --cpu-method matrixprod --metrics --timeout 60</code> <br> <code>stress-ng --sequential 0 --class memory --timeout 60s --metrics-brief</code> <br> <code>stress-ng --cpu 2 --io 4 --vm 1 --vm-bytes 1G --timeout 60s --metrics-brief</code><h2 id=smart><a aria-label="Anchor link for: smart" class=zola-anchor href=#smart><i class=icon></i></a> smart</h2><h3 id=smartmontools><a aria-label="Anchor link for: smartmontools" class=zola-anchor href=#smartmontools><i class=icon></i></a> smartmontools</h3><p><code>apt install smartmontools</code> <br> <code>smartctl -a /dev/sda</code> тест диска и информация о модели и температуре <br> <code>smartctl -H /dev/sda</code> SMART Health Status<h3 id=sensors><a aria-label="Anchor link for: sensors" class=zola-anchor href=#sensors><i class=icon></i></a> sensors</h3><p><code>apt install lm-sensors</code> <br> <code>sensors-detect</code> сканировать датчики температуры <br> <code>sensors</code> отобразить датчики<h3 id=badblocks><a aria-label="Anchor link for: badblocks" class=zola-anchor href=#badblocks><i class=icon></i></a> badblocks</h3><p><code>badblocks -s /dev/sda</code> тест на наличие нечитаемых/битых блоков/секторов на диске<h3 id=hdparm><a aria-label="Anchor link for: hdparm" class=zola-anchor href=#hdparm><i class=icon></i></a> hdparm</h3><p><code>hdparm -I /dev/sda | grep -i model</code> модель жесткого диска (Model Number, Serial Number, Firmware Revision) <br> <code>hdparm -v /dev/sda</code> кол-во секторов и настройки <br> <code>hdparm -tT /dev/sda</code> тест скорости работы без кэша (-t) и с кэшем (-T) <br> <code>hdparm -D /dev/sda</code> включение/отключение управления дефектами дисков <br> <code>hdparm -r /dev/sda</code> включает режим read only для диска <br> <code>hdparm -A /dev/sda</code> включает режим read-look-ahead, когда диск просматривается перед чтением, включена по умолчанию <br> <code>hdparm -a /dev/sda</code> включает режим read-ahead, когда чтение выполняется в первую очередь, позволяет улучшить производительность чтения больших объемов данных <br> <code>hdparm -b /dev/sda</code> остановить жесткий диск до следующего к нему обращения <br> <code>hdparm -S 1 /dev/sda</code> остановить вращение мотора диска до следующего к нему обращения <br> <code>hdparm -B 120 /dev/sda</code> настройка управления питанием Advanced Power Management (APM), чем ниже значение, тем лучше энергосбережение (255 - для отключения) <br> <code>hdparm -Z /dev/sda</code> отключает режим энергосбережения <br> <code>hdparm -M 128 /dev/sda</code> управление уровнем шума (принимает значения от 128 - более тихую работу, до 254 - высокую)<h2 id=disk><a aria-label="Anchor link for: disk" class=zola-anchor href=#disk><i class=icon></i></a> disk</h2><p><code>du -sh /home</code> отобразить общий размер указанной директории (-s) <br> <code>du -Sh /home</code> отобразить общий размер всех дочерних (-S) директорий по пути <br> <code>du -h /home</code> отображает общий размер указанной директории и подкаталогов внутри директории <br> <code>du -ah /home</code> отобразить общий размер директории и всех дочерних файлов (-a) и директорий<p><code>lsblk</code> отображает список всех подключенных блочных устройств (/dev), их SIZE, TYPE (disk/part/lvm) и точку монтирования (MOUNTPOINTS) <br> <code>lsblk -e7</code> вывод без loop <br> <code>lsblk -f</code> отображает используемую FSTYPE, UUID, FSAVAIL - сколько свободно на диске и FSUSE - сколько занято на диске в процентах <br> <code>lsblk -o NAME,MODEL,SERIAL,SIZE,STATE --nodeps | grep running</code> отображает модель, размер и статус без структуры разделов/lvm (–nodeps) <br> <code>lsblk -E NAME</code> исключить дублирование вывода по колонке <br> <code>lsblk -S</code> вывод информации о SCSI-устройствах (–scsi) <br> <code>lsblk -b</code> выводить SIZE в байтах (–bytes) <br> <code>lsblk -J</code> вывод в формате JSON (–json) <br> <code>lsblk -P</code> использовать формат вывода key=“value” <br> <code>lsblk -m</code> выводить информацию о правах доступа<p><code>df -h</code> выводит информацию примонтированных файловых системах. Отображает общий объём (Size), занятого (Used) и свободно (Avail) пространства <br> <code>df -h -T</code> отобразить Type файловой системы (ext4/cifs)<p><code>apt install duf</code> установить duf <br> <code>duf</code> аналог df<p><code>mount | grep /dev/</code> отобразить все примонтированные файловые системы <br> <code>mount | grep -P "mapper|lv|vg"</code> примонтированные lvm<p><code>findmnt</code> отобразить список смонтированных файловых систем в древовидном формате <br> <code>findmnt -l</code> в формате списка <br> <code>findmnt -t ext4</code><p><code>e2label /dev/sda3</code> узнать метку диска <br> <code>blkid</code> отобразить список подключённых дисков, их UUID и TYPE <br> <code>lsscsi</code> отобразить параметры SCSI устройств подключенных к системе<h3 id=parted><a aria-label="Anchor link for: parted" class=zola-anchor href=#parted><i class=icon></i></a> parted</h3><p><code>parted -l</code> отобразить список всех разделов на дисках <br> <code>parted -l | grep -i model</code> <br> <code>dd if=/dev/zero of=/tmp/disk.img count=1000 bs=1M</code> создать образ диска заполненный нулями размером 1Гб <br> <code>parted /tmp/disk.img</code> передать parted созданный файл-образ для управления ФС <br> <code>parted /dev/sdc</code> передать parted диск <br> <code>mktable gpt</code> создать таблицу разделов GPT <br> <code>print</code> отобразить тип таблицы (Partition Table: GPT) и список разделов на устройстве, если они были созданы <br> <code>print free</code> отобразить свободное место и все разделы <br> <code>mkpart primary ext4 0 500M</code> создать первый, первичный (primary) раздел с ФС ext4 размером 500Мб. <br> <code>mkpart primary ext4 500 1000M</code> создать второй раздел (начало и конец) <br> <code>resizepart 2 600M</code> уменьшить 2-й раздел до 100МБ (указывается end-конец) <br> <code>resizepart 2 100%</code> увеличить до всего свободного размера <br> <code>rm 2</code> удалить раздел<h3 id=fdisk><a aria-label="Anchor link for: fdisk" class=zola-anchor href=#fdisk><i class=icon></i></a> fdisk</h3><p><code>fdisk -l</code> отображает список всех подключенных устройств построчно с размером секторов для каждого раздела <br> <code>fdisk -x</code> подробный вывод (узнать UUID разделов) <br> <code>fdisk -l | grep /dev/sd</code> <br> <code>fdisk -l | grep -E "/dev/sd.[1-9]"</code> <br> <code>fdisk -l | grep -E "lv|vg"</code> <br> <code>fdisk /dev/sdc</code> <br> <code>m</code> список команд <br> <code>p</code> отобразить размер диска и список разделов (/dev/sdc1) <br> <code>n</code> создать новый раздел (p), указать номер раздела - partition number (4-128, default 4), начало и конце сектора - enter (оставить по умолчанию) <br> <code>i</code> информация о выбранном разделе разделе (начало, конец, общий размер сектора и размер диска) <br> <code>t</code> задать тип раздела - 30/8E (Linux LVM) или 20/83 (Linux filesystem) <br> <code>l</code> отобразить список всех типов <br> <code>w</code> сохранить <br> <code>q</code> выход <br> <code>partprobe /dev/sdc</code> информирует ядро ОС об изменениях таблицы разделов, запрашивая у системы, чтобы она перечитала таблицу разделов<h3 id=sfdisk><a aria-label="Anchor link for: sfdisk" class=zola-anchor href=#sfdisk><i class=icon></i></a> sfdisk</h3><p><code>sfdisk -d /dev/sdc > sdc.partition.table.txt</code> backup (аналогично dump cfdisk) <br> <code>sfdisk -f /dev/sdc < sdc.partition.table.txt</code> восстановить<p><code>sfdisk -d /dev/sda | sfdisk -f /dev/sdd</code> для восстановления MD RAID1 (sda в sdd) <br> <code>mdadm --manage /dev/md1 --add /dev/sdd1</code> восстановление копирования <br> <code>watch cat /proc/mdstat</code> отображать прогресс синхронизации<ul><li>Новый диск для расширения LVM:</ul><p><code>ls /dev/sd*</code> отобразить все диски в файловой системе <br> <code>fdisk -l</code> отобразить все диски через fdisk <br> <code>cfdisk /dev/sda</code> разметка диска на разделы (новый вариант) <br> <code>cfdisk /dev/sdb</code> инициализировать новый диск, выбрать таблицу разделов (gpt) <br> <code>new - sda4</code> создать новый раздел sda4 или sdb1 <br> <code>Free space - Partition size: 100G</code> <br> <code>write - yes</code> <br> <code>pvcreate /dev/sda4</code> создать физический виртуальный том из раздела <br> <code>vgextend ubuntu-vg /dev/sda4</code> добавить новый раздел в группу <br> <code>lvextend -l +100%FREE /dev/ubuntu-vg/ubuntu-lv</code> добавить свободное место в группе для логического раздела ubuntu-lv <br> <code>lsblk</code> <br> <code>df -h</code> система будет видеть старый объем диска, необходимо выполнить команду по изменению размера файловой системы <br> <code>df -T -h</code> отобразить тип ФС <br> <code>resize2fs -f /dev/ubuntu-vg/ubuntu-lv</code> для ext* <br> <code>btrfs filesystem resize +100g /</code> для btrfs<ul><li>Новый диск для нового раздела:</ul><p><code>cfdisk /dev/sdс</code> создать раздел (cfdisk/fdisk/parted) <br> <code>mkfs.ext4 /dev/sdc1</code> форматировать раздел <br> <code>mkdir /mnt/sdc1 && mount /dev/sdc1 /mnt/sdc1</code> примонтировать раздел, -o -r - монтировать только на чтение (–options –read-only) <br> <code>df -h && lsblk</code> раздел нового диска должен быть в статусе Mounted on или MOUNTPOINTS <br> <code>chmod 0777 /mnt/sdc1</code> разрешить всем пользователям доступ к диску <br> <code>df -h -T</code> отображает тип файловой системы примонтированных разделов <br> <code>nano /etc/fstab</code> сохранить монтирование после перезагрузкиы <br> <code>/dev/sdc1 /mnt/sdc1 ext4 rw,relatime 0 0</code> добавить по наименованию или UUID устройства <br> <code>umount /dev/sdc1</code> отмантировать раздел<h3 id=swap><a aria-label="Anchor link for: swap" class=zola-anchor href=#swap><i class=icon></i></a> swap</h3><p><code>fallocate -l 4G /swapfile.img</code> создать файл для swap <br> <code>dd if=/dev/zero of=/swapfile.img count=1024 bs=1M</code> создать файл для swap <br> <code>chmod 600 /swapfile.img</code> дать права <br> <code>mkswap /swapfile.img</code> создать swap-пространство из файла или используя весь объём раздела (mkswap /dev/sda4) <br> <code>swapon /swapfile.img</code> активировать swap-пространство <br> <code>echo '/swapfile.img none swap sw 0 0' | sudo tee -a /etc/fstab</code> примонтировать <br> <code>free -m</code> отобразить объём <br> <code>swapoff -a</code> отключить <br> <code>rm /swapfile.img</code> удалить файл<h2 id=lvm><a aria-label="Anchor link for: lvm" class=zola-anchor href=#lvm><i class=icon></i></a> lvm</h2><p><strong>Logical Volume Management</strong> - управление логическими томами, это дополнительный слой абстракции от железа, позволяющий собрать несколько разных дисков в один, и затем разбить его на группы и разделы. Позволяет использовать программный RAID 0 и 1 (зеркалирование) с управляемым пространством, снапшотами и импортированием томов в другую систему.<ul><li>PV (Physical Volume) — физические тома</ul><p><code>pvs</code> отображает список Physical Volume <br> <code>pvdisplay</code> подробная информация <br> <code>pvcreate /dev/sdb</code> инициализация диска в LVM как физический том<ul><li>VG (Volume Group) — группы томов, для объединения физических томов и создания общего логического диска, который будет разбиватсья на разделы</ul><p><code>vgs</code> отображает список Volume Group <br> <code>vgdisplay</code> подробная информация <br> <code>vgcreate vg21 /dev/sdb</code> создать группу томов с добавлением физического тома на диске sdb<ul><li>LV (Logical Volume) — логические разделы</ul><p><code>lvs</code> отображает список Logic Volume и их объём <br> <code>lvdisplay</code> подробная информация <br> <code>lvcreate -n boot -L 1G vg21</code> создать первый логический раздел с наименованием boot <br> <code>lvcreate -n home -L 9G vg21</code> создать второй логический раздел с наименованием home <br> <code>lvcreate -n lv21 -l+100%FREE vg21</code> создать один логический раздел lv21 для группы томов vg21 и назначить ему весь объем диска <br> <code>mkfs -t ext4 /dev/vg21/lv21</code> назначить файловую систем ext4 <br> <code>mkdir /mnt/lv21</code> создать папку для монтирования <br> <code>mount /dev/vg21/lv21 /mnt/lv21</code> примонтировать раздел к созданной папке <br> <code>echo "/dev/vg21/lv21 /mnt/lv21 ext4 defaults 0 0" >> /etc/fstab</code> добавить монтирование в автозагруку<ul><li>Увеличить</ul><p>Расширение физического раздела можно сделать за счет добавление нового диска путём добавления в группу или увеличением имеющегося виртуального диска. <br> <code>pvcreate /dev/sdc</code> eсли добавлен новый диск, инициализируем (минус: если один из дисков выходит из строя, данные будут не доступны, аналогично работе RAID 0) <br> <code>pvresize /dev/sdb</code> если увеличин объем дискового пространства виртуального диска (resize - изменить размер физического тома) <br> <code>vgextend vg21 /dev/sdc</code> расширить группу vg21 за счет добавленного диска sdc (или vgdisplay) <br> <code>vgs</code> отобразит у какой из групп всего памяти VSize и сколько доступно памяти VFree для распредиления логическим разделам памяти, которую расширили <br> <code>lvextend -l +100%FREE /dev/vg21/lv21</code> добавить все свободное простраство логическому разделу <br> <code>vgs</code> VFree будет=0 а в lsblk объём раздела увеличится <br> <code>lvextend -L+1G /dev/vg21/lv21</code> добавить 1Гб от группы томов vg21 разделу lv21 <br> <code>lvextend -L500G /dev/vg21/lv21</code> добавить до конкретного размера диска 500Гб <br> <code>lvs</code> проверить <br> <code>df -T</code> отобразить используемую ФС <br> <code>resize2fs /dev/vg01/lv01</code> изменить размер для файловой системы ext4<ul><li>Уменьшить</ul><p><code>e2fsck -fy /dev/vg21/lv21</code> проверка диска <br> <code>resize2fs /dev/vg21/lv21 500M</code> уменьшить размер ФС на 500Мбайт <br> <code>lvreduce -L-500 /dev/vg21/lv21</code> уменьшить размер логического тома на 500Мбайт <br> <code>vgs</code> добавится VFree 500m для распределения другой логической группе<p><code>resize2fs /dev/ubuntu-vg/ubuntu-lv 1G</code> уменьшить размер ФС на 500Мбайт <br> <code>lvreduce -L-1000 /dev/ubuntu-vg/ubuntu-lv</code> уменьшить размер логического тома на 1000Мбайт (Logical volume ubuntu-vg/ubuntu-lv successfully resized) <br> <code>vgs</code> VFree 1000.00m<ul><li>Удалить</ul><p><code>umount /dev/vg21/lv21</code> предварительно отмантировать <br> <code>lvremove /dev/vg21/lv21</code> удалить логический том <br> <code>lvs</code> нет групп <br> <code>vgs</code> VSize и VFree объём совпадает <br> <code>vgremove vg21</code> удалить группу томов <br> <code>pvremove /dev/sdb</code> удалить диск sdb из LVM<ul><li>RAID 1</ul><p>Новый диск sdc разбить на 2 раздела (основной sdc1, немного больше чем у целевого зеркалируемого раздела lv21 и sdc2 оставшийся объем для ведения файла журнала) <br> <code>pvcreate /dev/sdc1 /dev/sdc2</code> добавить оба раздела в LVM <br> <code>vgextend vg21 /dev/sdc1 /dev/sdc2</code> добавить в имеющиюся группу vg21 (расширить группу vg21) <br> <code>vgs</code> у группы vg21 VFree увеличится объём добавленных томов-разделов <br> <code>lvconvert -m1 /dev/vg21/lv21 /dev/sdb /dev/sdc1 /dev/sdc2</code> конвертируем логический том lv21, входящий в состав группы vg21 в зеркалируемый том (-m1), зеркалируется /dev/sdb (где находится lv21) на sdс1, а /dev/sdс2 используется для ведения файла журнала.<p><code>lvs -a -o +devices</code> раздел lv21 пишет на 2 устройства<pre class=z-code><code><span class="z-text z-plain">[lv21_rimage_0] /dev/sdb(0) # основной том
</span><span class="z-text z-plain">[lv21_rimage_1] /dev/sdc1(1) # зеркало
</span></code></pre><p><code>lsblk</code><pre class=z-code><code><span class="z-text z-plain">sdb                     8:16    0    4G  0 disk
</span><span class="z-text z-plain">+-vg21-lv21_rmeta_0    253:0    0    4M  0 lvm
</span><span class="z-text z-plain">¦ L-vg21-lv21          253:4    0    2G  0 lvm
</span><span class="z-text z-plain">L-vg21-lv21_rimage_0   253:1    0    2G  0 lvm
</span><span class="z-text z-plain">  L-vg21-lv21          253:4    0    2G  0 lvm
</span><span class="z-text z-plain">sdc                     8:32    0    4G  0 disk
</span><span class="z-text z-plain">+-sdc1                  8:33    0    3G  0 part
</span><span class="z-text z-plain">¦ +-vg21-lv21_rmeta_1  253:2    0    4M  0 lvm
</span><span class="z-text z-plain">¦ ¦ L-vg21-lv21        253:4    0    2G  0 lvm
</span><span class="z-text z-plain">¦ L-vg21-lv21_rimage_1 253:3    0    2G  0 lvm
</span><span class="z-text z-plain">¦   L-vg21-lv21        253:4    0    2G  0 lvm
</span></code></pre><p>Извлекаем (удаляем) <code>sdb</code> (оригинальный диск) <br> <code>lsblk</code> отображает только два раздела (part) sdc1 и sdc2 зеркального диска без LVM, т.к. группа не активна <br> Командой <code>lvs</code> видим группу <code>vg21</code> и ошибки:<pre class=z-code><code><span class="z-text z-plain">WARNING: Couldn't find device with uuid stBI99-6Qs3-B8lr-Ekaw-ahnD-oxPc-LsayLR.
</span><span class="z-text z-plain">WARNING: VG vg21 is missing PV stBI99-6Qs3-B8lr-Ekaw-ahnD-oxPc-LsayLR (last written to /dev/sdb).
</span></code></pre><p><code>vgchange -ay vg21</code> активировать группу <br> <code>mount /dev/vg21/lv21 /mnt/lv21</code> примонтировать группу lv21<ul><li>Snapshot</ul><p><code>lvs</code> <br> <code>lvcreate -L 1G -s -n snap-1 /dev/ubuntu-vg/ubuntu-lv</code> предварительно нужно добавить VFree в Volume Group (Logical volume “snap-1” created) <br> <code>lvcreate -L 1G -s -n snap-1 /dev/vg21/lv21</code> параметр -s помечает, что 1Гб дискового пространства из группы vg21 будет использоваться для snapshot lv21 <br> <code>lvs</code> Origin - к какому логическому тому (lv) относиться snapshot, Data% — процент исползованного объема от выделенного. <br> <code>lsblk</code> отображает изменения в томах разделов <br> <code>mount /dev/vg21/snap-1 /mnt/snap</code> содержимое снапшота можно смонтировать как обычный раздел, если отредактивароть снапшот и откатиться к нему, мы получим те данные, которые отредактировали <br> <code>lvconvert --merge /dev/vg21/snap-1</code> откатиться к снапшоту snap-1, понадобится перезагрузка ОС (даже если это не основной диск)<ul><li>Export/Import</ul><p><code>umount /dev/vg21/lv21</code> отмантировать <br> <code>vgchange -an vg21</code> деактивировать группу томов (0 logical volume в volume group “vg21”) <br> <code>vgexport vg21</code> экспортировать группу (successfully exported) <br> <code>pvdisplay</code> список групп (VG Name vg21 (exported)) <br> Переносим диск на новый компьютер: <br> <code>pvscan</code> сканировать группы на новой системе (PV /dev/sdb is in exported VG vg21) <br> <code>vgimport vg21</code> импортировать в систему (successfully imported) <br> <code>vgs и lvs</code> проверить группы <br> <code>vgchange -ay vg21</code> активировать группу (1+ lg в vg “vg21”) <br> <code>lsblk</code> проверить подключение LVM<h2 id=md><a aria-label="Anchor link for: md" class=zola-anchor href=#md><i class=icon></i></a> md</h2><blockquote><p>SOFT RAID</blockquote><p><code>mdadm --zero-superblock --force /dev/sd{b,c}</code> занулить все суперблоки на дисках, которые будут добавлены в RAID-массив, т.к. диски могут содержать служебную информацию о других RAID (вывод: unrecognised md component device - ни один из дисков ранее не был добавлен в массив) <br> <code>mdadm --create --verbose /dev/md0 -l 1 -n 2 /dev/sd{b,c}</code> создать зеркальный RAID1 (-l/–leve 1) и указать кол-во дисков (-n/–raid-devices) <br> <code>mkfs.ext4 /dev/md0</code> форматировать в fs ext4 <br> <code>mkdir /md0-sdb-sdc-raid1</code> создать директорию для монтирования <br> <code>mount /dev/md0 /md0-sdb-sdc-raid1</code> примонтировать вручную <br> <code>lsblk -o NAME,UUID | grep md*</code> отобразить UUID устройства <br> <code>echo "UUID=20482c47-fa11-462d-b7b8-93a342a7edf8 /md0-sdb-sdc-raid1 ext4 defaults 1 2" >> /etc/fstab</code> добавить в автозагрузку по UUID, т.к. после перезагрузки ОС номер может измениться на md127 <br> <code>mount -a</code> примонтировать все файловые системы из fstab <br> <code>cat /proc/mdstat</code> проверить состояние всех доступных RAID-массивов: md127 : active raid1 sdc[1] sdb[0] <br> <code>mdadm -D /dev/md127</code> подробное (–detail) состояние массива. State: cleane (проблем нет)/degraded (диск неисправен/поврежден). Active/Working/Failed/Spare Devices - количество активных (в работе)/рабочих/нерабочих/запасных дисков в массиве. Consistency Policy - тип синхронизации после сбоя в массиве (resync - полная синхронизация после восстановления массива). <br> <code>mdadm /dev/md127 --add /dev/sdd</code> добавить запасной диск (в Spare Device) для горчей замены (Hot-Spare), в статусе списка дисков будет указан какой диск (State - spare /dev/sdd) <br> <code>mdadm -G /dev/md127 —raid-devices=3</code> расширить массив до трех дисков (добавится из запасных дисков в активный в массив) <br> <code>mdadm /dev/md127 --fail /dev/sdb</code> пометить рабочий диск как нерабочий (перевести диск в Failed Device) для замены на запасной из Spare Device, который начнет автоматическую синхронизацию для ввода в массив (Rebuild Status : 50% complete) <br> <code>mdadm /dev/md127 --remove /dev/sdb</code> удалить нерабочий диск из массива <br> <code>mdadm --stop /dev/md127</code> остановить/разобрать массив (предварительно umount /md0-sdb-sdc-raid1). В случае, если один из двух дисков был извлечен и не было запасных дисков, массив будет остановлен автоматически (State : inactive) <br> <code>mdadm --assemble --scan --verbose</code> команда просканирует все диски на наличие разобранного/развалившегося RAID-массива и самостоятельно (автоматически) попытается восстановить из них массив с изначальным именем (mdadm -D /dev/md0) <br> <code>mdadm --stop /dev/md127 && mdadm --assemble --scan && mount -a && mdadm -D /dev/md0</code> если в системе остался один диск (второй извлечен), RAID-массив будет востановлен (пересобран) автоматически из одного диска с статусом: clean, degraded, можно сразу добавить новый диск для автоматической синхронизации данных <br> <code>mdadm --assemble /dev/md127 /dev/sdb /dev/sdc</code> указать вручную из каких дисков пересобрать массив <br> <code>echo 'check' > /sys/block/md127/md/sync_action</code> проверять целостность данных в массиве (mdadm -D /dev/md0 - Check Status : 80% complete) <br> <code>cat /sys/block/md127/md/mismatch_cnt</code> вывод файла (0 - все впорядке) <br> <code>echo 'idle' > /sys/block/md127/md/sync_action</code> остановить проверку<h2 id=tgt><a aria-label="Anchor link for: tgt" class=zola-anchor href=#tgt><i class=icon></i></a> tgt</h2><blockquote><p>iSCSI</blockquote><p><code>apt install tgt</code> серверная часть называется порталом, который содержит цели (Target), каждая из которых предоставляет клиенту - инициатору (Initiator) доступ к блочным устройствам. <br> <code>dd if=/dev/zero of=/storage/disk1.img bs=1 count=0 seek=200G</code> создание динамического диска (разреженный файл) с максимальным размером 200 ГБ, где вместо последовательности нулей на диске хранят информацию об этих последовательностях в специальной таблице <br> <code>dd if=/dev/zero of=/storage/disk1.img bs=1M count=2048</code> создание фиксированного размера диск <br> <code>cp --sparse=always filename newfilename</code> преобразование обычного файла в разреженный <br> <code>nano /etc/tgt/targets.conf</code> <br> <code>nano /etc/tgt/conf.d/disk-1.conf</code><pre class=z-code><code><span class="z-text z-plain">&LTtarget iqn.2023-10.local.domain:ubuntu-target> 
</span><span class="z-text z-plain">   backing-store /storage/disk1.img 
</span><span class="z-text z-plain">   initiator-address 192.168.3.101
</span><span class="z-text z-plain">   incominguser user password1212
</span><span class="z-text z-plain">&LT/target>
</span></code></pre><p><code>systemctl restart tgt</code> <br> <code>tgtadm --mode target --op show</code> отобразит все подключенные цели и предоставляемые ими блочные устройства.<h2 id=dd><a aria-label="Anchor link for: dd" class=zola-anchor href=#dd><i class=icon></i></a> dd</h2><p><code>dd if=/dev/sr0 of=/tmp/cd.iso bs=2048</code> сохранить образ диска (if=источник) в файл (of=назначение) с указанием кол-ва байт для чтения и записи за один раз (2МБайт), по умолчанию используется размер блока - 512 байт (2b блока = 1024 байт, 1k = 1 КБайт/1024 байт, 1kB = 1000 байт, 1M = 1024 КБайт/1 МБайт) <br> <code>dd if=/dev/mem bs=2048 count=100</code> вывести содержимое оперативной памяти на экран (не использовать файл) <br> <code>dd if=/dev/zero of=/tmp/md-01 bs=4M count=256</code> создать файл заполненный нулями (из /dev/zero) размером 1ГБ с указанием кол-во копируемых блоков (bs*count) или очистить диск <br> <code>dd if=/dev/random of=/tmp/md-02 bs=4M count=256</code> создать файл размером 1ГБ заполненный рандомными цифрами <br> <code>dd if=/dev/sda of=/tmp/mbr.img bs=1b count=1</code> скопировать в файл первые 512 байт диска содержащие таблицу разделов MBR <br> <code>dd if=/dev/sda of=/tmp/sda.img</code> создать образ жесткого диска, используетася для полного backup системы (копирование раздела на двоичном уровне,включая таблицу MBR и всю пустую область диска и разделов)<h3 id=backup><a aria-label="Anchor link for: backup" class=zola-anchor href=#backup><i class=icon></i></a> backup</h3><ul><li>Смонтировать внешний носитель для создания образа: <code>mount /dev/sdb1 /mnt/disk_b</code><li><code>dd if=/dev/sda of=/mnt/disk_b/disk.img bs=5M</code> создать образа диска (.img) # создаем образ системы<li>Подключить новый диск для записи образа на диск (<code>sdc</code>)<li><code>dd if=/mnt/disk_b/disk.img of=/dev/sdc bs=5M</code> записать образ на диск (с sdb1 на sdc):<li>Извлечь физический ЖД или удалить виртуальный диск sda (системный) и <code>sdb</code> (с записью образа). Диск <code>sdc</code> с копией системы автоматически инициализируется как диск <code>sda</code> после перезагрузки системы.<li><code>gzip disk.img</code> сжать образ (все нули сожмутся полностью - удобно для хранения backup, поддерживает только .img) <code>dd if=/dev/sda conv=sync,noerror bs=5M | gzip -c  > /mnt/disk_b/disk.img.gz</code> создать сжатый образ системы <br> <code>gunzip -c /mnt/disk_b/disk.img.gz | dd of=/dev/sdс</code> развернуть образ на диск</ul><p><code>nc -lp 5000 | sudo dd of=/backup/sda.img.gz</code> сохранение сжатого файла образа жесткого диска sdb на удаленном сервере (принимающая сторона) <br> <code>dd if=/dev/sda | gzip -c | nc 192.168.21.121 5000</code> на узле, у которого установлен жесткий диск (передающая сторона) <br> <code>nc -lp 5000 | gunzip -c | sudo dd of=/dev/sdb</code> восстановление содержимого жесткого диска из сжатого образа (записывать не на системный диск), сохраненного на удаленном сервере на локальном узле (принимающая сторона) <br> <code>cat /backup/sda.img.gz | nc my_local_host.com 5000</code> на удаленном сервере, на котором сохранен файл образа жесткого диска (передающая сторона)<h3 id=iso><a aria-label="Anchor link for: iso" class=zola-anchor href=#iso><i class=icon></i></a> iso</h3><p><code>dd if=/dev/sda3 status=progress of=/mnt/disk_b/disk.iso bs=5M</code> создать iso-образ (сохранить образ раздел) <br> <code>dd if=путь/к/образу.iso of=/dev/sdb1</code> записать ISO-образ ОС на внешнее устройство <br> <code>sync</code> завершить запись этой командой (что бы при извлечении не потерять часть данных) <br> <code>mount -o loop /mnt/disk_b/disk.iso /mnt/iso</code> примонтировать файл образа только для чтения (iso - это директория, которую предварительно нужно создать), подключается как /dev/loop6 <br> <code>umount /mnt/iso</code> отмантировать<h3 id=rdiff><a aria-label="Anchor link for: rdiff" class=zola-anchor href=#rdiff><i class=icon></i></a> rdiff</h3><p><code>apt install rdiff-backup</code> на базе rsync с поддержкой инкрементных архивов используя технологию hard link, чтобы вернуться назад на заданный день <br> <code>rdiff-backup /usr/lifailon/ /backup/test/</code> <br> <code>rdiff-backup user@hostname::/remote-dir local-dir -v5 --print-statistics</code> по ssh с сервера на локальный бэкап-сервер, в ней же будет находиться директория rdiff-backup-data, которая будет содержать информацию и логи о проводимых бэкапах, а также инкременты, необходимые для отката на любой прошлый выполненный бэкап <br> <code>rdiff-backup list files --changed-since 5D local-dir</code> отобразить, какие файлы изменились за последние 5 дней <br> <code>rdiff-backup list files --at 5D local-dir</code> отобразить список файлов, которые присутствовали в архиве 5 дней назад <br> <code>rdiff-backup restore local-dir/rdiff-backup-data/increments.2023-10-29T21:03:37+03:00.dir /tmp/restore</code> восстановить файлы из инкримента<h2 id=users><a aria-label="Anchor link for: users" class=zola-anchor href=#users><i class=icon></i></a> users</h2><p><code>sudo -u www-data</code> выполнить команду от имени другого пользователя <br> <code>su root</code> войти под пользователем root <br> <code>sudo su</code> изменить пользователя на root, при этом пользователь остается в той же директории потому, что выполняется ваш .bashrc. А также .profile пользователя root поэтому вы окажетесь в окружении root <br> <code>sudo -i</code> указывает утилите что нужно переключиться в консоль от имени root, при этом перемещаясь в домашний каталог root, и будет выполнен его .bashrc и .profile <br> <code>sudo /bin/bash</code> запускает еще одну оболочку bash от имени суперпользователя. Файлы конфигурации не читаются, но выполняется только .bashrc вашего пользователя. Вы не окажетесь в окружении root, а просто останетесь в своем окружении с правами суперпользователя<p><code>cat /etc/passwd</code> список/база данных пользователей зарегистрированных в системе <br> <code>cat /etc/group</code> список групп <br> <code>cat /etc/shadow | grep -Ev "^.+:\*:"</code> пароли пользователей хранящиеся в зашифрованном виде (заданные с помощью /usr/bin/passwd), если * или ! пользователь не сможет войти в систему с использованием аутентификации по паролю, другие методы входа, как аутентификация на основе ключей или переключение на пользователя разрешены. Синтаксис: логин:пароль:последнее изменения пароля (количество дней исчисляется с 1 января 1970 года):минимальный срок действия пароля:максимальный срок действия:период предупреждения:период бездействия:срок хранения<p><code>cat /etc/login.defs | grep -Pv "^$|^#"</code> настройка поведения утилиты управления пользователями и параметрами входа в систему (настройки минимального и максимального id для выдачи новому пользователю/группе, количество попыток входа, таймау, что делать с директорий пользователя при создании или удалении и т.п.) <br> <code>cat /etc/login.defs | grep "^PASS"</code> максимальное кол-во дней действия пароля (PASS_MAX_DAYS), минимальное количество дней допустимое между сменами пароля (PASS_MIN_DAYS), количество дней предупреждающих об истечении срока действия пароля (PASS_WARN_AGE), ограничения длины паролей (PASS_MIN_LEN/PASS_MAX_LEN), максимальное кол-во попыток входа при вводе неправильного пароля (LOGIN_RETRIES), время на вход (LOGIN_TIMEOUT), включить логирование успешных входов (LOG_OK_LOGINS), логирование неизветных имен для системы пользователей при неудачных попытках входа (LOG_UNKFAIL_ENAB)<h3 id=passwd><a aria-label="Anchor link for: passwd" class=zola-anchor href=#passwd><i class=icon></i></a> passwd</h3><p><code>passwd</code> включить учетную запись root и задать ей пароль <br> <code>passwd username</code> смена пароля пользователя <br> <code>passwd -l username</code> заблокировать уч. запись <br> <code>passwd -u username</code> разблокировать уч. запись<h3 id=chage><a aria-label="Anchor link for: chage" class=zola-anchor href=#chage><i class=icon></i></a> chage</h3><p><code>chage -l root</code> информация последней смене пароля и срок действия (последняя смена пароля, Срок действия пароля, Пароль неактивен, Срок действия учетной записи, Минимальное количество дней между сменой пароля, Максимальное количество дней между сменой пароля, Количество дней предупреждения до истечения срока действия пароля) <br> <code>chage -E lifailon</code> установить дату истечения срока действия пользовательской учетной записи (-E) <br> <code>chage lifailon -M 30</code> установки минимального (-m) и максимального (-M) срока действия пароля<h3 id=id><a aria-label="Anchor link for: id" class=zola-anchor href=#id><i class=icon></i></a> id</h3><p><code>id lifailon</code> узнать ID <br> <code>uid=1000(lifailon) gid=1000(lifailon) groups=1000(lifailon),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),116(lxd)</code> <br> <code>usermod -u 1022 kup</code> изменить UID <br> <code>groupmod -g 1022 kup</code> изменить GID<h3 id=usermod><a aria-label="Anchor link for: usermod" class=zola-anchor href=#usermod><i class=icon></i></a> usermod</h3><p><code>usermod -L lifailon</code> заблокировать вход по паролю (перед паролем пользователя в файле /etc/shadow добавляется восклицательный знак) <br> <code>usermod --expiredate 1 -L lifailon</code> заблокировать пользователя (не будет возможности авторизоваться через su: Authentication failure) <br> <code>usermod --expiredate 2023-10-25 lifailon</code> задать дату блокировки <br> <code>usermod --expiredate "" -U lifailon</code> разблокировать пользователя <br> <code>usermod -g root lifailon</code> изменить основную группу пользователя <br> <code>usermod -a -G plugdev lifailon</code> добавить пользователя в дополнительную группу (-G), обязательно нужно использовать вместе с -a, чтобы не удалять старые <br> <code>usermod -d /root lifailon</code> изменить домашнюю директорию пользователя (-d) <br> <code>usermod -m -d /root lifailon</code> переместить домашнюю папку сохранив все содержимое (-m) <br> <code>usermod -s /usr/bin/dash lifailon</code> изменить оболочку по умолчанию (-s) <br> <code>usermod -u 2002 lifailon</code> изменить id пользователя (-u) <br> <code>usermod -l lifailon failon</code> изменить имя пользователя (-l) <br> <code>usermod --password "NewPassword" lifailon</code> изменить пароль<h3 id=profile><a aria-label="Anchor link for: profile" class=zola-anchor href=#profile><i class=icon></i></a> profile</h3><p><code>nano /etc/bash.bashrc</code> задать timeout для завершения бездейстующих (idle time) SSH и локальных сессий <br> <code>nano /etc/profile</code> задать на уровне профиля (приоритет ниже)<pre class=z-code><code><span class="z-text z-plain">TMOUT=1440
</span><span class="z-text z-plain">readonly TMOUT
</span><span class="z-text z-plain">export TMOUT
</span></code></pre><h3 id=bashrc-1><a aria-label="Anchor link for: bashrc-1" class=zola-anchor href=#bashrc-1><i class=icon></i></a> bashrc</h3><p><code>.bashrc</code> файл переменных конкретного пользователя <br> <code>.bash_profile</code> переменные вступают в силу каждый раз когда пользователь подключается удаленно по SSH. Если этот файл отсутствует система будет искать .bash_login или .profile <br> <code>/etc/environment</code> файл для создания, редактирования и удаления каких-либо переменных окружения на системном уровне. Переменные окружения, созданные в этом файле доступны для всей системы, для каждого пользователя и даже при удаленном подключении. <br> <code>/etc/bash.bashrc</code> файл выполняется для каждого пользователя, каждый раз когда он создает новую терминальную сессию. Это работает только для локальных пользователей, при подключении через интернет, такие переменные не будут доступны. <br> <code>/etc/profile</code> системный файл profile, все переменные из этого файла, доступны любому пользователю в системе, только если он вошел удаленно. Но они не будут доступны, при создании локальной терминальной сессии, то есть если вы просто откроете терминал.<h3 id=useradd><a aria-label="Anchor link for: useradd" class=zola-anchor href=#useradd><i class=icon></i></a> useradd</h3><p><code>useradd -D</code> отобразить параметры, которые будут применены для пользователя по умолчанию <br> <code>useradd -o -u 0 -g 0 -s /bin/bash newroot</code> создать нового пользователя с правами root <br> <code>useradd -G adm,wheel -p password -s /bin/bash test2</code> разрешить пользователю читать логи и пользоваться sudo<p><code>useradd username</code> <br> <code>-s</code> указать командную оболочку для пользователя (по умолчанию /bin/sh - без оболочки, можно указать /bin/bash) <br> <code>-b</code> указать базовый каталог для размещения домашнего каталога пользователя (по умолчанию /home) <br> <code>-d</code> домашний каталог, в котором будут размещаться файлы пользователя <br> <code>-m</code> создавать домашний каталог пользователя, если он не существует <br> <code>-c</code> комментарий к учетной записи <br> <code>-g</code> основная группа пользователя <br> <code>-G</code> список дополнительных групп <br> <code>-N</code> не создавать группу с именем пользователя <br> <code>-p</code> задать пароль пользователя <br> <code>-l</code> не сохранять информацию о входах пользователя в lastlog и faillog <br> <code>-o</code> разрешить создание пользователя linux с неуникальным идентификатором UID <br> <code>-u</code> идентификатор для пользователя<h3 id=adduser><a aria-label="Anchor link for: adduser" class=zola-anchor href=#adduser><i class=icon></i></a> adduser</h3><p><code>adduser username</code> интерактивное создание пользователя, по умолчанию будет создан домашний каталог (/home/username), можно указать данные о пользователе или пропустить и задать пароль <br> <code>deluser username</code> удалить пользователя (каталог не удаляется)<h2 id=chmod><a aria-label="Anchor link for: chmod" class=zola-anchor href=#chmod><i class=icon></i></a> chmod</h2><pre class=z-code><code><span class="z-text z-plain">    -                    ---                          ---         ---
</span><span class="z-text z-plain">    |                     |                            |           |
</span><span class="z-text z-plain">тип файла   права доступа пользователя (владельца)   группы   всех остальных
</span></code></pre><p><code>---</code> нет прав <br> <code>--x</code> разрешено только выполнение файла, как программы но не изменение и не чтение <br> <code>-w-</code> разрешена только запись и изменение файла <br> <code>-wx</code> разрешено изменение и выполнение, в случае с каталогом нельзя посмотреть его содержимое <br> <code>r--</code> права только на чтение <br> <code>r-x</code> только чтение и выполнение, без права на запись <br> <code>rw-</code> права на чтение и запись, но без выполнения <br> <code>rwx</code> все права <br> <code>--s</code> установлен SUID или SGID бит, первый отображается в поле для владельца, второй для группы <br> <code>--t</code> установлен sticky-bit, значит пользователи не могут удалить этот файл<p><code>r</code> чтение <br> <code>w</code> запись <br> <code>x</code> выполнение <br> <code>s</code> выполнение от имени суперпользователя (дополнительный)<p><code>u</code> пользователь-владелец файла <br> <code>g</code> группа-владельц файла <br> <code>o</code> все остальные пользователи<p><code>+</code> включить <br> <code>-</code> отключить<p><code>-R</code> поменять права на все подкаталоги и файлы указанной директории <br> <code>-v</code> выводить информацию обо всех изменениях<p><code>chmod u+x filename</code> разрешить выполнение (x) для владельца (u) <br> <code>chmod ugo+x filename</code> разрешить выполнение (x) для всех (ugo) <br> <code>chmod ug+r filename</code> разрешить чтение (r) для владельца (u) и группы (g) <br> <code>chmod o-w filename</code> запретить запись (w) для остальных пользователей (o) <br> <code>chmod -R g+rwx dir </code> дать полный доступ (rwx) группе (g) на директорию и всем файлам в ней (-R)<p>Права доступа в восьмеричной системе, которые полностью переписывают текущие права новыми для всех категорий пользователей:<p><code>0</code> никаких прав <br> <code>1</code> только выполнение <br> <code>2</code> только запись <br> <code>3</code> выполнение и запись <br> <code>4</code> только чтение <br> <code>5</code> чтение и выполнение <br> <code>6</code> чтение и запись <br> <code>7</code> чтение, запись и выполнение<p><code>chmod 744 filename</code> разрешить полные права для владельца, а остальным только чтение <br> <code>chmod 664 filename</code> чтение и запись для владельца и группы, только чтение для остальных<h3 id=chown><a aria-label="Anchor link for: chown" class=zola-anchor href=#chown><i class=icon></i></a> chown</h3><p><code>chown lifailon tmp</code> изменить владельца на пользователя lifailon для директории tmp <br> <code>chown lifailon:lifailon tmp</code> изменить владельца и группу <br> <code>chown -R lifailon:lifailon tmp</code> применить изменения ко всем подкаталогам (-R) <br> <code>chown --from=root:root lifailon:lifailon -R ./</code> изменить владельца и группу только для тех каталогов и файлов, у которых владелец и группа root в текущем каталоге<h3 id=groups><a aria-label="Anchor link for: groups" class=zola-anchor href=#groups><i class=icon></i></a> groups</h3><p><code>groups lifailon</code> отобразить в каких группах находится указанный пользователь <br> <code>touch testdir</code> при создании файла ему назначается основная группа пользователя который его создал (ls -l testdir) <br> <code>cat /etc/group</code> список групп <br> <code>chgrp testdir tmp</code> изменить группу на testdir для директории tmp <br> <code>groupadd testdir</code> создать группу <br> <code>delgroup testdir</code> удалить группу, если ошибка ‘testdir’ still has <code>testdir' as their primary group!</code> предварительно исключить из группы всех пользователей<p>Опции: <br> <code>-g</code> изменить основную группу для пользователя <br> <code>-G</code> дополнительные группы, в которые нужно добавить пользователя (затирает предыдущие) <br> <code>-a</code> добавить пользователя в дополнительные группы c параметром -G, а не заменять им текущее значение <br> <code>-R</code> удалить пользователя из группы<h3 id=usermod-1><a aria-label="Anchor link for: usermod-1" class=zola-anchor href=#usermod-1><i class=icon></i></a> usermod</h3><p><code>usermod -aG sudo lifailon</code> добавить пользователя в дополнительную группу (-aG, без затирания предыдущих групп) sudo (добавить в группу root) <br> <code>usermod -aG disk lifailon</code> пользователь будет иметь прямой доступ к ЖД без команды sudo (например монтировать) <br> <code>usermod -g root lifailon</code> изменить основную группу (-g) для пользователя на root <br> <code>usermod -R ssh lifailon</code> удалить пользователя из группы<h2 id=domain><a aria-label="Anchor link for: domain" class=zola-anchor href=#domain><i class=icon></i></a> domain</h2><h3 id=realmd><a aria-label="Anchor link for: realmd" class=zola-anchor href=#realmd><i class=icon></i></a> realmd</h3><p><code>hostnamectl</code> <br> <code>hostnamectl set-hostname srv-01.domain.local</code> изменить имя сервера (/etc/hostname)<p><code>nano /etc/resolv.conf</code> <br> <code>nameserver 192.168.3.233</code> адрес DC <br> <code>search domain.local</code><p><code>apt -y install realmd libnss-sss libpam-sss sssd sssd-tools adcli samba-common-bin oddjob oddjob-mkhomedir packagekit</code> <br> <code>nano /etc/realmd.conf</code> задать атрибуты хоста, которые будут сохранены в учетной записи компьютера в AD (атрибуты operatingSystem и operatingSystemVersion)<pre class=z-code><code><span class="z-text z-plain">[active-directory]
</span><span class="z-text z-plain">os-name = Ubuntu Server
</span><span class="z-text z-plain">os-version = 20.04
</span></code></pre><p><code>realm discover domain.local --verbose</code> возвращает полную конфигурацию домена и список пакетов, которые должны быть установлены для регистрации системы в домене <br> <code>realm join --help | grep pass</code> <br> <code>realm join -U username domain.local</code> –one-time-password<code>ввести в домен \</code>realm list<code>проверить после подключения (server-software: active-directory) \</code>id username@domain.local` получить сведения о пользователе домена<h3 id=sssd><a aria-label="Anchor link for: sssd" class=zola-anchor href=#sssd><i class=icon></i></a> sssd</h3><p>Права доступа на логирование в Linux из под УЗ домена (sssd используется для аутентификации Kerberos)<p><code>realm permit -g 'ssh-connect-domain'</code> добавит доменную группу (echo “simple_allow_groups = ssh-connect-domain” >> /etc/sssd/sssd.conf) <br> <code>realm permit username@domain.local</code> добавит пользователя (echo “simple_allow_users = username” >> /etc/sssd/sssd.conf) <br> <code>realm deny --all</code> запретить доступ всем пользователям (очищает список simple_allow_* в sssd.conf) <br> <code>systemctl restart sssd</code><p>Создавать домашний каталог для нового доменного пользователя:<pre class=z-code><code><span class="z-text z-plain">bash -c "cat > /usr/share/pam-configs/mkhomedir" <&LTEOF
</span><span class="z-text z-plain">Name: activate mkhomedir
</span><span class="z-text z-plain">Default: yes
</span><span class="z-text z-plain">Priority: 900
</span><span class="z-text z-plain">Session-Type: Additional
</span><span class="z-text z-plain">Session:
</span><span class="z-text z-plain">required pam_mkhomedir.so umask=0022 skel=/etc/skel
</span><span class="z-text z-plain">EOF
</span></code></pre><p><code>pam-auth-update</code> обновить конфигурацию, выбрать созданную: activate mkhomedir<p>Права на sudo:<p><code>nano /etc/sudoers.d/domain_admins</code> nano /etc/sudoers.d/linux-admins<pre class=z-code><code><span class="z-text z-plain">username@domain.local               ALL=(ALL)       ALL
</span><span class="z-text z-plain">%ssh-connect-domain@domain.local    ALL=(ALL)       ALL
</span></code></pre><p><code>ssh username@domain.local@hostname</code><h2 id=syslog><a aria-label="Anchor link for: syslog" class=zola-anchor href=#syslog><i class=icon></i></a> syslog</h2><h3 id=server><a aria-label="Anchor link for: server" class=zola-anchor href=#server><i class=icon></i></a> server</h3><p><code>systemctl status rsyslog</code><p><code>nano /etc/rsyslog.conf</code><pre class=z-code><code><span class="z-text z-plain"># provides UDP syslog reception (input module udp)
</span><span class="z-text z-plain">module(load="imudp")
</span><span class="z-text z-plain">input(type="imudp" port="514")
</span><span class="z-text z-plain"># provides TCP syslog reception
</span><span class="z-text z-plain">#module(load="imtcp")
</span><span class="z-text z-plain">#input(type="imtcp" port="514")
</span><span class="z-text z-plain"># Filter duplicated messages
</span><span class="z-text z-plain"># Включить фильтрацию одинаковых сообщений
</span><span class="z-text z-plain">$RepeatedMsgReduction off
</span><span class="z-text z-plain"># Шаблон создания директории на основе IP адреса клиента и сбор всех логов в один файл:
</span><span class="z-text z-plain">$template RemoteLogs,"/var/log/remote/%fromhost-ip%/syslog.log"
</span><span class="z-text z-plain"># Сохранять сообщения от любого источника (*) с любым приоритетом (*) в файл, заданный шаблоном (RemoteLogs):
</span><span class="z-text z-plain">*.* ?RemoteLogs
</span><span class="z-text z-plain"># Шаблон создания директории на основе имени клиента и лог-файлов по имени программы:
</span><span class="z-text z-plain"># $template RemoteLogs,"/var/log/remote/%HOSTNAME%/%PROGRAMNAME%.log"
</span><span class="z-text z-plain"># *.* ?RemoteLogs
</span><span class="z-text z-plain"># Include all config files in /etc/rsyslog.d/
</span><span class="z-text z-plain">$IncludeConfig /etc/rsyslog.d/*.conf
</span></code></pre><p><code>systemctl restart rsyslog</code><h3 id=client><a aria-label="Anchor link for: client" class=zola-anchor href=#client><i class=icon></i></a> client</h3><p><code>nano /etc/rsyslog.d/all.conf</code><pre class="language-conf z-code" data-lang=conf><code class=language-conf data-lang=conf><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># UDP:
</span></span></span><span class="z-source z-genconfig"><span class="z-keyword z-operator z-genconfig">*</span><span class="z-keyword z-operator z-genconfig">.</span><span class="z-keyword z-operator z-genconfig">*</span> <span class="z-storage z-source z-genconfig">@192</span><span class="z-keyword z-operator z-genconfig">.</span><span class="z-constant z-numeric z-genconfig">168</span><span class="z-keyword z-operator z-genconfig">.</span><span class="z-constant z-numeric z-genconfig">3</span><span class="z-keyword z-operator z-genconfig">.</span><span class="z-constant z-numeric z-genconfig">105</span><span class="z-keyword z-operator z-genconfig">:</span><span class="z-constant z-numeric z-genconfig">514</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># TCP:
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># *.* @@192.168.3.105:514
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># auth.* @@192.168.3.105:514
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># *.err @@192.168.3.105:514
</span></span></span></code></pre><p><code>systemctl restart rsyslog</code> <br> <code>ls /var/log/remote</code> на сервере должна появиться директория с ip-адресом/именем клиента <br> <code>ls -lh /var/log/remote/*</code> <br> <code>cat /var/log/remote/192.168.3.104/syslog.log | grep influxd</code> <br> <code>systemctl restart zabbix-agent</code> <br> <code>cat /var/log/remote/192.168.3.104/syslog.log | grep zabbix_agentd</code><h3 id=zabbix-agent><a aria-label="Anchor link for: zabbix-agent" class=zola-anchor href=#zabbix-agent><i class=icon></i></a> zabbix-agent</h3><p><code>nano /etc/zabbix/zabbix_agentd.conf</code><pre class="language-conf z-code" data-lang=conf><code class=language-conf data-lang=conf><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># LogType=file
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">LogType</span><span class="z-keyword z-operator z-genconfig">=</span></span>system
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">DebugLevel</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-numeric z-genconfig">1</span>
</span></code></pre><p><code>systemctl restart zabbix-agent</code><h3 id=ommail><a aria-label="Anchor link for: ommail" class=zola-anchor href=#ommail><i class=icon></i></a> ommail</h3><p><code>nano /etc/rsyslog.conf</code><pre class="language-conf z-code" data-lang=conf><code class=language-conf data-lang=conf><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># Включить модуль:
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-function z-genconfig"><span class="z-entity z-name z-function z-genconfig">module</span>(</span>load<span class="z-keyword z-operator z-genconfig">=</span><span class="z-string z-quoted z-double z-genconfig">"ommail"</span>)
</span><span class="z-source z-genconfig"><span class="z-storage z-source z-genconfig">$ActionMailSMTPServer</span> m<span class="z-keyword z-operator z-genconfig">.</span>domain<span class="z-keyword z-operator z-genconfig">.</span>ru
</span><span class="z-source z-genconfig"><span class="z-storage z-source z-genconfig">$ActionMailSMTPPort</span> <span class="z-constant z-numeric z-genconfig">25</span>
</span><span class="z-source z-genconfig"><span class="z-storage z-source z-genconfig">$ActionMailFrom</span> zabbix<span class="z-storage z-source z-genconfig">@domain</span><span class="z-keyword z-operator z-genconfig">.</span>ru
</span><span class="z-source z-genconfig"><span class="z-storage z-source z-genconfig">$ActionMailTo</span> lifailon<span class="z-storage z-source z-genconfig">@domain</span><span class="z-keyword z-operator z-genconfig">.</span>ru
</span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># Шаблон, который будет подставляться как тема (Subject) и тело письма (Body) - имя переменной шаблона,"содержимое шаблона"
</span></span></span><span class="z-source z-genconfig"><span class="z-storage z-source z-genconfig">$template</span> mailSubject<span class="z-keyword z-operator z-genconfig">,</span><span class="z-string z-quoted z-double z-genconfig">"rsyslog: disk problem on %hostname%"</span>
</span><span class="z-source z-genconfig"><span class="z-storage z-source z-genconfig">$template</span> mailBody<span class="z-keyword z-operator z-genconfig">,</span><span class="z-string z-quoted z-double z-genconfig">"RSYSLOG Alert\r\nmsg='%msg%'"</span>
</span><span class="z-source z-genconfig"><span class="z-storage z-source z-genconfig">$ActionMailSubject</span> mailSubject
</span><span class="z-source z-genconfig"><span class="z-storage z-source z-genconfig">$ActionMailBody</span> mailBody
</span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># Ограничение на отправку - одно письмо в 5 минут
</span></span></span><span class="z-source z-genconfig"><span class="z-storage z-source z-genconfig">$ActionExecOnlyOnceEveryInterval</span> <span class="z-constant z-numeric z-genconfig">300</span>
</span></code></pre><h2 id=logrotate><a aria-label="Anchor link for: logrotate" class=zola-anchor href=#logrotate><i class=icon></i></a> logrotate</h2><p><code>systemctl status logrotate.timer</code><p><code>nano /etc/logrotate.conf</code><pre class="language-conf z-code" data-lang=conf><code class=language-conf data-lang=conf><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># Ротация файлов журнала еженедельно
</span></span></span><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">weekly
</span></span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># По умолчанию используется группа adm, которая является владельцем группы ls -ld /var/log/syslog
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">su</span> </span>root adm
</span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># Количество файлов (недель, если ротация еженедельно) хранения журналов
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">rotate</span> </span><span class="z-constant z-numeric z-genconfig">4</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># Создавать новые (пустые) файлы журналов после ротации старых
</span></span></span><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">create
</span></span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># Использовать дату в качестве суффикса ротируемого файла
</span></span></span><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">dateext
</span></span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># Сжимать лог-файлы
</span></span></span><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">compress
</span></span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># Пакеты сбрасывают информацию о ротации журнала в этот каталог
</span></span></span><span class="z-source z-genconfig"><span class="z-keyword z-other z-genconfig">include</span> <span class="z-keyword z-operator z-genconfig">/</span>etc<span class="z-keyword z-operator z-genconfig">/</span>logrotate<span class="z-keyword z-operator z-genconfig">.</span>d
</span></code></pre><p><code>nano /etc/logrotate.d/logrotate_remote.conf</code><pre class="language-conf z-code" data-lang=conf><code class=language-conf data-lang=conf><span class="z-source z-genconfig"><span class="z-keyword z-operator z-genconfig">/</span>var<span class="z-keyword z-operator z-genconfig">/</span>log<span class="z-keyword z-operator z-genconfig">/</span>remote<span class="z-keyword z-operator z-genconfig">/</span><span class="z-keyword z-operator z-genconfig">*</span><span class="z-keyword z-operator z-genconfig">/</span><span class="z-keyword z-operator z-genconfig">*</span><span class="z-keyword z-operator z-genconfig">.</span>log {
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">su</span> </span>root root
</span><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">daily
</span></span><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">copytruncate
</span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">size</span> </span><span class="z-constant z-numeric z-genconfig">10M</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">rotate</span> </span><span class="z-constant z-numeric z-genconfig">2</span>
</span><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">compress
</span></span><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">dateext
</span></span><span class="z-source z-genconfig">}
</span></code></pre><p>Условия:<p><code>hourly</code> каждый час <br> <code>daily</code> каждый день <br> <code>weekly</code> каждую неделю <br> <code>monthly</code> каждый месяц <br> <code>yearly</code> каждый год <br> <code>size</code> минимальный размер лога, меньше этого значения ротация выполняться не будет<p>Действия:<p><code>rotate 2</code> указать, сколько последних ротированных лог-файлов нужно хранить, остальные удалять <br> <code>maxage 30</code> указать, за сколько последних дней хранить ротированные файлы, остальные удалять <br> <code>copytruncate</code> сначала создается копия файла лога, после уже обрезается действующий (нужно, когда программа должна писать лог непрерывно, возможность потери записей, если она придется на процесс усечения) <br> <code>extension</code> сохранять оригинальный лог файл после ротации <br> <code>compress</code> сжимать ротированный лог (gzip) <br> <code>delaycompress</code> не сжимать последний и предпоследний журнал (позволяет избежать ошибок, связанных с отсутствием доступа к используемому файлу) <br> <code>create # 0644 root root</code> создать пустой лог файл на месте старого <br> <code>olddir /path</code> перемещать логи в отдельную папку при срабатывании условия <br> <code>dateext</code> добавляет дату ротации перед заголовком старого лога <br> <code>missingok</code> не выдавать ошибки, если лог файла не существует <br> <code>notifempty</code> если файл пустой, не выполнять никаких действий <br> <code>prerotate script.sh endscript</code> скрипт, который необходимо выполнить перед чисткой лога <br> <code>postrotate script.sh endscript</code> скрипт, который необходимо выполнить после чистки лога <br> <code>sharedscripts</code> если был указан путь в формате wildcard (*), выполнить скрипт один раз после завершения ротации всех файлов<p><code>logrotate -d /etc/logrotate.d/logrotate_remote.conf</code> проверить ротацию (–debug) <br> <code>logrotate -fv /etc/logrotate.d/logrotate_remote.conf</code> запустить ротацию сейчас (–force) с подробным выводом (–verbose) <br> <code>cat /etc/cron.daily/logrotate</code> задание на автоматический запуск создается по умолчанию, который читает конфигурационный файл ротации /etc/logrotate.conf, в нем указана директрия: include /etc/logrotate.d в которой лежат файлы ротации <br> <code>which logrotate</code> узнать путь до исполняемого файла <br> <code>crontab -e</code> <br> <code>00 3 * * * /usr/sbin/logrotate -f /etc/logrotate.d/logrotate_remote.conf</code> настроить собственное ручное расписание с ежедневным запусков в 3:00<h2 id=log><a aria-label="Anchor link for: log" class=zola-anchor href=#log><i class=icon></i></a> log</h2><ul><li><a href=https://github.com/Lifailon/lazyjournal>lazyjournal</a> - терминальный пользовательский интерфейс для journalctl, журналов файловой системы, а также контейнеров Docker, Podman и Kubernetes для быстрого просмотра и фильтрации с поддержкой нечеткого поиска, регулярных выражений и раскрашивания вывода:</ul><p><code>curl https://raw.githubusercontent.com/Lifailon/lazyjournal/main/install.sh | bash</code> <br> <code>lazyjournal</code><ul><li><a href=https://github.com/tstack/lnav>lnav</a> - терминальный пользовательский интерфейс для логов файловой системы с таймстампами, возможностью поиска и подсветкой:</ul><p><code>apt install lnav</code> <br> <code>journalctl -f -a -xe -o json | lnav</code> <br> <code>ssh playground@demo.lnav.org</code><ul><li><a href=https://github.com/bensadeh/tailspin>tailspin</a> - раскрашивание любого вывода:</ul><p><code>apt install tailspin</code> <br> <code>cat /var/log/syslog | tailspin</code><ul><li><a href=https://github.com/Textualize/toolong>toolong</a> - терминальный пользовательский интерфейс для интерактивного просмотра логов с поддержкой поиска и объединения журналов (заменяет tail, less и grep):</ul><p><code>pipx install toolong</code> <br> <code>tl /var/log/syslog*</code> откроет все журналы syslog (включая поддержку чтения архивных журналов) <br> <code>tl /var/log/syslog /var/log/syslog.1 --merge</code> объеденит два журнала в один <br> <code>cat /var/log/syslog /var/log/syslog.1 | tailspin | tl</code> вначале красим вывод и потом передаем на вход toolong \<ul><li><a href=https://github.com/tsl0922/ttyd>ttyd</a> - позволяет запускать терминальные интерфейсы в Web интерфейсе с поддержкой базовой авторизации:</ul><p><code>sudo apt install ttyd</code> <br> <code>ttyd -W -p 4444 tl /var/log/syslog*</code> <br> <code>ttyd -W -p 4444 -c admin:admin tl /var/log/syslog*</code><h2 id=smb><a aria-label="Anchor link for: smb" class=zola-anchor href=#smb><i class=icon></i></a> smb</h2><h3 id=cifs><a aria-label="Anchor link for: cifs" class=zola-anchor href=#cifs><i class=icon></i></a> cifs</h3><p><code>apt install cifs-utils</code> установить SMB Client<p><code>nano /root/.smbclient</code><pre class=z-code><code><span class="z-text z-plain">username=lifailon
</span><span class="z-text z-plain">password=password
</span><span class="z-text z-plain">#domain=domain.local
</span></code></pre><p><code>mkdir /smb && mkdir /smb/backup</code> создать директорию для монтирования <br> <code>nano /etc/fstab</code> <br> <code>//192.168.3.100/Backup /smb/backup cifs user,rw,credentials=/root/.smbclient 0 0</code> rw права на чтение и запись <br> <code>mount -a</code> примонтировать (открыть порты на сервере: 137/UDP; 138/UDP; 139/TCP; 445/TCP) <br> <code>df -h</code><p><code>//192.168.3.100/torrent-files /home/lifailon/torrent-files cifs user,rw,credentials=/root/.smbclient,perms=0666 0 0</code> <br> <code>chmod 666 /home/lifailon/torrent-files</code> <br> <code>chown -R lifailon:lifailon /home/lifailon/torrent-files</code> <br> <code>smbclient $path_smb_qb --user=smb --password=kinozal</code><h3 id=samba><a aria-label="Anchor link for: samba" class=zola-anchor href=#samba><i class=icon></i></a> samba</h3><p><code>iptables -I INPUT -p tcp --dport 445 -j ACCEPT</code> используется для Samba <br> <code>iptables -I INPUT -p tcp --dport 137 -j ACCEPT</code> используется для работы NetBIOS (использование имени компьютера для доступа) <br> <code>iptables -I INPUT -p tcp --dport 139 -j ACCEPT</code> <br> <code>iptables -I INPUT -p udp --dport 137:138 -j ACCEPT</code> <br> <code>iptables -L</code> отобразить список правил <br> <code>iptables -F</code> очистить список правил <br> <code>apt install iptables-persistent</code> <br> <code>netfilter-persistent save</code> применить настройки<p><code>apt install samba</code> <br> <code>systemctl status smbd</code> <br> <code>mkdir -p /public/share</code> создать общую папку <br> <code>chmod 777 /public/share</code> выдать права<p><code>nano /etc/samba/smb.conf</code><pre class="language-conf z-code" data-lang=conf><code class=language-conf data-lang=conf><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">[global]
</span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">workgroup</span> <span class="z-keyword z-operator z-genconfig">=</span></span> <span class="z-support z-constant z-genconfig">WORKGROUP</span><span class="z-meta z-comment z-genconfig"> <span class="z-comment z-line z-number-sign z-genconfig"># рабочая группа (должна одинакова на всех машинах)
</span></span></span><span class="z-source z-genconfig">
</span><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">[share1]
</span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">    <span class="z-variable z-parameter z-genconfig">comment</span> <span class="z-keyword z-operator z-genconfig">=</span></span> Public folder for all
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">    <span class="z-variable z-parameter z-genconfig">path</span> <span class="z-keyword z-operator z-genconfig">=</span></span> <span class="z-keyword z-operator z-genconfig">/</span>public<span class="z-keyword z-operator z-genconfig">/</span>share
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">    <span class="z-variable z-parameter z-genconfig">public</span> <span class="z-keyword z-operator z-genconfig">=</span></span> <span class="z-constant z-language z-genconfig">yes</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">    <span class="z-variable z-parameter z-genconfig">writable</span> <span class="z-keyword z-operator z-genconfig">=</span></span> <span class="z-constant z-language z-genconfig">yes</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">    <span class="z-variable z-parameter z-genconfig">read</span> </span>only <span class="z-keyword z-operator z-genconfig">=</span> <span class="z-constant z-language z-genconfig">no</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">    <span class="z-variable z-parameter z-genconfig">guest</span> </span>ok <span class="z-keyword z-operator z-genconfig">=</span> <span class="z-constant z-language z-genconfig">yes</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">    <span class="z-variable z-parameter z-genconfig">create</span> </span>mask <span class="z-keyword z-operator z-genconfig">=</span> <span class="z-constant z-numeric z-genconfig">0777</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">    <span class="z-variable z-parameter z-genconfig">directory</span> </span>mask <span class="z-keyword z-operator z-genconfig">=</span> <span class="z-constant z-numeric z-genconfig">0777</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">    <span class="z-variable z-parameter z-genconfig">force</span> </span>create mode <span class="z-keyword z-operator z-genconfig">=</span> <span class="z-constant z-numeric z-genconfig">0777</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">    <span class="z-variable z-parameter z-genconfig">force</span> </span>directory mode <span class="z-keyword z-operator z-genconfig">=</span> <span class="z-constant z-numeric z-genconfig">0777</span>
</span></code></pre><p><code>[Общая папка]</code> имя общей папки, которое увидят пользователи при подключение <code>path</code> путь на сервере, где будут храниться данные <code>public</code> для общего доступа, чтобы все могли работать с ресурсом <code>writable</code> разрешает запись в сетевую папку <code>read only = yes</code> только для чтения. no - для полного доступа управлением ФС <code>guest ok</code> разрешает доступ к папке гостевой учетной записи <code>create mask, directory mask, force create mode, force directory mode</code> при создании новой папки или файла назначаются указанные права. В примере указаны полные права.<p><code>systemctl restart smbd</code> применить настройки<p><code>useradd smb1</code> создать пользователя <br> <code>passwd smb1</code> задать пароль пользователю <br> <code>smbpasswd -a smb1</code> создать пользователя для Samba<pre class=z-code><code><span class="z-text z-plain">public = no
</span><span class="z-text z-plain">writable = no
</span><span class="z-text z-plain">read only = yes
</span><span class="z-text z-plain">guest ok = yes # разрешить анонимный доступ на чтение (read only) без пароля
</span><span class="z-text z-plain">; valid users = smb1 @smb-users # список пользователей, которым разрешено подключаться к каталогу для чтения, а также входщях в группу smb-users
</span><span class="z-text z-plain">write list = smb1 # список пользователей, которые имеют полный доступ к директории
</span><span class="z-text z-plain">hosts allow = comp1, 192.168.160.0/255.255.252.0 # указать список разрешенных хостов или сетей, с которых можно подключаться к серверу. Если его прописать в секцию с настройкой шары, то он будет действовать только для нее, если прописать в [global], то для всех общих папок
</span><span class="z-text z-plain">hosts deny = comp2, 192.168.164.0/255.255.252.0 # запретить доступ
</span></code></pre><h3 id=client-cifs><a aria-label="Anchor link for: client-cifs" class=zola-anchor href=#client-cifs><i class=icon></i></a> client cifs</h3><p><code>apt install cifs-utils</code> <br> <code>mkdir /mnt/share1</code> <br> <code>mount -t cifs "//192.168.3.103/share1" /mnt/share1 -o user=smb1</code> примонтировать удаленный каталог на клиенте Linux с авторизацией <br> <code>df -handle</code> <br> <code>//192.168.3.103/share1  24G  23G  1.2G  96%  /mnt/share1</code><h3 id=client-samba-client><a aria-label="Anchor link for: client-samba-client" class=zola-anchor href=#client-samba-client><i class=icon></i></a> client samba-client</h3><p><code>apt install samba-client</code> <br> <code>smbclient -L 192.168.3.103 -U share1</code><h3 id=recycle><a aria-label="Anchor link for: recycle" class=zola-anchor href=#recycle><i class=icon></i></a> recycle</h3><pre class=z-code><code><span class="z-text z-plain">[share1]
</span><span class="z-text z-plain">    path = /public/share
</span><span class="z-text z-plain">    public = yes
</span><span class="z-text z-plain">    browseable = yes
</span><span class="z-text z-plain">    writable = yes
</span><span class="z-text z-plain">    read only = no
</span><span class="z-text z-plain">    guest ok = yes
</span><span class="z-text z-plain">    vfs objects = recycle
</span><span class="z-text z-plain">    recycle:repository = .recycle/%U
</span><span class="z-text z-plain">    recycle:keeptree = Yes
</span><span class="z-text z-plain">    recycle:touch = Yes
</span><span class="z-text z-plain">    recycle:versions = Yes
</span><span class="z-text z-plain">    recycle:maxsize = 0
</span><span class="z-text z-plain">    recycle:exclude = *.tmp
</span><span class="z-text z-plain">    recycle:exclude_dir = /tmp
</span></code></pre><p><code>recycle:repository</code> где хранить удаленные объекты. Удаленные файлы попадут в скрытый каталог .recycle в котором создастся каталог с именем пользователя, удалившего файл или папку <br> <code>recycle:keeptree</code> удалять объекты с сохранением дерева каталогов <br> <code>recycle:touch</code> изменить дату изменения файла при его перемещении в корзину <br> <code>recycle:versions</code> при удалении файлов с совпадающими именами, добавлять номер версии <br> <code>recycle:maxsize</code> не помещать в корзину файлы, размер которых больше заданного параметра (в байтах). 0 - помещать файлы любого размера <br> <code>recycle:exclude</code> исключить файлы <br> <code>recycle:exclude_dir</code> исключить каталог<h2 id=nfs><a aria-label="Anchor link for: nfs" class=zola-anchor href=#nfs><i class=icon></i></a> nfs</h2><h3 id=server-1><a aria-label="Anchor link for: server-1" class=zola-anchor href=#server-1><i class=icon></i></a> server</h3><p><code>apt install nfs-kernel-server</code> установить сервер, с помощью которого будет выполнено открытие шары. Сервис NFS слушает соединения для TCP и UDP на порту 2049. <br> <code>apt install rpcbind</code> <br> <code>rpcinfo -p | grep nfs</code> проверить, слушается ли порт nfs <br> <code>cat /proc/filesystems | grep nfs</code> проверить, поддерживается ли NFS на уровне ядра (вывод: nodev nfsd) <br> <code>modprobe nfs</code> вручную загрузить модуль ядра nfs <br> <code>systemctl status nfs-server</code> служба сервера <br> <code>ufw allow 111,2049 && ufw reload</code> <br> <code>mkdir nfs-folder</code> создать папку для шары <br> <code>adduser nfs-user</code> создать пользователя для подключения <br> <code>chown nfs-user:nfs-user nfs-folder</code> изменить владельца шары <br> <code>chmod 775 nfs-folder</code> дать полный доступ владульцу и группе <br> <code>nano /etc/exports</code> файл настройки шары <br> <code>/nfs-folder 192.168.3.0/24(rw,sync,no_subtree_check)</code> /путь/к/директории (шарим), удаленный IP-адрес клиента или подсеть (что бы разрешить все адреса используется 0.0.0.0/24 или символ *) и опции в скобках <br> <code>exportfs -a</code> применить настройки (обновить таблицу экспорта NFS)<p>Options:<p><code>rw</code> разрешить чтение и запись в этой папке <br> <code>ro</code> разрешить только чтение <br> <code>sync</code> отвечать на следующие запросы только тогда, когда данные будут сохранены на диск (по умолчанию) <br> <code>async</code> не блокировать подключения пока данные записываются на диск <br> <code>secure</code> использовать для соединения только порты ниже 1024 <br> <code>insecure</code> использовать любые порты <br> <code>nohide</code> не скрывать дочернии директории, при открытии доступа к нескольким директориям <br> <code>root_squash</code> подменять запросы от root на анонимные (используется по умолчанию) <br> <code>no_root_squash</code> не подменять запросы от root на анонимные (все подключения от имени пользователя root считаются по умолчанию анонимными nfsnobody, отключение этой опции не безопасно, потому что любой root пользователь сможет получить доступ на запись ко всем файлам) <br> <code>all_squash</code> превращать все запросы в анонимные <br> <code>subtree_check</code> проверять не пытается ли пользователь выйти за пределы экспортированной папки <br> <code>no_subtree_check</code> отключить проверку обращения к экспортированной папке, улучшает производительность, но снижает безопасность, можно использовать когда экспортируется раздел диска <br> <code>anonuid и anongid</code> указывает uid и gid для анонимного пользователя<p>Работает стандартная система доступа UNIX, поэтому, если нужно чтобы пользователь подключивший директорию мог получить доступ к папке, то на клиентской стороне должен существовать пользователь с таким же UID (именем и ID), а на сервере для расшаренной директории должна принадлежать такому же пользователю или группе в которой он состоит (GID). Или дать полный доступ для всех пользователей (chmod 777 nfs-folder), тогда все созданные файлы будут от имени: nobody nogroup<p><code>/nfs-folder 192.168.3.0/24(rw,sync,all_squash,anonuid=1020,anongid=1020)</code> любой пользователь в сети сможет получить полный доступ ко всем файлам расшаренной директории, предварительно нужно создать пользователя с UID 1020 и указать, что бы все подключения считать запросами от анонимного пользователя, а анонимному пользователю присвоить UID 1020. Если у пользователя с id 1020 есть доступ к расшаренной директории на сервере, то при подключении директории на клиентской стороне он будет у пользователя с любым UID. При создании файлов и директорий под другим пользователем, будет указан владелец с номером UID и GID 1020. <br> <code>usermod -u 1020 nfs-user</code> изменить UID <br> <code>groupmod -g 1020 nfs-user</code> изменить GID <br> <code>id nfs-user</code> проверяем ID<h3 id=client-1><a aria-label="Anchor link for: client-1" class=zola-anchor href=#client-1><i class=icon></i></a> client</h3><p><code>apt install nfs-common</code> установить на клиентском компьютере, что бы работать c файловой системой <br> <code>mkdir /mnt/nfs-folder && mount 192.168.3.104:/nfs-folder/ /mnt/nfs-folder</code> подключить шару и првоерить df -h (192.168.3.104:/nfs-folder 48G 20G 27G 43% /mnt/nfs-folder) <br> <code>umount /mnt/nfs-folder</code> отключить <br> <code>showmount -e 192.168.3.104</code> отобразить список всех доступных ресурсов<h2 id=ftp><a aria-label="Anchor link for: ftp" class=zola-anchor href=#ftp><i class=icon></i></a> ftp</h2><p><code>apt install vsftpd</code> установка vsFTPd Server (Very Secure File Transfer Protocol Daemon) <br> <code>systemctl status vsftpd</code> <br> <code>ufw allow 20:21/tcp</code> открыть порты в Firewall <br> <code>ufw allow 30000:31000/tcp</code> <br> <code>cp /etc/vsftpd.conf /etc/vsftpd.conf.bak</code> резервная копия настроек<p><code>nano /etc/vsftpd.conf</code><pre class="language-conf z-code" data-lang=conf><code class=language-conf data-lang=conf><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">listen</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-language z-genconfig">YES</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">listen_ipv6</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-language z-genconfig">NO</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">anonymous_enable</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-language z-genconfig">NO</span>` отключить ананимный вход
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">local_enable</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-language z-genconfig">YES</span>` разрешить использовать имена локальных пользователей сервера для входа
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">write_enable</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-language z-genconfig">YES</span>` разрешить для авторизованных пользователей управлять файловой системой (по умолчанию возможно только скачивание)<span class="z-keyword z-operator z-genconfig">.</span> При подключение к серверу пользователь может управлять всеми каталогами<span class="z-keyword z-operator z-genconfig">,</span> куда у него есть доступ
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">chroot_local_user</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-language z-genconfig">NO</span>` когда установлено в <span class="z-constant z-language z-genconfig">YES</span><span class="z-keyword z-operator z-genconfig">,</span> ограничивает пользователей их домашними каталогами для предотвращения доступа к остальной части файловой системы
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">chroot_list_enable</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-language z-genconfig">YES</span>` задать список пользователей<span class="z-keyword z-operator z-genconfig">,</span> которые будут или не будут ограничены своими домашними каталогами в зависимости от chroot_local_user
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">chroot_list_file</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-keyword z-operator z-genconfig">/</span>etc<span class="z-keyword z-operator z-genconfig">/</span>vsftpd<span class="z-keyword z-operator z-genconfig">.</span>chroot_list` путь к файлу<span class="z-keyword z-operator z-genconfig">,</span> который содержит список пользователей для chroot<span class="z-keyword z-operator z-genconfig">-</span>ограничения
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">user_sub_token</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-storage z-source z-genconfig">$USER</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">local_root</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-keyword z-operator z-genconfig">/</span>home<span class="z-keyword z-operator z-genconfig">/</span><span class="z-storage z-source z-genconfig">$USER</span><span class="z-keyword z-operator z-genconfig">/</span>ftp` указать для всех пользователей по умолчанию домашний каталог при подключении (используется вместе с плейсхолдером)
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">userlist_enable</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-language z-genconfig">YES</span>` включает использование списка пользователей<span class="z-keyword z-operator z-genconfig">,</span> которые могут (или не могут) входить на сервер
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">userlist_file</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-keyword z-operator z-genconfig">/</span>etc<span class="z-keyword z-operator z-genconfig">/</span>vsftpd<span class="z-keyword z-operator z-genconfig">.</span>user_list` указывает путь к файлу со списком пользователей<span class="z-keyword z-operator z-genconfig">,</span> которые разрешены или запрещены
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">userlist_deny</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-language z-genconfig">NO</span>` ппределяет поведение списка пользователей<span class="z-keyword z-operator z-genconfig">,</span> когда установлено в <span class="z-constant z-language z-genconfig">NO</span><span class="z-keyword z-operator z-genconfig">,</span> только пользователи из списка userlist_file могут входить на сервер и наоборот
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">connect_from_port_20</span></span>` <span class="z-constant z-language z-genconfig">YES</span> <span class="z-keyword z-operator z-genconfig">-</span> использовать <span class="z-constant z-numeric z-genconfig">20</span> порт для передачи данных вместо случайного (нужно для нормальной работы firewall)
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">xferlog_enable</span> <span class="z-keyword z-operator z-genconfig">=</span></span> <span class="z-constant z-language z-genconfig">YES</span>` записывать в лог файл все транзакции
</span></code></pre><p><code>systemctl restart vsftpd</code> <br> <code>ss -ln | grep -w "21"</code> проверить, что 21 порт слушает (LISTEN) <br> <code>ss -tn | grep -w "21"</code> проверить установленные соединения на 21 порту (ESTAB) <br> <code>cat /var/log/vsftpd.log</code> лог работы (CONNECT/LOGIN/UPLOAD/DOWNLOAD/RENAME/DELETE)<h3 id=ftp-client><a aria-label="Anchor link for: ftp-client" class=zola-anchor href=#ftp-client><i class=icon></i></a> ftp client</h3><p><code>ftp 192.168.3.104</code> доступен только без использования SSL <br> <code>230 Login successful</code> вход в систему успешен <br> <code>ls</code> отобразить все файлы в текущей директории на удаленном компьютере <br> <code>get test.json</code> скачать файл на локальный компьютер <br> <code>put out.txt</code> загрузить файл на удаленный сервер <br> <code>bye</code> закрыть соединение<h3 id=ftps><a aria-label="Anchor link for: ftps" class=zola-anchor href=#ftps><i class=icon></i></a> ftps</h3><p><code>sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/ssl/private/vsftpd.key -out /etc/ssl/certs/vsftpd.crt</code> сгенерировать самозаверяющий SSL-сертификат и закрытый ключ<p><code>nano /etc/vsftpd.conf</code><pre class="language-conf z-code" data-lang=conf><code class=language-conf data-lang=conf><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">ssl_enable</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-language z-genconfig">YES</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">rsa_cert_file</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-keyword z-operator z-genconfig">/</span>etc<span class="z-keyword z-operator z-genconfig">/</span>ssl<span class="z-keyword z-operator z-genconfig">/</span>certs<span class="z-keyword z-operator z-genconfig">/</span>vsftpd<span class="z-keyword z-operator z-genconfig">.</span>crt
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">rsa_private_key_file</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-keyword z-operator z-genconfig">/</span>etc<span class="z-keyword z-operator z-genconfig">/</span>ssl<span class="z-keyword z-operator z-genconfig">/</span>private<span class="z-keyword z-operator z-genconfig">/</span>vsftpd<span class="z-keyword z-operator z-genconfig">.</span>key
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">allow_anon_ssl</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-language z-genconfig">NO</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">force_local_data_ssl</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-language z-genconfig">YES</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">force_local_logins_ssl</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-language z-genconfig">YES</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">ssl_tlsv1</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-language z-genconfig">YES</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">ssl_sslv2</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-language z-genconfig">NO</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">ssl_sslv3</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-language z-genconfig">NO</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">require_ssl_reuse</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-language z-genconfig">NO</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">ssl_ciphers</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-support z-constant z-genconfig">HIGH</span>
</span></code></pre><p><code>useradd -m -s /bin/bash ftpuser</code> пользователь с домашним именным каталогом и оболочкой bash <br> <code>passwd ftpuser</code> задать пароль пользователю <br> <code>echo "ftpuser" | tee -a /etc/vsftpd.chroot_list</code> добавить пользователя в список ограниченных домашним каталогом <br> <code>echo "ftpuser" | tee -a /etc/vsftpd.user_list</code> добавить пользователя в список разрешенных для подключения <br> <code>mkdir /home/ftpuser/ftp</code> создать домашнию директорию <br> <code>chown ftpuser:ftpuser ftp</code> назначить владельца и группу для директории <br> <code>chmod 555 ftp</code> ограничить доступ только на чтение и выполнение <br> <code>mkdir /home/ftpuser/ftp/upload</code> создать директорию для загруки (с возможностью записи) <br> <code>chown ftpuser:ftpuser upload</code> <br> <code>chmod 775 upload</code> полный доступ для владельца и группы<h2 id=rsync><a aria-label="Anchor link for: rsync" class=zola-anchor href=#rsync><i class=icon></i></a> rsync</h2><p><code>rsync -options SRC DST</code><p><code>-a</code> режим архивирования, когда сохраняются все исходные атрибуты оригинальных файлов (дата изменения и создания) <br> <code>-b</code> создание резервной копии <br> <code>-c</code> проверка контрольных сумм для файлов <br> <code>-e</code> использовать другой транспорт (например ssh) <br> <code>-h</code> выводит цифры в формате, нормальном для чтения <br> <code>-l</code> копировать символьные ссылки <br> <code>-L</code> копировать содержимое ссылок <br> <code>-p</code> сохранять права для файлов <br> <code>-q</code> минимум информации <br> <code>-u</code> не перезаписывать более новые файлы <br> <code>-v</code> выводить подробную информацию о процессе копирования <br> <code>-w</code> выполнить полное копирование без синхронизации <br> <code>-z</code> сжимать файлы перед передачей <br> <code>--delete</code> удалять остальные файлы у получателя, которых нет в источнике отправителя <br> <code>--progress</code> выводить прогресс передачи файла (в %) <br> <code>--stat</code> показать статистику передачи<p><code>rsync -zvh /home/lifailon /backup</code> копирование и синхронизация только файлов (skipping directory) указанной директории (в пределах одной локальной машины, например на внешний носитель). При редактировании файлов в исходной папке и повторном копирование заменит все содержимое (без синхронизации).<p><code>nano /etc/rsyncd.conf</code><pre class="language-conf z-code" data-lang=conf><code class=language-conf data-lang=conf><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">pid</span> </span>file <span class="z-keyword z-operator z-genconfig">=</span> <span class="z-keyword z-operator z-genconfig">/</span>var<span class="z-keyword z-operator z-genconfig">/</span>run<span class="z-keyword z-operator z-genconfig">/</span>rsyncd<span class="z-keyword z-operator z-genconfig">.</span>pid
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">lock</span> </span>file <span class="z-keyword z-operator z-genconfig">=</span> <span class="z-keyword z-operator z-genconfig">/</span>var<span class="z-keyword z-operator z-genconfig">/</span>run<span class="z-keyword z-operator z-genconfig">/</span>rsync<span class="z-keyword z-operator z-genconfig">.</span>lock
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">log</span> </span>file <span class="z-keyword z-operator z-genconfig">=</span> <span class="z-keyword z-operator z-genconfig">/</span>var<span class="z-keyword z-operator z-genconfig">/</span>log<span class="z-keyword z-operator z-genconfig">/</span>rsync<span class="z-keyword z-operator z-genconfig">.</span>log
</span><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">[share]
</span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">path</span> <span class="z-keyword z-operator z-genconfig">=</span></span> <span class="z-keyword z-operator z-genconfig">/</span>backup<span class="z-keyword z-operator z-genconfig">/</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">hosts</span> </span>allow <span class="z-keyword z-operator z-genconfig">=</span> <span class="z-meta z-ip z-genconfig"><span class="z-constant z-other z-genconfig">192.168.3.103</span></span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">hosts</span> </span>deny <span class="z-keyword z-operator z-genconfig">=</span> <span class="z-keyword z-operator z-genconfig">*</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">list</span> <span class="z-keyword z-operator z-genconfig">=</span></span> <span class="z-constant z-language z-genconfig">true</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">uid</span> <span class="z-keyword z-operator z-genconfig">=</span></span> lifailon
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">gid</span> <span class="z-keyword z-operator z-genconfig">=</span></span> lifailon
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">read</span> </span>only <span class="z-keyword z-operator z-genconfig">=</span> <span class="z-constant z-language z-genconfig">false</span>
</span></code></pre><p><code>chown kup:kup backup</code> сменить владельца и группу директории <br> <code>chmod ug+rwx backup</code> выдать им полные права (для удаленного пользователя) <br> <code>systemctl start rsync</code> запустить сервер<p>Синхронизация на удаленной машине (192.168.3.103) авторизованным под пользователем, указанным в конфигурации:<p><code>rsync -avzh /backup/ kup@192.168.3.103:/tmp/backup/</code> скопировать содержимое локальной папки backup (включая директории) на удаленный сервер. По умолчанию Rsync использует транспорт SSH (шифрованный) с запросом пароля (если не используется ключ). <br> <code>rsync -avzhe "ssh -p 2121" /tmp/backup/ kup@192.168.21.121:/tmp/backup/</code> если используется нестандартный порт <br> <code>rsync -avzh /tmp/backup/ rsync://192.168.21.121:/share</code> явно задать использование транспорта Rsync <br> При редактировании исходных файлов, заменит содержимое только тех файлов, которые были изменены (sending incremental file list ./ test3) <br> <code>rsync -avzh kup@192.168.3.103:/tmp/backup /tmp/backup/</code> скопировать данные с удаленного сервера на локальный компьютер <br> <code>ssh-keygen -t rsa</code> в случае доступа к серверу по SSH необходимо будет создать ключ и загрузить его на сервер, чтобы аутентификация проходила без запроса пароля <br> <code>ssh-copy-id -i /home/sk/.ssh/id_rsa.pub kup@192.168.21.10</code> передать ключ на сервер с которым будет происходить синхронизация <br> <code>00 03 * * * rsync -avzhe "ssh -p 2121" /tmp/backup/ kup@192.168.21.121:/tmp/backup/</code> добавить в планировщик, синхронизация каталогов будет выполняться каждый день в 3 часа ночи<h2 id=apache><a aria-label="Anchor link for: apache" class=zola-anchor href=#apache><i class=icon></i></a> apache</h2><p><code>apt install apache2</code> <br> <code>cat /etc/apache2/apache2.conf</code> <br> <code>cat /etc/apache2/ports.conf</code> <br> <code>port=8443</code> <br> <code>cat /etc/apache2/ports.conf | sed -r "s/^Listen.+/Listen $port/" > /etc/apache2/ports.conf</code> <br> <code>systemctl restart apache2</code> <br> <code>systemctl status apache2</code> <br> <code>ss -lpn | grep apache</code> <br> <code>echo "&LTH1>$(hostname)&LT/H1>" > /var/www/html/index.html</code><h3 id=api-server><a aria-label="Anchor link for: api-server" class=zola-anchor href=#api-server><i class=icon></i></a> api server</h3><p><code>mkdir /var/www/api && touch /var/www/api/api.sh && chmod +x /var/www/api/api.sh</code> <br> <code>curl -s "https://raw.githubusercontent.com/Lifailon/bash-api-server/rsa/www/api/api.sh" > /var/www/api/api.sh</code> установить пример с шаблоном сервера api<p><code>nano /var/www/api/api.sh</code><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell">!/bin/bash</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-conditional z-if z-shell">if</span> <span class="z-support z-function z-test z-begin z-shell">[</span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">REQUEST_METHOD</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-keyword z-operator z-logical z-shell">==</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>GET<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> <span class="z-support z-function z-test z-end z-shell">]</span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-keyword z-control z-conditional z-then z-shell">then</span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>Content-type: application/json<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>{"result": "ok"}<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-conditional z-else z-shell">else</span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>Content-type: text/plain<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>Request method not supported<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-conditional z-end z-shell">fi</span>
</span></code></pre><p><code>a2enmod auth_basic</code> активировать модуль базовой HTTP аутентификации <br> <code>htpasswd -b -c /etc/apache2/.htpasswd rest api</code> настроить htpasswd для хранения пользовательских данных (создать пользователя rest с паролем api)<p><code>nano /etc/apache2/sites-available/api.conf</code> создать VirtualHost для обработки запросов<pre class="language-conf z-code" data-lang=conf><code class=language-conf data-lang=conf><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">&LTVirtualHost *:8443>
</span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">    <span class="z-variable z-parameter z-genconfig">DocumentRoot</span> </span><span class="z-keyword z-operator z-genconfig">/</span>var<span class="z-keyword z-operator z-genconfig">/</span>www<span class="z-keyword z-operator z-genconfig">/</span>html
</span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig">    <span class="z-comment z-line z-number-sign z-genconfig"># Связать endpoint (включая все дочернии в пути) с исполняемым файлом
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">    <span class="z-variable z-parameter z-genconfig">ScriptAlias</span> </span><span class="z-keyword z-operator z-genconfig">/</span>api <span class="z-keyword z-operator z-genconfig">/</span>var<span class="z-keyword z-operator z-genconfig">/</span>www<span class="z-keyword z-operator z-genconfig">/</span>api<span class="z-keyword z-operator z-genconfig">/</span>api<span class="z-keyword z-operator z-genconfig">.</span>sh
</span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig">    <span class="z-comment z-line z-number-sign z-genconfig"># Все опции, вложенные внутрь секции Directory, применяются к указанной директории
</span></span></span><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">    &LTDirectory "/var/www/api">
</span></span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig">        <span class="z-comment z-line z-number-sign z-genconfig"># Разрешить выполнение CGI-скриптов
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">        <span class="z-variable z-parameter z-genconfig">Options</span> </span><span class="z-keyword z-operator z-genconfig">+</span>ExecCGI
</span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig">        <span class="z-comment z-line z-number-sign z-genconfig"># Обрабатывать все файлы с расширение sh как CGI-скрипт
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">        <span class="z-variable z-parameter z-genconfig">AddHandler</span> </span>cgi<span class="z-keyword z-operator z-genconfig">-</span>script <span class="z-keyword z-operator z-genconfig">.</span>sh
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">        <span class="z-variable z-parameter z-genconfig">AllowOverride</span> </span><span class="z-constant z-language z-genconfig">None</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">        <span class="z-variable z-parameter z-genconfig">Require</span> </span>all granted
</span><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">    &LT/Directory>
</span></span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig">    <span class="z-comment z-line z-number-sign z-genconfig"># Добавить авторизацию для endpoint
</span></span></span><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">    &LTLocation "/api">
</span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">        <span class="z-variable z-parameter z-genconfig">AuthType</span> </span>Basic
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">        <span class="z-variable z-parameter z-genconfig">AuthName</span> </span><span class="z-string z-quoted z-double z-genconfig">"Restricted Area"</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">        <span class="z-variable z-parameter z-genconfig">AuthUserFile</span> </span><span class="z-keyword z-operator z-genconfig">/</span>etc<span class="z-keyword z-operator z-genconfig">/</span>apache2<span class="z-keyword z-operator z-genconfig">/</span><span class="z-keyword z-operator z-genconfig">.</span>htpasswd
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">        <span class="z-variable z-parameter z-genconfig">Require</span> </span>valid<span class="z-keyword z-operator z-genconfig">-</span>user
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">        <span class="z-variable z-parameter z-genconfig">SetHandler</span> </span>cgi<span class="z-keyword z-operator z-genconfig">-</span>script
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">        <span class="z-variable z-parameter z-genconfig">Options</span> </span><span class="z-keyword z-operator z-genconfig">+</span>ExecCGI
</span><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">    &LT/Location>
</span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">    <span class="z-variable z-parameter z-genconfig">ErrorLog</span> </span><span class="z-storage z-source z-genconfig">${APACHE_LOG_DIR}</span><span class="z-keyword z-operator z-genconfig">/</span>error<span class="z-keyword z-operator z-genconfig">.</span>log
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">    <span class="z-variable z-parameter z-genconfig">CustomLog</span> </span><span class="z-storage z-source z-genconfig">${APACHE_LOG_DIR}</span><span class="z-keyword z-operator z-genconfig">/</span>access<span class="z-keyword z-operator z-genconfig">.</span>log combined
</span><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">&LT/VirtualHost>
</span></span></code></pre><p><code>a2enmod cgi</code> активировать модуль (en mod) Common Gateway Interface (CGI) <br> <code>a2ensite api.conf</code> активировать VirtualHost (en site) <br> <code>systemctl restart apache2</code> <br> <code>tail -f /var/log/apache2/error.log</code> <br> <code>tail -f /var/log/apache2/access.log</code><p><code>curl -s -X GET http://127.0.0.1:8443/api -u rest:api | jq .result</code> <br> <code>curl -s -X GET http://127.0.0.1:8443/api/info -u rest:api -H "Content-Type: application/json" | jq .content[]</code><p><code>REQUEST_METHOD</code> метод HTTP-запроса (GET, POST, HEAD и т.д.) <br> <code>REQUEST_URI</code> оригинальный URI запроса <br> <code>QUERY_STRING</code> строка запроса URL <br> <code>CONTENT_TYPE</code> тип содержимого запроса в заголовке клиента (например, application/text) <br> <code>CONTENT_LENGTH</code> длина тела запроса в байтах (чаще, для POST-запросов) <br> <code>read -n $CONTENT_LENGTH POST_DATA</code> прочитать содержимое Body из стандартного ввода (stdin). <br> <code>HTTP_STATUS</code> читаем содержимое переданного заголовка (например, “Status: text”), которое определяется заранее и регламентируется в дальнейшем <br> <code>HTTP_USER_AGENT</code> название агента клиента из заголовка (например, curl/8.4.0) <br> <code>REMOTE_ADDR</code> адрес клиента <br> <code>REMOTE_PORT</code> порт клиента <br> <code>SERVER_NAME</code> адрес сервера <br> <code>SERVER_PORT</code> порт сервера <br> <code>SCRIPT_NAME</code> путь и имя CGI-скрипта <br> <code>SERVER_SOFTWARE</code> имя и версия сервера <br> <code>SERVER_PROTOCOL</code> версия протокола HTTP (например, HTTP/1.1) <br> <code>HTTPS</code> если установлено, то запрос был сделан с использованием HTTPS <br> <code>AUTH_TYPE</code> тип аутентификации, если он был предоставлен <br> <code>REMOTE_USER</code> имя пользователя, если была использована аутентификация <br> <code>DOCUMENT_ROOT</code> корневой каталог веб-сервера<h3 id=status><a aria-label="Anchor link for: status" class=zola-anchor href=#status><i class=icon></i></a> status</h3><p><code>apachectl -M | grep status_module</code> проверить подключенный модуль статистики: status_module (shared) <br> <code>nano /etc/apache2/mods-available/status.conf</code> <br> <code>Require ip 192.168.3.0/24</code> указать для кого доступна статистика <br> http://127.0.0.1:8443/server-status <br> <code>apachectl -t</code> проверить синтаксис (Syntax OK) <br> <code>a2enmod status</code> активировать модуль (Module status already enabled) <br> <code>systemctl restart apache2</code> <br> <code>netstat -tulpan | grep apache2</code> проверить порт <br> <code>curl http://127.0.0.1:8443/server-status?auto</code><h3 id=webdav><a aria-label="Anchor link for: webdav" class=zola-anchor href=#webdav><i class=icon></i></a> webdav</h3><p><code>nano /etc/apache2/ports.conf</code><pre class=z-code><code><span class="z-text z-plain">Listen 8443
</span><span class="z-text z-plain">Listen 2024
</span></code></pre><p><code>mkdir /var/www/webdav && chown www-data:www-data /var/www/webdav</code> создать каталог к которому будет доступ через WebDAV и предоставить доступ к нему для www-data<p><code>nano /etc/apache2/sites-available/webdav.conf</code><pre class="language-conf z-code" data-lang=conf><code class=language-conf data-lang=conf><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">&LTVirtualHost *:2024>
</span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">    <span class="z-variable z-parameter z-genconfig">ServerAdmin</span> </span>webmaster<span class="z-storage z-source z-genconfig">@localhost</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">    <span class="z-variable z-parameter z-genconfig">DocumentRoot</span> </span><span class="z-keyword z-operator z-genconfig">/</span>var<span class="z-keyword z-operator z-genconfig">/</span>www<span class="z-keyword z-operator z-genconfig">/</span>webdav
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">    <span class="z-variable z-parameter z-genconfig">Alias</span> </span><span class="z-keyword z-operator z-genconfig">/</span>webdav <span class="z-keyword z-operator z-genconfig">/</span>var<span class="z-keyword z-operator z-genconfig">/</span>www<span class="z-keyword z-operator z-genconfig">/</span>webdav
</span><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">    &LTDirectory /var/www/webdav>
</span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">        <span class="z-variable z-parameter z-genconfig">Options</span> </span>Indexes FollowSymLinks
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">        <span class="z-variable z-parameter z-genconfig">AllowOverride</span> </span><span class="z-constant z-language z-genconfig">None</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">        <span class="z-variable z-parameter z-genconfig">Require</span> </span>all granted
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">        <span class="z-variable z-parameter z-genconfig">Dav</span> </span><span class="z-constant z-language z-genconfig">On</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">        <span class="z-variable z-parameter z-genconfig">AuthType</span> </span>Basic
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">        <span class="z-variable z-parameter z-genconfig">AuthName</span> </span><span class="z-string z-quoted z-double z-genconfig">"WebDAV"</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">        <span class="z-variable z-parameter z-genconfig">AuthUserFile</span> </span><span class="z-keyword z-operator z-genconfig">/</span>etc<span class="z-keyword z-operator z-genconfig">/</span>apache2<span class="z-keyword z-operator z-genconfig">/</span><span class="z-keyword z-operator z-genconfig">.</span>htpasswd
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">        <span class="z-variable z-parameter z-genconfig">Require</span> </span>valid<span class="z-keyword z-operator z-genconfig">-</span>user
</span><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">    &LT/Directory>
</span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">    <span class="z-variable z-parameter z-genconfig">ErrorLog</span> </span><span class="z-storage z-source z-genconfig">${APACHE_LOG_DIR}</span><span class="z-keyword z-operator z-genconfig">/</span>webdav_error<span class="z-keyword z-operator z-genconfig">.</span>log
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">    <span class="z-variable z-parameter z-genconfig">CustomLog</span> </span><span class="z-storage z-source z-genconfig">${APACHE_LOG_DIR}</span><span class="z-keyword z-operator z-genconfig">/</span>webdav_access<span class="z-keyword z-operator z-genconfig">.</span>log combined
</span><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">&LT/VirtualHost>
</span></span></code></pre><p><code>a2enmod dav</code> <br> <code>a2enmod dav_fs</code> <br> <code>a2enmod auth_digest</code> <br> <code>a2enmod authn_core</code> <br> <code>a2enmod authn_file</code> <br> <code>a2enmod authz_core</code> <br> <code>a2enmod authz_user</code> <br> <code>htpasswd /etc/apache2/.htpasswd admin</code> создать пользователя admin (ключ -с используется для пересоздания файла) <br> <code>a2ensite webdav</code> активировать конфигурацию сайта <br> <code>systemctl restart apache2</code><h2 id=haproxy><a aria-label="Anchor link for: haproxy" class=zola-anchor href=#haproxy><i class=icon></i></a> haproxy</h2><p><code>apt install haproxy</code> <br> <code>systemctl status haproxy</code><p><code>/etc/default/haproxy</code><pre class=z-code><code><span class="z-text z-plain">ENABLED=1
</span></code></pre><p><code>/etc/haproxy/haproxy.cfg</code><pre class=z-code><code><span class="z-text z-plain">global
</span><span class="z-text z-plain">log 127.0.0.1 local0 notice
</span><span class="z-text z-plain">maxconn 10000
</span><span class="z-text z-plain">nbproc 1
</span><span class="z-text z-plain">user haproxy
</span><span class="z-text z-plain">group haproxy
</span><span class="z-text z-plain">daemon
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">defaults
</span><span class="z-text z-plain">log global
</span><span class="z-text z-plain">maxconn global
</span><span class="z-text z-plain">timeout client 5s
</span><span class="z-text z-plain">timeout server 5s
</span><span class="z-text z-plain">timeout connect 5s
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">frontend http_front
</span><span class="z-text z-plain">mode http
</span><span class="z-text z-plain">bind *:8081
</span><span class="z-text z-plain">#bind *:443 ssl crt /etc/ssl/domain.ru/cert.pem 
</span><span class="z-text z-plain">option httplog
</span><span class="z-text z-plain">###mode tcp
</span><span class="z-text z-plain">###bind *:3389
</span><span class="z-text z-plain">###option tcplog
</span><span class="z-text z-plain">use_backend http_back
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">backend http_back
</span><span class="z-text z-plain">mode http
</span><span class="z-text z-plain">balance roundrobin
</span><span class="z-text z-plain">###mode tcp
</span><span class="z-text z-plain">###balance leastconn
</span><span class="z-text z-plain">option httpchk GET / HTTP/1.1\r\nHost:\ localhost
</span><span class="z-text z-plain">###option tcp-check
</span><span class="z-text z-plain">###tcp-check connect port 3389
</span><span class="z-text z-plain">#server term1.domain.ru 192.168.55.30:443 ssl verify none weight 100 check inter 5s fall 5 rise 3
</span><span class="z-text z-plain">#server term2.domain.ru 192.168.55.35:443 ssl verify none weight 100 check inter 5s fall 5 rise 3
</span><span class="z-text z-plain">server pi-hole-01 192.168.3.101:8081 weight 100 check inter 5s fall 5 rise 3
</span><span class="z-text z-plain">server netbox-01 192.168.3.104:8081 weight 100 check inter 5s fall 5 rise 3
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">listen stats
</span><span class="z-text z-plain">bind *:8082
</span><span class="z-text z-plain">#bind *:8080 ssl crt /etc/ssl/domain.ru/cert.pem 
</span><span class="z-text z-plain">mode http
</span><span class="z-text z-plain">stats enable
</span><span class="z-text z-plain">stats uri /
</span><span class="z-text z-plain">stats auth admin:password
</span><span class="z-text z-plain">stats show-legends
</span><span class="z-text z-plain">stats show-node
</span><span class="z-text z-plain">stats refresh 5s
</span></code></pre><p><code>haproxy -f /etc/haproxy/haproxy.cfg -c</code> проверить синтаксис (Configuration file is valid) <br> <code>systemctl restart haproxy</code> применить настройки (перечитать конфигурацию) <br> <code>ss -lpn | grep 8081</code> <br> <code>curl http://192.168.3.102:8081</code> проверка http-трафика <br> <code>http://192.168.3.102:8082</code> статистика <br> <code>cat /var/log/haproxy.log</code> <br> <code>journalctl -eu haproxy</code> <br> <code>systemctl stop apache2</code> отключить на 101<ul><li>options:</ul><p><code>maxconn</code> максимальное количество одновременных соединений <br> <code>nbproc</code> количество процессов HAProxy <br> <code>option httplog</code> включает журналирование HTTP-трафика, полезно для отладки и мониторинга прохождения трафика через HAProxy и дает возможность просматривать HTTP-трафик в журнале, чтобы отслеживать запросы и ответы <br> <code>option httpchk</code> отправлять HTTP-запросы к серверам в бэкенде, чтобы определить, работают ли они, это позволяет выявлять неработающие сервера и перераспределять запросы на работающие <br> <code>option httpchk GET / HTTP/1.1\r\nHost:\ localhost</code> отправляет GET-запрос на корневой путь (/) используя версию протокола HTTP 1.1, Host:\ localhost - это часть заголовка Host, который также включается в HTTP-запрос и указывает на целевой хост, который проверяется <br> <code>option tcp-check</code> активирует общую функцию TCP-проверок для всего бэкэнда, без необходимости указывать порт явно <br> <code>tcp-check connect port 443</code> HAProxy будет устанавливать соединение с серверами в бэкенде на порту 443 для проверки, что серверы доступны и способны принимать соединения на этом порту<ul><li>balance:</ul><p><code>Round Robin (roundrobin)</code> алгоритм используемый по умолчанию, отправляет запросы на сервера по очереди <br> <code>static-rr</code> похож на roundrobin, но он сохраняет порядок серверов в конфигурации <br> <code>Least Connections (leastconn)</code> выбирает сервер с наименьшим количеством активных соединений, это полезно, если у серверов разная производительность или загруженность, так как запросы будут отправляться на менее загруженные серверы <br> <code>source</code> использует IP-адрес источника (клиента) для привязки к одному и тому же серверу, это означает, что клиент всегда будет направляться к одному и тому же серверу, это полезно для сохранения состояния сеанса <br> <code>uri</code> запросы с одним и тем же URL (до знака вопроса) будут переправляться на один и тот же сервер, это полезно для балансировки запросов к разным частям приложения <br> <code>rdp-cookie</code> используется для балансировки запросов RDP (Remote Desktop Protocol), он анализирует cookie-заголовок RDP для принятия решений о направлении запросов<ul><li>server:</ul><p><code>ssl</code> использование SSL <br> <code>verify none</code> отсутствие проверки сертификата <br> <code>weight</code> распределение запросов по весу, если необходимо на определенный сервер отправлять больше запросов <br> <code>inter</code> изменяет интервал между проверками, по умолчанию две секунды <br> <code>fall</code> устанавливает допустимое количество неудачных проверок, по умолчанию три <br> <code>rise</code> задает, сколько проходных проверок должно быть, прежде чем вернуть ранее отказавший сервер в ротацию, по умолчанию два <br> <code>check port 443</code> указать явную проверку порта для конкретного сервера <br> <code>check backup</code> параметр означает, что сервер будет использоваться только в случае, если все основные серверы становятся недоступными и не будет участвовать в балансировке, пока основные серверы функционируют<h2 id=keepalive><a aria-label="Anchor link for: keepalive" class=zola-anchor href=#keepalive><i class=icon></i></a> keepalive</h2><p><strong>VRRP (Virtual Router Redundancy Protocol)</strong> - сетевой протокол, предназначенный для увеличения доступности маршрутизаторов, выполняющих роль шлюза <br> <strong>VRRP-пакеты</strong> - это специальные сообщения, которые узлы (маршрутизаторы/сервера) в VRRP-группе рассылают для сообщения своего состояния <br> <strong>VIP (Virtual IP)</strong> - виртуальный IP адрес, который может автоматически переключаться между серверами в случае сбоя (frondend для haproxy/dns-rr), у кого в данный момент в сетевом интерфейсе прописан VIP, тот сервер и работает <br> <strong>Master</strong> - сервер, на котором в данный момент активен VIP (отправляет VRRP-пакеты на backup nodes) <br> <strong>Backup</strong> - сервера на которые переключится VIP, в случае сбоя мастера (следим за мастером) <br> <strong>VRID (virtual_router_id)</strong> - сервера, объединенные общим виртуальным IP (VIP) образуют виртуальный роутер, уникальный идентификатор которого, принимает значения от 1 до 255. Сервер может одновременно состоять в нескольких VRID, при этом для каждой VRID должны использоваться уникальные виртуальные IP адреса. <br> Master сервер с заданным интервалом отправляет VRRP пакеты на зарезервированный адрес multicast (многоадресной) рассылки или unicast на указанные ip-адреса, а все backup/slave сервера слушают этот адрес. Если Slave сервер не получает пакеты, он начинает процедуру выбора Master в соответствии с приоритетом, и если он переходит в состояние Master, то у него активирует VIP (поднимается виртуальный интерфейс) и отравляет gratuitous ARP. <br> <strong>Gratuitous ARP</strong> - это вид ARP ответа, который обновляет MAC таблицу на подключенных коммутаторах, чтобы проинформировать о смене владельца виртуального IP-адреса и MAC-адреса для перенаправления трафика. При настройке VRRP, в качестве адреса для виртуального IP не используется реальный адрес сервера, так как, в случае сбоя, его адрес переместится на соседний, и при восстановлении, он окажется изолированным от сети, и чтобы вернуть свой адрес, нужно отправить в сеть VRRP пакет, но не будет IP адреса, с которого это возможно сделать.<p><code>nano /etc/keepalived/keepalived.conf</code><pre class="language-conf z-code" data-lang=conf><code class=language-conf data-lang=conf><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">global_defs </span>{
</span><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">    enable_script_security
</span></span><span class="z-source z-genconfig">}
</span><span class="z-source z-genconfig">
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">vrrp_script</span> </span>nginx_check {
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">    <span class="z-variable z-parameter z-genconfig">script</span> </span><span class="z-string z-quoted z-double z-genconfig">"/usr/bin/curl http://127.0.0.1"</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">    <span class="z-variable z-parameter z-genconfig">interval</span> </span><span class="z-constant z-numeric z-genconfig">5</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">    <span class="z-variable z-parameter z-genconfig">user</span> </span>nginx
</span><span class="z-source z-genconfig">}
</span><span class="z-source z-genconfig">
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">vrrp_instance</span> </span>web {
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">    <span class="z-variable z-parameter z-genconfig">state</span> </span><span class="z-support z-constant z-genconfig">MASTER</span><span class="z-meta z-comment z-genconfig"> <span class="z-comment z-line z-number-sign z-genconfig"># на втором сервере BACKUP
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">    <span class="z-variable z-parameter z-genconfig">interface</span> </span>ens33
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">    <span class="z-variable z-parameter z-genconfig">virtual_router_id</span> </span><span class="z-constant z-numeric z-genconfig">110</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">    <span class="z-variable z-parameter z-genconfig">priority</span> </span><span class="z-constant z-numeric z-genconfig">255</span><span class="z-meta z-comment z-genconfig"> <span class="z-comment z-line z-number-sign z-genconfig"># на втором сервере 100
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">    <span class="z-variable z-parameter z-genconfig">advert_int</span> </span><span class="z-constant z-numeric z-genconfig">2</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">    <span class="z-variable z-parameter z-genconfig">notify</span> </span><span class="z-keyword z-operator z-genconfig">/</span>etc<span class="z-keyword z-operator z-genconfig">/</span>keepalived<span class="z-keyword z-operator z-genconfig">/</span>notify<span class="z-keyword z-operator z-genconfig">-</span>web<span class="z-keyword z-operator z-genconfig">.</span>sh root
</span><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">    virtual_ipaddress </span>{
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig">        <span class="z-variable z-parameter z-genconfig">192</span></span><span class="z-keyword z-operator z-genconfig">.</span><span class="z-constant z-numeric z-genconfig">168</span><span class="z-keyword z-operator z-genconfig">.</span><span class="z-constant z-numeric z-genconfig">3</span><span class="z-keyword z-operator z-genconfig">.</span><span class="z-constant z-numeric z-genconfig">110</span>
</span><span class="z-source z-genconfig">    }
</span><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">    track_interface </span>{
</span><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">        ens333
</span></span><span class="z-source z-genconfig">    }
</span><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">    track_script </span>{
</span><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">        nginx_check
</span></span><span class="z-source z-genconfig">    }
</span><span class="z-source z-genconfig">}
</span></code></pre><p><code>state &LTMASTER|BACKUP></code> начальное состояние при запуске, в режиме nopreempt единственное допустимое значение - BACKUP <br> <code>interface</code> интерфейс, на котором будет работать VRRP и подниматься VIP <br> <code>virtual_router_id &LT0-255></code> уникальный идентификатор VRRP экземпляра, должен совпадать на всех серверах одной группы <br> <code>priority &LT0-255></code> задает приоритет при выборе MASTER, сервер с большим числом приоритета становится MASTER <br> <code>advert_int <число секунд></code> определяет, с какой периодичностью мастер должен сообщать остальным о себе, и если по истечению данного периода сервера не получат от мастера широковещательный пакет, то они инициируют выборы нового мастера <br> <code>nopreempt</code> если мастер пропал из сети, и был выбран новый мастер с меньшим приоритетом, то по возвращении старшего мастера, он останется в состоянии BACKUP, пока новый мастер не отвалится <br> <code>preempt_delay</code> что бы мастером был конкретный сервер, то заменить настройку nopreempt на preempt_delay <br> <code>notify</code> скрипт, который будет выполняться при каждом изменении состояния сервера, и имя пользователя, от имени которого данный скрипт будет выполняться (логирование или отправка на почту) <br> <code>virtual_ipaddress</code> виртуальный IP-адрес (VIP), которые будет активирован на сервере в состоянии MASTER, должны совпадать на всех серверах внутри VRRP экземпляра <br> <code>track_interface</code> мониторинг состояния интерфейсов, переводит VRRP экземпляр в состояние FAULT, если один из перечисленных интерфейсов находится в состоянии DOWN <br> <code>track_script</code> мониторинг с использованием скрипта, который должен возвращать 0 если проверка завершилась успешно или 1, если проверка завершилась с ошибкой <br> <code>fall <число></code> количество раз, которое скрипт вернул не нулевое значение, при котором перейти в состояние FAULT <br> <code>rise <число></code> количество раз, которое скрипт вернул нулевое значение, при котором выйти из состояния FAULT <br> <code>timeout <число></code> время ожидания, пока скрипт вернет результат, после которого вернуть ненулевое значение<p><code>journalctl -u keepalived</code> <br> <code>cat /var/log/messages | grep -i keepalived</code> <br> <code>tail /var/run/keepalived.INSTANCE.web.state</code></p><span class=hidden id=copy-code-text>Copy Code</span><span class=hidden id=search-index>https://lifailon.github.io/search_index.en.json</span><span class=hidden id=more-matches-text>$MATCHES more matches</span></main><footer id=site-footer><nav><ul><li><a href=https://lifailon.github.io/powershell/>PowerShell</a><li><a class=active href=https://lifailon.github.io/linux/>Linux</a><li><a href=https://lifailon.github.io/golang/>GoLang</a><li><a href=https://lifailon.github.io/node-js/>Node.js</a><li><a href=https://lifailon.github.io/docker/>Docker</a><li><a href=https://lifailon.github.io/network/>Network</a><li><a href=https://lifailon.github.io/windowsserver/>Windows Server</a><li><a href=https://lifailon.github.io/database/>Database</a><li><a href=https://lifailon.github.io/api/>API</a><li><a href=https://lifailon.github.io/devops/>DevOps</a></ul></nav><p>© <strong>2023-2025</strong> <code>Lifailon</code><p><a class=external href=https://github.com/Lifailon/PS-Commands>Website source</a><p><small>Powered by <a class="link external" href=https://www.getzola.org>Zola</a> and <a class="link external" href=https://duckquill.daudix.one>Duckquill</a> </small><ul id=socials><li><a rel=" me" href=https://github.com/lifailon/PS-Commands title=GitHub> <i style="--icon:url(&#34data:image/svg+xml,%3Csvg role='img' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Ctitle%3EGitHub%3C/title%3E%3Cpath d='M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12'/%3E%3C/svg%3E&#34)" class=icon></i> <span>GitHub</span> </a><li><a rel=" me" href=https://www.nuget.org/profiles/Lifailon title=NuGet> <i style="--icon:url(&#34data:image/svg+xml,%3Csvg role='img' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Ctitle%3ENUGet%3C/title%3E%3Cpath d='M1.57 0A1.57 1.57 0 000 1.57v20.86A1.57 1.57 0 001.57 24h20.86A1.57 1.57 0 0024 22.43V1.57A1.57 1.57 0 0022.43 0zM7.5 1.5A2.5 2.5 0 0110 4a2.5 2.5 0 01-2.5 2.5A2.5 2.5 0 015 4a2.5 2.5 0 012.5-2.5zM12 6h9v12h-1.5a3.76 3.76 0 00-2.81-1.25A3.76 3.76 0 0012.5 20a3.76 3.76 0 002.19 3.25A3.76 3.76 0 0018.5 24H21V6z'/%3E%3C/svg%3E&#34)" class=icon></i> <span>NuGet</span> </a><li><a rel=" me" href=https://www.npmjs.com/~lifailon title=NPM> <i style="--icon:url(&#34data:image/svg+xml,%3Csvg role='img' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Ctitle%3ENPM%3C/title%3E%3Cpath d='M0 0v24h24V0zm14.74 14.74h-3.66v-5.5h-1.83v5.5H5.5V5.5h9.24z'/%3E%3C/svg%3E&#34)" class=icon></i> <span>NPM</span> </a><li><a rel=" me" title="Docker Hub" href=https://hub.docker.com/u/lifailon> <i style="--icon:url(&#34data:image/svg+xml,%3Csvg role='img' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Ctitle%3EDocker%3C/title%3E%3Cpath d='M22.149 10.74c-.111-.086-1.15-.86-3.3-.86-.26.002-.52.017-.78.045-.24-1.35-1.32-1.8-1.35-1.81l-.45-.17-.3.42c-.17.24-.65.88-.65 1.76.001.29.04.58.12.86-.66.19-1.3.35-1.95.48a9.72 9.72 0 0 1-1.95.22H.75c-.41 0-.75.34-.75.75 0 4.42 2.4 5.98 4.41 6.68.9.28 1.91.42 3.01.42 1.08 0 2.11-.14 3.01-.42 1.98-.61 3.51-2.01 4.14-4.01.34.04.68.07 1.02.07 1.35 0 2.61-.35 3.72-1.04 1.64-1.01 1.87-2.23 1.87-2.92.01-.96-.34-1.68-.35-1.7zM6.75 8.22h2.25c.14 0 .25-.11.25-.25V6.47c0-.14-.11-.25-.25-.25H6.75c-.14 0-.25.11-.25.25v1.5c0 .14.11.25.25.25zM12 8.22h2.25c.14 0 .25-.11.25-.25V6.47c0-.14-.11-.25-.25-.25H12c-.14 0-.25.11-.25.25v1.5c0 .14.11.25.25.25zM9.375 6.72h-2.25c-.14 0-.25.11-.25.25v1.5c0 .14.11.25.25.25h2.25c.14 0 .25-.11.25-.25v-1.5c0-.14-.11-.25-.25-.25zM12 5.47h-2.25c-.14 0-.25.11-.25.25v1.5c0 .14.11.25.25.25H12c.14 0 .25-.11.25-.25v-1.5c0-.14-.11-.25-.25-.25z'/%3E%3C/svg%3E&#34)" class=icon></i> <span>Docker Hub</span> </a></ul></footer>