<!doctype html><html data-theme=light lang=en xmlns=http://www.w3.org/1999/xhtml><head><meta charset=UTF-8><meta content="Web version for PowerShell notes in Russian language (Сheat Sheet & Documentation) and RuDocs (node.js)" name=description><meta content="width=device-width,initial-scale=1" name=viewport><meta content=#ff7800 name=theme-color><meta content=#ffa348 media=(prefers-color-scheme:dark) name=theme-color><meta content="default-src 'none';font-src 'self';img-src 'self' https: data:;media-src 'self' https:;style-src 'self' 'unsafe-inline';frame-src https://player.vimeo.com https://www.youtube-nocookie.com https://toot.community;frame-ancestors 'none';base-uri 'none';form-action 'none';connect-src 'self' https://toot.community;script-src 'self' 'self'" http-equiv=content-security-policy><title>File System - PowerShell Commands / RuDocs</title><link href=https://lifailon.github.io/filesystem/ rel=canonical><link href=https://lifailon.github.io/favicon.png rel=icon type=image/png><link href=https://lifailon.github.io/apple-touch-icon.png rel=apple-touch-icon sizes=180x180 type=image/png><link title="PowerShell Commands / RuDocs - RSS Feed" href=https://lifailon.github.io/rss.xml rel=alternate type=application/rss+xml><link title="PowerShell Commands / RuDocs - Atom Feed" href=https://lifailon.github.io/atom.xml rel=alternate type=application/atom+xml><style>:root{--accent-color:#ff7800;--contrast-color:#000c}[data-theme=dark]{--accent-color:#ffa348}@media (prefers-color-scheme:dark){:root:not([data-theme=light]){--accent-color:#ffa348}}[data-theme=dark]{--contrast-color:#000c}@media (prefers-color-scheme:dark){:root:not([data-theme=light]){--contrast-color:#000c}}</style><link href=https://lifailon.github.io/style.css rel=stylesheet><link media="(prefers-color-scheme: light)" href=https://lifailon.github.io/syntax-theme-light.css rel=stylesheet><link media="(prefers-color-scheme: dark)" href=https://lifailon.github.io/syntax-theme-dark.css rel=stylesheet><script defer src=https://lifailon.github.io/closable.js></script><script defer src=https://lifailon.github.io/copy-button.js></script><script defer src=https://lifailon.github.io/elasticlunr.min.js></script><script defer src=https://lifailon.github.io/search-elasticlunr.js></script><script defer src=https://lifailon.github.io/theme-switcher.js></script><meta content="PowerShell Commands / RuDocs" property=og:site_name><meta content="File System - PowerShell Commands / RuDocs" property=og:title><meta content=https://lifailon.github.io/filesystem/ property=og:url><meta content="Web version for PowerShell notes in Russian language (Сheat Sheet & Documentation) and RuDocs (node.js)" property=og:description><meta content=https://lifailon.github.io/card.png property=og:image><meta content=en_US property=og:locale><body><div id=handle></div><header id=site-nav><nav><a href=#main-content tabindex=0> Skip to Main Content </a><ul><li id=home><a href=https://lifailon.github.io> <i class=icon></i>PowerShell Commands / RuDocs</a><li class=divider><li><details class=closable><summary>PowerShell</summary> <ul><li><a href=https://lifailon.github.io/syntax/>PowerShell Syntax</a><li><a class=active href=https://lifailon.github.io/filesystem/>File System</a><li><a href=https://lifailon.github.io/windows/>Operating System</a><li><a href=https://lifailon.github.io/network/>Network</a><li><a href=https://lifailon.github.io/threads/>Threads</a><li><a href=https://lifailon.github.io/modules/>Modules</a><li><a href=https://lifailon.github.io/dotnet/>dotNET</a><li><a href=https://lifailon.github.io/com/>COM</a><li><a href=https://lifailon.github.io/servermanager/>Server Manager</a><li><a href=https://lifailon.github.io/activedirectory/>Active Directory</a><li><a href=https://lifailon.github.io/exchange/>Exchange</a><li><a href=https://lifailon.github.io/virtualization/>Virtualization</a><li><a href=https://lifailon.github.io/database/>Database</a><li><a href=https://lifailon.github.io/markuplanguages/>Markup Languages</a><li><a href=https://lifailon.github.io/api/>API</a><li><a href=https://lifailon.github.io/zabbix/>Zabbix</a><li><a href=https://lifailon.github.io/devops/>DevOps</a></ul></details><li><a href=https://lifailon.github.io/node-js/>Node.js</a><li><a href=https://lifailon.github.io/linux/>Linux</a><li><a href=https://lifailon.github.io/docker/>Docker</a><li id=search><button class=circle id=search-toggle title=Search><i class=icon></i></button><li id=theme-switcher><details class=closable><summary class=circle title=Theme><i class=icon></i></summary> <ul><li><button title="Switch to Light Theme" class=circle id=theme-light><i class=icon></i></button><li><button title="Switch to Dark Theme" class=circle id=theme-dark><i class=icon></i></button><li><button title="Use System Theme" class=circle id=theme-system><i class=icon></i></button></ul></details><li id=repo><a class=circle href=https://github.com/Lifailon/PS-Commands title=Repository> <i class=icon></i> </a></ul></nav><div id=search-container><label class=visually-hidden for=search-bar>Search</label><input placeholder="Search for…" autocomplete=off disabled id=search-bar type=search><div id=search-results-container><div id=search-results></div></div></div></header><main id=main-content><h1>File System</h1><h3 id=items><a aria-label="Anchor link for: items" class=zola-anchor href=#items><i class=icon></i></a> Items</h3><p><code>Get-Content $home/desktop\test.txt -Wait</code> аналог tail<br> <code>Test-Path $path</code> проверить доступность пути<br> <code>Get-FileHash -Algorithm SHA256 "$path"</code> узнать хэш файла по алгоритму sha256<br> <code>Get-ChildItem $path -Filter *.txt -Recurse</code> отобразить содержимое каталога (Alias: ls/gci/dir) и дочерних каталогов (-Recurse) и отфильтровать вывод<br> <code>Get-Location</code> отобразить текущие месторасположение (Alias: pwd/gl)<br> <code>Set-Location $path</code> перемещение по каталогам (Alias: cd/sl)<br> <code>Invoke-Item $path</code> открыть файл (Alias: ii/start)<br> <code>Get-ItemProperty $env:userprofile\Documents\dns-list.txt | select FullName,Directory,Name,BaseName,Extension</code> свойтсва файла<br> <code>Get-ItemProperty -Path $path\* | select FullName,CreationTime,LastWriteTime</code> свойства файлов содержимого директории, дата их создания и последнего изменения<br> <code>New-Item -Path "C:\test\" -ItemType "Directory"</code> создать директорию (Alias: mkdir/md)<br> <code>New-Item -Path "C:\test\file.txt" -ItemType "File" -Value "Добавить текст в файл"</code> создать файл<br> <code>"test" > "C:\test\file.txt"</code> заменить содержимое<br> <code>"test" >> "C:\test\file.txt"</code> добавить строку в файл<br> <code>New-Item -Path "C:\test\test\file.txt" -Force</code> ключ используется для создания отсутствующих в пути директорий или перезаписи файла если он уже существует<br> <code>Move-Item</code> перемещение объектов (Alias: mv/move)<br> <code>Remove-Item "$path\" -Recurse</code> удаление всех файлов внутри каталога, без запроса подверждения (Alias: rm/del)<br> <code>Remove-Item $path -Recurse -Include "*.txt","*.temp" -Exclude "log.txt"</code> удалить все файлы с расширением txt и temp ([Array]), кроме log.txt<br> <code>Rename-Item "C:\test\*.*" "*.jpg"</code> переименовать файлы по маске (Alias: ren)<br> <code>Copy-Item</code> копирование файлов и каталогов (Alias: cp/copy)<br> <code>Copy-Item -Path "\\server-01\test" -Destination "C:\" -Recurse</code> копировать директорию с ее содержимым (-Recurse)<br> <code>Copy-Item -Path "C:\*.txt" -Destination "C:\test\"</code> знак ’' в конце Destination используется для переноса папки внутрь указанной, отсутствие, что это новое имя директории<br> <code>Copy-Item -Path "C:\*" -Destination "C:\test\" -Include '*.txt','*.jpg'</code> копировать объекты с указанным расширением (Include)<br> <code>Copy-Item -Path "C:\*" -Destination "C:\test\" -Exclude '*.jpeg'</code> копировать объекты, за исключением файлов с расширением (Exclude)<br> <code>$log = Copy-Item "C:\*.txt" "C:\test\" -PassThru</code> вывести результат копирования (логирование) в переменную, можно забирать строки с помощью индексов $log[0].FullName<br> <code>Unblock-File "script.ps1"</code> разблокирует файлы скриптов PowerShell скачанных из Интернета, чтобы их можно было запустить, даже если политика выполнения PowerShell в режиме RemoteSigned<h3 id=clear-env-temp-14-days><a aria-label="Anchor link for: clear-env-temp-14-days" class=zola-anchor href=#clear-env-temp-14-days><i class=icon></i></a> Clear-env-Temp-14-days</h3><pre class="language-powershell z-code" data-lang=powershell><code class=language-powershell data-lang=powershell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>ls</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">Get-Item</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-support z-variable z-drive z-powershell">env:</span>TEMP</span>\<span class="z-keyword z-operator z-assignment z-powershell">*</span>.tmp <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> считать все файлы с указанным расширением<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>date</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">Get-Date</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.AddDays<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-constant z-numeric z-integer z-powershell">-14</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">foreach</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>l</span> <span class="z-keyword z-control z-powershell">in</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>ls</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-keyword z-control z-powershell">if</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>l<span class="z-variable z-other z-member z-powershell">.LastWriteTime</span></span> <span class="z-keyword z-operator z-comparison z-powershell">-le</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>date</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>l<span class="z-variable z-other z-member z-powershell">.FullName</span></span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-support z-function z-powershell">Remove-Item</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>l<span class="z-variable z-other z-member z-powershell">.FullName</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Recurse
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></code></pre><h3 id=system-io-file><a aria-label="Anchor link for: system-io-file" class=zola-anchor href=#system-io-file><i class=icon></i></a> System.IO.File</h3><p><code>$file = [System.IO.File]::Create("$home\desktop\test.txt")</code> создать файл<br> <code>$file.Close()</code> закрыть файл<br> <code>[System.IO.File]::ReadAllLines("$home\desktop\test.txt")</code> прочитать файл<br> <code>$file = New-Object System.IO.StreamReader("$home\desktop\test.txt")</code> файл будет занят процессом PowerShell<br> <code>$file | Get-Member</code><br> <code>$file.ReadLine()</code> построчный вывод<br> <code>$file.ReadToEnd()</code> прочитать файл целиком<h3 id=read-write-bytes><a aria-label="Anchor link for: read-write-bytes" class=zola-anchor href=#read-write-bytes><i class=icon></i></a> Read/Write Bytes</h3><p><code>$file = [io.file]::ReadAllBytes("$home\desktop\powershell.jpg")</code> метод открывает двоичный файл, считывает его в массив байт и закрывает файл<br> <code>[io.file]::WriteAllBytes("$home\desktop\tloztotk-2.jpg",$file)</code> сохранить байты в файл (можно использовать для выгрузки двоичных файлов из БД)<h2 id=archive><a aria-label="Anchor link for: archive" class=zola-anchor href=#archive><i class=icon></i></a> Archive</h2><h3 id=microsoft-powershell-archive><a aria-label="Anchor link for: microsoft-powershell-archive" class=zola-anchor href=#microsoft-powershell-archive><i class=icon></i></a> Microsoft.PowerShell.Archive</h3><p><code>Compress-Archive -Path $srcPath -DestinationPath "$($srcPath).zip" -CompressionLevel Optimal</code> архивировать (по исходному пути и названию с добавлением расширения)<br> <code>Expand-Archive -Path $zip</code> разархивировать<br> <code>Expand-Archive -Path $zip -DestinationPath $dstPath</code> указать путь извлечения<br> <code>Expand-Archive -Path $zip -OutputPath $dstPath</code><h3 id=system-io-compression-filesystem><a aria-label="Anchor link for: system-io-compression-filesystem" class=zola-anchor href=#system-io-compression-filesystem><i class=icon></i></a> System.IO.Compression.FileSystem</h3><pre class="language-powershell z-code" data-lang=powershell><code class=language-powershell data-lang=powershell><span class="z-source z-powershell"><span class="z-meta z-function z-powershell"><span class="z-storage z-type z-powershell">function</span> <span class="z-entity z-name z-function z-powershell">Expand-ArchiveFile</span></span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-keyword z-control z-powershell">param</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-interpolated z-simple z-source z-powershell">        <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Путь к архиву<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-interpolated z-simple z-source z-powershell">        <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Path</span><span class="z-keyword z-operator z-other z-powershell">,</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-interpolated z-simple z-source z-powershell">        <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Путь, куда извлечь файл<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-interpolated z-simple z-source z-powershell">        <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>DestinationPath</span><span class="z-keyword z-operator z-other z-powershell">,</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-interpolated z-simple z-source z-powershell">        <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Имя файла, который нужно извлечь<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-interpolated z-simple z-source z-powershell">        <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>FileName</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-interpolated z-simple z-source z-powershell">    </span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-support z-function z-powershell">Add-Type</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>AssemblyName System.IO.Compression.FileSystem
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-keyword z-control z-powershell">try</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Открыть архив для чтения<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>zipArchive</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">System.IO.Compression.ZipFile</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::OpenRead<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Path</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Найти файл в архиве<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>fileEntry</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>zipArchive<span class="z-variable z-other z-member z-powershell">.Entries</span></span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-support z-function z-powershell">Where-Object</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span> <span class="z-support z-variable z-automatic z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>_<span class="z-variable z-other z-member z-powershell">.FullName</span></span> <span class="z-keyword z-operator z-comparison z-powershell">-eq</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>fileName</span> <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-keyword z-control z-powershell">if</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>fileEntry</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">            <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Создание потока для чтения содержимого файла<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">            <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>stream</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>fileEntry<span class="z-variable z-other z-member z-powershell">.Open</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">            <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Создание файла и запись в него данных из потока<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">            <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>DestinationPathFileName</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>DestinationPath</span>\<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>FileName</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">            <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>fileStream</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">System.IO.File</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::Create<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>DestinationPathFileName</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">            <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>stream<span class="z-variable z-other z-member z-powershell">.CopyTo</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>fileStream</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">            <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Закрытие потоков<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">            <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>stream<span class="z-variable z-other z-member z-powershell">.Close</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">            <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>fileStream<span class="z-variable z-other z-member z-powershell">.Close</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span> <span class="z-keyword z-control z-powershell">else</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">            <span class="z-support z-function z-powershell">Write-Output</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Файл <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>fileName</span> не найден в архиве<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span> <span class="z-keyword z-control z-powershell">catch</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-support z-function z-powershell">Write-Error</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Ошибка при извлечении файла из архива<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span> <span class="z-keyword z-control z-powershell">finally</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Закрыть архив<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>zipArchive<span class="z-variable z-other z-member z-powershell">.Dispose</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></code></pre><h3 id=winrar><a aria-label="Anchor link for: winrar" class=zola-anchor href=#winrar><i class=icon></i></a> WinRAR</h3><pre class="language-powershell z-code" data-lang=powershell><code class=language-powershell data-lang=powershell><span class="z-source z-powershell"><span class="z-meta z-function z-powershell"><span class="z-storage z-type z-powershell">function</span> <span class="z-entity z-name z-function z-powershell">Expand-ArchivePassword</span></span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-keyword z-control z-powershell">param</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-interpolated z-simple z-source z-powershell">        <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Path</span><span class="z-keyword z-operator z-other z-powershell">,</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-interpolated z-simple z-source z-powershell">        <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Password</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-interpolated z-simple z-source z-powershell">    </span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>winrar</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span>  <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>C:\Program Files\WinRAR\WinRAR.exe<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-keyword z-operator z-other z-powershell">&</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>winrar</span> x <span class="z-keyword z-operator z-assignment z-powershell">-</span>p<span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Password</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Path</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></code></pre><p><code>cd "$home\Downloads"</code><br> <code>Expand-ArchivePassword archive.rar qwe123</code><h2 id=handles><a aria-label="Anchor link for: handles" class=zola-anchor href=#handles><i class=icon></i></a> Handles</h2><p><code>$url = "https://download.sysinternals.com/files/Handle.zip"</code><br> <code>Invoke-RestMethod $url -OutFile "$env:TEMP\handle.zip"</code><br> <code>Expand-ArchiveFile -Path "$env:TEMP\handle.zip" -DestinationPath "$home\Documents" -FileName "handle.exe"</code> извлекаем выбранный файл из архива<br> <code>Remove-Item "$env:TEMP\handle.zip"</code><br> <code>$handle = "$home\Documents\handle.exe"</code><br> <code>$test = New-Object System.IO.StreamReader("$home\desktop\test.txt")</code> занять файл текущим процессом pwsh ($pid) <code>$SearchProcess = & \$handle  "C:</code>\Users<code>{=tex}</code>\Lifailon<code>{=tex}</code>\Desktop<code>{=tex}</code>\test<code>{=tex}.txt"  -nobanner -u -v \|  ConvertFrom-Csv</code>вывести список дескрипторов по пути к файлу (имя процесса, его PID и пользователь который запустил)<code>Stop-Process  \$SearchProcess.PID\</code> завершить процесс, который удерживал файл<h2 id=pseverything><a aria-label="Anchor link for: pseverything" class=zola-anchor href=#pseverything><i class=icon></i></a> PSEverything</h2><p><code>Install-Module PSEverything -Repository NuGet</code><br> <code>Find-Everything pingui</code> найти все файлы в системе (на всех локальных дисках) с именем <em>pingui</em> через dll csharp версии Everything (по умолчанию)<br> <code>Find-Everything pingui-0.1.py | Format-List</code><br> <code>Find-Everything pingui -es</code> использовать cli версию Everything для поиска (при первом использовании версии, необходимо дождаться автоматической установки файлов зависимостей)<br> <code>Find-Everything pingui-0.1 -ComputerName localhost</code> поиск на удаленном компьютере через REST API, если запущен HTTP-сервер Everything<h2 id=console-menu><a aria-label="Anchor link for: console-menu" class=zola-anchor href=#console-menu><i class=icon></i></a> Console-Menu</h2><pre class="language-powershell z-code" data-lang=powershell><code class=language-powershell data-lang=powershell><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Импортируем модуль PS-Menu в текущую сессию из репозитория GitHub<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>module</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>https://raw.githubusercontent.com/chrisseroka/ps-menu/master/ps-menu.psm1<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Invoke-Expression</span> <span class="z-meta z-group z-complex z-subexpression z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>module</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span>
</span></code></pre><p>Пример навигации по директориям в системе используя меню:<pre class="language-powershell z-code" data-lang=powershell><code class=language-powershell data-lang=powershell><span class="z-source z-powershell"><span class="z-meta z-function z-powershell"><span class="z-storage z-type z-powershell">function</span> <span class="z-entity z-name z-function z-powershell">ls-menu</span></span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-keyword z-control z-powershell">param</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-interpolated z-simple z-source z-powershell">        <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>startDir</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>C:\<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-interpolated z-simple z-source z-powershell">    </span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    clear
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Проверяем, что мы не находимся в root директории (исключить возврат назад)<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-keyword z-control z-powershell">if</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">System.IO.Path</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::GetPathRoot<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>startDir</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-keyword z-operator z-comparison z-powershell">-eq</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>startDir</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>select</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> menu <span class="z-meta z-group z-array-expression z-powershell"><span class="z-keyword z-other z-array z-begin z-powershell">@</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-group z-array-expression z-powershell">            <span class="z-meta z-group z-array-expression z-powershell"><span class="z-keyword z-other z-array z-begin z-powershell">@</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-meta z-group z-complex z-subexpression z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-support z-function z-powershell">Get-ChildItem</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>startDir</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span>.name<span class="z-punctuation z-section z-group z-end z-powershell">)</span></span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-group z-array-expression z-powershell">        <span class="z-punctuation z-section z-group z-end z-powershell">)</span></span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-keyword z-control z-powershell">else</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>select</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> menu <span class="z-meta z-group z-array-expression z-powershell"><span class="z-keyword z-other z-array z-begin z-powershell">@</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-group z-array-expression z-powershell">            <span class="z-meta z-group z-array-expression z-powershell"><span class="z-keyword z-other z-array z-begin z-powershell">@</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>..<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span><span class="z-keyword z-operator z-assignment z-powershell">+</span><span class="z-meta z-group z-array-expression z-powershell"><span class="z-keyword z-other z-array z-begin z-powershell">@</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-meta z-group z-complex z-subexpression z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-support z-function z-powershell">Get-ChildItem</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>startDir</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span>.name<span class="z-punctuation z-section z-group z-end z-powershell">)</span></span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-group z-array-expression z-powershell">        <span class="z-punctuation z-section z-group z-end z-powershell">)</span></span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Если выбрали возврат назад, то забираем только путь у стартовой директории<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-keyword z-control z-powershell">if</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>select</span> <span class="z-keyword z-operator z-comparison z-powershell">-eq</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>..<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>backPath</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">System.IO.Path</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::GetDirectoryName<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>startDir</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        ls<span class="z-keyword z-operator z-assignment z-powershell">-</span>menu <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>backPath</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-keyword z-control z-powershell">else</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Проверяем, что выбрали директорию<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-keyword z-control z-powershell">if</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-meta z-group z-complex z-subexpression z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-support z-function z-powershell">Test-Path</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>startDir</span>\<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>select</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>PathType Container<span class="z-punctuation z-section z-group z-end z-powershell">)</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">            <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Если выбрали директорию, к стартовому пути добавляем выбранное имя директории<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">            ls<span class="z-keyword z-operator z-assignment z-powershell">-</span>menu <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>startDir</span>\<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>select</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-keyword z-control z-powershell">else</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">            ls<span class="z-keyword z-operator z-assignment z-powershell">-</span>menu <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>startDir</span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></code></pre><p><code>ls-menu</code><br> <code>ls-menu $home</code><br> <code>ls-menu "D:\"</code><h2 id=smb><a aria-label="Anchor link for: smb" class=zola-anchor href=#smb><i class=icon></i></a> SMB</h2><p><code>Get-SmbServerConfiguration</code><br> <code>Set-SmbServerConfiguration -EnableSMB1Protocol $false -Force</code> отключить протокол SMB v1<br> <code>Get-WindowsFeature | Where-Object {$_.name -eq "FS-SMB1"} | ft Name,Installstate</code> модуль ServerManager, проверить установлен ли компонент SMB1<br> <code>Install-WindowsFeature FS-SMB1</code> установить SMB1<br> <code>Uninstall-WindowsFeature –Name FS-SMB1 –Remove</code> удалить SMB1 клиента (понадобится перезагрузка)<br> <code>Get-WindowsOptionalFeature -Online</code> модуль DISM, для работы с компонентами Windows<br> <code>Disable-WindowsOptionalFeature -Online -FeatureName SMB1Protocol -Remove</code> удалить SMB1<br> <code>Set-SmbServerConfiguration –AuditSmb1Access $true</code> включить аудит SMB1<br> <code>Get-SmbConnection</code> список активных сессий и используемая версия SMB (Dialect)<br> <code>Get-SmbOpenFile | select ClientUserName,ClientComputerName,Path,SessionID</code> список открытых файлов<br> <code>Get-SmbShare</code> список сетевых папок<br> <code>New-SmbShare -Name xl-share -Path E:\test</code> создать новую общую сетевую папку (расшарить)<br> <code>-EncryptData $True</code> включить шифрование SMB<br> <code>-Description</code> имя в сетевом окружении<br> <code>-ReadAccess "domain\username"</code> доступ на чтение<br> <code>-ChangeAccess</code> доступ на запись<br> <code>-FullAccess</code> полный доступ<br> <code>-NoAccess ALL</code> нет прав<br> <code>-FolderEnumerationMode [AccessBased | Unrestricted]</code> позволяет скрыть в сетевой папке объекты, на которых у пользователя нет доступа с помощью Access-Based Enumeration (ABE)<br> <code>Get-SmbShare xl-share | Set-SmbShare -FolderEnumerationMode AccessBased</code> ключить ABE для всех расшаренных папок<br> <code>Remove-SmbShare xl-share -force</code> удалить сетевой доступ (шару)<br> <code>Get-SmbShareAccess xl-share</code> вывести список доступов безопасности к шаре<br> <code>Revoke-SmbShareAccess xl-share -AccountName Everyone –Force</code> удалить группу из списка доступов<br> <code>Grant-SmbShareAccess -Name xl-share -AccountName "domain\XL-Share" -AccessRight Change –force</code> изменить/добавить разрешения на запись (Full,Read)<br> <code>Grant-SmbShareAccess -Name xl-share -AccountName "все" -AccessRight Change –force</code><br> <code>Block-SmbShareAccess -Name xl-share -AccountName "domain\noAccess" -Force</code> принудительный запрет<br> <code>New-SmbMapping -LocalPath X: -RemotePath \\$srv\xl-share -UserName support4 -Password password –Persistent $true</code> подключить сетевой диск<br> <code>-Persistent</code> восстановление соединения после отключения компьютера или сети<br> <code>-SaveCredential</code> позволяет сохранить учетные данные пользователя для подключения в диспетчер учетных данных Windows Credential Manager<br> <code>Stop-Process -Name "explorer" | Start-Process -FilePath "C:\Windows\explorer.exe"</code> перезапустить процесс для отображения в проводнике<br> <code>Get-SmbMapping</code> список подключенных сетевых дисков<br> <code>Remove-SmbMapping X: -force</code> отмонтировать сетевой диск<br> <code>$CIMSession = New-CIMSession –Computername $srv</code> создать сеанс CIM (аудентификация на SMB)<br> <code>Get-SmbOpenFile -CIMSession $CIMSession | select ClientUserName,ClientComputerName,Path | Out-GridView -PassThru | Close-SmbOpenFile -CIMSession $CIMSession -Confirm:$false –Force</code> закрыть файлы (открыть к ним сетевой доступ)<h2 id=acl><a aria-label="Anchor link for: acl" class=zola-anchor href=#acl><i class=icon></i></a> ACL</h2><p><code>(Get-Acl \\$srv\xl-share).access</code> доступ ACL на уровне NTFS<br> <code>Get-Acl C:\Drivers | Set-Acl C:\Distr</code> скопировать NTFS разрешения с одной папки и применить их на другую<h2 id=ntfs><a aria-label="Anchor link for: ntfs" class=zola-anchor href=#ntfs><i class=icon></i></a> NTFS</h2><p><code>Install-Module -Name NTFSSecurity -force</code><br> <code>Get-Item "\\$srv\xl-share" | Get-NTFSAccess</code><br> <code>Add-NTFSAccess -Path "\\$srv\xl-share" -Account "domain\xl-share" -AccessRights Fullcontrol -PassThru</code> добавить<br> <code>Remove-NTFSAccess -Path "\\$srv\xl-share" -Account "domain\xl-share" -AccessRights FullControl -PassThru</code> удалить<br> <code>Get-ChildItem -Path "\\$srv\xl-share" -Recurse -Force | Clear-NTFSAccess</code> удалить все разрешения, без удаления унаследованных разрешений<br> <code>Get-ChildItem -Path "\\$srv\xl-share" -Recurse -Force | Enable-NTFSAccessInheritance</code> включить NTFS наследование для всех объектов в каталоге<h2 id=storage><a aria-label="Anchor link for: storage" class=zola-anchor href=#storage><i class=icon></i></a> Storage</h2><p><code>Get-Command -Module Storage</code><br> <code>Get-Disk</code> список логических дисков<br> <code>Get-Partition</code> отобразить разделы на всех дисках<br> <code>Get-Volume</code> список логичких разделов<br> <code>Get-PhysicalDisk</code> список физических дисков<br> <code>Initialize-Disk 1 –PartitionStyle MBR</code> инициализировать диск<br> <code>New-Partition -DriveLetter D –DiskNumber 1 -Size 500gb</code> создать раздел (выделить все место -UseMaximumSize)<br> <code>Format-Volume -DriveLetter D -FileSystem NTFS -NewFileSystemLabel Disk-D</code> форматировать раздел<br> <code>Set-Partition -DriveLetter D -IsActive $True</code> сделать активным<br> <code>Remove-Partition -DriveLetter D –DiskNumber 1</code> удалить раздел<br> <code>Clear-Disk -Number 1 -RemoveData</code> очистить диск<br> <code>Repair-Volume –driveletter C –Scan</code> Check disk<br> <code>Repair-Volume –driveletter C –SpotFix</code><br> <code>Repair-Volume –driverletter C -Scan –Cimsession $CIMSession</code><h2 id=iscsi><a aria-label="Anchor link for: iscsi" class=zola-anchor href=#iscsi><i class=icon></i></a> iSCSI</h2><p><code>New-IscsiVirtualDisk -Path D:\iSCSIVirtualDisks\iSCSI2.vhdx -Size 20GB</code> создать динамический vhdx-диск (для фиксированного размера -UseFixed)<br> <code>New-IscsiServerTarget -TargetName iscsi-target-2 -InitiatorIds "IQN:iqn.1991-05.com.microsoft:srv3.contoso.com"</code> создать Target<br> <code>Get-IscsiServerTarget | fl TargetName, LunMappings</code><br> <code>Connect-IscsiTarget -NodeAddress "iqn.1995-05.com.microsoft:srv2-iscsi-target-2-target" -IsPersistent $true</code> подключиться инициатором к таргету<br> <code>Get-IscsiTarget | fl</code><br> <code>Disconnect-IscsiTarget -NodeAddress "iqn.1995-05.com.microsoft:srv2-iscsi-target-2-target" -Confirm:$false</code> отключиться<h2 id=base64><a aria-label="Anchor link for: base64" class=zola-anchor href=#base64><i class=icon></i></a> Base64</h2><h3 id=utf8><a aria-label="Anchor link for: utf8" class=zola-anchor href=#utf8><i class=icon></i></a> UTF8</h3><p><code>$loginPassword = "login:password"</code><br> <code>$Base64 = [Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes($loginPassword))</code> закодировать логин и пароль в строку Base64<br> <code>[System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String($Base64))</code> преобразовать в байты и обратно декодировать в исходную строку с помощью UTF-8 кодировки<h3 id=unicode><a aria-label="Anchor link for: unicode" class=zola-anchor href=#unicode><i class=icon></i></a> Unicode</h3><pre class="language-powershell z-code" data-lang=powershell><code class=language-powershell data-lang=powershell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>text</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>password<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>byte</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">System.Text.Encoding</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::Unicode.GetBytes<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>text</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> преобразует строку $text в последовательность байтов, используя кодировку Unicode<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>base64</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">System.Convert</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::ToBase64String<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>byte</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> байты конвертируются в строку Base64 с помощью метода ToBase64String<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>decode_base64</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">System.Convert</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::FromBase64String<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>base64</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> декодировать строку Base64 обратно в последовательность байтов с помощью метода FromBase64String<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>decode_string</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">System.Text.Encoding</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::Unicode.GetString<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>decode_base64</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> закодированные байты преобразуются обратно в строку с использованием кодировки Unicode с помощью метода GetString<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></code></pre><h3 id=image><a aria-label="Anchor link for: image" class=zola-anchor href=#image><i class=icon></i></a> Image</h3><pre class="language-powershell z-code" data-lang=powershell><code class=language-powershell data-lang=powershell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path_image</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Documents\1200x800.jpg<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>BBase64</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">System.Convert</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::ToBase64String<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">Get-Content</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path_image</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Encoding Byte</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Add-Type</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>assembly System.Drawing
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Image</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">System.Drawing.Bitmap</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::FromStream<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">IO.MemoryStream</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span><span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">Convert</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::FromBase64String<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>BBase64</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Image<span class="z-variable z-other z-member z-powershell">.Save</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Desktop\1200x800.jpg<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></code></pre><h2 id=veeam><a aria-label="Anchor link for: veeam" class=zola-anchor href=#veeam><i class=icon></i></a> Veeam</h2><p>VeeamHub (https://github.com/VeeamHub/powershell)<h3 id=get-vbrcommand><a aria-label="Anchor link for: get-vbrcommand" class=zola-anchor href=#get-vbrcommand><i class=icon></i></a> Get-VBRCommand</h3><p><code>Set-ExecutionPolicy AllSigned</code><br> <code>Set-ExecutionPolicy Bypass -Scope Process -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))</code> установить choco<br> <code>choco install veeam-backup-and-replication-console</code> установить консоль управления (https://community.chocolatey.org/packages/veeam-backup-and-replication-console)<br> <code>Get-Module Veeam.Backup.PowerShell</code> модуль, который устанавливается вместе с клиентской консолью по умолчанию<br> <code>Get-Command -Module Veeam.Backup.PowerShell</code><br> <code>Get-Command -Module Get-VBRCommand</code><br> <code>Connect-VBRServer -Server $srv -Credential $cred -Port 9392</code><br> <code>Get-VBRJob</code><br> <code>Get-VBRCommand *get*backup*</code><br> <code>Get-VBRComputerBackupJob</code><br> <code>Get-VBRBackup</code><br> <code>Get-VBRBackupRepository</code><br> <code>Get-VBRBackupSession</code><br> <code>Get-VBRBackupServerCertificate</code><br> <code>Get-VBRRestorePoint</code><br> <code>Get-VBRViProxy</code><h3 id=veeam-restat><a aria-label="Anchor link for: veeam-restat" class=zola-anchor href=#veeam-restat><i class=icon></i></a> Veeam-REStat</h3><pre class="language-powershell z-code" data-lang=powershell><code class=language-powershell data-lang=powershell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-support z-variable z-drive z-powershell">env:</span>PSModulePath<span class="z-variable z-other z-member z-powershell">.Split</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>;<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span><span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-constant z-numeric z-integer z-powershell">0</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span><span class="z-keyword z-operator z-assignment z-powershell">+</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>\Veeam-REStat\Veeam-REStat.psm1<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">if</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-keyword z-operator z-unary z-powershell">!</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">Test-Path</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-support z-function z-powershell">New-Item</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>ItemType <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>File<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Force
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-meta z-group z-complex z-subexpression z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span>iwr https:<span class="z-keyword z-operator z-assignment z-powershell">/</span><span class="z-keyword z-operator z-assignment z-powershell">/</span><span class="z-support z-function z-powershell">raw.githubusercontent.com</span><span class="z-keyword z-operator z-assignment z-powershell">/</span>Lifailon<span class="z-keyword z-operator z-assignment z-powershell">/</span>Veeam<span class="z-keyword z-operator z-assignment z-powershell">-</span>REStat<span class="z-keyword z-operator z-assignment z-powershell">/</span>rsa<span class="z-keyword z-operator z-assignment z-powershell">/</span>Veeam<span class="z-keyword z-operator z-assignment z-powershell">-</span>REStat<span class="z-keyword z-operator z-assignment z-powershell">/</span>Veeam<span class="z-keyword z-operator z-assignment z-powershell">-</span>REStat.psm1<span class="z-punctuation z-section z-group z-end z-powershell">)</span></span>.Content <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-support z-function z-powershell">Out-File</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Force
</span></code></pre><p><code>Veeam-REStat -Server srv-veeam-11 -Port 9419</code> при первом запуске необходимо заполнить Credential для подключения к экземпляру сервера VBR, которые сохраняются в файл с именем сервера в формате xml с применением шифрования PSCredential для последующего подключения<br> <code>Veeam-REStat -Reset</code> сброс учетных данных для подключения к серверу VBR<br> <code>Veeam-REStat -Statistic</code> статистика всех заданий с сортировкой по дате (выводит время начала, завершения и статус работы, процент прогресса, результат выполнений и сообщение с причиной в случае ошибки: Warning или Failed)<br> <code>Veeam-REStat -Jobs</code> подробная статистика по всем настроенным заданиям резеврного копирования: статус работы (In Active/disabled), результат последнего задания (LastResult), тип аутентификации (Standard/Linux), имя и размер виртуальной машины, тип резервного копирования (например, Incremental), дату и время последнего и следущего выполнения<br> <code>Veeam-REStat -ConfigBackup</code> отображает статус состояния работы резервного копирования конфигурации сервера VBR, кол-во точек восстановления, дату и время последней копии<br> <code>Veeam-REStat -Repositories</code> статистика по инвентарным данным репозиториев: тип хранилища, путь на сервере до директории хранения, общий (capacityGB), свободный (freeGB) и используемый (usedSpaceGB) размер диска под данные<br> <code>Veeam-REStat -Backup</code> список заданий резервного копирования, тип копирования (VM/Directory) и кол-во точек восстановления<br> <code>Veeam-REStat -Points</code> история статистики всех точек восстановления с датой создания<br> <code>Veeam-REStat -Hosts</code> список физически (в ручную) добавленных хостов в инфраструктуру VBR<br> <code>Veeam-REStat -Proxy</code> список серверов с ролью Proxy<br> <code>Veeam-REStat -Users</code> список УЗ, добавленных для подключения к серверам<br> <code>Veeam-REStat -Service</code> выводит информацию о связанных внутренних службах, подключение к этим службам может потребоваться только для интеграции с VBR<h2 id=nas><a aria-label="Anchor link for: nas" class=zola-anchor href=#nas><i class=icon></i></a> NAS</h2><h3 id=truenas><a aria-label="Anchor link for: truenas" class=zola-anchor href=#truenas><i class=icon></i></a> TrueNAS</h3><p><a href=https://github.com/PowerTrueNas/TrueNas>PowerTrueNas</a><p><code>Install-Module TrueNas</code><br> <code>Import-Module TrueNas</code><br> <code>$(Get-Module TrueNas).ExportedCommands</code><br> <code>Connect-TrueNasServer -Server tnas-01 -SkipCertificateCheck</code><br> <code>Get-TrueNasCertificate</code> настройки сертификата<br> <code>Get-TrueNasSetting</code> настройки языка, time zone, syslog level и server, https port<br> <code>Get-TrueNasUser</code> список пользователей<br> <code>Get-TrueNasSystemVersion</code> характеристики (Physical Memory, Model, Cores) и Uptime<br> <code>Get-TrueNasSystemAlert</code> snmp для оповещений<br> <code>Get-TrueNasSystemNTP</code> список используемых NTP серверов<br> <code>Get-TrueNasDisk</code> список разделов физического диска<br> <code>Get-TrueNasInterface</code> сетевые интерфейсы<br> <code>Get-TrueNasGlobalConfig</code> сетевые настройки<br> <code>Get-TrueNasDnsServer</code> настроенные DNS-сервера<br> <code>Get-TrueNasIscsiTarget</code> отобразить ID группы инициаторов использующих таргет, используемый portal, authentification и authen-method<br> <code>Get-TrueNasIscsiInitiator</code> отобразить группы инициаторов<br> <code>Get-TrueNasIscsiPortal</code> слушатель (Listen) и порт<br> <code>Get-TrueNasIscsiExtent</code> список ISCSi Target (статус работы, путь)<br> <code>Get-TrueNasPool</code> список pool (Id, Path, Status, Healthy)<br> <code>Get-TrueNasVolume -Type FILESYSTEM</code> список pool файловых систем<br> <code>Get-TrueNasVolume -Type VOLUME</code> список разделов в pool и их размер<br> <code>Get-TrueNasService | ft</code> список служб и их статус<br> <code>Start-TrueNasService ssh</code> запустить службу<br> <code>Stop-TrueNasService ssh</code> остановить службу<h3 id=synology><a aria-label="Anchor link for: synology" class=zola-anchor href=#synology><i class=icon></i></a> Synology</h3><p><a href=https://github.com/pspete/pSynology>pSynology</a><p><code>New-SYNOSession</code> аутентификация на Synology Diskstation и запуск нового сеанса API<br> <code>Close-SYNOSession</code> выход из сеанса API<br> <code>Get-SYNOInfo</code> получить информацию об API DiskStation<br> <code>Add-SYNOFSFAvorite</code> добавить папку в избранное пользователя<br> <code>Add-SYNOFSFile</code> загрузить файл<br> <code>Clear-SYNOFSBackgroundTask</code> удалить все завершенные фоновые задачи<br> <code>Clear-SYNOFSFavoriteStatus</code> удалить все избранное с неработающим статусом<br> <code>Clear-SYNOFSSharingLink</code> удалить все просроченные и неработающие ссылки для обмена<br> <code>Get-SYNOFSArchiveCompress</code> получить статус задачи сжатия<br> <code>Get-SYNOFSArchiveContent</code> вывести содержимое архива<br> <code>Get-SYNOFSArchiveExtract</code> получить статус задачи извлечения<br> <code>Get-SYNOFSBackgroundTask</code> список всех фоновых задач, включая копирование<br> <code>Get-SYNOFSCopy</code> получить статус операции копирования<br> <code>Get-SYNOFSDeleteItem</code> получить статус задачи удаления<br> <code>Get-SYNOFSDirSize</code> получить статус задачи расчета размера<br> <code>Get-SYNOFSFavorite</code> список избранного пользователя<br> <code>Get-SYNOFSFile</code> перечислить файлы в заданной папке<br> <code>Get-SYNOFSFileInfo</code> получить информацию о файлах или файле<br> <code>Get-SYNOFSInfo</code> получить информацию о файловой станции<br> <code>Get-SYNOFSMD5</code> получить статус вычислительной задачи MD5<br> <code>Get-SYNOFSSearch</code> перечислить совпадающие файлы во временной базе данных поиска<br> <code>Get-SYNOFSShare</code> список всех общих папок<br> <code>Get-SYNOFSSharingLink</code> список ссылок пользователя на общий доступ к файлам<br> <code>Get-SYNOFSSharingLinkInfo</code> получить информацию о ссылке общего доступа по идентификатору ссылки общего доступа<br> <code>Get-SYNOFSThumbnail</code> получить миниатюру файла<br> <code>Get-SYNOFSVirtualFolder</code> список всех папок точек монтирования заданного типа виртуальной файловой системы<br> <code>New-SYNOFSFolder</code> создать папку<br> <code>New-SYNOFSSharingLink</code> создать одну или несколько ссылок для общего доступа по пути к файл или папку<br> <code>Remove-SYNOFSFAvorite</code> удаление избранного из избранного пользователя<br> <code>Remove-SYNOFSItem</code> удалить файл или папку<br> <code>Remove-SYNOFSSearch</code> удалить временные базы данных поиска<br> <code>Remove-SYNOFSSharingLink</code> удалить одну или несколько ссылок общего доступа<br> <code>Rename-SYNOFSItem</code> переименовываем файл или папку<br> <code>Save-SYNOFSFile</code> загрузить файл или папку<br> <code>Set-SYNOFSFAvorite</code> редактировать избранное имя<br> <code>Set-SYNOFSSharingLink</code> изменить ссылку для общего доступа<br> <code>Start-SYNOFSArchiveCompress</code> запустить задание сжатия файла или папки<br> <code>Start-SYNOFSArchiveExtract</code> запустить задание распаковки архива<br> <code>Start-SYNOFSCopy</code> запустить задание копирования файлов<br> <code>Start-SYNOFSDeleteItem</code> запустить задание удаления файлов или папок<br> <code>Start-SYNOFSDirSize</code> расчитать размер для одного или нескольких путей к файлам или папкам<br> <code>Start-SYNOFSMD5</code> получить MD5 файла<br> <code>Start-SYNOFSSearch</code> поиск файлов по заданным критериям<br> <code>Stop-SYNOFSArchiveCompress</code> остановить задачу сжатия<br> <code>Stop-SYNOFSArchiveExtract</code> остановить задачу извлечения<br> <code>Stop-SYNOFSCopy</code> остановить задачу копирования<br> <code>Stop-SYNOFSDeleteItem</code> остановить задачу удаления<br> <code>Stop-SYNOFSDirSize</code> остановить расчет размера<br> <code>Stop-SYNOFSMD5</code> остановить вычисление MD5 файла<br> <code>Stop-SYNOFSSearch</code> остановить задачу поиска<br> <code>Test-SYNOFSPermission</code> проверить, имеет ли вошедший в систему пользователь разрешение на запись в данную папку<br> <code>Update-SYNOFSFAvorite</code> заменить несколько избранных папок в избранном пользователя</p><span class=hidden id=copy-code-text>Copy Code</span><span class=hidden id=search-index>https://lifailon.github.io/search_index.en.json</span><span class=hidden id=more-matches-text>$MATCHES more matches</span></main><footer id=site-footer><nav><ul><li><a href=https://lifailon.github.io/syntax/>PowerShell Syntax</a><li><a class=active href=https://lifailon.github.io/filesystem/>File System</a><li><a href=https://lifailon.github.io/windows/>Operating System</a><li><a href=https://lifailon.github.io/network/>Network</a><li><a href=https://lifailon.github.io/threads/>Threads</a><li><a href=https://lifailon.github.io/modules/>Modules</a><li><a href=https://lifailon.github.io/dotnet/>dotNET</a><li><a href=https://lifailon.github.io/com/>COM</a><li><a href=https://lifailon.github.io/servermanager/>Server Manager</a><li><a href=https://lifailon.github.io/activedirectory/>Active Directory</a><li><a href=https://lifailon.github.io/exchange/>Exchange</a><li><a href=https://lifailon.github.io/virtualization/>Virtualization</a><li><a href=https://lifailon.github.io/database/>Database</a><li><a href=https://lifailon.github.io/markuplanguages/>Markup Languages</a><li><a href=https://lifailon.github.io/api/>API</a><li><a href=https://lifailon.github.io/zabbix/>Zabbix</a><li><a href=https://lifailon.github.io/devops/>DevOps</a><li><a href=https://lifailon.github.io/docker/>Docker</a><li><a href=https://lifailon.github.io/linux/>Linux</a><li><a href=https://lifailon.github.io/node-js/>Node.js</a></ul></nav><p>© <strong>2023-2024</strong> <code>Lifailon</code><p><small>Powered by <a class="link external" href=https://www.getzola.org>Zola</a> and <a class="link external" href=https://duckquill.daudix.one>Duckquill</a> </small><ul id=socials><li><a rel=" me" href=https://github.com title=GitHub> <i style="--icon:url(&#34data:image/svg+xml,%3Csvg role='img' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Ctitle%3EGitHub%3C/title%3E%3Cpath d='M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12'/%3E%3C/svg%3E&#34)" class=icon></i> <span>GitHub</span> </a></ul></footer>