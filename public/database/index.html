<!doctype html><html data-theme=light lang=en xmlns=http://www.w3.org/1999/xhtml><head><meta charset=UTF-8><meta content="Web version for PowerShell notes in Russian language (Сheat Sheet & Documentation) and RuDocs (node.js)" name=description><meta content="width=device-width,initial-scale=1" name=viewport><meta content=#ff7800 name=theme-color><meta content=#ffa348 media=(prefers-color-scheme:dark) name=theme-color><meta content="default-src 'none';font-src 'self';img-src 'self' https: data:;media-src 'self' https:;style-src 'self' 'unsafe-inline';frame-src https://player.vimeo.com https://www.youtube-nocookie.com https://toot.community;frame-ancestors 'none';base-uri 'none';form-action 'none';connect-src 'self' https://toot.community;script-src 'self' 'self'" http-equiv=content-security-policy><title>Database - PowerShell Commands / RuDocs</title><link href=https://lifailon.github.io/database/ rel=canonical><link href=https://lifailon.github.io/favicon.png rel=icon type=image/png><link href=https://lifailon.github.io/apple-touch-icon.png rel=apple-touch-icon sizes=180x180 type=image/png><link title="PowerShell Commands / RuDocs - RSS Feed" href=https://lifailon.github.io/rss.xml rel=alternate type=application/rss+xml><link title="PowerShell Commands / RuDocs - Atom Feed" href=https://lifailon.github.io/atom.xml rel=alternate type=application/atom+xml><style>:root{--accent-color:#ff7800;--contrast-color:#000c}[data-theme=dark]{--accent-color:#ffa348}@media (prefers-color-scheme:dark){:root:not([data-theme=light]){--accent-color:#ffa348}}[data-theme=dark]{--contrast-color:#000c}@media (prefers-color-scheme:dark){:root:not([data-theme=light]){--contrast-color:#000c}}</style><link href=https://lifailon.github.io/style.css rel=stylesheet><link media="(prefers-color-scheme: light)" href=https://lifailon.github.io/syntax-theme-light.css rel=stylesheet><link media="(prefers-color-scheme: dark)" href=https://lifailon.github.io/syntax-theme-dark.css rel=stylesheet><script defer src=https://lifailon.github.io/closable.js></script><script defer src=https://lifailon.github.io/copy-button.js></script><script defer src=https://lifailon.github.io/elasticlunr.min.js></script><script defer src=https://lifailon.github.io/search-elasticlunr.js></script><script defer src=https://lifailon.github.io/theme-switcher.js></script><meta content="PowerShell Commands / RuDocs" property=og:site_name><meta content="Database - PowerShell Commands / RuDocs" property=og:title><meta content=https://lifailon.github.io/database/ property=og:url><meta content="Web version for PowerShell notes in Russian language (Сheat Sheet & Documentation) and RuDocs (node.js)" property=og:description><meta content=https://lifailon.github.io/card.png property=og:image><meta content=en_US property=og:locale><body><div id=handle></div><header id=site-nav><nav><a href=#main-content tabindex=0> Skip to Main Content </a><ul><li id=home><a href=https://lifailon.github.io> <i class=icon></i>PowerShell Commands / RuDocs</a><li class=divider><li><details class=closable><summary>PowerShell</summary> <ul><li><a href=https://lifailon.github.io/syntax/>PowerShell Syntax</a><li><a href=https://lifailon.github.io/filesystem/>File System</a><li><a href=https://lifailon.github.io/windows/>Operating System</a><li><a href=https://lifailon.github.io/network/>Network</a><li><a href=https://lifailon.github.io/threads/>Threads</a><li><a href=https://lifailon.github.io/modules/>Modules</a><li><a href=https://lifailon.github.io/dotnet/>dotNET</a><li><a href=https://lifailon.github.io/com/>COM</a><li><a href=https://lifailon.github.io/servermanager/>Server Manager</a><li><a href=https://lifailon.github.io/activedirectory/>Active Directory</a><li><a href=https://lifailon.github.io/exchange/>Exchange</a><li><a href=https://lifailon.github.io/virtualization/>Virtualization</a><li><a class=active href=https://lifailon.github.io/database/>Database</a><li><a href=https://lifailon.github.io/markuplanguages/>Markup Languages</a><li><a href=https://lifailon.github.io/api/>API</a><li><a href=https://lifailon.github.io/zabbix/>Zabbix</a><li><a href=https://lifailon.github.io/devops/>DevOps</a></ul></details><li><a href=https://lifailon.github.io/node-js/>Node.js</a><li><a href=https://lifailon.github.io/linux/>Linux</a><li><a href=https://lifailon.github.io/docker/>Docker</a><li id=search><button class=circle id=search-toggle title=Search><i class=icon></i></button><li id=theme-switcher><details class=closable><summary class=circle title=Theme><i class=icon></i></summary> <ul><li><button title="Switch to Light Theme" class=circle id=theme-light><i class=icon></i></button><li><button title="Switch to Dark Theme" class=circle id=theme-dark><i class=icon></i></button><li><button title="Use System Theme" class=circle id=theme-system><i class=icon></i></button></ul></details><li id=repo><a class=circle href=https://github.com/Lifailon/PS-Commands title=Repository> <i class=icon></i> </a></ul></nav><div id=search-container><label class=visually-hidden for=search-bar>Search</label><input placeholder="Search for…" autocomplete=off disabled id=search-bar type=search><div id=search-results-container><div id=search-results></div></div></div></header><main id=main-content><h1>Database</h1><h2 id=influxdb><a aria-label="Anchor link for: influxdb" class=zola-anchor href=#influxdb><i class=icon></i></a> InfluxDB</h2><p><a href=https://www.influxdata.com/downloads>Download InfluxDB 1.x Open Source</a><br> <a href=https://github.com/CymaticLabs/InfluxDBStudio>InfluxDB-Studio</a><h3 id=install-windows><a aria-label="Anchor link for: install-windows" class=zola-anchor href=#install-windows><i class=icon></i></a> Install Windows</h3><pre class="language-powershell z-code" data-lang=powershell><code class=language-powershell data-lang=powershell><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>https://dl.influxdata.com/influxdb/releases/influxdb-1.8.10_windows_amd64.zip<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>OutFile <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Downloads\influxdb-1.8.10_windows_amd64.zip<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Expand-Archive</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Downloads\influxdb-1.8.10_windows_amd64.zip<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>DestinationPath <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Documents\<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Remove-Item</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Downloads\influxdb-1.8.10_windows_amd64.zip<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-keyword z-operator z-other z-powershell">&</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Downloads\influxdb-1.8.10-1\influxd.exe<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></code></pre><h3 id=install-ubuntu><a aria-label="Anchor link for: install-ubuntu" class=zola-anchor href=#install-ubuntu><i class=icon></i></a> Install Ubuntu</h3><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">wget</span></span><span class="z-meta z-function-call z-arguments z-shell"> https://dl.influxdata.com/influxdb/releases/influxdb_1.8.10_amd64.deb</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> dpkg<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>i</span> influxdb_1.8.10_amd64.deb</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">systemctl</span></span><span class="z-meta z-function-call z-arguments z-shell"> start influxdb</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">systemctl</span></span><span class="z-meta z-function-call z-arguments z-shell"> status influxdb</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ps</span></span><span class="z-meta z-function-call z-arguments z-shell"> aux</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">grep</span></span><span class="z-meta z-function-call z-arguments z-shell"> influxdb</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">grep</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>Ev</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>grep<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">netstat</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>natpl</span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">grep</span></span><span class="z-meta z-function-call z-arguments z-shell"> 80<span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>8<span class="z-keyword z-operator z-word z-shell">-</span>9<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span><span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>3<span class="z-keyword z-operator z-word z-shell">-</span>9<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span></span>
</span></code></pre><h3 id=api><a aria-label="Anchor link for: api" class=zola-anchor href=#api><i class=icon></i></a> API</h3><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">nano</span></span><span class="z-meta z-function-call z-arguments z-shell"> /etc/influxdb/influxdb.conf</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[http]</span></span>
</span><span class="z-source z-shell z-bash">  <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">enabled</span></span><span class="z-meta z-function-call z-arguments z-shell"> = true</span>
</span><span class="z-source z-shell z-bash">  <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">bind-address</span></span><span class="z-meta z-function-call z-arguments z-shell"> = <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>:8086<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash">  <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">auth-enabled</span></span><span class="z-meta z-function-call z-arguments z-shell"> = false</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">systemctl</span></span><span class="z-meta z-function-call z-arguments z-shell"> restart influxdb</span>
</span></code></pre><h3 id=chronograf><a aria-label="Anchor link for: chronograf" class=zola-anchor href=#chronograf><i class=icon></i></a> Chronograf</h3><pre class=z-code><code><span class="z-text z-plain">wget https://dl.influxdata.com/chronograf/releases/chronograf-1.10.2_windows_amd64.zip -UseBasicParsing -OutFile chronograf-1.10.2_windows_amd64.zip
</span><span class="z-text z-plain">Expand-Archive .\chronograf-1.10.2_windows_amd64.zip -DestinationPath 'C:\Program Files\InfluxData\chronograf\'
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">wget https://dl.influxdata.com/chronograf/releases/chronograf_1.10.2_amd64.deb
</span><span class="z-text z-plain">sudo dpkg -i chronograf_1.10.2_amd64.deb
</span><span class="z-text z-plain">systemctl status influxdb
</span><span class="z-text z-plain">http://192.168.3.102:8888
</span></code></pre><h3 id=grafana><a aria-label="Anchor link for: grafana" class=zola-anchor href=#grafana><i class=icon></i></a> Grafana</h3><p><a href=https://grafana.com/grafana/download>Download</a><p><code>invoke-RestMethod https://dl.grafana.com/enterprise/release/grafana-enterprise-10.3.1.windows-amd64.msi -OutFile "$home\Download\grafana.msi"</code><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">apt-get</span></span><span class="z-meta z-function-call z-arguments z-shell"> install<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>y</span> adduser libfontconfig1 musl</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">wget</span></span><span class="z-meta z-function-call z-arguments z-shell"> https://dl.grafana.com/enterprise/release/grafana-enterprise_10.3.1_amd64.deb</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">dpkg</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>i</span> grafana-enterprise_10.3.1_amd64.deb</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">systemctl</span></span><span class="z-meta z-function-call z-arguments z-shell"> start grafana-server</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">systemctl</span></span><span class="z-meta z-function-call z-arguments z-shell"> status grafana-server</span>
</span></code></pre><h3 id=cli-client><a aria-label="Anchor link for: cli-client" class=zola-anchor href=#cli-client><i class=icon></i></a> CLI Client</h3><p><code>apt install influxdb-client</code><br> <code>influx</code><br> <code>influx --host 192.168.3.102 --username admin --password password</code><pre class="language-powershell z-code" data-lang=powershell><code class=language-powershell data-lang=powershell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>influx_client_exec</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Documents\influxdb-1.8.10-1\influx.exe<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-keyword z-operator z-other z-powershell">&</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>influx_client_exec</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>host <span class="z-constant z-numeric z-integer z-powershell">192.168</span>.<span class="z-constant z-numeric z-integer z-powershell">3.102</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>port <span class="z-constant z-numeric z-integer z-powershell">8086</span>
</span><span class="z-source z-powershell">help
</span><span class="z-source z-powershell">show databases
</span><span class="z-source z-powershell">use PowerShell
</span><span class="z-source z-powershell">SELECT <span class="z-keyword z-operator z-assignment z-powershell">*</span> <span class="z-keyword z-control z-powershell">FROM</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>HardwareMonitor<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-control z-powershell">WHERE</span> time <span class="z-keyword z-operator z-redirection z-powershell">></span> now<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span> <span class="z-constant z-numeric z-integer z-powershell">5m</span>
</span></code></pre><h3 id=users><a aria-label="Anchor link for: users" class=zola-anchor href=#users><i class=icon></i></a> USERS</h3><p><code>SHOW USERS</code> отобразить пользователей и их права доступа<br> <code>CREATE USER admin WITH PASSWORD 'password' WITH ALL PRIVILEGES</code> создать пользователя<br> <code>GRANT ALL PRIVILEGES TO "admin"</code> предоставить права доступа<br> <code>GRANT READ ON "database" TO "admin"</code> доступ на чтение для БД или запись (WRITE)<br> <code>REVOKE ALL PRIVILEGES FROM "admin"</code> отозвать права доступа<br> <code>SHOW GRANTS FOR "admin"</code> БД и привелегии доступа для указанного пользователя<br> <code>SET PASSWORD FOR "admin" = 'new_password'</code> изменить пароль<br> <code>DROP USER "admin"</code> удалить пользователя<h3 id=database><a aria-label="Anchor link for: database" class=zola-anchor href=#database><i class=icon></i></a> DATABASE</h3><p><code>CREATE DATABASE powershell</code> создать БД<br> <code>SHOW DATABASES</code> отобразить список БД<br> <code>DROP DATABASE powershell</code> удалить БД<br> <code>USE powershell</code><br> <code>SHOW measurements</code> отобразить все таблицы<br> <code>INSERT performance,host=console,counter=CPU value=0.88</code> записать данные в таблицу performance<h3 id=measurement><a aria-label="Anchor link for: measurement" class=zola-anchor href=#measurement><i class=icon></i></a> MEASUREMENT</h3><p><code>SHOW TAG KEYS FROM "HardwareMonitor"</code> отобразить все тэги в таблице<br> <code>SHOW TAG VALUES FROM "HardwareMonitor" WITH KEY = "HardwareName"</code> отобразить все значения указанного тэга<br> <code>SHOW FIELD KEYS FROM "HardwareMonitor"</code> отобразить все Field Tags и их тип данных<br> <code>SHOW SERIES FROM "HardwareMonitor"</code> отобразить список всех уникальных серий в указанной таблице. Серия - это набор точек данных, которые имеют одинаковые значения для всех тегов, за исключением времени.<br> <code>DROP SERIES FROM "HardwareMonitor"</code> очистить все данные в таблице<br> <code>DROP MEASUREMENT "HardwareMonitor"</code> удалить таблицу<h3 id=select-where><a aria-label="Anchor link for: select-where" class=zola-anchor href=#select-where><i class=icon></i></a> SELECT/WHERE</h3><p><code>SELECT * FROM performance</code> отобразить все данные в таблице<br> <code>SELECT value FROM performance</code> отфильтровать по столбцу value (только Field Keys)<br> <code>SELECT * FROM performance limit 10</code> отобразить 10 единиц данных<br> <code>SELECT * FROM performance WHERE time > now() -2d</code> отобразить данные за последние 2 дня<br> <code>SELECT * FROM performance WHERE time > now() +3h -5m</code> данные за последние 5 минут (+3 часа от текущего времени по UTC 0 -5 минут)<br> <code>SELECT * FROM performance WHERE counter = 'CPU'</code> выборка по тэгу<br> <code>SELECT upload/1000 FROM speedtest WHERE upload/1000 <= 250</code> выборка по столбцу upload и разделить вывод на 1000, вывести upload меньше 250<br> <code>DELETE FROM performance WHERE time > now() -1h</code> удалить данные за последние 1/4 часа<br> <code>DELETE FROM performance WHERE time < now() -24h</code> удалить данные старше 24 часов<h3 id=regex><a aria-label="Anchor link for: regex" class=zola-anchor href=#regex><i class=icon></i></a> REGEX</h3><p><code>SELECT * FROM "win_pdisk" WHERE instance =~/.*C:/ and time > now() - 5m</code> и<br> <code>SELECT * FROM "win_pdisk" WHERE instance =~/.*E:/ or instance =~ /.*F:/</code> или<br> <code>SELECT * FROM "win_pdisk" WHERE instance !~ /.*Total/</code> не равно (исключить)<br> <code>SELECT * FROM "HardwareMonitor" WHERE time > now() - 5m and HardwareName =~ /Intel/</code> приблизительно равно<br> <code>SELECT * FROM "HardwareMonitor" WHERE time > now() - 5m and HardwareName =~ /Intel.+i7/</code> эквивалент 12th_Gen_Intel_Core_i7-1260P<br> <code>SELECT * FROM "HardwareMonitor" WHERE time > now() - 5m and HardwareName =~ /^Intel/</code> начинается на Intel<br> <code>SELECT * FROM "HardwareMonitor" WHERE time > now() - 5m and HardwareName =~ /00$/</code> заканчивается на 00<h3 id=group-by-tag-key><a aria-label="Anchor link for: group-by-tag-key" class=zola-anchor href=#group-by-tag-key><i class=icon></i></a> GROUP BY tag_key</h3><p><code>SELECT * FROM "HardwareMonitor" WHERE time > now() - 5m and SensorName = 'Temperature' GROUP BY HardwareName</code> создать уникальные группы по тэгу HardwareName<br> <code>SELECT * FROM "HardwareMonitor" WHERE time > now() - 5m and SensorName = 'Temperature' GROUP BY Host,HardwareName</code> больше групп по двум тэгаам<h3 id=functions-field-key><a aria-label="Anchor link for: functions-field-key" class=zola-anchor href=#functions-field-key><i class=icon></i></a> Functions(field_key)</h3><p><a href=https://docs.influxdata.com/influxdb/v1.8/query_language/functions>Functions</a><p><code>SELECT instance,LAST(Avg._Disk_Read_Queue_Length) FROM "win_pdisk" GROUP BY instance</code> отфильтровать вывод по последнему/текущему значению<br> <code>SELECT instance,FIRST(Avg._Disk_Read_Queue_Length) FROM "win_pdisk" GROUP BY instance</code> отфильтровать вывод по первому значению за весь или указанный отрезок времени<br> <code>SELECT instance,MIN(Avg._Disk_Read_Queue_Length) FROM "win_pdisk" GROUP BY instance</code> отфильтровать вывод с отображением минимального значения<br> <code>SELECT instance,MAX(Avg._Disk_Read_Queue_Length) FROM "win_pdisk" GROUP BY instance</code> отфильтровать вывод с отображением максимального значения<br> <code>SELECT SUM(Bytes_Received_persec) FROM "win_net" GROUP BY instance</code> суммах всех значений<br> <code>SELECT COUNT(Bytes_Received_persec) FROM "win_net" WHERE Bytes_Received_persec >= 0 GROUP BY instance</code> кол-во данных, где значение выше или равно 0<br> <code>SELECT MEAN(Bytes_Received_persec) FROM "win_net" WHERE Bytes_Received_persec < 1000 GROUP BY instance</code> среднее значение данных с показателем от 0 до 1000 (509)<p><code>SELECT *,MAX(Value) FROM "HardwareMonitor" WHERE time > now() -1h GROUP BY SensorName,Host</code> создать группы для выявления максимального значения значения стобца Value каждого тэга SensorName и хоста за последний час<br> <code>SELECT *,MAX(Value) FROM "HardwareMonitor" WHERE time > now() -1h and SensorName = 'CPU_Package' GROUP BY Host</code> масимальное значение CPU_Package за последний час для каждого хоста<br> <code>SELECT MEAN(Value) FROM "HardwareMonitor" WHERE time > now() -1h and SensorName = 'CPU_Package' GROUP BY Host</code> среднее значение CPU_Package за последний час<h3 id=policy><a aria-label="Anchor link for: policy" class=zola-anchor href=#policy><i class=icon></i></a> POLICY</h3><p><code>CREATE DATABASE powershell WITH DURATION 48h REPLICATION 1 NAME "del2d"</code> создать БД с политикой хранения 2 дня<br> <code>CREATE RETENTION POLICY del2h ON powershell DURATION 2h REPLICATION 1</code> создать новую политику хранения для БД<br> <code>CREATE RETENTION POLICY del6h ON powershell DURATION 6h REPLICATION 1 SHARD DURATION 2h</code> указать период хранения 6 часов + 2 часа до очистки (по умолчанию 1ч или больше)<br> <code>ALTER RETENTION POLICY del6h ON powershell DEFAULT</code> изменить (ALTER) политику хранения для БД на del6h (DEFAULT)<br> <code>DROP RETENTION POLICY del2d ON powershell</code> удаление политики хранения приводит к безвозвратному удалению всех измерений (таблиц) и данных, хранящихся в политике хранения<br> <code>SHOW RETENTION POLICIES ON PowerShell</code> отобразить действующие политики базы данных PowerShell<h2 id=influxdb-api><a aria-label="Anchor link for: influxdb-api" class=zola-anchor href=#influxdb-api><i class=icon></i></a> InfluxDB-api</h2><pre class="language-powershell z-code" data-lang=powershell><code class=language-powershell data-lang=powershell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>data</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">Invoke-RestMethod</span> http:<span class="z-keyword z-operator z-assignment z-powershell">/</span><span class="z-keyword z-operator z-assignment z-powershell">/</span><span class="z-constant z-numeric z-integer z-powershell">192.168</span>.<span class="z-constant z-numeric z-integer z-powershell">3.102</span>:<span class="z-constant z-numeric z-integer z-powershell">8086</span><span class="z-keyword z-operator z-assignment z-powershell">/</span>query?q<span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>SHOW RETENTION POLICIES ON PowerShell<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>col</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>data<span class="z-variable z-other z-member z-powershell">.results.series.columns</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>val</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>data<span class="z-variable z-other z-member z-powershell">.results.series.values</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>mass</span>    <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-meta z-group z-array-expression z-powershell"><span class="z-keyword z-other z-array z-begin z-powershell">@</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>mass</span>   <span class="z-keyword z-operator z-assignment z-powershell">+=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">string</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>col</span>
</span><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">foreach</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>v</span> <span class="z-keyword z-control z-powershell">in</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>val</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>mass</span> <span class="z-keyword z-operator z-assignment z-powershell">+=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">string</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>v</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>mass</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>mass</span> <span class="z-keyword z-operator z-comparison z-powershell">-replace</span> <span class="z-string z-quoted z-single z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">'</span>^<span class="z-punctuation z-definition z-string z-end z-powershell">'</span></span><span class="z-keyword z-operator z-other z-powershell">,</span><span class="z-string z-quoted z-single z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">'</span>"<span class="z-punctuation z-definition z-string z-end z-powershell">'</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>mass</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>mass</span> <span class="z-keyword z-operator z-comparison z-powershell">-replace</span> <span class="z-string z-quoted z-single z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">'</span>$<span class="z-punctuation z-definition z-string z-end z-powershell">'</span></span><span class="z-keyword z-operator z-other z-powershell">,</span><span class="z-string z-quoted z-single z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">'</span>"<span class="z-punctuation z-definition z-string z-end z-powershell">'</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>mass</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>mass</span> <span class="z-keyword z-operator z-comparison z-powershell">-replace</span> <span class="z-string z-quoted z-single z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">'</span>\s<span class="z-punctuation z-definition z-string z-end z-powershell">'</span></span><span class="z-keyword z-operator z-other z-powershell">,</span><span class="z-string z-quoted z-single z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">'</span>","<span class="z-punctuation z-definition z-string z-end z-powershell">'</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>mass</span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-support z-function z-powershell">ConvertFrom-Csv</span>
</span></code></pre><h3 id=api-post><a aria-label="Anchor link for: api-post" class=zola-anchor href=#api-post><i class=icon></i></a> API POST</h3><p>Вместо таблиц в InfluxDB имеются измерения. Вместо столбцов в ней есть теги и поля.<pre class=z-code><code><span class="z-text z-plain">   Table                        Tag (string/int)                          Field (double/int)           TIMESTAMP
</span><span class="z-text z-plain">measurement,Tag_Keys1=Tag_Values1,Tag_Keys2=Tag_Values2 Field_Keys1="Values",Field_Keys2="Values" 0000000000000000000
</span><span class="z-text z-plain">           1                                           2                                         3
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">$ip        = "192.168.3.104"
</span><span class="z-text z-plain">$port      = "8086"
</span><span class="z-text z-plain">$db        = "powershell"
</span><span class="z-text z-plain">$table     = "speedtest"
</span><span class="z-text z-plain">$ipp       = $ip+":"+$port
</span><span class="z-text z-plain">$url       = "http://$ipp/write?db=$db"
</span><span class="z-text z-plain">$user      = "admin"
</span><span class="z-text z-plain">$pass      = "password" | ConvertTo-SecureString -AsPlainText -Force
</span><span class="z-text z-plain">$cred      = [System.Management.Automation.PSCredential]::new($user,$pass)
</span><span class="z-text z-plain">$unixtime  = (New-TimeSpan -Start (Get-Date "01/01/1970") -End (Get-Date)).TotalSeconds
</span><span class="z-text z-plain">$timestamp = ([string]$unixtime -replace "\..+") + "000000000"
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">Invoke-RestMethod -Method POST -Uri $url -Body "$table,host=$(hostname) download=200000,upload=300000,ping=3 $timestamp"
</span></code></pre><h3 id=api-get><a aria-label="Anchor link for: api-get" class=zola-anchor href=#api-get><i class=icon></i></a> API GET</h3><p><code>curl http://192.168.3.104:8086/query --data-urlencode "q=SHOW DATABASES"</code> pwsh7 (ConvertFrom-Json) and bash<p><code>$dbs = irm "http://192.168.3.104:8086/query?q=SHOW DATABASES"</code><br> <code>$dbs = irm "http://192.168.3.104:8086/query?epoch=ms&u=admin&p=password&q=SHOW DATABASES"</code><br> <code>$dbs.results.series.values</code><pre class="language-powershell z-code" data-lang=powershell><code class=language-powershell data-lang=powershell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>ip</span>    <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>192.168.3.104<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>port</span>  <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>8086<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>db</span>    <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>powershell<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>table</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>speedtest<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>query</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>SELECT * FROM <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>table</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>ipp</span>   <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>ip</span><span class="z-keyword z-operator z-assignment z-powershell">+</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>:<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-assignment z-powershell">+</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>port</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>url</span>   <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>http://<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>ipp</span>/query?db=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>db</span>&q=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>query</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>data</span>  <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Method GET <span class="z-keyword z-operator z-assignment z-powershell">-</span>Uri <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>url</span><span class="z-keyword z-operator z-other z-powershell">`</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Credential <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cred</span> 
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>data<span class="z-variable z-other z-member z-powershell">.results.series.name</span></span>   <span class="z-keyword z-operator z-other z-powershell">`</span> имя таблицы
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>data<span class="z-variable z-other z-member z-powershell">.results.series.columns</span></span><span class="z-keyword z-operator z-other z-powershell">`</span> столбцы<span class="z-keyword z-operator z-assignment z-powershell">/</span>ключи
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>data<span class="z-variable z-other z-member z-powershell">.results.series.values</span></span> <span class="z-keyword z-operator z-other z-powershell">`</span> данные построчно
</span></code></pre><h3 id=endpoints><a aria-label="Anchor link for: endpoints" class=zola-anchor href=#endpoints><i class=icon></i></a> Endpoints</h3><p><a href=https://docs.influxdata.com/influxdb/v1.7/tools/api/>API doc</a><pre class="language-powershell z-code" data-lang=powershell><code class=language-powershell data-lang=powershell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>stats</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> irm http:<span class="z-keyword z-operator z-assignment z-powershell">/</span><span class="z-keyword z-operator z-assignment z-powershell">/</span><span class="z-constant z-numeric z-integer z-powershell">192.168</span>.<span class="z-constant z-numeric z-integer z-powershell">3.104</span>:<span class="z-constant z-numeric z-integer z-powershell">8086</span><span class="z-keyword z-operator z-assignment z-powershell">/</span>debug<span class="z-keyword z-operator z-assignment z-powershell">/</span>vars<span class="z-keyword z-operator z-other z-powershell">`</span> статистика сервера
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>stats</span>.<span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>database:powershell<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>.values<span class="z-keyword z-operator z-other z-powershell">`</span> кол<span class="z-keyword z-operator z-assignment z-powershell">-</span>во таблиц к БД
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>stats<span class="z-variable z-other z-member z-powershell">.queryExecutor.values</span></span><span class="z-keyword z-operator z-other z-powershell">`</span> количество query<span class="z-keyword z-operator z-assignment z-powershell">-</span>запросов <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell">обращений к endpoint <span class="z-keyword z-operator z-assignment z-powershell">/</span>query</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>stats<span class="z-variable z-other z-member z-powershell">.write.values</span></span><span class="z-keyword z-operator z-other z-powershell">`</span> количество <span class="z-support z-function z-powershell">write-запросов</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>stats<span class="z-variable z-other z-member z-powershell">.system.uptime</span></span>
</span></code></pre><p><code>http://192.168.3.104:8086/debug/requests</code> кол-во клиентских HTTP-запросов к конечным точкам /writeи /query<br> <code>http://192.168.3.104:8086/debug/pprof</code><br> <code>http://192.168.3.104:8086/ping</code><br> <code>http://192.168.3.104:8086/query</code><br> <code>http://192.168.3.104:8086/write</code><p><code>http://192.168.3.99:8086/api/v2/setup</code><br> <code>http://192.168.3.99:8086/api/v2/config</code><br> <code>http://192.168.3.99:8086/api/v2/write</code><h3 id=pingto-influxdb><a aria-label="Anchor link for: pingto-influxdb" class=zola-anchor href=#pingto-influxdb><i class=icon></i></a> PingTo-InfluxDB</h3><pre class="language-powershell z-code" data-lang=powershell><code class=language-powershell data-lang=powershell><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">while</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-constant z-language z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>true</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>tz</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">Get-TimeZone</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.BaseUtcOffset.TotalMinutes
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>unixtime</span>  <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">New-TimeSpan</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Start <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">Get-Date</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>01/01/1970<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>End <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">Get-Date</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.AddMinutes<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-keyword z-operator z-assignment z-powershell">-</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>tz</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.TotalSeconds<span class="z-keyword z-operator z-other z-powershell">`</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>3h UTC
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>timestamp</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">string</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>unixtime</span> <span class="z-keyword z-operator z-comparison z-powershell">-replace</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>\..+<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-keyword z-operator z-assignment z-powershell">+</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>000000000<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>tnc</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> tnc <span class="z-constant z-numeric z-integer z-powershell">8.8</span>.<span class="z-constant z-numeric z-integer z-powershell">8.8</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Status</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>tnc<span class="z-variable z-other z-member z-powershell">.PingSucceeded</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>RTime</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>tnc<span class="z-variable z-other z-member z-powershell">.PingReplyDetails.RoundtripTime</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Method POST <span class="z-keyword z-operator z-assignment z-powershell">-</span>Uri <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>http://192.168.3.104:8086/write?db=powershell<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Body <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>ping,host=<span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-complex z-source z-powershell">hostname</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> status=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>status</span>,rtime=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>RTime</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>timestamp</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    sleep <span class="z-constant z-numeric z-integer z-powershell">1</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></code></pre><p><code>SELECT * FROM ping WHERE status = false</code><h3 id=performanceto-influxdb><a aria-label="Anchor link for: performanceto-influxdb" class=zola-anchor href=#performanceto-influxdb><i class=icon></i></a> PerformanceTo-InfluxDB</h3><pre class="language-powershell z-code" data-lang=powershell><code class=language-powershell data-lang=powershell><span class="z-source z-powershell"><span class="z-meta z-function z-powershell"><span class="z-storage z-type z-powershell">function</span> <span class="z-entity z-name z-function z-powershell">ConvertTo-Encoding</span></span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">string</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>From</span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">string</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>To</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-keyword z-control z-powershell">Begin</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>encFrom</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">System.Text.Encoding</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::GetEncoding<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>from</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>encTo</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">System.Text.Encoding</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::GetEncoding<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>to</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-keyword z-control z-powershell">Process</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>bytes</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>encTo<span class="z-variable z-other z-member z-powershell">.GetBytes</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-variable z-automatic z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>_</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>bytes</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">System.Text.Encoding</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::Convert<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>encFrom</span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>encTo</span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>bytes</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>encTo<span class="z-variable z-other z-member z-powershell">.GetString</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>bytes</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>localization</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">Get-Culture</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.LCID<span class="z-keyword z-operator z-other z-powershell">`</span> текущая локализация
</span><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">if</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>localization</span> <span class="z-keyword z-operator z-comparison z-powershell">-eq</span> <span class="z-constant z-numeric z-integer z-powershell">1049</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>performance</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>\\<span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-complex z-source z-powershell">hostname</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>\Процессор(_Total)\% загруженности процессора<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-support z-function z-powershell">ConvertTo-Encoding</span> UTF<span class="z-keyword z-operator z-assignment z-powershell">-</span><span class="z-constant z-numeric z-integer z-powershell">8</span> windows<span class="z-keyword z-operator z-assignment z-powershell">-</span><span class="z-constant z-numeric z-integer z-powershell">1251</span><span class="z-keyword z-operator z-other z-powershell">`</span> декодировать кириллицу
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span> <span class="z-keyword z-control z-powershell">else</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>performance</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>\Processor(_Total)\% Processor Time<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>tz</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">Get-TimeZone</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.BaseUtcOffset.TotalMinutes
</span><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">while</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-constant z-language z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>true</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>unixtime</span>  <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">New-TimeSpan</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Start <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">Get-Date</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>01/01/1970<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>End <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">Get-Date</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.AddMinutes<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-keyword z-operator z-assignment z-powershell">-</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>tz</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.TotalSeconds<span class="z-keyword z-operator z-other z-powershell">`</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>3h UTC
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>timestamp</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">string</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>unixtime</span> <span class="z-keyword z-operator z-comparison z-powershell">-replace</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>\..+<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-keyword z-operator z-assignment z-powershell">+</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>000000000<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">double</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>value</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">Get-Counter</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>performance</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.CounterSamples.CookedValue.ToString<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>0.00<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.replace<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>,<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-other z-powershell">,</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>.<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span><span class="z-keyword z-operator z-other z-powershell">`</span> округлить в тип данных Double
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-support z-function z-powershell">Invoke-RestMethod</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Method POST <span class="z-keyword z-operator z-assignment z-powershell">-</span>Uri <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>http://192.168.3.104:8086/write?db=powershell<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Body <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>performance,host=<span class="z-punctuation z-definition z-variable z-powershell">$</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-complex z-source z-powershell">hostname</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>,counter=CPU value=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>value</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>timestamp</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    sleep <span class="z-constant z-numeric z-integer z-powershell">5</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></code></pre><h3 id=service><a aria-label="Anchor link for: service" class=zola-anchor href=#service><i class=icon></i></a> Service</h3><pre class="language-powershell z-code" data-lang=powershell><code class=language-powershell data-lang=powershell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>powershell_Path</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-support z-function z-powershell">Get-Command</span> powershell</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>.Source
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>NSSM_Path</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>C:\NSSM\NSSM-2.24.exe<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Script_Path</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>C:\NSSM\PerformanceTo-InfluxDB.ps1<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Service_Name</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>PerformanceTo-InfluxDB<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-keyword z-operator z-other z-powershell">&</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>NSSM_Path</span> install <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Service_Name</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>powershell_Path</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>ExecutionPolicy Bypass <span class="z-keyword z-operator z-assignment z-powershell">-</span>NoProfile <span class="z-keyword z-operator z-string-format z-powershell">-f</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Script_Path</span>
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Get-Service</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Service_Name</span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-support z-function z-powershell">Start-Service</span>
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Get-Service</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Service_Name</span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-support z-function z-powershell">Set-Service</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>StartupType Automatic
</span></code></pre><h2 id=psinfluxdb><a aria-label="Anchor link for: psinfluxdb" class=zola-anchor href=#psinfluxdb><i class=icon></i></a> PSInfluxDB</h2><p><code>Install-Module psinfluxdb -Repository NuGet</code><br> <code>Get-InfluxUsers -server 192.168.3.102</code> список пользователей на сенвере InfluxDB и права доступа<br> <code>Get-InfluxDatabases -server 192.168.3.102</code> список баз данных<br> <code>Get-InfluxDatabases -server 192.168.3.102 -creat -database test</code> создать базу данных<br> <code>Get-InfluxDatabases -server 192.168.3.102 -delete -database test</code> удалить базу данных<br> <code>Get-InfluxPolicy -server 192.168.3.102 -database PowerShell</code> список политик хранения указанной базы данных<br> <code>Get-InfluxPolicy -server 192.168.3.102 -database PowerShell -creat -policyName del2d -hours 48</code> создать политику хранения<br> <code>Get-InfluxPolicy -server 192.168.3.102 -database PowerShell -policyName del2d -default</code> применить политику хранения к базе данных по умолчанию<br> <code>Get-InfluxTables -server 192.168.3.102 -database PowerShell</code> список таблиц/измерений в базе данных<br> <code>$Data = Get-InfluxData -server 192.168.3.102 -database PowerShell -table ping | Format-Table</code> отобразить данные в таблице<br> <code>$Data | Where-Object {$_.SensorName -match "CPU_Package" -and $_.Value -gt 90} | Format-Table</code> отфильтровать данные по двум параметрам (сенсоры процессора с показателем выше 90)<br> <code>$influx = Get-InfluxData -server 192.168.3.104 -database PowerShell -table speedtest</code><br> <code>Get-InfluxChart -time ($influx.time) -data ($influx.download) -title "SpeedTest Download" -path "C:\Users\Lifailon\Desktop"</code> создать график (WinForms Chart) измерений и сохранить в jpeg-файл<h2 id=telegraf><a aria-label="Anchor link for: telegraf" class=zola-anchor href=#telegraf><i class=icon></i></a> Telegraf</h2><p><a href=https://docs.influxdata.com/telegraf/v1.27/plugins/#input-plugins>Plugins</a><p><code>iwr https://dl.influxdata.com/telegraf/releases/telegraf-1.27.1_windows_amd64.zip -UseBasicParsing -OutFile telegraf-1.27.1_windows_amd64.zip</code><br> <code>Expand-Archive .\telegraf-1.27.1_windows_amd64.zip -DestinationPath "C:\Telegraf"</code><br> <code>rm telegraf-1.27.1_windows_amd64.zip</code><br> <code>cd C:\Telegraf</code><br> <code>.\telegraf.exe -sample-config --input-filter cpu:mem:dns_query --output-filter influxdb > telegraf_nt.conf</code> создать конфигурацию с выбарнными плагинами для сбора метрик<br> <code>Start-Process notepad++ C:\Telegraf\telegraf_nt.conf</code><pre class=z-code><code><span class="z-text z-plain">[[outputs.influxdb]]
</span><span class="z-text z-plain">  urls = ["http://192.168.3.104:8086"]
</span><span class="z-text z-plain">  database = "telegraf_nt"
</span><span class="z-text z-plain">  username = "user"
</span><span class="z-text z-plain">  password = "pass"
</span><span class="z-text z-plain">[[inputs.cpu]]
</span><span class="z-text z-plain">  percpu = false
</span><span class="z-text z-plain">  totalcpu = true
</span><span class="z-text z-plain">[[inputs.dns_query]]
</span><span class="z-text z-plain">  servers = ["8.8.8.8"]
</span><span class="z-text z-plain">  network = "udp"
</span><span class="z-text z-plain">  domains = ["."]
</span><span class="z-text z-plain">  record_type = "A"
</span><span class="z-text z-plain">  port = 53
</span><span class="z-text z-plain">  timeout = "2s"
</span></code></pre><p><code>.\telegraf.exe --test -config C:\Telegraf\telegraf_nt.conf</code> тест конфигурации (получения метрик с выводом в консоль)<br> <code>C:\Telegraf\telegraf.exe -config C:\Telegraf\telegraf_nt.conf</code> запустить telegraf (тест отправки данных)<br> <code>.\telegraf.exe --config "C:\Telegraf\telegraf_nt.conf" --service install</code> создать службу<br> <code>Get-Service telegraf | Start-Service</code><br> <code>.\telegraf.exe --service uninstall</code><p><code>USE telegraf</code><br> <code>SELECT usage_idle,usage_system,usage_user FROM cpu</code><h2 id=sqlite><a aria-label="Anchor link for: sqlite" class=zola-anchor href=#sqlite><i class=icon></i></a> SQLite</h2><pre class="language-powershell z-code" data-lang=powershell><code class=language-powershell data-lang=powershell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Documents\Get-Service.db<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Module</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">Get-Module</span> MySQLite
</span><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">if</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Module</span> <span class="z-keyword z-operator z-comparison z-powershell">-eq</span> <span class="z-constant z-language z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>null</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-support z-function z-powershell">Install-Module</span> MySQLite <span class="z-keyword z-operator z-assignment z-powershell">-</span>Repository PSGallery <span class="z-keyword z-operator z-assignment z-powershell">-</span>Scope CurrentUser
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Import-Module</span> MySQLite
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">New-MySQLiteDB</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Path <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path</span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> создать БД<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Invoke-MySQLiteQuery</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Path <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Query <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>CREATE TABLE Service (Name TEXT NOT NULL, DisplayName TEXT NOT NULL, Status TEXT NOT NULL);<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> создать таблицу<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Service</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">Get-Service</span> <span class="z-keyword z-operator z-other z-powershell">|</span> select Name<span class="z-keyword z-operator z-other z-powershell">,</span>DisplayName<span class="z-keyword z-operator z-other z-powershell">,</span>Status
</span><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">foreach</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>S</span> <span class="z-keyword z-control z-powershell">in</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Service</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Name</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>S<span class="z-variable z-other z-member z-powershell">.Name</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>DName</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>S<span class="z-variable z-other z-member z-powershell">.DisplayName</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Status</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>S<span class="z-variable z-other z-member z-powershell">.Status</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-support z-function z-powershell">Invoke-MySQLiteQuery</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Path <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Query <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>INSERT INTO Service (Name, DisplayName, Status) VALUES ('<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Name</span>', '<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>DName</span>', '<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Status</span>');<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></code></pre><p><code>(Get-MySQLiteDB $path).Tables</code> список таблиц в базе<br> <code>Invoke-MySQLiteQuery -Path $path -Query "SELECT name FROM sqlite_master WHERE type='table';"</code> список таблиц в базе<br> <code>Invoke-MySQLiteQuery -Path $path -Query "DROP TABLE Service;"</code> удалить таблицу<pre class="language-powershell z-code" data-lang=powershell><code class=language-powershell data-lang=powershell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>TableName</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Service<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Invoke-MySQLiteQuery</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Path <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Query <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>SELECT * FROM <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>TableName</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> прочитать содержимое таблицы (в формате объекта)<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></code></pre><p><code>Get-Service | select  Name,DisplayName,Status | ConvertTo-MySQLiteDB -Path $path -TableName Service -force</code> конвертировать объект в таблицу<h3 id=database-password><a aria-label="Anchor link for: database-password" class=zola-anchor href=#database-password><i class=icon></i></a> Database password</h3><pre class="language-powershell z-code" data-lang=powershell><code class=language-powershell data-lang=powershell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Connection</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-SQLiteConnection</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>DataSource <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Connection<span class="z-variable z-other z-member z-powershell">.ChangePassword</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>password<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Connection<span class="z-variable z-other z-member z-powershell">.Close</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Invoke-SqliteQuery</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Query <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>SELECT * FROM Service<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>DataSource <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>path</span>;Password=password<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></code></pre><h2 id=mysql><a aria-label="Anchor link for: mysql" class=zola-anchor href=#mysql><i class=icon></i></a> MySQL</h2><p><code>apt -y install mysql-server mysql-client</code><br> <code>mysql -V</code><br> <code>systemctl status mysql</code><br> <code>mysqladmin -u root password</code> задать пароль root<p><code>nano /etc/mysql/mysql.conf.d/mysqld.cnf</code><pre class=z-code><code><span class="z-text z-plain">[mysqld]
</span><span class="z-text z-plain">user                    = mysql
</span><span class="z-text z-plain"># pid-file              = /var/run/mysqld/mysqld.pid
</span><span class="z-text z-plain"># socket                = /var/run/mysqld/mysqld.sock
</span><span class="z-text z-plain"># port                  = 3306
</span><span class="z-text z-plain"># datadir               = /var/lib/mysql
</span><span class="z-text z-plain"># tmpdir                = /tmp
</span><span class="z-text z-plain">bind-address            = 0.0.0.0
</span><span class="z-text z-plain">mysqlx-bind-address     = 0.0.0.0
</span><span class="z-text z-plain">log_error = /var/log/mysql/error.log
</span></code></pre><p><code>systemctl restart mysql</code><br> <code>ss -tulnp | grep 3306</code><br> <code>ufw allow 3306/tcp</code><br> <code>nc -zv 192.168.1.253 3306</code><br> <code>tnc 192.168.1.253 -p 3306</code><p><code>mysql -u root -p</code><br> <code>SELECT user(), now(), version();</code><br> <code>quit;</code><p><code>mysql -u root -p -e 'SHOW TABLES FROM db_aduser;'</code> отобразить список таблиц без подключения к консоли MySQL<p><code>CREATE</code> создать БД, пользователя, таблицу<br> <code>ALTER</code> управление столбцами таблице<br> <code>DROP</code> удалить БД, пользователя, таблицу<br> <code>USE</code> выбрать БД<br> <code>SHOW</code> вывесли список БД, прав доступа пользователя (GRANTS), названия столбцов и их свойства<br> <code>GRANT</code> дать доступ пользователю к БД<br> <code>REVOKE</code> удалить доступ пользователя к БД<br> <code>UPDATE</code> изменить права доступа, значения с таблице<br> <code>FLUSH</code> обновить права доступа<br> <code>SELECT</code> отобразить выбранную БД, вывести список пользователей, выборка данных в таблице<br> <code>INSERT</code> внести данные<br> <code>DELETE</code> удалить данные в (FROM) таблице<h3 id=data-type><a aria-label="Anchor link for: data-type" class=zola-anchor href=#data-type><i class=icon></i></a> DATA TYPE</h3><p><code>VARCHAR(N)</code> строка переменной длины, в формате ASCII, где один символ занимает 1 байт, числом N указывается максимальная возможная длина строки<br> <code>NVARCHAR(N)</code> строка переменной длины, в формате Unicode, где один символ занимает 2 байта<br> <code>CHAR(N)/nchar(N)</code> строка фиксированной длины, которая всегда дополняется справа пробелами до длины N и в базе данных она занимает ровно N символов<br> <code>INT</code> целое число, от -2147483648 до 2147483647, занимает 4 байта<br> <code>FLOAT</code> число, в котором может присутствовать десятичная точка (запятая)<br> <code>BIT</code> флаг, Да - 1 или Нет - 0<br> <code>DATE</code> формат даты, например 25.05.2023<br> <code>TIME</code> 23:30:55.1234567<br> <code>DATETIME</code> 25.05.2023 23:30:55.1234567<h3 id=database-1><a aria-label="Anchor link for: database-1" class=zola-anchor href=#database-1><i class=icon></i></a> DATABASE</h3><pre class=z-code><code><span class="z-text z-plain">SHOW databases;                                                                     # вывести список БД
</span><span class="z-text z-plain">CREATE DATABASE db_aduser;                                                          # создать БД
</span><span class="z-text z-plain">CREATE DATABASE db_rep DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;  # создать БД с кодировкой UTF-8
</span><span class="z-text z-plain">DROP DATABASE db_rep;                                                               # удалить БД
</span><span class="z-text z-plain">USE db_aduser;                                                                      # выбрать/переключиться на выбранную БД
</span><span class="z-text z-plain">SELECT database();                                                                  # отобразить выбранную БД
</span></code></pre><h3 id=user><a aria-label="Anchor link for: user" class=zola-anchor href=#user><i class=icon></i></a> USER</h3><pre class=z-code><code><span class="z-text z-plain">SELECT USER,HOST FROM mysql.user;                                     # вывести список УЗ
</span><span class="z-text z-plain">CREATE USER posh@localhost IDENTIFIED BY '1qaz!QAZ';                  # создать УЗ, которая будет подключаться с локального сервера
</span><span class="z-text z-plain">CREATE USER posh@localhost IDENTIFIED BY '1qaz!QAZ';                  # создать УЗ, которая будет подключаться с указанного сервера
</span><span class="z-text z-plain">CREATE USER posh@'192.168.3.99' IDENTIFIED BY '1qaz!QAZ';             # УЗ для доступа с конкретного сервера
</span><span class="z-text z-plain">CREATE USER 'admin'@'%' IDENTIFIED BY 'Admin12#';                     # УЗ для доступа с любого сервера (% - wildcard)
</span><span class="z-text z-plain">DROP USER posh@localhost;                                             # удалить пользователя
</span><span class="z-text z-plain">SHOW GRANTS FOR posh@'%';                                             # отобразить права доступа пользователя
</span><span class="z-text z-plain">GRANT ALL PRIVILEGES ON db_aduser.* TO posh@'192.168.3.99';           # полный доступ для posh к БД db_aduser
</span><span class="z-text z-plain">GRANT ALL PRIVILEGES ON *.* TO posh@'%';                              # доступ к всем БД c любого клиентского хоста
</span><span class="z-text z-plain">GRANT SELECT,DELETE ON mysql.* TO posh@'%';                           # права SELECT и DELETE на встроенную БД mysql
</span><span class="z-text z-plain">REVOKE DELETE ON mysql.* FROM posh@'%';                               # удалить доступ DELETE
</span><span class="z-text z-plain">UPDATE mysql.user SET super_priv='Y' WHERE USER='posh' AND host='%';  # изменить привелегии для пользователя
</span><span class="z-text z-plain">SELECT USER,HOST,super_priv FROM mysql.user;                          # список УЗ и таблица с правами SUPER privilege
</span><span class="z-text z-plain">FLUSH PRIVILEGES;                                                     # обновить права доступа
</span></code></pre><h3 id=table><a aria-label="Anchor link for: table" class=zola-anchor href=#table><i class=icon></i></a> TABLE</h3><pre class=z-code><code><span class="z-text z-plain">SHOW TABLES;               # отобразить список всех таблиц
</span><span class="z-text z-plain">SHOW TABLES LIKE '%user';  # поиск таблицы по wildcard-имени
</span><span class="z-text z-plain">CREATE TABLE table_aduser (id INT NOT NULL AUTO_INCREMENT, Name VARCHAR(100), email VARCHAR(100), PRIMARY KEY (ID));  # создать таблицу
</span><span class="z-text z-plain">DROP TABLE table_aduser;   # удалить таблицу
</span></code></pre><h3 id=column><a aria-label="Anchor link for: column" class=zola-anchor href=#column><i class=icon></i></a> COLUMN</h3><pre class=z-code><code><span class="z-text z-plain">SHOW COLUMNS FROM table_aduser;                                                         # отобразить название стобцов и их свойства
</span><span class="z-text z-plain">ALTER TABLE table_aduser DROP COLUMN id;                                                # удалить столбец id
</span><span class="z-text z-plain">ALTER TABLE table_aduser ADD COLUMN info VARCHAR(10);                                   # добавить столбец info
</span><span class="z-text z-plain">ALTER TABLE table_aduser CHANGE info new_info VARCHAR(100);                             # изменить имя столбца info на new_info и его тип данных
</span><span class="z-text z-plain">ALTER TABLE table_aduser ADD COLUMN (id INT NOT NULL AUTO_INCREMENT, PRIMARY KEY (ID)); # добавить столбец id
</span></code></pre><h3 id=insert><a aria-label="Anchor link for: insert" class=zola-anchor href=#insert><i class=icon></i></a> INSERT</h3><pre class=z-code><code><span class="z-text z-plain">INSERT table_aduser (Name,email) VALUES ('Alex','no-email');
</span><span class="z-text z-plain">INSERT table_aduser (Name,email) VALUES ('Alex','no-email');
</span><span class="z-text z-plain">INSERT table_aduser (Name) VALUES ('Support');
</span><span class="z-text z-plain">INSERT table_aduser (Name) VALUES ('Jack');
</span></code></pre><h3 id=select><a aria-label="Anchor link for: select" class=zola-anchor href=#select><i class=icon></i></a> SELECT</h3><pre class=z-code><code><span class="z-text z-plain">SELECT * FROM table_aduser;                     # содержимое всех стобцов в выбранной (FROM) таблице
</span><span class="z-text z-plain">SELECT Name,email FROM table_aduser;            # содержимое указанных стобцов
</span><span class="z-text z-plain">SELECT DISTINCT Name,Email FROM table_aduser;   # отобразить уникальные записи (без повторений)
</span><span class="z-text z-plain">SELECT * FROM table_aduser ORDER BY Name;       # отсортировать по Name
</span><span class="z-text z-plain">SELECT * FROM table_aduser ORDER BY Name DESC;  # обратная сортировка
</span><span class="z-text z-plain">SELECT COUNT(*) FROM table_aduser;              # количество строк в таблице
</span><span class="z-text z-plain">SELECT COUNT(new_info) FROM table_aduser;       # количество строк в столбце
</span></code></pre><h3 id=where><a aria-label="Anchor link for: where" class=zola-anchor href=#where><i class=icon></i></a> WHERE</h3><pre class=z-code><code><span class="z-text z-plain">NOT; AND; OR                                                  # по приоритетам условий
</span><span class="z-text z-plain">SELECT * FROM table_aduser WHERE Name = 'Alex';               # поиск по содержимому
</span><span class="z-text z-plain">SELECT * FROM table_aduser WHERE NOT Name != 'Alex';          # условие NOT где Name не равен значению
</span><span class="z-text z-plain">SELECT * FROM table_aduser WHERE email != '';                 # вывести строки, где содержимое email не рано null
</span><span class="z-text z-plain">SELECT * FROM table_aduser WHERE email != '' OR id > 1000;    # или id выше 1000
</span><span class="z-text z-plain">SELECT * FROM table_aduser WHERE Name RLIKE "support";        # регистронезависемый (RLIKE) поиск
</span><span class="z-text z-plain">SELECT * FROM table_aduser WHERE Name RLIKE "^support";       # начинаются только с этого словосочетания
</span></code></pre><h3 id=delete><a aria-label="Anchor link for: delete" class=zola-anchor href=#delete><i class=icon></i></a> DELETE</h3><pre class=z-code><code><span class="z-text z-plain">SELECT * FROM table_aduser WHERE Name RLIKE "alex";   # найти и проверить значения перед удалением
</span><span class="z-text z-plain">DELETE FROM table_aduser WHERE Name RLIKE "alex";     # Query OK, 2 rows affected # удалено две строки
</span><span class="z-text z-plain">DELETE FROM table_aduser;                             # удалить ВСЕ значения
</span></code></pre><h3 id=update><a aria-label="Anchor link for: update" class=zola-anchor href=#update><i class=icon></i></a> UPDATE</h3><pre class=z-code><code><span class="z-text z-plain">SELECT * FROM table_aduser WHERE Name = 'Jack';             # найти и проверить значение перед изменением
</span><span class="z-text z-plain">UPDATE table_aduser SET Name = 'Alex' WHERE Name = 'Jack';  # изменить значение 'Jack' на 'Alex'
</span><span class="z-text z-plain">UPDATE db_aduser.table_aduser SET Name='BCA' WHERE id=1;    # изменить значение в строке с ID 1
</span></code></pre><h3 id=check><a aria-label="Anchor link for: check" class=zola-anchor href=#check><i class=icon></i></a> CHECK</h3><pre class=z-code><code><span class="z-text z-plain">CHECK TABLE db_aduser.table_aduser;     # проверить
</span><span class="z-text z-plain">ANALYZE TABLE db_aduser.table_aduser;   # анализировать
</span><span class="z-text z-plain">OPTIMIZE TABLE db_aduser.table_aduser;  # оптимизировать
</span><span class="z-text z-plain">REPAIR TABLE db_aduser.table_aduser;    # восстановить
</span><span class="z-text z-plain">TRUNCATE TABLE db_aduser.table_aduser;  # очистить
</span></code></pre><h3 id=dump><a aria-label="Anchor link for: dump" class=zola-anchor href=#dump><i class=icon></i></a> DUMP</h3><pre class=z-code><code><span class="z-text z-plain">mysqldump -u root -p --databases db_aduser > /bak/db_aduser.sql
</span><span class="z-text z-plain">mysql -u root -p db_aduser < /bak/db_aduser.sql
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">crontab -e
</span><span class="z-text z-plain">00 22 * * * /usr/bin/mysqldump -uroot -p1qaz!QAZ db_zabbix | /bin/bzip2 > `date +/dump/zabbix/zabbix-\%d-\%m-\%Y-\%H:\%M.bz2`
</span><span class="z-text z-plain">00 23 * * * /usr/bin/mysqldump -uroot -p1qaz!QAZ db_zabbix > `date +/dump/smb/zabbix-\%d-\%m-\%Y-\%H:\%M.sql`
</span><span class="z-text z-plain">0 0 * * * find /dump/zabbix -mtime +7 -exec rm {} \;
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">mysqldump -u root --single-transaction db_zabbix > /dump/zabbix/db_zabbix.sql
</span><span class="z-text z-plain">mysql -u user_zabbix -p -e 'CREATE DATABASE db_zabbix;'
</span><span class="z-text z-plain">mysql -u user_zabbix -p db_zabbix < /root/db_zabbix.sql
</span></code></pre><h3 id=innodb-force-recovery><a aria-label="Anchor link for: innodb-force-recovery" class=zola-anchor href=#innodb-force-recovery><i class=icon></i></a> innodb_force_recovery</h3><pre class=z-code><code><span class="z-text z-plain">sed -i '/innodb_force_recovery/d' /etc/mysql/my.cnf # удалить
</span><span class="z-text z-plain">mode=6; sed -i "/^\[mysqld\]/{N;s/$/\ninnodb_force_recovery=$mode/}" /etc/mysql/my.cnf # добавить mode 6
</span><span class="z-text z-plain">systemctl restart mysql
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[mysqld]
</span><span class="z-text z-plain">innodb_force_recovery=1 # сервер пытается начать работу независимо от того, есть ли поврежденные данные InnoDB или нет
</span><span class="z-text z-plain">innodb_force_recovery=2 # удается восстановить работу за счет остановки потока команд, которые были частично выполнены или не выполнены (не запускает фоновые операции)
</span><span class="z-text z-plain">innodb_force_recovery=3 # отменяет откат после восстановления поврежденных файлов (не пытается откатить транзакции)
</span><span class="z-text z-plain">innodb_force_recovery=6 # запуск СУБД в режиме read only
</span></code></pre><h2 id=mysql-connector-net><a aria-label="Anchor link for: mysql-connector-net" class=zola-anchor href=#mysql-connector-net><i class=icon></i></a> MySQL Connector NET</h2><h3 id=add-aduser><a aria-label="Anchor link for: add-aduser" class=zola-anchor href=#add-aduser><i class=icon></i></a> Add-ADUser</h3><pre class="language-powershell z-code" data-lang=powershell><code class=language-powershell data-lang=powershell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>ip</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>192.168.1.253<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>user</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>posh<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>pass</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>1qaz!QAZ<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>db</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>db_aduser<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Add-Type</span> –Path <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Documents\MySQL-Connector-NET\8.0.31-4.8\MySql.Data.dll<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Connection</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">MySql.Data.MySqlClient.MySqlConnection</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span><span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">ConnectionString</span><span class="z-keyword z-operator z-assignment z-powershell">=</span></span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>server=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>ip</span>;uid=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>user</span>;pwd=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>pass</span>;database=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>db</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Connection<span class="z-variable z-other z-member z-powershell">.Open</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Command</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> MySql.Data.MySqlClient.MySqlCommand
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Command<span class="z-variable z-other z-member z-powershell">.Connection</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Connection</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>UserList</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">Get-ADUser</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>filter <span class="z-keyword z-operator z-assignment z-powershell">*</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>properties name<span class="z-keyword z-operator z-other z-powershell">,</span>EmailAddress
</span><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">foreach</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>user</span> <span class="z-keyword z-control z-powershell">in</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>UserList</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>uname</span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>user<span class="z-variable z-other z-member z-powershell">.Name</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>uemail</span><span class="z-keyword z-operator z-assignment z-powershell">=</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>user<span class="z-variable z-other z-member z-powershell">.EmailAddress</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Command<span class="z-variable z-other z-member z-powershell">.CommandText</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>INSERT INTO table_aduser (Name,Email) VALUES ('<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>uname</span>','<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>uemail</span>')<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Command<span class="z-variable z-other z-member z-powershell">.ExecuteNonQuery</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Connection<span class="z-variable z-other z-member z-powershell">.Close</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></code></pre><h3 id=get-aduser><a aria-label="Anchor link for: get-aduser" class=zola-anchor href=#get-aduser><i class=icon></i></a> Get-ADUser</h3><pre class="language-powershell z-code" data-lang=powershell><code class=language-powershell data-lang=powershell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>ip</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>192.168.1.253<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>user</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>posh<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>pass</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>1qaz!QAZ<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>db</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>db_aduser<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Add-Type</span> –Path <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Documents\MySQL-Connector-NET\8.0.31-4.8\MySql.Data.dll<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Connection</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">MySql.Data.MySqlClient.MySqlConnection</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span><span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">ConnectionString</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>server=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>ip</span>;uid=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>user</span>;pwd=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>pass</span>;database=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>db</span><span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Connection<span class="z-variable z-other z-member z-powershell">.Open</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Command</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> MySql.Data.MySqlClient.MySqlCommand
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Command<span class="z-variable z-other z-member z-powershell">.Connection</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Connection</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>MYSQLDataAdapter</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> MySql.Data.MySqlClient.MySqlDataAdapter
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>MYSQLDataSet</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> System.Data.DataSet
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Command<span class="z-variable z-other z-member z-powershell">.CommandText</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>SELECT * FROM table_aduser<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>MYSQLDataAdapter<span class="z-variable z-other z-member z-powershell">.SelectCommand</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Command</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>NumberOfDataSets</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>MYSQLDataAdapter<span class="z-variable z-other z-member z-powershell">.Fill</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>MYSQLDataSet</span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>data<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Collections</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> System.Collections.Generic.List<span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">System.Object</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>
</span><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">foreach</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>DataSet</span> <span class="z-keyword z-control z-powershell">in</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>MYSQLDataSet<span class="z-variable z-other z-member z-powershell">.tables</span></span><span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-constant z-numeric z-integer z-powershell">0</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Collections<span class="z-variable z-other z-member z-powershell">.Add</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">PSCustomObject</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span><span class="z-meta z-hashtable z-powershell"><span class="z-keyword z-other z-hashtable z-begin z-powershell">@</span><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-interpolated z-simple z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">Name</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>DataSet<span class="z-variable z-other z-member z-powershell">.name</span></span><span class="z-punctuation z-terminator z-statement z-powershell">;</span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-interpolated z-simple z-source z-powershell"><span class="z-meta z-hashtable z-powershell">    <span class="z-meta z-hashtable z-assignment z-powershell"><span class="z-variable z-other z-readwrite z-powershell">Mail</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> </span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>DataSet<span class="z-variable z-other z-member z-powershell">.email</span></span>
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-interpolated z-simple z-source z-powershell"><span class="z-meta z-hashtable z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Connection<span class="z-variable z-other z-member z-powershell">.Close</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Collections</span>
</span></code></pre><h2 id=mssql><a aria-label="Anchor link for: mssql" class=zola-anchor href=#mssql><i class=icon></i></a> MSSQL</h2><p><code>wget -qO- https://packages.microsoft.com/keys/microsoft.asc | apt-key add -</code> импортировать GPG-ключ для репозитория<br> <code>https://packages.microsoft.com/config/ubuntu/</code> выбрать репозиторий и скопировать URL<br> <code>add-apt-repository "$(wget -qO- https://packages.microsoft.com/config/ubuntu/20.04/mssql-server-2019.list)"</code><br> <code>apt-get update</code> обновить список пакетов<br> <code>apt-get install mssql-server</code><br> <code>/opt/mssql/bin/mssql-conf setup</code> скрипт начальной конфигурации (выбрать редакцию, 3 - express и русский язык 9 из 11)<br> <code>systemctl status mssql-server</code><br> <code>curl https://packages.microsoft.com/keys/microsoft.asc | apt-key add -</code> установить клиент<br> <code>curl https://packages.microsoft.com/config/ubuntu/20.04/prod.list | tee /etc/apt/sources.list.d/msprod.list</code><br> <code>apt-get update</code><br> <code>apt-get install mssql-tools</code><br> <code>echo 'export PATH="$PATH:/opt/mssql-tools/bin"' >> ~/.bashrc</code> добавить в домашний каталог файла bashrc, что бы не писать путь к исполняемому файлу<br> <code>export PATH="$PATH:/opt/mssql-tools/bin"</code><br> <code>iptables -I INPUT 1 -p tcp --dport 1433 -j ACCEPT</code><pre class=z-code><code><span class="z-text z-plain">sqlcmd -S localhost -U SA
</span><span class="z-text z-plain">CREATE DATABASE itinvent
</span><span class="z-text z-plain">go
</span><span class="z-text z-plain">SELECT name FROM master.dbo.sysdatabases
</span><span class="z-text z-plain">go
</span></code></pre><h3 id=system-data-sqlclient><a aria-label="Anchor link for: system-data-sqlclient" class=zola-anchor href=#system-data-sqlclient><i class=icon></i></a> System.Data.SqlClient</h3><pre class="language-powershell z-code" data-lang=powershell><code class=language-powershell data-lang=powershell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>user</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>itinvent<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>pass</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>itinvent<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>db</span>   <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>itinvent<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>srv</span>  <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>192.168.3.103<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlConnection</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> System.Data.SqlClient.SqlConnection
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlConnection<span class="z-variable z-other z-member z-powershell">.ConnectionString</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>server=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>srv</span>;database=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>db</span>;user id=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>user</span>;password=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>pass</span>;Integrated Security=false<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlCommand</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> System.Data.SqlClient.SqlCommand<span class="z-keyword z-operator z-other z-powershell">`</span> класс формата команды
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlCommand<span class="z-variable z-other z-member z-powershell">.CommandText</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>SELECT * FROM ITINVENT.dbo.USERS<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-other z-powershell">`</span> отобразить содержимое таблицы
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span>$SqlCommand.CommandText = "SELECT LICENCE_DATE,DESCR,MODEL_NO,TYPE_NO FROM ITINVENT.dbo.ITEMS where LICENCE_DATE IS NOT NULL"<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlCommand<span class="z-variable z-other z-member z-powershell">.Connection</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlConnection</span><span class="z-keyword z-operator z-other z-powershell">`</span> передать формат подключения
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlAdapter</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> System.Data.SqlClient.SqlDataAdapter<span class="z-keyword z-operator z-other z-powershell">`</span> создать адаптер подключения для выполнения SELECT запросов к БД
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlAdapter<span class="z-variable z-other z-member z-powershell">.SelectCommand</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlCommand</span><span class="z-keyword z-operator z-other z-powershell">`</span> передать команду
</span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>DataSet</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> System.Data.DataSet<span class="z-keyword z-operator z-other z-powershell">`</span> создать объект приема данных формата XML
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlAdapter<span class="z-variable z-other z-member z-powershell">.Fill</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>DataSet</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span><span class="z-keyword z-operator z-other z-powershell">`</span> заполнить данными полученные от адаптера <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell">возвращает кол<span class="z-keyword z-operator z-assignment z-powershell">-</span>во объектов</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlConnection<span class="z-variable z-other z-member z-powershell">.Close</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Data</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>DataSet<span class="z-variable z-other z-member z-powershell">.Tables</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Data</span><span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-constant z-numeric z-integer z-powershell">0</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span> <span class="z-keyword z-operator z-other z-powershell">|</span> ft
</span></code></pre><h3 id=sqlclient-insert><a aria-label="Anchor link for: sqlclient-insert" class=zola-anchor href=#sqlclient-insert><i class=icon></i></a> SqlClient INSERT</h3><pre class="language-powershell z-code" data-lang=powershell><code class=language-powershell data-lang=powershell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>user</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>itinvent<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>pass</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>itinvent<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>db</span>   <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>db_test<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>srv</span>  <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>192.168.3.103<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>sql</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>INSERT INTO table_test (column_user) VALUES ('lifailon')<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-other z-powershell">`</span> добавить данные в таблицу table_test в колонку column_user
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlConnection</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> System.Data.SqlClient.SqlConnection
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlConnection<span class="z-variable z-other z-member z-powershell">.ConnectionString</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>server=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>srv</span>;database=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>db</span>;user id=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>user</span>;password=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>pass</span>;Integrated Security=false<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlCommand</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> System.Data.SqlClient.SqlCommand
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlCommand<span class="z-variable z-other z-member z-powershell">.CommandText</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>sql</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlCommand<span class="z-variable z-other z-member z-powershell">.Connection</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlConnection</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlConnection<span class="z-variable z-other z-member z-powershell">.Open</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>rowsAffected</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlCommand<span class="z-variable z-other z-member z-powershell">.ExecuteNonQuery</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span><span class="z-punctuation z-terminator z-statement z-powershell">;</span><span class="z-keyword z-operator z-other z-powershell">`</span> для запросов INSERT<span class="z-keyword z-operator z-assignment z-powershell">/</span>UPDATE<span class="z-keyword z-operator z-assignment z-powershell">/</span>DELETE не используется SqlDataAdapter
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>SqlConnection<span class="z-variable z-other z-member z-powershell">.Close</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></code></pre><h3 id=ssms-insert><a aria-label="Anchor link for: ssms-insert" class=zola-anchor href=#ssms-insert><i class=icon></i></a> SSMS INSERT</h3><pre class=z-code><code><span class="z-text z-plain">USE [db_test]
</span><span class="z-text z-plain">GO
</span><span class="z-text z-plain">INSERT INTO [dbo].[table_test]
</span><span class="z-text z-plain">           ([column_user])
</span><span class="z-text z-plain">     VALUES
</span><span class="z-text z-plain">           ('lifailon')
</span><span class="z-text z-plain">GO
</span><span class="z-text z-plain">SELECT TOP (1000) [column_user]
</span><span class="z-text z-plain">FROM [db_test].[dbo].[table_test]
</span></code></pre><h3 id=t-sql><a aria-label="Anchor link for: t-sql" class=zola-anchor href=#t-sql><i class=icon></i></a> T-SQL</h3><ul><li><p>DDL (Data Definition Language / Язык определения данных). К этому типу относятся команды, которые создают базу данных, таблицы, индексы, хранимые процедуры.<br> <code>CREATE</code> создает объекты базы данных (саму базу даных, таблицы, индексы и т.д.)<br> <code>ALTER</code> изменяет объекты базы данных<br> <code>DROP</code> удаляет объекты базы данных<br> <code>TRUNCATE</code> удаляет все данные из таблиц</p><li><p>DML (Data Manipulation Language / Язык манипуляции данными). К этому типу относят команды по выбору, обновлению, добавлению и удалению данных.<br> <code>SELECT</code> извлекает данные из БД<br> <code>UPDATE</code> обновляет данные<br> <code>INSERT</code> добавляет новые данные<br> <code>DELETE</code> удаляет данные</p><li><p>DCL (Data Control Language / Язык управления доступа к данным). К этому типу относят команды, которые управляют правами по доступу к данным.<br> <code>GRANT</code> предоставляет права для доступа к данным<br> <code>REVOKE</code> отзывает права на доступ к данным</p></ul><pre class="language-sql z-code" data-lang=sql><code class=language-sql data-lang=sql><span class="z-source z-sql">    <span class="z-comment z-line z-double-dash z-sql"><span class="z-punctuation z-definition z-comment z-sql">--</span> Переменные
</span></span><span class="z-source z-sql">    DECLARE @<span class="z-storage z-type z-sql">text</span> <span class="z-storage z-type z-sql">NVARCHAR</span>(<span class="z-constant z-numeric z-sql">20</span>), @<span class="z-storage z-type z-sql">int</span> <span class="z-storage z-type z-sql">INT</span>;
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">SET</span> @<span class="z-storage z-type z-sql">text</span><span class="z-keyword z-operator z-comparison z-sql">=</span><span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span>Test<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span>;
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">SET</span> @<span class="z-storage z-type z-sql">int</span> <span class="z-keyword z-operator z-comparison z-sql">=</span> <span class="z-constant z-numeric z-sql">21</span>;
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">select</span> @<span class="z-storage z-type z-sql">text</span>,@<span class="z-storage z-type z-sql">int</span>
</span><span class="z-source z-sql">
</span><span class="z-source z-sql">    <span class="z-comment z-line z-double-dash z-sql"><span class="z-punctuation z-definition z-comment z-sql">--</span> Имена сервера и экземпляра 
</span></span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">Select</span> @@SERVERNAME <span class="z-keyword z-operator z-assignment z-alias z-sql">as</span> [Server\Instance]; 
</span><span class="z-source z-sql">
</span><span class="z-source z-sql">    <span class="z-comment z-line z-double-dash z-sql"><span class="z-punctuation z-definition z-comment z-sql">--</span> версия SQL Server 
</span></span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">Select</span> @@VERSION <span class="z-keyword z-operator z-assignment z-alias z-sql">as</span> SQLServerVersion; 
</span><span class="z-source z-sql">
</span><span class="z-source z-sql">    <span class="z-comment z-line z-double-dash z-sql"><span class="z-punctuation z-definition z-comment z-sql">--</span> Текущая БД (БД, в контексте которой выполняется запрос)
</span></span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">Select</span> DB_NAME<span class="z-meta z-block z-sql"><span class="z-punctuation z-section z-scope z-begin z-sql">(</span><span class="z-punctuation z-section z-scope z-end z-sql">)</span></span> <span class="z-keyword z-operator z-assignment z-alias z-sql">AS</span> CurrentDB_Name;
</span><span class="z-source z-sql">
</span><span class="z-source z-sql">    <span class="z-comment z-line z-double-dash z-sql"><span class="z-punctuation z-definition z-comment z-sql">--</span> Время работы с момента запуска сервера
</span></span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">SELECT</span>  @@Servername <span class="z-keyword z-operator z-assignment z-alias z-sql">AS</span> ServerName ,
</span><span class="z-source z-sql">            create_date <span class="z-keyword z-operator z-assignment z-alias z-sql">AS</span>  ServerStarted ,
</span><span class="z-source z-sql">            DATEDIFF(s, create_date, GETDATE<span class="z-meta z-block z-sql"><span class="z-punctuation z-section z-scope z-begin z-sql">(</span><span class="z-punctuation z-section z-scope z-end z-sql">)</span></span>) <span class="z-keyword z-operator z-math z-sql">/</span> <span class="z-constant z-numeric z-sql">86400</span>.<span class="z-constant z-numeric z-sql">0</span> <span class="z-keyword z-operator z-assignment z-alias z-sql">AS</span> DaysRunning ,
</span><span class="z-source z-sql">            DATEDIFF(s, create_date, GETDATE<span class="z-meta z-block z-sql"><span class="z-punctuation z-section z-scope z-begin z-sql">(</span><span class="z-punctuation z-section z-scope z-end z-sql">)</span></span>) <span class="z-keyword z-operator z-assignment z-alias z-sql">AS</span> SecondsRunnig
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">FROM</span>    <span class="z-constant z-other z-database-name z-sql">sys</span>.<span class="z-constant z-other z-table-name z-sql">databases</span>
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">WHERE</span>   name <span class="z-keyword z-operator z-comparison z-sql">=</span> <span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span>tempdb<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span>;
</span><span class="z-source z-sql">
</span><span class="z-source z-sql">    <span class="z-comment z-line z-double-dash z-sql"><span class="z-punctuation z-definition z-comment z-sql">--</span> Количество активных соединений
</span></span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">SELECT</span>  @@Servername <span class="z-keyword z-operator z-assignment z-alias z-sql">AS</span> Server ,
</span><span class="z-source z-sql">            DB_NAME(database_id) <span class="z-keyword z-operator z-assignment z-alias z-sql">AS</span> DatabaseName ,
</span><span class="z-source z-sql">            <span class="z-support z-function z-aggregate z-sql">COUNT</span>(database_id) <span class="z-keyword z-operator z-assignment z-alias z-sql">AS</span> Connections ,
</span><span class="z-source z-sql">            Login_name <span class="z-keyword z-operator z-assignment z-alias z-sql">AS</span>  LoginName ,
</span><span class="z-source z-sql">            <span class="z-support z-function z-aggregate z-sql">MIN</span>(Login_Time) <span class="z-keyword z-operator z-assignment z-alias z-sql">AS</span> Login_Time ,
</span><span class="z-source z-sql">            <span class="z-support z-function z-aggregate z-sql">MIN</span>(COALESCE(last_request_end_time, last_request_start_time))
</span><span class="z-source z-sql">                                                             <span class="z-keyword z-operator z-assignment z-alias z-sql">AS</span>  Last_Batch
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">FROM</span>    <span class="z-constant z-other z-database-name z-sql">sys</span>.<span class="z-constant z-other z-table-name z-sql">dm_exec_sessions</span>
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">WHERE</span>   database_id <span class="z-keyword z-operator z-comparison z-sql">></span> <span class="z-constant z-numeric z-sql">0</span>
</span><span class="z-source z-sql">            <span class="z-keyword z-operator z-logical z-sql">AND</span> DB_NAME(database_id) NOT <span class="z-keyword z-operator z-logical z-sql">IN</span> ( <span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span>master<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span>, <span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span>msdb<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span> )
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">GROUP BY</span> database_id ,
</span><span class="z-source z-sql">             login_name
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">ORDER BY</span> DatabaseName;
</span><span class="z-source z-sql">
</span><span class="z-source z-sql">    <span class="z-comment z-line z-double-dash z-sql"><span class="z-punctuation z-definition z-comment z-sql">--</span> Статус Backup
</span></span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">SELECT</span>  @@Servername <span class="z-keyword z-operator z-assignment z-alias z-sql">AS</span> ServerName ,
</span><span class="z-source z-sql">            <span class="z-constant z-other z-database-name z-sql">d</span>.<span class="z-constant z-other z-table-name z-sql">Name</span> <span class="z-keyword z-operator z-assignment z-alias z-sql">AS</span> DBName ,
</span><span class="z-source z-sql">            <span class="z-support z-function z-aggregate z-sql">MAX</span>(<span class="z-constant z-other z-database-name z-sql">b</span>.<span class="z-constant z-other z-table-name z-sql">backup_finish_date</span>) <span class="z-keyword z-operator z-assignment z-alias z-sql">AS</span> LastBackupCompleted
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">FROM</span>    <span class="z-constant z-other z-database-name z-sql">sys</span>.<span class="z-constant z-other z-table-name z-sql">databases</span> d
</span><span class="z-source z-sql">            <span class="z-keyword z-other z-DML z-sql">LEFT OUTER JOIN</span> msdb..backupset b
</span><span class="z-source z-sql">                        ON <span class="z-constant z-other z-database-name z-sql">b</span>.<span class="z-constant z-other z-table-name z-sql">database_name</span> <span class="z-keyword z-operator z-comparison z-sql">=</span> <span class="z-constant z-other z-database-name z-sql">d</span>.<span class="z-constant z-other z-table-name z-sql">name</span>
</span><span class="z-source z-sql">                           <span class="z-keyword z-operator z-logical z-sql">AND</span> b.[type] <span class="z-keyword z-operator z-comparison z-sql">=</span> <span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span>D<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span>
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">GROUP BY</span> <span class="z-constant z-other z-database-name z-sql">d</span>.<span class="z-constant z-other z-table-name z-sql">Name</span>
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">ORDER BY</span> <span class="z-constant z-other z-database-name z-sql">d</span>.<span class="z-constant z-other z-table-name z-sql">Name</span>;
</span><span class="z-source z-sql">
</span><span class="z-source z-sql">    <span class="z-comment z-line z-double-dash z-sql"><span class="z-punctuation z-definition z-comment z-sql">--</span> Путь к Backup
</span></span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">SELECT</span>  @@Servername <span class="z-keyword z-operator z-assignment z-alias z-sql">AS</span> ServerName ,
</span><span class="z-source z-sql">            <span class="z-constant z-other z-database-name z-sql">d</span>.<span class="z-constant z-other z-table-name z-sql">Name</span> <span class="z-keyword z-operator z-assignment z-alias z-sql">AS</span> DBName ,
</span><span class="z-source z-sql">            <span class="z-constant z-other z-database-name z-sql">b</span>.<span class="z-constant z-other z-table-name z-sql">Backup_finish_date</span> ,
</span><span class="z-source z-sql">            <span class="z-constant z-other z-database-name z-sql">bmf</span>.<span class="z-constant z-other z-table-name z-sql">Physical_Device_name</span>
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">FROM</span>    <span class="z-constant z-other z-database-name z-sql">sys</span>.<span class="z-constant z-other z-table-name z-sql">databases</span> d
</span><span class="z-source z-sql">            <span class="z-keyword z-other z-DML z-sql">INNER JOIN</span> msdb..backupset b ON <span class="z-constant z-other z-database-name z-sql">b</span>.<span class="z-constant z-other z-table-name z-sql">database_name</span> <span class="z-keyword z-operator z-comparison z-sql">=</span> <span class="z-constant z-other z-database-name z-sql">d</span>.<span class="z-constant z-other z-table-name z-sql">name</span>
</span><span class="z-source z-sql">                                            <span class="z-keyword z-operator z-logical z-sql">AND</span> b.[type] <span class="z-keyword z-operator z-comparison z-sql">=</span> <span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span>D<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span>
</span><span class="z-source z-sql">            <span class="z-keyword z-other z-DML z-sql">INNER JOIN</span> <span class="z-constant z-other z-database-name z-sql">msdb</span>.<span class="z-constant z-other z-table-name z-sql">dbo</span>.backupmediafamily bmf ON <span class="z-constant z-other z-database-name z-sql">b</span>.<span class="z-constant z-other z-table-name z-sql">media_set_id</span> <span class="z-keyword z-operator z-comparison z-sql">=</span> <span class="z-constant z-other z-database-name z-sql">bmf</span>.<span class="z-constant z-other z-table-name z-sql">media_set_id</span>
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">ORDER BY</span> <span class="z-constant z-other z-database-name z-sql">d</span>.<span class="z-constant z-other z-table-name z-sql">NAME</span> ,
</span><span class="z-source z-sql">            <span class="z-constant z-other z-database-name z-sql">b</span>.<span class="z-constant z-other z-table-name z-sql">Backup_finish_date</span> <span class="z-keyword z-other z-order z-sql">DESC</span>; 
</span><span class="z-source z-sql">
</span><span class="z-source z-sql">    <span class="z-comment z-line z-double-dash z-sql"><span class="z-punctuation z-definition z-comment z-sql">--</span> Вывести список всех БД, модели восстановления и путь к mdf/ldf
</span></span><span class="z-source z-sql">    EXEC sp_helpdb; 
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">SELECT</span>  @@SERVERNAME <span class="z-keyword z-operator z-assignment z-alias z-sql">AS</span> Server ,
</span><span class="z-source z-sql">            <span class="z-constant z-other z-database-name z-sql">d</span>.<span class="z-constant z-other z-table-name z-sql">name</span> <span class="z-keyword z-operator z-assignment z-alias z-sql">AS</span> DBName ,
</span><span class="z-source z-sql">            create_date ,
</span><span class="z-source z-sql">            recovery_model_Desc <span class="z-keyword z-operator z-assignment z-alias z-sql">AS</span> RecoveryModel ,
</span><span class="z-source z-sql">            <span class="z-constant z-other z-database-name z-sql">m</span>.<span class="z-constant z-other z-table-name z-sql">physical_name</span> <span class="z-keyword z-operator z-assignment z-alias z-sql">AS</span> FileName
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">FROM</span>    <span class="z-constant z-other z-database-name z-sql">sys</span>.<span class="z-constant z-other z-table-name z-sql">databases</span> d
</span><span class="z-source z-sql">            <span class="z-keyword z-other z-DML z-sql">JOIN</span> <span class="z-constant z-other z-database-name z-sql">sys</span>.<span class="z-constant z-other z-table-name z-sql">master_files</span> m ON <span class="z-constant z-other z-database-name z-sql">d</span>.<span class="z-constant z-other z-table-name z-sql">database_id</span> <span class="z-keyword z-operator z-comparison z-sql">=</span> <span class="z-constant z-other z-database-name z-sql">m</span>.<span class="z-constant z-other z-table-name z-sql">database_id</span>
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">ORDER BY</span> <span class="z-constant z-other z-database-name z-sql">d</span>.<span class="z-constant z-other z-table-name z-sql">name</span>;
</span><span class="z-source z-sql">
</span><span class="z-source z-sql">    <span class="z-comment z-line z-double-dash z-sql"><span class="z-punctuation z-definition z-comment z-sql">--</span> Размер БД
</span></span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">with</span> fs
</span><span class="z-source z-sql">    <span class="z-keyword z-operator z-assignment z-alias z-sql">as</span>
</span><span class="z-source z-sql">    (
</span><span class="z-source z-sql">        <span class="z-keyword z-other z-DML z-sql">select</span> database_id, type, size <span class="z-variable z-language z-star z-sql">*</span> <span class="z-constant z-numeric z-sql">8</span>.<span class="z-constant z-numeric z-sql">0</span> <span class="z-keyword z-operator z-math z-sql">/</span> <span class="z-constant z-numeric z-sql">1024</span> size
</span><span class="z-source z-sql">        <span class="z-keyword z-other z-DML z-sql">from</span> <span class="z-constant z-other z-database-name z-sql">sys</span>.<span class="z-constant z-other z-table-name z-sql">master_files</span>
</span><span class="z-source z-sql">    )
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">select</span> 
</span><span class="z-source z-sql">        name,
</span><span class="z-source z-sql">        (<span class="z-keyword z-other z-DML z-sql">select</span> <span class="z-support z-function z-aggregate z-sql">sum</span>(size) <span class="z-keyword z-other z-DML z-sql">from</span> fs <span class="z-keyword z-other z-DML z-sql">where</span> type <span class="z-keyword z-operator z-comparison z-sql">=</span> <span class="z-constant z-numeric z-sql">0</span> <span class="z-keyword z-operator z-logical z-sql">and</span> <span class="z-constant z-other z-database-name z-sql">fs</span>.<span class="z-constant z-other z-table-name z-sql">database_id</span> <span class="z-keyword z-operator z-comparison z-sql">=</span> <span class="z-constant z-other z-database-name z-sql">db</span>.<span class="z-constant z-other z-table-name z-sql">database_id</span>) DataFileSizeMB,
</span><span class="z-source z-sql">        (<span class="z-keyword z-other z-DML z-sql">select</span> <span class="z-support z-function z-aggregate z-sql">sum</span>(size) <span class="z-keyword z-other z-DML z-sql">from</span> fs <span class="z-keyword z-other z-DML z-sql">where</span> type <span class="z-keyword z-operator z-comparison z-sql">=</span> <span class="z-constant z-numeric z-sql">1</span> <span class="z-keyword z-operator z-logical z-sql">and</span> <span class="z-constant z-other z-database-name z-sql">fs</span>.<span class="z-constant z-other z-table-name z-sql">database_id</span> <span class="z-keyword z-operator z-comparison z-sql">=</span> <span class="z-constant z-other z-database-name z-sql">db</span>.<span class="z-constant z-other z-table-name z-sql">database_id</span>) LogFileSizeMB
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">from</span> <span class="z-constant z-other z-database-name z-sql">sys</span>.<span class="z-constant z-other z-table-name z-sql">databases</span> 
</span><span class="z-source z-sql">
</span><span class="z-source z-sql">    <span class="z-comment z-line z-double-dash z-sql"><span class="z-punctuation z-definition z-comment z-sql">--</span> Поиск таблицы по маске имени (вывод: названия схемы где распологается объект, тип объекта, дата создания и последней модификации):
</span></span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">select</span> [object_id], [schema_id],
</span><span class="z-source z-sql">           schema_name([schema_id]) <span class="z-keyword z-operator z-assignment z-alias z-sql">as</span> [schema_name], 
</span><span class="z-source z-sql">           [name], 
</span><span class="z-source z-sql">           [type], 
</span><span class="z-source z-sql">           [type_desc], 
</span><span class="z-source z-sql">           [create_date], 
</span><span class="z-source z-sql">           [modify_date]
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">from</span> <span class="z-constant z-other z-database-name z-sql">sys</span>.<span class="z-constant z-other z-table-name z-sql">all_objects</span>
</span><span class="z-source z-sql">    <span class="z-comment z-line z-double-dash z-sql"><span class="z-punctuation z-definition z-comment z-sql">--</span> where [name]='INVENT';
</span></span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">where</span> [name] <span class="z-keyword z-operator z-logical z-sql">like</span> <span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span>%INVENT%<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span>;
</span><span class="z-source z-sql">
</span><span class="z-source z-sql">    <span class="z-comment z-line z-double-dash z-sql"><span class="z-punctuation z-definition z-comment z-sql">--</span> Кол-во строк в таблицах
</span></span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">SELECT</span>  @@ServerName <span class="z-keyword z-operator z-assignment z-alias z-sql">AS</span> Server ,
</span><span class="z-source z-sql">            DB_NAME<span class="z-meta z-block z-sql"><span class="z-punctuation z-section z-scope z-begin z-sql">(</span><span class="z-punctuation z-section z-scope z-end z-sql">)</span></span> <span class="z-keyword z-operator z-assignment z-alias z-sql">AS</span> DBName ,
</span><span class="z-source z-sql">            OBJECT_SCHEMA_NAME(<span class="z-constant z-other z-database-name z-sql">p</span>.<span class="z-constant z-other z-table-name z-sql">object_id</span>) <span class="z-keyword z-operator z-assignment z-alias z-sql">AS</span> SchemaName ,
</span><span class="z-source z-sql">            OBJECT_NAME(<span class="z-constant z-other z-database-name z-sql">p</span>.<span class="z-constant z-other z-table-name z-sql">object_id</span>) <span class="z-keyword z-operator z-assignment z-alias z-sql">AS</span> TableName ,
</span><span class="z-source z-sql">            <span class="z-constant z-other z-database-name z-sql">i</span>.<span class="z-constant z-other z-table-name z-sql">Type_Desc</span> ,
</span><span class="z-source z-sql">            <span class="z-constant z-other z-database-name z-sql">i</span>.<span class="z-constant z-other z-table-name z-sql">Name</span> <span class="z-keyword z-operator z-assignment z-alias z-sql">AS</span> IndexUsedForCounts ,
</span><span class="z-source z-sql">            <span class="z-support z-function z-aggregate z-sql">SUM</span>(<span class="z-constant z-other z-database-name z-sql">p</span>.<span class="z-constant z-other z-table-name z-sql">Rows</span>) <span class="z-keyword z-operator z-assignment z-alias z-sql">AS</span> Rows
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">FROM</span>    <span class="z-constant z-other z-database-name z-sql">sys</span>.<span class="z-constant z-other z-table-name z-sql">partitions</span> p
</span><span class="z-source z-sql">            <span class="z-keyword z-other z-DML z-sql">JOIN</span> <span class="z-constant z-other z-database-name z-sql">sys</span>.<span class="z-constant z-other z-table-name z-sql">indexes</span> i ON <span class="z-constant z-other z-database-name z-sql">i</span>.<span class="z-constant z-other z-table-name z-sql">object_id</span> <span class="z-keyword z-operator z-comparison z-sql">=</span> <span class="z-constant z-other z-database-name z-sql">p</span>.<span class="z-constant z-other z-table-name z-sql">object_id</span>
</span><span class="z-source z-sql">                                  <span class="z-keyword z-operator z-logical z-sql">AND</span> <span class="z-constant z-other z-database-name z-sql">i</span>.<span class="z-constant z-other z-table-name z-sql">index_id</span> <span class="z-keyword z-operator z-comparison z-sql">=</span> <span class="z-constant z-other z-database-name z-sql">p</span>.<span class="z-constant z-other z-table-name z-sql">index_id</span>
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">WHERE</span>   <span class="z-constant z-other z-database-name z-sql">i</span>.<span class="z-constant z-other z-table-name z-sql">type_desc</span> <span class="z-keyword z-operator z-logical z-sql">IN</span> ( <span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span>CLUSTERED<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span>, <span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span>HEAP<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span> )
</span><span class="z-source z-sql">                                 <span class="z-comment z-line z-double-dash z-sql"><span class="z-punctuation z-definition z-comment z-sql">--</span> This is key (1 index per table) 
</span></span><span class="z-source z-sql">            <span class="z-keyword z-operator z-logical z-sql">AND</span> OBJECT_SCHEMA_NAME(<span class="z-constant z-other z-database-name z-sql">p</span>.<span class="z-constant z-other z-table-name z-sql">object_id</span>) <span class="z-keyword z-operator z-comparison z-sql"><></span> <span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span>sys<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span>
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">GROUP BY</span> <span class="z-constant z-other z-database-name z-sql">p</span>.<span class="z-constant z-other z-table-name z-sql">object_id</span> ,
</span><span class="z-source z-sql">            <span class="z-constant z-other z-database-name z-sql">i</span>.<span class="z-constant z-other z-table-name z-sql">type_desc</span> ,
</span><span class="z-source z-sql">            <span class="z-constant z-other z-database-name z-sql">i</span>.<span class="z-constant z-other z-table-name z-sql">Name</span>
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">ORDER BY</span> SchemaName ,
</span><span class="z-source z-sql">            TableName; 
</span><span class="z-source z-sql">
</span><span class="z-source z-sql">    <span class="z-comment z-line z-double-dash z-sql"><span class="z-punctuation z-definition z-comment z-sql">--</span> Найти строковое (nvarchar) значение 2023 по всем таблицам базы данных
</span></span><span class="z-source z-sql">    <span class="z-comment z-line z-double-dash z-sql"><span class="z-punctuation z-definition z-comment z-sql">--</span> Отображается в какой таблице и столбце хранится значение, а также количество найденных пары таблица-колонка
</span></span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">set</span> nocount on
</span><span class="z-source z-sql">    declare @name <span class="z-storage z-type z-sql">varchar</span>(<span class="z-constant z-numeric z-sql">128</span>), @substr <span class="z-storage z-type z-sql">nvarchar</span>(<span class="z-constant z-numeric z-sql">4000</span>), @column <span class="z-storage z-type z-sql">varchar</span>(<span class="z-constant z-numeric z-sql">128</span>)
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">set</span> @substr <span class="z-keyword z-operator z-comparison z-sql">=</span> <span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span>%2023%<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span>
</span><span class="z-source z-sql">    declare @sql <span class="z-storage z-type z-sql">nvarchar</span>(max);
</span><span class="z-source z-sql">    <span class="z-meta z-create z-sql"><span class="z-keyword z-other z-create z-sql">create</span> <span class="z-keyword z-other z-sql">table</span></span><span class="z-meta z-toc-list z-full-identifier z-sql">`</span><span class="z-meta z-toc-list z-full-identifier z-sql"><span class="z-entity z-name z-function z-sql">rslt</span></span> 
</span><span class="z-source z-sql">    (table_name <span class="z-storage z-type z-sql">varchar</span>(<span class="z-constant z-numeric z-sql">128</span>), field_name <span class="z-storage z-type z-sql">varchar</span>(<span class="z-constant z-numeric z-sql">128</span>), [value] <span class="z-storage z-type z-sql">nvarchar</span>(max))
</span><span class="z-source z-sql">    declare s cursor for <span class="z-keyword z-other z-DML z-sql">select</span> table_name <span class="z-keyword z-operator z-assignment z-alias z-sql">as</span> table_name <span class="z-keyword z-other z-DML z-sql">from</span> <span class="z-constant z-other z-database-name z-sql">information_schema</span>.<span class="z-constant z-other z-table-name z-sql">tables</span> <span class="z-keyword z-other z-DML z-sql">where</span> table_type <span class="z-keyword z-operator z-comparison z-sql">=</span> <span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span>BASE TABLE<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span> <span class="z-keyword z-other z-DML z-sql">order by</span> table_name
</span><span class="z-source z-sql">    open s
</span><span class="z-source z-sql">    fetch next <span class="z-keyword z-other z-DML z-sql">from</span> s into @name
</span><span class="z-source z-sql">    while @@fetch_status <span class="z-keyword z-operator z-comparison z-sql">=</span> <span class="z-constant z-numeric z-sql">0</span>
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-LUW z-sql">begin</span>
</span><span class="z-source z-sql">    declare c cursor for 
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">select</span> quotename(column_name) <span class="z-keyword z-operator z-assignment z-alias z-sql">as</span> column_name <span class="z-keyword z-other z-DML z-sql">from</span> <span class="z-constant z-other z-database-name z-sql">information_schema</span>.<span class="z-constant z-other z-table-name z-sql">columns</span> 
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">where</span> data_type <span class="z-keyword z-operator z-logical z-sql">in</span> (<span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span>text<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span>, <span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span>ntext<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span>, <span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span>varchar<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span>, <span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span>char<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span>, <span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span>nvarchar<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span>, <span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span>char<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span>, <span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span>sysname<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span>, <span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span>int<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span>, <span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span>tinyint<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span>) <span class="z-keyword z-operator z-logical z-sql">and</span> table_name  <span class="z-keyword z-operator z-comparison z-sql">=</span> @name
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">set</span> @name <span class="z-keyword z-operator z-comparison z-sql">=</span> quotename(@name)
</span><span class="z-source z-sql">    open c
</span><span class="z-source z-sql">    fetch next <span class="z-keyword z-other z-DML z-sql">from</span> c into @column
</span><span class="z-source z-sql">    while @@fetch_status <span class="z-keyword z-operator z-comparison z-sql">=</span> <span class="z-constant z-numeric z-sql">0</span>
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-LUW z-sql">begin</span>
</span><span class="z-source z-sql">    <span class="z-comment z-line z-double-dash z-sql"><span class="z-punctuation z-definition z-comment z-sql">--</span>print 'Processing table - ' + @name + ', column - ' + @column
</span></span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">set</span> @sql<span class="z-keyword z-operator z-comparison z-sql">=</span><span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span>insert into`rslt select <span class="z-constant z-character z-escape z-sql">''</span><span class="z-punctuation z-definition z-string z-end z-sql">'</span></span> <span class="z-keyword z-operator z-math z-sql">+</span> @name <span class="z-keyword z-operator z-math z-sql">+</span> <span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span><span class="z-constant z-character z-escape z-sql">''</span> as Table_name, <span class="z-constant z-character z-escape z-sql">''</span><span class="z-punctuation z-definition z-string z-end z-sql">'</span></span> <span class="z-keyword z-operator z-math z-sql">+</span> @column <span class="z-keyword z-operator z-math z-sql">+</span> <span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span><span class="z-constant z-character z-escape z-sql">''</span>, cast(<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span> <span class="z-keyword z-operator z-math z-sql">+</span> @column <span class="z-keyword z-operator z-math z-sql">+</span> 
</span><span class="z-source z-sql">    <span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span> as nvarchar(max)) from<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span> <span class="z-keyword z-operator z-math z-sql">+</span> @name <span class="z-keyword z-operator z-math z-sql">+</span> <span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span> where cast(<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span> <span class="z-keyword z-operator z-math z-sql">+</span> @column <span class="z-keyword z-operator z-math z-sql">+</span> <span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span> as nvarchar(max)) like <span class="z-constant z-character z-escape z-sql">''</span><span class="z-punctuation z-definition z-string z-end z-sql">'</span></span> <span class="z-keyword z-operator z-math z-sql">+</span> @substr <span class="z-keyword z-operator z-math z-sql">+</span> <span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span><span class="z-constant z-character z-escape z-sql">''</span><span class="z-punctuation z-definition z-string z-end z-sql">'</span></span>;
</span><span class="z-source z-sql">    print @sql;
</span><span class="z-source z-sql">    exec(@sql);
</span><span class="z-source z-sql">    fetch next <span class="z-keyword z-other z-DML z-sql">from</span> c into @column;
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">end</span>
</span><span class="z-source z-sql">    close c
</span><span class="z-source z-sql">    deallocate c
</span><span class="z-source z-sql">    fetch next <span class="z-keyword z-other z-DML z-sql">from</span> s into @name
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">end</span>
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">select</span> table_name <span class="z-keyword z-operator z-assignment z-alias z-sql">as</span> [Table Name], field_name <span class="z-keyword z-operator z-assignment z-alias z-sql">as</span> [Field Name], <span class="z-support z-function z-aggregate z-sql">count</span>(<span class="z-variable z-language z-star z-sql">*</span>) <span class="z-keyword z-operator z-assignment z-alias z-sql">as</span> [Found Mathes] <span class="z-keyword z-other z-DML z-sql">from</span><span class="z-string z-quoted z-other z-backtick z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">`</span>rslt
</span></span><span class="z-source z-sql"><span class="z-string z-quoted z-other z-backtick z-sql">    group by table_name, field_name
</span></span><span class="z-source z-sql"><span class="z-string z-quoted z-other z-backtick z-sql">    order by table_name, field_name
</span></span><span class="z-source z-sql"><span class="z-string z-quoted z-other z-backtick z-sql">    drop table<span class="z-punctuation z-definition z-string z-end z-sql">`</span></span>rslt
</span><span class="z-source z-sql">    close s
</span><span class="z-source z-sql">    deallocate s
</span><span class="z-source z-sql">
</span><span class="z-source z-sql">    <span class="z-comment z-line z-double-dash z-sql"><span class="z-punctuation z-definition z-comment z-sql">--</span> Поиск в таблице [CI_HISTORY] и столбцу [HIST_ID]:
</span></span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">SELECT</span> <span class="z-variable z-language z-star z-sql">*</span> <span class="z-keyword z-other z-DML z-sql">FROM</span> <span class="z-constant z-other z-database-name z-sql">ITINVENT</span>.<span class="z-constant z-other z-table-name z-sql">dbo</span>.CI_HISTORY <span class="z-keyword z-other z-DML z-sql">where</span> [HIST_ID] <span class="z-keyword z-operator z-logical z-sql">like</span> <span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span>%2023%<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span>;
</span><span class="z-source z-sql">
</span><span class="z-source z-sql">    <span class="z-comment z-line z-double-dash z-sql"><span class="z-punctuation z-definition z-comment z-sql">--</span> Узнать фрагментацию индексов
</span></span><span class="z-source z-sql">    DECLARE @db_id <span class="z-storage z-type z-sql">SMALLINT</span>;
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">SET</span> @db_id <span class="z-keyword z-operator z-comparison z-sql">=</span> DB_ID(N<span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span>itinvent<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span>);
</span><span class="z-source z-sql">    IF @db_id <span class="z-keyword z-operator z-logical z-sql">IS</span> <span class="z-constant z-language z-sql">NULL</span>
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-LUW z-sql">BEGIN</span>;
</span><span class="z-source z-sql">        PRINT N<span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span>Неправильное имя базы<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span>;
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">END</span>;
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">ELSE</span>
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-LUW z-sql">BEGIN</span>;
</span><span class="z-source z-sql">        <span class="z-keyword z-other z-DML z-sql">SELECT</span>
</span><span class="z-source z-sql">            object_id <span class="z-keyword z-operator z-assignment z-alias z-sql">AS</span> [ID объекта],
</span><span class="z-source z-sql">            index_id <span class="z-keyword z-operator z-assignment z-alias z-sql">AS</span> [ID индекса],
</span><span class="z-source z-sql">            index_type_desc <span class="z-keyword z-operator z-assignment z-alias z-sql">AS</span> [Тип индекса],
</span><span class="z-source z-sql">            avg_fragmentation_in_percent <span class="z-keyword z-operator z-assignment z-alias z-sql">AS</span> [Фрагментация в %]
</span><span class="z-source z-sql">            
</span><span class="z-source z-sql">        <span class="z-keyword z-other z-DML z-sql">FROM</span> <span class="z-constant z-other z-database-name z-sql">sys</span>.<span class="z-constant z-other z-table-name z-sql">dm_db_index_physical_stats</span>(@db_id, <span class="z-constant z-language z-sql">NULL</span>, <span class="z-constant z-language z-sql">NULL</span>, <span class="z-constant z-language z-sql">NULL</span> , <span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span>LIMITED<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span>)
</span><span class="z-source z-sql">         
</span><span class="z-source z-sql">        <span class="z-keyword z-other z-DML z-sql">ORDER BY</span> [avg_fragmentation_in_percent] <span class="z-keyword z-other z-order z-sql">DESC</span>;
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">END</span>;
</span><span class="z-source z-sql">    GO
</span><span class="z-source z-sql">
</span><span class="z-source z-sql">    <span class="z-comment z-line z-double-dash z-sql"><span class="z-punctuation z-definition z-comment z-sql">--</span> TempDB
</span></span><span class="z-source z-sql">    <span class="z-comment z-line z-double-dash z-sql"><span class="z-punctuation z-definition z-comment z-sql">--</span> Initial size - начальный/минимальный размер БД (1024 MB)
</span></span><span class="z-source z-sql">    <span class="z-comment z-line z-double-dash z-sql"><span class="z-punctuation z-definition z-comment z-sql">--</span> Autogrowh - прирост (512MB)
</span></span><span class="z-source z-sql">    <span class="z-comment z-line z-double-dash z-sql"><span class="z-punctuation z-definition z-comment z-sql">--</span> По умолчанию tempdb настроена на авто-расширение (Autogrow) и при каждой перезагрузке SQL Server пересоздаёт файлы этой БД с минимальным размером инициализации.
</span></span><span class="z-source z-sql">    <span class="z-comment z-line z-double-dash z-sql"><span class="z-punctuation z-definition z-comment z-sql">--</span> Увеличив размер инициализации файлов tempdb, можно свести к минимуму затраты системных ресурсов на операции авто-расширения.
</span></span><span class="z-source z-sql">
</span><span class="z-source z-sql">    <span class="z-comment z-line z-double-dash z-sql"><span class="z-punctuation z-definition z-comment z-sql">--</span> Изменить путь к БД:
</span></span><span class="z-source z-sql">    USE master;
</span><span class="z-source z-sql">    GO
</span><span class="z-source z-sql"><span class="z-meta z-alter z-sql">    <span class="z-keyword z-other z-create z-sql">ALTER</span> <span class="z-keyword z-other z-table z-sql">DATABASE</span> </span>tempdb
</span><span class="z-source z-sql">    MODIFY FILE (NAME <span class="z-keyword z-operator z-comparison z-sql">=</span> tempdev, FILENAME <span class="z-keyword z-operator z-comparison z-sql">=</span> <span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span>F:<span class="z-constant z-character z-escape z-sql">\t</span>empdb.mdf<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span>);
</span><span class="z-source z-sql">    GO
</span><span class="z-source z-sql"><span class="z-meta z-alter z-sql">    <span class="z-keyword z-other z-create z-sql">ALTER</span> <span class="z-keyword z-other z-table z-sql">DATABASE</span> </span>tempdb
</span><span class="z-source z-sql">    MODIFY FILE (NAME <span class="z-keyword z-operator z-comparison z-sql">=</span> temp2, FILENAME <span class="z-keyword z-operator z-comparison z-sql">=</span> <span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span>F:<span class="z-constant z-character z-escape z-sql">\t</span>empdb_mssql_2.ndf<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span>);
</span><span class="z-source z-sql">    GO
</span><span class="z-source z-sql"><span class="z-meta z-alter z-sql">    <span class="z-keyword z-other z-create z-sql">ALTER</span> <span class="z-keyword z-other z-table z-sql">DATABASE</span> </span>tempdb
</span><span class="z-source z-sql">    MODIFY FILE (NAME <span class="z-keyword z-operator z-comparison z-sql">=</span> temp3, FILENAME <span class="z-keyword z-operator z-comparison z-sql">=</span> <span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span>F:<span class="z-constant z-character z-escape z-sql">\t</span>empdb_mssql_3.ndf<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span>);
</span><span class="z-source z-sql">    GO
</span><span class="z-source z-sql"><span class="z-meta z-alter z-sql">    <span class="z-keyword z-other z-create z-sql">ALTER</span> <span class="z-keyword z-other z-table z-sql">DATABASE</span> </span>tempdb
</span><span class="z-source z-sql">    MODIFY FILE (NAME <span class="z-keyword z-operator z-comparison z-sql">=</span> temp4, FILENAME <span class="z-keyword z-operator z-comparison z-sql">=</span> <span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span>F:<span class="z-constant z-character z-escape z-sql">\t</span>empdb_mssql_4.ndf<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span>);
</span><span class="z-source z-sql">    GO
</span><span class="z-source z-sql"><span class="z-meta z-alter z-sql">    <span class="z-keyword z-other z-create z-sql">ALTER</span> <span class="z-keyword z-other z-table z-sql">DATABASE</span> </span>tempdb
</span><span class="z-source z-sql">    MODIFY FILE (NAME <span class="z-keyword z-operator z-comparison z-sql">=</span> temp5, FILENAME <span class="z-keyword z-operator z-comparison z-sql">=</span> <span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span>F:<span class="z-constant z-character z-escape z-sql">\t</span>empdb_mssql_5.ndf<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span>);
</span><span class="z-source z-sql">    GO
</span><span class="z-source z-sql"><span class="z-meta z-alter z-sql">    <span class="z-keyword z-other z-create z-sql">ALTER</span> <span class="z-keyword z-other z-table z-sql">DATABASE</span> </span>tempdb
</span><span class="z-source z-sql">    MODIFY FILE (NAME <span class="z-keyword z-operator z-comparison z-sql">=</span> temp6, FILENAME <span class="z-keyword z-operator z-comparison z-sql">=</span> <span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span>F:<span class="z-constant z-character z-escape z-sql">\t</span>empdb_mssql_6.ndf<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span>);
</span><span class="z-source z-sql">    GO
</span><span class="z-source z-sql"><span class="z-meta z-alter z-sql">    <span class="z-keyword z-other z-create z-sql">ALTER</span> <span class="z-keyword z-other z-table z-sql">DATABASE</span> </span>tempdb
</span><span class="z-source z-sql">    MODIFY FILE (NAME <span class="z-keyword z-operator z-comparison z-sql">=</span> temp7, FILENAME <span class="z-keyword z-operator z-comparison z-sql">=</span> <span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span>F:<span class="z-constant z-character z-escape z-sql">\t</span>empdb_mssql_7.ndf<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span>);
</span><span class="z-source z-sql">    GO
</span><span class="z-source z-sql"><span class="z-meta z-alter z-sql">    <span class="z-keyword z-other z-create z-sql">ALTER</span> <span class="z-keyword z-other z-table z-sql">DATABASE</span> </span>tempdb
</span><span class="z-source z-sql">    MODIFY FILE (NAME <span class="z-keyword z-operator z-comparison z-sql">=</span> temp8, FILENAME <span class="z-keyword z-operator z-comparison z-sql">=</span> <span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span>F:<span class="z-constant z-character z-escape z-sql">\t</span>empdb_mssql_8.ndf<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span>);
</span><span class="z-source z-sql">    GO
</span><span class="z-source z-sql"><span class="z-meta z-alter z-sql">    <span class="z-keyword z-other z-create z-sql">ALTER</span> <span class="z-keyword z-other z-table z-sql">DATABASE</span> </span>tempdb
</span><span class="z-source z-sql">    MODIFY FILE (NAME <span class="z-keyword z-operator z-comparison z-sql">=</span> templog, FILENAME <span class="z-keyword z-operator z-comparison z-sql">=</span> <span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span>F:<span class="z-constant z-character z-escape z-sql">\t</span>emplog.ldf<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span>);
</span><span class="z-source z-sql">    GO
</span><span class="z-source z-sql">
</span><span class="z-source z-sql">    <span class="z-comment z-line z-double-dash z-sql"><span class="z-punctuation z-definition z-comment z-sql">--</span> Указать размер файла:
</span></span><span class="z-source z-sql">    MODIFY FILE (NAME <span class="z-keyword z-operator z-comparison z-sql">=</span> temp2, FILENAME <span class="z-keyword z-operator z-comparison z-sql">=</span> <span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span>F:<span class="z-constant z-character z-escape z-sql">\t</span>empdb_mssql_2.ndf<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span> , SIZE <span class="z-keyword z-operator z-comparison z-sql">=</span> 1048576KB , FILEGROWTH <span class="z-keyword z-operator z-comparison z-sql">=</span> 524288KB);
</span><span class="z-source z-sql">
</span><span class="z-source z-sql"><span class="z-comment z-line z-number-sign z-sql"><span class="z-punctuation z-definition z-comment z-sql">#</span>## Тип резервной копии
</span></span><span class="z-source z-sql">
</span><span class="z-source z-sql"><span class="z-keyword z-operator z-math z-sql">-</span>   Full (Полная копия). Когда стартует полное резервирование,
</span><span class="z-source z-sql">    записывается Log Sequence <span class="z-storage z-type z-sql">Number</span> (LSN <span class="z-keyword z-operator z-math z-sql">-</span> последовательный номер
</span><span class="z-source z-sql">    журнала), а так же LSN записывается и при завершении полного
</span><span class="z-source z-sql">    резервирования. Этот LSN является механизмом, используемым SQL
</span><span class="z-source z-sql">    Server, чтобы знать, в каком порядке выполнялись операторы <span class="z-keyword z-other z-DML z-sql">INSERT</span>,
</span><span class="z-source z-sql">    <span class="z-keyword z-other z-DML z-sql">UPDATE</span> или <span class="z-keyword z-other z-DML z-sql">DELETE</span>. При этом наличие записанных LSN начала и
</span><span class="z-source z-sql">    окончания, как части полного бэкапа, обеспечивает согласованное с
</span><span class="z-source z-sql">    точки зрения транзакций резервное копирование, поскольку при полном
</span><span class="z-source z-sql">    резервном копировании учитываются изменения, произошедшие во время
</span><span class="z-source z-sql">    резервного копирования. Это обеспечивает обработку таких транзакций
</span><span class="z-source z-sql">    в процессе восстановления бэкапа.
</span><span class="z-source z-sql"><span class="z-keyword z-operator z-math z-sql">-</span>   Differential (дифференциальная<span class="z-keyword z-operator z-math z-sql">/</span>разностная копия). Хранит данных,
</span><span class="z-source z-sql">    изменившиеся с момента последней Полной резервной копии. При
</span><span class="z-source z-sql">    восстановлении нужно сначала восстановить Полную резервную копию в
</span><span class="z-source z-sql">    режиме NORECOVERY, потом можно применить любую из последующих
</span><span class="z-source z-sql">    Разностных копий, без предыдущей Полной резервной копии Разностная
</span><span class="z-source z-sql">    копия бесполезна. Каждая последующая Разностная копия будет хранить
</span><span class="z-source z-sql">    все данные, входящие в предыдущую Разностную резервную копию,
</span><span class="z-source z-sql">    сделанную после предыдущей Полной копии.
</span><span class="z-source z-sql"><span class="z-keyword z-operator z-math z-sql">-</span>   Incremental (инкрементальная<span class="z-keyword z-operator z-math z-sql">/</span>копия журналов транзакций). Резервное
</span><span class="z-source z-sql">    копирования журнала транзакций копирует все транзакции, которые
</span><span class="z-source z-sql">    произошли с момента последнего резервного копирования, а затем
</span><span class="z-source z-sql">    урезает журнал транзакций для освобождения дискового пространства.
</span><span class="z-source z-sql">    Транзакции происходят в определенном порядке (LSN), бэкап журнала
</span><span class="z-source z-sql">    поддерживает этот порядок транзакций. Бэкапы журналов транзакций
</span><span class="z-source z-sql">    должны восстанавливаться по порядку. Для восстановления базы данных
</span><span class="z-source z-sql">    потребуется вся цепочка резервных копий: полная и все последующие
</span><span class="z-source z-sql">    инкрементальные журнала транзакций.
</span><span class="z-source z-sql">
</span><span class="z-source z-sql"><span class="z-comment z-line z-number-sign z-sql"><span class="z-punctuation z-definition z-comment z-sql">#</span>## Модели восстановления
</span></span><span class="z-source z-sql">
</span><span class="z-source z-sql"><span class="z-keyword z-operator z-math z-sql">-</span>   Simple (Простая). Хранится только необходимый для жизни остаток
</span><span class="z-source z-sql">    журнала транзакций. Журнал транзакций (лог) автоматически очищается.
</span><span class="z-source z-sql">    Создание резервных копий журнала транзакций невозможна, поэтому
</span><span class="z-source z-sql">    остается самое ограниченное число опций по восстановлению.
</span><span class="z-source z-sql">    Недоступен функционал: Always On, <span class="z-storage z-type z-sql">Point</span><span class="z-keyword z-operator z-math z-sql">-</span><span class="z-keyword z-operator z-logical z-sql">In</span><span class="z-keyword z-operator z-math z-sql">-</span><span class="z-storage z-type z-sql">Time</span> восстановление,
</span><span class="z-source z-sql">    Резервные копии журнала транзакций.
</span><span class="z-source z-sql"><span class="z-keyword z-operator z-math z-sql">-</span>   Full (Полная). Хранится журнал транзакций всех изменений в БД с
</span><span class="z-source z-sql">    момента последнего резервного копирования журнала транзакций. Журнал
</span><span class="z-source z-sql">    транзакций не будет очищаться до тех пор, пока не будет сделана
</span><span class="z-source z-sql">    резервная копия журнала транзакций.
</span><span class="z-source z-sql"><span class="z-keyword z-operator z-math z-sql">-</span>   Bulk logged (С неполным протоколированием). Идентична Full, за
</span><span class="z-source z-sql">    исключение: <span class="z-keyword z-other z-DML z-sql">SELECT</span> INTO, BULK <span class="z-keyword z-other z-DML z-sql">INSERT</span> и BCP, <span class="z-keyword z-other z-DML z-sql">INSERT INTO</span> <span class="z-keyword z-other z-DML z-sql">SELECT</span>,
</span><span class="z-source z-sql">    операции с индексами (<span class="z-meta z-create z-sql"><span class="z-keyword z-other z-create z-sql">CREATE</span> <span class="z-keyword z-other z-sql">INDEX</span></span>,<span class="z-meta z-alter z-sql"> <span class="z-keyword z-other z-create z-sql">ALTER</span> <span class="z-keyword z-other z-table z-sql">INDEX</span> </span>REBUILD,<span class="z-meta z-drop z-sql"> <span class="z-keyword z-other z-create z-sql">DROP</span> <span class="z-keyword z-other z-sql">INDEX</span></span>)
</span><span class="z-source z-sql">
</span><span class="z-source z-sql"><span class="z-comment z-line z-number-sign z-sql"><span class="z-punctuation z-definition z-comment z-sql">#</span>## Системные БД
</span></span><span class="z-source z-sql">
</span><span class="z-source z-sql"><span class="z-keyword z-operator z-math z-sql">-</span>   master. Хранятся все данные системного уровня (конфигурация системы,
</span><span class="z-source z-sql">    сведенья об учетных записях входа, информация обо всех других базах
</span><span class="z-source z-sql">    данных) для экземпляра SQL Server.
</span><span class="z-source z-sql"><span class="z-keyword z-operator z-math z-sql">-</span>   tempdb. Рабочее пространство для временных объектов, таких как
</span><span class="z-source z-sql">    глобальные или локальные временные таблицы, временные хранимые
</span><span class="z-source z-sql">    процедуры, табличные переменные и курсоры. Пересоздаётся при каждом
</span><span class="z-source z-sql">    запуске SQL Server.
</span><span class="z-source z-sql"><span class="z-keyword z-operator z-math z-sql">-</span>   model. Используется в качестве шаблона для всех баз данных,
</span><span class="z-source z-sql">    создаваемых в экземпляре SQL Server, все содержимое базы данных
</span><span class="z-source z-sql">    model, включая параметры базы данных, копируется в создаваемую базу
</span><span class="z-source z-sql">    данных. Так как база данных tempdb создается каждый раз при запуске
</span><span class="z-source z-sql">    SQL Server, база данных model всегда должна существовать в системе
</span><span class="z-source z-sql">    SQL Server.
</span><span class="z-source z-sql"><span class="z-keyword z-operator z-math z-sql">-</span>   msdb. Используется агентом SQL Server для создания расписания
</span><span class="z-source z-sql">    предупреждений (оператор) и выполнение заданий, а также другими
</span><span class="z-source z-sql">    компонентами. SQL Server хранит полный журнал резервного копирования
</span><span class="z-source z-sql">    и восстановления в базе данных msdb. Для отправки почты оператору
</span><span class="z-source z-sql">    используется: USE \[msdb\].
</span><span class="z-source z-sql"><span class="z-keyword z-operator z-math z-sql">-</span>   resource. Доступная только для чтения база данных, которая содержит
</span><span class="z-source z-sql">    все системные объекты, например <span class="z-constant z-other z-database-name z-sql">sys</span>.<span class="z-constant z-other z-table-name z-sql">objects</span>, физически хранятся в
</span><span class="z-source z-sql">    базе данных resource, но логически присутствуют в схеме sys каждой
</span><span class="z-source z-sql">    базы данных.
</span><span class="z-source z-sql">
</span><span class="z-source z-sql"><span class="z-comment z-line z-number-sign z-sql"><span class="z-punctuation z-definition z-comment z-sql">#</span>## Регламентные операции
</span></span><span class="z-source z-sql">
</span><span class="z-source z-sql"><span class="z-keyword z-operator z-math z-sql">-</span>   Проверка целостности базы данных
</span><span class="z-source z-sql">
</span><span class="z-source z-sql"><span class="z-string z-quoted z-other z-backtick z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">`</span>DBCC CHECKDB<span class="z-punctuation z-definition z-string z-end z-sql">`</span></span>
</span><span class="z-source z-sql">
</span><span class="z-source z-sql"><span class="z-keyword z-operator z-math z-sql">-</span>   Индексы. Индексы используются для быстрого поиска данных без
</span><span class="z-source z-sql">    необходимости поиска<span class="z-keyword z-operator z-math z-sql">/</span>просмотра всех строк в таблице базы данных при
</span><span class="z-source z-sql">    каждом обращении к таблице базы данных. Индекс ускоряет процесс
</span><span class="z-source z-sql">    запроса, предоставляя быстрый доступ к строкам данных в таблице,
</span><span class="z-source z-sql">    аналогично тому, как указатель в книге помогает вам быстро найти
</span><span class="z-source z-sql">    необходимую информацию. Индексы предоставляют путь для быстрого
</span><span class="z-source z-sql">    поиска данных на основе значений в этих столбцах. Для каждого
</span><span class="z-source z-sql">    индекса обязательно хранится его статистика. MS SQL Server
</span><span class="z-source z-sql">    самостоятельно создает и изменяет индексы при работе с базой. С
</span><span class="z-source z-sql">    течением времени данные в индексе становятся фрагментированными,
</span><span class="z-source z-sql">    <span class="z-constant z-other z-database-name z-sql">т</span>.<span class="z-constant z-other z-table-name z-sql">е</span>. разбросанными по базе данных, что серьезно снижает
</span><span class="z-source z-sql">    производительность запросов. Если фрагментация составляет от <span class="z-constant z-numeric z-sql">5</span> до
</span><span class="z-source z-sql">    <span class="z-constant z-numeric z-sql">30</span>% (стандартно в задании <span class="z-constant z-numeric z-sql">15</span>%), то рекомендуется ее устранить с
</span><span class="z-source z-sql">    помощью реорганизации, при фрагментации выше <span class="z-constant z-numeric z-sql">30</span>% (по умолчанию в
</span><span class="z-source z-sql">    задаче \<span class="z-keyword z-operator z-comparison z-sql">></span> <span class="z-constant z-numeric z-sql">30</span>% фрагментации и число страниц \<span class="z-keyword z-operator z-comparison z-sql">></span> <span class="z-constant z-numeric z-sql">1000</span>) необходимо
</span><span class="z-source z-sql">    полное перестроение индексов. После перестроения планово
</span><span class="z-source z-sql">    используется только реорганизация.
</span><span class="z-source z-sql">
</span><span class="z-source z-sql"><span class="z-keyword z-operator z-math z-sql">-</span>   Реорганизация (Reorganize) или дефрагментация индекса <span class="z-comment z-line z-double-dash z-sql"><span class="z-punctuation z-definition z-comment z-sql">--</span>- это серия
</span></span><span class="z-source z-sql">    небольших локальных перемещений страниц так, чтобы индекс не был
</span><span class="z-source z-sql">    фрагментирован. После реорганизации статистика не обновляется. Во
</span><span class="z-source z-sql">    время выполнения почти все данные доступны, пользователи смогут
</span><span class="z-source z-sql">    работать.
</span><span class="z-source z-sql">
</span><span class="z-source z-sql"><span class="z-string z-quoted z-other z-backtick z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">`</span>sp_msforeachtable N'DBCC INDEXDEFRAG (<имя базы данных>, ''?'')'<span class="z-punctuation z-definition z-string z-end z-sql">`</span></span>
</span><span class="z-source z-sql">
</span><span class="z-source z-sql"><span class="z-keyword z-operator z-math z-sql">-</span>   Перестроение (Rebuild) индексов (или задача в мастере планов
</span><span class="z-source z-sql">    обслуживания: Восстановить индекс) запускает процесс полного
</span><span class="z-source z-sql">    построения индексов. В версии MS SQL Server Standard происходит
</span><span class="z-source z-sql">    отключение всех клиентов от базы на время выполнения операции. После
</span><span class="z-source z-sql">    перестроения обязательно обновляется статистика.
</span><span class="z-source z-sql">
</span><span class="z-source z-sql"><span class="z-string z-quoted z-other z-backtick z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">`</span>sp_msforeachtable N'DBCC DBREINDEX (''?'')'<span class="z-punctuation z-definition z-string z-end z-sql">`</span></span>
</span><span class="z-source z-sql">
</span><span class="z-source z-sql"><span class="z-keyword z-operator z-math z-sql">-</span>   Обновление статистики. Статистика <span class="z-comment z-line z-double-dash z-sql"><span class="z-punctuation z-definition z-comment z-sql">--</span>- небольшая таблица (обычно до
</span></span><span class="z-source z-sql">    <span class="z-constant z-numeric z-sql">200</span> строк), в которой хранится обобщенная информация о том, какие
</span><span class="z-source z-sql">    значения и как часто встречаются в таблице. На основании статистики
</span><span class="z-source z-sql">    сервер принимает решение, как лучше построить запрос. Когда
</span><span class="z-source z-sql">    происходят запросы к БД (например, <span class="z-keyword z-other z-DML z-sql">SELECT</span>) вы получаете данные, но
</span><span class="z-source z-sql">    не описываете то, как эти данные должны быть извлечены. В получении
</span><span class="z-source z-sql">    и обработке данных помогает статистика. Во время выполнения
</span><span class="z-source z-sql">    процедуры обновления статистики данные не блокируются.
</span><span class="z-source z-sql">
</span><span class="z-source z-sql"><span class="z-string z-quoted z-other z-backtick z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">`</span>exec sp_msforeachtable N'UPDATE STATISTICS ? WITH FULLSCAN'<span class="z-punctuation z-definition z-string z-end z-sql">`</span></span>
</span><span class="z-source z-sql">
</span><span class="z-source z-sql"><span class="z-keyword z-operator z-math z-sql">-</span>   Очистка процедурного кэша, выполняется после обновления статистики.
</span><span class="z-source z-sql">    Оптимизатор MS SQL Server кэширует планы запросов для их повторного
</span><span class="z-source z-sql">    выполнения. Это делается для того, чтобы экономить время,
</span><span class="z-source z-sql">    затрачиваемое на компиляцию запроса в том случае, если такой же
</span><span class="z-source z-sql">    запрос уже выполнялся и его план известен. После обновия статистики,
</span><span class="z-source z-sql">    не будет очищен процедурный кэш, то SQL Server может выбрать старый
</span><span class="z-source z-sql">    (неоптимальный) план запроса из кэша вместо того, чтобы построить
</span><span class="z-source z-sql">    новый (более оптимальный) план.
</span><span class="z-source z-sql">
</span><span class="z-source z-sql"><span class="z-string z-quoted z-other z-backtick z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">`</span>DBCC FREEPROCCACHE<span class="z-punctuation z-definition z-string z-end z-sql">`</span></span>
</span><span class="z-source z-sql">
</span><span class="z-source z-sql"><span class="z-comment z-line z-number-sign z-sql"><span class="z-punctuation z-definition z-comment z-sql">#</span># Elasticsearch
</span></span><span class="z-source z-sql">
</span><span class="z-source z-sql"><span class="z-string z-quoted z-other z-backtick z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">`</span>Install-Module -Name Elastic.Console -AllowPrerelease<span class="z-punctuation z-definition z-string z-end z-sql">`</span></span> [github
</span><span class="z-source z-sql">source](https:<span class="z-keyword z-operator z-math z-sql">/</span><span class="z-keyword z-operator z-math z-sql">/</span><span class="z-constant z-other z-database-name z-sql">github</span>.<span class="z-constant z-other z-table-name z-sql">com</span><span class="z-keyword z-operator z-math z-sql">/</span>elastic<span class="z-keyword z-operator z-math z-sql">/</span>powershell<span class="z-keyword z-operator z-math z-sql">/</span>blob<span class="z-keyword z-operator z-math z-sql">/</span>master<span class="z-keyword z-operator z-math z-sql">/</span><span class="z-constant z-other z-database-name z-sql">Elastic</span>.<span class="z-constant z-other z-table-name z-sql">Console</span><span class="z-keyword z-operator z-math z-sql">/</span><span class="z-constant z-other z-database-name z-sql">README</span>.<span class="z-constant z-other z-table-name z-sql">md</span>)\
</span><span class="z-source z-sql"><span class="z-string z-quoted z-other z-backtick z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">`</span>Get-Command -Module Elastic.Console<span class="z-punctuation z-definition z-string z-end z-sql">`</span></span>\
</span><span class="z-source z-sql"><span class="z-string z-quoted z-other z-backtick z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">`</span>Get-ElasticsearchVersion<span class="z-punctuation z-definition z-string z-end z-sql">`</span></span>\
</span><span class="z-source z-sql"><span class="z-string z-quoted z-other z-backtick z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">`</span>Set-ElasticsearchVersion 7.3.0<span class="z-punctuation z-definition z-string z-end z-sql">`</span></span>\
</span><span class="z-source z-sql"><span class="z-string z-quoted z-other z-backtick z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">`</span>Invoke-Elasticsearch<span class="z-punctuation z-definition z-string z-end z-sql">`</span></span> REST API запросы
</span><span class="z-source z-sql">
</span><span class="z-source z-sql"><span class="z-comment z-line z-number-sign z-sql"><span class="z-punctuation z-definition z-comment z-sql">#</span># CData
</span></span><span class="z-source z-sql">
</span><span class="z-source z-sql">[PowerShell Gallery
</span><span class="z-source z-sql">CData](https:<span class="z-keyword z-operator z-math z-sql">/</span><span class="z-keyword z-operator z-math z-sql">/</span><span class="z-constant z-other z-database-name z-sql">www</span>.<span class="z-constant z-other z-table-name z-sql">powershellgallery</span>.com<span class="z-keyword z-operator z-math z-sql">/</span>profiles<span class="z-keyword z-operator z-math z-sql">/</span>CData)\
</span><span class="z-source z-sql">[Automate Elasticsearch Integration Tasks <span class="z-keyword z-other z-DML z-sql">from</span>
</span><span class="z-source z-sql">PowerShell](https:<span class="z-keyword z-operator z-math z-sql">/</span><span class="z-keyword z-operator z-math z-sql">/</span><span class="z-constant z-other z-database-name z-sql">www</span>.<span class="z-constant z-other z-table-name z-sql">cdata</span>.com<span class="z-keyword z-operator z-math z-sql">/</span>kb<span class="z-keyword z-operator z-math z-sql">/</span>tech<span class="z-keyword z-operator z-math z-sql">/</span>elasticsearch<span class="z-keyword z-operator z-math z-sql">-</span>ado<span class="z-keyword z-operator z-math z-sql">-</span><span class="z-constant z-other z-database-name z-sql">powershell</span>.<span class="z-constant z-other z-table-name z-sql">rst</span>)
</span><span class="z-source z-sql">
</span><span class="z-source z-sql"><span class="z-string z-quoted z-other z-backtick z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">`</span>Install-Module ElasticsearchCmdlets<span class="z-punctuation z-definition z-string z-end z-sql">`</span></span> [пакет драйвера в
</span><span class="z-source z-sql">psgallery](https:<span class="z-keyword z-operator z-math z-sql">/</span><span class="z-keyword z-operator z-math z-sql">/</span><span class="z-constant z-other z-database-name z-sql">www</span>.<span class="z-constant z-other z-table-name z-sql">powershellgallery</span>.com<span class="z-keyword z-operator z-math z-sql">/</span>packages<span class="z-keyword z-operator z-math z-sql">/</span>ElasticsearchCmdlets<span class="z-keyword z-operator z-math z-sql">/</span><span class="z-constant z-numeric z-sql">23</span>.<span class="z-constant z-numeric z-sql">0</span>.<span class="z-constant z-numeric z-sql">8565</span>.<span class="z-constant z-numeric z-sql">1</span>)\
</span><span class="z-source z-sql"><span class="z-string z-quoted z-other z-backtick z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">`</span>Import-Module ElasticsearchCmdlets<span class="z-punctuation z-definition z-string z-end z-sql">`</span></span>\
</span><span class="z-source z-sql"><span class="z-string z-quoted z-other z-backtick z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">`</span>Get-Command -Module ElasticsearchCmdlets<span class="z-punctuation z-definition z-string z-end z-sql">`</span></span>
</span><span class="z-source z-sql">
</span><span class="z-source z-sql"><span class="z-string z-quoted z-other z-backtick z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">`</span><span class="z-punctuation z-definition z-string z-end z-sql">`</span></span><span class="z-string z-quoted z-other z-backtick z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">`</span> powershell
</span></span><span class="z-source z-sql"><span class="z-string z-quoted z-other z-backtick z-sql">$elasticsearch = Connect-Elasticsearch  -Server "$Server" -Port "$Port" -User "$User" -Password "$Password"
</span></span><span class="z-source z-sql"><span class="z-string z-quoted z-other z-backtick z-sql">$shipcity = "New York"
</span></span><span class="z-source z-sql"><span class="z-string z-quoted z-other z-backtick z-sql">$orders = Select-Elasticsearch -Connection $elasticsearch -Table "Orders" -Where "ShipCity = <span class="z-punctuation z-definition z-string z-end z-sql">`</span></span><span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">'</span>$ShipCity`<span class="z-punctuation z-definition z-string z-end z-sql">'</span></span><span class="z-string z-quoted z-double z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">"</span>` поиск и получение данных
</span></span><span class="z-source z-sql"><span class="z-string z-quoted z-double z-sql">$orders = Invoke-Elasticsearch -Connection $elasticsearch -Query 'SELECT * FROM Orders WHERE ShipCity = @ShipCity' -Params @{'@ShipCity'='New York'}` SQL запросы
</span></span></code></pre><h3 id=ado-net-assembly><a aria-label="Anchor link for: ado-net-assembly" class=zola-anchor href=#ado-net-assembly><i class=icon></i></a> ADO.NET Assembly</h3><p><code>Install-Package CData.Elasticsearch</code> <a href=https://www.nuget.org/packages/CData.Elasticsearch>пакет драйвера в nuget</a><br> <code>[Reflection.Assembly]::LoadFile("C:\Program Files\PackageManagement\NuGet\Packages\CData.Elasticsearch.23.0.8565\lib\net40\System.Data.CData.Elasticsearch.dll")</code><pre class="language-powershell z-code" data-lang=powershell><code class=language-powershell data-lang=powershell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>connect</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> System.Data.CData.Elasticsearch.ElasticsearchConnection<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Server=127.0.0.1;Port=9200;User=admin;Password=123456;<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>connect<span class="z-variable z-other z-member z-powershell">.Open</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>sql</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>SELECT OrderName, Freight from Orders<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>da</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> System.Data.CData.Elasticsearch.ElasticsearchDataAdapter<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>sql</span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>conn</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>dt</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> System.Data.DataTable
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>da<span class="z-variable z-other z-member z-powershell">.Fill</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>dt</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>dt<span class="z-variable z-other z-member z-powershell">.Rows</span></span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-keyword z-control z-powershell">foreach</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-support z-function z-powershell">Write-Host</span> <span class="z-support z-variable z-automatic z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>_<span class="z-variable z-other z-member z-powershell">.ordername</span></span> <span class="z-support z-variable z-automatic z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>_<span class="z-variable z-other z-member z-powershell">.freight</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></code></pre><h3 id=update-1><a aria-label="Anchor link for: update-1" class=zola-anchor href=#update-1><i class=icon></i></a> UPDATE</h3><pre class="language-powershell z-code" data-lang=powershell><code class=language-powershell data-lang=powershell><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Update-Elasticsearch</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Connection <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Elasticsearch</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Columns <span class="z-meta z-group z-array-expression z-powershell"><span class="z-keyword z-other z-array z-begin z-powershell">@</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-string z-quoted z-single z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">'</span>OrderName<span class="z-punctuation z-definition z-string z-end z-powershell">'</span></span><span class="z-keyword z-operator z-other z-powershell">,</span><span class="z-string z-quoted z-single z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">'</span>Freight<span class="z-punctuation z-definition z-string z-end z-powershell">'</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Values <span class="z-meta z-group z-array-expression z-powershell"><span class="z-keyword z-other z-array z-begin z-powershell">@</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-string z-quoted z-single z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">'</span>MyOrderName<span class="z-punctuation z-definition z-string z-end z-powershell">'</span></span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-string z-quoted z-single z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">'</span>MyFreight<span class="z-punctuation z-definition z-string z-end z-powershell">'</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Table Orders <span class="z-keyword z-operator z-assignment z-powershell">-</span>Id <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>MyId<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span>  <span class="z-support z-function z-powershell">New-Object</span> System.Data.CData.Elasticsearch.ElasticsearchCommand<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>UPDATE Orders SET ShipCity='New York' WHERE Id = @myId<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>conn</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd<span class="z-variable z-other z-member z-powershell">.Parameters.Add</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell">new System.Data.CData.Elasticsearch.ElasticsearchParameter<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>@myId<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-other z-powershell">,</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>10456255-0015501366<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd<span class="z-variable z-other z-member z-powershell">.ExecuteNonQuery</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></code></pre><h3 id=insert-1><a aria-label="Anchor link for: insert-1" class=zola-anchor href=#insert-1><i class=icon></i></a> INSERT</h3><pre class="language-powershell z-code" data-lang=powershell><code class=language-powershell data-lang=powershell><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Add-Elasticsearch</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Connection <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Elasticsearch</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Table Orders <span class="z-keyword z-operator z-assignment z-powershell">-</span>Columns <span class="z-meta z-group z-array-expression z-powershell"><span class="z-keyword z-other z-array z-begin z-powershell">@</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>OrderName<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Freight<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Values <span class="z-meta z-group z-array-expression z-powershell"><span class="z-keyword z-other z-array z-begin z-powershell">@</span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>MyOrderName<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>MyFreight<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span>
</span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span>  <span class="z-support z-function z-powershell">New-Object</span> System.Data.CData.Elasticsearch.ElasticsearchCommand<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>INSERT INTO Orders (ShipCity) VALUES (@myShipCity)<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>conn</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd<span class="z-variable z-other z-member z-powershell">.Parameters.Add</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell">new System.Data.CData.Elasticsearch.ElasticsearchParameter<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>@myShipCity<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-other z-powershell">,</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>New York<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd<span class="z-variable z-other z-member z-powershell">.ExecuteNonQuery</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></code></pre><h3 id=delete-1><a aria-label="Anchor link for: delete-1" class=zola-anchor href=#delete-1><i class=icon></i></a> DELETE</h3><pre class="language-powershell z-code" data-lang=powershell><code class=language-powershell data-lang=powershell><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Remove-Elasticsearch</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Connection <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>Elasticsearch</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Table <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Orders<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Id <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>MyId<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span>  <span class="z-support z-function z-powershell">New-Object</span> System.Data.CData.Elasticsearch.ElasticsearchCommand<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>DELETE FROM Orders WHERE Id=@myId<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>conn</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd<span class="z-variable z-other z-member z-powershell">.Parameters.Add</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell">new System.Data.CData.Elasticsearch.ElasticsearchParameter<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>@myId<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-other z-powershell">,</span><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>001d000000YBRseAAH<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd<span class="z-variable z-other z-member z-powershell">.ExecuteNonQuery</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></code></pre><h2 id=odbc><a aria-label="Anchor link for: odbc" class=zola-anchor href=#odbc><i class=icon></i></a> ODBC</h2><p><code>Get-Command -Module Wdac</code><br> <code>Get-OdbcDriver | ft</code> список установленных драйверов<p><a href=https://www.elastic.co/guide/en/elasticsearch/reference/current/sql-client-apps-ps1.html>Elasticsearch ODBC драйвер для доступа к данным Elasticsearch из Microsoft PowerShell</a><pre class="language-powershell z-code" data-lang=powershell><code class=language-powershell data-lang=powershell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>connectstring</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>DSN=Local Elasticsearch;<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>sql</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>SELECT * FROM library<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>conn</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> System.Data.Odbc.OdbcConnection<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>connectstring</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>conn<span class="z-variable z-other z-member z-powershell">.open</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> system.Data.Odbc.OdbcCommand<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>sql</span><span class="z-keyword z-operator z-other z-powershell">,</span><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>conn</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>da</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> system.Data.Odbc.OdbcDataAdapter<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>dt</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> system.Data.datatable
</span><span class="z-source z-powershell"><span class="z-constant z-language z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>null</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>da<span class="z-variable z-other z-member z-powershell">.fill</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>dt</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>conn<span class="z-variable z-other z-member z-powershell">.close</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>dt</span>
</span></code></pre><h2 id=postgresql><a aria-label="Anchor link for: postgresql" class=zola-anchor href=#postgresql><i class=icon></i></a> PostgreSQL</h2><h3 id=odbc-driver><a aria-label="Anchor link for: odbc-driver" class=zola-anchor href=#odbc-driver><i class=icon></i></a> ODBC Driver</h3><p><a href=https://www.postgresql.org/ftp/odbc/versions/msi/>Скачать и установить драйвер</a><pre class="language-powershell z-code" data-lang=powershell><code class=language-powershell data-lang=powershell><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>dbServer</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>192.168.3.101<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>port</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>5432<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>dbName</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>test<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>dbUser</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>admin<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>dbPass</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>admin<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>szConnect</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Driver={PostgreSQL Unicode(x64)};Server=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>dbServer</span>;Port=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>port</span>;Database=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>dbName</span>;Uid=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>dbUser</span>;Pwd=<span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>dbPass</span>;<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> 
</span><span class="z-source z-powershell">
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cnDB</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> System.Data.Odbc.OdbcConnection<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>szConnect</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>dsDB</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> System.Data.DataSet
</span><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">try</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cnDB<span class="z-variable z-other z-member z-powershell">.Open</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>adDB</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> System.Data.Odbc.OdbcDataAdapter
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>adDB<span class="z-variable z-other z-member z-powershell">.SelectCommand</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> System.Data.Odbc.OdbcCommand<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>SELECT id, name, age, login FROM public.users<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span> <span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cnDB</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>adDB<span class="z-variable z-other z-member z-powershell">.Fill</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>dsDB</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cnDB<span class="z-variable z-other z-member z-powershell">.Close</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">catch</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">System.Data.Odbc.OdbcException</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-support z-variable z-automatic z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>_<span class="z-variable z-other z-member z-powershell">.Exception</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-support z-variable z-automatic z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>_<span class="z-variable z-other z-member z-powershell">.Exception.Message</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-support z-variable z-automatic z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>_<span class="z-variable z-other z-member z-powershell">.Exception.ItemName</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">foreach</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>row</span> <span class="z-keyword z-control z-powershell">in</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>dsDB</span><span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-constant z-numeric z-integer z-powershell">0</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>.Tables<span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-constant z-numeric z-integer z-powershell">0</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>.Rows</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>row<span class="z-variable z-other z-member z-powershell">.login</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>row<span class="z-variable z-other z-member z-powershell">.age</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></code></pre><h3 id=npgsql><a aria-label="Anchor link for: npgsql" class=zola-anchor href=#npgsql><i class=icon></i></a> npgsql</h3><p><a href=https://github.com/npgsql/npgsql>Source</a><br> <a href=https://www.nuget.org/packages/Npgsql.EntityFrameworkCore.PostgreSQL>Package</a><pre class="language-powershell z-code" data-lang=powershell><code class=language-powershell data-lang=powershell><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Подключаем сборку Npgsql<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-support z-function z-powershell">Add-Type</span> <span class="z-keyword z-operator z-assignment z-powershell">-</span>Path <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span><span class="z-support z-constant z-variable z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>home</span>\Documents\Npgsql.PostgreSQL\8.0.4\net8.0\Npgsql.EntityFrameworkCore.PostgreSQL.dll<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Определяем строку подключения к базе данных PostgreSQL<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>connString</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Host=myserver;Username=mylogin;Password=mypass;Database=mydatabase<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Создаем объект подключения<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>conn</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-support z-function z-powershell">New-Object</span> Npgsql.NpgsqlConnection<span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>connString</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Открываем соединение с базой данных<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>conn<span class="z-variable z-other z-member z-powershell">.Open</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">try</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Создаем SQL команду<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>conn<span class="z-variable z-other z-member z-powershell">.CreateCommand</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd<span class="z-variable z-other z-member z-powershell">.CommandText</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>INSERT INTO data (some_field) VALUES (@p)<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Добавляем параметр и его значение<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>param</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd<span class="z-variable z-other z-member z-powershell">.Parameters.Add</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>p<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span><span class="z-keyword z-operator z-other z-powershell">,</span> <span class="z-punctuation z-section z-bracket z-begin z-powershell">[</span><span class="z-storage z-type z-powershell">NpgsqlTypes.NpgsqlDbType</span><span class="z-punctuation z-section z-bracket z-end z-powershell">]</span>::Text</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>param<span class="z-variable z-other z-member z-powershell">.Value</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>Hello world<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Выполняем команду<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd<span class="z-variable z-other z-member z-powershell">.ExecuteNonQuery</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-keyword z-operator z-other z-powershell">|</span> <span class="z-support z-function z-powershell">Out-Null</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span> <span class="z-keyword z-control z-powershell">finally</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd<span class="z-variable z-other z-member z-powershell">.Dispose</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Извлекаем все строки из таблицы<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-keyword z-control z-powershell">try</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Создаем команду SQL для извлечения данных<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>conn<span class="z-variable z-other z-member z-powershell">.CreateCommand</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd<span class="z-variable z-other z-member z-powershell">.CommandText</span></span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-string z-quoted z-double z-powershell"><span class="z-punctuation z-definition z-string z-begin z-powershell">"</span>SELECT some_field FROM data<span class="z-punctuation z-definition z-string z-end z-powershell">"</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Выполняем команду и получаем объект чтения данных<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>reader</span> <span class="z-keyword z-operator z-assignment z-powershell">=</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd<span class="z-variable z-other z-member z-powershell">.ExecuteReader</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Читаем и выводим данные построчно<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-keyword z-control z-powershell">while</span> <span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>reader<span class="z-variable z-other z-member z-powershell">.Read</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">        <span class="z-support z-function z-powershell">Write-Host</span> <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>reader<span class="z-variable z-other z-member z-powershell">.GetString</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-interpolated z-simple z-source z-powershell"><span class="z-constant z-numeric z-integer z-powershell">0</span></span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span> <span class="z-keyword z-control z-powershell">finally</span> <span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-begin z-powershell">{</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Освобождаем ресурсы чтения данных и команды<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>reader<span class="z-variable z-other z-member z-powershell">.Dispose</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell">    <span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>cmd<span class="z-variable z-other z-member z-powershell">.Dispose</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></span><span class="z-source z-powershell"><span class="z-meta z-scriptblock z-powershell"><span class="z-punctuation z-section z-braces z-end z-powershell">}</span></span>
</span><span class="z-source z-powershell"><span class="z-comment z-line z-powershell"><span class="z-punctuation z-definition z-comment z-powershell">#</span> Закрываем соединение с базой данных<span class="z-punctuation z-definition z-comment z-powershell">
</span></span></span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>conn<span class="z-variable z-other z-member z-powershell">.Close</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span><span class="z-source z-powershell"><span class="z-variable z-other z-readwrite z-powershell"><span class="z-punctuation z-definition z-variable z-powershell">$</span>conn<span class="z-variable z-other z-member z-powershell">.Dispose</span></span><span class="z-punctuation z-section z-group z-begin z-powershell">(</span><span class="z-punctuation z-section z-group z-end z-powershell">)</span>
</span></code></pre><span class=hidden id=copy-code-text>Copy Code</span><span class=hidden id=search-index>https://lifailon.github.io/search_index.en.json</span><span class=hidden id=more-matches-text>$MATCHES more matches</span></main><footer id=site-footer><nav><ul><li><a href=https://lifailon.github.io/syntax/>PowerShell Syntax</a><li><a href=https://lifailon.github.io/filesystem/>File System</a><li><a href=https://lifailon.github.io/windows/>Operating System</a><li><a href=https://lifailon.github.io/network/>Network</a><li><a href=https://lifailon.github.io/threads/>Threads</a><li><a href=https://lifailon.github.io/modules/>Modules</a><li><a href=https://lifailon.github.io/dotnet/>dotNET</a><li><a href=https://lifailon.github.io/com/>COM</a><li><a href=https://lifailon.github.io/servermanager/>Server Manager</a><li><a href=https://lifailon.github.io/activedirectory/>Active Directory</a><li><a href=https://lifailon.github.io/exchange/>Exchange</a><li><a href=https://lifailon.github.io/virtualization/>Virtualization</a><li><a class=active href=https://lifailon.github.io/database/>Database</a><li><a href=https://lifailon.github.io/markuplanguages/>Markup Languages</a><li><a href=https://lifailon.github.io/api/>API</a><li><a href=https://lifailon.github.io/zabbix/>Zabbix</a><li><a href=https://lifailon.github.io/devops/>DevOps</a><li><a href=https://lifailon.github.io/docker/>Docker</a><li><a href=https://lifailon.github.io/linux/>Linux</a><li><a href=https://lifailon.github.io/node-js/>Node.js</a></ul></nav><p>© <strong>2023-2024</strong> <code>Lifailon</code><p><small>Powered by <a class="link external" href=https://www.getzola.org>Zola</a> and <a class="link external" href=https://duckquill.daudix.one>Duckquill</a> </small><ul id=socials><li><a rel=" me" href=https://github.com title=GitHub> <i style="--icon:url(&#34data:image/svg+xml,%3Csvg role='img' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Ctitle%3EGitHub%3C/title%3E%3Cpath d='M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12'/%3E%3C/svg%3E&#34)" class=icon></i> <span>GitHub</span> </a></ul></footer>