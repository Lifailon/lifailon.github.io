
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Lifailon">
      
      
        <link rel="canonical" href="https://lifailon.github.io/ActiveDirectory/">
      
      
        <link rel="prev" href="../ServerManager/">
      
      
        <link rel="next" href="../Exchange/">
      
      
      <link rel="icon" href="../Logo/PowerShell-Logo.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.20">
    
    
      
        <title>Active Directory - PowerShell Commands</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.66ac8b77.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CInter:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Inter";--md-code-font:"Inter"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/highlight/obsidian.min.css">
    
      <link rel="stylesheet" href="../assets/custom/headers.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#rsat-remote-server-administration-tools" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="PowerShell Commands" class="md-header__button md-logo" aria-label="PowerShell Commands" data-md-component="logo">
      
  <img src="../Logo/PowerShell-Logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PowerShell Commands
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Active Directory
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Lifailon/PS-Commands" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="PowerShell Commands" class="md-nav__button md-logo" aria-label="PowerShell Commands" data-md-component="logo">
      
  <img src="../Logo/PowerShell-Logo.png" alt="logo">

    </a>
    PowerShell Commands
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Lifailon/PS-Commands" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Syntax/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Syntax
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../FileSystem/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    File System
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Network/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Network
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Threads/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Threads
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Modules/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modules
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../dotNET/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    .NET
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../COM/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    COM
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ServerManager/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Server Manager
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Active Directory
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Active Directory
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#rsat-remote-server-administration-tools" class="md-nav__link">
    <span class="md-ellipsis">
      RSAT (Remote Server Administration Tools)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#import-module-activedirectory" class="md-nav__link">
    <span class="md-ellipsis">
      Import-Module ActiveDirectory
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adsi-active-directory-service-interface" class="md-nav__link">
    <span class="md-ellipsis">
      ADSI (Active Directory Service Interface)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ldap-lightweight-directory-access-protocol" class="md-nav__link">
    <span class="md-ellipsis">
      LDAP (Lightweight Directory Access Protocol)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laps-local-admin-password-management" class="md-nav__link">
    <span class="md-ellipsis">
      LAPS (Local Admin Password Management)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recycle-bin" class="md-nav__link">
    <span class="md-ellipsis">
      Recycle Bin
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thumbnailphoto" class="md-nav__link">
    <span class="md-ellipsis">
      thumbnailPhoto
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#addomaincontroller" class="md-nav__link">
    <span class="md-ellipsis">
      ADDomainController
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adcomputer" class="md-nav__link">
    <span class="md-ellipsis">
      ADComputer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aduser" class="md-nav__link">
    <span class="md-ellipsis">
      ADUser
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adgroupmember" class="md-nav__link">
    <span class="md-ellipsis">
      ADGroupMember
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adreplication" class="md-nav__link">
    <span class="md-ellipsis">
      ADReplication
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#repadmin" class="md-nav__link">
    <span class="md-ellipsis">
      repadmin
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dcdiag" class="md-nav__link">
    <span class="md-ellipsis">
      dcdiag
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ntdsutil" class="md-nav__link">
    <span class="md-ellipsis">
      ntdsutil
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gpo" class="md-nav__link">
    <span class="md-ellipsis">
      GPO
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Exchange/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Microsoft Exchange
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Virtualization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Virtualization
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Database/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Database
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../MarkupLanguages/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Markup Languages
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../DevOps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DevOps
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../API/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SCM/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SCM
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Ansible/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ansible
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Zabbix/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Zabbix
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Windows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üêß Linux
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#rsat-remote-server-administration-tools" class="md-nav__link">
    <span class="md-ellipsis">
      RSAT (Remote Server Administration Tools)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#import-module-activedirectory" class="md-nav__link">
    <span class="md-ellipsis">
      Import-Module ActiveDirectory
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adsi-active-directory-service-interface" class="md-nav__link">
    <span class="md-ellipsis">
      ADSI (Active Directory Service Interface)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ldap-lightweight-directory-access-protocol" class="md-nav__link">
    <span class="md-ellipsis">
      LDAP (Lightweight Directory Access Protocol)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laps-local-admin-password-management" class="md-nav__link">
    <span class="md-ellipsis">
      LAPS (Local Admin Password Management)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recycle-bin" class="md-nav__link">
    <span class="md-ellipsis">
      Recycle Bin
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thumbnailphoto" class="md-nav__link">
    <span class="md-ellipsis">
      thumbnailPhoto
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#addomaincontroller" class="md-nav__link">
    <span class="md-ellipsis">
      ADDomainController
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adcomputer" class="md-nav__link">
    <span class="md-ellipsis">
      ADComputer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aduser" class="md-nav__link">
    <span class="md-ellipsis">
      ADUser
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adgroupmember" class="md-nav__link">
    <span class="md-ellipsis">
      ADGroupMember
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adreplication" class="md-nav__link">
    <span class="md-ellipsis">
      ADReplication
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#repadmin" class="md-nav__link">
    <span class="md-ellipsis">
      repadmin
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dcdiag" class="md-nav__link">
    <span class="md-ellipsis">
      dcdiag
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ntdsutil" class="md-nav__link">
    <span class="md-ellipsis">
      ntdsutil
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gpo" class="md-nav__link">
    <span class="md-ellipsis">
      GPO
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>Active Directory</h1>

<h2 id="rsat-remote-server-administration-tools">RSAT (Remote Server Administration Tools)</h2>
<p><code>DISM.exe /Online /add-capability /CapabilityName:Rsat.ActiveDirectory.DS-LDS.Tools~~~~0.0.1.0 /CapabilityName:Rsat.GroupPolicy.Management.Tools~~~~0.0.1.0</code> <br />
<code>Add-WindowsCapability ‚Äìonline ‚ÄìName Rsat.Dns.Tools~~~~0.0.1.0</code> <br />
<code>Add-WindowsCapability -Online -Name Rsat.DHCP.Tools~~~~0.0.1.0</code> <br />
<code>Add-WindowsCapability ‚Äìonline ‚ÄìName Rsat.FileServices.Tools~~~~0.0.1.0</code> <br />
<code>Add-WindowsCapability -Online -Name Rsat.WSUS.Tools~~~~0.0.1.0</code> <br />
<code>Add-WindowsCapability -Online -Name Rsat.CertificateServices.Tools~~~~0.0.1.0</code> <br />
<code>Add-WindowsCapability -Online -Name Rsat.RemoteDesktop.Services.Tools~~~~0.0.1.0</code> <br />
<code>Get-WindowsCapability -Name RSAT* -Online | Select-Object -Property DisplayName, State</code> –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–µ–Ω—Ç–æ–≤</p>
<h2 id="import-module-activedirectory">Import-Module ActiveDirectory</h2>
<p><code>$Session = New-PSSession -ComputerName $srv</code> -Credential $cred <br />
<code>Export-PSsession -Session $Session -Module ActiveDirectory -OutputModule ActiveDirectory</code> —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥—É–ª—å –∏–∑ —É–¥–∞–ª–µ–Ω–Ω–æ–π —Å–µ—Å—Å–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å DC) <br />
<code>Remove-PSSession -Session $Session</code> <br />
<code>Import-Module ActiveDirectory</code> <br />
<code>Get-Command -Module ActiveDirectory</code></p>
<h2 id="adsi-active-directory-service-interface">ADSI (Active Directory Service Interface)</h2>
<p><code>$d0 = $env:userdnsdomain</code> <br />
<code>$d0 = $d0 -split "\."</code> <br />
<code>$d1 = $d0[0]</code> <br />
<code>$d2 = $d0[1]</code> <br />
<code>$group = [ADSI]"LDAP://OU=Domain Controllers,DC=$d1,DC=$d2"</code> <br />
<code>$group | select *</code></p>
<p><code>$Local_User = [ADSI]"WinNT://./–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä,user"</code> <br />
<code>$Local_User | Get-Member</code> <br />
<code>$Local_User.Description</code> <br />
<code>$Local_User.LastLogin</code> –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</p>
<h2 id="ldap-lightweight-directory-access-protocol">LDAP (Lightweight Directory Access Protocol)</h2>
<p><code>$ldapsearcher = New-Object System.DirectoryServices.DirectorySearcher</code> <br />
<code>$ldapsearcher.SearchRoot = "LDAP://OU=Domain Controllers,DC=$d1,DC=$d2"</code> <br />
<code>$ldapsearcher.Filter = "(objectclass=computer)"</code> <br />
<code>$dc = $ldapsearcher.FindAll().path</code></p>
<p><code>$usr = $env:username</code> c–ø–∏—Å–æ–∫ –≥—Ä—É–ø–ø —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è <br />
<code>$ldapsearcher = New-Object System.DirectoryServices.DirectorySearcher</code> <br />
<code>$ldapsearcher.Filter = "(&amp;(objectCategory=User)(samAccountName=$usr))"</code> <br />
<code>$usrfind = $ldapsearcher.FindOne()</code> <br />
<code>$groups = $usrfind.properties.memberof -replace "(,OU=.+)"</code> <br />
<code>$groups = $groups -replace "(CN=)"</code></p>
<p>DC (Domain Component) - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–æ–º–µ–Ω–Ω–æ–≥–æ –∏–º–µ–Ω–∏ <br />
OU (Organizational Unit) - –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è (type), –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ <br />
Container - —Ç–∞–∫ –∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ –æ—Ç–ª–∏—á–∏–∏ –æ—Ç –ø–æ–¥—Ä–∞–¥–µ–ª–µ–Ω–∏–π –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω—ã, —É–¥–∞–ª–µ–Ω—ã, —Å–æ–∑–¥–∞–Ω—ã –∏–ª–∏ —Å–≤—è–∑–∞–Ω—ã —Å –æ–±—ä–µ–∫—Ç–æ–º –≥—Ä—É–ø–ø–æ–≤–æ–π –ø–æ–ª–∏—Ç–∏–∫–∏ (Computers, Domain Controllers, Users) <br />
DN (Distinguished Name) ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è –æ–±—ä–µ–∫—Ç–∞ –∏ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤ –ª–µ—Å—É AD. –í DN –æ–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –≤ –¥–µ—Ä–µ–≤–µ (–ø—É—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏–∏), —Ç—Ä–µ–±—É–µ–º–æ–µ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏ –∏–ª–∏ –µ–µ –ø–æ–∏—Å–∫–∞ <br />
CN (Common Name) - –æ–±—â–µ–µ –∏–º—è</p>
<p><code>(Get-ADObject (Get-ADRootDSE).DefaultNamingContext -Properties wellKnownObjects).wellKnownObjects</code> –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é <br />
<code>redircmp OU=Client Computers,DC=root,DC=domain,DC=local</code> –∏–∑–º–µ–Ω–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é <br />
<code>redirusr</code> –∏–∑–º–µ–Ω–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</p>
<h2 id="laps-local-admin-password-management">LAPS (Local Admin Password Management)</h2>
<p><code>Import-module AdmPwd.ps</code> –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥—É–ª—å <br />
<code>Get-AdmPwdPassword -ComputerName NAME</code> –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–∞—Ä–æ–ª—å <br />
<code>Reset-AdmPwdPassword -ComputerName NAME</code> –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å <br />
<code>Get-ADComputer -Filter * -SearchBase "DC=$d1,DC=$d2" | Get-AdmPwdPassword -ComputerName {$_.Name} | select ComputerName,Password,ExpirationTimestamp | Out-GridView</code> <br />
<code>Get-ADComputer -Identity $srv | Get-AdmPwdPassword -ComputerName {$_.Name} | select ComputerName,Password,ExpirationTimestamp</code></p>
<h2 id="recycle-bin">Recycle Bin</h2>
<p>–£–¥–∞–ª–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∫–æ—Ä–∑–∏–Ω–µ AD –≤ —Ç–µ—á–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞—Ö–æ—Ä–æ–Ω–µ–Ω–∏—è (–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –≤ –∞—Ç—Ä–∏–±—É—Ç–µ –¥–æ–º–µ–Ω–∞ msDS-deletedObjectLifetime), –∑–∞–¥–∞–Ω–Ω–æ–º –¥–ª—è –ª–µ—Å–∞. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —ç—Ç–æ 180 –¥–Ω–µ–π. –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–π —Å—Ä–æ–∫ –ø—Ä–æ—à–µ–ª, –æ–±—ä–µ–∫—Ç –≤—Å–µ –µ—â–µ –æ—Å—Ç–∞–µ—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ Deleted Objects, –Ω–æ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –µ–≥–æ –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –∏ —Å–≤—è–∑–µ–π –æ—á–∏—â–∞—é—Ç—Å—è (Recycled Object). –ü–æ—Å–ª–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è –ø–µ—Ä–∏–æ–¥–∞ tombstoneLifetime (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ç–∞–∫–∂–µ 180 –¥–Ω–µ–π, –Ω–æ –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å) –æ–±—ä–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ AD –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º –æ—á–∏—Å—Ç–∫–∏. <br />
<code>Get-ADForest domain.local</code> –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å —Ä–∞–±–æ—Ç—ã –ª–µ—Å–∞ <br />
<code>Set-ADForestMode -Identity domain.local -ForestMode Windows2008R2Forest -force</code> —É–≤–µ–ª–∏—á–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å —Ä–∞–±–æ—Ç—ã –ª–µ—Å–∞ <br />
<code>Enable-ADOptionalFeature ‚ÄìIdentity "CN=Recycle Bin Feature,CN=Optional Features,CN=Directory Service,CN=Windows NT,CN=Services,CN=Configuration,DC=domain,DC=local" ‚ÄìScope ForestOrConfigurationSet ‚ÄìTarget "domain.local"</code> –≤–∫–ª—é—á–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É <br />
<code>Get-ADOptionalFeature "Recycle Bin Feature" | select-object name,EnabledScopes</code> –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ EnabledScopes –Ω–µ –ø—É—Å—Ç–æ–µ, –∑–Ω–∞—á–∏—Ç –≤ –¥–æ–º–µ–Ω–µ –∫–æ—Ä–∑–∏–Ω–∞ Active Directory –≤–∫–ª—é—á–µ–Ω–∞ <br />
<code>Get-ADObject -Filter 'Name -like "*tnas*"' -IncludeDeletedObjects</code> –Ω–∞–π—Ç–∏ —É–¥–∞–ª–µ–Ω–Ω—É—é (Deleted: True) –£–ó (ObjectClass: user) –≤ AD <br />
<code>Get-ADObject -Filter 'Name -like "*tnas*"' ‚ÄìIncludeDeletedObjects -Properties *| select-object Name, sAMAccountName, LastKnownParent, memberOf, IsDeleted | fl</code> –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –∞—Ç—Ä–∏–±—É—Ç–∞ IsDeleted, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –≤ –∫–æ—Ç–æ—Ä–æ–º –Ω–∞—Ö–æ–¥–∏–ª—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º (LastKnownParent) –∏ —Å–ø–∏—Å–æ–∫ –≥—Ä—É–ø–ø, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –æ–Ω —Å–æ—Å—Ç–æ—è–ª <br />
<code>Get-ADObject ‚Äìfilter {Deleted -eq $True -and ObjectClass -eq "user"} ‚ÄìincludeDeletedObjects</code> –≤—ã–≤–µ—Å—Ç–∏ —Å–ø–∏—Å–æ–∫ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π <br />
<code>Restore-ADObject -Identity "3dc33c7c-b912-4a19-b1b7-415c1395a34e"</code> –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é –∞—Ç—Ä–∏–±—É—Ç–∞ ObjectGUID <br />
<code>Get-ADObject -Filter 'SAMAccountName -eq "tnas-01"' ‚ÄìIncludeDeletedObjects | Restore-ADObject</code> –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ SAMAccountName <br />
<code>Get-ADObject -Filter {Deleted -eq $True -and ObjectClass -eq 'group' -and Name -like '*Allow*'} ‚ÄìIncludeDeletedObjects | Restore-ADObject ‚ÄìVerbose</code> –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≥—Ä—É–ø–ø—É –∏–ª–∏ –∫–æ–º–ø—å—é—Ç–µ—Ä</p>
<h2 id="thumbnailphoto">thumbnailPhoto</h2>
<p><code>$photo = [byte[]](Get-Content C:\Install\adm.jpg -Encoding byte)</code> –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å —Ñ–∞–π–ª –∫–∞—Ä—Ç–∏–Ω–∫–∏ –≤ –º–∞—Å—Å–∏–≤ –±–∞–π—Ç–æ–≤ (jpeg/bmp —Ñ–∞–π–ª, —Ä–∞–∑–º–µ—Ä–æ–º —Ñ–æ—Ç–æ –¥–æ 100 –ö–± –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ–º 96?96) <br />
<code>Set-ADUser support4 -Replace @{thumbnailPhoto=$photo}</code> –∑–∞–¥–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –∞—Ç—Ä–∏–±—É—Ç–∞ thumbnailPhoto</p>
<h2 id="addomaincontroller">ADDomainController</h2>
<p><code>Get-ADDomainController</code> –≤—ã–≤–æ–¥–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ –¥–æ–º–µ–Ω–∞ (LogonServer), –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–∞–Ω–Ω—ã–º –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–º –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (DC –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç–æ–ø–æ–ª–æ–≥–∏–µ–π —Å–∞–π—Ç–æ–≤ AD) <br />
<code>Get-ADDomainController -Discover -Service PrimaryDC</code> –Ω–∞–π—Ç–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —Å —Ä–æ–ª—å—é PDC –≤ –¥–æ–º–µ–Ω–µ <br />
<code>Get-ADDomainController -Filter * | ft HostName,IPv4Address,Name,Site,OperatingSystem,IsGlobalCatalog</code> —Å–ø–∏—Å–æ–∫ –≤—Å–µ DC, –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å –∫ —Å–∞–π—Ç—É, –≤–µ—Ä—Å–∏–∏ –û–° –∏ GC</p>
<p>–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –û–° —Å–ª—É–∂–±–∞ NetLogon –¥–µ–ª–∞–µ—Ç DNS –∑–∞–ø—Ä–æ—Å —Å–æ —Å–ø–∏—Å–∫–æ–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ –¥–æ–º–µ–Ω–∞ (–∫ SRV –∑–∞–ø–∏—Å–∏ <em>ldap._tcp.dc._msdcs.domain</em>), DNS –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ DC –≤ –¥–æ–º–µ–Ω–µ —Å –∑–∞–ø–∏—Å—å—é Service Location (SRV). –ö–ª–∏–µ–Ω—Ç –¥–µ–ª–∞–µ—Ç LDAP –∑–∞–ø—Ä–æ—Å –∫ DC –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–∞–π—Ç–∞ AD –ø–æ —Å–≤–æ–µ–º—É IP –∞–¥—Ä–µ—Å—É. –ö–ª–∏–µ–Ω—Ç —á–µ—Ä–µ–∑ DNS –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ –¥–æ–º–µ–Ω–∞ –≤ —Å–∞–π—Ç–µ (–≤ —Ä–∞–∑–¥–µ–ª–µ _tcp.sitename._sites...).</p>
<p>USN (Update Sequence Numbers) - —Å—á–µ—Ç—á–∏–∫ –Ω–æ–º–µ—Ä–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–π —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —É –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ AD. –ü—Ä–∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –æ–±–º–µ–Ω–∏–≤–∞—é—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ USN, –æ–±—ä–µ–∫—Ç —Å –±–æ–ª–µ–µ –Ω–∏–∑–∫–∏–º USN –±—É–¥–µ—Ç –ø—Ä–∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω –æ–±—ä–µ–∫—Ç–æ–º —Å –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–∏–º USN. –ù–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å–≤–æ–π—Å—Ç–≤–∞—Ö - Object (–≤–∫–ª—é—á–∏—Ç—å View - Advanced Features). –ö–∞–∂–¥—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–æ–º–µ–Ω–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å—á–µ—Ç—á–∏–∫ USN, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—á–∏–Ω–∞–µ—Ç –æ—Ç—Å—á–µ—Ç –≤ –º–æ–º–µ–Ω—Ç –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ Dcpromo –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Ç–µ—á–µ–Ω–∏–µ –≤—Å–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –¥–æ–º–µ–Ω–∞. –ó–Ω–∞—á–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ USN —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –Ω–∞ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ –¥–æ–º–µ–Ω–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è, —ç—Ç–æ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è, –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞.</p>
<p><code>Get-ADDomainController -Filter * | % {</code> –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å USN –æ–±—ä–µ–∫—Ç–∞ –Ω–∞ –≤—Å–µ—Ö DC –≤ –¥–æ–º–µ–Ω–µ<code></code>Get-ADUser -Server $_.HostName -Identity support4 -Properties uSNChanged | select SamAccountName,uSNChanged<code></code>}`</p>
<p><code>dcpromo /forceremoval</code> –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç –ø–æ–Ω–∏–∂–µ–Ω–∏–µ –≤ —Ä–æ–ª–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –¥–æ–º–µ–Ω–∞ –¥–æ —É—Ä–æ–≤–Ω—è —Ä—è–¥–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞. –ü–æ—Å–ª–µ –ø–æ–Ω–∏–∂–µ–Ω–∏—è —Ä–æ–ª–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —É–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —Å—Å—ã–ª–æ–∫ –≤ –¥–æ–º–µ–Ω–µ –Ω–∞ —ç—Ç–æ—Ç –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä. –î–∞–ª–µ–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –≤–∫–ª—é—á–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞ –≤ —Å–æ—Å—Ç–∞–≤ –¥–æ–º–µ–Ω–∞, –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞, —Ç.–µ. –ø–æ–≤—ã—à–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ —É—Ä–æ–≤–Ω—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –¥–æ–º–µ–Ω–∞.</p>
<h2 id="adcomputer">ADComputer</h2>
<p><code>nltest /DSGETDC:$env:userdnsdomain</code> —É–∑–Ω–∞—Ç—å –Ω–∞ –∫–∞–∫–æ–º DC –∞—É–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω —Ö–æ—Å—Ç (Logon Server) <br />
<code>nltest /SC_RESET:$env:userdnsdomain\srv-dc2.$env:userdnsdomain</code> –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –∫–æ–º–ø—å—é—Ç–µ—Ä –Ω–∞ –¥—Ä—É–≥–æ–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–æ–º–µ–Ω–∞ AD –≤—Ä—É—á–Ω—É—é (The command completed successfully) <br />
<code>Get-ADComputer ‚ÄìIdentity $env:computername -Properties PasswordLastSet</code> –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ <br />
<code>Test-ComputerSecureChannel ‚Äìverbose</code> –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å –¥–æ–º–µ–Ω–æ–º (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ –ø–∞—Ä–æ–ª—é, —Ö—Ä–∞–Ω—è—â–µ–º—É—Å—è –≤ AD) <br />
<code>Reset-ComputerMachinePassword -Credential domain\admin</code> –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–æ–ª—å <br />
<code>Netdom ResetPWD /Server:dc-01 /UserD:domain\admin /PasswordD:*</code> —Å–±—Ä–æ—Å–∏—Ç—å —Ö—ç—à –ø–∞—Ä–æ–ª—è –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ –≤ –¥–æ–º–µ–Ω–µ (–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è) <br />
<code>Search-ADAccount -AccountDisabled -ComputersOnly | select Name,LastLogonDate,Enabled</code> –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –≤—Å–µ –æ—Ç–∫–ª—é—á–µ–Ω–Ω—ã–µ –∫–æ–º–ø—å—é—Ç–µ—Ä—ã</p>
<p><code>Get-ADComputer -Filter * -Properties * | select name</code> —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–≤ –≤ –¥–æ–º–µ–Ω–µ (Filter), –≤—ã–≤–µ—Å—Ç–∏ –≤—Å–µ —Å–≤–æ–π—Å—Ç–≤–∞ (Properties) <br />
<code>Get-ADComputer -Identity $srv -Properties * | ft Name,LastLogonDate,PasswordLastSet,ms-Mcs-AdmPwd -Autosize</code> –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ –≤ AD (Identity) <br />
<code>Get-ADComputer -SearchBase "OU=Domain Controllers,DC=$d1,DC=$d2" -Filter * -Properties * | ft Name, LastLogonDate, distinguishedName -Autosize</code> –ø–æ–∏—Å–∫ –≤ –±–∞–∑–µ –ø–æ DN (SearchBase)</p>
<p><code>(Get-ADComputer -Filter {enabled -eq "true"}).count</code> –ø–æ–ª—É—á–∏—Ç—å –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö (–Ω–µ–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö) –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–≤ <br />
<code>(Get-ADComputer -Filter {enabled -eq "true" -and OperatingSystem -like "*Windows Server 2016*"}).count</code> –∫–æ–ª-–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–ø—å—é—Ç–µ—Ä–æ–≤ —Å –û–° WS 2016</p>
<p><code>Get-ADComputer -Filter * -Properties * | select @{Label="Ping Status"; Expression={</code> <br />
<code>$ping = ping -n 1 -w 50 $_.Name</code> <br />
<code>if ($ping -match "TTL") {"Online"} else {"Offline"}</code> <br />
<code>}},</code> <br />
<code>@{Label="Status"; Expression={</code> <br />
<code>if ($_.Enabled -eq "True") {$_.Enabled -replace "True","Active"} else {$_.Enabled -replace "False","Blocked"}</code> <br />
<code>}}, Name, IPv4Address, OperatingSystem, @{Label="UserOwner"; Expression={$_.ManagedBy -replace "(CN=|,.+)"}</code> <br />
<code>},Created | Out-GridView</code></p>
<h2 id="aduser">ADUser</h2>
<p><code>Get-ADUser -Identity support4 -Properties *</code> —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∞—Ç—Ä–∏–±—É—Ç–æ–≤ <br />
<code>Get-ADUser -Identity support4 -Properties DistinguishedName, EmailAddress, Description</code> –ø—É—Ç—å DN, email –∏ –æ–ø–∏—Å–∞–Ω–∏–µ <br />
<code>Get-ADUser -Filter {(Enabled -eq "True") -and (mail -ne "null")} -Properties mail | ft Name,mail</code> —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –µ—Å—Ç—å –ø–æ—á—Ç–æ–≤—ã–π —è—â–∏–∫ <br />
<code>Get-ADUser -Filter {SamAccountName -like "*"} | Measure-Object</code> –ø–æ—Å—á–∏—Ç–∞—Ç—å –∫–æ–ª-–≤–æ –≤—Å–µ—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤ (Count) <br />
<code>Get-ADUser -Filter * -Properties WhenCreated | sort WhenCreated | ft Name, whenCreated</code> –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è <br />
<code>Get-ADUser -Identity support4 -property LockedOut | select samaccountName,Name,Enabled,Lockedout</code> <br />
<code>Enabled=True</code> —É—á–µ—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å –≤–∫–ª—é—á–µ–Ω–∞ - –¥–∞ <br />
<code>Lockedout=False</code> —É—á–µ—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–ª–∏—Ç–∏–∫–æ–π –ø–∞—Ä–æ–ª–µ–π) - –Ω–µ—Ç <br />
<code>Get-ADUser -Identity support4 | Unlock-ADAccount</code> —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —É—á–µ—Ç–Ω—É—é –∑–∞–ø–∏—Å—å <br />
<code>Disable-ADAccount -Identity support4</code> –æ—Ç–∫–ª—é—á–∏—Ç—å —É—á–µ—Ç–Ω—É—é –∑–∞–ø–∏—Å—å <br />
<code>Enable-ADAccount -Identity support4</code> –≤–∫–ª—é—á–∏—Ç—å —É—á–µ—Ç–Ω—É—é –∑–∞–ø–∏—Å—å <br />
<code>Search-ADAccount -LockedOut</code> –Ω–∞–π—Ç–∏ –≤—Å–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –∑–∞–ø–∏—Å–∏ <br />
<code>Search-ADAccount -AccountDisabled | select Name,LastLogonDate,Enabled</code> –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –≤—Å–µ –æ—Ç–∫–ª—é—á–µ–Ω–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –∑–∞–ø–∏—Å–∏ —Å –≤—Ä–µ–º–µ–Ω–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤—Ö–æ–¥–∞</p>
<p><code>Get-ADUser -Identity support4 -Properties PasswordLastSet,PasswordExpired,PasswordNeverExpires</code> <br />
<code>PasswordLastSet</code> –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è <br />
<code>PasswordExpired=False</code> –ø–∞—Ä–æ–ª—å –∏—Å—Ç–µ–∫ - –Ω–µ—Ç <br />
<code>PasswordNeverExpires=True</code> —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –ø–∞—Ä–æ–ª—è –Ω–µ –∏—Å—Ç–µ–∫–∞–µ—Ç - –¥–∞ <br />
<code>Set-ADAccountPassword support4 -Reset -NewPassword (ConvertTo-SecureString -AsPlainText "password" -Force -Verbose)</code> –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å —É—á–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏ <br />
<code>Set-ADUser -Identity support4 -ChangePasswordAtLogon $True</code> —Å–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –≤—Ö–æ–¥–µ –≤ —Å–∏—Å—Ç–µ–º—É</p>
<p><code>$day = (Get-Date).adddays(-90)</code> <br />
<code>Get-ADUser -filter {(passwordlastset -le $day)} | ft</code> –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –º–µ–Ω—è–ª–∏ —Å–≤–æ–π –ø–∞—Ä–æ–ª—å –±–æ–ª—å—à–µ 90 –¥–Ω–µ–π</p>
<p><code>$day = (Get-Date).adddays(-30)</code> <br />
<code>Get-ADUser -filter {(Created -ge $day)} -Property Created | select Name,Created</code> –ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∑–∞ 30 –¥–Ω–µ–π</p>
<p><code>$day = (Get-Date).adddays(-360)</code> <br />
<code>Get-ADUser -Filter {(LastLogonTimestamp -le $day)} -Property LastLogonTimestamp | select Name,SamAccountName,@{n='LastLogonTimestamp';e={[DateTime]::FromFileTime($_.LastLogonTimestamp)}} | sort -Descending LastLogonTimestamp</code> –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –ª–æ–≥–∏–Ω–∏–ª–∏—Å—å –±–æ–ª—å—à–µ 360 –¥–Ω–µ–π. –†–µ–ø–ª–∏–∫–∞—Ü–∏—è –∞—Ç—Ä–∏–±—É—Ç–∞ LastLogonTimestamp —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ—Ç 9 –¥–æ 14 –¥–Ω–µ–π. <br />
<code>| Disable-ADAccount $_.SamAccountName</code> –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å <br />
<code>-WhatIf</code> –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –≤—ã–≤–æ–¥ –±–µ–∑ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π</p>
<h2 id="adgroupmember">ADGroupMember</h2>
<p><code>(Get-ADUser -Identity support4 -Properties MemberOf).memberof</code> —Å–ø–∏—Å–æ–∫ –≥—Ä—É–ø–ø –≤ –∫–æ—Ç–æ—Ä—ã—Ö —Å–æ—Å—Ç–æ–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å <br />
<code>Get-ADGroupMember -Identity "Domain Admins" | Select Name,SamAccountName</code> —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –≥—Ä—É–ø–ø–µ <br />
<code>Add-ADGroupMember -Identity "Domain Admins" -Members support5</code> –¥–æ–±–∞–≤–∏—Ç—å –≤ –≥—Ä—É–ø–ø—É <br />
<code>Remove-ADGroupMember -Identity "Domain Admins" -Members support5 -force</code> —É–¥–∞–ª–∏—Ç—å –∏–∑ –≥—Ä—É–ø–ø—ã <br />
<code>Get-ADGroup -filter * | where {!($_ | Get-ADGroupMember)} | Select Name</code> –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç—ã—Ö –≥—Ä—É–ø–ø (-Not)</p>
<h2 id="adreplication">ADReplication</h2>
<p><code>Get-Command -Module ActiveDirectory -Name *Replication*</code> —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥–ª–µ—Ç–æ–≤ –º–æ–¥—É–ª—è <br />
<code>Get-ADReplicationFailure -Target dc-01</code> —Å–ø–∏—Å–æ–∫ –æ—à–∏–±–æ–∫ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ —Å –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º–∏ <br />
<code>Get-ADReplicationFailure -Target $env:userdnsdomain -Scope Domain</code> <br />
<code>Get-ADReplicationPartnerMetadata -Target dc-01 | select Partner,LastReplicationAttempt,LastReplicationSuccess,LastReplicationResult,LastChangeUsn</code> –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –∏ –≤—Ä–µ–º—è —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ —Å –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º–∏ <br />
<code>Get-ADReplicationUpToDatenessVectorTable -Target dc-01</code> Update Sequence Number (USN) —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –Ω–∞ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ –¥–æ–º–µ–Ω–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è (–æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è, –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞), –ø—Ä–∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ DC –æ–±–º–µ–Ω–∏–≤–∞—é—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ USN, –æ–±—ä–µ–∫—Ç —Å –±–æ–ª–µ–µ –Ω–∏–∑–∫–∏–º USN –ø—Ä–∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω –≤—ã—Å–æ–∫–∏–º USN.</p>
<h2 id="repadmin">repadmin</h2>
<p><code>repadmin /replsummary</code> –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –Ω–∞ –≤—Å–µ—Ö DC –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é (Source –∏ Destination) –∏ –∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å —É—á–µ—Ç–æ–º –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ <br />
<code>repadmin /showrepl $srv</code> –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –≤—Å–µ—Ö –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –ø–æ —Ä–µ–ø–ª–∫–∞—Ü–∏–∏ –∏ –∏—Ö —Å—Ç–∞—Ç—É—Å –¥–ª—è –≤—Å–µ—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ Naming Contexts (DC=ForestDnsZones, DC=DomainDnsZones, CN=Schema, CN=Configuration) <br />
<code>repadmin /replicate $srv2 $srv1 DC=domain,DC=local</code> –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é —Å $srv1 –Ω–∞ $srv2 —Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞–Ω–Ω—ã–π —Ä–∞–∑–¥–µ–ª–∞ –¥–æ–º–µ–Ω–∞ <br />
<code>repadmin /SyncAll /AdeP</code> –∑–∞–ø—É—Å—Ç–∏—Ç—å –º–µ–∂—Å–∞–π—Ç–æ–≤—É—é –∏—Å—Ö–æ–¥—è—â—É—é —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é –≤—Å–µ—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ —Å–æ –≤—Å–µ–º–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º–∏ –ø–æ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ <br />
<code>/A</code> –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–ª—è –≤—Å–µ—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ NC <br />
<code>/d</code> –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ä–≤–µ—Ä—ã –ø–æ DN (–≤–º–µ—Å—Ç–æ GUID DNS - –≥–ª–æ–±–∞–ª—å–Ω—ã–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞–º) <br />
<code>/e</code> –º–µ–∂—Å–∞–π—Ç–æ–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ —Å DC —Ç–µ–∫—É—â–µ–≥–æ —Å–∞–π—Ç–∞) <br />
<code>/P</code> –∏–∑–≤–µ—â–∞—Ç—å –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö —Å —ç—Ç–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: –æ–ø—Ä–∞—à–∏–≤–∞—Ç—å –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö) <br />
<code>repadmin /Queue $srv</code> –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∫–æ–ª-–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤—Ö–æ–¥—è—â–µ–π —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ (–æ—á–µ—Ä–µ–¥—å), –∫–æ—Ç–æ—Ä–æ–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å (–ø—Ä–∏—á–∏–Ω–æ–π –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–æ–µ –∫–æ–ª-–≤–æ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –∏–ª–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ 1000 –æ–±—ä–µ–∫—Ç–æ–≤ —Å–∫—Ä–∏–ø—Ç–æ–º) <br />
<code>repadmin /showbackup *</code> —É–∑–Ω–∞—Ç—å –¥–∞—Ç—É –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ Backup</p>
<p><code>Error: 1722</code> —Å–µ—Ä–≤–µ—Ä rpc –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (–æ—à–∏–±–∫–∞ –æ—Ç–∫–∞—Ç–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏). –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–º—è –¥–æ–º–µ–Ω–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Å–µ—Ç–µ–≤–æ–≥–æ –∞–¥–∞–ø—Ç–µ—Ä–∞, –ø–µ—Ä–≤—ã–º –¥–æ–ª–∂–µ–Ω –∏–¥—Ç–∏ –∞–¥—Ä–µ—Å DNS-—Å–µ—Ä–≤–µ—Ä–∞ –¥—Ä—É–≥–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –¥–æ–º–µ–Ω–∞, –≤—Ç–æ—Ä—ã–º —Å–≤–æ–π –∞–¥—Ä–µ—Å. <br />
<code>Get-Service -ComputerName $srv | select name,status | ? name -like "RpcSs"</code> <br />
<code>Get-Service -ComputerName $srv -Name RpcSs -RequiredServices</code> –∑–∞–≤–∏—Å–∏–º—ã–µ —Å–ª—É–∂–±—ã <br />
–ó–∞–≤–∏—Å–∏–º—ã–µ —Å–ª—É–∂–±—ã RPC: <br />
"–°–ª—É–∂–±–∞ —Å–≤–µ–¥–µ–Ω–∏–π –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö —Å–µ—Ç—è—Ö" - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫. –ï—Å–ª–∏ —Å–ª—É–∂–±–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–æ "—Å–ª—É–∂–±—ã —Å–ø–∏—Å–∫–∞ —Å–µ—Ç–µ–π", –º–æ–∂–µ—Ç –ø–∞–¥–∞—Ç—å —Å–≤—è–∑—å —Å –¥–æ–º–µ–Ω–æ–º (netlogon) <br />
"–¶–µ–Ω—Ç—Ä —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –∫–ª—é—á–µ–π Kerberos" <br />
"DNS-—Å–µ—Ä–≤–µ—Ä" <br />
<code>nslookup $srv</code> <br />
<code>tnc $srv -p 135</code> <br />
<code>repadmin /retry</code> –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É –ø—Ä–∏–≤—è–∑–∫–∏ –∫ —Ü–µ–ª–µ–≤–æ–º—É DC, –µ—Å–ª–∏ –±—ã–ª–∞ –æ—à–∏–±–∫–∞ 1722 –∏–ª–∏ 1753 (RPC –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)</p>
<p><code>repadmin /showrepl $srv</code> <br />
<code>Last attempt @ 2022-07-15 10:46:01 –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —Å –æ—à–∏–±–∫–æ–π, —Ä–µ–∑—É–ª—å—Ç–∞—Ç 8456 (0x2108)</code> –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ showrepl —ç—Ç–æ–≥–æ –ø–∞—Ä—Ç–Ω–µ—Ä–∞, –µ–≥–æ –æ—à–∏–±–∫–∞: 8457 (0x2109) <br />
<code>Last success @ 2022-07-11 02:29:46</code> –ø–æ—Å–ª–µ–¥–Ω–∏–π —É—Å–ø–µ—Ö <br />
–ö–æ–≥–¥–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∞, –û–° –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ DSA - not writable –æ–¥–Ω–æ –∏–∑ —á–µ—Ç—ã—Ä–µ—Ö –∑–Ω–∞—á–µ–Ω–∏–π: <br />
<code>Path: HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\NTDS\Parameters</code> <br />
<code>Dsa Not Writable</code> <br />
<code>##define DSA_WRITABLE_GEN 1</code> –≤–µ—Ä—Å–∏—è –ª–µ—Å–∞ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å –û–° <br />
<code>##define DSA_WRITABLE_NO_SPACE 2</code> –Ω–∞ –¥–∏—Å–∫–µ, –≥–¥–µ —Ä–∞–∑–º–µ—â–µ–Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö Active Directory –∏–ª–∏ —Ñ–∞–π–ª—ã –∂—É—Ä–Ω–∞–ª–æ–≤ (–ª–æ–≥–∏), –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ <br />
<code>##define DSA_WRITABLE_USNROLLBCK 4</code> –æ—Ç–∫–∞—Ç USN –ø—Ä–æ–∏–∑–æ—à–µ–ª –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–∫–∞—Ç–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Active Directory –≤–æ –≤—Ä–µ–º–µ–Ω–∏ (–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ —Å–Ω–∞–ø—à–æ—Ç–∞) <br />
<code>##define DSA_WRITABLE_CORRUPT_UTDV 8</code> –≤–µ–∫—Ç–æ—Ä –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ –¥–æ–º–µ–Ω–∞</p>
<h2 id="dcdiag">dcdiag</h2>
<p><code>dcdiag /s:&lt;DomainController&gt; [/n:&lt;NamingContext&gt;] [[/u:&lt;domain\user&gt;] [/p:&lt;password&gt;]] [{/a|/e}{/q|/v}] [/f:&lt;LogFile&gt;] [/ferr:&lt;ErrorLog&gt;] [/test:&lt;test&gt;] [/fix]</code> <br />
<code>dcdiag /Test:replications /s:dc-01</code> –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –æ—à–∏–±–∫–∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ <br />
<code>dcdiag /Test:DNS /e /v /q</code> —Ç–µ—Å—Ç DNS <br />
<code>/a</code> –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤ –¥–∞–Ω–Ω–æ–≥–æ —Å–∞–π—Ç–∞ <br />
<code>/e</code> –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è <br />
<code>/q</code> –≤—ã–≤–æ–¥–∏—Ç—å —Ç–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö <br />
<code>/v</code> –≤—ã–≤–æ–¥–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é <br />
<code>/fix</code> –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç –æ—à–∏–±–∫–∏ <br />
<code>/test:</code> <br />
<code>NetLogons</code> –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏–µ –ø—Ä–∞–≤ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ <br />
<code>Connectivity</code> –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é DNS –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –¥–æ–º–µ–Ω–∞, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–π —ç—Ö–æ-–ø–∞–∫–µ—Ç –Ω–∞ –∫–∞–∂–¥—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–æ–º–µ–Ω–∞ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞–º LDAP –∏ RPC –∫ –∫–∞–∂–¥–æ–º—É –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—É –¥–æ–º–µ–Ω–∞ <br />
<code>Services</code> –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –≤—Å–µ—Ö —Å–ª—É–∂–±, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–ª—è —Ä–∞–±–æ—Ç—ã –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –¥–æ–º–µ–Ω–∞, –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ –¥–æ–º–µ–Ω–∞ <br />
<code>Systemlog</code> –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫ –≤ –∂—É—Ä–Ω–∞–ª–∞—Ö –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –¥–æ–º–µ–Ω–∞ <br />
<code>FRSEvent</code> –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—à–∏–±–∫–∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –≤ —Ä–∞–±–æ—Ç–µ —Å–ª—É–∂–±—ã —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ —Ñ–∞–π–ª–æ–≤, —á—Ç–æ –º–æ–∂–µ—Ç –æ–∑–Ω–∞—á–∞—Ç—å –Ω–∞–ª–∏—á–∏–µ –ø—Ä–æ–±–ª–µ–º –≤ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ SYSVOL –∏, —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –∫–æ–ø–∏–π –æ–±—ä–µ–∫—Ç–æ–≤ –≥—Ä—É–ø–ø–æ–≤—ã—Ö –ø–æ–ª–∏—Ç–∏–∫ <br />
<code>FSMOCheck</code> –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–æ–ª–∏ —Ö–æ–∑—è–µ–≤ –æ–ø–µ—Ä–∞—Ü–∏–π, –∞ –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞, –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–æ–º–µ–Ω–∞, –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –≤—Ä–µ–º–µ–Ω–∏, —Å–µ—Ä–≤–µ—Ä –≤—Ä–µ–º–µ–Ω–∏ –∏ —Ü–µ–Ω—Ç—Ä —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –∫–ª—é—á–µ–π (–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–æ–º–µ–Ω–∞ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ KDC, PDC, —Å–µ—Ä–≤–µ—Ä—É –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞) <br />
<code>KnowsOfRoleHolders</code> –øg—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ –¥–æ–º–µ–Ω–∞ –∫–æ –≤—Å–µ–º –ø—è—Ç–∏ —Ö–æ–∑—è–µ–≤–∞–º –æ–ø–µ—Ä–∞—Ü–∏–π (—Ä–æ–ª—è–º–∏ FSMO) <br />
<code>MachineAccount</code> –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —É—á–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏ —Ü–µ–ª–µ–≤–æ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–π —Å–ª—É–∂–± —ç—Ç–æ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ (–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å –¥–æ–º–µ–Ω–æ–º). –ï—Å–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –æ—à–∏–±–∫–∞, –µ–µ –º–æ–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å —Å –ø–æ–º–æ—â—å—é —É—Ç–∏–ª–∏—Ç—ã dcdiag, —É–∫–∞–∑–∞–≤ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã /fixmachineaccount –∏–ª–∏ /recreatemachineaccount <br />
<code>Advertising</code> –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–æ–º–µ–Ω–∞ —Å–æ–æ–±—â–∞–µ—Ç –æ —Å–µ–±–µ –∏ –æ —Å–≤–æ–µ–π —Ä–æ–ª–∏ —Ö–æ–∑—è–∏–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–π. –≠—Ç–æ—Ç —Ç–µ—Å—Ç –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è –Ω–µ—É–¥–∞—á–Ω–æ, –µ—Å–ª–∏ —Å–ª—É–∂–±–∞ NetLogon –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞ <br />
<code>CheckSDRefDom</code> –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –¥–æ–º–µ–Ω–æ–≤ —Å—Å—ã–ª–æ–∫ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ –∫–∞—Ç–∞–ª–æ–≥–æ–≤ –ø—Ä–æ–≥—Ä–∞–º–º <br />
<code>CrossRefValidation</code> –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–∫—Ä–µ—Å—Ç–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ –¥–ª—è –¥–æ–º–µ–Ω–æ–≤ <br />
<code>RRSSysvol</code> –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –¥–ª—è FRS SYSVOL <br />
<code>Intersite</code> –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –ø–æ–º–µ—à–∞—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –º–µ–∂–¥—É —Å–∞–π—Ç–∞–º–∏. –ö–æ–º–ø–∞–Ω–∏—è Microsoft –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ—Ç, —á—Ç–æ –∏–Ω–æ–≥–¥–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —ç—Ç–æ–≥–æ —Ç–µ—Å—Ç–∞ –º–æ–≥—É—Ç –æ–∫–∞–∑–∞—Ç—å—Å—è –Ω–µ—Ç–æ—á–Ω—ã–º–∏ <br />
<code>KCCEvent</code> –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –±–µ–∑–æ—à–∏–±–æ—á–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –¥–ª—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –º–µ–∂–¥—É —Å–∞–π—Ç–∞–º–∏ <br />
<code>NCSecDesc</code> –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –¥–ª—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –≤ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–∞—Ö –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è <br />
<code>ObjectsReplicated</code> –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –∞–≥–µ–Ω—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞ –∫–∞—Ç–∞–ª–æ–≥–æ–≤ –∏ –æ–±—ä–µ–∫—Ç–æ–≤ —É—á–µ—Ç–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–≤ <br />
<code>OutboundSecureChannels</code> –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ –º–µ–∂–¥—É –≤—Å–µ–º–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞–º–∏ –¥–æ–º–µ–Ω–∞ –≤ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–µ–º –¥–æ–º–µ–Ω–µ <br />
<code>Replications</code> –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –º–µ–∂–¥—É –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞–º–∏ –¥–æ–º–µ–Ω–∞ –∏ —Å–æ–æ–±—â–∞–µ—Ç –æ–±–æ –≤—Å–µ—Ö –æ—à–∏–±–∫–∞—Ö –ø—Ä–∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ <br />
<code>RidManager</code> –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ö–æ–∑—è–∏–Ω–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ <br />
<code>VerifyEnterpriseReferences</code> –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ —Å–ª—É–∂–±—ã —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –Ω–∞ –≤—Å–µ—Ö –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö –¥–æ–º–µ–Ω–∞ –≤ –ª–µ—Å—É <br />
<code>VerifyReferences</code> –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ —Å–ª—É–∂–±—ã —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ –¥–æ–º–µ–Ω–∞ <br />
<code>VerifyReplicas</code> –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—Å–µ—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ –∫–∞—Ç–∞–ª–æ–≥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö, –ø—Ä–∏–Ω–∏–º–∞—é—â–∏—Ö —É—á–∞—Å—Ç–∏–µ –≤ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏</p>
<h2 id="ntdsutil">ntdsutil</h2>
<p>–ü–µ—Ä–µ–Ω–æ—Å –ë–î AD (ntds.dit): <br />
<code>Get-Acl C:\Windows\NTDS | Set-Acl D:\AD-DB</code> —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å NTFS —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ –Ω–æ–≤—ã–π –∫–∞—Ç–∞–ª–æ–≥ <br />
<code>Stop-Service -ComputerName dc -name NTDS</code> –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–ª—É–∂–±—É Active Directory Domain Services <br />
<code>ntdsutil</code> –∑–∞–ø—É—Å—Ç–∏—Ç—å —É—Ç–∏–ª–∏—Ç—É ntdsutil <br />
<code>activate instance NTDS</code> –≤—ã–±—Ä–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –±–∞–∑—ã AD <br />
<code>files</code> –ø–µ—Ä–µ–π–¥–µ–º –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç files, –≤ –∫–æ—Ç–æ—Ä–æ–º –≤–æ–∑–º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏—è —Å —Ñ–∞–π–ª–∞–º–∏ –±–∞–∑—ã ntds.dit <br />
<code>move DB to D:\AD-DB\</code> –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –±–∞–∑—É AD –≤ –Ω–æ–≤—ã–π –∫–∞—Ç–∞–ª–æ–≥ (–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –Ω—É–∂–Ω–æ –µ–≥–æ —Å–æ–∑–¥–∞—Ç—å) <br />
<code>info</code> –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ë–î –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –Ω–æ–≤–æ–º –∫–∞—Ç–∞–ª–æ–≥–µ <br />
<code>move logs to D:\AD-DB\</code> –ø–µ—Ä–µ–º–µ—Å—Ç–∏–º –≤ —Ç–æ—Ç –∂–µ –∫–∞—Ç–∞–ª–æ–≥ —Ñ–∞–π–ª—ã —Å –∂—É—Ä–Ω–∞–ª–∞–º–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π <br />
<code>quit</code> <br />
<code>Start-Service -ComputerName dc -name NTDS</code></p>
<p>–°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è DSRM (—Ä–µ–∂–∏–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ª—É–∂–± –∫–∞—Ç–∞–ª–æ–≥–æ–≤):<br />
<code>ntdsutil</code> <br />
<code>set dsrm password</code> <br />
<code>reset password on server NULL</code> <br />
–Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å <br />
–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è <br />
<code>quit</code> <br />
<code>quit</code></p>
<p>–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å –ø–∞—Ä–æ–ª–µ–º –£–ó –≤ AD: <br />
<code>ntdsutil</code> <br />
<code>set dsrm password</code> <br />
<code>sync from domain account dsrmadmin</code> <br />
<code>quit</code> <br />
<code>quit</code></p>
<p>–û—à–∏–±–∫–∞ 0x00002e2 –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –û–°. <br />
–ó–∞–≥—Ä—É–∑–∏—Ç—å—Å—è –≤ —Ä–µ–∂–∏–º–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–µ–Ω–∏—è WinRE (Windows Recovery Environment) - Startup Settings - Restart - DSRM (Directory Services Restore Mode) <br />
<code>reagentc /boottore</code> shutdown /f /r /o /t 0 –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –≤ —Ä–µ–∂–∏–º–µ WinRE - –û–° –Ω–∞ –±–∞–∑–µ WinPE (Windows Preinstallation Environment), –æ–±—Ä–∞–∑ winre.wim –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ —Å–∫—Ä—ã—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ System Restore <br />
–ù–∞ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ –¥–æ–º–µ–Ω–∞ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –ª–æ–∫–∞–ª—å–Ω–∞—è —É—á–µ—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å ‚Äî –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä DSRM. –ü–∞—Ä–æ–ª—å —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ —Ä–æ–ª–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –¥–æ–º–µ–Ω–∞ ADDS –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (SafeModeAdministratorPassword). <br />
<code>ntdsutil</code> <br />
<code>activate instance ntds</code> <br />
<code>Files</code> <br />
<code>Info</code> <br />
<code>integrity</code> –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –ë–î <br />
–û—à–∏–±–∫–∞: Failed to open DIT for AD DS/LDS instance NTDS. Error -2147418113 <br />
<code>mkdir c:\ntds_bak</code> <br />
<code>xcopy c:\Windows\NTDS\*.* c:\ntds_bak</code> backup —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞ —Å –ë–î <br />
<code>esentutl /g c:\windows\ntds\ntds.dit</code> –ø—Ä–æ–≤–µ—Ä–∏–º —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å —Ñ–∞–π–ª–∞ <br />
–í—ã–≤–æ–¥: Integrity check completed. Database is CORRUPTED –æ—à–∏–±–∫–∞, –±–∞–∑–∞ AD –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∞ <br />
<code>esentutl /p c:\windows\ntds\ntds.dit</code> –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫–∏ <br />
–í—ã–≤–æ–¥: Operation completed successfully in xx seconds. –Ω–µ—Ç –æ—à–∏–±–æ–∫ <br />
<code>esentutl /g c:\windows\ntds\ntds.dit</code> –ø—Ä–æ–≤–µ—Ä–∏–º —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å —Ñ–∞–π–ª–∞ <br />
–í—ã–ø–æ–ª–Ω–∏—Ç—å –∞–Ω–∞–ª–∏–∑ —Å–µ–º–∞–Ω—Ç–∏–∫–∏ –±–∞–∑—ã —Å –ø–æ–º–æ—â—å—é ntdsutil: <br />
<code>ntdsutil</code> <br />
<code>activate instance ntds</code> <br />
<code>semantic database analysis</code> <br />
<code>go</code> <br />
<code>go fixup</code> –∏—Å–ø—Ä–∞–≤–∏—Ç—å —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ <br />
–°–∂–∞—Ç—å —Ñ–∞–π–ª –ë–î: <br />
<code>activate instance ntds</code> <br />
<code>files</code> <br />
<code>compact to C:\Windows\NTDS\TEMP</code> <br />
<code>copy C:\Windows\NTDS\TEMP\ntds.dit C:\Windows\NTDS\ntds.dit</code> –∑–∞–º–µ–Ω–∏—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª ntds.dit <br />
<code>Del C:\Windows\NTDS\*.log</code> —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –ª–æ–≥ —Ñ–∞–π–ª—ã –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ NTDS</p>
<h2 id="gpo">GPO</h2>
<p><code>Get-Command -Module GroupPolicy</code> <br />
<code>Get-GPO -Domain domain.local -All | ft</code> <br />
<code>Get-GPO -Name LAPS</code> <br />
<code>[xml](Get-GPOReport LAPS -ReportType Xml)</code> <br />
<code>Get-GPPermission -Name LAPS -All</code> <br />
<code>Get-GPO LAPS | New-GPLink -Target "ou=servers,dc=domain,dc=local"</code> <br />
<code>Set-GPLink -Name LAPS -Target "ou=servers,dc=domain,dc=local" -LinkEnabled No</code> <br />
<code>Backup-GPO -Name LAPS -Path "$home\Desktop"</code> <br />
<code>Backup-GPO -All -Path "$home\Desktop"</code> <br />
<code>Restore-GPO -Name LAPS -Path C:\Backup\GPOs\</code></p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright ¬© 2023-2024 Alex Kup (Lifailon)
    </div>
  
  
  PowerShell Commands on
  <a href="https://github.com/Lifailon/PS-Commands" target="_blank" rel="noopener">
    GitHub
  </a>
  | Theme
  <a href="https://github.com/squidfunk/mkdocs-material" target="_blank" rel="noopener">
    Material
  </a>
  for
  <a href="https://github.com/mkdocs/mkdocs" target="_blank" rel="noopener">
    MkDocs
  </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://github.com/Lifailon/PS-Commands" target="_blank" rel="noopener" title="PS-Commands on Github" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.dd8806f2.min.js"></script>
      
        <script src="../assets/highlight/highlight.min.js"></script>
      
        <script src="../assets/highlight/powershell.min.js"></script>
      
        <script src="../assets/highlight/init.js"></script>
      
    
  </body>
</html>