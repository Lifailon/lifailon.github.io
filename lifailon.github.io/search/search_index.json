{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"PowerShell Commands \u0411\u043e\u043b\u044c\u0448\u0430\u044f \u0431\u0430\u0437\u0430 \u0437\u0430\u043c\u0435\u0442\u043e\u043a PowerShell \u043d\u0430 \u0440\u0443\u0441\u0441\u043a\u043e\u043c \u044f\u0437\u044b\u043a\u0435. \u27a1\ufe0f \u0412\u0435\u0431-\u0432\u0435\u0440\u0441\u0438\u044f \ud83d\udce2 Habr: PowerShell \u0438 \u0435\u0433\u043e \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u0438 Help Object npp Regex DataType Module Bit Cycle Files Credential WinEvent Firewall Defender WindowsUpdate DISM Scheduled Network RDP Shutdown LocalAccounts SMB ActiveDirectory repadmin dcdiag ntdsutil GPO ServerManager DNS DHCP DFS StorageReplica PS2EXE NSSM Jobs SMTP Hyper-V VMWare/PowerCLI Exchange/EMShell TrueNAS Veeam REST API Pode Selenium IE COM dotNET Console API Drawing ObjectEvent Sockets Excel CSV XML JSON YAML HTML HtmlAgilityPack SQLite MySQL MSSQL InfluxDB Telegraf Elasticsearch CData ODBC PostgreSQL WMI Regedit Performance SNMP Zabbix pki OpenSSL OpenVPN Route NAT WireGuard VpnClient Proxy netsh OpenSSH WinRM PackageManagement NuGet Git GitHub DSC Ansible Win_Modules GigaChat YandexGPT SuperAGI Replicate Google-Filter Google-API RapidAPI TMDB OMDb ivi Kinopoisk VideoCDN Telegram Discord oh-my-posh Pester Pandoc FFmpeg ImageMagick Hugo Help Get-Verb \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f/\u0433\u043b\u0430\u0433\u043e\u043b\u044b, \u0443\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u043d\u044b\u0435 \u0434\u043b\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f \u0432 \u043a\u043e\u043c\u0430\u043d\u0434\u043b\u0435\u0442\u0430\u0445 \\ Get-Command *Language* \u043f\u043e\u0438\u0441\u043a \u043a\u043e\u043c\u0430\u043d\u0434\u044b \u043f\u043e \u0438\u043c\u0435\u043d\u0438 \\ (Get-Command Get-Language).Module \u0443\u0437\u043d\u0430\u0442\u044c \u043a \u043a\u0430\u043a\u043e\u043c\u0443 \u043c\u043e\u0434\u0443\u043b\u044e \u043f\u0440\u0438\u043d\u0430\u0434\u043b\u0435\u0436\u0438\u0442 \u043a\u043e\u043c\u0430\u043d\u0434\u0430 \\ Get-Command Get-Content | fl Module,DLL \u0443\u0437\u043d\u0430\u0442\u044c \u043f\u0440\u0438\u043d\u0430\u0434\u043b\u0435\u0436\u043d\u043e\u0441\u0442\u044c \u043a\u043e\u043c\u0430\u043d\u0434\u044b \u043a \u043c\u043e\u0434\u0443\u043b\u044e \u0438 dll \\ Get-Command -Module LanguagePackManagement \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u043a\u043e\u043c\u0430\u043d\u0434 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0433\u043e \u043c\u043e\u0434\u0443\u043b\u044f \\ (Get-Module LanguagePackManagement).ExportedCommands.Values \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u043a\u043e\u043c\u0430\u043d\u0434 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0433\u043e \u043c\u043e\u0434\u0443\u043b\u044f \\ Get-Language | Get-Member \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u043c\u0435\u0442\u043e\u0434\u043e\u0432 \u043a\u043e\u043c\u0430\u043d\u0434\u044b (\u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f), \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u0432\u044b\u0432\u043e\u0434\u0430 \u0438 Event (\u0441\u043e\u0431\u044b\u0442\u0438\u044f \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432: Click) \\ (Get-Help Get-Service).Aliases \u0443\u0437\u043d\u0430\u0442\u044c \u043f\u0441\u0435\u0432\u0434\u043e\u043d\u0438\u043c\u043e\u043c \u043a\u043e\u043c\u0430\u043d\u0434\u044b \\ Get-Alias gsv \u0443\u0437\u043d\u0430\u0442\u044c \u0438\u043c\u044f \u043a\u043e\u043c\u0430\u043d\u0434\u044b \u043f\u043e \u043f\u0441\u0435\u0432\u0434\u043e\u043d\u0438\u043c\u0443 \\ Get-Help Get-Service \u0441\u0438\u043d\u0442\u0430\u043a\u0441\u0438\u0441 \\ Get-Help Get-Service -Parameter * \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u0432\u0441\u0435\u0445 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u043e\u0432 \\ Get-Help Get-Service -Online \\ Get-Help Get-Service -ShowWindow \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u043e\u0432 \u0432 GUI \u0441 \u0444\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u0435\u0439 \\ Show-Command \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u0441\u043f\u0438\u0441\u043e\u043a \u043a\u043e\u043c\u0430\u043d\u0434 \u0432 GUI \\ Show-Command Get-Service \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u043e\u0432 \u043a\u043e\u043c\u0430\u043d\u0434\u044b \u0432 GUI \\ Invoke-Expression iex \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0435\u0442 \u0442\u0435\u043a\u0441\u0442 \u0434\u043b\u044f \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u0432 \u043a\u043e\u043d\u0441\u043e\u043b\u0438 \u043a\u0430\u043a \u043a\u043e\u043c\u0430\u043d\u0434\u044b \\ $PSVersionTable \u0432\u0435\u0440\u0441\u0438\u044f PowerShell \\ Set-ExecutionPolicy Unrestricted \\ Get-ExecutionPolicy \\ $Metadata = New-Object System.Management.Automation.CommandMetaData (Get-Command Get-Service) \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u043e \u043a\u043e\u043c\u0430\u043d\u0434\u043b\u0435\u0442\u0435 \\ [System.Management.Automation.ProxyCommand]::Create($Metadata) \u0438\u0441\u0445\u043e\u0434\u043d\u044b\u0439 \u043a\u043e\u0434 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 Object Variable $var = Read-Host \"Enter\" \u0440\u0443\u0447\u043d\u043e\u0439 \u0432\u0432\u043e\u0434 \\ $pass = Read-Host \"Enter Password\" -AsSecureString \u0441\u043a\u0440\u044b\u0432\u0430\u0442\u044c \u043d\u0430\u0431\u043e\u0440 \\ $global:path = \"\\\\path\" \u0437\u0430\u0434\u0430\u0442\u044c \u0433\u043b\u043e\u0431\u0430\u043b\u044c\u043d\u0443\u044e \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0443\u044e, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 \u0432 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 \\ $using:srv \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0443\u044e \u0442\u0435\u043a\u0443\u0449\u0435\u0439 \u0441\u0435\u0441\u0441\u0438 \u0432 Invoke-\u0441\u0435\u0441\u0441\u0438\u0438 \\ Get-Variable \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \\ ls variable:/ \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \\ Get-Variable *srv* \u043d\u0430\u0439\u0442\u0438 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0443\u044e \u043f\u043e \u0438\u043c\u0435\u043d\u0438 \\ Get-Variable -Scope Global \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u0433\u043b\u043e\u0431\u0430\u043b\u044c\u043d\u044b\u0435 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \\ Get-Variable Error \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u044f\u044f \u043a\u043e\u043c\u0430\u043d\u0434\u0430 \u0441 \u043e\u0448\u0438\u0431\u043a\u043e\u0439 \\ Remove-Variable -Name * \u043e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u0432\u0441\u0435 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \\ $LASTEXITCODE \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u043a\u043e\u0434 \u0432\u044b\u0432\u043e\u0434\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0439 \u0437\u0430\u043f\u0443\u0449\u0435\u043d\u043d\u043e\u0439 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u044b, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 ping. \u0415\u0441\u043b\u0438 \u043a\u043e\u0434 \u0432\u043e\u0437\u0432\u0440\u0430\u0442\u0430 \u043f\u043e\u043b\u043e\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 (True), \u0442\u043e $LastExitCode = 0 ENV Get-ChildItem Env: \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \u043e\u043a\u0440\u0443\u0436\u0435\u043d\u0438\u044f \\ $env:PSModulePath \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u0438 \u0438\u043c\u043f\u043e\u0440\u0442\u0430 \u043c\u043e\u0434\u0443\u043b\u0435\u0439 \\ $env:userprofile \\ $env:computername \\ $env:username \\ $env:userdnsdomain \\ $env:logonserver \\ ([DirectoryServices.ActiveDirectory.Forest]::GetCurrentForest()).Name \\ [Environment]::GetFolderPath('ApplicationData') History Get-History \u0438\u0441\u0442\u043e\u0440\u0438\u044f \u043a\u043e\u043c\u0430\u043d\u0434 \u0442\u0435\u043a\u0443\u0449\u0435\u0439 \u0441\u0435\u0441\u0441\u0438\u0438 \\ (Get-History)[-1].Duration.TotalSeconds \u0432\u0440\u0435\u043c\u044f \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0439 \u043a\u043e\u043c\u0430\u043d\u0434\u044b \\ (Get-PSReadLineOption).HistorySavePath \u043f\u0443\u0442\u044c \u043a \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u043d\u043e\u043c\u0443 \u0444\u0430\u0439\u043b\u0443 \u0441 4096 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0445 \u043a\u043e\u043c\u0430\u043d\u0434 (\u0438\u0437 \u043c\u043e\u0434\u0443\u043b\u044f PSReadLine) \\ Get-Content (Get-PSReadlineOption).HistorySavePath | Select-String Get \u043f\u043e\u0438\u0441\u043a \u043f\u043e \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u043c\u0443 \u0444\u0430\u0439\u043b\u0430 (GREP) \\ Set-PSReadlineOption -MaximumHistoryCount 10000 \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u043c\u044b\u0445 \u043a\u043e\u043c\u0430\u043d\u0434 \u0432 \u0444\u0430\u0439\u043b \\ Get-PSReadLineOption | select MaximumHistoryCount \\ Set-PSReadlineOption -HistorySaveStyle SaveNothing \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0432\u0435\u0434\u0435\u043d\u0438\u0435 \u0436\u0443\u0440\u043d\u0430\u043b\u0430 \\ F2 \u043f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f \u0441 InlineView \u043d\u0430 ListView Clipboard Set-Clipboard $srv \u0441\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u0443\u0444\u0435\u0440 \u043e\u0431\u043c\u0435\u043d\u0430 \\ Get-Clipboard \u0432\u0441\u0442\u0430\u0432\u0438\u0442\u044c Write Write-Host -ForegroundColor Black -BackgroundColor Green \"Test\" -NoNewline \\ Write-Error Test \\ Foreach ($n in 1..100) {Write-Progress -Activity \"Test Progress\" -PercentComplete $n} Array $srv = @(\"server-01\", \"server-02\") \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043c\u0430\u0441\u0441\u0438\u0432 \\ $srv += @(\"server-03\") \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043c\u0430\u0441\u0441\u0438\u0432 \u043d\u043e\u0432\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 \\ $srv.Count \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043a\u043e\u043b-\u0432\u043e \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432 \u0432 \u043c\u0430\u0441\u0441\u0438\u0432\u0435 \\ Out-String \u043f\u043e\u0441\u0442\u0440\u043e\u0447\u043d\u044b\u0439 \u0432\u044b\u0432\u043e\u0434 Index $srv[0] \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u043f\u0435\u0440\u0432\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430 \u043c\u0430\u0441\u0441\u0438\u0432\u0430 \\ $srv[0] = Name \u0437\u0430\u043c\u0435\u043d\u0430 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430 \u0432 \u043c\u0430\u0441\u0441\u0438\u0432\u0435 \\ $srv[0].Length \u0443\u0437\u043d\u0430\u0442\u044c \u043a\u043e\u043b-\u0432\u043e \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432 \u043f\u0435\u0440\u0432\u043e\u0433\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0432 \u043c\u0430\u0441\u0441\u0438\u0432\u0435 \\ $srv[10..100] \u0441\u0440\u0435\u0437 $array = \"a\",\"b\",\"c\",\"d\" $num = 0 foreach ($a in $array) { $num += 1 $index = [array]::IndexOf($array, $a) # \u0443\u0437\u043d\u0430\u0442\u044c \u043d\u043e\u043c\u0435\u0440 \u0438\u043d\u0434\u0435\u043a\u0441\u0430 \u043f\u043e \u0437\u0430\u0447\u0435\u043d\u0438\u044e $array[$index] = $num # \u043f\u0435\u0440\u0435\u0441\u043e\u0431\u0440\u0430\u0442\u044c \u0438\u0441\u0445\u043e\u0434\u043d\u044b\u0439 \u043c\u0430\u0441\u0441\u0438\u0432 } HashTable $hashtable = @{\"User\" = \"$env:username\"; \"Server\" = \"$env:computername\"} # \u0441\u043e\u0437\u0434\u0430\u0442\u044c $hashtable += @{\"User2\" = \"$env:username\"; \"Server2\" = \"$env:computername\"} # \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043a\u043b\u044e\u0447\u0438 $hashtable.Keys # \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u043a\u043b\u044e\u0447\u0435\u0439 $hashtable[\"User\"] # \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 (Values) \u043f\u043e \u043a\u043b\u044e\u0447\u0443 $hashtable[\"User\"] = \"Test\" # \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c $hashtable.Remove(\"User\") # \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043a\u043b\u044e\u0447 $Tag = @{$true = 'dev'; $false = 'prod'}[([System.Net.Dns]::GetHostEntry(\"localhost\").HostName) -match '.*.TestDomain$'] Collections/List $Collections = New-Object System.Collections.Generic.List[System.Object] $Collections.Add([PSCustomObject]@{User = $env:username; Server = $env:computername}) PSCustomObject $CustomObject = [PSCustomObject][ordered]@{User = $env:username; Server = $env:computername} $CustomObject | Add-Member \u2013MemberType NoteProperty \u2013Name Arr \u2013Value @(1,2,3) # \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c Property (\u0441\u0432\u043e\u0439\u0441\u0442\u0432\u043e/\u0441\u0442\u043e\u0431\u0435\u0446) $CustomObject.Arr = @(1,3,5) # \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 $CustomObject.PsObject.Properties.Remove('User') # \u0443\u0434\u0430\u043b\u0438\u0442\u044c Property Add-Member $ScriptBlock = {Get-Service} $CustomObject | Add-Member -Name \"TestMethod\" -MemberType ScriptMethod -Value $ScriptBlock # \u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c Method $CustomObject | Get-Member $CustomObject.TestMethod() Class Class CustomClass { [string]$User [string]$Server Start([bool]$Param1) { If ($Param1) {Write-Host \"Start Function\"}} } $Class = New-Object -TypeName CustomClass $Class.User = $env:username $Class.Server = $env:computername $Class.Start(1) Pipeline $obj | Add-Member -MemberType NoteProperty -Name \"Type\" -Value \"user\" -Force \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043e\u0431\u044a\u043a\u0442\u0430 \u0432\u044b\u0432\u043e\u0434\u0430 NoteProperty \\ $obj | Add-Member -MemberType NoteProperty -Name \"User\" -Value \"admin\" -Force \u0438\u0437\u043c\u0435\u043d\u0435\u0438\u0435 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0433\u043e \u0434\u043b\u044f \u0441\u0443\u0449\u043d\u043e\u0441\u0442\u0438 \u043e\u0431\u044a\u0435\u043a\u0442\u0430 User \\ ping $srv | Out-Null \u043f\u0435\u0440\u0435\u043d\u0430\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u0432\u044b\u0432\u043e\u0434\u0430 \u0432 Out-Null Select-Object Get-Process | Select-Object -Property * \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u0432\u044b\u0432\u043e\u0434\u0430 \\ Get-Process | select -Unique \"Name\" \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043f\u043e\u0432\u0442\u043e\u0440\u044f\u044e\u0449\u0438\u0435\u0441\u044f \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0432 \u043c\u0430\u0441\u0441\u0438\u0432\u0435 \\ Get-Process | select -ExpandProperty ProcessName \u043f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u044c \u0438\u0437 \u043e\u0431\u044a\u0435\u043a\u0442\u0430-\u043a\u043e\u043b\u043b\u0435\u043a\u0446\u0438\u0438 \u0432 \u043c\u0430\u0441\u0441\u0438\u0432 (\u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u0431\u0435\u0437 \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u044f \u0441\u0442\u043e\u043b\u0431\u0446\u0430) \\ (Get-Process | ? Name -match iperf).Modules \u0441\u043f\u0438\u0441\u043e\u043a \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c\u044b\u0445 \u043c\u043e\u0434\u0443\u043b\u0435\u0439 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u043c Expression ps | Sort-Object -Descending CPU | select -first 10 ProcessName, # \u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0430 \u043f\u043e CPU, \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u043f\u0435\u0440\u0432\u044b\u0445 10 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439 (-first) @{Name=\"ProcessorTime\"; Expression={$_.TotalProcessorTime -replace \"\\.\\d+$\"}}, # \u0437\u0430\u0442\u0440\u0430\u0447\u0435\u043d\u043e \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u0440\u043d\u043e\u0433\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0432 \u043c\u0438\u043d\u0443\u0442\u0430\u0445 @{Name=\"Memory\"; Expression={[string]([int]($_.WS / 1024kb))+\"MB\"}}, # \u0434\u0435\u043b\u0438\u043c \u0431\u0430\u0439\u0442\u044b \u043d\u0430 \u041a\u0411 @{Label=\"RunTime\"; Expression={((Get-Date) - $_.StartTime) -replace \"\\.\\d+$\"}} # \u0432\u044b\u0447\u0435\u0441\u0442\u044c \u0438\u0437 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438 - \u0432\u0440\u0435\u043c\u044f \u0437\u0430\u043f\u0443\u0441\u043a\u0430, \u0438 \u0443\u0434\u0430\u043b\u0438\u0442\u044c milisec Select-String $(ipconfig | Select-String IPv4) -replace \".+: \" | Where-Object {$_ -match \"^172.\"} \u0443\u0437\u043d\u0430\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e IP \\ $Current_IP = Get-Content $RDCMan_RDG_PATH | Select-String $RDCMan_Display_Name -Context 0,1 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0434\u0432\u0435 \u0441\u0442\u0440\u043e\u043a\u0438 \\ $Current_IP = $Current_IP.Context.DisplayPostContext[0] -replace \".+<name>|<\\/name>\" \u0437\u0430\u0431\u0440\u0430\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0432\u0442\u043e\u0440\u0443\u044e \u0441\u0442\u0440\u043e\u043a\u0443 \u0438 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0442\u044d\u0433\u0438 Format-Table/Format-List Get-Process | ft ProcessName, StartTime -Autosize \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u0433\u0440\u0443\u043f\u043f\u0438\u0440\u043e\u0432\u043a\u0430 \u0440\u0430\u0437\u043c\u0435\u0440\u0430 \u0441\u0442\u043e\u043b\u0431\u0446\u043e\u0432 Measure-Object Get-Process | Measure | select Count \u043a\u043e\u043b-\u0432\u043e \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 \\ Get-Process | Measure -Line -Word -Character \u043a\u043e\u043b-\u0432\u043e \u0441\u0442\u0440\u043e\u043a, \u0441\u043b\u043e\u0432 \u0438 Char \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 \\ Get-Process | Measure-Object PM -sum | Select-Object Count,@{Name=\"MEM_MB\"; Expression={[int]($_.Sum/1mb)}} \u043a\u043e\u043b-\u0432\u043e \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u0432 \u0438 \u043e\u0431\u0449\u0438\u0439 \u043e\u0431\u044a\u0435\u043c \u0437\u0430\u043d\u044f\u0442\u043e\u0439 \u043f\u0430\u043c\u044f\u0442\u0438 \u0432 \u041c\u0411\u0430\u0439\u0442 Compare-Object Compare-Object -ReferenceObject (Get-Content -Path .\\file1.txt) -DifferenceObject (Get-Content -Path .\\file2.txt) \u0441\u0440\u0430\u0432\u043d\u0435\u043d\u0438\u0435 \u0434\u0432\u0443\u0445 \u0444\u0430\u0439\u043b\u043e\u0432 \\ $group1 = Get-ADGroupMember -Identity \"Domain Admins\" \\ $group2 = Get-ADGroupMember -Identity \"Enterprise Admins\" \\ Compare-Object -ReferenceObject $group1 -DifferenceObject $group2 -IncludeEqual == \u043d\u0435\u0442 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0439 \\ <= \u0435\u0441\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0432 $group1 \\ => \u0435\u0441\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0432 $group2 Where-Object (?) Get-Process | Where-Object {$_.ProcessName -match \"zabbix\"} \u0444\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u044f/\u043f\u043e\u0438\u0441\u043a \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u0432 \u043f\u043e \u0438\u043c\u0435\u043d\u0438 \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430 \u043e\u0431\u044a\u0435\u043a\u0442\u0430 \\ Get-Process | where CPU -gt 10 | Sort-Object -Descending CPU \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u043e\u0431\u044a\u0435\u043a\u0442\u044b, \u0433\u0434\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f CPU \u0431\u043e\u043b\u044c\u0448\u0435 10 \\ Get-Process | where WS -gt 200MB \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u044b \u0433\u0434\u0435 WS \u0432\u044b\u0448\u0435 200\u041c\u0411 \\ Get-Service | where Name -match \"zabbix\" \u043f\u043e\u0438\u0441\u043a \u0441\u043b\u0443\u0436\u0431\u044b \\ Get-Service -ComputerName $srv | Where {$_.Name -match \"WinRM\"} | Restart-Service \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0441\u043b\u0443\u0436\u0431\u0443 \u043d\u0430 \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u043e\u043c \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0435 \\ (Get-Service).DisplayName \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430 \u043c\u0430\u0441\u0441\u0438\u0432\u0430 \\ netstat -an | where {$_ -match 443} \\ netstat -an | ?{$_ -match 443} \\ (netstat -an) -match 443 Sort-Object Get-Process | Sort-Object -Descending CPU | ft \u043e\u0431\u0440\u0430\u0442\u043d\u0430\u044f (-Descending) \u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0430 \u043f\u043e CPU \\ $path[-1..-10] \u043e\u0431\u0440\u0430\u0442\u043d\u0430\u044f \u0441\u0431\u043e\u0440\u043a\u0430 \u043c\u0430\u0441\u0441\u0438\u0432\u0430 \u0431\u0435\u0437 \u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0438 Last/First Get-Process | Sort-Object -Descending CPU | select -First 10 \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u043f\u0435\u0440\u0432\u044b\u0445 10 \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 \\ Get-Process | Sort-Object -Descending CPU | select -Last 10 \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0445 10 \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 Group-Object $Groups = Get-CimInstance -Class Win32_PnPSignedDriver | Select-Object DriverProviderName, FriendlyName, Description, DriverVersion, DriverDate | Group-Object DriverProviderName, FriendlyName, Description, DriverVersion, DriverDate $(foreach ($Group in $Groups) { $Group.Group[0] }) | Format-Table Error $Error \u0432\u044b\u0432\u043e\u0434\u0438\u0442 \u0432\u0441\u0435 \u043e\u0448\u0438\u0431\u043a\u0438 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u0441\u0435\u0430\u043d\u0441\u0430 \\ $Error[0].InvocationInfo \u0440\u0430\u0437\u0432\u0435\u0440\u043d\u0443\u0442\u044b\u0439 \u043e\u0442\u0447\u0435\u0442 \u043e\u0431 \u043e\u0448\u0438\u0431\u043a\u0435 \\ $Error.clear() \\ $LASTEXITCODE \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0439 \u043a\u043e\u043c\u0430\u043d\u0434\u044b (0 - \u0443\u0441\u043f\u0435\u0445) \\ exit 1 \u043a\u043e\u0434 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044f, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442\u0441\u044f $LASTEXITCODE Property $srv.Count \u043a\u043e\u043b-\u0432\u043e \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432 \u0432 \u043c\u0430\u0441\u0441\u0438\u0432\u0435 \\ $srv.Length \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u043c \u0441\u0442\u0440\u043e\u043a\u0438 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u043e\u0439 [string] \u0438\u043b\u0438 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439 (\u0441\u0442\u0440\u043e\u043a) \u043e\u0431\u044a\u0435\u043a\u0442\u0430 \\ $srv.Chars(2) \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c 3-\u0439 \u0441\u0438\u043c\u0432\u043e\u043b \u0432 \u0441\u0442\u0440\u043e\u043a\u0435 \\ $srv[2] \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c 3-\u044e \u0441\u0442\u0440\u043e\u043a\u0443 \u0432 \u043c\u0430\u0441\u0441\u0438\u0432\u0435 Method $srv.Insert(0,\"https://\") \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u0435\u0440\u0435\u0434 \u043f\u0435\u0440\u0432\u044b\u043c \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u043c \\ $srv.Substring(4) \u0443\u0434\u0430\u043b\u0438\u0442\u044c (\u0438\u0437 \u0432\u0441\u0435\u0433\u043e \u043c\u0430\u0441\u0441\u0438\u0432\u0430) \u043f\u0435\u0440\u0432\u044b\u0435 4 \u0441\u0438\u043c\u0432\u043e\u043b\u0430 \\ $srv.Remove(3) \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0438\u0437 \u0432\u0441\u0435\u0433\u043e \u043c\u0430\u0441\u0441\u0438\u0432\u0430 \u0432\u0441\u0435 \u043f\u043e\u0441\u043b\u0435 3 \u0441\u0438\u043c\u0432\u043e\u043b\u0430 \\ $string = \"123\" \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0441\u0442\u0440\u043e\u043a\u0443 \\ $int = [convert]::ToInt32($string) \u043f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u044c \u0441\u0442\u0440\u043e\u043a\u0443 \u0432 \u0442\u0438\u043f \u0434\u0430\u043d\u043d\u044b\u0445 \u0447\u0438\u0441\u043b\u043e \\ [string]::Concat($text,$num) \u043e\u0431\u044a\u0435\u0434\u0435\u043d\u0438\u0442\u044c \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \u0432 \u043e\u0434\u043d\u0443 \u0441\u0442\u0440\u043e\u043a\u0443 \\ [string]::Join(\":\",$text,$num) \u043e\u0431\u044a\u0435\u0434\u0435\u043d\u0438\u0442\u044c \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044f \u0440\u0430\u0437\u0434\u0435\u043b\u0438\u0442\u0435\u043b\u044c \\ [string]::Compare($text,$num,$true) \u0432\u044b\u0434\u0430\u0435\u0442 0 \u043f\u0440\u0438 \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0438 \u0438\u043b\u0438 1/-1 \u043f\u0440\u0438 \u043d\u0435\u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0438, $true (\u0431\u0435\u0437 \u0443\u0447\u0435\u0442\u0430 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430) \u0438\u043b\u0438 $false (\u0441 \u0443\u0447\u0435\u0442\u043e\u043c \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430) \\ [string]::Equals($text,$num) \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u0442 \u0441\u0440\u0430\u0432\u043d\u0435\u043d\u0438\u0435 \u0434\u0432\u0443\u0445 \u0441\u0442\u0440\u043e\u043a \u0438 \u0432\u044b\u0434\u0430\u0435\u0442 $true \u043f\u0440\u0438 \u0438\u0445 \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0438 \u0438\u043b\u0438 $false \u043f\u0440\u0438 \u043d\u0435\u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0438 \\ [string]::IsNullOrEmpty($text) \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0441\u0442\u0440\u043e\u043a\u0438, \u0435\u0441\u043b\u0438 \u0441\u0442\u0440\u043e\u043a\u0430 \u043f\u0443\u0441\u0442\u0430 $true, \u0435\u0441\u043b\u0438 \u043d\u0435\u0442 $false \\ [string]::IsNullOrWhiteSpace($text2) \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u043d\u0430 \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0442\u043e\u043b\u044c\u043a\u043e \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432 \u043f\u0440\u043e\u0431\u0435\u043b, \u0442\u0430\u0431\u0443\u043b\u044f\u0446\u0438\u044f \u0438\u043b\u0438 \u0441\u0438\u043c\u0432\u043e\u043b \u043d\u043e\u0432\u043e\u0439 \u0441\u0442\u0440\u043e\u043a\u0438 DateTime Get-TimeZone \u0447\u0430\u0441\u043e\u0432\u043e\u0439 \u043f\u043e\u044f\u0441 \\ [DateTime]::UtcNow \u0432\u0440\u0435\u043c\u044f \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 UTC 0 \\ (Get-Date).AddHours(-3) \\ $Date = (Get-Date -Format \"dd/MM/yyyy hh:mm:ss\") \\ $Date = Get-Date -f \"dd/MM/yyyy\" \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u0442\u0438\u043f \u0434\u0430\u043d\u043d\u044b\u0445 [string] \\ [DateTime]$gDate = Get-Date \"$Date\" \u043f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u044c \u0432 \u0442\u0438\u043f [DateTime] \\ [int32]$days=($fDate-$gDate).Days \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0440\u0430\u0437\u043d\u0438\u0446\u0443 \u0432 \u0434\u043d\u044f\u0445 \\ \"5/7/07\" -as [DateTime] \u043f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u044c \u0432\u0445\u043e\u0434\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u0442\u0438\u043f \u0434\u0430\u043d\u043d\u044b\u0445 [DateTime] \\ New-TimeSpan -Start $VBRRP.CreationTimeUTC -End $VBRRP.CompletionTimeUTC \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0440\u0430\u0437\u043d\u0438\u0446\u0443 \u0432\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438 Measure-Command (Measure-Command {ping ya.ru}).TotalSeconds \u0443\u0437\u043d\u0430\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0432\u0440\u0435\u043c\u044f \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \\ (Get-History)[-1] | select @{Name=\"RunTime\"; Expression={$_.EndExecutionTime - $_.StartExecutionTime}},ExecutionStatus,CommandLine \u043f\u043e\u0441\u0447\u0438\u0442\u0430\u0442\u044c \u0432\u0440\u0435\u043c\u044f \u0440\u0430\u0431\u043e\u0442\u044b \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0439 [-1] (select -Last 1) \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u043d\u043e\u0439 \u043a\u043e\u043c\u0430\u043d\u0434\u044b \u0438 \u0443\u0437\u043d\u0430\u0442\u044c \u0435\u0435 \u0441\u0442\u0430\u0442\u0443\u0441 Timer $start_time = Get-Date \u0437\u0430\u0444\u0438\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u0440\u0435\u043c\u044f \u0434\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u043a\u043e\u043c\u0430\u043d\u0434\u044b \\ $end_time = Get-Date \u0437\u0430\u0444\u0438\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u0440\u0435\u043c\u044f \u043f\u043e \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044e \\ $time = $end_time - $start_time \u0432\u044b\u0441\u0447\u0438\u0442\u0430\u0442\u044c \u0432\u0440\u0435\u043c\u044f \u0440\u0430\u0431\u043e\u0442\u044b \u0441\u043a\u0440\u0438\u043f\u0442\u0430 \\ $min = $time.minutes \\ $sec = $time.seconds \\ Write-Host \"$min \u043c\u0438\u043d\u0443\u0442 $sec \u0441\u0435\u043a\u0443\u043d\u0434\" \\ $timer = [System.Diagnostics.Stopwatch]::StartNew() \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0442\u0430\u0439\u043c\u0435\u0440 \\ $timer.IsRunning \u0441\u0442\u0430\u0442\u0443\u0441 \u0440\u0430\u0431\u043e\u0442\u044b \u0442\u0430\u0439\u043c\u0435\u0440\u0430 \\ $timer.Elapsed.TotalSeconds \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0440\u0435\u043c\u044f \u0441 \u043c\u043e\u043c\u0435\u043d\u0442\u0430 \u0437\u0430\u043f\u0443\u0441\u043a\u0430 (\u0432 \u0441\u0435\u043a\u0443\u043d\u0434\u0430\u0445) \\ $timer.Stop() \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0442\u0430\u0439\u043c\u0435\u0440 npp pwsh -NoExit -ExecutionPolicy Unrestricted -WindowStyle Maximized -File \"$(FULL_CURRENT_PATH)\" %AppData%\\Notepad++ themes/shortcuts.xml \\ <?xml version=\"1.0\" encoding=\"UTF-8\" ?> <NotepadPlus> <InternalCommands /> <Macros> <Macro name=\"`+\\+&gt;\" Ctrl=\"yes\" Alt=\"no\" Shift=\"no\" Key=\"190\"> <Action type=\"0\" message=\"2453\" wParam=\"0\" lParam=\"0\" sParam=\"\" /> <Action type=\"1\" message=\"2170\" wParam=\"0\" lParam=\"0\" sParam=\"`\" /> <Action type=\"0\" message=\"2451\" wParam=\"0\" lParam=\"0\" sParam=\"\" /> <Action type=\"0\" message=\"2451\" wParam=\"0\" lParam=\"0\" sParam=\"\" /> <Action type=\"1\" message=\"2170\" wParam=\"0\" lParam=\"0\" sParam=\" \" /> <Action type=\"1\" message=\"2170\" wParam=\"0\" lParam=\"0\" sParam=\"\\\" /> <Action type=\"0\" message=\"2300\" wParam=\"0\" lParam=\"0\" sParam=\"\" /> </Macro> </Macros> <UserDefinedCommands> <Command name=\"PowerShell7\" Ctrl=\"no\" Alt=\"yes\" Shift=\"no\" Key=\"116\">pwsh -NoExit -ExecutionPolicy Unrestricted -WindowStyle Maximized -File &quot;$(FULL_CURRENT_PATH)&quot;</Command> </UserDefinedCommands> <PluginCommands /> <ScintillaKeys /> </NotepadPlus> Parsing text to Markdown: \\ Macros: FnLeft+'+FnRight+FnRight+\\s\\\\+Down \\ Replace: \"# \",\"'\" . # \u041e\u0431\u043e\u0437\u043d\u0430\u0447\u0430\u0435\u0442 \u043b\u044e\u0431\u043e\u0439 \u0441\u0438\u043c\u0432\u043e\u043b \\ # \u042d\u043a\u0440\u0430\u043d\u0438\u0440\u0443\u044e\u0449\u0438\u0439 \u0441\u0438\u043c\u0432\u043e\u043b. \u0421\u0438\u043c\u0432\u043e\u043b\u044b \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u044d\u043a\u0440\u0430\u043d\u0438\u0440\u0443\u044e\u0442\u0441\u044f: ^, [, ., $, {, *, (, ), \\, +, |, ?, <, > ^ # \u041d\u0430\u0447\u0430\u043b\u043e \u0441\u0442\u0440\u043e\u043a\u0438 $ # \u041a\u043e\u043d\u0435\u0446 \u0441\u0442\u0440\u043e\u043a\u0438 \\n # \u041d\u043e\u0432\u0430\u044f \u0441\u0442\u0440\u043e\u043a\u0430 \\d # \u041b\u044e\u0431\u0430\u044f \u0446\u0438\u0444\u0440\u0430 \\D # \u041d\u0435 \u0446\u0438\u0444\u0440\u0430 \\w # \u041b\u044e\u0431\u0430\u044f \u0431\u0443\u043a\u0432\u0430 \u043b\u0430\u0442\u0438\u043d\u0438\u0446\u044b, \u0446\u0438\u0444\u0440\u0430, \u0438\u043b\u0438 \u0437\u043d\u0430\u043a \u043f\u043e\u0434\u0447\u0451\u0440\u043a\u0438\u0432\u0430\u043d\u0438\u044f \\W # \u041d\u0435 \u043b\u0430\u0442\u0438\u043d\u0438\u0446\u0430, \u043d\u0435 \u0446\u0438\u0444\u0440\u0430, \u043d\u0435 \u043f\u043e\u0434\u0447\u0451\u0440\u043a\u0438\u0432\u0430\u043d\u0438\u0435 \\s # \u041f\u0440\u043e\u0431\u0435\u043b, \u0442\u0430\u0431\u0443\u043b\u044f\u0446\u0438\u044f, \u043f\u0435\u0440\u0435\u043d\u043e\u0441 \u0441\u0442\u0440\u043e\u043a\u0438 \\S # \u041d\u0435 \u043f\u0440\u043e\u0431\u0435\u043b \\b # \u0413\u0440\u0430\u043d\u0438\u0446\u0430 \u0441\u043b\u043e\u0432\u0430. \u041f\u0440\u0438\u043c\u0435\u043d\u044f\u0435\u0442\u0441\u044f \u043a\u043e\u0433\u0434\u0430 \u043d\u0443\u0436\u043d\u043e \u0432\u044b\u0434\u0435\u043b\u0438\u0442\u044c, \u0447\u0442\u043e \u0438\u0441\u043a\u043e\u043c\u044b\u0435 \u0441\u0438\u043c\u0432\u043e\u043b\u044b \u044f\u0432\u043b\u044f\u044e\u0442\u0441\u044f \u0441\u043b\u043e\u0432\u043e\u043c, \u0430 \u043d\u0435 \u0447\u0430\u0441\u0442\u044c\u044e \u0434\u0440\u0443\u0433\u043e\u0433\u043e \u0441\u043b\u043e\u0432\u0430 \\B # \u041d\u0435 \u0433\u0440\u0430\u043d\u0438\u0446\u0430 \u0441\u043b\u043e\u0432\u0430 \\< # \u041d\u0430\u0447\u0430\u043b\u043e \u0441\u043b\u043e\u0432\u0430 \\> # \u041a\u043e\u043d\u0435\u0446 \u0441\u043b\u043e\u0432\u0430 \\A # \u041d\u0430\u0447\u0430\u043b\u043e \u0442\u0435\u043a\u0441\u0442\u0430 \\Z # \u041a\u043e\u043d\u0435\u0446 \u0442\u0435\u043a\u0441\u0442\u0430 * # \u041f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435\u043b\u044c. \u041e\u0437\u043d\u0430\u0447\u0430\u0435\u0442 \u0447\u0442\u043e \u043f\u0440\u0435\u0434\u0448\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0439 \u0441\u0438\u043c\u0432\u043e\u043b \u043c\u043e\u0436\u0435\u0442 \u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c 0 \u0438 \u0431\u043e\u043b\u0435\u0435 \u0440\u0430\u0437 + # \u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043f\u0440\u0435\u0434\u0448\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0435\u0433\u043e \u043d\u0435 \u043c\u0435\u043d\u0435\u0435 1-\u0433\u043e. ? # \u041e\u0433\u0440\u0430\u043d\u0438\u0447\u0438\u0442\u0435\u043b\u044c. \u041d\u0435 \u0431\u043e\u043b\u0435\u0435 \u043e\u0434\u043d\u043e\u0433\u043e \u0440\u0430\u0437\u0430 | # \u0418\u043b\u0438. \u0421\u043e\u0435\u0434\u0438\u043d\u044f\u0435\u0442 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u043e\u0432 () # \u0412 \u043a\u0440\u0443\u0433\u043b\u044b\u0435 \u0441\u043a\u043e\u0431\u043a\u0438 \u0437\u0430\u043a\u043b\u044e\u0447\u0430\u044e\u0442\u0441\u044f \u0432\u0441\u0435 \u043a\u043e\u043c\u0431\u0438\u043d\u0430\u0446\u0438\u0438 \u0441 \"\u0438\u043b\u0438\" \u0438 \u043f\u043e\u0438\u0441\u043a \u043d\u0430\u0447\u0430\u043b\u0430 \u0438 \u043a\u043e\u043d\u0446\u0430 \u0441\u0442\u0440\u043e\u043a [ ] # \u0412 \u043a\u0432\u0430\u0434\u0440\u0430\u0442\u043d\u044b\u0445 \u0441\u043a\u043e\u0431\u043a\u0430\u0445 \u0437\u0430\u0434\u0430\u044e\u0442\u0441\u044f \u0441\u0438\u043c\u0432\u043e\u043b\u044b \u043a \u043f\u043e\u0438\u0441\u043a\u0443, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 [a-\u044f\u0410-\u042f], \u0438\u043b\u0438 [0-9] [^ ] # \u0418\u0441\u043a\u043b\u044e\u0447\u0430\u0435\u0442 \u0438\u0437 \u043f\u043e\u0438\u0441\u043a\u0430 \u0441\u0438\u043c\u0432\u043e\u043b\u044b \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u0435 \u0432 \u043a\u0432\u0430\u0434\u0440\u0430\u0442\u043d\u044b\u0445 \u0441\u043a\u043e\u0431\u043a\u0430\u0445 { } # \u0412 \u0444\u0438\u0433\u0443\u0440\u043d\u044b\u0445 \u0441\u043a\u043e\u0431\u043a\u0430\u0445 \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u0442\u043e\u0447\u043d\u043e\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0432\u0445\u043e\u0436\u0434\u0435\u043d\u0438\u0439 \\d{2} # \u041d\u0430\u0439\u0442\u0438 \u0434\u0432\u0435 \u0446\u0438\u0444\u0440\u044b \\d{2,4} # \u041d\u0430\u0439\u0442\u0438 \u0434\u0432\u0435 \u0438\u043b\u0438 \u0447\u0435\u0442\u044b\u0440\u0435 {4,} # \u041d\u0430\u0439\u0442\u0438 \u0447\u0435\u0442\u044b\u0440\u0435 \u0438 \u0431\u043e\u043b\u0435\u0435 ^\\s{1,}#.+` \u043f\u043e\u0438\u0441\u043a \u0432\u043d\u0430\u0447\u0430\u043b\u0435 \u0441\u0442\u0440\u043e\u043a\u0438 \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u044f \u0438 \u043f\u0440\u043e\u0431\u0435\u043b \u043f\u043e\u0441\u043b\u0435 \u043d\u0435\u0433\u043e 1 \u0438\u043b\u0438 \u0431\u043e\u043b\u044c\u0448\u0435 \u0438 \u043b\u044e\u0431\u043e\u0435 \u043a\u043e\u043b-\u0432\u043e \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432 Regex -replace \"1\",\"2\" \u0437\u0430\u043c\u0435\u043d\u0430 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432 \u0432 \u0438\u043d\u0434\u0435\u043a\u0441\u0430\u0445 \u043c\u0430\u0441\u0441\u0438\u0432\u0430 (\u0432\u0435\u0437\u0434\u0435 \u0433\u0434\u0435 \u043f\u0440\u0438\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 1, \u0437\u0430\u043c\u0435\u043d\u0438\u0442\u044c \u043d\u0430 2), \u0434\u043b\u044f \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u043f\u0435\u0440\u0432\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \\ -split \" \" \u043f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u044c \u0441\u0442\u0440\u043e\u043a\u0443 \u0432 \u043c\u0430\u0441\u0441\u0438\u0432, \u0440\u0430\u0437\u0434\u0435\u043b\u0438\u0442\u0435\u043b\u0435\u043c \u0443\u043a\u0430\u0437\u0430\u043d \u043f\u0440\u043e\u0431\u0435\u043b, \u043a\u043e\u0442\u043e\u0440\u043e\u0439 \u0443\u0434\u0430\u043b\u044f\u0435\u0442\u0441\u044f ($url.Split(\"/\")[-1]) \\ -join \" \" \u043f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u044c \u043c\u0430\u0441\u0441\u0438\u0432 (\u043a\u043e\u043b\u043b\u0435\u043a\u0446\u0438\u044e) \u0432 \u0435\u0434\u0438\u043d\u0443\u044e \u0441\u0442\u0440\u043e\u043a\u0443 (string), \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0440\u0430\u0437\u0434\u0435\u043b\u0438\u0442\u0435\u043b\u0435\u043c \u043f\u0440\u043e\u0431\u0435\u043b \\ -like *txt* \u043f\u043e\u0438\u0441\u043a \u043f\u043e \u043c\u0430\u0441\u043a\u0430\u043c wildcard, \u0432\u044b\u0432\u043e\u0434\u0438\u0442 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043d\u0430 \u044d\u043a\u0440\u0430\u043d \\ -match txt \u043f\u043e\u0438\u0441\u043a\u0430 \u043f\u043e \u0448\u0430\u0431\u043b\u043e\u043d\u0430\u043c, \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u043d\u0430 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0435 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0433\u043e \u0442\u0435\u043a\u0441\u0442\u0430 \\ -match \"zabbix|rpc\" \u0443\u0441\u043b\u043e\u0432\u0438\u044f, \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430 \u043f\u043e \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u043c \u0441\u043b\u043e\u0432\u0430\u043c \\ -NotMatch \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u043d\u0430 \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0438\u0435 \u0432\u0445\u043e\u0436\u0434\u0435\u043d\u0438\u044f \\ Matches $ip = \"192.168.10.1\" \\ $ip -match \"(\\.\\d{1,3})\\.\\d{1,2}\" True \\ $Matches \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u043f\u043e\u0434\u0445\u043e\u0434\u044f\u0449\u0438\u0435 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u043f\u043e\u0438\u0441\u043a\u0430, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0432\u0445\u043e\u0434\u044f\u0442 \u0438 \u043d\u0435 \u0432\u0445\u043e\u0434\u044f\u0442 \u0432 \u0433\u0440\u0443\u043f\u043f\u044b () $String = \"09/14/2017 12:00:27 - mtbill_post_201709141058.txt 7577_Delivered: OK\" \\ $String -Match \".*(?=\\.txt)\" | Out-Null \\ $Matches[0][-4..-1] -Join \"\" $string.Substring($string.IndexOf(\".txt\")-4, 4) 2-\u0439 \u0432\u0430\u0440\u0438\u0430\u043d\u0442 (IndexOf)` \u0424\u043e\u0440\u043c\u0430\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 (.NET method format) [string]::Format(\"{1} {0}\",\"Index0\",\"Index1\") \\ \"{1} {0}\" -f \"Index0\",\"Index1\" \\ \"{0:###-##-##}\" -f 1234567 \u0437\u0430\u043f\u0438\u0441\u0430\u0442\u044c \u0447\u0438\u0441\u043b\u043e \u0432 \u0434\u0440\u0443\u0433\u043e\u043c \u0444\u043e\u0440\u043c\u0430\u0442\u0435 (#) \\ \"{0:0000}\" -f 123 \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u0447\u0438\u0441\u043b\u043e \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 \u043d\u0435 \u043c\u0435\u043d\u044c\u0448\u0435 4 \u0437\u043d\u0430\u043a\u043e\u0432 (0123) \\ \"{0:P0}\" -f (220/1000) \u043f\u043e\u0441\u0447\u0438\u0442\u0430\u0442\u044c \u0432 \u043f\u0440\u043e\u0446\u0435\u043d\u0442\u0430\u0445 (P) \\ \"{0:P}\" -f (512MB/1GB) \u0441\u043a\u043e\u043b\u044c\u043a\u043e % \u0441\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 512\u041c\u0431 \u043e\u0442 1\u0413\u0431 \\ \"{0:0.0%}\" -f 0.123 \u0443\u043c\u043d\u043e\u0436\u0438\u0442\u044c \u043d\u0430 100% $gp = Get-Process | sort cpu -Descending | select -First 10 foreach ($p in $gp) { \"{0} - {1:N2}\" -f $p.processname, $p.cpu # \u043e\u043a\u0440\u0443\u0433\u043b\u0438\u0442\u044c } \u0423\u0441\u043b\u043e\u0432\u043d\u044b\u0439 \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440 $rh = Read-Host \\ if ($rh -eq 1) {ipconfig} elseif ($rh -eq 2) {getmac} else {hostname} \\ \u0415\u0441\u043b\u0438 \u0443\u0441\u043b\u043e\u0432\u0438\u0435 if () \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0438\u0441\u0442\u0435\u043d\u043d\u044b\u043c ($True), \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435 \u0432 {} \\ \u0415\u0441\u043b\u0438 \u0443\u0441\u043b\u043e\u0432\u0438\u0435 if () \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043b\u043e\u0436\u043d\u044b\u043c ($False), \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435 \u043d\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u0430 else \\ \u0423\u0441\u043b\u043e\u0432\u0438\u0435 Elseif \u0438\u0434\u0451\u0442 \u043f\u043e\u0441\u043b\u0435 \u0443\u0441\u043b\u043e\u0432\u0438\u044f if \u0434\u043b\u044f \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u0443\u0441\u043b\u043e\u0432\u0438\u0439 \u043f\u0435\u0440\u0435\u0434 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u0430 else. \u041e\u043f\u0435\u0440\u0430\u0442\u043e\u0440, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043f\u0435\u0440\u0432\u044b\u0439 \u0432\u0435\u0440\u043d\u0435\u0442 $True, \u043e\u0442\u043c\u0435\u043d\u0438\u0442 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0445 \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u0443\u0441\u043b\u043e\u0432\u0438\u0439 \\ \u0415\u0441\u043b\u0438 \u043f\u0435\u0440\u0435\u0434\u0430\u0442\u044c \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0443\u044e \u0432 \u0443\u0441\u043b\u043e\u0432\u0438\u0435 \u0431\u0435\u0437 \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u0430, \u0442\u043e \u0431\u0443\u0434\u0435\u0442 \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0442\u044c\u0441\u044f \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0443 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u043e\u0439 \u043d\u0430 $True/$False \\ if ((tnc $srv -Port 80).TcpTestSucceeded) {\"Opened port\"} else {\"Closed port\"} \u041e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u044b -eq \u0440\u0430\u0432\u043d\u043e (equal) \\ -ceq \u0443\u0447\u0438\u0442\u044b\u0432\u0430\u0442\u044c \u0440\u0435\u0433\u0438\u0441\u0442\u0440 \\ -ne \u043d\u0435 \u0440\u0430\u0432\u043d\u043e (not equal) \\ -gt \u0431\u043e\u043b\u044c\u0448\u0435 (greater) \\ -ge \u0431\u043e\u043b\u044c\u0448\u0435 \u0438\u043b\u0438 \u0440\u0430\u0432\u043d\u043e \\ -lt \u043c\u0435\u043d\u044c\u0448\u0435 (less) \\ -le \u043c\u0435\u043d\u044c\u0448\u0435 \u0438\u043b\u0438 \u0440\u0430\u0432\u043d\u043e \\ -in \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u043d\u0430 \u043d\u0430\u043b\u0438\u0447\u0438\u0435 (5 -in @(1,2,3,4,5)) \\ -NOT \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u041d\u0415\u0422 !(Test-Path $path) \\ -and \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u0418 \\ -or \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u0418\u041b\u0418 \\ if ((($1 -eq 1) -and ($2 -eq 2)) -or ($1 -ne 3)) {\"$true\"} else {\"$false\"} \u0434\u0432\u0430 \u0443\u0441\u043b\u043e\u0432\u0438\u044f: (\u0435\u0441\u043b\u0438 $1 = 1 \u0438 $2 = 2) \u0438\u043b\u0438 $1 \u043d\u0435 \u0440\u0430\u0432\u043d\u043e 3 Pipeline Operators Write-Output \"First\" && Write-Output \"Second\" \u0434\u0432\u0435 \u0443\u0441\u043f\u0435\u0448\u043d\u044b\u0435 \u043a\u043e\u043c\u0430\u043d\u0434\u044b \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u044e\u0442\u0441\u044f \\ Write-Error \"Bad\" && Write-Output \"Second\" \u043f\u0435\u0440\u0432\u0430\u044f \u043a\u043e\u043c\u0430\u043d\u0434\u0430 \u0437\u0430\u0432\u0435\u0440\u0448\u0430\u0435\u0442\u0441\u044f \u043e\u0448\u0438\u0431\u043a\u043e\u0439, \u0438\u0437-\u0437\u0430 \u0447\u0435\u0433\u043e \u0432\u0442\u043e\u0440\u0430\u044f \u043a\u043e\u043c\u0430\u043d\u0434\u0430 \u043d\u0435 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \\ Write-Error \"Bad\" || Write-Output \"Second\" \u043f\u0435\u0440\u0432\u0430\u044f \u043a\u043e\u043c\u0430\u043d\u0434\u0430 \u0437\u0430\u0432\u0435\u0440\u0448\u0430\u0435\u0442\u0441\u044f \u043e\u0448\u0438\u0431\u043a\u043e\u0439, \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \u0432\u0442\u043e\u0440\u0430\u044f \u043a\u043e\u043c\u0430\u043d\u0434\u0430 \\ Write-Output \"First\" || Write-Output \"Second\" \u043f\u0435\u0440\u0432\u0430\u044f \u043a\u043e\u043c\u0430\u043d\u0434\u0430 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0430 \u0443\u0441\u043f\u0435\u0448\u043d\u043e, \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u0432\u0442\u043e\u0440\u0430\u044f \u043a\u043e\u043c\u0430\u043d\u0434\u0430 \u043d\u0435 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f Invocation Operator $addr = \"8.8.8.8\" \\ $ping = \"ping\" \\ & $ping $addr \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u0442 \u0442\u0435\u043a\u0441\u0442 \u043a\u0430\u043a \u043a\u043e\u043c\u0430\u043d\u0434\u0443 & $ping $addr & \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u043a\u043e\u043c\u0430\u043d\u0434\u0443 \u0432 \u0444\u043e\u043d\u0435 \\ (Get-Job)[-1] | Receive-Job -Keep \u0421\u043f\u0435\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u0435 \u0441\u0438\u043c\u0432\u043e\u043b\u044b \\d \u0447\u0438\u0441\u043b\u043e \u043e\u0442 0 \u0434\u043e 9 (20-07-2022 \u044d\u043a\u0432\u0438\u0432\u0430\u043b\u0435\u043d\u0442: \"\\d\\d-\\d\\d-\\d\\d\\d\\d\") \\ \\D \u043e\u0431\u043e\u0437\u043d\u0430\u0447\u0430\u0435\u0442 \u043b\u044e\u0431\u043e\u0439 \u0441\u0438\u043c\u0432\u043e\u043b, \u043a\u0440\u043e\u043c\u0435 \u0446\u0438\u0444\u0440\u044b. \u0423\u0434\u0430\u043b\u0435\u043d\u0438\u044f \u0432\u0441\u0435\u0445 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432, \u043a\u0440\u043e\u043c\u0435 \u0446\u0438\u0444\u0440: [int]$(\"123 test\" -replace \"\\D\") \\ \\w \u0431\u0443\u043a\u0432\u0430 \u043e\u0442 \"a\" \u0434\u043e \"z\" \u0438 \u043e\u0442 \"A\" \u0434\u043e \"Z\" \u0438\u043b\u0438 \u0447\u0438\u0441\u043b\u043e \u043e\u0442 0 \u0434\u043e 9 \\ \\s \u043f\u0440\u043e\u0431\u0435\u043b, \u044d\u043a\u0432\u0438\u0432\u0430\u043b\u0435\u043d\u0442: \" \" \\ \\n \u043d\u043e\u0432\u0430\u044f \u0441\u0442\u0440\u043e\u043a\u0430 \\ \\b \u043c\u0430\u0441\u043a\u0430, \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u0435\u0442 \u043d\u0430\u0447\u0430\u043b\u043e \u0438 \u043a\u043e\u043d\u0435\u0446 \u0446\u0435\u043b\u043e\u0433\u043e \u0441\u043b\u043e\u0432\u043e\u0441\u043e\u0447\u0435\u0442\u0430\u043d\u0438\u044f \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430 \\ . \u043e\u0431\u043e\u0437\u043d\u0430\u0447\u0430\u0435\u0442 \u043b\u044e\u0431\u043e\u0439 \u0441\u0438\u043c\u0432\u043e\u043b, \u043a\u0440\u043e\u043c\u0435 \u043d\u043e\u0432\u043e\u0439 \u0441\u0442\u0440\u043e\u043a\u0438 \\ \\ \u044d\u043a\u0440\u0430\u043d\u0438\u0440\u0443\u0435\u0442 \u043b\u044e\u0431\u043e\u0439 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u044c\u043d\u044b \u0441\u0438\u043c\u0432\u043e\u043b (\u043c\u0435\u0442\u0430\u0441\u0438\u043c\u0432\u043e\u043b). \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f, \u0435\u0441\u043b\u0438 \u043d\u0443\u0436\u043d\u043e \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0439 \u0441\u0438\u043c\u0432\u043e\u043b, \u0432\u043c\u0435\u0441\u0442\u043e \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u044c\u043d\u043e\u0433\u043e ({ } [ ] / \\ + * . $ ^ | ?) \\ + \u043f\u043e\u0432\u0442\u043e\u0440\u044f\u0435\u0442\u0441\u044f 1 \u0438 \u0431\u043e\u043b\u0435\u0435 \u0440\u0430\u0437 (\\s+) \\ {1,25} \u043a\u0432\u0430\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440, \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043f\u043e\u0432\u0442\u043e\u0440\u0435\u043d\u0438\u0439 \u0441\u0438\u043c\u0432\u043e\u043b\u0430 \u0441\u043b\u0435\u0432\u0430 \u043d\u0430 \u043f\u0440\u0430\u0432\u043e (\u043e\u0442 1 \u0434\u043e 25 \u0440\u0430\u0437) \\ [] \u043f\u043e\u0438\u0441\u043a \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u044f \u043b\u044e\u0431\u043e\u0439 \u0431\u0443\u043a\u0432\u044b, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, [A-z0-9] \u043e\u0442 A \u0434\u043e z \u0438 \u0446\u0438\u0444\u0440\u044b \u043e\u0442 0 \u0434\u043e 9 (\"192.168.1.1\" -match \"192.1[6-7][0-9]\") \u042f\u043a\u043e\u0440\u0438 ^ \u0438\u043b\u0438 \\A \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u0435\u0442 \u043d\u0430\u0447\u0430\u043b\u043e \u0441\u0442\u0440\u043e\u043a\u0438. $url -replace '^','https:' \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043d\u0430\u0447\u0430\u043b\u043e; \\ $ \u0438\u043b\u0438 \\Z \u043e\u0431\u043e\u0437\u043d\u0430\u0447\u0430\u044e\u0442 \u043a\u043e\u043d\u0435\u0446 \u0441\u0442\u0440\u043e\u043a\u0438. $ip -replace \"\\d{1,3}$\",\"0\" \\ (?=text) \u043f\u043e\u0438\u0441\u043a \u0441\u043b\u043e\u0432\u0430 \u0441\u043b\u0435\u0432\u0430. \u041f\u0438\u0448\u0435\u043c \u0441\u043b\u0435\u0432\u0430 \u043d\u0430 \u043f\u0440\u0430\u0432\u043e \u043e\u0442 \u0438\u0441\u043a\u043e\u043c\u043e\u0433\u043e (\u0438\u0449\u0435\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u0446\u0435\u043b\u044b\u0435 \u0441\u043b\u043e\u0432\u043e\u0441\u043e\u0447\u0435\u0442\u0430\u043d\u0438\u044f) \"Server:\\s(.{1,30})\\s(?=$username)\" \\ (?<=text) \u043f\u043e\u0438\u0441\u043a \u0441\u043b\u043e\u0432\u0430 \u0441\u043f\u0440\u0430\u0432\u0430. $in_time -replace \".+(?<=Last)\" \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u0441\u0435 \u0434\u043e \u0441\u043b\u043e\u0432\u0430 Last \\ (?!text) \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u0435\u0442 \u0441\u043e \u0441\u043b\u043e\u0432\u043e\u043c \u0441\u043b\u0435\u0432\u0430 \\ (?<!text) \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u0435\u0442 \u0441\u043e \u0441\u043b\u043e\u0432\u043e\u043c \u0441\u043f\u0440\u0430\u0432\u0430 $test = \"string\" \\ $test -replace \".{1}$\" \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043b\u044e\u0431\u043e\u0435 \u043a\u043e\u043b-\u0432\u043e \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432 \u0432 \u043a\u043e\u043d\u0446\u0435 \u0441\u0442\u0440\u043e\u043a\u0438 \\ $test -replace \"^.{1}\" \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043b\u044e\u0431\u043e\u0435 \u043a\u043e\u043b-\u0432\u043e \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432 \u0432 \u043d\u0430\u0447\u0430\u043b\u0435 \u0441\u0442\u0440\u043e\u043a\u0438 \\ \u0413\u0440\u0443\u043f\u043f\u044b \u0437\u0430\u0445\u0432\u0430\u0442\u0430 $date = '12.31.2021' \\ $date -replace '^(\\d{2}).(\\d{2})','$2.$1' \u043f\u043e\u043c\u0435\u043d\u044f\u0442\u044c \u043c\u0435\u0441\u0442\u0430\u043c\u0438 \\ $1 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u043f\u0435\u0440\u0432\u043e\u0439 \u0433\u0440\u0443\u043f\u043f\u044b \u0432 \u0441\u043a\u043e\u0431\u043a\u0430\u0445 \\ $2 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u0432\u0442\u043e\u0440\u043e\u0439 \u0433\u0440\u0443\u043f\u043f\u044b DataType $srv.GetType() \u0443\u0437\u043d\u0430\u0442\u044c \u0442\u0438\u043f \u0434\u0430\u043d\u043d\u044b\u0445 \\ $srv -is [string] \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u043d\u0430 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0435 \u0442\u0438\u043f\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 \\ $srv -isnot [System.Object] \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u043d\u0430 \u043d\u0435\u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0435 \\ [Object] \u043c\u0430\u0441\u0441\u0438\u0432 (BaseType:System.Array) \\ [DateTime] \u0444\u043e\u0440\u043c\u0430\u0442 \u0432\u0440\u0435\u043c\u0435\u043d\u0438 (BaseType:System.ValueType) \\ [Bool]/[Boolean] \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 ($True/$False) \u0438\u043b\u0438 1/0 (1 \u0431\u0438\u0442) \u043d\u0430\u043b\u0438\u0447\u0438\u0435/\u043e\u0442\u0441\u0443\u0441\u0442\u0432\u0438\u0435 \u043d\u0430\u043f\u0440\u044f\u0436\u0435\u043d\u0438\u044f \\ [Byte] 8-\u0431\u0438\u0442\u043d\u043e\u0435 (1 \u0431\u0430\u0439\u0442) \u0446\u0435\u043b\u043e\u0435 \u0447\u0438\u0441\u043b\u043e \u0431\u0435\u0437 \u0437\u043d\u0430\u043a\u0430 (0..255) \\ [Int16] 16-\u0431\u0438\u0442\u043d\u043e\u0435 \u0437\u043d\u0430\u043a\u043e\u0432\u043e\u0435 \u0446\u0435\u043b\u043e\u0435 \u0447\u0438\u0441\u043b\u043e \u043e\u0442 -32767 \u0434\u043e 32767 (\u0442\u0438\u043f \u0434\u0430\u043d\u043d\u044b\u0445 WORD 0..65535) \\ [Int] 32-\u0431\u0438\u0442\u043d\u043e\u0435 (4 \u0431\u0430\u0439\u0442\u0430) \u0437\u043d\u0430\u043a\u043e\u0432\u043e\u0435 \u0446\u0435\u043b\u043e\u0435 \u0447\u0438\u0441\u043b\u043e \u043e\u0442 \u20132147483648 \u0434\u043e 2147483647 (DWORD) \\ [Int64] 64-\u0431\u0438\u0442\u043d\u043e\u0435 \u043e\u0442 -9223372036854775808 \u0434\u043e 9223372036854775808 (LWORD) \\ [Decimal] 128-\u0431\u0438\u0442\u043d\u043e\u0435 \u0434\u0435\u0441\u044f\u0442\u0438\u0447\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043e\u0442 \u201379228162514264337593543950335 \u0434\u043e 79228162514264337593543950335 \\ [Single] \u0447\u0438\u0441\u043b\u043e \u0441 \u043f\u043b\u0430\u0432\u0430\u044e\u0449\u0435\u0439 \u0437\u0430\u043f\u044f\u0442\u043e\u0439 (32-\u0440\u0430\u0437\u0440\u044f\u0434\u043d\u043e\u0435) \\ [Double] \u0447\u0438\u0441\u043b\u043e \u0441 \u043f\u043b\u0430\u0432\u0430\u044e\u0449\u0435\u0439 \u0437\u0430\u043f\u044f\u0442\u043e\u0439 \u0441 \u0434\u0432\u043e\u0439\u043d\u043e\u0439 \u0442\u043e\u0447\u043d\u043e\u0441\u0442\u044c\u044e (64-\u0440\u0430\u0437\u0440\u044f\u0434\u043d\u043e\u0435) \\ [String] \u043d\u0435\u0438\u0437\u043c\u0435\u043d\u044f\u0435\u043c\u0430\u044f \u0441\u0442\u0440\u043e\u043a\u0430 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432 \u042e\u043d\u0438\u043a\u043e\u0434\u0430 \u0444\u0438\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0439 \u0434\u043b\u0438\u043d\u044b (BaseType:System.Object) Math [math] | Get-Member -Static \\ [math]::Pow(2,4) 2 \u0432 4 \u0441\u0442\u0435\u043f\u0435\u043d\u0438 \\ [math]::Truncate(1.8) \u0433\u0440\u0443\u0431\u043e\u0435 \u043e\u043a\u0440\u0443\u0433\u043b\u0435\u043d\u0438\u0435, \u0443\u0434\u0430\u043b\u044f\u0435\u0442 \u0434\u0440\u043e\u0431\u043d\u0443\u044e \u0447\u0430\u0441\u0442\u044c \\ [math]::Ceiling(1.8) \u043e\u043a\u0440\u0443\u0433\u043b\u044f\u0435\u0442 \u0447\u0438\u0441\u043b\u043e \u0432 \u0431\u043e\u043b\u044c\u0448\u0443\u044e \u0441\u0442\u043e\u0440\u043e\u043d\u0443 \u0434\u043e \u0431\u043b\u0438\u0436\u0430\u0439\u0448\u0435\u0433\u043e \u0446\u0435\u043b\u043e\u0433\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \\ [math]::Floor(-1.8) \u043e\u043a\u0440\u0443\u0433\u043b\u044f\u0435\u0442 \u0447\u0438\u0441\u043b\u043e \u0432 \u043c\u0435\u043d\u044c\u0448\u0443\u044e \u0441\u0442\u043e\u0440\u043e\u043d\u0443 \\ [math]::Min(33,22) \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u043d\u0430\u0438\u043c\u0435\u043d\u044c\u0448\u0435\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0434\u0432\u0443\u0445 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439 \\ [math]::Max(33,22) \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u043d\u0430\u0438\u0431\u043e\u043b\u044c\u0448\u0435\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0434\u0432\u0443\u0445 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439 Round [double]::Round(87.5, 0) 88 (\u043d\u0435\u0447\u0435\u0442\u043d\u043e\u0435), \u0432 .NET \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u043e\u043a\u0440\u0443\u0433\u043b\u0435\u043d\u0438\u0435 \u0432 \u0441\u0440\u0435\u0434\u043d\u0435\u0439 \u0442\u043e\u0447\u043a\u0435 ToEven, \u0433\u0434\u0435 *.5 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u043e\u043a\u0440\u0443\u0433\u043b\u044f\u044e\u0442\u0441\u044f \u0434\u043e \u0431\u043b\u0438\u0436\u0430\u0439\u0448\u0435\u0433\u043e \u0447\u0435\u0442\u043d\u043e\u0433\u043e \u0446\u0435\u043b\u043e\u0433\u043e \u0447\u0438\u0441\u043b\u0430. \\ [double]::Round(88.5, 0) 88 (\u0447\u0435\u0442\u043d\u043e\u0435) \\ [double]::Round(88.5, 0, 1) 89 (\u043e\u043a\u0440\u0443\u0433\u043b\u044f\u0442\u044c \u0432 \u0431\u043e\u043b\u044c\u0448\u0443\u044e \u0441\u0442\u043e\u0440\u043e\u043d\u0443) \\ [double]::Round(1234.56789, 2) \u043e\u043a\u0440\u0443\u0433\u043b\u0438\u0442\u044c \u0434\u043e 2 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432 \u043f\u043e\u0441\u043b\u0435 \u0437\u0430\u043f\u044f\u0442\u043e\u0439 ToString (4164539/1MB).ToString(\"0.00\") \u0440\u0430\u0437\u0434\u0435\u043b\u0438\u0442\u044c \u043d\u0430 \u0434\u0432\u0430\u0436\u0434\u044b \u043d\u0430 1024/1024 \u0438 \u043e\u043a\u0440\u0443\u0433\u043b\u0438\u0442\u044c \u0434\u043e 3,97 Char [Char] c\u0438\u043c\u0432\u043e\u043b \u042e\u043d\u0438\u043a\u043e\u0434\u0430 (16-\u0440\u0430\u0437\u0440\u044f\u0434\u043d\u044b\u0439) \\ $char = $srv.ToCharArray() \u0440\u0430\u0437\u0431\u0438\u0442\u044c \u0441\u0442\u0440\u043e\u043a\u0443 [string] \u043d\u0430 \u043c\u0430\u0441\u0441\u0438\u0432 [System.Array] \u0438\u0437 \u0431\u0443\u043a\u0432 \\ Module psd1 @{ RootModule = \"Get-Function.psm1\" ModuleVersion = \"0.1\" Author = \"Lifailon\" CompanyName = \"Open Source Community\" Copyright = \"Apache-2.0\" Description = \"Function example\" PowerShellVersion = \"7.2\" PrivateData = @{ PSData = @{ Tags = @(\"Function\",\"Example\") ProjectUri = \"https://github.com/Lifailon/PS-Commands\" LicenseUri = \"https://github.com/Lifailon/Console-Translate/blob/rsa/LICENSE\" ReleaseNotes = \"Second release\" } } } psm1 function Get-Function { <# .SYNOPSIS \u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 .DESCRIPTION \u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 .LINK https://github.com/Lifailon/PS-Commands #> param ( [Parameter(Mandatory,ValueFromPipeline)][string]$Text, [ValidateSet(\"Test1\",\"Test2\")][string]$Provider = \"Test1\", [ValidateRange(1,3)][int]$Number = 2, [Switch]$Switch ) Write-Host Param Text: $Text Write-Host Param Provider: $Provider Write-Host Param Number: $Number Write-Host Param Switch: $Switch } Get-Function Test Switch $MMM = Get-Date -UFormat \"%m\" switch($MMM) { \"01\" {$Month = 'Jan'} \"02\" {$Month = 'Feb'} \"03\" {$Month = 'Mar'} \"04\" {$Month = 'Apr'} \"05\" {$Month = 'May'} \"06\" {$Month = 'Jun'} \"07\" {$Month = 'Jul'} \"08\" {$Month = 'Aug'} \"09\" {$Month = 'Sep'} \"10\" {$Month = 'Oct'} \"11\" {$Month = 'Nov'} \"12\" {$Month = 'Dec'} } function switch Function fun-switch ( [switch]$param ) { If ($param) {\"yes\"} else {\"no\"} } fun-switch -param Bit \u0414\u0432\u043e\u0438\u0447\u043d\u043e\u0435 \u0414\u0435\u0441\u044f\u0442\u0438\u0447\u043d\u043e\u0435 1 1 10 2 11 3 100 4 101 5 110 6 111 7 1000 8 1001 9 1010 10 1011 11 1100 12 1101 13 1110 14 1111 15 1 0000 16 \u0414\u0432\u043e\u0438\u0447\u043d\u043e\u0435 \u0414\u0435\u0441\u044f\u0442\u0438\u0447\u043d\u043e\u0435 \u041d\u043e\u043c\u0435\u0440 \u0440\u0430\u0437\u0440\u044f\u0434\u0430 1 1 0 10 2 1 100 4 2 1000 8 3 1 0000 16 4 10 0000 32 5 100 0000 64 6 1000 0000 128 7 1 0000 0000 256 8 \u0418\u0437 \u0434\u0432\u043e\u0438\u0447\u043d\u043e\u0433\u043e => \u0434\u0435\u0441\u044f\u0442\u0438\u0447\u043d\u043e\u0435 (1-\u0439 \u0432\u0430\u0440\u0438\u0430\u043d\u0442 \u043f\u043e \u0442\u0430\u0431\u043b\u0438\u0446\u0435) 1001 0011 = 1000 0000 + 1 0000 + 10 + 1 = 128 + 16 + 2 + 1 = 147 2-\u0439 \u0432\u0430\u0440\u0438\u0430\u043d\u0442 7654 3210 (\u0440\u0430\u0437\u0440\u044f\u0434\u044b \u0434\u0432\u043e\u0438\u0447\u043d\u043e\u0433\u043e \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u044f) = (1*2^7)+(0*2^6)+(0*2^5)+(1*2^4)+(0*2^3)+(0*2^2)+(1*2^1)+(1*2^0) = 147 [math]::Pow(2,7) + [math]::Pow(2,4) + [math]::Pow(2,1) + [math]::Pow(2,0) = 147` \u0438\u0441\u043a\u043b\u044e\u0447\u0438\u0442\u044c 0 \u0438 \u0441\u043b\u043e\u0436\u0438\u0442\u044c \u0441\u0442\u0435\u043f\u0435\u043d\u044c \u0418\u0437 \u0434\u0435\u0441\u044f\u0442\u0438\u0447\u043d\u043e\u0433\u043e => \u0434\u0432\u043e\u0438\u0447\u043d\u043e\u0435 (1-\u0439 \u0432\u0430\u0440\u0438\u0430\u043d\u0442 \u043f\u043e \u0442\u0430\u0431\u043b\u0438\u0446\u0435) 347 \u0432\u044b\u0447\u0435\u0441\u0442\u044c \u0431\u043b\u0438\u0436\u0430\u0439\u0448\u0438\u0435 256 = 91 (+ 1 0000 0000 \u0437\u0430\u0431\u0440\u0430\u0442\u044c \u0434\u0432\u043e\u0438\u0447\u043d\u044b\u0439 \u043e\u0441\u0442\u0430\u0442\u043e\u043a) 91 - 64 = 27 \u0431\u043b\u0438\u0436\u0430\u0439\u0448\u0435\u0435 16 (+ 100 0000) 27 - 16 = 11 \u0431\u043b\u0438\u0436\u0430\u0439\u0448\u0435\u0435 8 (+ 1 0000) 11 - 8 = 3 \u0431\u043b\u0438\u0436\u0430\u0439\u0448\u0435\u0435 2 (+ 1000) 3 - 2 = 1 (+ 10) 1 - 1 = 0 (+ 1) 1 0101 1011 2-\u0439 \u0432\u0430\u0440\u0438\u0430\u043d\u0442 \u041f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0435 \u0434\u0435\u043b\u0435\u043d\u0438\u044f \u0447\u0438\u0441\u043b\u0430 \u043d\u0430 2, \u043f\u0440\u0435\u0434\u0432\u043e\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0437\u0430\u0431\u0438\u0440\u0430\u044f \u043e\u0441\u0442\u0430\u0442\u043e\u043a \u0434\u043b\u044f \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u0447\u0435\u0442\u043d\u043e\u0433\u043e \u0447\u0438\u0441\u043b\u0430 \u0432 \u043c\u0435\u043d\u044c\u0448\u0443\u044e \u0441\u0442\u043e\u0440\u043e\u043d\u0443 347 - 346 = \u043e\u0441\u0442\u0430\u0442\u043e\u043a 1, (347-1)/2 = 173 173 - 172 = \u043e\u0441\u0442\u0430\u0442\u043e\u043a 1, (172-1)/2 = 86 86 - 86 = \u043e\u0441\u0442\u0430\u0442\u043e\u043a 0, 86/2 = 43 43 - 42 = \u043e\u0441\u0442\u0430\u0442\u043e\u043a 1, (43-1)/2 = 21 21 - 20 = \u043e\u0441\u0442\u0430\u0442\u043e\u043a 1, (21-1)/2 = 10 10 - 10 = \u043e\u0441\u0442\u0430\u0442\u043e\u043a 0, 10/2 = 5 5 - 4 = \u043e\u0441\u0442\u0430\u0442\u043e\u043a 1, (5-1)/2 = 2 2 - 2 = \u043e\u0441\u0442\u0430\u0442\u043e\u043a 0, 2/2 = 1 1 - 2 = \u043e\u0441\u0442\u0430\u0442\u043e\u043a 1, (1-1)/2 = 0 \u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u0434\u0435\u043b\u0435\u043d\u0438\u044f \u0437\u0430\u043f\u0438\u0441\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u0441\u043d\u0438\u0437\u0443 \u0432\u0432\u0435\u0440\u0445 Bit Convertor function ConvertTo-Bit { param ( [Int]$int ) [array]$bits = @() $test = $true while ($test -eq $true) { if (($int/2).GetType() -match [double]) { $int = ($int-1)/2 [array]$bits += 1 } elseif (($int/2).GetType() -match [int]) { $int = $int/2 [array]$bits += 0 } if ($int -eq 0) { $test = $false } } $bits = $bits[-1..-999] ([string]($bits)) -replace \"\\s\" } ConvertTo-Bit 347 function ConvertFrom-Bit { param ( $bit ) [int]$int = 0 $bits = $bit.ToString().ToCharArray() $index = ($bits.Count)-1 foreach ($b in $bits) { if ($b -notlike 0) { $int += [math]::Pow(2,$index) } $index -= 1 } $int } ConvertFrom-Bit 10010011 Get-Process pwsh | fl ProcessorAffinity \u043f\u0440\u0438\u0432\u044f\u0437\u043a\u0430 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 \u043a \u044f\u0434\u0440\u0430\u043c, \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 \u0438\u0437 \u0441\u0435\u0431\u044f \u0431\u0438\u0442\u043e\u0432\u0443\u044e \u043c\u0430\u0441\u043a\u0443 (bitmask), \u0433\u0434\u0435 \u043a\u0430\u0436\u0434\u043e\u043c\u0443 \u0431\u0438\u0442\u0443 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u044f\u0434\u0440\u043e \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u0440\u0430. \u0415\u0441\u043b\u0438 \u0434\u043b\u044f \u044f\u0434\u0440\u0430 \u043e\u0442\u043c\u0435\u0447\u0435\u043d\u043e \u0441\u0445\u043e\u0434\u0441\u0442\u0432\u043e (affinity), \u0442\u043e \u0431\u0438\u0442 \u0432\u044b\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0432 1, \u0435\u0441\u043b\u0438 \u043d\u0435\u0442 \u2014 \u0442\u043e \u0432 0. \u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0435\u0441\u043b\u0438 \u0432\u044b\u0431\u0440\u0430\u043d\u044b \u0432\u0441\u0435 16 \u044f\u0434\u0435\u0440, \u0442\u043e \u044d\u0442\u043e 1111 1111 1111 1111 \u0438\u043b\u0438 65535. \\ (Get-Process pwsh).ProcessorAffinity = 15 0000000000001111 \u043f\u0440\u0438\u0441\u0432\u043e\u0438\u0442\u044c 4 \u043f\u0435\u0440\u0432\u044b\u0445 \u044f\u0434\u0440\u0430 \\ (Get-Process pwsh).ProcessorAffinity = 61440 1111000000000000 \u043f\u0440\u0438\u0441\u0432\u043e\u0438\u0442\u044c 4 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0445 \u044f\u0434\u0440\u0430 \\ (Get-Process pwsh).ProcessorAffinity = (ConvertFrom-Bit 1111000000000000) Cycle Foreach $list = 100..110 \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043c\u0430\u0441\u0441\u0438\u0432 \u0438\u0437 \u0446\u0438\u0444\u0440 \u043e\u0442 100 \u0434\u043e 110 \\ foreach ($srv in $list) {ping 192.168.3.$srv -n 1 -w 50} $srv \u0445\u0440\u0430\u043d\u0438\u0442 \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 \u0438\u0437 $list \u0438 \u043f\u043e\u0432\u0442\u043e\u0440\u044f\u0435\u0442 \u043a\u043e\u043c\u0430\u043d\u0434\u0443 \u0434\u043e \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430 \u0432 \u043c\u0430\u0441\u0441\u0438\u0432\u0435 \\ $foreach.Current \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 \u0432 \u0446\u0438\u043a\u043b\u0435 \\ $foreach.Reset() \u043e\u0431\u043d\u0443\u043b\u044f\u0435\u0442 \u0438\u0442\u0435\u0440\u0430\u0446\u0438\u044e, \u043f\u0435\u0440\u0435\u0431\u043e\u0440 \u043d\u0430\u0447\u043d\u0435\u0442\u0441\u044f \u0437\u0430\u043d\u043e\u0432\u043e, \u0447\u0442\u043e \u043f\u0440\u0438\u0432\u043e\u0434\u0438\u0442 \u043a \u0431\u0435\u0441\u043a\u043e\u043d\u0435\u0447\u043d\u043e\u043c\u0443 \u0446\u0438\u043a\u043b\u0443 \\ $foreach.MoveNext() \u043f\u0435\u0440\u0435\u0445\u043e\u0434 \u043a \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u043c\u0443 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0443 \u0432 \u0446\u0438\u043a\u043b\u0435 ForEach-Object (%) 100..110 | %{ping -n 1 -w 50 192.168.3.$_ > $null if ($LastExitCode -eq 0) {Write-Host \"192.168.3.$_\" -ForegroundColor green } else { Write-Host \"192.168.3.$_\"-ForegroundColor Red}} % # \u043f\u0435\u0440\u0435\u0434\u0430\u0442\u044c \u0446\u0438\u043a\u043b \u0447\u0435\u0440\u0435\u0437 \u043a\u043e\u043d\u0432\u0435\u0435\u0440 (ForEach-Object) $_ # \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0430\u044f \u0446\u0438\u043a\u043b\u0430 \u0438 \u043a\u043e\u043d\u0432\u0435\u0435\u0440\u0430 ($PSItem) gwmi Win32_QuickFixEngineering | where {$_.InstalledOn.ToString() -match \"2022\"} | %{($_.HotFixID.Substring(2))} # gwmi \u0441\u043e\u0437\u0434\u0430\u0435\u0442 \u043c\u0430\u0441\u0441\u0438\u0432, \u0432\u044b\u0432\u043e\u0434 \u043a\u043e\u043c\u0430\u043d\u0434\u044b \u043f\u0435\u0440\u0435\u0434\u0430\u0435\u0442\u0441\u044f where \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430 \u043f\u043e\u0434\u0445\u043e\u0434\u044f\u0449\u0438\u0445 \u043f\u043e\u0434 \u043a\u0440\u0438\u0442\u0435\u0440\u0438\u0438 \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432. \u041f\u043e \u043a\u043e\u043d\u0432\u0435\u0435\u0440\u0443 \u043f\u0435\u0440\u0435\u0434\u0430\u0435\u0442\u0441\u044f \u0432 \u0446\u0438\u043a\u043b \u0434\u043b\u044f \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u044f \u043f\u0435\u0440\u0432\u044b\u0445 (2) \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432 \u043c\u0435\u0442\u043e\u0434\u043e\u043c Substring \u0438\u0437 \u0432\u0441\u0435\u0445 \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 HotFixID. While $srv = \"yandex.ru\" $out2 = \"\u0415\u0441\u0442\u044c \u043f\u0438\u043d\u0433\" $out3 = \"\u041d\u0435\u0442 \u043f\u0438\u043d\u0433\u0430\" $out = $false # \u043f\u0440\u0435\u0434\u0432\u0430\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0441\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0443\u044e, While \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u0443\u0441\u043b\u043e\u0432\u0438\u0435 \u0434\u043e \u0437\u0430\u043f\u0443\u0441\u043a\u0430 \u0446\u0438\u043a\u043b\u0430 While ($out -eq $false){ # \u043f\u043e\u043a\u0430 \u0443\u0441\u043b\u043e\u0432\u0438\u0435 \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f $true, \u0446\u0438\u043a\u043b \u0431\u0443\u0434\u0435\u0442 \u043f\u043e\u0432\u0442\u043e\u0440\u044f\u0442\u044c\u0441\u044f $out = ping -n 1 -w 50 $srv if ($out -match \"ttl\") {$out = $true; $out2} else {$out = $false; $out3; sleep 1} } while ($True){ # \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0431\u0435\u0441\u043a\u043e\u043d\u0435\u0447\u043d\u044b\u0439 \u0446\u0438\u043a\u043b $result = ping yandex.ru -n 1 -w 50 if ($result -match \"TTL\"){ # \u0443\u0441\u043b\u043e\u0432\u0438\u0435, \u043f\u0440\u0438 \u043a\u043e\u0442\u043e\u0440\u043e\u043c \u0431\u0443\u0434\u0435\u0442 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d break Write-Host \"\u0421\u0430\u0439\u0442 \u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d\" break # \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442 \u0446\u0438\u043a\u043b } else {Write-Host \"\u0421\u0430\u0439\u0442 \u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d\"; sleep 1} } Try-Catch-Finally Try {$out = pping 192.168.3.1} Catch {Write-Warning \"$($error[0])\"} # \u0432\u044b\u0432\u043e\u0434\u0438\u0442 \u0432 \u0441\u043b\u0443\u0447\u0430\u0435 \u043e\u0448\u0438\u0431\u043a\u0438 (\u0432\u043c\u0435\u0441\u0442\u043e \u043e\u0448\u0438\u0431\u043a\u0438) finally {$out = \"End\"} # \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \u0432 \u043a\u043e\u043d\u0446\u0435 \u0432 \u043b\u044e\u0431\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435 Files $file = [System.IO.File]::Create(\"$home\\desktop\\test.txt\") \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0444\u0430\u0439\u043b \\ $file.Close() \u0437\u0430\u043a\u0440\u044b\u0442\u044c \u0444\u0430\u0439\u043b \\ [System.IO.File]::ReadAllLines(\"$home\\desktop\\test.txt\") \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u0442\u044c \u0444\u0430\u0439\u043b \\ $file = New-Object System.IO.StreamReader(\"$home\\desktop\\test.txt\") \u0444\u0430\u0439\u043b \u0431\u0443\u0434\u0435\u0442 \u0437\u0430\u043d\u044f\u0442 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u043c PowerShell \\ $file | gm \\ $file.ReadLine() \u043f\u043e\u0441\u0442\u0440\u043e\u0447\u043d\u044b\u0439 \u0432\u044b\u0432\u043e\u0434 \\ $file.ReadToEnd() \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u0442\u044c \u0444\u0430\u0439\u043b \u0446\u0435\u043b\u0438\u043a\u043e\u043c Read/Write Bytes $file = [io.file]::ReadAllBytes(\"$home\\desktop\\powershell.jpg\") \u043c\u0435\u0442\u043e\u0434 \u043e\u0442\u043a\u0440\u044b\u0432\u0430\u0435\u0442 \u0434\u0432\u043e\u0438\u0447\u043d\u044b\u0439 \u0444\u0430\u0439\u043b, \u0441\u0447\u0438\u0442\u044b\u0432\u0430\u0435\u0442 \u0435\u0433\u043e \u0432 \u043c\u0430\u0441\u0441\u0438\u0432 \u0431\u0430\u0439\u0442 \u0438 \u0437\u0430\u043a\u0440\u044b\u0432\u0430\u0435\u0442 \u0444\u0430\u0439\u043b \\ [io.file]::WriteAllBytes(\"$home\\desktop\\tloztotk-2.jpg\",$file) \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0431\u0430\u0439\u0442\u044b \u0432 \u0444\u0430\u0439\u043b (\u043c\u043e\u0436\u043d\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0434\u043b\u044f \u0432\u044b\u0433\u0440\u0443\u0437\u043a\u0438 \u0434\u0432\u043e\u0438\u0447\u043d\u044b\u0445 \u0444\u0430\u0439\u043b\u043e\u0432 \u0438\u0437 \u0411\u0414) Get-Content $home/desktop\\test.txt -Wait \u0430\u043d\u0430\u043b\u043e\u0433 tail \\ Test-Path $path \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u043e\u0441\u0442\u044c \u043f\u0443\u0442\u0438 \\ Get-ChildItem $path -Filter *.txt -Recurse \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0430 (Alias: ls/gci/dir) \u0438 \u0434\u043e\u0447\u0435\u0440\u043d\u0438\u0445 \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u043e\u0432 (-Recurse) \u0438 \u043e\u0442\u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u044b\u0432\u043e\u0434 \\ Get-Location \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0442\u0435\u043a\u0443\u0449\u0438\u0435 \u043c\u0435\u0441\u0442\u043e\u0440\u0430\u0441\u043f\u043e\u043b\u043e\u0436\u0435\u043d\u0438\u0435 (Alias: pwd/gl) \\ Set-Location $path \u043f\u0435\u0440\u0435\u043c\u0435\u0449\u0435\u043d\u0438\u0435 \u043f\u043e \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0430\u043c (Alias: cd/sl) \\ Invoke-Item $path \u043e\u0442\u043a\u0440\u044b\u0442\u044c \u0444\u0430\u0439\u043b (Alias: ii/start) \\ Get-ItemProperty $env:userprofile\\Documents\\dns-list.txt | select FullName,Directory,Name,BaseName,Extension \u0441\u0432\u043e\u0439\u0442\u0441\u0432\u0430 \u0444\u0430\u0439\u043b\u0430 \\ Get-ItemProperty -Path $path\\* | select FullName,CreationTime,LastWriteTime \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430 \u0444\u0430\u0439\u043b\u043e\u0432 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0433\u043e \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u0438, \u0434\u0430\u0442\u0430 \u0438\u0445 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f \u0438 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \\ New-Item -Path \"C:\\test\\\" -ItemType \"Directory\" \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u044e (Alias: mkdir/md) \\ New-Item -Path \"C:\\test\\file.txt\" -ItemType \"File\" -Value \"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0442\u0435\u043a\u0441\u0442 \u0432 \u0444\u0430\u0439\u043b\" \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0444\u0430\u0439\u043b \\ \"test\" > \"C:\\test\\file.txt\" \u0437\u0430\u043c\u0435\u043d\u0438\u0442\u044c \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \\ \"test\" >> \"C:\\test\\file.txt\" \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0441\u0442\u0440\u043e\u043a\u0443 \u0432 \u0444\u0430\u0439\u043b \\ New-Item -Path \"C:\\test\\test\\file.txt\" -Force \u043a\u043b\u044e\u0447 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0434\u043b\u044f \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0445 \u0432 \u043f\u0443\u0442\u0438 \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u0439 \u0438\u043b\u0438 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0438\u0441\u0438 \u0444\u0430\u0439\u043b\u0430 \u0435\u0441\u043b\u0438 \u043e\u043d \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \\ Move-Item \u043f\u0435\u0440\u0435\u043c\u0435\u0449\u0435\u043d\u0438\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 (Alias: mv/move) \\ Remove-Item \"$path\\\" -Recurse \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0432\u0441\u0435\u0445 \u0444\u0430\u0439\u043b\u043e\u0432 \u0432\u043d\u0443\u0442\u0440\u0438 \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0430, \u0431\u0435\u0437 \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u043f\u043e\u0434\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u044f (Alias: rm/del) \\ Remove-Item $path -Recurse -Include \"*.txt\",\"*.temp\" -Exclude \"log.txt\" \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u0441\u0435 \u0444\u0430\u0439\u043b\u044b \u0441 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u0435\u043c txt \u0438 temp ([Array]), \u043a\u0440\u043e\u043c\u0435 log.txt \\ Rename-Item \"C:\\test\\*.*\" \"*.jpg\" \u043f\u0435\u0440\u0435\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u0442\u044c \u0444\u0430\u0439\u043b\u044b \u043f\u043e \u043c\u0430\u0441\u043a\u0435 (Alias: ren) \\ Copy-Item \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0444\u0430\u0439\u043b\u043e\u0432 \u0438 \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u043e\u0432 (Alias: cp/copy) \\ Copy-Item -Path \"\\\\server-01\\test\" -Destination \"C:\\\" -Recurse \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u044e \u0441 \u0435\u0435 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u044b\u043c (-Recurse) \\ Copy-Item -Path \"C:\\*.txt\" -Destination \"C:\\test\\\" \u0437\u043d\u0430\u043a '\\' \u0432 \u043a\u043e\u043d\u0446\u0435 Destination \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0434\u043b\u044f \u043f\u0435\u0440\u0435\u043d\u043e\u0441\u0430 \u043f\u0430\u043f\u043a\u0438 \u0432\u043d\u0443\u0442\u0440\u044c \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0439, \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0438\u0435, \u0447\u0442\u043e \u044d\u0442\u043e \u043d\u043e\u0432\u043e\u0435 \u0438\u043c\u044f \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u0438 \\ Copy-Item -Path \"C:\\*\" -Destination \"C:\\test\\\" -Include '*.txt','*.jpg' \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u0441 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u043c \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u0435\u043c (Include) \\ Copy-Item -Path \"C:\\*\" -Destination \"C:\\test\\\" -Exclude '*.jpeg' \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043e\u0431\u044a\u0435\u043a\u0442\u044b, \u0437\u0430 \u0438\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435\u043c \u0444\u0430\u0439\u043b\u043e\u0432 \u0441 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u0435\u043c (Exclude) \\ $log = Copy-Item \"C:\\*.txt\" \"C:\\test\\\" -PassThru \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f (\u043b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435) \u0432 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0443\u044e, \u043c\u043e\u0436\u043d\u043e \u0437\u0430\u0431\u0438\u0440\u0430\u0442\u044c \u0441\u0442\u0440\u043e\u043a\u0438 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0438\u043d\u0434\u0435\u043a\u0441\u043e\u0432 $log[0].FullName Clear-env-Temp-14-days $ls = Get-Item $env:TEMP\\*.tmp # \u0441\u0447\u0438\u0442\u0430\u0442\u044c \u0432\u0441\u0435 \u0444\u0430\u0439\u043b\u044b \u0441 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u043c \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u0435\u043c $date = (Get-Date).AddDays(-14) foreach ($l in $ls) { if ($l.LastWriteTime -le $date) { $l.FullName Remove-Item $l.FullName -Recurse } } Filehash Get-Filehash -Algorithm SHA256 \"$env:USERPROFILE\\Documents\\RSA.conf.txt\" Microsoft.PowerShell.Archive Compress-Archive -Path $sourcepath -DestinationPath $dstpath -CompressionLevel Optimal \u0430\u0440\u0445\u0438\u0432\u0438\u0440\u043e\u0432\u0430\u0442\u044c \\ Expand-Archive .\\powerlinefonts.zip \u0440\u0430\u0437\u0430\u0440\u0445\u0438\u0432\u0438\u0440\u043e\u0432\u0430\u0442\u044c Credential $Cred = Get-Credential \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u0442 \u043a\u0440\u0435\u0434\u044b \u0432 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 $Cred.Username \u0438 $Cred.Password \\ $Cred.GetNetworkCredential().password \u0438\u0437\u0432\u043b\u0435\u0447\u044c \u043f\u0430\u0440\u043e\u043b\u044c \\ cmdkey /generic:\"TERMSRV/$srv\" /user:\"$username\" /pass:\"$password\" \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u0435 \u043a\u0440\u0435\u0434\u044b \u0430\u0443\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438 \u043d\u0430 \u043d\u0430 \u0442\u0435\u0440\u043c\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u0439 \u0441\u0435\u0440\u0432\u0435\u0440 \u0434\u043b\u044f \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u0431\u0435\u0437 \u043f\u0430\u0440\u043e\u043b\u044f \\ mstsc /admin /v:$srv \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f \\ cmdkey /delete:\"TERMSRV/$srv\" \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u043d\u044b\u0435 \u043a\u0440\u0435\u0434\u044b \u0430\u0443\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438 \u0438\u0437 \u0441\u0438\u0441\u0442\u0435\u043c\u044b \\ rundll32.exe keymgr.dll,KRShowKeyMgr \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435 Stored User Names and Password \\ Get-Service VaultSvc \u0441\u043b\u0443\u0436\u0431\u0430 \u0434\u043b\u044f \u0440\u0430\u0431\u043e\u0442\u044b Credential Manager \\ Install-Module CredentialManager \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043c\u043e\u0434\u0443\u043b\u044c \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u044f Credential Manager \u043a \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0443 PasswordVault \u0438\u0437 PowerShell \\ [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.SecurityProtocolType]'Tls11,Tls12' \u0434\u043b\u044f \u0443\u0441\u0442\u0430\u043d\u043e\u043a\u0438 \u043c\u043e\u0434\u0443\u043b\u044f \\ Get-StoredCredential \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0443\u0447\u0435\u0442\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0438\u0437 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0430 Windows Vault \\ Get-StrongPassword \u0433\u0435\u043d\u0435\u0440\u0430\u0442\u043e\u0440 \u043f\u0430\u0440\u043e\u043b\u044f \\ New-StoredCredential -UserName test -Password \"123456\" \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0443\u0447\u0435\u0442\u043d\u0443\u044e \u0437\u0430\u043f\u0438\u0441\u044c \\ Remove-StoredCredential \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0443\u0447\u0435\u0442\u043d\u0443\u044e \u0437\u0430\u043f\u0438\u0441\u044c \\ $Cred = Get-StoredCredential | where {$_.username -match \"admin\"} \\ $pass = $cred.password \\ $BSTR = [System.Runtime.InteropServices.Marshal]::SecureStringToBSTR($pass) \\ [System.Runtime.InteropServices.Marshal]::PtrToStringAuto($BSTR) Out-Gridview Get-Service -cn $srv | Out-GridView -Title \"Service $srv\" -OutputMode Single \u2013PassThru | Restart-Service \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u0443\u044e \u0441\u043b\u0443\u0436\u0431\u0443 Out-File Read-Host \u2013AsSecureString | ConvertFrom-SecureString | Out-File \"$env:userprofile\\desktop\\password.txt\" \u043f\u0438\u0441\u0430\u0442\u044c \u0432 \u0444\u0430\u0439\u043b. \u041f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \u0432 \u0444\u043e\u0440\u043c\u0430\u0442 SecureString \u0441 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435\u043c \u0448\u0438\u0444\u0440\u043e\u0432\u0430\u043d\u0438\u044f Windows Data Protection API (DPAPI) Get-Content (gc/cat/type) $password = gc \"$env:userprofile\\desktop\\password.txt\" | ConvertTo-SecureString \u0447\u0438\u0442\u0430\u0442\u044c \u0445\u044d\u0448 \u043f\u0430\u0440\u043e\u043b\u044f \u0438\u0437 \u0444\u0430\u0439\u043b\u0430 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u043a\u043b\u044e\u0447\u0435\u0439, \u0445\u0440\u0430\u043d\u044f\u0449\u0438\u0445\u0441\u044f \u0432 \u043f\u0440\u043e\u0444\u0438\u043b\u0435 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u0442\u044c \u043d\u0430 \u0434\u0440\u0443\u0433\u043e\u043c \u043a\u043e\u043f\u044c\u044e\u0442\u0435\u0440\u0435 AES Key $AESKey = New-Object Byte[] 32 \\ [Security.Cryptography.RNGCryptoServiceProvider]::Create().GetBytes($AESKey) \\ $AESKey | Out-File \"C:\\password.key\" \\ $Cred.Password | ConvertFrom-SecureString -Key (Get-Content \"C:\\password.key\") | Set-Content \"C:\\password.txt\" \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \u0432 \u0444\u0430\u0439\u043b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044f \u0432\u043d\u0435\u0448\u043d\u0438\u0439 \u043a\u043b\u044e\u0447 \\ $pass = Get-Content \"C:\\password.txt\" | ConvertTo-SecureString -Key (Get-Content \"\\\\Server\\Share\\password.key\") \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \u043d\u0430 \u0432\u0442\u043e\u0440\u043e\u043c \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0435 WinEvent Get-WinEvent -ListLog * \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u0436\u0443\u0440\u043d\u0430\u043b\u044b \u043b\u043e\u0433\u043e\u0432 \\ Get-WinEvent -ListLog * | where RecordCount -ne 0 | where RecordCount -ne $null | sort -Descending RecordCount \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043d\u0435 \u043f\u0443\u0441\u0442\u044b\u0435 \u0436\u0443\u0440\u043d\u0430\u043b\u044b \u0441 \u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u043e\u0439 \u043f\u043e \u043a\u043e\u043b-\u0432\u0443 \u0437\u0430\u043f\u0438\u0441\u0435\u0439 \\ Get-WinEvent -ListProvider * | ft \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435\u0445 \u043f\u0440\u043e\u0432\u0430\u0439\u0434\u0435\u0440\u043e\u0432 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0439 \\ Get-WinEvent -ListProvider GroupPolicy \u043d\u0430\u0439\u0442\u0438 \u0432 \u043a\u0430\u043a\u043e\u0439 \u0436\u0443\u0440\u043d\u0430\u043b LogLinks {Application} \u043f\u0438\u0448\u0443\u0442\u0441\u044f \u043b\u043e\u0433\u0438 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f \\ Get-WinEvent -ListProvider *smb* \\ Get-WinEvent -ListLog * | where logname -match SMB | sort -Descending RecordCount \u043d\u0430\u0439\u0442\u0438 \u0432\u0441\u0435 \u0436\u0443\u0440\u043d\u0430\u043b\u044b \u043f\u043e \u0438\u043c\u0435\u043d\u0438 \\ Get-WinEvent -LogName \"Microsoft-Windows-SmbClient/Connectivity\" \\ Get-WinEvent -ListProvider *firewall* Filter XPath/Hashtable Get-WinEvent -FilterHashtable @{LogName=\"Security\";ID=4624} \u043d\u0430\u0439\u0442\u0438 \u043b\u043e\u0433\u0438 \u043f\u043e ID \u0432 \u0436\u0443\u0440\u043d\u0430\u043b\u0435 Security \\ Get-WinEvent -FilterHashtable @{LogName=\"System\";Level=2} \u043d\u0430\u0439\u0442\u0438 \u0432\u0441\u0435 \u0437\u0430\u043f\u0438\u0441\u0438 \u043e\u0448\u0438\u0431\u043a\u0438 (1 - \u043a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439, 3 - \u043f\u0440\u0435\u0434\u0443\u043f\u0440\u0435\u0436\u0434\u0435\u043d\u0438\u0435, 4 - \u0441\u0432\u0435\u0434\u0435\u043d\u0438\u044f) \\ Get-WinEvent -FilterHashtable @{LogName=\"System\";Level=2;ProviderName=\"Service Control Manager\"} \u043e\u0442\u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u043e \u0438\u043c\u0435\u043d\u0438 \u043f\u0440\u043e\u0432\u0430\u0439\u0434\u0435\u0440\u0430 ([xml](Get-WinEvent -FilterHashtable @{LogName=\"Security\";ID=4688} -MaxEvents 1).ToXml()).Event.EventData.Data \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430, \u0445\u0440\u0430\u043d\u0438\u043c\u044b\u0435 \u0432 EventData (Message) \\ Get-WinEvent -FilterHashtable @{logname=\"security\";ID=4688} -MaxEvents 1 | select timecreated,{$_.Properties[5].value} \u043e\u0442\u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u0440\u0435\u043c\u044f \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u0438 \u0438\u043c\u044f \u0437\u0430\u043f\u0443\u0449\u0435\u043d\u043d\u043e\u0433\u043e \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 $query = ' <QueryList> <Query Id=\"0\" Path=\"Security\"> <Select Path=\"Security\"> *[System[EventID=4688]] and *[EventData[Data[@Name=\"NewProcessName\"]=\"C:\\Windows\\System32\\autochk.exe\" or Data[@Name=\"NewProcessName\"]=\"C:\\Windows\\System32\\services.exe\"]] </Select> </Query> </QueryList> ' Get-WinEvent -LogName Security -FilterXPath $query Reboot $query = ' <QueryList> <Query Id=\"0\" Path=\"System\"> <Select Path=\"System\"> *[ System[ EventID=41 or EventID=1074 or EventID=1076 or EventID=6005 or EventID=6006 or EventID=6008 or EventID=6009 or EventID=6013 ] ] </Select> </Query> </QueryList> ' Get-WinEvent -LogName System -FilterXPath $query 41 ` \u0421\u0438\u0441\u0442\u0435\u043c\u0430 \u0431\u044b\u043b\u0430 \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d\u0430 \u0431\u0435\u0437 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e\u0433\u043e \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044f \u0440\u0430\u0431\u043e\u0442\u044b. 1074` \u0421\u0438\u0441\u0442\u0435\u043c\u0430 \u0431\u044b\u043b\u0430 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e\u0433\u043e \u0432\u044b\u043a\u043b\u044e\u0447\u0435\u043d\u0430 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u043c \u0438\u043b\u0438 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u043c. 1076` \u0421\u043b\u0435\u0434\u0443\u0435\u0442 \u0437\u0430 Event ID 6008 \u0438 \u043e\u0437\u043d\u0430\u0447\u0430\u0435\u0442, \u0447\u0442\u043e \u043f\u0435\u0440\u0432\u044b\u0439 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c (\u0441 \u043f\u0440\u0430\u0432\u043e\u043c \u0432\u044b\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u0441\u0438\u0441\u0442\u0435\u043c\u044b) \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0432\u0448\u0438\u0439\u0441\u044f \u043a \u0441\u0435\u0440\u0432\u0435\u0440\u0443 \u043f\u043e\u0441\u043b\u0435 \u043d\u0435\u043e\u0436\u0438\u0434\u0430\u043d\u043d\u043e\u0439 \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0438\u043b\u0438 \u0432\u044b\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f, \u0443\u043a\u0430\u0437\u0430\u043b \u043f\u0440\u0438\u0447\u0438\u043d\u0443 \u044d\u0442\u043e\u0433\u043e \u0441\u043e\u0431\u044b\u0442\u0438\u044f. 6005` \u0417\u0430\u043f\u0443\u0441\u043a \"\u0416\u0443\u0440\u043d\u0430\u043b\u0430 \u0441\u043e\u0431\u044b\u0442\u0438\u0439 Windows\" (Event Log). \u0423\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442 \u043d\u0430 \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u0441\u0438\u0441\u0442\u0435\u043c\u044b. 6006` \u041e\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 \u00ab\u0416\u0443\u0440\u043d\u0430\u043b\u0430 \u0441\u043e\u0431\u044b\u0442\u0438\u0439 Windows\u00bb. \u0423\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442 \u043d\u0430 \u0432\u044b\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u0441\u0438\u0441\u0442\u0435\u043c\u044b. 6008` \u041f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0435\u0435 \u0432\u044b\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u0441\u0438\u0441\u0442\u0435\u043c\u044b \u0431\u044b\u043b\u043e \u043d\u0435\u043e\u0436\u0438\u0434\u0430\u043d\u043d\u044b\u043c. 6009` \u0412\u0435\u0440\u0441\u0438\u044f \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u043e\u0439 \u0441\u0438\u0441\u0442\u0435\u043c\u044b, \u0437\u0430\u0444\u0438\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u0430\u044f \u043f\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0435 \u0441\u0438\u0441\u0442\u0435\u043c\u044b. 6013` \u0412\u0440\u0435\u043c\u044f \u0440\u0430\u0431\u043e\u0442\u044b \u0441\u0438\u0441\u0442\u0435\u043c\u044b (system uptime) \u0432 \u0441\u0435\u043a\u0443\u043d\u0434\u0430\u0445. Logon $srv = \"localhost\" $FilterXPath = '<QueryList><Query Id=\"0\"><Select>*[System[EventID=21]]</Select></Query></QueryList>' $RDPAuths = Get-WinEvent -ComputerName $srv -LogName \"Microsoft-Windows-TerminalServices-LocalSessionManager/Operational\" -FilterXPath $FilterXPath [xml[]]$xml = $RDPAuths | Foreach {$_.ToXml()} $EventData = Foreach ($event in $xml.Event) { New-Object PSObject -Property @{ \"Connection Time\" = (Get-Date ($event.System.TimeCreated.SystemTime) -Format 'yyyy-MM-dd hh:mm K') \"User Name\" = $event.UserData.EventXML.User \"User ID\" = $event.UserData.EventXML.SessionID \"User Address\" = $event.UserData.EventXML.Address \"Event ID\" = $event.System.EventID }} $EventData | ft EventLog Get-EventLog -List \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u043a\u043e\u0440\u043d\u0435\u0432\u044b\u0435 \u0436\u0443\u0440\u043d\u0430\u043b\u044b \u043b\u043e\u0433\u043e\u0432 \u0438 \u0438\u0445 \u0440\u0430\u0437\u043c\u0435\u0440 \\ Clear-EventLog Application \u043e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u043b\u043e\u0433\u0438 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0433\u043e \u0436\u0443\u0440\u043d\u0430\u043b\u0430 \\ Get-EventLog -LogName Security -InstanceId 4624 \u043d\u0430\u0439\u0442\u0438 \u043b\u043e\u0433\u0438 \u043f\u043e ID \u0432 \u0436\u0443\u0440\u043d\u0430\u043b\u0435 Security Firewall $days = 5 $obj = @() $fw = Get-WinEvent \"Microsoft-Windows-Windows Firewall With Advanced Security/Firewall\" foreach ($temp_fw in $fw) { if ($temp_fw.id -eq 2097) { # 2004 $type = \"Added Rule\" } elseif ($temp_fw.id -eq 2006) { $type = \"Deleted Rule\" } $port = $temp_fw.Properties[7] | select -ExpandProperty value $name = $temp_fw.Properties[1] | select -ExpandProperty value $obj += [PSCustomObject]@{ Time = $temp_fw.TimeCreated; Type = $type; Port = $port; Name = $name} } $obj | Where-Object time -gt (Get-Date).AddDays(-$days) New-NetFirewallRule -Profile Any -DisplayName \"Open Port 135 RPC\" -Direction Inbound -Protocol TCP -LocalPort 135 \u043e\u0442\u043a\u0440\u044b\u0442\u044c in-\u043f\u043e\u0440\u0442 \\ Get-NetFirewallRule | where DisplayName -match kms | select * \u043d\u0430\u0439\u0442\u0438 \u043f\u0440\u0430\u0432\u0438\u043b\u043e \u043f\u043e \u0438\u043c\u0435\u043d\u0438 \\ Get-NetFirewallPortFilter | where LocalPort -like 80 \u043d\u0430\u0439\u0442\u0438 \u0434\u0435\u0439\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u043f\u0440\u0430\u0432\u0438\u043b\u043e \u043f\u043e \u043d\u043e\u043c\u0435\u0440\u0443 \u043f\u043e\u0440\u0442\u0430 Get-NetFirewallRule -Enabled True -Direction Inbound | select -Property DisplayName, @{Name='Protocol';Expression={($_ | Get-NetFirewallPortFilter).Protocol}}, @{Name='LocalPort';Expression={($_ | Get-NetFirewallPortFilter).LocalPort}}, @{Name='RemotePort';Expression={($_ | Get-NetFirewallPortFilter).RemotePort}}, @{Name='RemoteAddress';Expression={($_ | Get-NetFirewallAddressFilter).RemoteAddress}}, Enabled,Profile Firewall-Manager Install-Module Firewall-Manager \\ Export-FirewallRules -Name * -CSVFile $home\\documents\\fw.csv -Inbound -Outbound -Enabled -Disabled -Allow -Block (\u0444\u0438\u043b\u044c\u0442\u0440 \u043f\u0440\u0430\u0432\u0438\u043b \u0434\u043b\u044f \u044d\u043a\u0441\u043f\u043e\u0440\u0442\u0430) \\ Import-FirewallRules -CSVFile $home\\documents\\fw.csv Defender Import-Module Defender \\ Get-Command -Module Defender \\ Get-MpComputerStatus \\ (Get-MpComputerStatus).AntivirusEnabled \u0441\u0442\u0430\u0442\u0443\u0441 \u0440\u0430\u0431\u043e\u0442\u044b \u0430\u043d\u0442\u0438\u0432\u0438\u0440\u0443\u0441\u0430 $session = NewCimSession -ComputerName hostname \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f \u043a \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u043e\u043c\u0443 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0443, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f WinRM \\ Get-MpComputerStatus -CimSession $session | fl fullscan* \u0443\u0437\u043d\u0430\u0442\u044c \u0434\u0430\u0442\u0443 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u043d\u0430 \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u043e\u043c \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0435 Get-MpPreference \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \\ (Get-MpPreference).ScanPurgeItemsAfterDelay \u0432\u0440\u0435\u043c\u044f \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0437\u0430\u043f\u0438\u0441\u0435\u0439 \u0436\u0443\u0440\u043d\u0430\u043b\u0430 \u0437\u0430\u0449\u0438\u0442\u043d\u0438\u043a\u0430 \u0432 \u0434\u043d\u044f\u0445 \\ Set-MpPreference -ScanPurgeItemsAfterDelay 30 \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0432\u0440\u0435\u043c\u044f \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \\ ls \"C:\\ProgramData\\Microsoft\\Windows Defender\\Scans\\History\" \\ Get-MpPreference | select disable* \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u0442\u0430\u0442\u0443\u0441 \u0432\u0441\u0435\u0445 \u0432\u0438\u0434\u043e\u0432 \u043f\u0440\u043e\u0432\u0435\u0440\u043e\u043a/\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0439 \\ Set-MpPreference -DisableRealtimeMonitoring $true \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0437\u0430\u0449\u0438\u0442\u0443 Defender \u0432 \u0440\u0435\u0430\u043b\u044c\u043d\u043e\u043c \u0432\u0440\u0435\u043c\u0435\u043d\u0438 (\u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0440\u0443\u0447\u043d\u043e\u0435 \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435) \\ Set-MpPreference -DisableRemovableDriveScanning $false \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 USB \u043d\u0430\u043a\u043e\u043f\u0438\u0442\u0435\u043b\u0435\u0439 \\ Get-MpPreference | select excl* \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u0438\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0439 \\ (Get-MpPreference).ExclusionPath \\ Add-MpPreference -ExclusionPath C:\\install \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u044e \u0432 \u0438\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \\ Remove-MpPreference -ExclusionPath C:\\install \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0438\u0437 \u0438\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \\ New-ItemProperty -Path \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\" -Name DisableAntiSpyware -Value 1 -PropertyType DWORD -Force \u043f\u043e\u043b\u043d\u043e\u0441\u0442\u044c\u044e \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c Windows Defender Set-MpPreference -SignatureDefinitionUpdateFileSharesSources \\\\FileShare1\\Updates \u0434\u043b\u044f \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0438\u0437 \u0441\u0435\u0442\u0435\u0432\u043e\u0439 \u043f\u0430\u043f\u043a\u0438 \u043d\u0443\u0436\u043d\u043e \u043f\u0440\u0435\u0434\u0432\u0430\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0441\u043a\u0430\u0447\u0430\u0442\u044c \u0444\u0430\u0439\u043b\u044b \u0441 \u0441\u0438\u0433\u043d\u0430\u0442\u0443\u0440\u0430\u043c\u0438 \u0431\u0430\u0437 \u0441 \u0441\u0430\u0439\u0442\u0430 https://www.microsoft.com/security/portal/definitions/adl.aspx \u0438 \u043f\u043e\u043c\u0435\u0441\u0442\u0438\u0442\u044c \u0432 \u0441\u0435\u0442\u0435\u0432\u043e\u0439 \u043a\u0430\u0442\u0430\u043b\u043e\u0433 Update-MpSignature -UpdateSource FileShares \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0439 (MicrosoftUpdateServer \u2013 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0439 MS \u0432 \u0438\u043d\u0442\u0435\u0440\u043d\u0435\u0442\u0435, InternalDefinitionUpdateServer \u2014 \u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u0438\u0439 WSUS \u0441\u0435\u0440\u0432\u0435\u0440) \\ Update-MpSignature \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0441\u0438\u0433\u043d\u0430\u0442\u0443\u0440\u044b Start-MpScan -ScanType QuickScan \u0431\u044b\u0441\u0442\u0440\u0430\u044f \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0438\u043b\u0438 FullScan \\ Start-MpScan -ScanType FullScan -AsJob \\ Set-MpPreference -RemediationScheduleDay 1-7 \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0434\u043d\u0438, \u043d\u0430\u0447\u0438\u043d\u0430\u044f \u0441 \u0432\u043e\u0441\u043a\u0440\u0435\u0441\u0435\u043d\u044c\u044f \u0438\u043b\u0438 0 \u043a\u0430\u0436\u0434\u044b\u0439 \u0434\u0435\u043d\u044c, 8 - \u0441\u0431\u0440\u043e\u0441\u0438\u0442\u044c \\ Set-MpPreference -ScanScheduleQuickScanTime 14:00:00 \\ Start-MpScan -ScanType CustomScan -ScanPath \"C:\\Program Files\" \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u0443\u044e \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u044e Get-MpThreat \u0438\u0441\u0442\u043e\u0440\u0438\u044f \u0443\u0433\u0440\u043e\u0437 \u0438 \u0442\u0438\u043f \u0443\u0433\u0440\u043e\u0437\u044b (ThreatName: HackTool/Trojan) \\ Get-MpThreatCatalog \u0441\u043f\u0438\u0441\u043e\u043a \u0438\u0437\u0432\u0435\u0441\u0442\u043d\u044b\u0445 \u0432\u0438\u0434\u043e\u0432 \u0443\u0433\u0440\u043e\u0437 \\ Get-MpThreatDetection \u0438\u0441\u0442\u043e\u0440\u0438\u044f \u0437\u0430\u0449\u0438\u0442\u044b (\u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0445 \u0438 \u043f\u0440\u043e\u0448\u043b\u044b\u0435) \u0438 ID \u0443\u0433\u0440\u043e\u0437\u044b \\ Get-MpThreat -ThreatID 2147760253 ls \"C:\\ProgramData\\Microsoft\\Windows Defender\\Quarantine\\\" \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u044f \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0444\u0430\u0439\u043b\u043e\u0432 \u0432 \u043a\u0430\u0440\u0430\u043d\u0442\u0438\u043d\u0435 \\ cd \"C:\\Program Files\\Windows Defender\\\" \\ .\\MpCmdRun.exe -restore -name $ThreatName \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0444\u0430\u0439\u043b \u0438\u0437 \u043a\u0430\u0440\u0430\u043d\u0442\u0438\u043d\u0430 \\ .\\MpCmdRun.exe -restore -filepath $path_file WindowsUpdate Get-Hotfix | Sort-Object -Descending InstalledOn \u0441\u043f\u0438\u0441\u043e\u043a \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044b\u0445 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0439 (\u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u0438\u0437 cimv2) \\ Get-Hotfix -Description \"Security update\" \\ Get-CimInstance Win32_QuickFixEngineering \\ Get-Command -Module WindowsUpdate \\ Get-WindowsUpdateLog \\ Get-Service uhssvc \u0441\u043b\u0443\u0436\u0431\u0430 Microsoft Health Update Tools, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442 \u0437\u0430 \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0439 Install-Module -Name PSWindowsUpdate -Scope CurrentUser \\ Import-Module PSWindowsUpdate \\ Get-Command -Module PSWindowsUpdate \\ Get-WindowsUpdate \u0441\u043f\u0438\u0441\u043e\u043a \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0439 \u0434\u043b\u044f \u0441\u043a\u0430\u0447\u0430\u0442\u044c \u0438 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 WSUS \u0438\u043b\u0438 Microsoft Update \\ Get-WindowsUpdate -Download \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \\ Get-WindowsUpdate \u2013Install \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0432\u0441\u0435 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \\ Install-WindowsUpdate -MicrosoftUpdate -AcceptAll -IgnoreReboot \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0432\u0441\u0435 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0431\u0435\u0437 \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \\ Get-WindowsUpdate -KBArticleID KB2267602, KB4533002 -Install \\ Get-WindowsUpdate -KBArticleID KB2538243 -Hide \u0441\u043a\u0440\u044b\u0442\u044c \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f, \u0447\u0442\u043e \u0431\u044b \u043e\u043d\u0438 \u043d\u0438\u043a\u043e\u0433\u0434\u0430 \u043d\u0435 \u0443\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u043b\u0438\u0441\u044c \\ Get-WindowsUpdate \u2013IsHidden \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043a\u0440\u044b\u0442\u044b\u0435 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f (Hide-WindowsUpdate) \\ Remove-WindowsUpdate -KBArticleID KB4011634 -NoRestart \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \\ Uninstall-WindowsUpdate \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \\ Add-WUServiceManager \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f (Windows Update Service Manager) \\ Enable-WURemoting \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043f\u0440\u0430\u0432\u0438\u043b\u0430 Windows Defender, \u0440\u0430\u0437\u0440\u0435\u0448\u0430\u044e\u0449\u0438\u0435 \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u043e\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u043a\u043e\u043c\u0430\u043d\u0434\u043b\u0435\u0442\u0430 PSWindowsUpdate \\ Get-WUApiVersion \u0432\u0435\u0440\u0441\u0438\u044f Windows Update Agent \\ Get-WUHistory \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044b\u0445 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0439 (\u0438\u0441\u0442\u043e\u0440\u0438\u044f \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0439) \\ Get-WUHistory | Where-Object {$_.Title -match \"KB4517389\"} \u043f\u043e\u0438\u0441\u043a \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \\ Get-WULastResults \u0434\u0430\u0442\u044b \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u043f\u043e\u0438\u0441\u043a\u0430 \u0438 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0439 \\ Get-WURebootStatus \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c, \u043d\u0443\u0436\u043d\u0430 \u043b\u0438 \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0434\u043b\u044f \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0433\u043e \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \\ Get-WUServiceManager \u0432\u044b\u0432\u043e\u0434\u0438\u0442 \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u0438 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0439 \\ Get-WUInstallerStatus \u0441\u0442\u0430\u0442\u0443\u0441 \u0441\u043b\u0443\u0436\u0431\u044b Windows Installer \\ Remove-WUServiceManager \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c Windows Update Service Manager DISM Get-Command -Module Dism -Name *Driver* \\ Export-WindowsDriver -Online -Destination C:\\Users\\Lifailon\\Documents\\Drivers\\ \u0438\u0437\u0432\u043b\u0435\u0447\u0435\u043d\u0438\u0435 \u0434\u0440\u0430\u0439\u0432\u0435\u0440\u043e\u0432 \u0438\u0437 \u0442\u0435\u043a\u0443\u0449\u0435\u0439 \u0441\u0438\u0441\u0442\u0435\u043c\u044b (C:\\Windows\\System32\\DriverStore\\FileRepository), \u0432\u044b\u0433\u0440\u0443\u0436\u0430\u0435\u0442 \u0441\u043f\u0438\u0441\u043e\u043a \u0444\u0430\u0439\u043b\u043e\u0432, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u044b \u0434\u043b\u044f \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \u0434\u0440\u0430\u0439\u0432\u0435\u0440\u0430 (dll,sys,exe) \u0432 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0438 \u0441\u043e \u0441\u043f\u0438\u0441\u043a\u043e\u043c \u0444\u0430\u0439\u043b\u043e\u0432, \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u0445 \u0432 \u0441\u0435\u043a\u0446\u0438\u0438 [CopyFiles] inf-\u0444\u0430\u0439\u043b\u0430 \u0434\u0440\u0430\u0439\u0432\u0435\u0440\u0430. \\ Export-WindowsDriver -Path C:\\win_image -Destination C:\\drivers \u0438\u0437\u0432\u043b\u0435\u0447\u044c \u0434\u0440\u0430\u0439\u0432\u0435\u0440\u0430 \u0438\u0437 \u043e\u0444\u043b\u0430\u0439\u043d \u043e\u0431\u0440\u0430\u0437\u0430 Windows, \u0441\u043c\u043e\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0433\u043e \u0432 \u043a\u0430\u0442\u0430\u043b\u043e\u0433 c:\\win_image \\ $BackupDrivers = Export-WindowsDriver -Online -Destination C:\\Drivers \\ $BackupDrivers | ft Driver,ClassName,ProviderName,Date,Version,ClassDescription \u0441\u043f\u0438\u0441\u043e\u043a \u0434\u0440\u0430\u0439\u0432\u0435\u0440\u043e\u0432 \u0432 \u043e\u0431\u044a\u0435\u043a\u0442\u043d\u043e\u043c \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0438 \\ $BackupDrivers | where classname -match printer \\ pnputil.exe /add-driver C:\\drivers\\*.inf /subdirs /install \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0432\u0441\u0435 (\u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 subdirs) \u0434\u0440\u0430\u0439\u0432\u0435\u0440\u0430 \u0438\u0437 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0439 \u043f\u0430\u043f\u043a\u0438 (\u0432\u043a\u043b\u044e\u0447\u0430\u044f \u0432\u043b\u043e\u0436\u0435\u043d\u043d\u044b\u0435) sfc /scannow \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0446\u0435\u043b\u043e\u0441\u0442\u043d\u043e\u0441\u0442\u044c \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u044b\u0445 \u0444\u0430\u0439\u043b\u043e\u0432 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0443\u0442\u0438\u043b\u0438\u0442\u044b SFC (System File Checker), \u0432 \u0441\u043b\u0443\u0447\u0430\u0435 \u043f\u043e\u0438\u0441\u043a\u0430 \u043e\u0448\u0438\u0431\u043e\u043a, \u043f\u043e\u043f\u0440\u043e\u0431\u0443\u0435\u0442 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0438\u0445 \u043e\u0440\u0438\u0433\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u0435 \u043a\u043e\u043f\u0438\u0438 \u0438\u0437 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0430 \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u044b\u0445 \u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u043e\u0432 Windows (\u043a\u0430\u0442\u0430\u043b\u043e\u0433 C:\\Windows\\WinSxS). \u0412\u044b\u0432\u043e\u0434 \u0440\u0430\u0431\u043e\u0442\u044b \u043b\u043e\u0433\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u0432 C:\\Windows\\Logs\\CBS \u0441 \u0442\u0435\u0433\u043e\u043c SR \\ Get-ComputerInfo | select * \u043f\u043e\u0434\u0440\u043e\u0431\u043d\u0430\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043e \u0441\u0438\u0441\u0442\u0435\u043c\u0435 (WindowsVersion,WindowsEditionId, Bios ) \\ Get-WindowsImage -ImagePath E:\\sources\\install.wim \u0441\u043f\u0438\u0441\u043e\u043a \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0445 \u0432\u0435\u0440\u0441\u0438\u0439 \u0432 \u043e\u0431\u0440\u0430\u0437\u0435 \\ Repair-WindowsImage -Online \u2013ScanHealth \\ Repair-WindowsImage -Online -RestoreHealth \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0430 \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u044b\u0445 \u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u043e\u0432 \\ Repair-WindowsImage -Online -RestoreHealth -Source E:\\sources\\install.wim:3 \u2013LimitAccess \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0432 \u043e\u0444\u0444\u043b\u0430\u0439\u043d \u0440\u0435\u0436\u0438\u043c\u0435 \u0438\u0437 \u043e\u0431\u0440\u0430\u0437\u0430 \u043f\u043e \u043d\u043e\u043c\u0435\u0440\u0443 \u0438\u043d\u0434\u0435\u043a\u0441\u0430 Scheduled $Trigger = New-ScheduledTaskTrigger -At 01:00am -Daily 1:00 \u043d\u043e\u0447\u0438 \\ $Trigger = New-ScheduledTaskTrigger \u2013AtLogon \u0437\u0430\u043f\u0443\u0441\u043a \u043f\u0440\u0438 \u0432\u0445\u043e\u0434\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0443 \\ $Trigger = New-ScheduledTaskTrigger -AtStartup \u043f\u0440\u0438 \u0437\u0430\u043f\u0443\u0441\u043a\u0435 \u0441\u0438\u0441\u0442\u0435\u043c\u044b \\ $User = \"NT AUTHORITY\\SYSTEM\" \\ $Action = New-ScheduledTaskAction -Execute \"PowerShell.exe\" -Argument \"$home\\Documents\\DNS-Change-Tray-1.3.ps1\" \\ $Action = New-ScheduledTaskAction -Execute \"PowerShell.exe\" -Argument \"-NoProfile -NoLogo -NonInteractive -ExecutionPolicy Unrestricted -WindowStyle Hidden -File $home\\Documents\\DNS-Change-Tray-1.3.ps1\" \\ Register-ScheduledTask -TaskName \"DNS-Change-Tray-Startup\" -Trigger $Trigger -User $User -Action $Action -RunLevel Highest \u2013Force Get-ScheduledTask | ? state -ne Disabled \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0445 \u0437\u0430\u0434\u0430\u043d\u0438\u0439 \\ Start-ScheduledTask DNS-Change-Tray-Startup \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0437\u0430\u0434\u0430\u043d\u0438\u0435 \u043d\u0435\u043c\u0435\u0434\u043b\u0435\u043d\u043d\u043e \\ Get-ScheduledTask DNS-Change-Tray-Startup | Disable-ScheduledTask \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0437\u0430\u0434\u0430\u043d\u0438\u0435 \\ Get-ScheduledTask DNS-Change-Tray-Startup | Enable-ScheduledTask \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0437\u0430\u0434\u0430\u043d\u0438\u0435 \\ Unregister-ScheduledTask DNS-Change-Tray-Startup \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0437\u0430\u0434\u0430\u043d\u0438\u0435 \\ Export-ScheduledTask DNS-Change-Tray-Startup | Out-File $home\\Desktop\\Task-Export-Startup.xml \u044d\u043a\u0441\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0437\u0430\u0434\u0430\u043d\u0438\u0435 \u0432 xml \\ Register-ScheduledTask -Xml (Get-Content $home\\Desktop\\Task-Export-Startup.xml | Out-String) -TaskName \"DNS-Change-Tray-Startup\" Network ping Test-Connection -Count 1 $srv1, $srv2 \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c icmp-\u043f\u0430\u043a\u0435\u0442 \u0434\u0432\u0443\u043c \u0445\u043e\u0441\u0442\u0430\u043c \\ Test-Connection $srv -ErrorAction SilentlyContinue \u043d\u0435 \u0432\u044b\u0432\u043e\u0434\u0438\u0442\u044c \u043e\u0448\u0438\u0431\u043e\u043a, \u0435\u0441\u043b\u0438 \u0445\u043e\u0441\u0442 \u043d\u0435 \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442 \\ Test-Connection -Source $srv1 -ComputerName $srv2 \u043f\u0438\u043d\u0433 \u0441 \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u043e\u0433\u043e \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0430 function Test-PingNetwork { param ( [Parameter(Mandatory,ValueFromPipeline)][string[]]$Network, [ValidateRange(100,10000)][int]$Timeout = 100 ) $ping = New-Object System.Net.NetworkInformation.Ping $Network = $Network -replace \"0$\" $net = @() foreach ($r in @(1..254)) { $net += \"$network$r\" } foreach ($n in $net) { $ping.Send($n, $timeout) | select @{Name=\"Address\"; Expression={$n -replace \".+\\.\"}}, Status } } Test-PingNetwork -Network 192.168.3.0 \\ Test-PingNetwork -Network 192.168.3.0 -Timeout 1000 Get-CimInstance -Class Win32_PingStatus -Filter \"Address='127.0.0.1'\" \\ Get-CimInstance -Class Win32_PingStatus -Filter \"Address='127.0.0.1'\" | Format-Table -Property Address,ResponseTime,StatusCode -Autosize 0 - \u0443\u0441\u043f\u0435\u0445 \\ '127.0.0.1','8.8.8.8' | ForEach-Object -Process {Get-CimInstance -Class Win32_PingStatus -Filter (\"Address='$_'\") | Select-Object -Property Address,ResponseTime,StatusCode} \\ $ips = 1..254 | ForEach-Object -Process {'192.168.1.' + $_} \u0441\u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043c\u0430\u0441\u0441\u0438\u0432 \u0438\u0437 ip-\u0430\u0434\u0440\u0435\u0441\u043e\u0432 \u043f\u043e\u0434\u0441\u0435\u0442\u0438 dhcp Get-CimInstance -Class Win32_NetworkAdapterConfiguration -Filter \"DHCPEnabled=$true\" \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0430\u0434\u0430\u043f\u0442\u0435\u0440\u044b \u0441 \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u043d\u044b\u043c DHCP \\ $wql = 'SELECT * from Win32_NetworkAdapterConfiguration WHERE IPEnabled=True and DHCPEnabled=False' \\ Invoke-CimMethod -MethodName ReleaseDHCPLease -Query $wql \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 DHCP \u043d\u0430 \u0432\u0441\u0435\u0445 \u0430\u0434\u0430\u043f\u0442\u0435\u0440\u0430\u0445 \\ Invoke-CimMethod -ClassName Win32_NetworkAdapterConfiguration -MethodName ReleaseDHCPLeaseAll \u043e\u0442\u043c\u0435\u043d\u0438\u0442\u044c \u0430\u0440\u0435\u043d\u0434\u0443 \u0430\u0434\u0440\u0435\u0441\u043e\u0432 DHCP \u043d\u0430 \u0432\u0441\u0435\u0445 \u0430\u0434\u0430\u043f\u0442\u0435\u0440\u0430\u0445 \\ Invoke-CimMethod -ClassName Win32_NetworkAdapterConfiguration -MethodName RenewDHCPLeaseAll \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0430\u0440\u0435\u043d\u0434\u0443 \u0430\u0434\u0440\u0435\u0441\u043e\u0432 DHCP \u043d\u0430 \u0432\u0441\u0435\u0445 \u0430\u0434\u0430\u043f\u0442\u0435\u0440\u0430\u0445 port tnc $srv -p 5985 \\ tnc $srv -CommonTCPPort WINRM HTTP,RDP,SMB \\ tnc ya.ru \u2013TraceRoute -Hops 2 TTL=2 \\ tnc ya.ru -DiagnoseRouting \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0430\u0446\u0438\u044f \u0434\u043e \u0445\u043e\u0441\u0442\u0430, \u043a\u0443\u0434\u0430 (DestinationPrefix: 0.0.0.0/0) \u0447\u0435\u0440\u0435\u0437 (NextHop: 192.168.1.254) nslookup nslookup ya.ru 1.1.1.1 \u0441 \u0443\u043a\u0430\u0437\u0430\u043d\u0438\u0435\u043c DNS \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \\ nslookup -type=any ya.ru \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u0442\u0438\u043f \u0437\u0430\u043f\u0438\u0441\u0438 \\ Resolve-DnsName ya.ru -Type MX ALL,ANY,A,NS,SRV,CNAME,PTR,TXT(spf) \\ [System.Net.Dns]::GetHostEntry(\"ya.ru\") ipconfig Get-NetIPConfiguration \\ Get-NetIPConfiguration -InterfaceIndex 14 -Detailed Adapter Get-NetAdapter \\ Set-NetIPInterface -InterfaceIndex 14 -Dhcp Disabled \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c DHCP \\ Get-NetAdapter -InterfaceIndex 14 | New-NetIPAddress \u2013IPAddress 192.168.3.99 -DefaultGateway 192.168.3.1 -PrefixLength 24 \u0437\u0430\u0434\u0430\u0442\u044c/\u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0441\u0442\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439 IP-\u0430\u0434\u0440\u0435\u0441 \\ Set-NetIPAddress -InterfaceIndex 14 -IPAddress 192.168.3.98 \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c IP-\u0430\u0434\u0440\u0435\u0430\u0441 \u043d\u0430 \u0430\u0434\u0430\u043f\u0442\u0435\u0440\u0435 \\ Remove-NetIPAddress -InterfaceIndex 14 -IPAddress 192.168.3.99 \u0443\u0434\u0430\u043b\u0438\u0442\u044c IP-\u0430\u0434\u0440\u0435\u0441 \u043d\u0430 \u0430\u0434\u0430\u043f\u0442\u0435\u0440\u0435 \\ Set-NetIPInterface -InterfaceIndex 14 -Dhcp Enabled \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c DHCP DNSClient Get-DNSClientServerAddress \\ Set-DNSClientServerAddress -InterfaceIndex 14 -ServerAddresses 8.8.8.8 DNSCache Get-DnsClientCache \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043a\u044d\u0448\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0435 \u0437\u0430\u043f\u0438\u0441\u0438 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 DNS \\ Clear-DnsClientCache \u043e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u043a\u044d\u0448 Binding Get-NetAdapterBinding -Name Ethernet -IncludeHidden -AllBindings \\ Get-NetAdapterBinding -Name \"\u0411\u0435\u0441\u043f\u0440\u043e\u0432\u043e\u0434\u043d\u0430\u044f \u0441\u0435\u0442\u044c\" -DisplayName \"IP \u0432\u0435\u0440\u0441\u0438\u0438 6 (TCP/IPv6)\" | Set-NetAdapterBinding -Enabled $false \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c IPv6 \u043d\u0430 \u0430\u0434\u0430\u043f\u0442\u0435\u0440\u0435 TCPSetting Get-NetTCPSetting \\ Set-NetTCPSetting -SettingName DatacenterCustom,Datacenter -CongestionProvider DCTCP \\ Set-NetTCPSetting -SettingName DatacenterCustom,Datacenter -CwndRestart True \\ Set-NetTCPSetting -SettingName DatacenterCustom,Datacenter -ForceWS Disabled netstat netstat -anop tcp -n/-f/-b \\ Get-NetTCPConnection -State Established,Listen | ? LocalPort -Match 3389 \\ Get-NetTCPConnection -State Established,Listen | ? RemotePort -Match 22 \\ Get-NetUDPEndpoint | ? LocalPort -Match 514 netstat -ap udp` Statistics netstat -se \\ Get-NetAdapterStatistics hostname $env:computername \\ hostname.exe \\ (Get-CIMInstance CIM_ComputerSystem).Name \\ (New-Object -ComObject WScript.Network).ComputerName \\ [System.Environment]::MachineName \\ [System.Net.Dns]::GetHostName() arp ipconfig /all | Select-String \"\u0444\u0438\u0437\" grep \\ Get-NetNeighbor -AddressFamily IPv4 function Get-ARP { Param ( $proxy, $search ) if (!$proxy) { $arp = arp -a } if ($proxy) { $arp = icm $proxy {arp -a} } $mac = $arp[3..260] $mac = $mac -replace \"^\\s\\s\" $mac = $mac -replace \"\\s{1,50}\",\" \" $mac_coll = New-Object System.Collections.Generic.List[System.Object] foreach ($m in $mac) { $smac = $m -split \" \" $mac_coll.Add([PSCustomObject]@{ IP = $smac[0]; MAC = $smac[1]; Type = $smac[2] }) } if ($search) { if ($search -NotMatch \"\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\") { #$ns = nslookup $search #$ns = $ns[-2] #$global:ns = $ns -replace \"Address:\\s{1,10}\" $rdns = Resolve-DnsName $search -ErrorAction Ignore $ns = $rdns.IPAddress if ($ns -eq $null) { return } } else { $ns = $search } $mac_coll = $mac_coll | ? ip -Match $ns } $mac_coll } Get-ARP -search 192.168.3.100 \\ Get-ARP -search 192.168.3.100 -proxy dc-01 RDP Get-ItemProperty -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp\" -Name \"PortNumber\" \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043d\u043e\u043c\u0435\u0440 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e RDP \u043f\u043e\u0440\u0442\u0430 \\ Set-ItemProperty -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp\" -Name \"PortNumber\" -Value \"3390\" \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c RDP-\u043f\u043e\u0440\u0442 \\ $(Get-ItemProperty -Path \"HKLM:\\System\\CurrentControlSet\\Control\\Terminal Server\\\" -Name \"fDenyTSConnections\").fDenyTSConnections \u0435\u0441\u043b\u0438 0, \u0442\u043e \u0432\u043a\u043b\u044e\u0447\u0435\u043d \\ Set-ItemProperty -Path \"HKLM:\\System\\CurrentControlSet\\Control\\Terminal Server\\\" -Name \"fDenyTSConnections\" -Value 0 \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c RDP \\ reg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\" /v fDenyTSConnections /t REG_DWORD /d 0 /f \\ (gcim -Class Win32_TerminalServiceSetting -Namespace root\\CIMV2\\TerminalServices).SetAllowTSConnections(0) \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c RDP (\u0434\u043b\u044f Windows Server) \\ Get-Service TermService | Restart-Service -Force \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c rdp-\u0441\u043b\u0443\u0436\u0431\u0443 \\ New-NetFirewallRule -Profile Any -DisplayName \"RDP 3390\" -Direction Inbound -Protocol TCP -LocalPort 3390 \u043e\u0442\u043a\u0440\u044b\u0442\u044c RDP-\u043f\u043e\u0440\u0442 IPBan auditpol /get /category:* \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u043f\u043e\u043b\u0438\u0442\u0438\u043a\u0438 \u0430\u0443\u0434\u0438\u0442\u0430 \\ auditpol /get /category:\u0412\u0445\u043e\u0434/\u0432\u044b\u0445\u043e\u0434 \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u0435 \u043f\u043e\u043b\u0438\u0442\u0438\u043a\u0438 \u0430\u0443\u0434\u0438\u0442\u0430 \u0434\u043b\u044f \u0412\u0445\u043e\u0434\u0430 \u0438 \u0412\u044b\u0445\u043e\u0434\u0430 \u0438\u0437 \u0441\u0438\u0441\u0442\u0435\u043c\u044b \\ auditpol /set /subcategory:\"\u0412\u0445\u043e\u0434 \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0443\" /success:enable /failure:enable \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u0435 \u043f\u043e\u043b\u0438\u0442\u0438\u043a\u0438 - \u0410\u0443\u0434\u0438\u0442 \u0432\u0445\u043e\u0434\u0430 \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0443 \\ auditpol /set /subcategory:\"\u0412\u044b\u0445\u043e\u0434 \u0438\u0437 \u0441\u0438\u0441\u0442\u0435\u043c\u044b\" /success:enable /failure:enable $url = $($(Invoke-RestMethod https://api.github.com/repos/DigitalRuby/IPBan/releases/latest).assets | Where-Object name -match \".+win.+x64.+\").browser_download_url \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0441\u0441\u044b\u043b\u043a\u0443 \u0434\u043b\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0439 \u0432\u0435\u0440\u0441\u0438\u0438 \\ $version = $(Invoke-RestMethod https://api.github.com/repos/DigitalRuby/IPBan/releases/latest).tag_name \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043d\u043e\u043c\u0435\u0440 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0439 \u0432\u0435\u0440\u0441\u0438\u0438 \\ $path = \"$home\\Documents\\ipban-$version\" \u043f\u0443\u0442\u044c \u0434\u043b\u044f \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \\ Invoke-RestMethod $url -OutFile \"$home\\Downloads\\IPBan-$version.zip\" \u0441\u043a\u0430\u0447\u0430\u0442\u044c \u0434\u0438\u0441\u0442\u0440\u0438\u0431\u0443\u0442\u0438\u0432 \\ Expand-Archive \"$home\\Downloads\\ipban-$version.zip\" -DestinationPath $path \u0440\u0430\u0437\u0430\u0440\u0445\u0438\u0432\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u043f\u0443\u0442\u044c \u0434\u043b\u044f \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \\ Remove-Item \"$home\\Downloads\\ipban-$version.zip\" \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0434\u0438\u0441\u0442\u0440\u0438\u0431\u0443\u0442\u0438\u0432 \\ sc create IPBan type=own start=delayed-auto binPath=\"$path\\DigitalRuby.IPBan.exe\" DisplayName=IPBan \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0441\u043b\u0443\u0436\u0431\u0443 \\ Get-Service IPBan \u0441\u0442\u0430\u0442\u0443\u0441 \u0441\u043b\u0443\u0436\u0431\u044b \\ $conf = $(Get-Content \"$path\\ipban.config\") \u0447\u0438\u0442\u0430\u0435\u043c \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044e \\ $conf = $conf -replace '<add key=\"Whitelist\" value=\"\"/>','<add key=\"Whitelist\" value=\"192.168.3.0/24\"/>' \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u0431\u0435\u043b\u044b\u0439 \u043b\u0438\u0441\u0442 \u0434\u043e\u043c\u0430\u0448\u043d\u044e\u044e \u0441\u0435\u0442\u044c \u0434\u043b\u044f \u0438\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \\ $conf = $conf -replace '<add key=\"ProcessInternalIPAddresses\" value=\"false\"/>','<add key=\"ProcessInternalIPAddresses\" value=\"true\"/>' \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0443 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u0445 (\u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u0438\u0445) ip-\u0430\u0434\u0440\u0435\u0441\u043e\u0432 \\ $conf = $conf -replace '<add key=\"FailedLoginAttemptsBeforeBanUserNameWhitelist\" value=\"20\"/>','<add key=\"FailedLoginAttemptsBeforeBanUserNameWhitelist\" value=\"5\"/>' \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043f\u043e\u043f\u044b\u0442\u043e\u043a \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u0434\u043e \u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u043a\u0438 \\ $conf = $conf -replace '<add key=\"ExpireTime\" value=\"01:00:00:00\"/>','<add key=\"ExpireTime\" value=\"00:01:00:00\"/>' \u0437\u0430\u0434\u0430\u0442\u044c \u0432\u0440\u0435\u043c\u044f \u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u043a\u0438 1 \u0447\u0430\u0441 \\ $conf > \"$path\\ipban.config\" \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044e \\ Get-Service IPBan | Start-Service \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0441\u043b\u0443\u0436\u0431\u0443 Get-NetFirewallRule | Where-Object DisplayName -Match \"IPBan\" | ForEach-Object { $Name = $_.DisplayName Get-NetFirewallAddressFilter -AssociatedNetFirewallRule $_ | Select-Object @{Name=\"Name\"; Expression={$Name}},LocalIP,RemoteIP } # \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043e\u0431\u043b\u0430\u0441\u0442\u044c \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u043f\u0440\u0430\u0432\u0438\u043b \u0411\u0440\u0430\u043d\u0434\u043c\u0430\u0443\u044d\u0440\u0430 \u0434\u043b\u044f IPBan Get-Content -Wait \"$path\\logfile.txt\" \u0447\u0438\u0442\u0430\u0442\u044c \u043b\u043e\u0433 \\ Get-Service IPBan | Stop-Service \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0441\u043b\u0443\u0436\u0431\u0443 \\ sc delete IPBan \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u043b\u0443\u0436\u0431\u0443 shutdown shutdown /r /o \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0432 \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u044b\u0439 \u0440\u0435\u0436\u0438\u043c \\ shutdown /s /t 600 /c \"Power off after 10 minutes\" \u0432\u044b\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \\ shutdown /s /f \u043f\u0440\u0438\u043d\u0443\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0435 \u0437\u0430\u043a\u0440\u044b\u0442\u0438\u0435 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0439 \\ shutdown /a \u043e\u0442\u043c\u0435\u043d\u0430 \\ shutdown /r /t 0 /m \\\\192.168.3.100 \\ Restart-Computer -ComputerName 192.168.3.100 -Protocol WSMan \u0447\u0435\u0440\u0435\u0437 WinRM \\ Restart-Computer \u2013ComputerName 192.168.3.100 \u2013Force \u0447\u0435\u0440\u0435\u0437 WMI \\ Set-ItemProperty -Path \"HKLM:\\SOFTWARE\\Microsoft\\PolicyManager\\default\\Start\\HideShutDown\" -Name \"value\" -Value 1 \u0441\u043a\u0440\u044b\u0442\u044c \u043a\u043d\u043e\u043f\u043a\u0443 \u0432\u044b\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \\ Set-ItemProperty -Path \"HKLM:\\SOFTWARE\\Microsoft\\PolicyManager\\default\\Start\\HideRestart\" -Name \"value\" -Value 1 \u0441\u043a\u0440\u044b\u0442\u044c \u043a\u043d\u043e\u043f\u043a\u0443 \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 function Start-Shutdown { <# .SYNOPSIS Module for shutdown and restart the computer at a specified time .DESCRIPTION Example: # Start-Shutdown -Time \"18:00\" # Start-Shutdown -Restart -Time \"18:00\" # Start-Shutdown -Cancel .LINK https://github.com/Lifailon/PS-Commands #> param( [string]$Time, [switch]$Restart, [switch]$Cancel ) if ($Time) { $currentDateTime = Get-Date $shutdownTime = Get-Date $Time if ($shutdownTime -lt $currentDateTime) { $shutdownTime = $shutdownTime.AddDays(1) } $timeUntilShutdown = $shutdownTime - $currentDateTime $secondsUntilShutdown = [math]::Round($timeUntilShutdown.TotalSeconds) } if ($Cancel) { Start-Process -FilePath \"shutdown.exe\" -ArgumentList \"/a\" } elseif ($Restart) { Write-Host \"The computer will restart after $($timeUntilShutdown.Hours) hours and $($timeUntilShutdown.Minutes) minutes.\" Start-Process -FilePath \"shutdown.exe\" -ArgumentList \"/r\", \"/f\", \"/t\", \"$secondsUntilShutdown\" } else { Write-Host \"The computer will shutdown after $($timeUntilShutdown.Hours) hours and $($timeUntilShutdown.Minutes) minutes.\" Start-Process -FilePath \"shutdown.exe\" -ArgumentList \"/s\", \"/f\", \"/t\", \"$secondsUntilShutdown\" } } LocalAccounts Get-Command -Module Microsoft.PowerShell.LocalAccounts \\ Get-LocalUser \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \\ Get-LocalGroup \u0441\u043f\u0438\u0441\u043e\u043a \u0433\u0440\u0443\u043f\u043f \\ New-LocalUser \"1C\" -Password $Password -FullName \"1C Domain\" \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \\ Set-LocalUser -Password $Password 1C \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \\ Add-LocalGroupMember -Group \"Administrators\" -Member \"1C\" \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u0433\u0440\u0443\u043f\u043f\u0443 \u0410\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u043e\u0432 \\ Get-LocalGroupMember \"Administrators\" \u0447\u043b\u0435\u043d\u044b \u0433\u0440\u0443\u043f\u043f\u044b @(\"vproxy-01\",\"vproxy-02\",\"vproxy-03\") | %{ icm $_ {Add-LocalGroupMember -Group \"Administrators\" -Member \"support4\"} icm $_ {Get-LocalGroupMember \"Administrators\"} } SMB Get-SmbServerConfiguration \\ Set-SmbServerConfiguration -EnableSMB1Protocol $false -Force \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043f\u0440\u043e\u0442\u043e\u043a\u043e\u043b SMB v1 \\ Get-WindowsFeature | Where-Object {$_.name -eq \"FS-SMB1\"} | ft Name,Installstate \u043c\u043e\u0434\u0443\u043b\u044c ServerManager, \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d \u043b\u0438 \u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442 SMB1 \\ Install-WindowsFeature FS-SMB1 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c SMB1 \\ Uninstall-WindowsFeature \u2013Name FS-SMB1 \u2013Remove \u0443\u0434\u0430\u043b\u0438\u0442\u044c SMB1 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 (\u043f\u043e\u043d\u0430\u0434\u043e\u0431\u0438\u0442\u0441\u044f \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430) \\ Get-WindowsOptionalFeature -Online \u043c\u043e\u0434\u0443\u043b\u044c DISM, \u0434\u043b\u044f \u0440\u0430\u0431\u043e\u0442\u044b \u0441 \u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u0430\u043c\u0438 Windows \\ Disable-WindowsOptionalFeature -Online -FeatureName SMB1Protocol -Remove \u0443\u0434\u0430\u043b\u0438\u0442\u044c SMB1 \\ Set-SmbServerConfiguration \u2013AuditSmb1Access $true \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0430\u0443\u0434\u0438\u0442 SMB1 \\ Get-SmbConnection \u0441\u043f\u0438\u0441\u043e\u043a \u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0445 \u0441\u0435\u0441\u0441\u0438\u0439 \u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c\u0430\u044f \u0432\u0435\u0440\u0441\u0438\u044f SMB (Dialect) \\ Get-SmbOpenFile | select ClientUserName,ClientComputerName,Path,SessionID \u0441\u043f\u0438\u0441\u043e\u043a \u043e\u0442\u043a\u0440\u044b\u0442\u044b\u0445 \u0444\u0430\u0439\u043b\u043e\u0432 \\ Get-SmbShare \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u0435\u0442\u0435\u0432\u044b\u0445 \u043f\u0430\u043f\u043e\u043a \\ New-SmbShare -Name xl-share -Path E:\\test \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043d\u043e\u0432\u0443\u044e \u043e\u0431\u0449\u0443\u044e \u0441\u0435\u0442\u0435\u0432\u0443\u044e \u043f\u0430\u043f\u043a\u0443 (\u0440\u0430\u0441\u0448\u0430\u0440\u0438\u0442\u044c) \\ -EncryptData $True \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0448\u0438\u0444\u0440\u043e\u0432\u0430\u043d\u0438\u0435 SMB \\ -Description \u0438\u043c\u044f \u0432 \u0441\u0435\u0442\u0435\u0432\u043e\u043c \u043e\u043a\u0440\u0443\u0436\u0435\u043d\u0438\u0438 \\ -ReadAccess \"domain\\username\" \u0434\u043e\u0441\u0442\u0443\u043f \u043d\u0430 \u0447\u0442\u0435\u043d\u0438\u0435 \\ -ChangeAccess \u0434\u043e\u0441\u0442\u0443\u043f \u043d\u0430 \u0437\u0430\u043f\u0438\u0441\u044c \\ -FullAccess \u043f\u043e\u043b\u043d\u044b\u0439 \u0434\u043e\u0441\u0442\u0443\u043f \\ -NoAccess ALL \u043d\u0435\u0442 \u043f\u0440\u0430\u0432 \\ -FolderEnumerationMode [AccessBased | Unrestricted] \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0441\u043a\u0440\u044b\u0442\u044c \u0432 \u0441\u0435\u0442\u0435\u0432\u043e\u0439 \u043f\u0430\u043f\u043a\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b, \u043d\u0430 \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u0443 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u043d\u0435\u0442 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e Access-Based Enumeration (ABE) \\ Get-SmbShare xl-share | Set-SmbShare -FolderEnumerationMode AccessBased \u043a\u043b\u044e\u0447\u0438\u0442\u044c ABE \u0434\u043b\u044f \u0432\u0441\u0435\u0445 \u0440\u0430\u0441\u0448\u0430\u0440\u0435\u043d\u043d\u044b\u0445 \u043f\u0430\u043f\u043e\u043a \\ Remove-SmbShare xl-share -force \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u0435\u0442\u0435\u0432\u043e\u0439 \u0434\u043e\u0441\u0442\u0443\u043f (\u0448\u0430\u0440\u0443) \\ Get-SmbShareAccess xl-share \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u0441\u043f\u0438\u0441\u043e\u043a \u0434\u043e\u0441\u0442\u0443\u043f\u043e\u0432 \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u0438 \u043a \u0448\u0430\u0440\u0435 \\ Revoke-SmbShareAccess xl-share -AccountName Everyone \u2013Force \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0433\u0440\u0443\u043f\u043f\u0443 \u0438\u0437 \u0441\u043f\u0438\u0441\u043a\u0430 \u0434\u043e\u0441\u0442\u0443\u043f\u043e\u0432 \\ Grant-SmbShareAccess -Name xl-share -AccountName \"domain\\XL-Share\" -AccessRight Change \u2013force \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c/\u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u044f \u043d\u0430 \u0437\u0430\u043f\u0438\u0441\u044c (Full,Read) \\ Grant-SmbShareAccess -Name xl-share -AccountName \"\u0432\u0441\u0435\" -AccessRight Change \u2013force \\ Block-SmbShareAccess -Name xl-share -AccountName \"domain\\noAccess\" -Force \u043f\u0440\u0438\u043d\u0443\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u0437\u0430\u043f\u0440\u0435\u0442 \\ New-SmbMapping -LocalPath X: -RemotePath \\\\$srv\\xl-share -UserName support4 -Password password \u2013Persistent $true \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0441\u0435\u0442\u0435\u0432\u043e\u0439 \u0434\u0438\u0441\u043a \\ -Persistent \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f \u043f\u043e\u0441\u043b\u0435 \u043e\u0442\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0430 \u0438\u043b\u0438 \u0441\u0435\u0442\u0438 \\ -SaveCredential \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0443\u0447\u0435\u0442\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0434\u043b\u044f \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u0432 \u0434\u0438\u0441\u043f\u0435\u0442\u0447\u0435\u0440 \u0443\u0447\u0435\u0442\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445 Windows Credential Manager \\ Stop-Process -Name \"explorer\" | Start-Process -FilePath \"C:\\Windows\\explorer.exe\" \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u0434\u043b\u044f \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0432 \u043f\u0440\u043e\u0432\u043e\u0434\u043d\u0438\u043a\u0435 \\ Get-SmbMapping \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u043d\u044b\u0445 \u0441\u0435\u0442\u0435\u0432\u044b\u0445 \u0434\u0438\u0441\u043a\u043e\u0432 \\ Remove-SmbMapping X: -force \u043e\u0442\u043c\u043e\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u0435\u0442\u0435\u0432\u043e\u0439 \u0434\u0438\u0441\u043a \\ $CIMSession = New-CIMSession \u2013Computername $srv \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0441\u0435\u0430\u043d\u0441 CIM (\u0430\u0443\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u044f \u043d\u0430 SMB) \\ Get-SmbOpenFile -CIMSession $CIMSession | select ClientUserName,ClientComputerName,Path | Out-GridView -PassThru | Close-SmbOpenFile -CIMSession $CIMSession -Confirm:$false \u2013Force \u0437\u0430\u043a\u0440\u044b\u0442\u044c \u0444\u0430\u0439\u043b\u044b (\u043e\u0442\u043a\u0440\u044b\u0442\u044c \u043a \u043d\u0438\u043c \u0441\u0435\u0442\u0435\u0432\u043e\u0439 \u0434\u043e\u0441\u0442\u0443\u043f) Get-Acl (Get-Acl \\\\$srv\\xl-share).access \u0434\u043e\u0441\u0442\u0443\u043f ACL \u043d\u0430 \u0443\u0440\u043e\u0432\u043d\u0435 NTFS \\ Get-Acl C:\\Drivers | Set-Acl C:\\Distr \u0441\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c NTFS \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u044f \u0441 \u043e\u0434\u043d\u043e\u0439 \u043f\u0430\u043f\u043a\u0438 \u0438 \u043f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c \u0438\u0445 \u043d\u0430 \u0434\u0440\u0443\u0433\u0443\u044e NTFSSecurity Install-Module -Name NTFSSecurity -force \\ Get-Item \"\\\\$srv\\xl-share\" | Get-NTFSAccess \\ Add-NTFSAccess -Path \"\\\\$srv\\xl-share\" -Account \"domain\\xl-share\" -AccessRights Fullcontrol -PassThru \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \\ Remove-NTFSAccess -Path \"\\\\$srv\\xl-share\" -Account \"domain\\xl-share\" -AccessRights FullControl -PassThru \u0443\u0434\u0430\u043b\u0438\u0442\u044c \\ Get-ChildItem -Path \"\\\\$srv\\xl-share\" -Recurse -Force | Clear-NTFSAccess \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u0441\u0435 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u044f, \u0431\u0435\u0437 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u044f \u0443\u043d\u0430\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u043d\u043d\u044b\u0445 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u0439 \\ Get-ChildItem -Path \"\\\\$srv\\xl-share\" -Recurse -Force | Enable-NTFSAccessInheritance \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c NTFS \u043d\u0430\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u043d\u0438\u0435 \u0434\u043b\u044f \u0432\u0441\u0435\u0445 \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 \u0432 \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0435 Storage Get-Command -Module Storage \\ Get-Disk \u0441\u043f\u0438\u0441\u043e\u043a \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u0434\u0438\u0441\u043a\u043e\u0432 \\ Get-Partition \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0440\u0430\u0437\u0434\u0435\u043b\u044b \u043d\u0430 \u0432\u0441\u0435\u0445 \u0434\u0438\u0441\u043a\u0430\u0445 \\ Get-Volume \u0441\u043f\u0438\u0441\u043e\u043a \u043b\u043e\u0433\u0438\u0447\u043a\u0438\u0445 \u0440\u0430\u0437\u0434\u0435\u043b\u043e\u0432 \\ Get-PhysicalDisk \u0441\u043f\u0438\u0441\u043e\u043a \u0444\u0438\u0437\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u0434\u0438\u0441\u043a\u043e\u0432 \\ Initialize-Disk 1 \u2013PartitionStyle MBR \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0434\u0438\u0441\u043a \\ New-Partition -DriveLetter D \u2013DiskNumber 1 -Size 500gb \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0440\u0430\u0437\u0434\u0435\u043b (\u0432\u044b\u0434\u0435\u043b\u0438\u0442\u044c \u0432\u0441\u0435 \u043c\u0435\u0441\u0442\u043e -UseMaximumSize) \\ Format-Volume -DriveLetter D -FileSystem NTFS -NewFileSystemLabel Disk-D \u0444\u043e\u0440\u043c\u0430\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0440\u0430\u0437\u0434\u0435\u043b \\ Set-Partition -DriveLetter D -IsActive $True \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u0430\u043a\u0442\u0438\u0432\u043d\u044b\u043c \\ Remove-Partition -DriveLetter D \u2013DiskNumber 1 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0440\u0430\u0437\u0434\u0435\u043b \\ Clear-Disk -Number 1 -RemoveData \u043e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u0434\u0438\u0441\u043a \\ Repair-Volume \u2013driveletter C \u2013Scan Check disk \\ Repair-Volume \u2013driveletter C \u2013SpotFix \\ Repair-Volume \u2013driverletter C -Scan \u2013Cimsession $CIMSession iSCSI New-IscsiVirtualDisk -Path D:\\iSCSIVirtualDisks\\iSCSI2.vhdx -Size 20GB \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0434\u0438\u043d\u0430\u043c\u0438\u0447\u0435\u0441\u043a\u0438\u0439 vhdx-\u0434\u0438\u0441\u043a (\u0434\u043b\u044f \u0444\u0438\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0433\u043e \u0440\u0430\u0437\u043c\u0435\u0440\u0430 -UseFixed) \\ New-IscsiServerTarget -TargetName iscsi-target-2 -InitiatorIds \"IQN:iqn.1991-05.com.microsoft:srv3.contoso.com\" \u0441\u043e\u0437\u0434\u0430\u0442\u044c Target \\ Get-IscsiServerTarget | fl TargetName, LunMappings \\ Connect-IscsiTarget -NodeAddress \"iqn.1995-05.com.microsoft:srv2-iscsi-target-2-target\" -IsPersistent $true \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f \u0438\u043d\u0438\u0446\u0438\u0430\u0442\u043e\u0440\u043e\u043c \u043a \u0442\u0430\u0440\u0433\u0435\u0442\u0443 \\ Get-IscsiTarget | fl \\ Disconnect-IscsiTarget -NodeAddress \"iqn.1995-05.com.microsoft:srv2-iscsi-target-2-target\" -Confirm:$false \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f ActiveDirectory RSAT (Remote Server Administration Tools) DISM.exe /Online /add-capability /CapabilityName:Rsat.ActiveDirectory.DS-LDS.Tools~~~~0.0.1.0 /CapabilityName:Rsat.GroupPolicy.Management.Tools~~~~0.0.1.0 \\ Add-WindowsCapability \u2013online \u2013Name Rsat.Dns.Tools~~~~0.0.1.0 \\ Add-WindowsCapability -Online -Name Rsat.DHCP.Tools~~~~0.0.1.0 \\ Add-WindowsCapability \u2013online \u2013Name Rsat.FileServices.Tools~~~~0.0.1.0 \\ Add-WindowsCapability -Online -Name Rsat.WSUS.Tools~~~~0.0.1.0 \\ Add-WindowsCapability -Online -Name Rsat.CertificateServices.Tools~~~~0.0.1.0 \\ Add-WindowsCapability -Online -Name Rsat.RemoteDesktop.Services.Tools~~~~0.0.1.0 \\ Get-WindowsCapability -Name RSAT* -Online | Select-Object -Property DisplayName, State \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044b\u0445 \u043a\u043e\u043c\u043f\u0430\u043d\u0435\u043d\u0442\u043e\u0432 Import-Module ActiveDirectory $Session = New-PSSession -ComputerName $srv -Credential $cred \\ Export-PSsession -Session $Session -Module ActiveDirectory -OutputModule ActiveDirectory \u044d\u043a\u0441\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043c\u043e\u0434\u0443\u043b\u044c \u0438\u0437 \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u043e\u0439 \u0441\u0435\u0441\u0441\u0438 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0441 DC) \\ Remove-PSSession -Session $Session \\ Import-Module ActiveDirectory \\ Get-Command -Module ActiveDirectory` ADSI (Active Directory Service Interface) $d0 = $env:userdnsdomain \\ $d0 = $d0 -split \"\\.\" \\ $d1 = $d0[0] \\ $d2 = $d0[1] \\ $group = [ADSI]\"LDAP://OU=Domain Controllers,DC=$d1,DC=$d2\" \\ $group | select * $Local_User = [ADSI]\"WinNT://./\u0410\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440,user\" \\ $Local_User | Get-Member \\ $Local_User.Description \\ $Local_User.LastLogin \u0432\u0440\u0435\u043c\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0439 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u043e\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f LDAP (Lightweight Directory Access Protocol) $ldapsearcher = New-Object System.DirectoryServices.DirectorySearcher \\ $ldapsearcher.SearchRoot = \"LDAP://OU=Domain Controllers,DC=$d1,DC=$d2\" \\ $ldapsearcher.Filter = \"(objectclass=computer)\" \\ $dc = $ldapsearcher.FindAll().path $usr = $env:username c\u043f\u0438\u0441\u043e\u043a \u0433\u0440\u0443\u043f\u043f \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \\ $ldapsearcher = New-Object System.DirectoryServices.DirectorySearcher \\ $ldapsearcher.Filter = \"(&(objectCategory=User)(samAccountName=$usr))\" \\ $usrfind = $ldapsearcher.FindOne() \\ $groups = $usrfind.properties.memberof -replace \"(,OU=.+)\" \\ $groups = $groups -replace \"(CN=)\" DC (Domain Component) - \u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442 \u0434\u043e\u043c\u0435\u043d\u043d\u043e\u0433\u043e \u0438\u043c\u0435\u043d\u0438 \\ OU (Organizational Unit) - \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0435 \u043f\u043e\u0434\u0440\u0430\u0437\u0434\u0435\u043b\u0435\u043d\u0438\u044f (type), \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442\u0441\u044f \u0434\u043b\u044f \u0443\u043f\u043e\u0440\u044f\u0434\u043e\u0447\u0435\u043d\u0438\u044f \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 \\ Container - \u0442\u0430\u043a \u0436\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0434\u043b\u044f \u0443\u043f\u043e\u0440\u044f\u0434\u043e\u0447\u0435\u043d\u0438\u044f \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432, \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u044b \u0432 \u043e\u0442\u043b\u0438\u0447\u0438\u0438 \u043e\u0442 \u043f\u043e\u0434\u0440\u0430\u0434\u0435\u043b\u0435\u043d\u0438\u0439 \u043d\u0435 \u043c\u043e\u0433\u0443\u0442 \u0431\u044b\u0442\u044c \u043f\u0435\u0440\u0435\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u044b, \u0443\u0434\u0430\u043b\u0435\u043d\u044b, \u0441\u043e\u0437\u0434\u0430\u043d\u044b \u0438\u043b\u0438 \u0441\u0432\u044f\u0437\u0430\u043d\u044b \u0441 \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u043c \u0433\u0440\u0443\u043f\u043f\u043e\u0432\u043e\u0439 \u043f\u043e\u043b\u0438\u0442\u0438\u043a\u0438 (Computers, Domain Controllers, Users) \\ DN (Distinguished Name) \u2014 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u043e\u0435 \u0438\u043c\u044f \u043e\u0431\u044a\u0435\u043a\u0442\u0430 \u0438 \u043c\u0435\u0441\u0442\u043e\u043f\u043e\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u0432 \u043b\u0435\u0441\u0443 AD. \u0412 DN \u043e\u043f\u0438\u0441\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u043e\u0432 \u0432 \u0434\u0435\u0440\u0435\u0432\u0435 (\u043f\u0443\u0442\u044c \u043d\u0430\u0432\u0438\u0433\u0430\u0446\u0438\u0438), \u0442\u0440\u0435\u0431\u0443\u0435\u043c\u043e\u0435 \u0434\u043b\u044f \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043a \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0439 \u0437\u0430\u043f\u0438\u0441\u0438 \u0438\u043b\u0438 \u0435\u0435 \u043f\u043e\u0438\u0441\u043a\u0430 \\ CN (Common Name) - \u043e\u0431\u0449\u0435\u0435 \u0438\u043c\u044f (Get-ADObject (Get-ADRootDSE).DefaultNamingContext -Properties wellKnownObjects).wellKnownObjects \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u044b \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \\ redircmp OU=Client Computers,DC=root,DC=domain,DC=local \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u043e\u0432 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \\ redirusr \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e LAPS (Local Admin Password Management) Import-module AdmPwd.ps \u0438\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043c\u043e\u0434\u0443\u043b\u044c \\ Get-AdmPwdPassword -ComputerName NAME \u043f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \\ Reset-AdmPwdPassword -ComputerName NAME \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \\ Get-ADComputer -Filter * -SearchBase \"DC=$d1,DC=$d2\" | Get-AdmPwdPassword -ComputerName {$_.Name} | select ComputerName,Password,ExpirationTimestamp | Out-GridView \\ Get-ADComputer -Identity $srv | Get-AdmPwdPassword -ComputerName {$_.Name} | select ComputerName,Password,ExpirationTimestamp Recycle Bin \u0423\u0434\u0430\u043b\u0435\u043d\u043d\u044b\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u0445\u0440\u0430\u043d\u044f\u0442\u0441\u044f \u0432 \u043a\u043e\u0440\u0437\u0438\u043d\u0435 AD \u0432 \u0442\u0435\u0447\u0435\u043d\u0438\u0438 \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0437\u0430\u0445\u043e\u0440\u043e\u043d\u0435\u043d\u0438\u044f (\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u0435\u0442\u0441\u044f \u0432 \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u0435 \u0434\u043e\u043c\u0435\u043d\u0430 msDS-deletedObjectLifetime), \u0437\u0430\u0434\u0430\u043d\u043d\u043e\u043c \u0434\u043b\u044f \u043b\u0435\u0441\u0430. \u041f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \u044d\u0442\u043e 180 \u0434\u043d\u0435\u0439. \u0415\u0441\u043b\u0438 \u0434\u0430\u043d\u043d\u044b\u0439 \u0441\u0440\u043e\u043a \u043f\u0440\u043e\u0448\u0435\u043b, \u043e\u0431\u044a\u0435\u043a\u0442 \u0432\u0441\u0435 \u0435\u0449\u0435 \u043e\u0441\u0442\u0430\u0435\u0442\u0441\u044f \u0432 \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u0435 Deleted Objects, \u043d\u043e \u0431\u043e\u043b\u044c\u0448\u0438\u043d\u0441\u0442\u0432\u043e \u0435\u0433\u043e \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u043e\u0432 \u0438 \u0441\u0432\u044f\u0437\u0435\u0439 \u043e\u0447\u0438\u0449\u0430\u044e\u0442\u0441\u044f (Recycled Object). \u041f\u043e\u0441\u043b\u0435 \u0438\u0441\u0442\u0435\u0447\u0435\u043d\u0438\u044f \u043f\u0435\u0440\u0438\u043e\u0434\u0430 tombstoneLifetime (\u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \u0442\u0430\u043a\u0436\u0435 180 \u0434\u043d\u0435\u0439, \u043d\u043e \u043c\u043e\u0436\u043d\u043e \u0443\u0432\u0435\u043b\u0438\u0447\u0438\u0442\u044c) \u043e\u0431\u044a\u0435\u043a\u0442 \u043f\u043e\u043b\u043d\u043e\u0441\u0442\u044c\u044e \u0443\u0434\u0430\u043b\u044f\u0435\u0442\u0441\u044f \u0438\u0437 AD \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u043c \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u043c \u043e\u0447\u0438\u0441\u0442\u043a\u0438. \\ Get-ADForest domain.local \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0443\u0440\u043e\u0432\u0435\u043d\u044c \u0440\u0430\u0431\u043e\u0442\u044b \u043b\u0435\u0441\u0430 \\ Set-ADForestMode -Identity domain.local -ForestMode Windows2008R2Forest -force \u0443\u0432\u0435\u043b\u0438\u0447\u0438\u0442\u044c \u0443\u0440\u043e\u0432\u0435\u043d\u044c \u0440\u0430\u0431\u043e\u0442\u044b \u043b\u0435\u0441\u0430 \\ Enable-ADOptionalFeature \u2013Identity \"CN=Recycle Bin Feature,CN=Optional Features,CN=Directory Service,CN=Windows NT,CN=Services,CN=Configuration,DC=domain,DC=local\" \u2013Scope ForestOrConfigurationSet \u2013Target \"domain.local\" \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043a\u043e\u0440\u0437\u0438\u043d\u0443 \\ Get-ADOptionalFeature \"Recycle Bin Feature\" | select-object name,EnabledScopes \u0435\u0441\u043b\u0438 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 EnabledScopes \u043d\u0435 \u043f\u0443\u0441\u0442\u043e\u0435, \u0437\u043d\u0430\u0447\u0438\u0442 \u0432 \u0434\u043e\u043c\u0435\u043d\u0435 \u043a\u043e\u0440\u0437\u0438\u043d\u0430 Active Directory \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u0430 \\ Get-ADObject -Filter 'Name -like \"*tnas*\"' -IncludeDeletedObjects \u043d\u0430\u0439\u0442\u0438 \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u0443\u044e (Deleted: True) \u0423\u0417 (ObjectClass: user) \u0432 AD \\ Get-ADObject -Filter 'Name -like \"*tnas*\"' \u2013IncludeDeletedObjects -Properties *| select-object Name, sAMAccountName, LastKnownParent, memberOf, IsDeleted | fl \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u0430 IsDeleted, \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440, \u0432 \u043a\u043e\u0442\u043e\u0440\u043e\u043c \u043d\u0430\u0445\u043e\u0434\u0438\u043b\u0441\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435 \u043f\u0435\u0440\u0435\u0434 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u0435\u043c (LastKnownParent) \u0438 \u0441\u043f\u0438\u0441\u043e\u043a \u0433\u0440\u0443\u043f\u043f, \u0432 \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u043e\u043d \u0441\u043e\u0441\u0442\u043e\u044f\u043b \\ Get-ADObject \u2013filter {Deleted -eq $True -and ObjectClass -eq \"user\"} \u2013includeDeletedObjects \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u0441\u043f\u0438\u0441\u043e\u043a \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u044b\u0445 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \\ Restore-ADObject -Identity \"3dc33c7c-b912-4a19-b1b7-415c1395a34e\" \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043f\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044e \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u0430 ObjectGUID \\ Get-ADObject -Filter 'SAMAccountName -eq \"tnas-01\"' \u2013IncludeDeletedObjects | Restore-ADObject \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043f\u043e SAMAccountName \\ Get-ADObject -Filter {Deleted -eq $True -and ObjectClass -eq 'group' -and Name -like '*Allow*'} \u2013IncludeDeletedObjects | Restore-ADObject \u2013Verbose \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0433\u0440\u0443\u043f\u043f\u0443 \u0438\u043b\u0438 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440 thumbnailPhoto $photo = [byte[]](Get-Content C:\\Install\\adm.jpg -Encoding byte) \u043f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u044c \u0444\u0430\u0439\u043b \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0438 \u0432 \u043c\u0430\u0441\u0441\u0438\u0432 \u0431\u0430\u0439\u0442\u043e\u0432 (jpeg/bmp \u0444\u0430\u0439\u043b, \u0440\u0430\u0437\u043c\u0435\u0440\u043e\u043c \u0444\u043e\u0442\u043e \u0434\u043e 100 \u041a\u0431 \u0438 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u0435\u043c 96?96) \\ Set-ADUser support4 -Replace @{thumbnailPhoto=$photo} \u0437\u0430\u0434\u0430\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u0430 thumbnailPhoto ADDomainController Get-ADDomainController \u0432\u044b\u0432\u043e\u0434\u0438\u0442 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u043e \u0442\u0435\u043a\u0443\u0449\u0435\u043c \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0435 \u0434\u043e\u043c\u0435\u043d\u0430 (LogonServer), \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0434\u0430\u043d\u043d\u044b\u043c \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u043e\u043c \u0434\u043b\u044f \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438 (DC \u0432\u044b\u0431\u0438\u0440\u0430\u0435\u0442\u0441\u044f \u043f\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0435 \u0432 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0438 \u0441 \u0442\u043e\u043f\u043e\u043b\u043e\u0433\u0438\u0435\u0439 \u0441\u0430\u0439\u0442\u043e\u0432 AD) \\ Get-ADDomainController -Discover -Service PrimaryDC \u043d\u0430\u0439\u0442\u0438 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440 \u0441 \u0440\u043e\u043b\u044c\u044e PDC \u0432 \u0434\u043e\u043c\u0435\u043d\u0435 \\ Get-ADDomainController -Filter * | ft HostName,IPv4Address,Name,Site,OperatingSystem,IsGlobalCatalog \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435 DC, \u043f\u0440\u0438\u043d\u0430\u0434\u043b\u0435\u0436\u043d\u043e\u0441\u0442\u044c \u043a \u0441\u0430\u0439\u0442\u0443, \u0432\u0435\u0440\u0441\u0438\u0438 \u041e\u0421 \u0438 GC \u041f\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0435 \u041e\u0421 \u0441\u043b\u0443\u0436\u0431\u0430 NetLogon \u0434\u0435\u043b\u0430\u0435\u0442 DNS \u0437\u0430\u043f\u0440\u043e\u0441 \u0441\u043e \u0441\u043f\u0438\u0441\u043a\u043e\u043c \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u043e\u0432 \u0434\u043e\u043c\u0435\u043d\u0430 (\u043a SRV \u0437\u0430\u043f\u0438\u0441\u0438 ldap._tcp.dc._msdcs.domain ), DNS \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0441\u043f\u0438\u0441\u043e\u043a DC \u0432 \u0434\u043e\u043c\u0435\u043d\u0435 \u0441 \u0437\u0430\u043f\u0438\u0441\u044c\u044e Service Location (SRV). \u041a\u043b\u0438\u0435\u043d\u0442 \u0434\u0435\u043b\u0430\u0435\u0442 LDAP \u0437\u0430\u043f\u0440\u043e\u0441 \u043a DC \u0434\u043b\u044f \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u044f \u0441\u0430\u0439\u0442\u0430 AD \u043f\u043e \u0441\u0432\u043e\u0435\u043c\u0443 IP \u0430\u0434\u0440\u0435\u0441\u0443. \u041a\u043b\u0438\u0435\u043d\u0442 \u0447\u0435\u0440\u0435\u0437 DNS \u0437\u0430\u043f\u0440\u0430\u0448\u0438\u0432\u0430\u0435\u0442 \u0441\u043f\u0438\u0441\u043e\u043a \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u043e\u0432 \u0434\u043e\u043c\u0435\u043d\u0430 \u0432 \u0441\u0430\u0439\u0442\u0435 (\u0432 \u0440\u0430\u0437\u0434\u0435\u043b\u0435 _tcp.sitename._sites...). USN (Update Sequence Numbers) - \u0441\u0447\u0435\u0442\u0447\u0438\u043a \u043d\u043e\u043c\u0435\u0440\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \u0443 \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u043e\u0431\u044a\u0435\u043a\u0442\u0430 AD. \u041f\u0440\u0438 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u044b \u043e\u0431\u043c\u0435\u043d\u0438\u0432\u0430\u044e\u0442\u0441\u044f \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f\u043c\u0438 USN, \u043e\u0431\u044a\u0435\u043a\u0442 \u0441 \u0431\u043e\u043b\u0435\u0435 \u043d\u0438\u0437\u043a\u0438\u043c USN \u0431\u0443\u0434\u0435\u0442 \u043f\u0440\u0438 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0438\u0441\u0430\u043d \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u043c \u0441 \u0431\u043e\u043b\u0435\u0435 \u0432\u044b\u0441\u043e\u043a\u0438\u043c USN. \u041d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u0432 \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430\u0445 - Object (\u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c View - Advanced Features). \u041a\u0430\u0436\u0434\u044b\u0439 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440 \u0434\u043e\u043c\u0435\u043d\u0430 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u044b\u0439 \u0441\u0447\u0435\u0442\u0447\u0438\u043a USN, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043d\u0430\u0447\u0438\u043d\u0430\u0435\u0442 \u043e\u0442\u0441\u0447\u0435\u0442 \u0432 \u043c\u043e\u043c\u0435\u043d\u0442 \u0437\u0430\u043f\u0443\u0441\u043a\u0430 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 Dcpromo \u0438 \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0430\u0435\u0442 \u0443\u0432\u0435\u043b\u0438\u0447\u0438\u0432\u0430\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0432 \u0442\u0435\u0447\u0435\u043d\u0438\u0435 \u0432\u0441\u0435\u0433\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u044f \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0430 \u0434\u043e\u043c\u0435\u043d\u0430. \u0417\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0441\u0447\u0435\u0442\u0447\u0438\u043a\u0430 USN \u0443\u0432\u0435\u043b\u0438\u0447\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u043a\u0430\u0436\u0434\u044b\u0439 \u0440\u0430\u0437, \u043a\u043e\u0433\u0434\u0430 \u043d\u0430 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0435 \u0434\u043e\u043c\u0435\u043d\u0430 \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u044f, \u044d\u0442\u043e \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0438 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f, \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0438\u043b\u0438 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u044f \u043e\u0431\u044a\u0435\u043a\u0442\u0430. Get-ADDomainController -Filter * | % { \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c USN \u043e\u0431\u044a\u0435\u043a\u0442\u0430 \u043d\u0430 \u0432\u0441\u0435\u0445 DC \u0432 \u0434\u043e\u043c\u0435\u043d\u0435 \\ Get-ADUser -Server $_.HostName -Identity support4 -Properties uSNChanged | select SamAccountName,uSNChanged \\ }` dcpromo /forceremoval \u043f\u0440\u0438\u043d\u0443\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442 \u043f\u043e\u043d\u0438\u0436\u0435\u043d\u0438\u0435 \u0432 \u0440\u043e\u043b\u0438 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0430 \u0434\u043e\u043c\u0435\u043d\u0430 \u0434\u043e \u0443\u0440\u043e\u0432\u043d\u044f \u0440\u044f\u0434\u043e\u0432\u043e\u0433\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u0430. \u041f\u043e\u0441\u043b\u0435 \u043f\u043e\u043d\u0438\u0436\u0435\u043d\u0438\u044f \u0440\u043e\u043b\u0438 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0432\u0441\u0435\u0445 \u0441\u0441\u044b\u043b\u043e\u043a \u0432 \u0434\u043e\u043c\u0435\u043d\u0435 \u043d\u0430 \u044d\u0442\u043e\u0442 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440. \u0414\u0430\u043b\u0435\u0435 \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u0442 \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u0432 \u0441\u043e\u0441\u0442\u0430\u0432 \u0434\u043e\u043c\u0435\u043d\u0430, \u0438 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u043e\u0431\u0440\u0430\u0442\u043d\u043e\u0433\u043e \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430, \u0442.\u0435. \u043f\u043e\u0432\u044b\u0448\u0435\u043d\u0438\u0435 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u0434\u043e \u0443\u0440\u043e\u0432\u043d\u044f \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0430 \u0434\u043e\u043c\u0435\u043d\u0430. ADComputer nltest /DSGETDC:$env:userdnsdomain \u0443\u0437\u043d\u0430\u0442\u044c \u043d\u0430 \u043a\u0430\u043a\u043e\u043c DC \u0430\u0443\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u0446\u0438\u0440\u043e\u0432\u0430\u043d \u0445\u043e\u0441\u0442 (Logon Server) \\ nltest /SC_RESET:$env:userdnsdomain\\srv-dc2.$env:userdnsdomain \u043f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440 \u043d\u0430 \u0434\u0440\u0443\u0433\u043e\u0439 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440 \u0434\u043e\u043c\u0435\u043d\u0430 AD \u0432\u0440\u0443\u0447\u043d\u0443\u044e (The command completed successfully) \\ Get-ADComputer \u2013Identity $env:computername -Properties PasswordLastSet \u0432\u0440\u0435\u043c\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0439 \u0441\u043c\u0435\u043d\u044b \u043f\u0430\u0440\u043e\u043b\u044f \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435 \\ Test-ComputerSecureChannel \u2013verbose \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0434\u043e\u0432\u0435\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u043e\u0442\u043d\u043e\u0448\u0435\u043d\u0438\u044f \u0441 \u0434\u043e\u043c\u0435\u043d\u043e\u043c (\u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043b\u0438 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u0439 \u043f\u0430\u0440\u043e\u043b\u044c \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0430 \u043f\u0430\u0440\u043e\u043b\u044e, \u0445\u0440\u0430\u043d\u044f\u0449\u0435\u043c\u0443\u0441\u044f \u0432 AD) \\ Reset-ComputerMachinePassword -Credential domain\\admin \u043f\u0440\u0438\u043d\u0443\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \\ Netdom ResetPWD /Server:dc-01 /UserD:domain\\admin /PasswordD:* \u0441\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u0445\u044d\u0448 \u043f\u0430\u0440\u043e\u043b\u044f \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0430 \u0432 \u0434\u043e\u043c\u0435\u043d\u0435 (\u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u043d\u0435 \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f) \\ Search-ADAccount -AccountDisabled -ComputersOnly | select Name,LastLogonDate,Enabled \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u043e\u0442\u043a\u043b\u044e\u0447\u0435\u043d\u043d\u044b\u0435 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u044b Get-ADComputer -Filter * -Properties * | select name \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u043e\u0432 \u0432 \u0434\u043e\u043c\u0435\u043d\u0435 (Filter), \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u0432\u0441\u0435 \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430 (Properties) \\ Get-ADComputer -Identity $srv -Properties * | ft Name,LastLogonDate,PasswordLastSet,ms-Mcs-AdmPwd -Autosize \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0433\u043e \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0430 \u0432 AD (Identity) \\ Get-ADComputer -SearchBase \"OU=Domain Controllers,DC=$d1,DC=$d2\" -Filter * -Properties * | ft Name, LastLogonDate, distinguishedName -Autosize \u043f\u043e\u0438\u0441\u043a \u0432 \u0431\u0430\u0437\u0435 \u043f\u043e DN (SearchBase) (Get-ADComputer -Filter {enabled -eq \"true\"}).count \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043e\u0431\u0449\u0435\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0445 (\u043d\u0435\u0437\u0430\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0445) \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u043e\u0432 \\ (Get-ADComputer -Filter {enabled -eq \"true\" -and OperatingSystem -like \"*Windows Server 2016*\"}).count \u043a\u043e\u043b-\u0432\u043e \u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0445 \u043a\u043e\u043f\u044c\u044e\u0442\u0435\u0440\u043e\u0432 \u0441 \u041e\u0421 WS 2016 Get-ADComputer -Filter * -Properties * | select @{Label=\"Ping Status\"; Expression={ \\ $ping = ping -n 1 -w 50 $_.Name \\ if ($ping -match \"TTL\") {\"Online\"} else {\"Offline\"} \\ }}, \\ @{Label=\"Status\"; Expression={ \\ if ($_.Enabled -eq \"True\") {$_.Enabled -replace \"True\",\"Active\"} else {$_.Enabled -replace \"False\",\"Blocked\"} \\ }}, Name, IPv4Address, OperatingSystem, @{Label=\"UserOwner\"; Expression={$_.ManagedBy -replace \"(CN=|,.+)\"} \\ },Created | Out-GridView ADUser Get-ADUser -Identity support4 -Properties * \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u043e\u0432 \\ Get-ADUser -Identity support4 -Properties DistinguishedName, EmailAddress, Description \u043f\u0443\u0442\u044c DN, email \u0438 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \\ Get-ADUser -Filter {(Enabled -eq \"True\") -and (mail -ne \"null\")} -Properties mail | ft Name,mail \u0441\u043f\u0438\u0441\u043e\u043a \u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0445 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \u0438 \u0435\u0441\u0442\u044c \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0439 \u044f\u0449\u0438\u043a \\ Get-ADUser -Filter {SamAccountName -like \"*\"} | Measure-Object \u043f\u043e\u0441\u0447\u0438\u0442\u0430\u0442\u044c \u043a\u043e\u043b-\u0432\u043e \u0432\u0441\u0435\u0445 \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u043e\u0432 (Count) \\ Get-ADUser -Filter * -Properties WhenCreated | sort WhenCreated | ft Name, whenCreated \u0434\u0430\u0442\u0430 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f \\ Get-ADUser -Identity support4 -property LockedOut | select samaccountName,Name,Enabled,Lockedout \\ Enabled=True \u0443\u0447\u0435\u0442\u043d\u0430\u044f \u0437\u0430\u043f\u0438\u0441\u044c \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u0430 - \u0434\u0430 \\ Lockedout=False \u0443\u0447\u0435\u0442\u043d\u0430\u044f \u0437\u0430\u043f\u0438\u0441\u044c \u0437\u0430\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u043d\u0430 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u043f\u043e\u043b\u0438\u0442\u0438\u043a\u043e\u0439 \u043f\u0430\u0440\u043e\u043b\u0435\u0439) - \u043d\u0435\u0442 \\ Get-ADUser -Identity support4 | Unlock-ADAccount \u0440\u0430\u0437\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0443\u0447\u0435\u0442\u043d\u0443\u044e \u0437\u0430\u043f\u0438\u0441\u044c \\ Disable-ADAccount -Identity support4 \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0443\u0447\u0435\u0442\u043d\u0443\u044e \u0437\u0430\u043f\u0438\u0441\u044c \\ Enable-ADAccount -Identity support4 \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0443\u0447\u0435\u0442\u043d\u0443\u044e \u0437\u0430\u043f\u0438\u0441\u044c \\ Search-ADAccount -LockedOut \u043d\u0430\u0439\u0442\u0438 \u0432\u0441\u0435 \u0437\u0430\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0435 \u0443\u0447\u0435\u0442\u043d\u044b\u0435 \u0437\u0430\u043f\u0438\u0441\u0438 \\ Search-ADAccount -AccountDisabled | select Name,LastLogonDate,Enabled \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u043e\u0442\u043a\u043b\u044e\u0447\u0435\u043d\u043d\u044b\u0435 \u0443\u0447\u0435\u0442\u043d\u044b\u0435 \u0437\u0430\u043f\u0438\u0441\u0438 \u0441 \u0432\u0440\u0435\u043c\u0435\u043d\u0435\u043c \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u0432\u0445\u043e\u0434\u0430 Get-ADUser -Identity support4 -Properties PasswordLastSet,PasswordExpired,PasswordNeverExpires \\ PasswordLastSet \u0432\u0440\u0435\u043c\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0439 \u0441\u043c\u0435\u043d\u044b \u043f\u0430\u0440\u043e\u043b\u044f \\ PasswordExpired=False \u043f\u0430\u0440\u043e\u043b\u044c \u0438\u0441\u0442\u0435\u043a - \u043d\u0435\u0442 \\ PasswordNeverExpires=True \u0441\u0440\u043e\u043a \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f \u043f\u0430\u0440\u043e\u043b\u044f \u043d\u0435 \u0438\u0441\u0442\u0435\u043a\u0430\u0435\u0442 - \u0434\u0430 \\ Set-ADAccountPassword support4 -Reset -NewPassword (ConvertTo-SecureString -AsPlainText \"password\" -Force -Verbose) \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \u0443\u0447\u0435\u0442\u043d\u043e\u0439 \u0437\u0430\u043f\u0438\u0441\u0438 \\ Set-ADUser -Identity support4 -ChangePasswordAtLogon $True \u0441\u043c\u0435\u043d\u0430 \u043f\u0430\u0440\u043e\u043b\u044f \u043f\u0440\u0438 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u043c \u0432\u0445\u043e\u0434\u0435 \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0443 $day = (Get-Date).adddays(-90) \\ Get-ADUser -filter {(passwordlastset -le $day)} | ft \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043d\u0435 \u043c\u0435\u043d\u044f\u043b\u0438 \u0441\u0432\u043e\u0439 \u043f\u0430\u0440\u043e\u043b\u044c \u0431\u043e\u043b\u044c\u0448\u0435 90 \u0434\u043d\u0435\u0439 $day = (Get-Date).adddays(-30) \\ Get-ADUser -filter {(Created -ge $day)} -Property Created | select Name,Created \u041d\u043e\u0432\u044b\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438 \u0437\u0430 30 \u0434\u043d\u0435\u0439 $day = (Get-Date).adddays(-360) \\ Get-ADUser -Filter {(LastLogonTimestamp -le $day)} -Property LastLogonTimestamp | select Name,SamAccountName,@{n='LastLogonTimestamp';e={[DateTime]::FromFileTime($_.LastLogonTimestamp)}} | sort -Descending LastLogonTimestamp \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043d\u0435 \u043b\u043e\u0433\u0438\u043d\u0438\u043b\u0438\u0441\u044c \u0431\u043e\u043b\u044c\u0448\u0435 360 \u0434\u043d\u0435\u0439. \u0420\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u044f \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u0430 LastLogonTimestamp \u0441\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 \u043e\u0442 9 \u0434\u043e 14 \u0434\u043d\u0435\u0439. \\ | Disable-ADAccount $_.SamAccountName \u0437\u0430\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u0442\u044c \\ -WhatIf \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u044b\u0432\u043e\u0434 \u0431\u0435\u0437 \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0439 ADGroupMember (Get-ADUser -Identity support4 -Properties MemberOf).memberof \u0441\u043f\u0438\u0441\u043e\u043a \u0433\u0440\u0443\u043f\u043f \u0432 \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u0441\u043e\u0441\u0442\u043e\u0438\u0442 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \\ Get-ADGroupMember -Identity \"Domain Admins\" | Select Name,SamAccountName \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \u0432 \u0433\u0440\u0443\u043f\u043f\u0435 \\ Add-ADGroupMember -Identity \"Domain Admins\" -Members support5 \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u0433\u0440\u0443\u043f\u043f\u0443 \\ Remove-ADGroupMember -Identity \"Domain Admins\" -Members support5 -force \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0438\u0437 \u0433\u0440\u0443\u043f\u043f\u044b \\ Get-ADGroup -filter * | where {!($_ | Get-ADGroupMember)} | Select Name \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u0443\u0441\u0442\u044b\u0445 \u0433\u0440\u0443\u043f\u043f (-Not) ADReplication Get-Command -Module ActiveDirectory -Name *Replication* \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u043a\u043e\u043c\u0430\u043d\u0434\u043b\u0435\u0442\u043e\u0432 \u043c\u043e\u0434\u0443\u043b\u044f \\ Get-ADReplicationFailure -Target dc-01 \u0441\u043f\u0438\u0441\u043e\u043a \u043e\u0448\u0438\u0431\u043e\u043a \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u0441 \u043f\u0430\u0440\u0442\u043d\u0435\u0440\u0430\u043c\u0438 \\ Get-ADReplicationFailure -Target $env:userdnsdomain -Scope Domain \\ Get-ADReplicationPartnerMetadata -Target dc-01 | select Partner,LastReplicationAttempt,LastReplicationSuccess,LastReplicationResult,LastChangeUsn \u0432\u0440\u0435\u043c\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0439 \u0438 \u0432\u0440\u0435\u043c\u044f \u0443\u0441\u043f\u0435\u0448\u043d\u043e\u0439 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u0441 \u043f\u0430\u0440\u0442\u043d\u0435\u0440\u0430\u043c\u0438 \\ Get-ADReplicationUpToDatenessVectorTable -Target dc-01 Update Sequence Number (USN) \u0443\u0432\u0435\u043b\u0438\u0447\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u043a\u0430\u0436\u0434\u044b\u0439 \u0440\u0430\u0437, \u043a\u043e\u0433\u0434\u0430 \u043d\u0430 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0435 \u0434\u043e\u043c\u0435\u043d\u0430 \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u044f (\u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0438 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f, \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0438\u043b\u0438 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u044f \u043e\u0431\u044a\u0435\u043a\u0442\u0430), \u043f\u0440\u0438 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 DC \u043e\u0431\u043c\u0435\u043d\u0438\u0432\u0430\u044e\u0442\u0441\u044f \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f\u043c\u0438 USN, \u043e\u0431\u044a\u0435\u043a\u0442 \u0441 \u0431\u043e\u043b\u0435\u0435 \u043d\u0438\u0437\u043a\u0438\u043c USN \u043f\u0440\u0438 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u0431\u0443\u0434\u0435\u0442 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0438\u0441\u0430\u043d \u0432\u044b\u0441\u043e\u043a\u0438\u043c USN. repadmin repadmin /replsummary \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u0442 \u0432\u0440\u0435\u043c\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0439 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u043d\u0430 \u0432\u0441\u0435\u0445 DC \u043f\u043e \u043d\u0430\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u044e (Source \u0438 Destination) \u0438 \u0438\u0445 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0441 \u0443\u0447\u0435\u0442\u043e\u043c \u043f\u0430\u0440\u0442\u043d\u0435\u0440\u043e\u0432 \\ repadmin /showrepl $srv \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u0442 \u0432\u0441\u0435\u0445 \u043f\u0430\u0440\u0442\u043d\u0435\u0440\u043e\u0432 \u043f\u043e \u0440\u0435\u043f\u043b\u043a\u0430\u0446\u0438\u0438 \u0438 \u0438\u0445 \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043b\u044f \u0432\u0441\u0435\u0445 \u0440\u0430\u0437\u0434\u0435\u043b\u043e\u0432 Naming Contexts (DC=ForestDnsZones, DC=DomainDnsZones, CN=Schema, CN=Configuration) \\ repadmin /replicate $srv2 $srv1 DC=domain,DC=local \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u044e \u0441 $srv1 \u043d\u0430 $srv2 \u0442\u043e\u043b\u044c\u043a\u043e \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u0439 \u0440\u0430\u0437\u0434\u0435\u043b\u0430 \u0434\u043e\u043c\u0435\u043d\u0430 \\ repadmin /SyncAll /AdeP \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u043c\u0435\u0436\u0441\u0430\u0439\u0442\u043e\u0432\u0443\u044e \u0438\u0441\u0445\u043e\u0434\u044f\u0449\u0443\u044e \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u044e \u0432\u0441\u0435\u0445 \u0440\u0430\u0437\u0434\u0435\u043b\u043e\u0432 \u043e\u0442 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u0441\u043e \u0432\u0441\u0435\u043c\u0438 \u043f\u0430\u0440\u0442\u043d\u0435\u0440\u0430\u043c\u0438 \u043f\u043e \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ /A \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0434\u043b\u044f \u0432\u0441\u0435\u0445 \u0440\u0430\u0437\u0434\u0435\u043b\u043e\u0432 NC \\ /d \u0432 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f\u0445 \u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u0446\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u0435\u0440\u0432\u0435\u0440\u044b \u043f\u043e DN (\u0432\u043c\u0435\u0441\u0442\u043e GUID DNS - \u0433\u043b\u043e\u0431\u0430\u043b\u044c\u043d\u044b\u043c \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u043c \u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440\u0430\u043c) \\ /e \u043c\u0435\u0436\u0441\u0430\u0439\u0442\u043e\u0432\u0430\u044f \u0441\u0438\u043d\u0445\u0440\u043e\u043d\u0438\u0437\u0430\u0446\u0438\u044f (\u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \u0441\u0438\u043d\u0445\u0440\u043e\u043d\u0438\u0437\u0438\u0440\u0443\u0435\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u0441 DC \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u0441\u0430\u0439\u0442\u0430) \\ /P \u0438\u0437\u0432\u0435\u0449\u0430\u0442\u044c \u043e\u0431 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f\u0445 \u0441 \u044d\u0442\u043e\u0433\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u0430 (\u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e: \u043e\u043f\u0440\u0430\u0448\u0438\u0432\u0430\u0442\u044c \u043e\u0431 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f\u0445) \\ repadmin /Queue $srv \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u0442 \u043a\u043e\u043b-\u0432\u043e \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 \u0432\u0445\u043e\u0434\u044f\u0449\u0435\u0439 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 (\u043e\u0447\u0435\u0440\u0435\u0434\u044c), \u043a\u043e\u0442\u043e\u0440\u043e\u0435 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c (\u043f\u0440\u0438\u0447\u0438\u043d\u043e\u0439 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u0431\u043e\u043b\u044c\u0448\u043e\u0435 \u043a\u043e\u043b-\u0432\u043e \u043f\u0430\u0440\u0442\u043d\u0435\u0440\u043e\u0432 \u0438\u043b\u0438 \u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 1000 \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 \u0441\u043a\u0440\u0438\u043f\u0442\u043e\u043c) \\ repadmin /showbackup * \u0443\u0437\u043d\u0430\u0442\u044c \u0434\u0430\u0442\u0443 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e Backup Error: 1722 \u0441\u0435\u0440\u0432\u0435\u0440 rpc \u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d (\u043e\u0448\u0438\u0431\u043a\u0430 \u043e\u0442\u043a\u0430\u0442\u0430 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438). \u041f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0438\u043c\u044f \u0434\u043e\u043c\u0435\u043d\u0430 \u0432 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430\u0445 \u0441\u0435\u0442\u0435\u0432\u043e\u0433\u043e \u0430\u0434\u0430\u043f\u0442\u0435\u0440\u0430, \u043f\u0435\u0440\u0432\u044b\u043c \u0434\u043e\u043b\u0436\u0435\u043d \u0438\u0434\u0442\u0438 \u0430\u0434\u0440\u0435\u0441 DNS-\u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u0434\u0440\u0443\u0433\u043e\u0433\u043e \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0430 \u0434\u043e\u043c\u0435\u043d\u0430, \u0432\u0442\u043e\u0440\u044b\u043c \u0441\u0432\u043e\u0439 \u0430\u0434\u0440\u0435\u0441. \\ Get-Service -ComputerName $srv | select name,status | ? name -like \"RpcSs\" \\ Get-Service -ComputerName $srv -Name RpcSs -RequiredServices \u0437\u0430\u0432\u0438\u0441\u0438\u043c\u044b\u0435 \u0441\u043b\u0443\u0436\u0431\u044b \\ \u0417\u0430\u0432\u0438\u0441\u0438\u043c\u044b\u0435 \u0441\u043b\u0443\u0436\u0431\u044b RPC: \\ \"\u0421\u043b\u0443\u0436\u0431\u0430 \u0441\u0432\u0435\u0434\u0435\u043d\u0438\u0439 \u043e \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u043d\u044b\u0445 \u0441\u0435\u0442\u044f\u0445\" - \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u0432\u043a\u043b\u044e\u0447\u0435\u043d \u043e\u0442\u043b\u043e\u0436\u0435\u043d\u043d\u044b\u0439 \u0437\u0430\u043f\u0443\u0441\u043a. \u0415\u0441\u043b\u0438 \u0441\u043b\u0443\u0436\u0431\u0430 \u0441\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u0435\u0442 \u0434\u043e \"\u0441\u043b\u0443\u0436\u0431\u044b \u0441\u043f\u0438\u0441\u043a\u0430 \u0441\u0435\u0442\u0435\u0439\", \u043c\u043e\u0436\u0435\u0442 \u043f\u0430\u0434\u0430\u0442\u044c \u0441\u0432\u044f\u0437\u044c \u0441 \u0434\u043e\u043c\u0435\u043d\u043e\u043c (netlogon) \\ \"\u0426\u0435\u043d\u0442\u0440 \u0440\u0430\u0441\u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u043a\u043b\u044e\u0447\u0435\u0439 Kerberos\" \\ \"DNS-\u0441\u0435\u0440\u0432\u0435\u0440\" \\ nslookup $srv \\ tnc $srv -p 135 \\ repadmin /retry \u043f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u044c \u043f\u043e\u043f\u044b\u0442\u043a\u0443 \u043f\u0440\u0438\u0432\u044f\u0437\u043a\u0438 \u043a \u0446\u0435\u043b\u0435\u0432\u043e\u043c\u0443 DC, \u0435\u0441\u043b\u0438 \u0431\u044b\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430 1722 \u0438\u043b\u0438 1753 (RPC \u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d) repadmin /showrepl $srv \\ Last attempt @ 2022-07-15 10:46:01 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0430 \u0441 \u043e\u0448\u0438\u0431\u043a\u043e\u0439, \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 8456 (0x2108) \u043f\u0440\u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 showrepl \u044d\u0442\u043e\u0433\u043e \u043f\u0430\u0440\u0442\u043d\u0435\u0440\u0430, \u0435\u0433\u043e \u043e\u0448\u0438\u0431\u043a\u0430: 8457 (0x2109) \\ Last success @ 2022-07-11 02:29:46 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0439 \u0443\u0441\u043f\u0435\u0445 \\ \u041a\u043e\u0433\u0434\u0430 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u044f \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u043e\u0442\u043a\u043b\u044e\u0447\u0435\u043d\u0430, \u041e\u0421 \u0437\u0430\u043f\u0438\u0441\u044b\u0432\u0430\u0435\u0442 \u0432 DSA - not writable \u043e\u0434\u043d\u043e \u0438\u0437 \u0447\u0435\u0442\u044b\u0440\u0435\u0445 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439: \\ Path: HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Services\\NTDS\\Parameters \\ Dsa Not Writable \\ #define DSA_WRITABLE_GEN 1 \u0432\u0435\u0440\u0441\u0438\u044f \u043b\u0435\u0441\u0430 \u043d\u0435\u0441\u043e\u0432\u043c\u0435\u0441\u0442\u0438\u043c\u0430 \u0441 \u041e\u0421 \\ #define DSA_WRITABLE_NO_SPACE 2 \u043d\u0430 \u0434\u0438\u0441\u043a\u0435, \u0433\u0434\u0435 \u0440\u0430\u0437\u043c\u0435\u0449\u0435\u043d\u0430 \u0431\u0430\u0437\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 Active Directory \u0438\u043b\u0438 \u0444\u0430\u0439\u043b\u044b \u0436\u0443\u0440\u043d\u0430\u043b\u043e\u0432 (\u043b\u043e\u0433\u0438), \u043d\u0435\u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u043e \u0441\u0432\u043e\u0431\u043e\u0434\u043d\u043e\u0433\u043e \u043c\u0435\u0441\u0442\u0430 \\ #define DSA_WRITABLE_USNROLLBCK 4 \u043e\u0442\u043a\u0430\u0442 USN \u043f\u0440\u043e\u0438\u0437\u043e\u0448\u0435\u043b \u0438\u0437-\u0437\u0430 \u043d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u0433\u043e \u043e\u0442\u043a\u0430\u0442\u0430 \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 Active Directory \u0432\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438 (\u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0438\u0437 \u0441\u043d\u0430\u043f\u0448\u043e\u0442\u0430) \\ #define DSA_WRITABLE_CORRUPT_UTDV 8 \u0432\u0435\u043a\u0442\u043e\u0440 \u0430\u043a\u0442\u0443\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u0438 \u043f\u043e\u0432\u0440\u0435\u0436\u0434\u0435\u043d \u043d\u0430 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u043e\u043c \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0435 \u0434\u043e\u043c\u0435\u043d\u0430 dcdiag dcdiag /s:<DomainController> [/n:<NamingContext>] [[/u:<domain\\user>] [/p:<password>]] [{/a|/e}{/q|/v}] [/f:<LogFile>] [/ferr:<ErrorLog>] [/test:<test>] [/fix] \\ dcdiag /Test:replications /s:dc-01 \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u0442 \u043e\u0448\u0438\u0431\u043a\u0438 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ dcdiag /Test:DNS /e /v /q \u0442\u0435\u0441\u0442 DNS \\ /a \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0432\u0441\u0435\u0445 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u0432 \u0434\u0430\u043d\u043d\u043e\u0433\u043e \u0441\u0430\u0439\u0442\u0430 \\ /e \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0432\u0441\u0435\u0445 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u0432 \u043f\u0440\u0435\u0434\u043f\u0440\u0438\u044f\u0442\u0438\u044f \\ /q \u0432\u044b\u0432\u043e\u0434\u0438\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u043e\u0431 \u043e\u0448\u0438\u0431\u043a\u0430\u0445 \\ /v \u0432\u044b\u0432\u043e\u0434\u0438\u0442\u044c \u043f\u043e\u0434\u0440\u043e\u0431\u043d\u0443\u044e \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \\ /fix \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u0438\u0441\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u043e\u0448\u0438\u0431\u043a\u0438 \\ /test: \\ NetLogons \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u043f\u0440\u0430\u0432 \u043d\u0430 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Connectivity \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044e DNS \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0430 \u0434\u043e\u043c\u0435\u043d\u0430, \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u0442\u0435\u0441\u0442\u043e\u0432\u044b\u0439 \u044d\u0445\u043e-\u043f\u0430\u043a\u0435\u0442 \u043d\u0430 \u043a\u0430\u0436\u0434\u044b\u0439 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440 \u0434\u043e\u043c\u0435\u043d\u0430 \u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u043f\u043e \u043f\u0440\u043e\u0442\u043e\u043a\u043e\u043b\u0430\u043c LDAP \u0438 RPC \u043a \u043a\u0430\u0436\u0434\u043e\u043c\u0443 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0443 \u0434\u043e\u043c\u0435\u043d\u0430 \\ Services \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u0440\u0430\u0431\u043e\u0442\u043e\u0441\u043f\u043e\u0441\u043e\u0431\u043d\u043e\u0441\u0442\u044c \u0432\u0441\u0435\u0445 \u0441\u043b\u0443\u0436\u0431, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u044b\u0445 \u0434\u043b\u044f \u0440\u0430\u0431\u043e\u0442\u044b \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0430 \u0434\u043e\u043c\u0435\u043d\u0430, \u043d\u0430 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u043c \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0435 \u0434\u043e\u043c\u0435\u043d\u0430 \\ Systemlog \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u043e\u0448\u0438\u0431\u043e\u043a \u0432 \u0436\u0443\u0440\u043d\u0430\u043b\u0430\u0445 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0430 \u0434\u043e\u043c\u0435\u043d\u0430 \\ FRSEvent \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u043e\u0448\u0438\u0431\u043a\u0438 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u0432 \u0440\u0430\u0431\u043e\u0442\u0435 \u0441\u043b\u0443\u0436\u0431\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u0444\u0430\u0439\u043b\u043e\u0432, \u0447\u0442\u043e \u043c\u043e\u0436\u0435\u0442 \u043e\u0437\u043d\u0430\u0447\u0430\u0442\u044c \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u043f\u0440\u043e\u0431\u043b\u0435\u043c \u0432 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 SYSVOL \u0438, \u0442\u0430\u043a\u0438\u043c \u043e\u0431\u0440\u0430\u0437\u043e\u043c, \u0446\u0435\u043b\u043e\u0441\u0442\u043d\u043e\u0441\u0442\u0438 \u043a\u043e\u043f\u0438\u0439 \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 \u0433\u0440\u0443\u043f\u043f\u043e\u0432\u044b\u0445 \u043f\u043e\u043b\u0438\u0442\u0438\u043a \\ FSMOCheck \u043d\u0435 \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u0440\u043e\u043b\u0438 \u0445\u043e\u0437\u044f\u0435\u0432 \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0439, \u0430 \u0432\u043c\u0435\u0441\u0442\u043e \u044d\u0442\u043e\u0433\u043e \u0437\u0430\u043f\u0440\u0430\u0448\u0438\u0432\u0430\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\u0440 \u0433\u043b\u043e\u0431\u0430\u043b\u044c\u043d\u043e\u0433\u043e \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0430, \u043f\u0435\u0440\u0432\u0438\u0447\u043d\u044b\u0439 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440 \u0434\u043e\u043c\u0435\u043d\u0430, \u043f\u0440\u0435\u0434\u043f\u043e\u0447\u0442\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u0441\u0435\u0440\u0432\u0435\u0440 \u0432\u0440\u0435\u043c\u0435\u043d\u0438, \u0441\u0435\u0440\u0432\u0435\u0440 \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0438 \u0446\u0435\u043d\u0442\u0440 \u0440\u0430\u0441\u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u043a\u043b\u044e\u0447\u0435\u0439 (\u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440 \u0434\u043e\u043c\u0435\u043d\u0430 \u043c\u043e\u0436\u0435\u0442 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f \u043a KDC, PDC, \u0441\u0435\u0440\u0432\u0435\u0440\u0443 \u0433\u043b\u043e\u0431\u0430\u043b\u044c\u043d\u043e\u0433\u043e \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0430) \\ KnowsOfRoleHolders \u043fg\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u044c \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u043e\u0432 \u0434\u043e\u043c\u0435\u043d\u0430 \u043a\u043e \u0432\u0441\u0435\u043c \u043f\u044f\u0442\u0438 \u0445\u043e\u0437\u044f\u0435\u0432\u0430\u043c \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0439 (\u0440\u043e\u043b\u044f\u043c\u0438 FSMO) \\ MachineAccount \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u0443\u0447\u0435\u0442\u043d\u043e\u0439 \u0437\u0430\u043f\u0438\u0441\u0438 \u0446\u0435\u043b\u0435\u0432\u043e\u0433\u043e \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0430 \u0438 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u043e\u0431\u044a\u044f\u0432\u043b\u0435\u043d\u0438\u0439 \u0441\u043b\u0443\u0436\u0431 \u044d\u0442\u043e\u0433\u043e \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0430 (\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e\u0441\u0442\u044c \u0434\u043e\u0432\u0435\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u043e\u0442\u043d\u043e\u0448\u0435\u043d\u0438\u044f \u0441 \u0434\u043e\u043c\u0435\u043d\u043e\u043c). \u0415\u0441\u043b\u0438 \u043e\u0431\u043d\u0430\u0440\u0443\u0436\u0435\u043d\u0430 \u043e\u0448\u0438\u0431\u043a\u0430, \u0435\u0435 \u043c\u043e\u0436\u043d\u043e \u0438\u0441\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0443\u0442\u0438\u043b\u0438\u0442\u044b dcdiag, \u0443\u043a\u0430\u0437\u0430\u0432 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b /fixmachineaccount \u0438\u043b\u0438 /recreatemachineaccount \\ Advertising \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442, \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e \u043b\u0438 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440 \u0434\u043e\u043c\u0435\u043d\u0430 \u0441\u043e\u043e\u0431\u0449\u0430\u0435\u0442 \u043e \u0441\u0435\u0431\u0435 \u0438 \u043e \u0441\u0432\u043e\u0435\u0439 \u0440\u043e\u043b\u0438 \u0445\u043e\u0437\u044f\u0438\u043d\u0430 \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0439. \u042d\u0442\u043e\u0442 \u0442\u0435\u0441\u0442 \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c\u0441\u044f \u043d\u0435\u0443\u0434\u0430\u0447\u043d\u043e, \u0435\u0441\u043b\u0438 \u0441\u043b\u0443\u0436\u0431\u0430 NetLogon \u043d\u0435 \u0437\u0430\u043f\u0443\u0449\u0435\u043d\u0430 \\ CheckSDRefDom \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0434\u043e\u043c\u0435\u043d\u043e\u0432 \u0441\u0441\u044b\u043b\u043e\u043a \u0434\u0435\u0441\u043a\u0440\u0438\u043f\u0442\u043e\u0440\u043e\u0432 \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u0438 \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0440\u0430\u0437\u0434\u0435\u043b\u0430 \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u043e\u0432 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c \\ CrossRefValidation \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u043f\u0435\u0440\u0435\u043a\u0440\u0435\u0441\u0442\u043d\u044b\u0445 \u0441\u0441\u044b\u043b\u043e\u043a \u0434\u043b\u044f \u0434\u043e\u043c\u0435\u043d\u043e\u0432 \\ RRSSysvol \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0433\u043e\u0442\u043e\u0432\u043d\u043e\u0441\u0442\u0438 \u0434\u043b\u044f FRS SYSVOL \\ Intersite \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u043e\u0448\u0438\u0431\u043e\u043a, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043c\u043e\u0433\u0443\u0442 \u043f\u043e\u043c\u0435\u0448\u0430\u0442\u044c \u043d\u043e\u0440\u043c\u0430\u043b\u044c\u043d\u043e\u0439 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u043c\u0435\u0436\u0434\u0443 \u0441\u0430\u0439\u0442\u0430\u043c\u0438. \u041a\u043e\u043c\u043f\u0430\u043d\u0438\u044f Microsoft \u043f\u0440\u0435\u0434\u0443\u043f\u0440\u0435\u0436\u0434\u0430\u0435\u0442, \u0447\u0442\u043e \u0438\u043d\u043e\u0433\u0434\u0430 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b \u044d\u0442\u043e\u0433\u043e \u0442\u0435\u0441\u0442\u0430 \u043c\u043e\u0433\u0443\u0442 \u043e\u043a\u0430\u0437\u0430\u0442\u044c\u0441\u044f \u043d\u0435\u0442\u043e\u0447\u043d\u044b\u043c\u0438 \\ KCCEvent \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u0431\u0435\u0437\u043e\u0448\u0438\u0431\u043e\u0447\u043d\u043e\u0441\u0442\u044c \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0439 \u0434\u043b\u044f \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u043c\u0435\u0436\u0434\u0443 \u0441\u0430\u0439\u0442\u0430\u043c\u0438 \\ NCSecDesc \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u0439 \u0434\u043b\u044f \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u0432 \u0434\u0435\u0441\u043a\u0440\u0438\u043f\u0442\u043e\u0440\u0430\u0445 \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u0438 \u0434\u043b\u044f \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u043e\u0432 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u0430 \u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u044f \\ ObjectsReplicated \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u0430\u0433\u0435\u043d\u0442\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u043e\u0432 \u0438 \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 \u0443\u0447\u0435\u0442\u043d\u044b\u0445 \u0437\u0430\u043f\u0438\u0441\u0435\u0439 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u043e\u0432 \\ OutboundSecureChannels \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442\u0441\u044f \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u044b\u0445 \u043a\u0430\u043d\u0430\u043b\u043e\u0432 \u043c\u0435\u0436\u0434\u0443 \u0432\u0441\u0435\u043c\u0438 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0430\u043c\u0438 \u0434\u043e\u043c\u0435\u043d\u0430 \u0432 \u0438\u043d\u0442\u0435\u0440\u0435\u0441\u0443\u044e\u0449\u0435\u043c \u0434\u043e\u043c\u0435\u043d\u0435 \\ Replications \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u044c \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u043c\u0435\u0436\u0434\u0443 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0430\u043c\u0438 \u0434\u043e\u043c\u0435\u043d\u0430 \u0438 \u0441\u043e\u043e\u0431\u0449\u0430\u0435\u0442 \u043e\u0431\u043e \u0432\u0441\u0435\u0445 \u043e\u0448\u0438\u0431\u043a\u0430\u0445 \u043f\u0440\u0438 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ RidManager \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u0440\u0430\u0431\u043e\u0442\u043e\u0441\u043f\u043e\u0441\u043e\u0431\u043d\u043e\u0441\u0442\u044c \u0438 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u043e\u0441\u0442\u044c \u0445\u043e\u0437\u044f\u0438\u043d\u0430 \u043e\u0442\u043d\u043e\u0441\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440\u043e\u0432 \\ VerifyEnterpriseReferences \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u044b\u0445 \u0441\u0441\u044b\u043b\u043e\u043a \u0441\u043b\u0443\u0436\u0431\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u0444\u0430\u0439\u043b\u043e\u0432 \u0434\u043b\u044f \u0432\u0441\u0435\u0445 \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 \u043d\u0430 \u0432\u0441\u0435\u0445 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0430\u0445 \u0434\u043e\u043c\u0435\u043d\u0430 \u0432 \u043b\u0435\u0441\u0443 \\ VerifyReferences \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u044b\u0445 \u0441\u0441\u044b\u043b\u043e\u043a \u0441\u043b\u0443\u0436\u0431\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u0444\u0430\u0439\u043b\u043e\u0432 \u0434\u043b\u044f \u0432\u0441\u0435\u0445 \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 \u043d\u0430 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u043c \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0435 \u0434\u043e\u043c\u0435\u043d\u0430 \\ VerifyReplicas \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0432\u0441\u0435\u0445 \u0440\u0430\u0437\u0434\u0435\u043b\u043e\u0432 \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0430 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f \u043d\u0430 \u0432\u0441\u0435\u0445 \u0441\u0435\u0440\u0432\u0435\u0440\u0430\u0445, \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u044e\u0449\u0438\u0445 \u0443\u0447\u0430\u0441\u0442\u0438\u0435 \u0432 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 ntdsutil \u041f\u0435\u0440\u0435\u043d\u043e\u0441 \u0411\u0414 AD (ntds.dit): \\ Get-Acl C:\\Windows\\NTDS | Set-Acl D:\\AD-DB \u0441\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c NTFS \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u044f \u043d\u0430 \u043d\u043e\u0432\u044b\u0439 \u043a\u0430\u0442\u0430\u043b\u043e\u0433 \\ Stop-Service -ComputerName dc -name NTDS \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0441\u043b\u0443\u0436\u0431\u0443 Active Directory Domain Services \\ ntdsutil \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0443\u0442\u0438\u043b\u0438\u0442\u0443 ntdsutil \\ activate instance NTDS \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0439 \u044d\u043a\u0437\u0435\u043c\u043f\u043b\u044f\u0440 \u0431\u0430\u0437\u044b AD \\ files \u043f\u0435\u0440\u0435\u0439\u0434\u0435\u043c \u0432 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442 files, \u0432 \u043a\u043e\u0442\u043e\u0440\u043e\u043c \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u044f \u0441 \u0444\u0430\u0439\u043b\u0430\u043c\u0438 \u0431\u0430\u0437\u044b ntds.dit \\ move DB to D:\\AD-DB\\ \u043f\u0435\u0440\u0435\u043d\u0435\u0441\u0442\u0438 \u0431\u0430\u0437\u0443 AD \u0432 \u043d\u043e\u0432\u044b\u0439 \u043a\u0430\u0442\u0430\u043b\u043e\u0433 (\u043f\u0440\u0435\u0434\u0432\u0430\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u043d\u0443\u0436\u043d\u043e \u0435\u0433\u043e \u0441\u043e\u0437\u0434\u0430\u0442\u044c) \\ info \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c, \u0447\u0442\u043e \u0411\u0414 \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u0432 \u043d\u043e\u0432\u043e\u043c \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0435 \\ move logs to D:\\AD-DB\\ \u043f\u0435\u0440\u0435\u043c\u0435\u0441\u0442\u0438\u043c \u0432 \u0442\u043e\u0442 \u0436\u0435 \u043a\u0430\u0442\u0430\u043b\u043e\u0433 \u0444\u0430\u0439\u043b\u044b \u0441 \u0436\u0443\u0440\u043d\u0430\u043b\u0430\u043c\u0438 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439 \\ quit \\ Start-Service -ComputerName dc -name NTDS \u0421\u0431\u0440\u043e\u0441 \u043f\u0430\u0440\u043e\u043b\u044f DSRM (\u0440\u0435\u0436\u0438\u043c \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0441\u043b\u0443\u0436\u0431 \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u043e\u0432): \\ ntdsutil \\ set dsrm password \\ reset password on server NULL \\ \u043d\u043e\u0432\u044b\u0439 \u043f\u0430\u0440\u043e\u043b\u044c \\ \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u0435 \u043f\u0430\u0440\u043e\u043b\u044f \\ quit \\ quit \u0421\u0438\u043d\u0445\u0440\u043e\u043d\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441 \u043f\u0430\u0440\u043e\u043b\u0435\u043c \u0423\u0417 \u0432 AD: \\ ntdsutil \\ set dsrm password \\ sync from domain account dsrmadmin \\ quit \\ quit \u041e\u0448\u0438\u0431\u043a\u0430 0x00002e2 \u043f\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0435 \u041e\u0421. \\ \u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c\u0441\u044f \u0432 \u0440\u0435\u0436\u0438\u043c\u0435 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0435\u043d\u0438\u044f WinRE (Windows Recovery Environment) - Startup Settings - Restart - DSRM (Directory Services Restore Mode) \\ reagentc /boottore shutdown /f /r /o /t 0 \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0432 \u0440\u0435\u0436\u0438\u043c\u0435 WinRE - \u041e\u0421 \u043d\u0430 \u0431\u0430\u0437\u0435 WinPE (Windows Preinstallation Environment), \u043e\u0431\u0440\u0430\u0437 winre.wim \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u043d\u0430 \u0441\u043a\u0440\u044b\u0442\u043e\u043c \u0440\u0430\u0437\u0434\u0435\u043b\u0435 System Restore \\ \u041d\u0430 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0435 \u0434\u043e\u043c\u0435\u043d\u0430 \u0435\u0434\u0438\u043d\u0441\u0442\u0432\u0435\u043d\u043d\u0430\u044f \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u0430\u044f \u0443\u0447\u0435\u0442\u043d\u0430\u044f \u0437\u0430\u043f\u0438\u0441\u044c \u2014 \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440 DSRM. \u041f\u0430\u0440\u043e\u043b\u044c \u0441\u043e\u0437\u0434\u0430\u0435\u0442\u0441\u044f \u043f\u0440\u0438 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0435 \u0440\u043e\u043b\u0438 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0430 \u0434\u043e\u043c\u0435\u043d\u0430 ADDS \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435 (SafeModeAdministratorPassword). \\ ntdsutil \\ activate instance ntds \\ Files \\ Info \\ integrity \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0446\u0435\u043b\u043e\u0441\u0442\u043d\u043e\u0441\u0442\u044c \u0411\u0414 \\ \u041e\u0448\u0438\u0431\u043a\u0430: Failed to open DIT for AD DS/LDS instance NTDS. Error -2147418113 \\ mkdir c:\\ntds_bak \\ xcopy c:\\Windows\\NTDS\\*.* c:\\ntds_bak backup \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0433\u043e \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0430 \u0441 \u0411\u0414 \\ esentutl /g c:\\windows\\ntds\\ntds.dit \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u043c \u0446\u0435\u043b\u043e\u0441\u0442\u043d\u043e\u0441\u0442\u044c \u0444\u0430\u0439\u043b\u0430 \\ \u0412\u044b\u0432\u043e\u0434: Integrity check completed. Database is CORRUPTED \u043e\u0448\u0438\u0431\u043a\u0430, \u0431\u0430\u0437\u0430 AD \u043f\u043e\u0432\u0440\u0435\u0436\u0434\u0435\u043d\u0430 \\ esentutl /p c:\\windows\\ntds\\ntds.dit \u0438\u0441\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u043e\u0448\u0438\u0431\u043a\u0438 \\ \u0412\u044b\u0432\u043e\u0434: Operation completed successfully in xx seconds. \u043d\u0435\u0442 \u043e\u0448\u0438\u0431\u043e\u043a \\ esentutl /g c:\\windows\\ntds\\ntds.dit \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u043c \u0446\u0435\u043b\u043e\u0441\u0442\u043d\u043e\u0441\u0442\u044c \u0444\u0430\u0439\u043b\u0430 \\ \u0412\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0430\u043d\u0430\u043b\u0438\u0437 \u0441\u0435\u043c\u0430\u043d\u0442\u0438\u043a\u0438 \u0431\u0430\u0437\u044b \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e ntdsutil: \\ ntdsutil \\ activate instance ntds \\ semantic database analysis \\ go \\ go fixup \u0438\u0441\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0441\u0435\u043c\u0430\u043d\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u043e\u0448\u0438\u0431\u043a\u0438 \\ \u0421\u0436\u0430\u0442\u044c \u0444\u0430\u0439\u043b \u0411\u0414: \\ activate instance ntds \\ files \\ compact to C:\\Windows\\NTDS\\TEMP \\ copy C:\\Windows\\NTDS\\TEMP\\ntds.dit C:\\Windows\\NTDS\\ntds.dit \u0437\u0430\u043c\u0435\u043d\u0438\u0442\u044c \u043e\u0440\u0438\u0433\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u0439 \u0444\u0430\u0439\u043b ntds.dit \\ Del C:\\Windows\\NTDS\\*.log \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u0441\u0435 \u043b\u043e\u0433 \u0444\u0430\u0439\u043b\u044b \u0438\u0437 \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0430 NTDS GPO Get-Command -Module GroupPolicy \\ Get-GPO -Domain domain.local -All | ft \\ Get-GPO -Name LAPS \\ [xml](Get-GPOReport LAPS -ReportType Xml) \\ Get-GPPermission -Name LAPS -All \\ Get-GPO LAPS | New-GPLink -Target \"ou=servers,dc=domain,dc=local\" \\ Set-GPLink -Name LAPS -Target \"ou=servers,dc=domain,dc=local\" -LinkEnabled No \\ Backup-GPO -Name LAPS -Path \"$home\\Desktop\" \\ Backup-GPO -All -Path \"$home\\Desktop\" \\ Restore-GPO -Name LAPS -Path C:\\Backup\\GPOs\\ ServerManager Get-Command *WindowsFeature* source module ServerManager \\ Get-WindowsFeature -ComputerName \"localhost\" \\ Get-WindowsFeature | where Installed -eq $True \u0441\u043f\u0438\u0441\u043e\u043a \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044b\u0445 \u0440\u043e\u043b\u0435\u0439 \u0438 \u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u043e\u0432 \\ Get-WindowsFeature | where FeatureType -eq \"Role\" \u043e\u0442\u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u043e \u0441\u043f\u0438\u0441\u043a\u0443 \u0440\u043e\u043b\u0435\u0439 \\ Install-WindowsFeature -Name DNS \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0440\u043e\u043b\u044c \\ Get-Command *DNS* \\ Get-DnsServerSetting -ALL \\ Uninstall-WindowsFeature -Name DNS \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0440\u043e\u043b\u044c PSWA Install-WindowsFeature -Name WindowsPowerShellWebAccess -IncludeManagementTools \\ Install-PswaWebApplication -UseTestCertificate \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0432\u0435\u0431-\u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435 /pswa \\ Add-PswaAuthorizationRule -UserGroupName \"$domain\\Domain Admins\" -ComputerName * -ConfigurationName * -RuleName \"For Admins\" \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043f\u0440\u0430\u0432\u0430 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438 WSB (Windows Server Backup) \u041f\u0440\u0438 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0438 backup DC \u0447\u0435\u0440\u0435\u0437 WSB, \u0441\u043e\u0437\u0434\u0430\u0435\u0442\u0441\u044f \u043a\u043e\u043f\u0438\u044f \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f \u0441\u0438\u0441\u0442\u0435\u043c\u044b (System State), \u043a\u0443\u0434\u0430 \u043f\u043e\u043f\u0430\u0434\u0430\u0435\u0442 \u0431\u0430\u0437\u0430 AD (NTDS.DIT), \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u0433\u0440\u0443\u043f\u043f\u043e\u0432\u044b\u0445 \u043f\u043e\u043b\u0438\u0442\u0438\u043a, \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0430 SYSVOL, \u0440\u0435\u0435\u0441\u0442\u0440, \u043c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u0435 IIS, \u0431\u0430\u0437\u0430 AD CS, \u0438 \u0434\u0440\u0443\u0433\u0438\u0435 \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u044b\u0435 \u0444\u0430\u0439\u043b\u044b \u0438 \u0440\u0435\u0441\u0443\u0440\u0441\u044b. \u0420\u0435\u0437\u0435\u0440\u0432\u043d\u0430\u044f \u043a\u043e\u043f\u0438\u044f \u0441\u043e\u0437\u0434\u0430\u0435\u0442\u0441\u044f \u0447\u0435\u0440\u0435\u0437 \u0441\u043b\u0443\u0436\u0431\u0443 \u0442\u0435\u043d\u0435\u0432\u043e\u0433\u043e \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f VSS. \\ Get-WindowsFeature Windows-Server-Backup \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0430 \u043b\u0438 \u0440\u043e\u043b\u044c \\ Add-Windowsfeature Windows-Server-Backup \u2013Includeallsubfeature \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0440\u043e\u043b\u044c $path=\"\\\\$srv\\bak-dc\\dc-03\\\" [string]$TargetUNC=$path+(get-date -f 'yyyy-MM-dd') if ((Test-Path -Path $path) -eq $true) {New-Item -Path $TargetUNC -ItemType directory} # \u0435\u0441\u043b\u0438 \u043f\u0443\u0442\u044c \u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d, \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043d\u043e\u0432\u0443\u044e \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u044e \u043f\u043e \u0434\u0430\u0442\u0435 $WBadmin_cmd = \"wbadmin.exe START BACKUP -backupTarget:$TargetUNC -systemState -noverify -vssCopy -quiet\" # $WBadmin_cmd = \"wbadmin start backup -backuptarget:$path -include:C:\\Windows\\NTDS\\ntds.dit -quiet\" # Backup DB NTDS Invoke-Expression $WBadmin_cmd RDS Get-Command -Module RemoteDesktop \\ Get-RDServer -ConnectionBroker $broker \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u0432 \u0432 \u0444\u0435\u0440\u043c\u0435\u044b, \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u043f\u043e\u043b\u043d\u043e\u0435 \u0434\u043e\u043c\u0435\u043d\u043d\u043e\u0435 \u0438\u043c\u044f \u043f\u0440\u0438 \u043e\u0431\u0440\u0430\u0449\u0435\u043d\u0438\u0435 \u043a \u0441\u0435\u0440\u0432\u0435\u0440\u0443 \u0441 \u0440\u043e\u043b\u044c\u044e RDCB \\ Get-RDRemoteDesktop -ConnectionBroker $broker \u0441\u043f\u0438\u0441\u043e\u043a \u043a\u043e\u043b\u043b\u0435\u043a\u0446\u0438\u0439 \\ (Get-RDLicenseConfiguration -ConnectionBroker $broker | select *).LicenseServer \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u0432 \u0441 \u0440\u043e\u043b\u044c\u044e RDL \\ Get-RDUserSession -ConnectionBroker $broker \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0445 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \\ Disconnect-RDUser -HostServer $srv -UnifiedSessionID $id -Force \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0441\u0435\u0441\u0441\u0438\u044e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \\ Get-RDAvailableApp -ConnectionBroker $broker -CollectionName C03 \u0441\u043f\u0438\u0441\u043e\u043a \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u043e\u0433\u043e \u041f\u041e \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430\u0445 \u0432 \u043a\u043e\u043b\u043b\u0435\u043a\u0446\u0438\u0438 \\ (Get-RDSessionCollectionConfiguration -ConnectionBroker $broker -CollectionName C03 | select *).CustomRdpProperty use redirection server name:i:1 \\ Get-RDConnectionBrokerHighAvailability DNSServer Get-Command -Module DnsServer \\ Show-DnsServerCache \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0435\u0441\u044c \u043a\u044d\u0448 DNS-\u0441\u0435\u0440\u0432\u0435\u0440\u0430 \\ Show-DnsServerCache | where HostName -match ru \\ Clear-DnsServerCache \\ Get-DnsServerCache \\ Get-DnsServerDiagnostics $zone = icm $srv {Get-DnsServerZone} | select ZoneName,ZoneType,DynamicUpdate,ReplicationScope,SecureSecondaries, DirectoryPartitionName | Out-GridView -Title \"DNS Server: $srv\" \u2013PassThru $zone_name = $zone.ZoneName if ($zone_name -ne $null) { icm $srv {Get-DnsServerResourceRecord -ZoneName $using:zone_name | sort RecordType | select RecordType,HostName, @{ Label=\"IPAddress\"; Expression={$_.RecordData.IPv4Address.IPAddressToString}},TimeToLive,Timestamp } | select RecordType,HostName,IPAddress,TimeToLive,Timestamp | Out-GridView -Title \"DNS Server: $srv\" } Sync-DnsServerZone \u2013passthru \u0441\u0438\u043d\u0445\u0440\u043e\u043d\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0437\u043e\u043d\u044b \u0441 \u0434\u0440\u0443\u0433\u0438\u043c\u0438 DC \u0432 \u0434\u043e\u043c\u0435\u043d\u0435 \\ Remove-DnsServerZone -Name domain.local \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0437\u043e\u043d\u0443 \\ Get-DnsServerResourceRecord -ZoneName domain.local -RRType A \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u0432\u0441\u0435 \u0410-\u0437\u0430\u043f\u0438\u0441\u0438 \u0432 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0439 \u0437\u043e\u043d\u0435 \\ Add-DnsServerResourceRecordA -Name new-host-name -IPv4Address 192.168.1.100 -ZoneName domain.local -TimeToLive 01:00:00 -CreatePtr \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0410-\u0437\u0430\u043f\u0438\u0441\u044c \u0438 PTR \u0434\u043b\u044f \u043d\u0435\u0435 \\ Remove-DnsServerResourceRecord -ZoneName domain.local -RRType A -Name new-host-name \u2013Force \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0410-\u0437\u0430\u043f\u0438\u0441\u044c $DNSServer = \"DC-01\" $DNSFZone = \"domain.com\" $DataFile = \"C:\\Scripts\\DNS-Create-A-Records-from-File.csv\" # cat $DataFile # \"HostName;IP\" # \"server-01;192.168.1.10\" $DNSRR = [WmiClass]\"\\\\$DNSServer\\root\\MicrosoftDNS:MicrosoftDNS_ResourceRecord\" $ConvFile = $DataFile + \"_unicode\" Get-Content $DataFile | Set-Content $ConvFile -Encoding Unicode Import-CSV $ConvFile -Delimiter \";\" | ForEach-Object { $FQDN = $_.HostName + \".\" + $DNSFZone $IP = $_.HostIP $TextA = \"$FQDN IN A $IP\" [Void]$DNSRR.CreateInstanceFromTextRepresentation($DNSServer,$DNSFZone,$TextA) } DHCPServer Get-Command -Module DhcpServer $mac = icm $srv -ScriptBlock {Get-DhcpServerv4Scope | Get-DhcpServerv4Lease} | select AddressState, HostName,IPAddress,ClientId,DnsRegistration,DnsRR,ScopeId,ServerIP | Out-GridView -Title \"HDCP Server: $srv\" \u2013PassThru (New-Object -ComObject Wscript.Shell).Popup($mac.ClientId,0,$mac.HostName,64) Add-DhcpServerv4Reservation -ScopeId 192.168.1.0 -IPAddress 192.168.1.10 -ClientId 00-50-56-C0-00-08 -Description \"new reservation\" DFS dfsutil /root:\\\\domain.sys\\public /export:C:\\export-dfs.txt \u044d\u043a\u0441\u043f\u043e\u0440\u0442 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438 namespace root \\ dfsutil /AddFtRoot /Server:\\\\$srv /Share:public \u043d\u0430 \u043d\u043e\u0432\u043e\u0439 \u043c\u0430\u0448\u0438\u043d\u0435 \u043f\u0440\u0435\u0434\u0432\u0430\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043a\u043e\u0440\u0435\u043d\u044c \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 \u0434\u043e\u043c\u0435\u043d\u0430 \\ dfsutil /root:\\\\domain.sys\\public /import:C:\\export-dfs.txt /<verify /set Import (\u043f\u0435\u0440\u0435\u0434 \u0438\u043c\u043f\u043e\u0440\u0442\u043e\u043c \u0434\u0430\u043d\u043d\u044b\u0445 \u0432 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0439 \u043a\u043e\u0440\u0435\u043d\u044c DFS, \u0443\u0442\u0438\u043b\u0438\u0442\u0430 \u0441\u043e\u0437\u0434\u0430\u0435\u0442 \u0440\u0435\u0437\u0435\u0440\u0432\u043d\u0443\u044e \u043a\u043e\u043f\u0438\u044e \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438 \u043a\u043e\u0440\u043d\u044f \u0432 \u0442\u0435\u043a\u0443\u0449\u0435\u043c \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0435, \u0438\u0437 \u043a\u043e\u0442\u043e\u0440\u043e\u0433\u043e \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u0442\u0441\u044f \u0443\u0442\u0438\u043b\u0438\u0442\u0430 dfsutil) \\ /verify \u0432\u044b\u0432\u043e\u0434\u0438\u0442 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0431\u0443\u0434\u0443\u0442 \u0432\u043d\u0435\u0441\u0435\u043d\u044b \u0432 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0435 \u0438\u043c\u043f\u043e\u0440\u0442\u0430, \u0431\u0435\u0437 \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u044f \\ /set \u043c\u0435\u043d\u044f\u0435\u0442 \u0446\u0435\u043b\u0435\u0432\u043e\u0435 \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u043e \u0438\u043c\u0435\u043d \u043f\u0443\u0442\u0435\u043c \u043f\u043e\u043b\u043d\u043e\u0439 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0438\u0441\u0438 \u0438 \u0437\u0430\u043c\u0435\u043d\u044b \u043d\u0430 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044e \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u0430 \u0438\u043c\u0435\u043d \u0438\u0437 \u0438\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u0443\u0435\u043c\u043e\u0433\u043e \u0444\u0430\u0439\u043b\u0430 \\ /merge \u0438\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u0443\u0435\u0442 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044e \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u0430 \u0438\u043c\u0435\u043d \u0432 \u0434\u043e\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u043a \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0435\u0439 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438 \u0434\u043b\u044f \u0441\u043b\u0438\u044f\u043d\u0438\u044f, \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u0438\u0437 \u0444\u0430\u0439\u043b\u0430 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438 \u0431\u0443\u0434\u0443\u0442 \u0438\u043c\u0435\u0442\u044c \u0431\u043e\u043b\u044c\u0448\u0438\u0439 \u043f\u0440\u0438\u043e\u0440\u0438\u0442\u0435\u0442, \u0447\u0435\u043c \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u0430 \u0438\u043c\u0435\u043d Export-DfsrClone \u044d\u043a\u0441\u043f\u043e\u0440\u0442\u0438\u0440\u0443\u0435\u0442 \u043a\u043b\u043e\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u0443\u044e \u0431\u0430\u0437\u0443 \u0434\u0430\u043d\u043d\u044b\u0445 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 DFS \u0438 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438 \u0442\u043e\u043c\u0430 \\ Get-DfsrCloneState \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0438 \u043a\u043b\u043e\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 \\ Import-DfsrClone \u0438\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u0443\u0435\u0442 \u043a\u043b\u043e\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u0443\u044e \u0431\u0430\u0437\u0443 \u0434\u0430\u043d\u043d\u044b\u0445 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 DFS \u0438 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438 \u0442\u043e\u043c\u0430 net use x: \\\\$srv1\\public\\* \u043f\u0440\u0438\u043c\u043e\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0434\u0438\u0441\u043a \\ Get-DfsrFileHash x:\\* | Out-File C:\\$srv1.txt \u0437\u0430\u0431\u0440\u0430\u0442\u044c hash \u0432\u0441\u0435\u0445 \u0444\u0430\u0439\u043b\u043e\u0432 \u0434\u0438\u0441\u043a\u0430 \u0432 \u0444\u0430\u0439\u043b (\u0444\u0430\u0439\u043b\u044b \u0441 \u043e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u044b\u043c\u0438 \u0445\u0435\u0448\u0430\u043c\u0438 \u0432\u0441\u0435\u0433\u0434\u0430 \u044f\u0432\u043b\u044f\u044e\u0442\u0441\u044f \u0442\u043e\u0447\u043d\u044b\u043c\u0438 \u043a\u043e\u043f\u0438\u044f\u043c\u0438 \u0434\u0440\u0443\u0433 \u0434\u0440\u0443\u0433\u0430) \\ net use x: /d \u043e\u0442\u043c\u043e\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \\ net use x: \\\\$srv2\\public\\* \\ Get-DfsrFileHash x:\\* | Out-File C:\\$srv2.txt \\ net use x: /d \\ Compare-Object -ReferenceObject (Get-Content C:\\$srv1.txt) -DifferenceObject (Get-Content C:\\$srv2.txt) -IncludeEqual \u0441\u0440\u0430\u0432\u043d\u0438\u0442\u044c \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u0444\u0430\u0439\u043b\u043e\u0432 Get-DfsrBacklog -DestinationComputerName \"fs-06\" -SourceComputerName \"fs-05\" -GroupName \"folder-rep\" -FolderName \"folder\" -Verbose \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u0441\u043f\u0438\u0441\u043e\u043a \u043e\u0436\u0438\u0434\u0430\u044e\u0449\u0438\u0445 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0439 \u0444\u0430\u0439\u043b\u043e\u0432 \u043c\u0435\u0436\u0434\u0443 \u0434\u0432\u0443\u043c\u044f \u043f\u0430\u0440\u0442\u043d\u0435\u0440\u0430\u043c\u0438 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 DFS \\ Get-DfsrConnection \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u0442 \u0433\u0440\u0443\u043f\u043f\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438, \u0443\u0447\u0430\u0441\u0442\u043d\u0438\u043a\u043e\u0432 \u0438 \u0441\u0442\u0430\u0442\u0443\u0441 \\ Get-DfsReplicatedFolder \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u0442 \u0438\u043c\u044f \u0438 \u043f\u043e\u043b\u043d\u044b\u0439 \u043f\u0443\u0442\u044c \u043a \u043f\u0430\u043f\u043a\u0430\u043c \u0440\u0435\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435 DFS \\ Get-DfsrState -ComputerName fs-06 -Verbose \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 DFS \u0434\u043b\u044f \u0447\u043b\u0435\u043d\u0430 \u0433\u0440\u0443\u043f\u043f\u044b \\ Get-DfsReplicationGroup \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u0442 \u0433\u0440\u0443\u043f\u043f\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u0438 \u0438\u0445 \u0441\u0442\u0430\u0442\u0443\u0441 \\ Add-DfsrConnection \u0441\u043e\u0437\u0434\u0430\u0435\u0442 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u043c\u0435\u0436\u0434\u0443 \u0447\u043b\u0435\u043d\u0430\u043c\u0438 \u0433\u0440\u0443\u043f\u043f\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Add-DfsrMember \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u044b \u0432 \u0433\u0440\u0443\u043f\u043f\u0443 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ ConvertFrom-DfsrGuid \u043f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u0443\u0435\u0442 \u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440\u044b GUID \u0432 \u043f\u043e\u043d\u044f\u0442\u043d\u044b\u0435 \u0438\u043c\u0435\u043d\u0430 \u0432 \u0437\u0430\u0434\u0430\u043d\u043d\u043e\u0439 \u0433\u0440\u0443\u043f\u043f\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Get-DfsrConnectionSchedule \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u0440\u0430\u0441\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0439 \u043c\u0435\u0436\u0434\u0443 \u0447\u043b\u0435\u043d\u0430\u043c\u0438 \u0433\u0440\u0443\u043f\u043f\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Get-DfsrGroupSchedule \u0438\u0437\u0432\u043b\u0435\u043a\u0430\u0435\u0442 \u0440\u0430\u0441\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u0433\u0440\u0443\u043f\u043f\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Get-DfsrIdRecord \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u0437\u0430\u043f\u0438\u0441\u0438 ID \u0434\u043b\u044f \u0440\u0435\u043f\u043b\u0438\u0446\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0445 \u0444\u0430\u0439\u043b\u043e\u0432 \u0438\u043b\u0438 \u043f\u0430\u043f\u043e\u043a \u0438\u0437 \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 DFS \\ Get-DfsrMember \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u044b \u0432 \u0433\u0440\u0443\u043f\u043f\u0435 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Get-DfsrMembership \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u0447\u043b\u0435\u043d\u0441\u0442\u0432\u0430 \u0434\u043b\u044f \u0447\u043b\u0435\u043d\u043e\u0432 \u0433\u0440\u0443\u043f\u043f \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Get-DfsrPreservedFiles \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u0441\u043f\u0438\u0441\u043e\u043a \u0444\u0430\u0439\u043b\u043e\u0432 \u0438 \u043f\u0430\u043f\u043e\u043a, \u0440\u0430\u043d\u0435\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u043d\u044b\u0445 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0435\u0439 DFS \\ Get-DfsrServiceConfiguration \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u0441\u043b\u0443\u0436\u0431\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 DFS \u0434\u043b\u044f \u0447\u043b\u0435\u043d\u043e\u0432 \u0433\u0440\u0443\u043f\u043f\u044b \\ Grant-DfsrDelegation \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u044f \u0443\u0447\u0430\u0441\u0442\u043d\u0438\u043a\u0430\u043c \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u0438 \u0434\u043b\u044f \u0433\u0440\u0443\u043f\u043f\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Revoke-DfsrDelegation \u043e\u0442\u043c\u0435\u043d\u044f\u0435\u0442 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u044f \u0443\u0447\u0430\u0441\u0442\u043d\u0438\u043a\u043e\u0432 \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u0438 \u0434\u043b\u044f \u0433\u0440\u0443\u043f\u043f\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ New-DfsReplicationGroup \u0441\u043e\u0437\u0434\u0430\u0435\u0442 \u0433\u0440\u0443\u043f\u043f\u0443 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ New-DfsReplicatedFolder \u0441\u043e\u0437\u0434\u0430\u0435\u0442 \u0440\u0435\u043f\u043b\u0438\u0446\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u0443\u044e \u043f\u0430\u043f\u043a\u0443 \u0432 \u0433\u0440\u0443\u043f\u043f\u0435 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Remove-DfsrConnection \u0443\u0434\u0430\u043b\u044f\u0435\u0442 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u043c\u0435\u0436\u0434\u0443 \u0447\u043b\u0435\u043d\u0430\u043c\u0438 \u0433\u0440\u0443\u043f\u043f\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Remove-DfsReplicatedFolder \u0443\u0434\u0430\u043b\u044f\u0435\u0442 \u0440\u0435\u043f\u043b\u0438\u0446\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u0443\u044e \u043f\u0430\u043f\u043a\u0443 \u0438\u0437 \u0433\u0440\u0443\u043f\u043f\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Remove-DfsReplicationGroup \u0443\u0434\u0430\u043b\u044f\u0435\u0442 \u0433\u0440\u0443\u043f\u043f\u0443 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Remove-DfsrMember \u0443\u0434\u0430\u043b\u044f\u0435\u0442 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u044b \u0438\u0437 \u0433\u0440\u0443\u043f\u043f\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Restore-DfsrPreservedFiles \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u0442 \u0444\u0430\u0439\u043b\u044b \u0438 \u043f\u0430\u043f\u043a\u0438, \u0440\u0430\u043d\u0435\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u043d\u044b\u0435 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0435\u0439 DFS \\ Set-DfsrConnection \u0438\u0437\u043c\u0435\u043d\u044f\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f \u043c\u0435\u0436\u0434\u0443 \u0447\u043b\u0435\u043d\u0430\u043c\u0438 \u0433\u0440\u0443\u043f\u043f\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Set-DfsrConnectionSchedule \u0438\u0437\u043c\u0435\u043d\u044f\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u0440\u0430\u0441\u043f\u0438\u0441\u0430\u043d\u0438\u044f \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0439 \u043c\u0435\u0436\u0434\u0443 \u0447\u043b\u0435\u043d\u0430\u043c\u0438 \u0433\u0440\u0443\u043f\u043f\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Set-DfsReplicatedFolder \u0438\u0437\u043c\u0435\u043d\u044f\u0435\u0442 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u0440\u0435\u043f\u043b\u0438\u0446\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0439 \u043f\u0430\u043f\u043a\u0438 \\ Set-DfsReplicationGroup \u0438\u0437\u043c\u0435\u043d\u044f\u0435\u0442 \u0433\u0440\u0443\u043f\u043f\u0443 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Set-DfsrGroupSchedule \u0438\u0437\u043c\u0435\u043d\u044f\u0435\u0442 \u0440\u0430\u0441\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u0433\u0440\u0443\u043f\u043f\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Set-DfsrMember \u0438\u0437\u043c\u0435\u043d\u044f\u0435\u0442 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u043e \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0435-\u0443\u0447\u0430\u0441\u0442\u043d\u0438\u043a\u0435 \u0432 \u0433\u0440\u0443\u043f\u043f\u0435 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Set-DfsrMembership \u043d\u0430\u0441\u0442\u0440\u0430\u0438\u0432\u0430\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u0447\u043b\u0435\u043d\u0441\u0442\u0432\u0430 \u0434\u043b\u044f \u0447\u043b\u0435\u043d\u043e\u0432 \u0433\u0440\u0443\u043f\u043f\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Set-DfsrServiceConfiguration \u0438\u0437\u043c\u0435\u043d\u044f\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u0441\u043b\u0443\u0436\u0431\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 DFS \\ Sync-DfsReplicationGroup \u0441\u0438\u043d\u0445\u0440\u043e\u043d\u0438\u0437\u0438\u0440\u0443\u0435\u0442 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u044e \u043c\u0435\u0436\u0434\u0443 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0430\u043c\u0438 \u043d\u0435\u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e \u043e\u0442 \u0440\u0430\u0441\u043f\u0438\u0441\u0430\u043d\u0438\u044f \\ Suspend-DfsReplicationGroup \u043f\u0440\u0438\u043e\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u0442 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u044e \u043c\u0435\u0436\u0434\u0443 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0430\u043c\u0438 \u043d\u0435\u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e \u043e\u0442 \u0440\u0430\u0441\u043f\u0438\u0441\u0430\u043d\u0438\u044f \\ Update-DfsrConfigurationFromAD \u0438\u043d\u0438\u0446\u0438\u0438\u0440\u0443\u0435\u0442 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0441\u043b\u0443\u0436\u0431\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 DFS \\ Write-DfsrHealthReport \u0441\u043e\u0437\u0434\u0430\u0435\u0442 \u043e\u0442\u0447\u0435\u0442 \u043e \u0440\u0430\u0431\u043e\u0442\u043e\u0441\u043f\u043e\u0441\u043e\u0431\u043d\u043e\u0441\u0442\u0438 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 DFS \\ Write-DfsrPropagationReport \u0441\u043e\u0437\u0434\u0430\u0435\u0442 \u043e\u0442\u0447\u0435\u0442\u044b \u0434\u043b\u044f \u0442\u0435\u0441\u0442\u043e\u0432\u044b\u0445 \u0444\u0430\u0439\u043b\u043e\u0432 \u0440\u0430\u0441\u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0432 \u0433\u0440\u0443\u043f\u043f\u0435 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Start-DfsrPropagationTest \u0441\u043e\u0437\u0434\u0430\u0435\u0442 \u0442\u0435\u0441\u0442\u043e\u0432\u044b\u0439 \u0444\u0430\u0439\u043b \u0440\u0430\u0441\u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0432 \u0440\u0435\u043f\u043b\u0438\u0446\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0439 \u043f\u0430\u043f\u043a\u0435 StorageReplica Install-WindowsFeature Storage-Replica \u2013IncludeManagementTools -Restart \\ Get-Command -Module StorageReplica \\ Test-SRTopology \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043b\u0438 \u0441\u0435\u0440\u0432\u0435\u0440 \u0438 \u043a\u0430\u043d\u0430\u043b \u0441\u0432\u044f\u0437\u0438 \u0442\u0435\u0445\u043d\u043e\u043b\u043e\u0433\u0438\u0438 Storage Replica \\ New-SRPartnership -SourceComputerName srv-01 -SourceRGName srv-01-rep-group-01 -SourceVolumeName D: -SourceLogVolumeName L: -DestinationComputerName srv-02 -DestinationRGName srv-02-rep-group-01 -DestinationVolumeName D: -DestinationLogVolumeName L: -LogSizeInBytes 1GB \\ Get-Counter -Counter \"\\Storage Replica Statistics(*)\" \\ Get-WinEvent -ProviderName Microsoft-Windows-StorageReplica -max 10 \\ Set-SRPartnership -ReplicationMode Asynchronous \u043f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0440\u0435\u0436\u0438\u043c \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u043d\u0430 \u0430\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u044b\u0439 \\ Set-SRPartnership -NewSourceComputerName srv-02 -SourceRGName srv-02-rep-group-01 -DestinationComputerName srv-01 -DestinationRGName srv-01-rep-group-01 \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0432\u0440\u0443\u0447\u043d\u0443\u044e \u043d\u0430\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u0434\u0430\u043d\u043d\u044b\u0445, \u043f\u0435\u0440\u0435\u0432\u0435\u0434\u044f \u0432\u0442\u043e\u0440\u0438\u0447\u043d\u0443\u044e \u043a\u043e\u043f\u0438\u044e \u0432 \u043e\u043d\u043b\u0430\u0439\u043d \u0440\u0435\u0436\u0438\u043c (\u043f\u0440\u0438 \u0432\u044b\u0445\u043e\u0434\u0435 \u0438\u0437 \u0441\u0442\u0440\u043e\u044f \u043e\u0441\u043d\u043e\u0432\u043d\u043e\u0433\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u0430) \\ Get-SRGroup \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043e \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0433\u0440\u0443\u043f\u043f\u044b \u0440\u0435\u043f\u043b\u0438\u0437\u0430\u0446\u0438\u0438 \\ Get-SRPartnerShip \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043e \u043d\u0430\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0438 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ (Get-SRGroup).Replicas | Select-Object numofbytesremaining \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0434\u043b\u0438\u043d\u0443 \u043e\u0447\u0435\u0440\u0435\u0434\u0438 \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \\ Get-SRPartnership | Remove-SRPartnership \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0440\u0435\u043f\u043b\u0438\u0437\u0430\u0446\u0438\u044e \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u043d\u043e\u043c \u0441\u0435\u0440\u0432\u0435\u0440\u0435 \\ Get-SRGroup | Remove-SRGroup \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0440\u0435\u043f\u043b\u0438\u0437\u0430\u0446\u0438\u044e \u043d\u0430 \u043e\u0431\u043e\u0438\u0445 \u0441\u0435\u0440\u0432\u0435\u0440\u0430\u0445 PS2EXE Install-Module ps2exe -Repository PSGallery \\ Get-Module -ListAvailable \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u043c\u043e\u0434\u0443\u043b\u0435\u0439 \\ -noConsole \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c GUI, \u0431\u0435\u0437 \u043e\u043a\u043d\u0430 \u043a\u043e\u043d\u0441\u043e\u043b\u0438 powershell \\ -noOutput \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u0432 \u0444\u043e\u043d\u0435 \\ -noError \u0431\u0435\u0437 \u0432\u044b\u0432\u043e\u0434\u0430 \u043e\u0448\u0438\u0431\u043e\u043a \\ -requireAdmin \u043f\u0440\u0438 \u0437\u0430\u043f\u0443\u0441\u043a\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u0438\u0442\u044c \u043f\u0440\u0430\u0432\u0430 \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u0430 \\ -credentialGUI \u0432\u044b\u0432\u043e\u0434 \u0434\u0438\u0430\u043b\u043e\u0433\u043e\u0432\u043e\u0433\u043e \u043e\u043a\u043d\u0430 \u0434\u043b\u044f \u0432\u0432\u043e\u0434\u0430 \u0443\u0447\u0435\u0442\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445 \\ Invoke-ps2exe -inputFile \"$home\\Desktop\\WinEvent-Viewer-1.1.ps1\" -outputFile \"$home\\Desktop\\WEV-1.1.exe\" -iconFile \"$home\\Desktop\\log_48px.ico\" -title \"WinEvent-Viewer\" -noConsole -noOutput -noError NSSM $powershell_Path = (Get-Command powershell).Source \\ $NSSM_Path = (Get-Command \"C:\\WinPerf-Agent\\NSSM-2.24.exe\").Source \\ $Script_Path = \"C:\\WinPerf-Agent\\WinPerf-Agent-1.1.ps1\" \\ $Service_Name = \"WinPerf-Agent\" \\ & $NSSM_Path install $Service_Name $powershell_Path -ExecutionPolicy Bypass -NoProfile -f $Script_Path \u0441\u043e\u0437\u0434\u0430\u0442\u044c Service \\ & $NSSM_Path start $Service_Name \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \\ & $NSSM_Path status $Service_Name \u0441\u0442\u0430\u0442\u0443\u0441 \\ $Service_Name | Restart-Service \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \\ $Service_Name | Get-Service \u0441\u0442\u0430\u0442\u0443\u0441 \\ $Service_Name | Stop-Service \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \\ & $NSSM_Path set $Service_Name description \"Check performance CPU and report email\" \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \\ & $NSSM_Path remove $Service_Name \u0443\u0434\u0430\u043b\u0438\u0442\u044c Jobs Get-Job \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 \u0441\u043f\u0438\u0441\u043a\u0430 \u0437\u0430\u0434\u0430\u0447 \\ Start-Job \u0437\u0430\u043f\u0443\u0441\u043a \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 \\ Stop-Job \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 \\ Suspend-Job \u043f\u0440\u0438\u043e\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 \u0440\u0430\u0431\u043e\u0442\u044b \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 \\ Resume-Job \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0440\u0430\u0431\u043e\u0442\u044b \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 \\ Wait-Job \u043e\u0436\u0438\u0434\u0430\u043d\u0438\u0435 \u0432\u044b\u0432\u043e\u0434\u0430 \u043a\u043e\u043c\u0430\u043d\u0434\u044b \\ Receive-Job \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u043d\u043e\u0433\u043e \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 \\ Remove-Job \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0437\u0430\u0434\u0430\u0447\u0443 function Start-PingJob ($Network) { $RNetwork = $Network -replace \"\\.\\d{1,3}$\",\".\" foreach ($4 in 1..254) { $ip = $RNetwork+$4 # \u0441\u043e\u0437\u0434\u0430\u0435\u043c \u0437\u0430\u0434\u0430\u043d\u0438\u044f, \u0437\u0430\u0431\u0438\u0440\u0430\u0435\u043c 3-\u044e \u0441\u0442\u0440\u043e\u043a\u0443 \u0432\u044b\u0432\u043e\u0434\u0430 \u0438 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c \u043a \u0432\u044b\u0432\u043e\u0434\u0443 ip-\u0430\u0434\u0440\u0435\u0441: (Start-Job {\"$using:ip : \"+(ping -n 1 -w 50 $using:ip)[2]}) | Out-Null } while ($True){ $status_job = (Get-Job).State[-1] # \u0437\u0430\u0431\u0438\u0440\u0430\u0435\u043c \u0441\u0442\u0430\u0442\u0443\u0441 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u0437\u0430\u0434\u0430\u043d\u0438\u044f if ($status_job -like \"Completed\"){ # \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c \u043d\u0430 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 (\u0437\u0430\u0434\u0430\u043d\u0438\u044f \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u044e\u0442\u0441\u044f \u043f\u043e \u043e\u0447\u0435\u0440\u0435\u0434\u0438 \u0441\u0432\u0435\u0440\u0445\u0443 \u0432\u043d\u0438\u0437) $ping_out = Get-Job | Receive-Job # \u0435\u0441\u043b\u0438 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d, \u0437\u0430\u0431\u0438\u0440\u0430\u0435\u043c \u0432\u044b\u0432\u043e\u0434 \u0432\u0441\u0435\u0445 \u0437\u0430\u0434\u0430\u043d\u0438\u0439 Get-Job | Remove-Job -Force # \u0443\u0434\u0430\u043b\u044f\u0435\u043c \u0437\u0430\u0434\u0430\u043d\u0438\u044f $ping_out break # \u0437\u0430\u0432\u0435\u0440\u0448\u0430\u0435\u043c \u0446\u0438\u043a\u043b }} } Start-PingJob -Network 192.168.3.0 \\ (Measure-Command {Start-PingJob -Network 192.168.3.0}).TotalSeconds 60 Seconds ThreadJob Install-Module -Name ThreadJob \\ Get-Module ThreadJob -list \\ Start-ThreadJob {ping ya.ru} | Out-Null \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0444\u043e\u043d\u043e\u0432\u0443\u044e \u0437\u0430\u0434\u0430\u0447\u0443 \\ Get-Job | Receive-Job -Keep \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0438 \u043d\u0435 \u0443\u0434\u0430\u043b\u044f\u0442\u044c \u0432\u044b\u0432\u043e\u0434 \\ (Get-Job).HasMoreData \u0435\u0441\u043b\u0438 False, \u0442\u043e \u0432\u044b\u0432\u043e\u0434 \u043a\u043e\u043c\u0430\u043d\u044b \u0443\u0434\u0430\u043b\u0435\u043d \\ (Get-Job)[-1].Output \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u044b\u0432\u043e\u0434 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0439 \u0437\u0430\u0434\u0430\u0447\u0438 function Start-PingThread ($Network) { $RNetwork = $Network -replace \"\\.\\d{1,3}$\",\".\" foreach ($4 in 1..254) { $ip = $RNetwork+$4 # \u0441\u043e\u0437\u0434\u0430\u0435\u043c \u0437\u0430\u0434\u0430\u043d\u0438\u044f, \u0437\u0430\u0431\u0438\u0440\u0430\u0435\u043c 3-\u044e \u0441\u0442\u0440\u043e\u043a\u0443 \u0432\u044b\u0432\u043e\u0434\u0430 \u0438 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c \u043a \u0432\u044b\u0432\u043e\u0434\u0443 ip-\u0430\u0434\u0440\u0435\u0441: (Start-ThreadJob {\"$using:ip : \"+(ping -n 1 -w 50 $using:ip)[2]}) | Out-Null } while ($True){ $status_job = (Get-Job).State[-1] # \u0437\u0430\u0431\u0438\u0440\u0430\u0435\u043c \u0441\u0442\u0430\u0442\u0443\u0441 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u0437\u0430\u0434\u0430\u043d\u0438\u044f if ($status_job -like \"Completed\"){ # \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c \u043d\u0430 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 (\u0437\u0430\u0434\u0430\u043d\u0438\u044f \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u044e\u0442\u0441\u044f \u043f\u043e \u043e\u0447\u0435\u0440\u0435\u0434\u0438 \u0441\u0432\u0435\u0440\u0445\u0443 \u0432\u043d\u0438\u0437) $ping_out = Get-Job | Receive-Job # \u0435\u0441\u043b\u0438 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d, \u0437\u0430\u0431\u0438\u0440\u0430\u0435\u043c \u0432\u044b\u0432\u043e\u0434 \u0432\u0441\u0435\u0445 \u0437\u0430\u0434\u0430\u043d\u0438\u0439 Get-Job | Remove-Job -Force # \u0443\u0434\u0430\u043b\u044f\u0435\u043c \u0437\u0430\u0434\u0430\u043d\u0438\u044f $ping_out break # \u0437\u0430\u0432\u0435\u0440\u0448\u0430\u0435\u043c \u0446\u0438\u043a\u043b }} } Start-PingThread -Network 192.168.3.0 \\ (Measure-Command {Start-PingThread -Network 192.168.3.0}).TotalSeconds 24 Seconds PoshRSJob function Start-PingRSJob ($Network) { $RNetwork = $Network -replace \"\\.\\d{1,3}$\",\".\" foreach ($4 in 1..254) { $ip = $RNetwork+$4 (Start-RSJob {\"$using:ip : \"+(ping -n 1 -w 50 $using:ip)[2]}) | Out-Null } $ping_out = Get-RSJob | Receive-RSJob $ping_out Get-RSJob | Remove-RSJob } Start-PingRSJob -Network 192.168.3.0 \\ (Measure-Command {Start-PingRSJob -Network 192.168.3.0}).TotalSeconds 10 Seconds SMTP function Send-SMTP { param ( [Parameter(Mandatory = $True)]$mess ) $srv_smtp = \"smtp.yandex.ru\" $port = \"587\" $from = \"login1@yandex.ru\" $to = \"login2@yandex.ru\" $user = \"login1\" $pass = \"password\" $subject = \"Service status on Host: $hostname\" $Message = New-Object System.Net.Mail.MailMessage $Message.From = $from $Message.To.Add($to) $Message.Subject = $subject $Message.IsBodyHTML = $true $Message.Body = \"<h1> $mess </h1>\" $smtp = New-Object Net.Mail.SmtpClient($srv_smtp, $port) $smtp.EnableSSL = $true $smtp.Credentials = New-Object System.Net.NetworkCredential($user, $pass); $smtp.Send($Message) } Send-SMTP $(Get-Service) Hyper-V Install-WindowsFeature -Name Hyper-V -IncludeManagementTools -Restart \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0440\u043e\u043b\u044c \u043d\u0430 Windows Server \\ Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Hyper-V \u2013All \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0440\u043e\u043b\u044c \u043d\u0430 Windows Desktop \\ Get-Command -Module hyper-v \\ Get-VMHost New-VMSwitch -name NAT -SwitchType Internal # \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0432\u0438\u0440\u0442\u0443\u0430\u043b\u044c\u043d\u044b\u0439 \u043a\u043e\u043c\u043c\u0443\u0442\u0430\u0442\u043e\u0440 \u0438 \u0430\u0434\u0430\u043f\u0442\u0435\u0440 \u0434\u043b\u044f \u043d\u0435\u0433\u043e Get-NetAdapter | where InterfaceDescription -match Hyper-V # \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u0435\u0442\u0435\u0432\u044b\u0445 \u0430\u0434\u0430\u043f\u0442\u0435\u0440\u043e\u0432 New-NetNat -Name LocalNat -InternalIPInterfaceAddressPrefix \"192.168.3.0/24\" # \u0437\u0430\u0434\u0430\u0442\u044c \u0441\u0435\u0442\u044c Get-NetAdapter \"vEthernet (NAT)\" | New-NetIPAddress -IPAddress 192.168.3.200 -AddressFamily IPv4 -PrefixLength 24 # \u043f\u0440\u0438\u0441\u0432\u043e\u0438\u0442\u044c \u0430\u0434\u0440\u0435\u0441, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043d\u0430 \u0412\u041c \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u0448\u043b\u044e\u0437 192.168.3.200, \u0447\u0442\u043e \u0431\u044b \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u044c\u0441\u044f \u0437\u0430 NAT, \u0438\u043b\u0438 \u0432 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430 \u0412\u041c \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0439 \u0430\u0434\u0430\u043f\u0442\u0435\u0440 Add-NetNatStaticMapping -NatName LocalNat -Protocol TCP -ExternalIPAddress 0.0.0.0 -ExternalPort 2222 -InternalIPAddress 192.168.3.103 -InternalPort 2121 # \u043f\u0440\u043e\u0431\u0440\u043e\u0441, \u0432\u0435\u0441\u0442 \u0442\u0440\u0430\u0444\u0438\u043a \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043f\u0440\u0438\u0445\u043e\u0434\u0438\u0442 \u043d\u0430 \u0445\u043e\u0441\u0442 Hyper-V TCP/2222, \u0431\u0443\u0434\u0435\u0442 \u043f\u0435\u0440\u0435\u043d\u0430\u043f\u0440\u0430\u0432\u043b\u044f\u0442\u044c\u0441\u044f \u043d\u0430 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0439 \u043f\u043e\u0440\u0442 \u0432\u0438\u0440\u0442\u0443\u0430\u043b\u044c\u043d\u043e\u0439 \u043c\u0430\u0448\u0438\u043d\u044b \u0437\u0430 NAT. (Get-NetAdapter | where Name -match NAT).Status Get-NetNatStaticMapping \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043f\u0440\u043e\u0431\u0440\u043e\u0441\u044b (NAT) \\ Get-NetNat \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u0435\u0442\u0435\u0439 \\ Remove-NetNatStaticMapping -StaticMappingID 0 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043f\u0440\u043e\u0431\u0440\u043e\u0441 \\ Remove-NetNat -Name LocalNat \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u0435\u0442\u044c New-VMSwitch -Name Local -AllowManagementOS $True -NetAdapterName \"Ethernet 4\" -SwitchType External \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0432\u0448\u0435\u043d\u0438\u0439 (External) \u0432\u0438\u0440\u0442\u0443\u0430\u043b\u044c\u043d\u044b\u0439 \u043a\u043e\u043c\u043c\u0443\u0442\u0430\u0442\u043e\u0440 \\ $VMName = \"hv-dc-01\" $VM = @{ Name = $VMName MemoryStartupBytes = 4Gb Generation = 2 NewVHDPath = \"D:\\VM\\$VMName\\$VMName.vhdx\" NewVHDSizeBytes = 50Gb BootDevice = \"VHD\" Path = \"D:\\VM\\$VMName\" SwitchName = \"NAT\" } New-VM @VM Set-VMDvdDrive -VMName $VMName -Path \"C:\\Users\\Lifailon\\Documents\\WS-2016.iso\" \\ New-VHD -Path \"D:\\VM\\$VMName\\disk_d.vhdx\" -SizeBytes 10GB \u0441\u043e\u0437\u0434\u0430\u0442\u044c VHDX \u0434\u0438\u0441\u043a \\ Add-VMHardDiskDrive -VMName $VMName -Path \"D:\\VM\\$VMName\\disk_d.vhdx\" \u043f\u0440\u0438\u043c\u043e\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0434\u0438\u0441\u043a \\ Get-VM \u2013VMname $VMName | Set-VM \u2013AutomaticStartAction Start \u0430\u0432\u0442\u043e\u0437\u0430\u043f\u0443\u0441\u043a \\ Get-VM -Name $VMName | Set-VMMemory -StartupBytes 8Gb \\ Set-VMProcessor $VMName -Count 2 \\ Get-VM -Name $VMName | Checkpoint-VM -SnapshotName \"Snapshot-1\" \\ Restore-VMCheckpoint -Name Snapshot-1\" -VMName $VMName -Confirm:$false \\ Get-VM | Select -ExpandProperty NetworkAdapters | Select VMName,IPAddresses,Status \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c IP \u0430\u0434\u0440\u0435\u0441 \u0432\u0441\u0435\u0445 \u0412\u041c \\ vmconnect.exe localhost $VMHost Get-NetTCPConnection -State Established,Listen | Where-Object LocalPort -Match 2179 \u043d\u0430\u0439\u0442\u0438 \u043f\u043e\u0440\u0442 \u0441\u043b\u0443\u0448\u0430\u0442\u0435\u043b\u044f Get-Process -Id (Get-NetTCPConnection -State Established,Listen | Where-Object LocalPort -Match 2179).OwningProcess \u043d\u0430\u0439\u0442\u0438 \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u043f\u043e ID (vmms/VMConnect) \\ New-NetFirewallRule -Name \"Hyper-V\" -DisplayName \"Hyper-V\" -Group \"Hyper-V\" -Direction Inbound -Protocol TCP -LocalPort 2179 -Action Allow -Profile Public \\ Get-LocalGroupMember -Group \"\u0410\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u044b Hyper-V\" \u0438\u043b\u0438 \"Hyper-V Administrators\" \\ Add-LocalGroupMember -Group \"\u0410\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u044b Hyper-V\" -Member \"lifailon\" \\ Get-VM * | select name,ID \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c id \u0432 RDCMan \u0434\u043b\u044f \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \\ Grant-VMConnectAccess -ComputerName plex-01 -VMName hv-devops-01 -UserName lifailon \u0434\u0430\u0442\u044c \u0434\u043e\u0441\u0442\u0443\u043f \u043d\u0430 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u043d\u0435 \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u0443 \\ Grant-VMConnectAccess -ComputerName huawei-book -VMName hv-devops-01 -UserName lifailon \\ Get-VMConnectAccess \\ Revoke-VMConnectAccess -VMName hv-devops-01 -UserName lifailon Error: Unknown disconnection reason 3848 - \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043a\u043b\u044e\u0447\u0438 \u0440\u0435\u0435\u0441\u0442\u0440\u0430 \u043d\u0430 \u0441\u0442\u043e\u0440\u043e\u043d\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 New-ItemProperty -Path HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\Credssp\\PolicyDefaults\\AllowFreshCredentialsDomain -Name Hyper-V -PropertyType String -Value \"Microsoft Virtual Console Service/*\" -Force New-ItemProperty -Path HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\Credssp\\PolicyDefaults\\AllowDefaultCredentials -Name Hyper-V -PropertyType String -Value \"Microsoft Virtual Console Service/*\" -Force New-ItemProperty -Path HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\Credssp\\PolicyDefaults\\AllowFreshCredentialsWhenNTLMOnlyDomain -Name Hyper-V -PropertyType String -Value \"Microsoft Virtual Console Service/*\" -Force ItemProperty -Path HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\Credssp\\PolicyDefaults\\AllowDefaultCredentialsDomain -Name Hyper-V -PropertyType String -Value \"Microsoft Virtual Console Service/*\" -Force New-ItemProperty -Path HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\Credssp\\PolicyDefaults\\AllowFreshCredentials -Name Hyper-V -PropertyType String -Value \"Microsoft Virtual Console Service/*\" -Force New-ItemProperty -Path HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\Credssp\\PolicyDefaults\\AllowFreshCredentialsWhenNTLMOnly -Name Hyper-V -PropertyType String -Value \"Microsoft Virtual Console Service/*\" -Force New-ItemProperty -Path HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\Credssp\\PolicyDefaults\\AllowSavedCredentialsWhenNTLMOnly -Name Hyper-V -PropertyType String -Value \"Microsoft Virtual Console Service/*\" -Force New-ItemProperty -Path HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\Credssp\\PolicyDefaults\\AllowSavedCredentials -Name Hyper-V -PropertyType String -Value \"Microsoft Virtual Console Service/*\" -Force New-ItemProperty -Path HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\Credssp\\PolicyDefaults\\AllowSavedCredentialsDomain -Name Hyper-V -PropertyType String -Value \"Microsoft Virtual Console Service/*\" -Force VMWare/PowerCLI Install-Module -Name VMware.PowerCLI # -AllowClobber \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043c\u043e\u0434\u0443\u043b\u044c (PackageProvider: nuget) \\ Get-Module -ListAvailable VMware* | Select Name,Version \\ Import-Module VMware.VimAutomation.Core \u0438\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u0441\u0435\u0441\u0441\u0438\u044e \\ Get-PSProvider | format-list Name,PSSnapIn,ModuleName \u0441\u043f\u0438\u0441\u043e\u043a \u043e\u0441\u043d\u0430\u0441\u0442\u043e\u043a Windows PowerShell Get-PowerCLIConfiguration \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \\ Set-PowerCLIConfiguration -Scope AllUsers -InvalidCertificateAction ignore -confirm:$false e\u0441\u043b\u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0441\u0430\u043c\u043e\u043f\u043e\u0434\u043f\u0438\u0441\u0430\u043d\u043d\u044b\u0439 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442, \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430 InvalidCertificateAction \u0441 Unset \u043d\u0430 Ignore/Warn \\ Set-PowerCLIConfiguration -Scope AllUsers -ParticipateInCeip $false \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0435 \u0441\u0431\u043e\u0440\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 \u0447\u0435\u0440\u0435\u0437 VMware Customer Experience Improvement Program (CEIP) Read-Host \u2013AsSecureString | ConvertFrom-SecureString | Out-File \"$home\\Documents\\vcsa_password.txt\" \u0437\u0430\u0448\u0438\u0444\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \u0438 \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0432 \u0444\u0430\u0439\u043b \\ $esxi = \"vcsa.domain.local\" \\ $user = \"administrator@vsphere.local\" \\ $pass = Get-Content \"$home\\Documents\\vcsa_password.txt\" | ConvertTo-SecureString \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \\ $pass = \"password\" \\ $Cred = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList $user ,$pass \\ Connect-VIServer $esxi -User $Cred.Username -Password $Cred.GetNetworkCredential().password \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044f PSCredential ($Cred) \\ Connect-VIServer $esxi -User $user -Password $pass \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044f \u043b\u043e\u0433\u0438\u043d \u0438 \u043f\u0430\u0440\u043e\u043b\u044c Get-Command \u2013Module *vmware* \\ Get-Command \u2013Module *vmware* -name *get*iscsi* \\ Get-IScsiHbaTarget \\ Get-Datacenter \\ Get-Cluster \\ Get-VMHost \\ Get-VMHost | select Name,Model,ProcessorType,MaxEVCMode,NumCpu,CpuTotalMhz,CpuUsageMhz,MemoryTotalGB,MemoryUsageGB \\ Get-VMHostDisk | select VMHost,ScsiLun,TotalSectors Get-Datastore \\ Get-Datastore TNAS-vmfs-4tb-01 \\ Get-Datastore TNAS-vmfs-4tb-01 | get-vm \\ Get-Datastore -RelatedObject vm-01 \\ (Get-Datastore TNAS-vmfs-4tb-01).ExtensionData.Info.GetType() \\ (Get-Datastore TNAS-vmfs-4tb-01).ExtensionData.Info.Vmfs.Extent Get-Command \u2013Module *vmware* -name *disk* \\ Get-VM vm-01 | Get-Datastore \\ Get-VM vm-01 | Get-HardDisk \\ Get-VM | Get-HardDisk | select Parent,Name,CapacityGB,StorageFormat,FileName | ft \\ Copy-HardDisk \\ Get-VM | Get-Snapshot \\ Get-VM | where {$_.Powerstate -eq \"PoweredOn\"} \\ Get-VMHost esxi-05 | Get-VM | where {$_.Powerstate -eq \"PoweredOff\"} | Move-VM \u2013Destination (Get-VMHost esxi-06) Get-VM | select Name,VMHost,PowerState,NumCpu,MemoryGB, \\ @{Name=\"UsedSpaceGB\"; Expression={[int32]($_.UsedSpaceGB)}},@{Name=\"ProvisionedSpaceGB\"; Expression={[int32]($_.ProvisionedSpaceGB)}}, \\ CreateDate,CpuHotAddEnabled,MemoryHotAddEnabled,CpuHotRemoveEnabled,Notes Get-VMGuest vm-01 | Update-Tools \\ Get-VMGuest vm-01 | select OSFullName,IPAddress,HostName,State,Disks,Nics,ToolsVersion \\ Get-VMGuest * | select -ExpandProperty IPAddress \\ Restart-VMGuest -vm vm-01 -Confirm:$False \\ Start-VM -vm vm-01 -Confirm:$False \\ Shutdown-VMGuest -vm vm-01 -Confirm:$false New-VM \u2013Name vm-01 -VMHost esxi-06 \u2013ResourcePool Production \u2013DiskGB 60 \u2013DiskStorageFormat Thin \u2013Datastore TNAS-vmfs-4tb-01 \\ Get-VM vm-01 | Copy-VMGuestFile -Source \"\\\\$srv\\Install\\Soft\\Btest.exe\" -Destination \"C:\\Install\\\" -LocalToGuest -GuestUser USER -GuestPassword PASS -force Get-VM -name vm-01 | Export-VApp -Destination C:\\Install -Format OVF Export template (.ovf, .vmdk, .mf) \\ Get-VM -name vm-01 | Export-VApp -Destination C:\\Install -Format OVA Get-VMHostNetworkAdapter | select VMHost,Name,Mac,IP,@{Label=\"Port Group\"; Expression={$_.ExtensionData.Portgroup}} | ft \\ Get-VM | Get-NetworkAdapter | select Parent,Name,Id,Type,MacAddress,ConnectionState,WakeOnLanEnabled | ft Get-Command \u2013Module *vmware* -name *event* \\ Get-VIEvent -MaxSamples 1000 | where {($_.FullFormattedMessage -match \"power\")} | select username,CreatedTime,FullFormattedMessage \\ Get-logtype | select Key,SourceEntityId,Filename,Creator,Info \\ (Get-Log vpxd:vpxd.log).Entries | select -Last 50 Get-Command \u2013Module *vmware* -name *syslog* \\ Set-VMHostSysLogServer -VMHost esxi-05 -SysLogServer \"tcp://192.168.3.100\" -SysLogServerPort 3515 \\ Get-VMHostSysLogServer -VMHost esxi-05 Exchange/EMShell $srv_cas = \"exchange-cas\" \\ $session_exchange = New-PSSession -ConfigurationName Microsoft.Exchange -ConnectionUri http://$srv_cas/PowerShell/ -Credential $Cred -Authentication Kerberos \\ Get-PSSession \\ Import-PSSession $session_exchange -DisableNameChecking \u0438\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u0442\u0435\u043a\u0443\u0449\u0443\u044e \u0441\u0435\u0441\u0441\u0438\u044e Get-ExchangeServer | select name,serverrole,admindisplayversion,Edition,OriginatingServer,WhenCreated,WhenChanged,DataPath | ft \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u0432 Get-ImapSettings \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 IMAP \\ Get-ExchangeCertificate \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432 \\ Get-ExchangeCertificate -Thumbprint \"5CEC8544D4743BC279E5FEA1679F79F5BD0C2B3A\" | Enable-ExchangeCertificate -Services IMAP, POP, IIS, SMTP \\ iisreset \\ Get-ClientAccessService | fl identity, *uri* \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u0441\u043b\u0443\u0436\u0431\u044b \u0430\u0432\u0442\u043e\u043e\u0431\u043d\u0430\u0440\u0443\u0436\u0435\u043d\u0438\u044f \u0432 Exchange 2016 \\ Get-ClientAccessService -Identity $srv | Set-ClientAccessService -AutoDiscoverServiceInternalUri https://mail.domain.ru/Autodiscover/Autodiscover.xml \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043d\u0430 \u0432\u043d\u0435\u0448\u043d\u0438\u0439 \u0430\u0434\u0440\u0435\u0441 \\ Get-OutlookAnywhere OA \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u043a\u043b\u0438\u0435\u043d\u0442\u0430\u043c Outlook \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0430\u0442\u044c\u0441\u044f \u043a \u0441\u0432\u043e\u0438\u043c \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u043c \u044f\u0449\u0438\u043a\u0430\u043c \u0437\u0430 \u043f\u0440\u0435\u0434\u0435\u043b\u0430\u043c\u0438 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u043e\u0439 \u0441\u0435\u0442\u0438 (\u0431\u0435\u0437 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f VPN) \\ Get-WebServicesVirtualDirectory \\ Get-OwaVirtualDirectory \\ Get-ActiveSyncVirtualDirectory \\ Get-OabVirtualDirectory \u0432\u0438\u0440\u0442\u0443\u0430\u043b\u044c\u043d\u0430\u044f \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u044f \u0430\u0432\u0442\u043e\u043d\u043e\u043c\u043d\u043e\u0439 \u0430\u0434\u0440\u0435\u0441\u043d\u043e\u0439 \u043a\u043d\u0438\u0433\u0438 \\ Get-OabVirtualDirectory -Server $srv | Set-OabVirtualDirectory -InternalUrl \"https://mail.domain.ru/OAB\" -ExternalUrl \"https://mail.domain.ru/OAB\" Roles MS (Mailbox) - \u0441\u0435\u0440\u0432\u0435\u0440 \u0441 \u0411\u0414 \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0445 \u044f\u0449\u0438\u043a\u043e\u0432 \u0438 \u043e\u0431\u0449\u0438\u0445 \u043f\u0430\u043f\u043e\u043a, \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u0437\u0430 \u0438\u0445 \u0440\u0430\u0437\u043c\u0435\u0449\u0435\u043d\u0438\u0435 \u0438 \u043d\u0435 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0430\u0446\u0438\u044e \u043d\u0438\u043a\u0430\u043a\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439. \\ CAS (Client Access Server) - \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043a\u043b\u0438\u0435\u043d\u0442\u0441\u043a\u0438\u0445 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0439 \u043a \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u043c \u044f\u0449\u0438\u043a\u0430\u043c, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0441\u043e\u0437\u0434\u0430\u044e\u0442\u0441\u044f \u043a\u043b\u0438\u0435\u043d\u0442\u0430\u043c\u0438 Outlook Web Access (HTTP \u0434\u043b\u044f Outlook Web App), Outlook Anywhere, ActiveSync (\u0434\u043b\u044f \u043c\u043e\u0431\u0438\u043b\u044c\u043d\u044b\u0445 \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432), \u0438\u043d\u0442\u0435\u0440\u043d\u0435\u0442 \u043f\u0440\u043e\u0442\u043e\u043a\u043e\u043b\u044b POP3 \u0438 IMAP4, MAPI \u0434\u043b\u044f \u043a\u043b\u0438\u0435\u043d\u0442\u043e\u0432 Microsoft Outlook. \\ Hub Transort - \u043e\u0442\u0432\u0435\u0442\u0432\u0435\u0447\u0430\u0435\u0442 \u0437\u0430 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0430\u0446\u0438\u044e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0438\u043d\u0442\u0435\u0440\u043d\u0435\u0442\u0430 \u0438 \u0438\u043d\u0444\u0440\u0430\u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u043e\u0439 Exchange, \u0430 \u0442\u0430\u043a\u0436\u0435 \u043c\u0435\u0436\u0434\u0443 \u0441\u0435\u0440\u0432\u0435\u0440\u0430\u043c\u0438 Exchange. \u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u0432\u0441\u0435\u0433\u0434\u0430 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0438\u0440\u0443\u044e\u0442\u0441\u044f \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0440\u043e\u043b\u0438 \u0442\u0440\u0430\u043d\u0441\u043f\u043e\u0440\u0442\u043d\u043e\u0433\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u0430-\u043a\u043e\u043d\u0446\u0435\u043d\u0442\u0440\u0430\u0442\u043e\u0440\u0430, \u0434\u0430\u0436\u0435 \u0435\u0441\u043b\u0438 \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0435 \u044f\u0449\u0438\u043a\u0438 \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u0430 \u0438 \u043d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u043d\u0430\u0445\u043e\u0434\u044f\u0442\u0441\u044f \u0432 \u043e\u0434\u043d\u043e\u0439 \u0431\u0430\u0437\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0445 \u044f\u0449\u0438\u043a\u043e\u0432. \\ Relay - \u0440\u043e\u043b\u044c \u043f\u043e\u0433\u0440\u0430\u043d\u0438\u0447\u043d\u043e\u0433\u043e \u0442\u0440\u0430\u043d\u0441\u043f\u043e\u0440\u0442\u043d\u043e\u0433\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u0430 (\u0448\u043b\u044e\u0437 SMTP \u0432 \u043f\u0435\u0440\u0438\u043c\u0435\u0442\u0440\u0435 \u0441\u0435\u0442\u0438). SCP (Service Connection Point) - \u0437\u0430\u043f\u0438\u0441\u044c \u043f\u0440\u043e\u043f\u0438\u0441\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u0432 AD, \u043f\u0440\u0438 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 CAS. Outlook \u0437\u0430\u043f\u0440\u0430\u0448\u0438\u0432\u0430\u0435\u0442 SCP, \u0432\u044b\u0431\u0438\u0440\u0430\u0435\u0442 \u0442\u0435, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043d\u0430\u0445\u043e\u0434\u044f\u0442\u0441\u044f \u0432 \u043e\u0434\u043d\u043e\u043c \u0441\u0430\u0439\u0442\u0435 \u0441 \u043d\u0438\u043c \u0438 \u043f\u043e \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0443 WhenCreated \u2013 \u043f\u043e \u0434\u0430\u0442\u0435 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f, \u0432\u044b\u0431\u0438\u0440\u0430\u044f \u0441\u0430\u043c\u044b\u0439 \u0441\u0442\u0430\u0440\u044b\u0439. \\ Autodiscover. Outlook \u0432\u044b\u0431\u0438\u0440\u0430\u0435\u0442 \u0432 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 Client Access \u0442\u043e\u0442, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043f\u0440\u043e\u043f\u0438\u0441\u0430\u043d \u0432 \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u0435 RPCClientAccessServer \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f. \u0421\u0432\u0435\u0434\u0435\u043d\u0438\u044f \u043e \u0431\u0430\u0437\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 \u0438 \u0441\u0435\u0440\u0432\u0435\u0440\u0435 mailbox, \u043d\u0430 \u043a\u043e\u0442\u043e\u0440\u043e\u043c \u043e\u043d\u0430 \u043b\u0435\u0436\u0438\u0442, \u0431\u0435\u0440\u0443\u0442\u0441\u044f \u0438\u0437 AD. MessageTrackingLog Get-MessageTrackingLog -ResultSize Unlimited | select Timestamp,Sender,Recipients,RecipientCount,MessageSubject,Source,EventID,ClientHostname,ServerHostname,ConnectorId, @{Name=\"MessageSize\"; Expression={[string]([int]($_.TotalBytes / 1024))+\" KB\"}},@{Name=\"MessageLatency\"; Expression={$_.MessageLatency -replace \"\\.\\d+$\"}} \\ Get-MessageTrackingLog -Start (Get-Date).AddHours(-24) -ResultSize Unlimited | where {[string]$_.recipients -like \"*@yandex.ru\"} \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u0437\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0435 24 \u0447\u0430\u0441\u0430, \u0433\u0434\u0435 \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u0435\u043b\u0435\u043c \u0431\u044b\u043b \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u0439 \u0434\u043e\u043c\u0435\u043d \\ -Start \"04/01/2023 09:00:00\" -End \"04/01/2023 18:00:00\" - \u043f\u043e\u0438\u0441\u043a \u043f\u043e \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u043c\u0443 \u043f\u0440\u043e\u043c\u0435\u0436\u0443\u0442\u043a\u0443 \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \\ -MessageSubject \"\u0422\u0435\u0441\u0442\" - \u043f\u043e\u0438\u0441\u043a \u043f\u043e \u0442\u0435\u043c\u0435 \u043f\u0438\u0441\u044c\u043c\u0430 \\ -Recipients \"support4@domain.ru\" - \u043f\u043e\u0438\u0441\u043a \u043f\u043e \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u0435\u043b\u044e \\ -Sender - \u043f\u043e\u0438\u0441\u043a \u043f\u043e \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u0435\u043b\u044e \\ -EventID \u2013 \u043f\u043e\u0438\u0441\u043a \u043f\u043e \u043a\u043e\u0434\u0443 \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u0441\u0435\u0440\u0432\u0435\u0440\u0430 (RECEIVE, SEND, FAIL, DSN, DELIVER, BADMAIL, RESOLVE, EXPAND, REDIRECT, TRANSFER, SUBMIT, POISONMESSAGE, DEFER) \\ -Server \u2013 \u043f\u043e\u0438\u0441\u043a \u043d\u0430 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043d\u043e\u043c \u0442\u0440\u0430\u043d\u0441\u043f\u043e\u0440\u0442\u043d\u043e\u043c \u0441\u0435\u0440\u0432\u0435\u0440\u0435 \\ -messageID \u2013 \u0442\u0440\u0435\u043a\u0438\u043d\u0433 \u043f\u0438\u0441\u044c\u043c\u0430 \u043f\u043e \u0435\u0433\u043e ID Mailbox Get-Mailbox -Database \"it2\" \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0445 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u0432 \u0432 \u0431\u0430\u0437\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 \\ Get-Mailbox -resultsize unlimited | ? Emailaddresses -like \"support4\" | format-list name,emailaddresses,database,servername \u043a\u0430\u043a\u0443\u044e \u0411\u0414, \u0441\u0435\u0440\u0432\u0435\u0440 \u0438 smtp-\u0430\u0434\u0440\u0435\u0441\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442 \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0439 \u044f\u0449\u0438\u043a \\ Get-Mailbox -Database $db_name -Archive \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0430\u0440\u0445\u0438\u0432\u043d\u044b\u0435 \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0435 \u044f\u0449\u0438\u043a\u0438 Get-MailboxFolderStatistics -Identity \"support4\" -FolderScope All | select Name,ItemsInFolder,FolderSize \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043a\u043e\u043b-\u0432\u043e \u043f\u0438\u0441\u0435\u043c \u0438 \u0440\u0430\u0437\u043c\u0435\u0440 \u0432 \u043a\u0430\u0436\u0434\u043e\u0439 \u043f\u0430\u043f\u043a\u0435 \\ Get-MailboxStatistics \"support4\" | select DisplayName,LastLoggedOnUserAccount,LastLogonTime,LastLogoffTime,ItemCount,TotalItemSize,DeletedItemCount,TotalDeletedItemSize,Database,ServerName \u043e\u0431\u0449\u0435\u0435 \u043a\u043e\u043b-\u0432\u043e \u043f\u0438\u0441\u0435\u043c, \u0438\u0445 \u0440\u0430\u0437\u043c\u0435\u0440, \u0432\u0440\u0435\u043c\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u0432\u0445\u043e\u0434\u0430 \u0438 \u0432\u044b\u0445\u043e\u0434\u0430, \u0438\u043c\u044f \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u0438 \u0411\u0414 \\ Get-Mailbox -Server s2 | Get-MailboxStatistics | where {$_.Lastlogontime -lt (get-date).AddDays(-30)} | Sort Lastlogontime -desc | ft displayname,Lastlogontime,totalitemsize \u044f\u0449\u0438\u043a\u0438, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043d\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043b\u0438\u0441\u044c 30 \u0438 \u0431\u043e\u043b\u0435\u0435 \u0434\u043d\u0435\u0439 Enable-Mailbox -Identity support9 -Database test_base \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0439 \u044f\u0449\u0438\u043a \u0434\u043b\u044f \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0435\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0432 AD \\ New-Mailbox -Name $login -UserPrincipalName \"$login@$domain\" -Database $select_db -OrganizationalUnit $path -Password (ConvertTo-SecureString -String \"$password\" -AsPlainText -Force) \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043d\u043e\u0432\u044b\u0439 \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0439 \u044f\u0449\u0438\u043a \u0431\u0435\u0437 \u043f\u0440\u0438\u0432\u044f\u0437\u043a\u0438 \u043a \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044e AD \\ Get-MailboxDatabase -Database $db_name | Remove-MailboxDatabase \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0411\u0414 Set-MailBox \"support4\" -PrimarySmtpAddress support24@domain.ru -EmailAddressPolicyEnabled $false \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0438 \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043e\u0441\u043d\u043e\u0432\u043d\u043e\u0439 SMTP-\u0430\u0434\u0440\u0435\u0441 \u044d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u043e\u0439 \u043f\u043e\u0447\u0442\u044b \u0434\u043b\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \\ Set-Mailbox -Identity \"support4\" -DeliverToMailboxAndForward $true -ForwardingSMTPAddress \"username@outlook.com\" \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043f\u0435\u0440\u0435\u0430\u0434\u0440\u0435\u0441\u0430\u0446\u0438\u044e \u043f\u043e\u0447\u0442\u044b (\u044d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u0430\u044f \u043f\u043e\u0447\u0442\u0430 \u043f\u043e\u043f\u0430\u0434\u0430\u0435\u0442 \u0432 \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0439 \u044f\u0449\u0438\u043a \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f support4 \u0438 \u043e\u0434\u043d\u043e\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e \u043f\u0435\u0440\u0435\u0441\u044b\u043b\u0430\u0435\u0442\u0441\u044f \u043f\u043e \u0430\u0434\u0440\u0435\u0441\u0443 username@outlook.com) MoveRequest Get-Mailbox -Database $db_in | New-MoveRequest -TargetDatabase $db_out \u043f\u0435\u0440\u0435\u043c\u0435\u0441\u0442\u0438\u0442\u044c \u0432\u0441\u0435 \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0435 \u044f\u0449\u0438\u043a\u0438 \u0438\u0437 \u043e\u0434\u043d\u043e\u0439 \u0411\u0414 \u0432 \u0434\u0440\u0443\u0433\u0443\u044e \\ New-MoveRequest -Identity $db_in -TargetDatabase $db_out \u043f\u0435\u0440\u0435\u043c\u0435\u0441\u0442\u0438\u0442\u044c \u043e\u0434\u0438\u043d \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0439 \u044f\u0449\u0438\u043a \\ Get-MoveRequest | Suspend-MoveRequest \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0437\u0430\u043f\u0440\u043e\u0441\u044b \u043f\u0435\u0440\u0435\u043c\u0435\u0449\u0435\u043d\u0438\u044f \\ Get-MoveRequest | Remove-MoveRequest \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0437\u0430\u043f\u0440\u043e\u0441\u044b \u043d\u0430 \u043f\u0435\u0440\u0435\u043c\u0435\u0449\u0435\u043d\u0438\u0435 \\ Get-MoveRequest | Get-MoveRequestStatistics \u0441\u0442\u0430\u0442\u0443\u0441 \u043f\u0435\u0440\u0435\u043c\u0435\u0449\u0435\u043d\u0438\u044f Status: \\ Cleanup - \u043d\u0443\u0436\u043d\u043e \u043f\u043e\u0434\u043e\u0436\u0434\u0430\u0442\u044c \\ Queued - \u0432 \u043e\u0447\u0435\u0440\u0435\u0434\u0438 \\ InProgress - \u0432 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0435 \\ Percent Complete - \u043f\u0440\u043e\u0446\u0435\u043d\u0442 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \\ CompletionInProgress - \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u0435 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 \\ Completed - \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u043e Remove-MoveRequest -Identity $db_name \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u043f\u0435\u0440\u0435\u043c\u0435\u0449\u0435\u043d\u0438\u044f (\u0443\u0431\u0440\u0430\u0442\u044c \u0441\u0442\u0430\u0442\u0443\u0441 \u043f\u0435\u0440\u0435\u043c\u0435\u0449\u0435\u043d\u0438\u044f \u0441 \u043f\u043e\u0447\u0442\u043e\u0432\u043e\u0433\u043e \u044f\u0449\u0438\u043a\u0430 \u0438 \u043e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u0435\u0440\u0435\u043c\u0435\u0449\u0435\u043d\u0438\u0439) \\ Get-MailboxDatabase | Select Name, MailboxRetention \u043f\u043e\u0441\u043b\u0435 \u043f\u0435\u0440\u0435\u043c\u0435\u0449\u0435\u043d\u0438\u044f \u044f\u0449\u0438\u043a\u043e\u0432, \u0440\u0430\u0437\u043c\u0435\u0440 \u0431\u0430\u0437\u044b \u043d\u0435 \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u0441\u044f, \u043f\u043e\u043b\u043d\u043e\u0435 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0438\u0437 \u0431\u0430\u0437\u044b \u043f\u0440\u043e\u0438\u0437\u043e\u0439\u0434\u0435\u0442, \u043a\u0430\u043a \u043f\u0440\u043e\u0439\u0434\u0435\u0442 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0434\u043d\u0435\u0439, \u0432\u044b\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043d\u043e\u0435 \u0432 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0435 MailboxRetention \\ Set-MailboxDatabase -MailboxRetention '0.00:00:00' -Identity $db_name \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 Archive Enable-Mailbox -Identity $name -Archive \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0430\u0440\u0445\u0438\u0432 \u0434\u043b\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \\ Get-Mailbox $name | New-MoveReques \u2013ArchiveOnly \u2013ArchiveTargetDatabase DBArch \u043f\u0435\u0440\u0435\u043c\u0435\u0441\u0442\u0438\u0442\u044c \u0430\u0440\u0445\u0438\u0432\u043d\u044b\u0439 \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0439 \u044f\u0449\u0438\u043a \u0432 \u0434\u0440\u0443\u0433\u0443\u044e \u0411\u0414 \\ Get-Mailbox $name | fl Name,Database,ArchiveDatabase \u043c\u0435\u0441\u0442\u043e \u0440\u0430\u0441\u043f\u043e\u043b\u043e\u0436\u0435\u043d\u0438\u044f \u0411\u0414 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0438 \u0411\u0414 \u0435\u0433\u043e \u0430\u0440\u0445\u0438\u0432\u0430 \\ Disable-Mailbox -Identity $name -Archive \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0430\u0440\u0445\u0438\u0432 \\ Connect-Mailbox -Identity \"8734c04e-981e-4ccf-a547-1c1ac7ebf3e2\" -Archive -User $name -Database it2 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u0430\u0440\u0445\u0438\u0432\u0430 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u043a \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u043c\u0443 \u043f\u043e\u0447\u0442\u043e\u0432\u043e\u043c\u0443 \u044f\u0449\u0438\u043a\u0443 \\ Get-Mailbox $name | Set-Mailbox -ArchiveQuota 20GB -ArchiveWarningQuota 19GB \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u043a\u0432\u043e\u0442\u044b \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0430\u0440\u0445\u0438\u0432\u0430 Quota Get-Mailbox -Identity $mailbox | fl IssueWarningQuota, ProhibitSendQuota, ProhibitSendReceiveQuota, UseDatabaseQuotaDefaults \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043a\u0432\u043e\u0442\u044b \u043f\u043e\u0447\u0442\u043e\u0432\u043e\u0433\u043e \u044f\u0449\u0438\u043a\u0430 \\ IssueWarningQuota \u2014 \u043a\u0432\u043e\u0442\u0430, \u043f\u0440\u0438 \u0434\u043e\u0441\u0442\u0438\u0436\u0435\u043d\u0438\u0438 \u043a\u043e\u0442\u043e\u0440\u043e\u0439 Exchange \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442 \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0435 \\ ProhibitSendQuota \u2014 \u043f\u0440\u0438 \u0434\u043e\u0441\u0442\u0438\u0436\u0435\u043d\u0438\u0438 \u0431\u0443\u0434\u0435\u0442 \u0437\u0430\u043f\u0440\u0435\u0449\u0435\u043d\u0430 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0430 \\ ProhibitSendReceiveQuota \u2014 \u043f\u0440\u0438 \u0434\u043e\u0441\u0442\u0438\u0436\u0435\u043d\u0438\u0438 \u0431\u0443\u0434\u0435\u0442 \u0437\u0430\u043f\u0440\u0435\u0449\u0435\u043d\u0430 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0430 \u0438 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 \\ UseDatabaseQuotaDefaults \u2014 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u043b\u0438 \u043a\u0432\u043e\u0442\u0430 \u0411\u0414 \u0438\u043b\u0438 false - \u0438\u043d\u0434\u0432\u0438\u0434\u0438\u0443\u0430\u043b\u044c\u043d\u044b\u0435 \\ Set-Mailbox -Identity $mailbox -UseDatabaseQuotaDefaults $false -IssueWarningQuota \"3 GB\" -ProhibitSendQuota \"4 GB\" -ProhibitSendReceiveQuota \"5 GB\" \u0437\u0430\u0434\u0430\u0442\u044c \u043a\u0432\u043e\u0442\u0443 \u0434\u043b\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f Get-MailboxDatabase $db_name | fl Name, *Quota \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043a\u0432\u043e\u0442\u044b \u043d\u0430\u043b\u043e\u0436\u0435\u043d\u043d\u044b\u0435 \u043d\u0430 \u0411\u0414 \\ Set-MailboxDatabase $db -ProhibitSendReceiveQuota \"5 GB\" -ProhibitSendQuota \"4 GB\" -IssueWarningQuota \"3 GB\" \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u043a\u0432\u043e\u0442\u044b \u043d\u0430 \u0411\u0414 Database Get-MailboxDatabase -Status | select ServerName,Name,DatabaseSize \u0441\u043f\u0438\u0441\u043e\u043a \u0438 \u0440\u0430\u0437\u043c\u0435\u0440 \u0432\u0441\u0435\u0445 \u0411\u0414 \u043d\u0430 \u0432\u0441\u0435\u0445 MX-\u0441\u0435\u0440\u0432\u0435\u0440\u0430\u0445 \\ New-MailboxDatabase -Name it_2022 -EdbFilePath E:\\Bases\\it_2022\\it_2022.edb -LogFolderPath G:\\Logs\\it_2022 -OfflineAddressBook \"Default Offline Address List\" -server exch-mx-01 \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0411\u0414 \\ Restart-Service MSExchangeIS \\ Get-Service | Where {$_ -match \"exchange\"} | Restart-Service \\ Get-MailboxDatabase -Server exch-01 \u0441\u043f\u0438\u0441\u043e\u043a \u0431\u0430\u0437 \u0434\u0430\u043d\u043d\u044b\u0445 \u043d\u0430 MX-\u0441\u0435\u0440\u0432\u0435\u0440\u0435 \\ New-MoveRequest -Identity \"support4\" -TargetDatabase it_2022 \u043f\u0435\u0440\u0435\u043c\u0435\u0441\u0442\u0438\u0442\u044c \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0439 \u044f\u0449\u0438\u043a \u0432 \u043d\u043e\u0432\u0443\u044e \u0411\u0414 \\ Move-Databasepath $db_name \u2013EdbFilepath \"F:\\DB\\$db_name\\$db_name.edb\" \u2013LogFolderpath \"E:\\DB\\$db_name\\logs\\\" \u043f\u0435\u0440\u0435\u043c\u0435\u0441\u0442\u0438\u0442\u044c \u0411\u0414 \u0438 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u043e\u043d\u043d\u044b\u0435 \u043b\u043e\u0433\u0438 \u043d\u0430 \u0434\u0440\u0443\u0433\u043e\u0439 \u0434\u0438\u0441\u043a \\ Set-MailboxDatabase -CircularLoggingEnabled $true -Identity $db_name \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0446\u0438\u043a\u043b\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u0432\u0435\u0434\u0435\u043d\u0438\u0435 \u0436\u0443\u0440\u043d\u0430\u043b\u0430 (Circular Logging), \u0433\u0434\u0435 \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u043f\u0438\u0448\u0443\u0442\u0441\u044f 4 \u0444\u0430\u0439\u043b\u0430 \u043b\u043e\u0433\u043e\u0432 \u043f\u043e 5 \u041c\u0411, \u043f\u043e\u0441\u043b\u0435 \u0447\u0435\u0433\u043e \u043f\u0435\u0440\u0432\u044b\u0439 \u043b\u043e\u0433-\u0444\u0430\u0439\u043b \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0438\u0441\u044b\u0432\u0430\u0435\u0442\u0441\u044f \\ Set-MailboxDatabase -CircularLoggingEnabled $false -Identity $db_name \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0446\u0438\u043a\u043b\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u0432\u0435\u0434\u0435\u043d\u0438\u0435 \u0436\u0443\u0440\u043d\u0430\u043b\u0430 \\ Get-MailboxDatabase -Server \"exch-mx-01\" -Status | select EdbFilePath,LogFolderPath,LogFilePrefix \u043f\u0443\u0442\u044c \u043a \u0411\u0414, \u043b\u043e\u0433\u0430\u043c, \u0438\u043c\u044f \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u0430\u043a\u0442\u0443\u0430\u043b\u044c\u043d\u043e\u0433\u043e \u043b\u043e\u0433-\u0444\u0430\u0439\u043b\u0430 MailboxRepairRequest New-MailboxRepairRequest -Database it2 -CorruptionType ProvisionedFolder, SearchFolder, AggregateCounts, Folderview \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u0442\u0435\u0441\u0442 (\u0432 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0439 \u043c\u043e\u043c\u0435\u043d\u0442 \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u043d\u0435 \u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d \u043e\u0434\u0438\u043d \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0439 \u044f\u0449\u0438\u043a) \u0438 \u0438\u0441\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043e\u0448\u0438\u0431\u043e\u043a \u043d\u0430 \u043f\u0440\u0438\u043a\u043b\u0430\u0434\u043d\u043e\u043c \u0443\u0440\u043e\u0432\u043d\u0435 \\ Get-MailboxRepairRequest -Database it2 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \\ \u041f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0438\u0441\u043f\u0440\u0430\u0432\u0438\u0442\u044c: \\ ProvisionedFolder \u2013 \u043d\u0430\u0440\u0443\u0448\u0435\u043d\u0438\u044f \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u043e\u0439 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u044b \u043f\u0430\u043f\u043e\u043a \\ SearchFolder \u2013 \u043e\u0448\u0438\u0431\u043a\u0438 \u0432 \u043f\u0430\u043f\u043a\u0430\u0445 \u043f\u043e\u0438\u0441\u043a\u0430 \\ AggregateCounts \u2013 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0438 \u0438\u0441\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438 \u043e \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u0435 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432 \u0432 \u043f\u0430\u043f\u043a\u0430\u0445 \u0438 \u0438\u0445 \u0440\u0430\u0437\u043c\u0435\u0440\u0435 \\ FolderView \u2013 \u043d\u0435\u0432\u0435\u0440\u043d\u043e\u0435 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435, \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u043c\u043e\u0435 \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u044f\u043c\u0438 \u043f\u0430\u043f\u043e\u043a eseutil \u041f\u0440\u0438 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0435/\u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0438 \u043b\u044e\u0431\u043e\u0433\u043e \u043f\u0438\u0441\u044c\u043c\u0430 Exchange \u0441\u043d\u0430\u0447\u0430\u043b\u0430 \u0432\u043d\u043e\u0441\u0438\u0442 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u0432 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u043e\u043d\u043d\u044b\u0439 \u043b\u043e\u0433, \u0438 \u0442\u043e\u043b\u044c\u043a\u043e \u043f\u043e\u0442\u043e\u043c \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u0442 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 \u043d\u0435\u043f\u043e\u0441\u0440\u0435\u0434\u0441\u0442\u0432\u0435\u043d\u043d\u043e \u0432 \u0431\u0430\u0437\u0443 \u0434\u0430\u043d\u043d\u044b\u0445. \u0420\u0430\u0437\u043c\u0435\u0440 \u043e\u0434\u043d\u043e\u0433\u043e \u043b\u043e\u0433 \u0444\u0430\u0439\u043b\u0430 - 1 \u041c\u0431. \u0415\u0441\u0442\u044c \u0442\u0440\u0438 \u0441\u043f\u043e\u0441\u043e\u0431\u0430 \u0443\u0440\u0435\u0437\u0430\u043d\u0438\u044f \u043b\u043e\u0433\u043e\u0432: DAG, Backup \u043d\u0430 \u0431\u0430\u0437\u0435 Volume Shadow Copy, Circular Logging. \u0420\u0443\u0447\u043d\u043e\u0435 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0436\u0443\u0440\u043d\u0430\u043b\u043e\u0432 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439: \\ cd E:\\MS_Exchange_2010\\MailBox\\Reg_v1_MailBoxes\\ \u043f\u0435\u0440\u0435\u0439\u0442\u0438 \u0432 \u043a\u0430\u0442\u0430\u043b\u043e\u0433 \u0441 \u043b\u043e\u0433\u0430\u043c\u0438 \\ ls E*.chk \u0443\u0437\u043d\u0430\u0442\u044c \u0438\u043c\u044f \u0444\u0430\u0439\u043b\u0430, \u0432 \u043a\u043e\u0442\u043e\u0440\u043e\u043c \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u0438\u0437 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044c\u043d\u043e\u0439 \u0442\u043e\u0447\u043a\u0438 \u0444\u0438\u043a\u0441\u0430\u0446\u0438\u0438 \u0436\u0443\u0440\u043d\u0430\u043b\u043e\u0432 \\ eseutil /mk .\\E18.chk \u0443\u0437\u043d\u0430\u0442\u044c \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0439 \u0444\u0430\u0439\u043b \u0436\u0443\u0440\u043d\u0430\u043b\u0430, \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f \u0438\u0437 \u043a\u043e\u0442\u043e\u0440\u043e\u0433\u043e \u0431\u044b\u043b\u0438 \u0437\u0430\u043d\u0435\u0441\u0435\u043d\u044b \u0432 \u0411\u0414 Exchange \\ Checkpoint: (0x561299,8,16) 561299 \u0438\u043c\u044f \u0444\u0430\u0439\u043b\u0430, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0431\u044b\u043b \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u043c \u0437\u0430\u0444\u0438\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d (\u0435\u0433\u043e \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u0443\u0436\u0435 \u0432 \u0431\u0430\u0437\u0435 \u0434\u0430\u043d\u043d\u044b\u0445) \\ \u041d\u0430\u0445\u043e\u0434\u0438\u043c \u0432 \u043f\u0440\u043e\u0432\u043e\u0434\u043d\u0438\u043a\u0435 \u0444\u0430\u0439\u043b E0500561299.txt, \u043c\u043e\u0436\u043d\u043e \u0443\u0434\u0430\u043b\u044f\u0442\u044c \u0432\u0441\u0435 \u0444\u0430\u0439\u043b\u044b \u0436\u0443\u0440\u043d\u0430\u043b\u043e\u0432, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0441\u0442\u0430\u0440\u0448\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043d\u043e\u0433\u043e \u0444\u0430\u0439\u043b\u0430 \u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0411\u0414 (\u0435\u0441\u043b\u0438 \u0434\u0432\u0435 \u043a\u043e\u043f\u0438\u0438 \u0411\u0414 \u0441 \u043e\u0448\u0438\u0431\u043a\u043e\u0439): \\ Get-MailboxDatabaseCopyStatus -Identity db_name\\* | Format-List Name,Status,ContentIndexState \\ Status : FailedAndSuspended \\ ContentIndexState : Failed \\ Status : Dismounted \\ ContentIndexState : Failed Get-MailboxDatabase -Server exch-mx-01 -Status | fl Name,EdbFilePath,LogFolderPath \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0440\u0430\u0441\u043f\u043e\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u0431\u0430\u0437\u044b \u0438 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u043e\u043d\u043d\u044b\u0445 \u043b\u043e\u0433\u043e\u0432 \\ LogFolderPath - \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u044f \u043b\u043e\u0433\u043e\u0432 \\ E18 - \u0438\u043c\u044f \u0442\u0440\u0430\u043d\u043a\u0437\u0430\u043a\u0446\u0438\u043e\u043d\u043d\u043e\u0433\u043e \u043b\u043e\u0433\u0430 (\u0438\u0437 \u043d\u0435\u0433\u043e \u0447\u0438\u0442\u0430\u044e\u0442\u0441\u044f \u043e\u0441\u0442\u0430\u043b\u044c\u043d\u044b\u0435 \u043b\u043e\u0433\u0438) \\ dismount-Database db_name \u043e\u0442\u043c\u0430\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0411\u0414 \\ eseutil /mh D:\\MS_Exchange_2010\\Mailbox\\db_name\\db_name.edb \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0431\u0430\u0437\u0443 \\ State: Dirty Shutdown - \u043d\u0435\u0441\u043e\u0433\u043b\u0430\u0441\u043e\u0432\u0430\u043d\u043d\u043e\u0435 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435, \u043e\u0437\u043d\u0430\u0447\u0430\u0435\u0442, \u0447\u0442\u043e \u0447\u0430\u0441\u0442\u044c \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439 \u043d\u0435 \u043f\u0435\u0440\u0435\u043d\u0435\u0441\u0435\u043d\u0430 \u0432 \u0431\u0430\u0437\u0443, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u043f\u043e\u0441\u043b\u0435 \u0442\u043e\u0433\u043e, \u043a\u0430\u043a \u0431\u044b\u043b\u0430 \u043e\u0441\u0443\u0449\u0435\u0441\u0442\u0432\u043b\u0435\u043d\u0430 \u0430\u0432\u0430\u0440\u0438\u0439\u043d\u0430\u044f \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430. \\ eseutil /ml E:\\MS_Exchange_2010\\MailBox\\db_name\\E18 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0446\u0435\u043b\u043e\u0441\u0442\u043d\u043e\u0441\u0442\u0438 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u043e\u043d\u043d\u044b\u0445 \u043b\u043e\u0433\u0438, \u0435\u0441\u043b\u0438 \u0435\u0441\u0442\u044c \u043b\u043e\u0433\u0438 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439 \u0438 \u043e\u043d\u0438 \u043d\u0435 \u0438\u0441\u043f\u043e\u0440\u0447\u0435\u043d\u044b, \u0442\u043e \u043c\u043e\u0436\u043d\u043e \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0438\u0437 \u043d\u0438\u0445, \u0438\u0437 \u0444\u0430\u0439\u043b\u0430 E18 \u0441\u0447\u0438\u0442\u044b\u0432\u0430\u044e\u0442\u0441\u044f \u0432\u0441\u0435 \u043b\u043e\u0433\u0438, \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u0441\u0442\u0430\u0442\u0443\u0441 - \u041e\u041a Soft Recovery (\u043c\u044f\u0433\u043a\u043e\u0435 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435) - \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043f\u0435\u0440\u0435\u0432\u0435\u0441\u0442\u0438 \u0431\u0430\u0437\u0443 \u0432 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e\u0433\u043e \u043e\u0442\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f (Clear shutdown) \u043f\u0443\u0442\u0435\u043c \u0437\u0430\u043f\u0438\u0441\u0438 \u043d\u0435\u0434\u043e\u0441\u0442\u0430\u044e\u0449\u0438\u0445 \u0444\u0430\u0439\u043b\u043e\u0432 \u0436\u0443\u0440\u043d\u0430\u043b\u043e\u0432 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439 \u0432 \u0411\u0414. \\ eseutil /R E18 /l E:\\MS_Exchange_2010\\MailBox\\db_name\\ /d D:\\MS_Exchange_2010\\Mailbox\\db_name\\db_name.edb \\ eseutil /R E18 /a /i /l E:\\MS_Exchange_2010\\MailBox\\db_name\\ /d D:\\MS_Exchange_2010\\Mailbox\\db_name\\db_name.edb \u0435\u0441\u043b\u0438 \u0441 \u043b\u043e\u0433\u0430\u043c\u0438 \u0447\u0442\u043e-\u0442\u043e \u043d\u0435 \u0442\u0430\u043a, \u043c\u043e\u0436\u043d\u043e \u043f\u043e\u043f\u0440\u043e\u0431\u043e\u0432\u0430\u0442\u044c \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0431\u0430\u0437\u0443 \u0438\u0433\u043d\u043e\u0440\u0438\u0440\u0443\u044f \u043e\u0448\u0438\u0431\u043a\u0443 \u0432 \u043b\u043e\u0433\u0430\u0445 \\ eseutil /mk D:\\MS_Exchange_2010\\Mailbox\\db_name\\db_name.edb c\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0438 \u0444\u0430\u0439\u043b\u0430 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044c\u043d\u044b\u0445 \u0442\u043e\u0447\u0435\u043a \\ eseutil /g D:\\MS_Exchange_2010\\Mailbox\\db_name\\db_name.edb \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0446\u0435\u043b\u043e\u0441\u0442\u043d\u043e\u0441\u0442\u0438 \u0411\u0414 \\ eseutil /k D:\\MS_Exchange_2010\\Mailbox\\db_name\\db_name.edb \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044c\u043d\u044b\u0445 \u0441\u0443\u043c\u043c \u0431\u0430\u0437\u044b (CRC) Hard Recovery - \u0435\u0441\u043b\u0438 \u043b\u043e\u0433\u0438 \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442 \u043e\u0448\u0438\u0431\u043a\u0438 \u0438 \u0431\u0430\u0437\u0430 \u043d\u0435 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u0442\u0441\u044f, \u0442\u043e \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u043c \u0431\u0430\u0437\u0443 \u0431\u0435\u0437 \u043b\u043e\u0433\u043e\u0432. \\ eseutil /p D:\\MS_Exchange_2010\\Mailbox\\db_name\\db_name.edb \\ /p - \u0443\u0434\u0430\u043b\u0438\u0442 \u043f\u043e\u0432\u0440\u0435\u0436\u0434\u0435\u043d\u043d\u044b\u0435 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b, \u044d\u0442\u0430 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u0431\u0443\u0434\u0435\u0442 \u0443\u0434\u0430\u043b\u0435\u043d\u0430 \u0438\u0437 \u0411\u0414 \u0438 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442 \u0446\u0435\u043b\u043e\u0441\u0442\u043d\u043e\u0441\u0442\u044c \\ esetuil /d D:\\MS_Exchange_2010\\Mailbox\\db_name\\db_name.edb \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0434\u0435\u0444\u0440\u0430\u0433\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044e (\u0435\u0441\u043b\u0438 \u0431\u044b\u043b \u043f\u043e\u0442\u0435\u0440\u044f\u043d \u0431\u043e\u043b\u044c\u0448\u043e\u0439 \u043e\u0431\u044a\u0435\u043c \u0434\u0430\u043d\u043d\u044b\u0445, \u0442\u043e \u043c\u043e\u0436\u0435\u0442 \u0441\u0438\u043b\u044c\u043d\u043e \u0441\u043d\u0438\u0437\u0438\u0442\u044c\u0441\u044f \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c) \\ \u041f\u043e\u0441\u043b\u0435 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u043a\u043e\u043c\u0430\u043d\u0434 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0432\u0440\u0443\u0447\u043d\u0443\u044e \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u0441\u0435 \u0444\u0430\u0439\u043b\u044b \u0441 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u0435\u043c log \u0432 \u043f\u0430\u043f\u043a\u0435 MDBDATA, \u043f\u0435\u0440\u0435\u0434 \u043f\u043e\u043f\u044b\u0442\u043a\u043e\u0439 \u0441\u043c\u043e\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0431\u0430\u0437\u0443 \u0434\u0430\u043d\u043d\u044b\u0445. \\ isinteg -s \"db_name.edb\" -test alltests \u043f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u0446\u0435\u043b\u043e\u0441\u0442\u043d\u043e\u0441\u0442\u044c \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 \\ isinteg -s \"server_name\" -fix -test -alltests \u0435\u0441\u043b\u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0431\u0443\u0434\u0435\u0442 \u043f\u0440\u043e\u0432\u0430\u043b\u0435\u043d\u0430. \u0412\u044b\u043f\u043e\u043b\u043d\u044f\u0442\u044c \u043a\u043e\u043c\u0430\u043d\u0434\u0443 \u0434\u043e \u0442\u0435\u0445 \u043f\u043e\u0440, \u043f\u043e\u043a\u0430 \u0443 \u0432\u0441\u0435\u0445 \u043e\u0448\u0438\u0431\u043e\u043a \u043d\u0435 \u0441\u0442\u0430\u043d\u0435\u0442 \u0441\u0442\u0430\u0442\u0443\u0441 0 \u0438\u043b\u0438 \u0441\u0442\u0430\u0442\u0443\u0441 \u043d\u0435 \u043f\u0435\u0440\u0435\u0441\u0442\u0430\u043d\u0435\u0442 \u043c\u0435\u043d\u044f\u0442\u044c\u0441\u044f, \u0438\u043d\u043e\u0433\u0434\u0430 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e 3 \u043f\u0440\u043e\u0445\u043e\u0434\u0430 \u0434\u043b\u044f \u0434\u043e\u0441\u0442\u0438\u0436\u0435\u043d\u0438\u044f \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0430. \\ eseutil /mh D:\\MS_Exchange_2010\\Mailbox\\db_name\\db_name.edb | Select-String -Pattern \"State:\",\"Log Required:\" \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0441\u0442\u0430\u0442\u0443\u0441 \\ State: Clear shutdown - \u0443\u0441\u043f\u0435\u0448\u043d\u044b\u0439 \u0441\u0442\u0430\u0442\u0443\u0441 \\ Log Required \u0442\u0440\u0435\u0431\u0443\u044e\u0442\u0441\u044f \u043b\u0438 \u0444\u0430\u0439\u043b\u044b \u0436\u0443\u0440\u043d\u0430\u043b\u043e\u0432, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u044b\u0435 \u0431\u0430\u0437\u0435, \u0447\u0442\u043e\u0431\u044b \u043f\u0435\u0440\u0435\u0439\u0442\u0438 \u0432 \u0441\u043e\u0433\u043b\u0430\u0441\u043e\u0432\u0430\u043d\u043d\u043e\u0435 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435. \u0415\u0441\u043b\u0438 \u0431\u0430\u0437\u0430 \u0440\u0430\u0437\u043c\u043e\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0430 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e, \u0442\u043e \u044d\u0442\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0431\u0443\u0434\u0435\u0442 \u0440\u0430\u0432\u043d\u044f\u0442\u044c\u0441\u044f 0. \\ mount-Database -force db_name \u043f\u0440\u0438\u043c\u043e\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0411\u0414 \\ Get-MailboxDatabase \u2013Status db_name | fl Mounted \u0441\u0442\u0430\u0442\u0443\u0441 \u0411\u0414 \\ New-MailboxRepairRequest -Database db_name -CorruptionType SearchFolder,AggregateCounts,ProvisionedFolder,FolderView \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u043e\u0439 \u0446\u0435\u043b\u043e\u0441\u0442\u043d\u043e\u0441\u0442\u0438 \u0434\u0430\u043d\u043d\u044b\u0445 \\ \u041f\u043e\u0441\u043b\u0435 \u044d\u0442\u043e\u0433\u043e \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c Index. \\ \u0415\u0441\u043b\u0438 \u0438\u043d\u0434\u0435\u043a\u0441\u044b \u043d\u0435 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u044e\u0442\u0441\u044f, \u043d\u043e \u0411\u0414 \u043c\u043e\u043d\u0442\u0438\u0440\u0443\u0435\u0442\u0441\u044f, \u0442\u043e \u043f\u0435\u0440\u0435\u043d\u0435\u0441\u0442\u0438 \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0435 \u044f\u0449\u0438\u043a\u0438 \u0432 \u043d\u043e\u0432\u0443\u044e \u0411\u0414. \u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0411\u0414 \u0438\u0437 Backup: 1-\u0439 \u0432\u0430\u0440\u0438\u0430\u043d\u0442: 1. \u041e\u0442\u043c\u0430\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0442\u0435\u043a\u0443\u0449\u0443\u044e \u0411\u0414 \u0438 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0438\u043b\u0438 \u043f\u0435\u0440\u0435\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u0442\u044c \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u044e \u0441 \u0444\u0430\u0439\u043b\u0430\u043c\u0438 \u0442\u0435\u043a\u0443\u0449\u0435\u0439 \u0411\u0414. 3. \u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0432 \u0442\u0443 \u0436\u0435 \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u044e \u0438\u0437 Backup \u0431\u0430\u0437\u0443 \u0441 \u043b\u043e\u0433\u0430\u043c\u0438. 4. \u0417\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u043c\u044f\u0433\u043a\u043e\u0435 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0411\u0414 (Soft Recovery). 5. \u041f\u0440\u0438\u043c\u043e\u043d\u0438\u0442\u043e\u0440\u0432\u0430\u0442\u044c. 2-\u0439 \u0432\u0430\u0440\u0438\u0430\u043d\u0442: 1. \u041e\u0442\u043c\u0430\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0438 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0442\u0435\u043a\u0443\u0449\u0443\u044e \u0411\u0414. 2. \u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0411\u0414 \u0441 \u043b\u043e\u0433\u0430\u043c\u0438 \u0438\u0437 Backup \u0432 \u043b\u044e\u0431\u043e\u0435 \u043c\u0435\u0441\u0442\u043e. 3. \u0417\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u043c\u044f\u0433\u043a\u043e\u0435 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0411\u0414 (Soft Recovery). 4. \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043d\u043e\u0432\u0443\u044e \u0411\u0414. 5. \u0421\u043e\u0437\u0434\u0430\u0442\u044c Recovery Database \u0438 \u0441\u043c\u043e\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u043d\u0435\u0435 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u0443\u044e \u0438\u0437 \u0431\u044d\u043a\u0430\u043f\u0430 \u0411\u0414, \u0441\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0438\u0437 \u043d\u0435\u0451 \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0435 \u044f\u0449\u0438\u043a\u0438 \u0432 \u043d\u043e\u0432\u0443\u044e \u0411\u0414 \u0438 \u043f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043d\u0430 \u043d\u0438\u0445 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439. 6. \u0415\u0441\u043b\u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c Dial Tone Recovery, \u0442\u043e \u0442\u0430\u043a \u0436\u0435 \u043f\u0435\u0440\u0435\u043d\u0435\u0441\u0442\u0438 \u0438\u0437 \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e\u0439 \u0411\u0414 \u043f\u0440\u043e\u043c\u0435\u0436\u0443\u0442\u043e\u0447\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0445 \u044f\u0449\u0438\u043a\u043e\u0432. 3-\u0439 \u0432\u0430\u0440\u0438\u0430\u043d\u0442: 1. \u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0446\u0435\u043b\u043e\u0441\u0442\u043d\u043e\u0441\u0442\u044c Soft Repair \u0438\u043b\u0438 Hard Recovery. 2. \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043d\u043e\u0432\u0443\u044e \u0411\u0414. \u0423\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c \u0432 \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430\u0445: \u00ab\u0431\u0430\u0437\u0430 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0438\u0441\u0430\u043d\u0430 \u043f\u0440\u0438 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0438\u00bb. 3. \u0415\u0441\u043b\u0438 \u0431\u0430\u0437\u0430 \u0431\u044b\u043b\u0430 \u0442\u043e\u043b\u044c\u043a\u043e \u0447\u0442\u043e \u043e\u0437\u0434\u0430\u043d\u0430 \u0438 \u0435\u0449\u0435 \u043d\u0435 \u0431\u044b\u043b\u0430 \u043f\u043e\u0434\u043c\u043e\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0430, \u0442\u043e \u044d\u0442\u0430 \u043f\u0430\u043f\u043a\u0430 \u0431\u0443\u0434\u0435\u0442 \u043f\u0443\u0441\u0442\u0430, \u0442\u0443\u0434\u0430 \u043f\u0435\u0440\u0435\u043c\u0435\u0449\u0430\u0435\u043c \u0431\u0430\u0437\u0443 \u0438\u0437 Backup, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u0431\u044b\u043b\u0430 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u043d\u0430 ESEUTIL \u0432\u043c\u0435\u0441\u0442\u0435 \u0441\u043e \u0432\u0441\u0435\u043c\u0438 \u0444\u0430\u0439\u043b\u0430\u043c\u0438. \u0423\u043a\u0430\u0437\u0430\u0442\u044c \u0438\u043c\u044f .edb \u0442\u0430\u043a\u043e\u0435 \u0436\u0435, \u043a\u043e\u0442\u043e\u0440\u043e\u0435 \u0431\u044b\u043b\u043e \u043f\u0440\u0438 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0438 \u043d\u043e\u0432\u043e\u0439 \u0431\u0430\u0437\u044b. 4. \u041c\u043e\u043d\u0442\u0438\u0440\u0443\u0435\u043c \u0431\u0430\u0437\u0443. 5. \u041f\u0435\u0440\u0435\u043d\u0430\u0446\u0435\u043b\u0438\u0432\u0430\u0435\u043c \u044f\u0449\u0438\u043a\u0438 \u0441\u043e \u0441\u0442\u0430\u0440\u043e\u0439 (Mailbox_DB_02), \u043d\u0435\u0438\u0441\u043f\u0440\u0430\u0432\u043d\u043e\u0439 \u0431\u0430\u0437\u044b, \u043d\u0430 \u043d\u043e\u0432\u0443\u044e \u0431\u0430\u0437\u0443 (Mailbox_DB_02_02): Get-Mailbox -Database Mailbox_DB_02 | where {$_.ObjectClass -NotMatch '(SystemAttendantMailbox|ExOleDbSystemMailbox)'} | Set-Mailbox -Database Mailbox_DB_02_02 6. \u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u043e\u0439 \u0446\u0435\u043b\u043e\u0441\u0442\u043d\u043e\u0441\u0442\u0438 \u0434\u0430\u043d\u043d\u044b\u0445: New-MailboxRepairRequest -Database \"Mailbox_DB_02_02\" -CorruptionType ProvisionedFolder, SearchFolder, AggregateCounts, Folderview Dial Tone Recovery Get-Mailbox -Database \"MailboxDB\" | Set-Mailbox -Database \"TempDB\" \u043f\u0435\u0440\u0435\u043d\u0430\u0446\u0435\u043b\u0438\u0442\u044c \u044f\u0449\u0438\u043a\u0438 \u0441 \u043e\u0434\u043d\u043e\u0439 \u0411\u0414 (\u043d\u0435\u0440\u0430\u0431\u043e\u0447\u0435\u0439) \u043d\u0430 \u0434\u0440\u0443\u0433\u0443\u044e (\u043f\u0443\u0441\u0442\u0443\u044e) \\ Get-Mailbox -Database TempDB \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0435 \u044f\u0449\u0438\u043a\u0438 \u0432 \u0411\u0414 TempDB \\ Restart-Service MSExchangeIS \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0441\u043b\u0443\u0436\u0431\u0443 Mailbox Information Store (\u0431\u0430\u043d\u043a\u0430 \u0434\u0430\u043d\u043d\u044b\u0445), \u0438\u043d\u0430\u0447\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438 \u0431\u0443\u0434\u0443\u0442 \u043f\u043e-\u043f\u0440\u0435\u0436\u043d\u0435\u043c\u0443 \u043f\u044b\u0442\u0430\u0442\u044c\u0441\u044f \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f \u043a \u0441\u0442\u0430\u0440\u043e\u0439 \u0411\u0414 \\ iisreset \\ Get-Mailbox -Database \"TempDB\" | Set-Mailbox -Database \"MailboxDB\" \u043f\u043e\u0441\u043b\u0435 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0441\u0442\u0430\u0440\u043e\u0439 \u0411\u0414, \u043d\u0443\u0436\u043d\u043e \u043f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \u0441 \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e\u0439 \u0411\u0414 \u043e\u0431\u0440\u0430\u0442\u043d\u043e \\ \u041f\u043e\u0441\u043b\u0435 \u044d\u0442\u043e\u0433\u043e \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u0441\u043b\u0438\u044f\u043d\u0438\u0435 \u0441 \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e\u0439 \u0411\u0414 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e Recovery. Recovery database (RDB) New-MailboxDatabase \u2013Recovery \u2013Name RecoveryDB \u2013Server $exch_mx \u2013EdbFilePath \"D:\\TempDB\\TempDB.edb\" -LogFolderPath \"D:\\TempDB\" \u0434\u043b\u044f \u043f\u0435\u0440\u0435\u043d\u043e\u0441\u0430 \u043d\u043e\u0432\u044b\u0445 \u043f\u0438\u0441\u0435\u043c \u0438\u0437 \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e\u0439 \u0411\u0414 \u0432 \u043e\u0441\u043d\u043e\u0432\u043d\u0443\u044e \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c \u0442\u043e\u043b\u044c\u043a\u043e \u0441\u0430\u043c \u0444\u0430\u0439\u043b TempDB.edb \u0441\u043e \u0441\u0442\u0430\u0442\u0443\u0441\u043e\u043c Clean Shutdown, \u0438\u0437 \u043d\u0435\u0435 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0441\u043b\u0443\u0436\u0435\u0431\u043d\u0443\u044e \u0411\u0414 (\u043a\u043b\u044e\u0447 -Recovery) \\ Mount-Database \"D:\\TempDB\\TempDB.edb\" \u043f\u0440\u0438\u043c\u043e\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0411\u0414 \\ Get-MailboxStatistics -Database RecoveryDB \\ New-MailboxRestoreRequest \u2013SourceDatabase RecoveryDB \u2013SourceStoreMailbox support \u2013TargetMailbox support \u0441\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u043f\u043e\u0447\u0442\u043e\u0432\u043e\u0433\u043e \u044f\u0449\u0438\u043a\u0430 \u0441 DisplayName: support \u0438\u0437 RecoveryDB \u0432 \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0439 \u044f\u0449\u0438\u043a \u0441 \u043f\u0441\u0435\u0432\u0434\u043e\u043d\u0438\u043c\u043e\u043c support \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0435\u0439 \u0431\u0430\u0437\u044b. \u041f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \u0438\u0449\u0435\u0442 \u0432 \u043f\u043e\u0447\u0442\u043e\u0432\u043e\u0439 \u0431\u0430\u0437\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u044e\u0449\u0438\u0435 LegacyExchangeDN \u043b\u0438\u0431\u043e \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0435 \u0430\u0434\u0440\u0435\u0441\u0430 X500, \u0435\u0441\u043b\u0438 \u043d\u0443\u0436\u043d\u043e \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u0434\u0440\u0443\u0433\u043e\u0439 \u044f\u0449\u0438\u043a, \u043d\u0443\u0436\u043d\u043e \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c \u043a\u043b\u044e\u0447 -AllowLegacyDNMisMatch \\ New-MailboxRestoreRequest \u2013SourceDatabase RecoveryDB \u2013SourceStoreMailbox support \u2013TargetMailbox support \u2013TargetRootFolder \"Restore\" \u0441\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0438\u0441\u044c\u043c\u0430 \u0432 \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u0443\u044e \u043f\u0430\u043f\u043a\u0443 \u0432 \u044f\u0449\u0438\u043a\u0435 \u043d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f (\u0441\u043e\u0437\u0434\u0430\u0435\u0442\u0441\u044f \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438), \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0439 \u043f\u0430\u043f\u043a\u0438 -IncludeFolders \"#Inbox#\" \\ Get-MailboxRestoreRequest | Get-MailboxRestoreRequestStatistics \u0441\u0442\u0430\u0442\u0443\u0441 \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \\ Get-MailboxRestoreRequestStatistics -Identity support \\ Get-MailboxRestoreRequest -Status Completed | Remove-MailboxRestoreRequest \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u0441\u0435 \u0443\u0441\u043f\u0435\u0448\u043d\u044b\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u044b Transport Get-TransportServer $srv_cas | select MaxConcurrentMailboxDeliveries,MaxConcurrentMailboxSubmissions,MaxConnectionRatePerMinute,MaxOutboundConnections,MaxPerDomainOutboundConnections,PickupDirectoryMaxMessagesPerMinute \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u043f\u0440\u043e\u043f\u0443\u0441\u043a\u043d\u043e\u0439 \u0441\u043f\u043e\u0441\u043e\u0431\u043d\u043e\u0441\u0442\u0438 \u0442\u0440\u0430\u043d\u0441\u043f\u043e\u0440\u0442\u043d\u043e\u0433\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \\ MaxConcurrentMailboxDeliveries \u2014 \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043e\u0434\u043d\u043e\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0445 \u043f\u043e\u0442\u043e\u043a\u043e\u0432, \u043a\u043e\u0442\u043e\u0440\u043e\u0435 \u043c\u043e\u0436\u0435\u0442 \u043e\u0442\u043a\u0440\u044b\u0442\u044c \u0441\u0435\u0440\u0432\u0435\u0440 \u0434\u043b\u044f \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 \u043f\u0438\u0441\u0435\u043c. \\ MaxConcurrentMailboxSubmissions \u2014 \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043e\u0434\u043d\u043e\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0445 \u043f\u043e\u0442\u043e\u043a\u043e\u0432, \u043a\u043e\u0442\u043e\u0440\u043e\u0435 \u043c\u043e\u0436\u0435\u0442 \u043e\u0442\u043a\u0440\u044b\u0442\u044c \u0441\u0435\u0440\u0432\u0435\u0440 \u0434\u043b\u044f \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u043f\u0438\u0441\u0435\u043c. \\ MaxConnectionRatePerMinute \u2014 \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u0430\u044f \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u044c \u043e\u0442\u043a\u0440\u044b\u0442\u0438\u044f \u0432\u0445\u043e\u0434\u044f\u0449\u0438\u0445 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0439 \u0432 \u043c\u0438\u043d\u0443\u0442\u0443. \\ MaxOutboundConnections \u2014 \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0439, \u043a\u043e\u0442\u043e\u0440\u043e\u0435 \u043c\u043e\u0436\u0435\u0442 \u043e\u0442\u043a\u0440\u044b\u0442\u044c Exchange \u0434\u043b\u044f \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438. \\ MaxPerDomainOutboundConnections \u2014 \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0438\u0441\u0445\u043e\u0434\u044f\u0449\u0438\u0445 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0439, \u043a\u043e\u0442\u043e\u0440\u043e\u0435 \u043c\u043e\u0436\u0435\u0442 \u043e\u0442\u043a\u0440\u044b\u0442\u044c Exchange \u0434\u043b\u044f \u043e\u0434\u043d\u043e\u0433\u043e \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u043e\u0433\u043e \u0434\u043e\u043c\u0435\u043d\u0430. \\ PickupDirectoryMaxMessagesPerMinute \u2014 \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u044c \u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u0435\u0439 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0432 \u043c\u0438\u043d\u0443\u0442\u0443 (\u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u0435 \u043f\u0438\u0441\u0435\u043c \u043f\u043e \u043f\u0430\u043f\u043a\u0430\u043c). \\ Set-TransportServer exchange-cas -MaxConcurrentMailboxDeliveries 21 -MaxConcurrentMailboxSubmissions 21 -MaxConnectionRatePerMinute 1201 -MaxOutboundConnections 1001 -MaxPerDomainOutboundConnections 21 -PickupDirectoryMaxMessagesPerMinute 101 \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f Get-TransportConfig | select MaxSendSize, MaxReceiveSize \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u0435 \u0440\u0430\u0437\u043c\u0435\u0440\u0430 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u043d\u0430 \u0443\u0440\u043e\u0432\u043d\u0435 \u0442\u0440\u0430\u0441\u043f\u043e\u0440\u0442\u0430 (\u043d\u0430\u0438\u043c\u0435\u043d\u044c\u0448\u0438\u0439 \u043f\u0440\u0438\u043e\u0440\u0438\u0442\u0435\u0442, \u043f\u043e\u0441\u043b\u0435 \u043a\u043e\u043d\u043d\u0435\u043a\u0442\u043e\u0440\u0430 \u0438 \u043f\u043e\u0447\u0442\u043e\u0432\u043e\u0433\u043e \u044f\u0449\u0438\u043a\u0430). \\ New-TransportRule -Name AttachmentLimit -AttachmentSizeOver 15MB -RejectMessageReasonText \"Sorry, messages with attachments over 15 MB are not accepted\" \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0442\u0440\u0430\u043d\u0441\u043f\u043e\u0440\u0442\u043d\u043e\u0435 \u043f\u0440\u0430\u0432\u0438\u043b\u043e \u0434\u043b\u044f \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u0440\u0430\u0437\u043c\u0435\u0440\u0430 \u0432\u043b\u043e\u0436\u0435\u043d\u0438\u044f Connector Get-ReceiveConnector | select Name,MaxMessageSize,RemoteIPRanges,WhenChanged \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u044f \u0440\u0430\u0437\u043c\u0435\u0440\u0430 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u043d\u0430 \u0443\u0440\u043e\u0432\u043d\u0435 \u043a\u043e\u043d\u043d\u0435\u043a\u0442\u043e\u0440\u0430 (\u043f\u0440\u0438\u043e\u0440\u0438\u0442\u0435\u0442 \u043d\u0438\u0436\u0435, \u0447\u0435\u043c \u0443 \u043f\u043e\u0447\u0442\u043e\u0432\u043e\u0433\u043e \u044f\u0449\u0438\u043a\u0430) \\ Set-ReceiveConnector ((Get-ReceiveConnector).Identity)[-1] -MaxMessageSize 30Mb \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0440\u0430\u0437\u043c\u0435\u0440 \u0443 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u043a\u043e\u043d\u043d\u0435\u043a\u0442\u043e\u0440\u0430 \u0432 \u0441\u043f\u0438\u0441\u043a\u0435 (\u043f\u0440\u0438\u043e\u0440\u0438\u0442\u0435\u0442 \u0432\u044b\u0448\u0435, \u0447\u0435\u043c \u0443 \u0442\u0440\u0430\u0441\u043f\u043e\u0440\u0442\u0430) \\ Get-Mailbox \"support4\" | select MaxSendSize, MaxReceiveSize \u043d\u0430\u0438\u0432\u044b\u0441\u0448\u0438\u0439 \u043f\u0440\u0438\u043e\u0440\u0438\u0442\u0435\u0442 \\ Set-Mailbox \"support4\" -MaxSendSize 30MB -MaxReceiveSize 30MB \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0440\u0430\u0437\u043c\u0435\u0440 Set-SendConnector -Identity \"ConnectorName\" -Port 26 \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u043e\u0440\u0442 \u043a\u043e\u043d\u043d\u0435\u043a\u0442\u043e\u0440\u0430 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 \\ Get-SendConnector \"proxmox\" | select port Get-ReceiveConnector | select Name,MaxRecipientsPerMessage \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e Exchange \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0435\u0442 \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u043d\u043e\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0430\u0434\u0440\u0435\u0441\u0430\u0442\u043e\u0432 \u0432 \u043e\u0434\u043d\u043e\u043c \u043f\u0438\u0441\u044c\u043c\u0435 (200) \\ Set-ReceiveConnector ((Get-ReceiveConnector).Identity)[-1] -MaxRecipientsPerMessage 50 \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \\ Set-ReceiveConnector ((Get-ReceiveConnector).Identity)[-1] -MessageRateLimit 1000 \u0437\u0430\u0434\u0430\u0442\u044c \u043b\u0438\u043c\u0438\u0442 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0432 \u043c\u0438\u043d\u0443\u0442\u0443 \u0434\u043b\u044f \u043a\u043e\u043d\u043d\u0435\u043a\u0442\u043e\u0440\u0430 Get-OfflineAddressbook | Update-OfflineAddressbook \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c OAB \\ Get-ClientAccessServer | Update-FileDistributionService PST New-MailboxExportRequest -Mailbox $name -filepath \"\\\\$srv\\pst\\$name.PST\" # -ContentFilter {(Received -lt \"01/01/2021\")} -Priority Highest/Lower # -IsArchive \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u044d\u043a\u0441\u043f\u043e\u0440\u0442 \u0438\u0437 \u0430\u0440\u0445\u0438\u0432\u0430 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \\ New-MailboxExportRequest -Mailbox $name -IncludeFolders \"#Inbox#\" -FilePath \"\\\\$srv\\pst\\$name.PST\" \u0442\u043e\u043b\u044c\u043a\u043e \u043f\u0430\u043f\u043a\u0443 \u0432\u0445\u043e\u0434\u044f\u0449\u0438\u0435 \\ New-MailboxImportRequest -Mailbox $name \"\\\\$srv\\pst\\$name.PST\" \u0438\u043c\u043f\u043e\u0440\u0442 \u0438\u0437 PST \\ Get-MailboxExportRequest \u0441\u0442\u0430\u0442\u0443\u0441 \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 \\ Get-MailboxExportRequest -Status Completed | Remove-MailboxExportRequest \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u043d\u044b\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u044b \\ Remove-MailboxExportRequest -RequestQueue MBXDB01 -RequestGuid 25e0eaf2-6cc2-4353-b83e-5cb7b72d441f \u043e\u0442\u043c\u0435\u043d\u0438\u0442\u044c \u044d\u043a\u0441\u043f\u043e\u0440\u0442 DistributionGroup Get-DistributionGroup \u0441\u043f\u0438\u0441\u043e\u043a \u0433\u0440\u0443\u043f\u043f \u0440\u0430\u0441\u0441\u044b\u043b\u043a\u0438 \\ Get-DistributionGroupMember \"!_\u041e\u0444\u0438\u0441\" \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \u0432 \u0433\u0440\u0443\u043f\u043f\u0435 \\ Add-DistributionGroupMember -Identity \"!_\u041e\u0444\u0438\u0441\" -Member \"$name@$domain\" \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u0433\u0440\u0443\u043f\u043f\u0443 \u0440\u0430\u0441\u0441\u044b\u043b\u043a\u0438 \\ Remove-DistributionGroupMember -Identity \"!_\u041e\u0444\u0438\u0441\" -Member \"$name@$domain\" \\ New-DistributionGroup -Name \"!_\u0422\u0435\u0441\u0442\" -Members \"$name@$domain\" \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0433\u0440\u0443\u043f\u043f\u0443 \\ Set-DistributionGroup -Identity \"support4\" -HiddenFromAddressListsEnabled $true (\u0438\u043b\u0438 Set-Mailbox) \u0441\u043a\u0440\u044b\u0442\u044c \u0438\u0437 \u0441\u043f\u0438\u0441\u043a\u0430 \u0430\u0434\u0440\u0435\u0441\u043e\u0432 Exchange Search Search-Mailbox -Identity \"support4\" -SearchQuery '\u0422\u0435\u043c\u0430:\"Mikrotik DOWN\"' \u043f\u043e\u0438\u0441\u043a \u043f\u0438\u0441\u0435\u043c \u043f\u043e \u0442\u0435\u043c\u0435 \\ Search-Mailbox -Identity \"support4\" -SearchQuery 'Subject:\"Mikrotik DOWN\"' \\ Search-Mailbox -Identity \"support4\" -SearchQuery 'attachment -like:\"*.rar\"' \\ Search-Mailbox -Identity \"support4\" -SearchQuery \"\u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043e: < 01/01/2020\" -DeleteContent -Force \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u043f\u0438\u0441\u0435\u043c \u043f\u043e \u0434\u0430\u0442\u0435 \u0424\u043e\u0440\u043c\u0430\u0442 \u0434\u0430\u0442\u044b \u0432 \u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e\u0441\u0442\u0438 \u043e\u0442 \u0440\u0435\u0433\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u044b\u0445 \u043d\u0430\u0441\u0442\u0440\u043e\u0435\u043a \u0441\u0435\u0440\u0432\u0435\u0440\u0430: \\ 20/07/2018 \\ 07/20/2018 \\ 20-Jul-2018 \\ 20/July/2018 AuditLog Get-AdminAuditLogConfig \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u0430\u0443\u0434\u0438\u0442\u0430 \\ Set-Mailbox -Identity \"support4\" -AuditOwner HardDelete \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 HardDelete \u043f\u0438\u0441\u0435\u043c \\ Set-mailbox -identity \"support4\" -AuditlogAgelimit 120 \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u0432\u0440\u0435\u043c\u044f \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \\ Get-mailbox -identity \"support4\" | Format-list Audit* \u0434\u0430\u043d\u043d\u044b\u0435 \u0430\u0443\u0434\u0438\u0442\u0430 \\ Search-MailboxAuditLog -Identity \"support4\" -LogonTypes Delegate -ShowDetails -Start \"2022-02-22 18:00\" -End \"2022-03-22 18:00\" \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u043b\u043e\u0433\u043e\u0432 \\ Search-AdminAuditLog -StartDate \"02/20/2022\" | ft CmdLetName,Caller,RunDate,ObjectModified -Autosize \u043f\u043e\u0438\u0441\u043a \u0441\u043e\u0431\u044b\u0442\u0438\u0439 \u0438\u0441\u0442\u043e\u0440\u0438\u0438 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u044b\u0445 \u043a\u043e\u043c\u0430\u043d\u0434 \u0432 \u0436\u0443\u0440\u043d\u0430\u043b\u0435 \u0430\u0443\u0434\u0438\u0442\u0430 Exchange Test Test-ServiceHealth \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u043e\u0441\u0442\u044c \u0440\u043e\u043b\u0435\u0439 \u0441\u0435\u0440\u0432\u0435\u0440\u0430: \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0445 \u044f\u0449\u0438\u043a\u043e\u0432, \u043a\u043b\u0438\u0435\u043d\u0442\u0441\u043a\u043e\u0433\u043e \u0434\u043e\u0441\u0442\u0443\u043f\u0430, \u0435\u0434\u0438\u043d\u043e\u0439 \u0441\u0438\u0441\u0442\u0435\u043c\u044b \u043e\u0431\u043c\u0435\u043d\u0430 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f\u043c\u0438, \u0442\u0440\u0430\u0441\u043f\u043e\u0440\u0442\u043d\u043e\u0433\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \\ $mx_srv_list | %{Test-MapiConnectivity -Server $_} \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f MX-\u0441\u0435\u0440\u0432\u0435\u0440\u043e\u0432 \u043a \u0411\u0414 \\ Test-MAPIConnectivity -Database $db \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u0438 \u043b\u043e\u0433\u0438\u043d\u0430 \u0432 \u0431\u0430\u0437\u0443 \\ Test-MAPIConnectivity \u2013Identity $user@$domain \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u0438 \u043b\u043e\u0433\u0438\u043d\u0430 \u0432 \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0439 \u044f\u0449\u0438\u043a \\ Test-ComputerSecureChannel \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0440\u0430\u0431\u043e\u0442\u044b \u0441\u043b\u0443\u0436\u0431\u044b AD \\ Test-MailFlow \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u0442\u0435\u0441\u0442\u043e\u0432\u043e\u0433\u043e \u043f\u043e\u0442\u043e\u043a\u0430 \u043f\u043e\u0447\u0442\u044b Queue Get-TransportServer | %{Get-Queue -Server $_.Name} \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043e\u0447\u0435\u0440\u0435\u0434\u0438 \u043d\u0430 \u0432\u0441\u0435\u0445 \u0442\u0440\u0430\u043d\u0441\u043f\u043e\u0440\u0442\u043d\u044b\u0445 \u0441\u0435\u0440\u0432\u0435\u0440\u0430\u0445 \\ Get-Queue -Identity EXCHANGE-CAS\\155530 | Format-List \u043f\u043e\u0434\u0440\u043e\u0431\u043d\u0430\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043e\u0431 \u043e\u0447\u0435\u0440\u0435\u0434\u0438 \\ Get-Queue -Identity EXCHANGE-CAS\\155530 | Get-Message -ResultSize Unlimited | Select FromAddress,Recipients \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u0435\u043b\u0435\u0439 (FromAddress) \u0438 \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u0435\u043b\u0435\u0439 \u0432 \u043e\u0447\u0435\u0440\u0435\u0434\u0438 (Recipients) \\ Get-Message -Queue EXCHANGE-CAS\\155530 \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0438\u043d\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0432 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0439 \u043e\u0447\u0435\u0440\u0435\u0434\u0438 (\u0441\u0435\u0440\u0432\u0435\u0440\\\u043e\u0447\u0435\u0440\u0435\u0434\u044c\\\u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440 \u043f\u0438\u0441\u044c\u043c\u0430) \\ Resume-Message EXCHANGE-CAS\\155530\\444010 \u043f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u044c \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0443 \u043f\u0438\u0441\u044c\u043c\u0430 \u0438\u0437 \u043e\u0447\u0435\u0440\u0435\u0434\u0438 \\ Retry-Queue -Filter {Status -eq \"Retry\"} \u043f\u0440\u0438\u043d\u0443\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u043f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u044c \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0443 \u0432\u0441\u0435\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 c \u0441\u0442\u0430\u0442\u0443\u0441\u043e\u043c \"\u041f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u044c\" \\ Get-Queue -Identity EXCHANGE-CAS\\155530 | Get-Message -ResultSize unlimited | Remove-Message -WithNDR $False \u043e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u043e\u0447\u0435\u0440\u0435\u0434\u044c \\ Get-transportserver EXCHANGE-CAS | Select MessageExpirationTimeout \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0440\u0435\u043c\u044f \u0436\u0438\u0437\u043d\u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0432 \u043e\u0447\u0435\u0440\u0435\u0434\u0438 (\u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e, 2 \u0434\u043d\u044f) Error Exchange 452 4.3.1 Insufficient system resources - \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u0435 \u0441\u0432\u043e\u0431\u043e\u0434\u043d\u043e\u0433\u043e \u043c\u0435\u0441\u0442\u0430 \u043d\u0430 \u0434\u0438\u0441\u043a\u0435, \u043d\u0430 \u043a\u043e\u0442\u043e\u0440\u043e\u043c \u043d\u0430\u0445\u043e\u0434\u044f\u0442\u0441\u044f \u043e\u0447\u0435\u0440\u0435\u0434\u0438 \u0441\u043b\u0443\u0436\u0431\u044b Exchange Hub Transport, \u0437\u0430 \u043c\u043e\u043d\u0438\u0442\u043e\u0440\u0438\u043d\u0433 \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442 \u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0445 \u0440\u0435\u0441\u0443\u0440\u0441\u043e\u0432 Back Pressure, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0432 \u0442\u043e\u043c \u0447\u0438\u0441\u043b\u0435 \u043e\u0442\u0441\u043b\u0435\u0436\u0438\u0432\u0430\u0435\u0442 \u0441\u0432\u043e\u0431\u043e\u0434\u043d\u043e\u0435 \u043c\u0435\u0441\u0442\u043e \u043d\u0430 \u0434\u0438\u0441\u043a\u0435 \\ \u041f\u043e\u0440\u043e\u0433 Medium (90%) \u2014 \u043f\u0435\u0440\u0435\u0441\u0442\u0430\u0442\u044c \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0442\u044c \u043f\u043e SMTP \u043f\u043e\u0447\u0442\u0443 \u043e\u0442 \u0432\u043d\u0435\u0448\u043d\u0438\u0445 \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u0435\u043b\u0435\u0439 (\u043f\u043e\u0447\u0442\u0430 \u043e\u0442 MAPI \u043a\u043b\u0438\u0435\u043d\u0442\u043e\u0432 \u043f\u0440\u0438 \u044d\u0442\u043e\u043c \u043e\u0431\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u0435\u0442\u0441\u044f) \\ \u041f\u043e\u0440\u043e\u0433 High (99%) \u2014 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043f\u043e\u0442\u043e\u043a\u0430 \u043f\u043e\u0447\u0442\u044b \u043f\u043e\u043b\u043d\u043e\u0441\u0442\u044c\u044e \u043f\u0440\u0435\u043a\u0440\u0430\u0449\u0430\u0435\u0442\u0441\u044f \\ \u0420\u0435\u0448\u0435\u043d\u0438\u0435: \u043e\u0447\u0438\u0441\u0442\u0438\u0442\u044c, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 \u043b\u043e\u0433\u0438 IIS (C:\\inetpub\\logs\\LogFiles\\W3SVC1), \u0443\u0432\u0435\u043b\u0438\u0447\u0438\u0442\u044c \u0440\u0430\u0437\u043c\u0435\u0440 \u0434\u0438\u0441\u043a\u0430, \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043c\u043e\u043d\u0438\u0442\u043e\u0440\u0438\u043d\u0433 Back Pressure (\u043f\u043b\u043e\u0445\u043e\u0439 \u0432\u0430\u0440\u0438\u0430\u043d\u0442) \u0438\u043b\u0438 \u043f\u0435\u0440\u0435\u043d\u0435\u0441\u0442\u0438 \u0442\u0440\u0430\u043d\u0441\u043f\u043e\u0440\u0442\u043d\u044b\u0435 \u043e\u0447\u0435\u0440\u0435\u0434\u044c \u043d\u0430 \u0434\u0440\u0443\u0433\u043e\u0439 \u0434\u0438\u0441\u043a \u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u043e\u0433\u043e \u043e\u0431\u044a\u0451\u043c\u0430. Get-Service | ? name -like \"MSExchangeTransport\" | Stop-Service \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0441\u043b\u0443\u0436\u0443 \u043e\u0447\u0435\u0440\u0435\u0434\u0438 \\ Rename-Item \"C:\\Program Files\\Microsoft\\Exchange Server\\V15\\TransportRoles\\data\\Queue\" \"C:\\Program Files\\Microsoft\\Exchange Server\\V15\\TransportRoles\\data\\Queue_old\" \u043e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u0431\u0430\u0437\u0443 \u043e\u0447\u0435\u0440\u0435\u0434\u0438 \\ C:\\Program Files\\Microsoft\\Exchange Server\\V15\\Bin\\EdgeTransport.exe.config \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0439 \u0444\u0430\u0439\u043b, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u043f\u0443\u0442\u044c \u043a \u0431\u0434 \u0441 \u043e\u0447\u0435\u0440\u0435\u0434\u044c\u044e (\u0431\u043b\u043e\u043a \u043a\u043b\u044e\u0447\u0438 \u0438 QueueDatabaseLoggingPath) \\ \u0414\u043b\u044f \u043f\u0435\u0440\u0435\u043d\u043e\u0441\u0430 \u0411\u0414, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043f\u0435\u0440\u0435\u043c\u0435\u0441\u0442\u0438\u0442\u044c \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u0444\u0430\u0439\u043b\u044b \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 Mail.que \u0438 Trn.chk (\u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044c\u043d\u044b\u0435 \u0442\u043e\u0447\u043a\u0438 \u0434\u043b\u044f \u043e\u0442\u0441\u043b\u0435\u0436\u0438\u0432\u0430\u043d\u0438\u044f \u0437\u0430\u043f\u0438\u0441\u0438 \u0432 \u043b\u043e\u0433\u0430\u0445) \u0438\u0437 \u0438\u0441\u0445\u043e\u0434\u043d\u043e\u0433\u043e \u043c\u0435\u0441\u0442\u043e\u043f\u043e\u043b\u043e\u0436\u0435\u043d\u0438\u044f \u0432 \u043d\u043e\u0432\u043e\u0435. \u041f\u0435\u0440\u0435\u043c\u0435\u0441\u0442\u0438\u0442\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u0444\u0430\u0439\u043b\u044b \u0436\u0443\u0440\u043d\u0430\u043b\u0430 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439 Trn.log, Trntmp.log, Trn nnnn.log , Trnres00001.jrs, Trnres00002.jrs \u0438 Temp.edb \u0438\u0437 \u0441\u0442\u0430\u0440\u043e\u0433\u043e \u0440\u0430\u0441\u043f\u043e\u043b\u043e\u0436\u0435\u043d\u0438\u044f \u0432 \u043d\u043e\u0432\u043e\u0435. tmp.edb \u2014 \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0439 \u0444\u0430\u0439\u043b \u0434\u043b\u044f \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u0441\u0445\u0435\u043c\u044b \u0441\u0430\u043c\u043e\u0439 \u0431\u0430\u0437\u044b, \u043f\u0435\u0440\u0435\u043d\u043e\u0441\u0442\u0438 \u043d\u0435 \u043d\u0443\u0436\u043d\u043e. \\ \u041f\u043e\u0441\u043b\u0435 \u0437\u0430\u043f\u0443\u0441\u043a\u0430 \u0441\u043b\u0443\u0436\u0431\u044b \u0442\u0440\u0430\u043d\u0441\u043f\u043e\u0440\u0442\u0430 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u0442\u0430\u0440\u0443\u044e \u0431\u0430\u0437\u0443 \u0434\u0430\u043d\u043d\u044b\u0445 \u043e\u0447\u0435\u0440\u0435\u0434\u0438 \u0438 \u0444\u0430\u0439\u043b\u044b \u0436\u0443\u0440\u043d\u0430\u043b\u0430 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439 \u0438\u0437 \u0441\u0442\u0430\u0440\u043e\u0433\u043e \u0440\u0430\u0441\u043f\u043e\u043b\u043e\u0436\u0435\u043d\u0438\u044f. Defrag Get-MailboxDatabase -Status | ft Name, DatabaseSize, AvailableNewMailboxSpace \\ DatabaseSize - \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u0440\u0430\u0437\u043c\u0435\u0440 \u0431\u0430\u0437\u044b \\ AvailableNewMailboxSpace - \u043e\u0431\u044a\u0451\u043c \u043f\u0443\u0441\u0442\u044b\u0445 \u0441\u0442\u0440\u0430\u043d\u0438\u0446, \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u043e, \u043a\u043e\u0442\u043e\u0440\u043e\u0435 \u043c\u043e\u0436\u043d\u043e \u043e\u0441\u0432\u043e\u0431\u043e\u0434\u0438\u0442\u044c \u043f\u0440\u0438 \u0434\u0435\u0444\u0440\u0430\u0433\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u0438 \\ (DatabaseSize \u2014 AvailableNewMailboxSpace) x 1,1 - \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0438\u043c\u0435\u0442\u044c \u0441\u0432\u043e\u0431\u043e\u0434\u043d\u043e\u0433\u043e \u043c\u0435\u0441\u0442\u0430 \u043d\u0435 \u043c\u0435\u043d\u0435\u0435 110% \u043e\u0442 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u0440\u0430\u0437\u043c\u0435\u0440\u0430 \u0431\u0430\u0437\u044b (\u0431\u0435\u0437 \u0443\u0447\u0435\u0442\u0430 \u043f\u0443\u0441\u0442\u044b\u0445 \u0441\u0442\u0440\u0430\u043d\u0438\u0446) \\ cd $path \\ Dismount-Database \"$path\\$db_name\" \u043e\u0442\u043c\u043e\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0411\u0414 \\ eseutil /d \"$path\\$db_name.edb\" \\ Mount-Database \"$path\\$db\" \u043f\u0440\u0438\u043c\u043e\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0411\u0414 DAG (Database Availability Group) Install-WindowsFeature -Name Failover-Clustering -ComputerName EXCH-MX-01 \u043e\u0441\u043d\u043e\u0432\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u043d\u0430 \u0442\u0435\u0445\u043d\u043e\u043b\u043e\u0433\u0438\u0438 Windows Server Failover Cluster \\ New-DatabaseAvailabilityGroup -Name dag-01 -WitnessServer fs-05 -WitnessDirectory C:\\witness_exchange1 \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0433\u0440\u0443\u043f\u043f\u0443 \u0441 \u0443\u043a\u0430\u0437\u0430\u043d\u0438\u0435\u043c \u0444\u0430\u0439\u043b\u043e\u0432\u043e\u0433\u043e \u0441\u0432\u0438\u0434\u0435\u0442\u0435\u043b\u044f \u0434\u043b\u044f \u043a\u0432\u043e\u0440\u0443\u043c\u0430 \\ Quorum - \u044d\u0442\u043e \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u0433\u043e\u043b\u043e\u0441\u043e\u0432\u0430\u043d\u0438\u044f, \u0432 \u043a\u043e\u0442\u043e\u0440\u043e\u043c \u0434\u043b\u044f \u043f\u0440\u0438\u043d\u044f\u0442\u0438\u044f \u0440\u0435\u0448\u0435\u043d\u0438\u044f \u043d\u0443\u0436\u043d\u043e \u0438\u043c\u0435\u0442\u044c \u0431\u043e\u043b\u044c\u0448\u0438\u043d\u0441\u0442\u0432\u043e \u0433\u043e\u043b\u043e\u0441\u043e\u0432, \u0447\u0442\u043e \u0431\u044b \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u0442\u0435\u043a\u0443\u0449\u0443\u044e \u043a\u043e\u043f\u0438\u044e \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 \u0430\u043a\u0442\u0438\u0432\u043d\u043e\u0439. \\ WitnessDirectory \u2014 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0434\u043b\u044f \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0434\u0430\u043d\u043d\u044b\u0445 \u0444\u0430\u0439\u043b\u043e\u0432\u043e\u0433\u043e \u0440\u0435\u0441\u0443\u0440\u0441\u0430-\u0441\u0432\u0438\u0434\u0435\u0442\u0435\u043b\u044f. \\ Set-DatabaseAvailabilityGroup dag-01 \u2013DatabaseAvailabilityGroupIPAdress $ip \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c ip-\u0430\u0434\u0440\u0435\u0441 \u0433\u0440\u0443\u043f\u043f\u044b \\ Get-DatabaseAvailabilityGroup \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u0433\u0440\u0443\u043f\u043f \\ Get-DatabaseAvailabilityGroup -Identity dag-01 \\ Add-DatabaseAvailabilityGroupServer -Identity dag-01 -MailboxServer EXCH-MX-01 \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043f\u0435\u0440\u0432\u044b\u0439 \u0441\u0435\u0440\u0432\u0435\u0440 (\u0432\u0441\u0435 \u0411\u0414 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430\u0445 \u0432 DAG \u0434\u043e\u043b\u0436\u043d\u044b \u0445\u0440\u0430\u043d\u0438\u0442\u044c\u0441\u044f \u043f\u043e \u043e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u043e\u043c\u0443 \u043f\u0443\u0442\u0438) \\ Add-MailboxDatabaseCopy -Identity db_name -MailboxServer EXCH-MX-04 \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043a\u043e\u043f\u0438\u044e \u0411\u0414 \\ Get-MailboxDatabaseCopyStatus -Identity db_name\\* | select Name,Status,LastInspectedLogTime \u0441\u0442\u0430\u0442\u0443\u0441 \u0438 \u0432\u0440\u0435\u043c\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0436\u0443\u0440\u043d\u0430\u043b\u0430 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0438\u0439 Status: \\ Mounted - \u0440\u0430\u0431\u043e\u0447\u0430\u044f \u0431\u0430\u0437\u0430 \\ Suspended - \u043f\u0440\u0438\u043e\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043e \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \\ Healthy - \u0440\u0430\u0431\u043e\u0447\u0430\u044f \u043f\u0430\u0441\u0441\u0438\u0432\u043d\u0430\u044f \u043a\u043e\u043f\u0438\u044f \\ ServiceDown - \u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u043d\u0430 (\u0432\u044b\u043a\u043b\u044e\u0447\u0435\u043d \u0441\u0435\u0440\u0432\u0435\u0440) \\ Dismounted - \u043e\u0442\u043c\u043e\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0430 \\ FailedAndSuspended - \u043e\u0448\u0438\u0431\u043a\u0430 \u0438 \u043f\u0440\u0438\u043e\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \\ Resynchronizing - \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u0441\u0438\u043d\u0445\u0440\u043e\u043d\u0438\u0437\u0430\u0446\u0438\u044f, \u0433\u0434\u0435 \u0431\u0443\u0434\u0435\u0442 \u043f\u043e\u0441\u0442\u0435\u043f\u0435\u043d\u043d\u043e \u0443\u043c\u0435\u043d\u044c\u0448\u0430\u0442\u044c\u0441\u044f \u0434\u043b\u0438\u043d\u0430 \u043e\u0447\u0435\u0440\u0435\u0434\u0438 \\ CopyQueue Length - \u0434\u043b\u0438\u043d\u0430 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u043e\u043d\u043d\u043e\u0439 \u043e\u0447\u0435\u0440\u0435\u0434\u0438 \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f (0 - \u0437\u043d\u0430\u0447\u0438\u0442 \u0432\u0441\u0435 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0438\u0437 \u0430\u043a\u0442\u0438\u0432\u043d\u043e\u0439 \u0431\u0430\u0437\u044b \u0440\u0435\u043f\u043b\u0438\u0446\u0438\u0440\u043e\u0432\u0430\u043d\u044b \u0432 \u043f\u0430\u0441\u0441\u0438\u0432\u043d\u0443\u044e \u043a\u043e\u043f\u0438\u044e) Resume-MailboxDatabaseCopy -Identity db_name\\EXCH-MX-04 \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c (Resume) \u0438\u043b\u0438 \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0431\u0434 \u043d\u0430 EXCH-MX-04 (\u0438\u0437 \u0441\u0442\u0430\u0442\u0443\u0441\u0430 Suspended \u0432 Healthy) \\ Suspend-MailboxDatabaseCopy -Identity db_name\\EXCH-MX-04 \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 (\u0432 \u0441\u0442\u0430\u0442\u0443\u0441 Suspended) \\ Update-MailboxDatabaseCopy -Identity db_name\\EXCH-MX-04 -DeleteExistingFiles \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u043a\u043e\u043f\u0438\u044e \u0411\u0414 (\u0441\u0434\u0435\u043b\u0430\u0442\u044c Full Backup) \\ Set-MailboxDatabaseCopy -Identity db_name\\EXCH-MX-04 -ActivationPreference 1 \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u0440\u0438\u043e\u0440\u0438\u0442\u0435\u0442 \u0434\u043b\u044f \u0430\u043a\u0442\u0438\u0432\u0430\u0446\u0438\u0438 \u043a\u043e\u043f\u0438\u0439 \u0411\u0414 (\u043a\u0430\u043a\u0443\u044e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c, 1 \u2013 \u0441\u0430\u043c\u043e\u0435 \u0432\u044b\u0441\u043e\u043a\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435) \\ Move-ActiveMailboxDatabase db_name -ActivateOnServer EXCH-MX-04 -MountDialOverride:None -Confirm:$false \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043a\u043e\u043f\u0438\u044e \u0411\u0414 \u0432 DAG (\u043f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f \u043d\u0430 \u0430\u043a\u0442\u0438\u0432\u043d\u0443\u044e \u043a\u043e\u043f\u0438\u044e) \\ Remove-MailboxDatabaseCopy -Identity db_name\\EXCH-MX-04 -Confirm:$False \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043a\u043e\u043f\u0438\u0438 \u043f\u0430\u0441\u0441\u0438\u0432\u043d\u043e\u0439 \u0431\u0430\u0437\u044b \u0432 DAG-\u0433\u0440\u0443\u043f\u043f\u0435 (\u0443 \u0411\u0414 \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u043e\u0442\u043a\u043b\u044e\u0447\u0435\u043d\u043e \u0432\u0435\u0434\u0435\u043d\u0438\u0435 \u0446\u0438\u043a\u043b\u0438\u0447\u0435\u0441\u043a\u043e\u0433\u043e \u0436\u0443\u0440\u043d\u0430\u043b\u0430) \\ Remove-DatabaseAvailabilityGroupServer -Identity dag-01 -MailboxServer EXCH-MX-04 -ConfigurationOnly \u0443\u0434\u0430\u043b\u0438\u0442\u044c MX \u0441\u0435\u0440\u0432\u0435\u0440 \u0438\u0437 \u0433\u0440\u0443\u043f\u043f\u044b DAG \\ Import-Module FailoverClusters \\ Get-ClusterNode EXCH-MX-04 | Remove-ClusterNode -Force \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043e\u0442\u043a\u0430\u0437\u0430\u0432\u0448\u0438\u0439 \u0443\u0437\u0435\u043b \u0438\u0437 Windows Failover Cluster Get-DatabaseAvailabilityGroup | Get-DatabaseAvailabilityGroupHealth \u043c\u043e\u043d\u0438\u0442\u043e\u0440\u0438\u043d\u0433 Index Get-MailboxDatabaseCopyStatus * | select name,status,ContentIndexState,ContentIndexErrorMessage,ActiveDatabaseCopy,LatestCopyBackupTime,CopyQueueLength \u0443\u0437\u043d\u0430\u0442\u044c \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0440\u0430\u0431\u043e\u0442\u044b \u0438\u043d\u0434\u043a\u0441\u043e\u0432 \u0411\u0414 \u0438 \u0442\u0435\u043a\u0441\u0442 \u043e\u0448\u0438\u0431\u043a\u0438, \u043d\u0430 \u043a\u0430\u043a\u043e\u043c \u0441\u0435\u0440\u0432\u0435\u0440\u0435 \u0430\u043a\u0442\u0438\u0432\u043d\u0430\u044f \u043a\u043e\u043f\u0438\u044f \u0411\u0414, \u0434\u0430\u0442\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0439 \u043a\u043e\u043f\u0438\u0438 \u0438 \u0442\u0435\u043a\u0443\u0449\u0430\u044f \u043e\u0447\u0435\u0440\u0435\u0434\u044c \\ Get-MailboxDatabaseCopyStatus -Identity $db_name\\* | Format-List Name,ContentIndexState \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u043a\u043e\u043f\u0438\u0439 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0439 \u0411\u0414 \u043d\u0430 \u0432\u0441\u0435\u0445 \u0441\u0435\u0440\u0432\u0435\u0440\u0430\u0445, \u0438 \u0441\u0442\u0430\u0442\u0443\u0441 \u0438\u0445 \u0438\u043d\u0434\u0435\u043a\u0441\u043e\u0432, \u0435\u0441\u043b\u0438 \u0443 \u0432\u0442\u043e\u0440\u043e\u0433\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u0441\u0442\u0430\u0442\u0443\u0441 Healthy, \u043c\u043e\u0436\u043d\u043e \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0438\u0437 \u043d\u0435\u0433\u043e \\ Get-MailboxDatabaseCopyStatus -Identity $db_name\\EXCH-MX-04 | Update-MailboxDatabaseCopy -SourceServer EXCH-MX-01 -CatalogOnly \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0411\u0414 \u0438\u0437 \u043a\u043e\u043f\u0438\u0438 \\ cd %PROGRAMFILES%\\Microsoft\\Exchange Server\\V14\\Scripts \u0438\u043b\u0438 v15 \u0434\u043b\u044f Exchange 2016 \\ .\\ResetSearchIndex.ps1 $db_name \u0441\u043a\u0440\u0438\u043f\u0442 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0438\u043d\u0434\u0435\u043a\u0441\u0430 Get-MailboxDatabaseCopyStatus * | where {$_.ContentIndexState -eq \"Failed\" -or $_.ContentIndexState -eq \"FailedAndSuspended\"} \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0443 \u043a\u0430\u043a\u043e\u0439 \u0411\u0414 \u043f\u0440\u043e\u0438\u0437\u043e\u0448\u0435\u043b \u0441\u0431\u043e\u0439 \u0440\u0430\u0431\u043e\u0442\u044b (FailedAndSuspended) \u0438\u043b\u0438 \u0438\u043d\u0434\u0435\u043a\u0441\u0430 (ContentIndexState) TrueNAS import-Module TrueNas \\ (Get-Module TrueNas).ExportedCommands \\ Connect-TrueNasServer -Server tnas-01 -SkipCertificateCheck \\ Get-TrueNasCertificate \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u0430 \\ Get-TrueNasSetting \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u044f\u0437\u044b\u043a\u0430, time zone, syslog level \u0438 server, https port \\ Get-TrueNasUser \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \\ Get-TrueNasSystemVersion \u0445\u0430\u0440\u0430\u043a\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043a\u0438 (Physical Memory, Model, Cores) \u0438 Uptime \\ Get-TrueNasSystemAlert snmp \u0434\u043b\u044f \u043e\u043f\u043e\u0432\u0435\u0449\u0435\u043d\u0438\u0439 \\ Get-TrueNasSystemNTP \u0441\u043f\u0438\u0441\u043e\u043a \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c\u044b\u0445 NTP \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u0432 \\ Get-TrueNasDisk \u0441\u043f\u0438\u0441\u043e\u043a \u0440\u0430\u0437\u0434\u0435\u043b\u043e\u0432 \u0444\u0438\u0437\u0438\u0447\u0435\u0441\u043a\u043e\u0433\u043e \u0434\u0438\u0441\u043a\u0430 \\ Get-TrueNasInterface \u0441\u0435\u0442\u0435\u0432\u044b\u0435 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u044b \\ Get-TrueNasGlobalConfig \u0441\u0435\u0442\u0435\u0432\u044b\u0435 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \\ Get-TrueNasDnsServer \u043d\u0430\u0441\u0442\u0440\u043e\u0435\u043d\u043d\u044b\u0435 DNS-\u0441\u0435\u0440\u0432\u0435\u0440\u0430 \\ Get-TrueNasIscsiTarget \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c ID \u0433\u0440\u0443\u043f\u043f\u044b \u0438\u043d\u0438\u0446\u0438\u0430\u0442\u043e\u0440\u043e\u0432 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0449\u0438\u0445 \u0442\u0430\u0440\u0433\u0435\u0442, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c\u044b\u0439 portal, authentification \u0438 authen-method \\ Get-TrueNasIscsiInitiator \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0433\u0440\u0443\u043f\u043f\u044b \u0438\u043d\u0438\u0446\u0438\u0430\u0442\u043e\u0440\u043e\u0432 \\ Get-TrueNasIscsiPortal \u0441\u043b\u0443\u0448\u0430\u0442\u0435\u043b\u044c (Listen) \u0438 \u043f\u043e\u0440\u0442 \\ Get-TrueNasIscsiExtent \u0441\u043f\u0438\u0441\u043e\u043a ISCSi Target (\u0441\u0442\u0430\u0442\u0443\u0441 \u0440\u0430\u0431\u043e\u0442\u044b, \u043f\u0443\u0442\u044c) \\ Get-TrueNasPool \u0441\u043f\u0438\u0441\u043e\u043a pool (Id, Path, Status, Healthy) \\ Get-TrueNasVolume -Type FILESYSTEM \u0441\u043f\u0438\u0441\u043e\u043a pool \u0444\u0430\u0439\u043b\u043e\u0432\u044b\u0445 \u0441\u0438\u0441\u0442\u0435\u043c \\ Get-TrueNasVolume -Type VOLUME \u0441\u043f\u0438\u0441\u043e\u043a \u0440\u0430\u0437\u0434\u0435\u043b\u043e\u0432 \u0432 pool \u0438 \u0438\u0445 \u0440\u0430\u0437\u043c\u0435\u0440 \\ Get-TrueNasService | ft \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u043b\u0443\u0436\u0431 \u0438 \u0438\u0445 \u0441\u0442\u0430\u0442\u0443\u0441 \\ Start-TrueNasService ssh \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0441\u043b\u0443\u0436\u0431\u0443 \\ Stop-TrueNasService ssh \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0441\u043b\u0443\u0436\u0431\u0443 Veeam Set-ExecutionPolicy AllSigned or Set-ExecutionPolicy Bypass -Scope Process \\ Set-ExecutionPolicy Bypass -Scope Process -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1')) \\ choco install veeam-backup-and-replication-console \\ Get-Module Veeam.Backup.PowerShell \\ Get-Command -Module Veeam.Backup.PowerShell or Get-VBRCommand \\ Connect-VBRServer -Server $srv -Credential $cred or -User and -Password - Port 9392 default \\ Get-VBRJob \\ Get-VBRCommand *get*backup* \\ Get-VBRComputerBackupJob \\ Get-VBRBackup \\ Get-VBRBackupRepository \\ Get-VBRBackupSession \\ Get-VBRBackupServerCertificate \\ Get-VBRRestorePoint \\ Get-VBRViProxy REST API $url = \"https://habr.com/ru/rss/users/Lifailon/publications/articles/?fl=ru\" RSS \u043b\u0435\u043d\u0442\u0430 \u043f\u0443\u0431\u043b\u0438\u043a\u0430\u0446\u0438\u0439 \u043d\u0430 Habr \\ Invoke-RestMethod $url \\ $iwr = Invoke-WebRequest -Uri $url \\ $iwr | Get-Member \\ $iwr.Content \\ $iwr.StatusCode -eq 200 \\ $iwr.Headers \\ $iwr.ParsedHtml | Select lastModified \\ $iwr.Links | fl title,innerText,href \\ $iwr.Images.src Methods GET - Read \\ POST - Create \\ PATCH - Partial update/modify \\ PUT - Update/replace \\ DELETE - Remove Download Image function Download-Image { param ( [Parameter(Mandatory = $True)]$url ) $folder = $url -replace \"http.+://\" -replace \"/\",\"-\" -replace \"-$\" $path = \"$home\\Pictures\\$folder\" if (Test-Path $path) { Remove-Item $path -Recurse -Force New-Item -ItemType Directory $path > $null } else { New-Item -ItemType Directory $path > $null } $irm = Invoke-WebRequest -Uri $url foreach ($img in $irm.Images.src) { $name = $img -replace \".+/\" Start-Job { Invoke-WebRequest $using:img -OutFile \"$using:path\\$using:name\" } > $null } while ($True){ $status_job = (Get-Job).State[-1] if ($status_job -like \"Completed\"){ Get-Job | Remove-Job -Force break }} $count_all = $irm.Images.src.Count $count_down = (Get-Item $path\\*).count \"Downloaded $count_down of $count_all files to $path\" } Download-Image -url https://losst.pro/ Token https://veeam-11:9419/swagger/ui/index.html $Header = @{ \"x-api-version\" = \"1.0-rev2\" } $Body = @{ \"grant_type\" = \"password\" \"username\" = \"$login\" \"password\" = \"$password\" } $vpost = iwr \"https://veeam-11:9419/api/oauth2/token\" -Method POST -Headers $Header -Body $Body -SkipCertificateCheck $vtoken = (($vpost.Content) -split '\"')[3] GET $token = $vtoken | ConvertTo-SecureString -AsPlainText \u2013Force $vjob = iwr \"https://veeam-11:9419/api/v1/jobs\" -Method GET -Headers $Header -Authentication Bearer -Token $token -SkipCertificateCheck $Header = @{ \"x-api-version\" = \"1.0-rev1\" \"Authorization\" = \"Bearer $vtoken\" } $vjob = iwr \"https://veeam-11:9419/api/v1/jobs\" -Method GET -Headers $Header -SkipCertificateCheck $vjob = $vjob.Content | ConvertFrom-Json $vjob = Invoke-RestMethod \"https://veeam-11:9419/api/v1/jobs\" -Method GET -Headers $Header -SkipCertificateCheck $vjob.data.virtualMachines.includes.inventoryObject Pode Start-PodeServer { Add-PodeEndpoint -Address localhost -Port \"8080\" -Protocol \"HTTP\" ### Get info endpoints Add-PodeRoute -Path \"/\" -Method \"GET\" -ScriptBlock { Write-PodeJsonResponse -Value @{ \"service\"=\"/api/service\"; \"process\"=\"/api/process\" } } ### GET Add-PodeRoute -Path \"/api/service\" -Method \"GET\" -ScriptBlock { Write-PodeJsonResponse -Value $( Get-Service | Select-Object Name,@{ Name=\"Status\"; Expression={[string]$_.Status} },@{ Name=\"StartType\"; Expression={[string]$_.StartType} } | ConvertTo-Json ) } Add-PodeRoute -Path \"/api/process\" -Method \"GET\" -ScriptBlock { Write-PodeJsonResponse -Value $( Get-Process | Sort-Object -Descending CPU | Select-Object -First 15 ProcessName, @{Name=\"ProcessorTime\"; Expression={$_.TotalProcessorTime -replace \"\\.\\d+$\"}}, @{Name=\"Memory\"; Expression={[string]([int]($_.WS / 1024kb))+\"MB\"}}, @{Label=\"RunTime\"; Expression={((Get-Date) - $_.StartTime) -replace \"\\.\\d+$\"}} ) } Add-PodeRoute -Path \"/api/process-html\" -Method \"GET\" -ScriptBlock { Write-PodeHtmlResponse -Value ( Get-Process | Sort-Object -Descending CPU | Select-Object -First 15 ProcessName, @{Name=\"ProcessorTime\"; Expression={$_.TotalProcessorTime -replace \"\\.\\d+$\"}}, @{Name=\"Memory\"; Expression={[string]([int]($_.WS / 1024kb))+\"MB\"}}, @{Label=\"RunTime\"; Expression={((Get-Date) - $_.StartTime) -replace \"\\.\\d+$\"}} # Auto ConvertTo-Html ) } ### POST Add-PodeRoute -Path \"/api/service\" -Method \"POST\" -ScriptBlock { # https://pode.readthedocs.io/en/latest/Tutorials/WebEvent/ # $WebEvent | Out-Default $Value = $WebEvent.Data[\"ServiceName\"] $Status = (Get-Service -Name $Value).Status Write-PodeJsonResponse -Value @{ \"Name\"=\"$Value\"; \"Status\"=\"$Status\"; } } } irm http://localhost:8080/api/service -Method Get \\ irm http://localhost:8080/api/process -Method Get \\ http://localhost:8080/api/process-html \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0431\u0440\u0430\u0443\u0437\u0435\u0440 \\ irm http://localhost:8080/api/service -Method Post -Body @{\"ServiceName\" = \"AnyDesk\"} Selenium Invoke-Expression(New-Object Net.WebClient).DownloadString(\"https://raw.githubusercontent.com/Lifailon/Deploy-Selenium/rsa/Deploy-Selenium-Drivers.ps1\") \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 \u0432\u0441\u0435\u0445 \u0434\u0440\u0430\u0439\u0432\u0435\u0440\u043e\u0432 \u0438 Chromium \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0439 \u0432\u0435\u0440\u0441\u0438\u0438 \u0434\u043b\u044f \u0434\u0440\u0430\u0439\u0432\u0435\u0440\u0430 $path = \"$home\\Documents\\Selenium\\\" $log = \"$path\\ChromeDriver.log\" $ChromeDriver = \"$path\\ChromeDriver.exe\" $WebDriver = \"$path\\WebDriver.dll\" $SupportDriver = \"$path\\WebDriver.Support.dll\" $Chromium = (Get-ChildItem $path -Recurse | Where-Object Name -like chrome.exe).FullName Add-Type -Path $WebDriver Add-Type -Path $SupportDriver try { $ChromeOptions = New-Object OpenQA.Selenium.Chrome.ChromeOptions # \u0441\u043e\u0437\u0434\u0430\u0435\u043c \u043e\u0431\u044a\u0435\u043a\u0442 \u0441 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430\u043c\u0438 \u0437\u0430\u043f\u0443\u0441\u043a\u0430 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0430 $ChromeOptions.BinaryLocation = $Chromium # \u043f\u0435\u0440\u0435\u0434\u0430\u0435\u043c \u043f\u0443\u0442\u044c \u0434\u043e \u0438\u0441\u043f\u043e\u043b\u043d\u044f\u0435\u043c\u043e\u0433\u043e \u0444\u0430\u0439\u043b\u0430, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442 \u0437\u0430 \u0437\u0430\u043f\u0443\u0441\u043a \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0430 $ChromeOptions.AddArgument(\"start-maximized\") # \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0431\u0440\u0430\u0443\u0437\u0435\u0440 \u043d\u0430 \u0432\u0435\u0441\u044c \u044d\u043a\u0440\u0430\u043d #$ChromeOptions.AddArgument(\"start-minimized\") # \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u043c \u0431\u0440\u0430\u0443\u0437\u0435\u0440 \u0432 \u043e\u043a\u043d\u0435 #$ChromeOptions.AddArgument(\"window-size=400,800\") # \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u043c \u0431\u0440\u0430\u0443\u0437\u0435\u0440 \u0441 \u0437\u0430\u0434\u0430\u043d\u043d\u044b\u043c\u0438 \u0440\u0430\u0437\u043c\u0435\u0440\u0430\u043c \u043e\u043a\u043d\u0430 \u0432 \u043f\u0438\u043a\u0441\u0435\u043b\u044f\u0445 $ChromeOptions.AcceptInsecureCertificates = $True # \u0438\u0433\u043d\u043e\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u0435\u0434\u0443\u043f\u0440\u0435\u0436\u0434\u0435\u043d\u0438\u0435 \u043d\u0430 \u0441\u0430\u0439\u0442\u0430\u0445 \u0441 \u043d\u0435 \u0432\u0430\u043b\u0438\u0434\u043d\u044b\u043c \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u043c #$ChromeOptions.AddArgument(\"headless\") # \u0441\u043a\u0440\u044b\u0432\u0430\u0442\u044c \u043e\u043a\u043d\u043e \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0430 \u043f\u0440\u0438 \u0437\u0430\u043f\u0443\u0441\u043a\u0435 $ChromeDriverService = [OpenQA.Selenium.Chrome.ChromeDriverService]::CreateDefaultService($ChromeDriver) # \u0441\u043e\u0437\u0434\u0430\u0435\u043c \u043e\u0431\u044a\u0435\u043a\u0442 \u043d\u0430\u0441\u0442\u0440\u043e\u0435\u043a \u0441\u043b\u0443\u0436\u0431\u044b \u0434\u0440\u0430\u0439\u0432\u0435\u0440\u0430 $ChromeDriverService.HideCommandPromptWindow = $True # \u043e\u0442\u043a\u043b\u044e\u0447\u0430\u0435\u043c \u0432\u0435\u0441\u044c \u0432\u044b\u0432\u043e\u0434 \u043b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0434\u0440\u0430\u0439\u0432\u0435\u0440\u0430 \u0432 \u043a\u043e\u043d\u0441\u043e\u043b\u044c (\u044d\u0442\u043e\u0442 \u0432\u044b\u0432\u043e\u0434 \u043d\u0435\u043b\u044c\u0437\u044f \u043f\u0435\u0440\u0435\u043d\u0430\u043f\u0440\u0430\u0432\u0438\u0442\u044c) $ChromeDriverService.LogPath = $log # \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u043f\u0443\u0442\u044c \u0434\u043e \u0444\u0430\u0439\u043b\u0430 \u0441 \u0436\u0443\u0440\u043d\u0430\u043b\u043e\u043c $ChromeDriverService.EnableAppendLog = $True # \u043d\u0435 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0438\u0441\u044b\u0432\u0430\u0442\u044c \u0436\u0443\u0440\u043d\u0430\u043b \u043f\u0440\u0438 \u043a\u0430\u0436\u0434\u043e\u043c \u043d\u043e\u0432\u043e\u043c \u0437\u0430\u043f\u0443\u0441\u043a\u0435 #$ChromeDriverService.EnableVerboseLogging = $True # \u043a\u0440\u043e\u043c\u0435 INFO \u0438 \u043e\u0448\u0438\u0431\u043e\u043a, \u0437\u0430\u043f\u0438\u0441\u044b\u0432\u0430\u0442\u044c DEBUG \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f $Selenium = New-Object OpenQA.Selenium.Chrome.ChromeDriver($ChromeDriverService, $ChromeOptions) # \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0435\u043c \u0437\u0430\u043f\u0443\u0441\u043a \u0441 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u043c\u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430\u043c\u0438 $Selenium.Navigate().GoToUrl(\"https://google.com\") # \u043f\u0435\u0440\u0435\u0445\u043e\u0434\u0438\u043c \u043f\u043e \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0439 \u0441\u0441\u044b\u043b\u043a\u0435 \u0432 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0435 #$Selenium.Manage().Window.Minimize() # \u0441\u0432\u0435\u0440\u043d\u0443\u0442\u044c \u043e\u043a\u043d\u043e \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0430 \u043f\u043e\u0441\u043b\u0435 \u0437\u0430\u043f\u0443\u0441\u043a\u0430 \u0438 \u043f\u0435\u0440\u0435\u0445\u043e\u0434\u0430 \u043f\u043e \u043d\u0443\u0436\u043d\u043e\u043c\u0443 url (\u0447\u0442\u043e \u0431\u044b \u0441\u0447\u0438\u0442\u0430\u0442\u044c \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e) # \u0418\u0449\u0435\u043c \u043f\u043e\u043b\u0435 \u0434\u043b\u044f \u0432\u0432\u043e\u0434\u0430 \u0442\u0435\u043a\u0441\u0442\u0430: $Search = $Selenium.FindElements([OpenQA.Selenium.By]::Id('APjFqb')) $Search = $Selenium.FindElements([OpenQA.Selenium.By]::XPath('//*[@id=\"APjFqb\"]')) $Search = $Selenium.FindElements([OpenQA.Selenium.By]::Name('q')) $Search = $Selenium.FindElements([OpenQA.Selenium.By]::XPath('//*[@name=\"q\"]')) $Search = $Selenium.FindElements([OpenQA.Selenium.By]::ClassName('gLFyf')) $Search = $Selenium.FindElements([OpenQA.Selenium.By]::CssSelector('[jsname=\"yZiJbe\"]')) $Search = $Selenium.FindElements([OpenQA.Selenium.By]::TagName('textarea')) | Where-Object ComputedAccessibleRole -eq combobox $Search.SendKeys(\"calculator online\") # \u043f\u0435\u0440\u0435\u0434\u0430\u0435\u043c \u0442\u0435\u043a\u0441\u0442 \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u043e\u043c\u0443 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0443 $Search.SendKeys([OpenQA.Selenium.Keys]::Enter) # \u043d\u0430\u0436\u0438\u043c\u0430\u0435\u043c Enter \u0434\u043b\u044f \u0432\u044b\u0437\u043e\u0432\u0430 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 \u043f\u043e\u0438\u0441\u043a\u0430 Start-Sleep 1 $div = $Selenium.FindElements([OpenQA.Selenium.By]::TagName(\"div\")) $2 = $div | Where-Object {($_.ComputedAccessibleRole -eq \"button\") -and ($_.ComputedAccessibleLabel -eq \"2\")} $2.Click() $2.Click() $plus = $div | Where-Object {($_.ComputedAccessibleRole -eq \"button\") -and ($_.Text -eq \"+\")} $plus.Click() $3 = $Selenium.FindElement([OpenQA.Selenium.By]::CssSelector('[jsname=\"KN1kY\"]')) $3.Click() $3.Click() $sum = $Selenium.FindElement([OpenQA.Selenium.By]::CssSelector('[jsname=\"Pt8tGc\"]')) $sum.Click() $result = $Selenium.FindElement([OpenQA.Selenium.By]::CssSelector('[jsname=\"VssY5c\"]')).Text Write-Host \"Result: $result\" -ForegroundColor Green } finally { $Selenium.Close() $Selenium.Quit() } Selenium modules Invoke-RestMethod https://raw.githubusercontent.com/Lifailon/Selenium-Modules/rsa/Modules/Get-GPT/Get-GPT.psm1 | Out-File -FilePath \"$(New-Item -Path \"$($($Env:PSModulePath -split \";\")[0])\\Get-GPT\" -ItemType Directory -Force)\\Get-GPT.psm1\" -Force Get-GPT \"\u0418\u0441\u043f\u043e\u043b\u043d\u044f\u0439 \u0440\u043e\u043b\u044c \u043a\u0430\u043b\u044c\u043a\u0443\u043b\u044f\u0442\u043e\u0440\u0430. \u041f\u043e\u0441\u0447\u0438\u0442\u0430\u0439 \u0441\u0443\u043c\u043c\u0443 \u0447\u0438\u0441\u0435\u043b: 22+33\" Invoke-RestMethod https://raw.githubusercontent.com/Lifailon/Selenium-Modules/rsa/Modules/Get-Translation/Get-Translation.psm1 | Out-File -FilePath \"$(New-Item -Path \"$($($Env:PSModulePath -split \";\")[0])\\Get-Translation\" -ItemType Directory -Force)\\Get-Translation.psm1\" -Force Get-Translation -Provider DeepL -Text \"I translating the text\" \\ Get-Translation -Provider DeepL -Text \"\u042f \u043f\u0435\u0440\u0435\u0432\u043e\u0436\u0443 \u0442\u0435\u043a\u0441\u0442\" \\ Get-Translation -Provider Google -Text \"I translating the text\" \\ Get-Translation -Provider Google -Text \"\u042f \u043f\u0435\u0440\u0435\u0432\u043e\u0436\u0443 \u0442\u0435\u043a\u0441\u0442\" -Language en Invoke-RestMethod https://raw.githubusercontent.com/Lifailon/Selenium-Modules/rsa/Modules/Get-SpeedTest/Get-SpeedTest.psm1 | Out-File -FilePath \"$(New-Item -Path \"$($($Env:PSModulePath -split \";\")[0])\\Get-SpeedTest\" -ItemType Directory -Force)\\Get-SpeedTest.psm1\" -Force Get-SpeedTest -Provider Libre \\ Get-SpeedTest -Provider Open \\ Get-SpeedTest -Provider Ookla IE $ie.document.IHTMLDocument3_getElementsByTagName(\"input\") | select name \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0438\u043c\u0435\u043d\u0430 \u0432\u0441\u0435\u0445 Input Box \\ $ie.document.IHTMLDocument3_getElementsByTagName(\"button\") | select innerText \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0438\u043c\u0435\u043d\u0430 \u0432\u0441\u0435\u0445 Button \\ $ie.Document.documentElement.innerHTML \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u0442\u044c \u0441\u044b\u0440\u043e\u0439 Web Content (<input name=\"login\" tabindex=\"100\" class=\"input__control input__input\" id=\"uniq32005644019429136\" spellcheck=\"false\" placeholder=\"\u041b\u043e\u0433\u0438\u043d\") \\ $All_Elements = $ie.document.IHTMLDocument3_getElementsByTagName(\"*\") \u0437\u0430\u0431\u0440\u0430\u0442\u044c \u0432\u0441\u0435 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u044b \\ $Go_Button = $All_Elements | ? innerText -like \"go\" \u043f\u043e\u0438\u0441\u043a \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430 \u043f\u043e \u0438\u043c\u0435\u043d\u0438 \\ $Go_Button | select ie9_tagName \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c TagName (SPAN) \u0434\u043b\u044f \u0431\u044b\u0441\u0442\u0440\u043e\u0433\u043e \u0434\u0430\u043b\u044c\u043d\u0435\u0439\u0448\u0435\u0433\u043e \u043f\u043e\u0438\u0441\u043a\u0430 \\ $SPAN_Elements = $ie.document.IHTMLDocument3_getElementsByTagName(\"SPAN\") $ie = New-Object -ComObject InternetExplorer.Application $ie.navigate(\"https://yandex.ru\") $ie.visible = $true $ie.document.IHTMLDocument3_getElementByID(\"login\").value = \"Login\" $ie.document.IHTMLDocument3_getElementByID(\"passwd\").value = \"Password\" $Button_Auth = ($ie.document.IHTMLDocument3_getElementsByTagName(\"button\")) | ? innerText -match \"\u0412\u043e\u0439\u0442\u0438\" $Button_Auth.Click() $Result = $ie.Document.documentElement.innerHTML $ie.Quit() COM $wshell = New-Object -ComObject Wscript.Shell \\ $wshell | Get-Member \\ $link = $wshell.CreateShortcut(\"$Home\\Desktop\\Yandex.lnk\") \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u044f\u0440\u043b\u044b\u043a \\ $link | Get-Member \\ $link.TargetPath = \"https://yandex.ru\" \u043a\u0443\u0434\u0430 \u0441\u0441\u044b\u043b\u0430\u0435\u0442\u0441\u044f (\u043c\u0435\u0442\u043e\u0434 TargetPath \u043e\u0431\u044a\u0435\u043a\u0442\u0430 $link \u0433\u0434\u0435 \u0445\u0440\u0430\u043d\u0438\u0442\u0441\u044f \u043e\u0431\u044a\u0435\u043a\u0442 CreateShortcut) \\ $link.Save() \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c Set-WinUserLanguageList -LanguageList en-us,ru -Force \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u044f\u0437\u044b\u043a\u043e\u0432\u0443\u044e \u0440\u0430\u0441\u043a\u043b\u0430\u0434\u043a\u0443 \u043a\u043b\u0430\u0432\u0438\u0430\u0442\u0443\u0440\u044b Wscript.Shell.SendKeys (New-Object -ComObject Wscript.shell).SendKeys([char]173) \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c/\u0432\u044b\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0437\u0432\u0443\u043a \\ $wshell.Exec(\"notepad.exe\") \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \\ $wshell.AppActivate(\"\u0411\u043b\u043e\u043a\u043d\u043e\u0442\") \u0440\u0430\u0437\u0432\u0435\u0440\u043d\u0443\u0442\u044c \u0437\u0430\u043f\u0443\u0449\u0435\u043d\u043d\u043e\u0435 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435 $wshell.SendKeys(\"Login\") \u0442\u0435\u043a\u0441\u0442 \\ $wshell.SendKeys(\"{A 5}\") \u043d\u0430\u043f\u0435\u0447\u0430\u0442\u0430\u0442\u044c \u0431\u0443\u043a\u0432\u0443 5 \u0440\u0430\u0437 \u043f\u043e\u0434\u0440\u044f\u0434 \\ $wshell.SendKeys(\"%{TAB}\") ALT+TAB \\ $wshell.SendKeys(\"^\") CTRL \\ $wshell.SendKeys(\"%\") ALT \\ $wshell.SendKeys(\"+\") SHIFT \\ $wshell.SendKeys(\"{DOWN}\") \u0432\u043d\u0438\u0437 \\ $wshell.SendKeys(\"{UP}\") \u0432\u0432\u0435\u0440\u0445 \\ $wshell.SendKeys(\"{LEFT}\") \u0432\u043b\u0435\u0432\u043e \\ $wshell.SendKeys(\"{RIGHT}\") \u0432\u043f\u0440\u0430\u0432\u043e \\ $wshell.SendKeys(\"{PGUP}\") PAGE UP \\ $wshell.SendKeys(\"{PGDN}\") PAGE DOWN \\ $wshell.SendKeys(\"{BACKSPACE}\") BACKSPACE/BKSP/BS \\ $wshell.SendKeys(\"{DEL}\") DEL/DELETE \\ $wshell.SendKeys(\"{INS}\") INS/INSERT \\ $wshell.SendKeys(\"{PRTSC}\") PRINT SCREEN \\ $wshell.SendKeys(\"{ENTER}\") \\ $wshell.SendKeys(\"{ESC}\") \\ $wshell.SendKeys(\"{TAB}\") \\ $wshell.SendKeys(\"{END}\") \\ $wshell.SendKeys(\"{HOME}\") \\ $wshell.SendKeys(\"{BREAK}\") \\ $wshell.SendKeys(\"{SCROLLLOCK}\") \\ $wshell.SendKeys(\"{CAPSLOCK}\") \\ $wshell.SendKeys(\"{NUMLOCK}\") \\ $wshell.SendKeys(\"{F1}\") \\ $wshell.SendKeys(\"{F12}\") \\ $wshell.SendKeys(\"{+}{^}{%}{~}{(}{)}{[}{]}{{}{}}\") function Get-AltTab { (New-Object -ComObject wscript.shell).SendKeys(\"%{Tab}\") Start-Sleep $(Get-Random -Minimum 30 -Maximum 180) Get-AltTab } Get-AltTab Wscript.Shell.Popup $wshell = New-Object -ComObject Wscript.Shell \\ $output = $wshell.Popup(\"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435?\",0,\"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a\",4) \\ if ($output -eq 6) {\"yes\"} elseif ($output -eq 7) {\"no\"} else {\"no good\"} Type: 0 \u041e\u041a 1 \u041e\u041a \u0438 \u041e\u0442\u043c\u0435\u043d\u0430 2 \u0421\u0442\u043e\u043f, \u041f\u043e\u0432\u0442\u043e\u0440, \u041f\u0440\u043e\u043f\u0443\u0441\u0442\u0438\u0442\u044c 3 \u0414\u0430, \u041d\u0435\u0442, \u041e\u0442\u043c\u0435\u043d\u0430 4 \u0414\u0430 \u0438 \u041d\u0435\u0442 5 \u041f\u043e\u0432\u0442\u043e\u0440 \u0438 \u041e\u0442\u043c\u0435\u043d\u0430 16 Stop 32 Question 48 Exclamation 64 Information Output: -1 Timeout 1 \u041e\u041a 2 \u041e\u0442\u043c\u0435\u043d\u0430 3 \u0421\u0442\u043e\u043f 4 \u041f\u043e\u0432\u0442\u043e\u0440 5 \u041f\u0440\u043e\u043f\u0443\u0441\u0442\u0438\u0442\u044c 6 \u0414\u0430 7 \u041d\u0435\u0442 WScript.Network $wshell = New-Object -ComObject WScript.Network \\ $wshell | Get-Member \\ $wshell.UserName \\ $wshell.ComputerName \\ $wshell.UserDomain Shell.Application $wshell = New-Object -ComObject Shell.Application \\ $wshell | Get-Member \\ $wshell.Explore(\"C:\\\") \\ $wshell.Windows() | Get-Member \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0434\u043e\u0441\u0442\u0443\u043f \u043a \u043e\u0442\u043a\u0440\u044b\u0442\u044b\u043c \u0432 \u043f\u0440\u043e\u0432\u043e\u0434\u043d\u0438\u043a\u0435 \u0438\u043b\u0438 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0435 Internet Explorer \u043e\u043a\u043e\u043d $shell = New-Object -Com Shell.Application \\ $RecycleBin = $shell.Namespace(10) \\ $RecycleBin.Items() Outlook $Outlook = New-Object -ComObject Outlook.Application \\ $Outlook | Get-Member \\ $Outlook.Version $Outlook = New-Object -ComObject Outlook.Application $Namespace = $Outlook.GetNamespace(\"MAPI\") $Folder = $namespace.GetDefaultFolder(4)` \u0438\u0441\u0445\u043e\u0434\u044f\u0449\u0438\u0435 $Folder = $namespace.GetDefaultFolder(6)` \u0432\u0445\u043e\u0434\u044f\u0449\u0438\u0435 $Explorer = $Folder.GetExplorer() $Explorer.Display() $Outlook.Quit() Microsoft.Update (New-Object -com 'Microsoft.Update.AutoUpdate').Settings \\ (New-Object -com 'Microsoft.Update.AutoUpdate').Results \\ (New-Timespan -Start ((New-Object -com 'Microsoft.Update.AutoUpdate').Results|Select -ExpandProperty LastInstallationSuccessDate) -End (Get-Date)).hours \u043a\u043e\u043b-\u0432\u043e \u0447\u0430\u0441\u043e\u0432, \u043f\u0440\u043e\u0448\u0435\u0434\u0448\u0438\u0445 \u0441 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0439 \u0434\u0430\u0442\u044b \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u0438 \u0432 Windows. dotNET [System.Diagnostics.EventLog] | select Assembly,Module \\ $EventLog = [System.Diagnostics.EventLog]::new(\"Application\") \\ $EventLog = New-Object -TypeName System.Diagnostics.EventLog -ArgumentList Application,192.168.3.100 \\ $EventLog | Get-Member -MemberType Method \\ $EventLog.MaximumKilobytes \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439 \u0440\u0430\u0437\u043c\u0435\u0440 \u0436\u0443\u0440\u043d\u0430\u043b\u0430 \\ $EventLog.Entries \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0436\u0443\u0440\u043d\u0430\u043b \\ $EventLog.Clear() \u043e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u0436\u0443\u0440\u043d\u0430\u043b Join-Path C: Install Test \\ [System.IO.Path]::Combine(\"C:\", \"Install\", \"Test\") Match [System.Math] | Get-Member -Static -MemberType Methods \\ [System.Math]::Max(2,7) \\ [System.Math]::Min(2,7) \\ [System.Math]::Floor(3.9) \\ [System.Math]::Truncate(3.9) GeneratePassword Add-Type -AssemblyName System.Web \\ [System.Web.Security.Membership]::GeneratePassword(10,2) SoundPlayer $CriticalSound = New-Object System.Media.SoundPlayer $CriticalSound.SoundLocation = \"C:\\WINDOWS\\Media\\Windows Critical Stop.wav\" $CriticalSound.Play() $GoodSound = New-Object System.Media.SoundPlayer $GoodSound.SoundLocation = \"C:\\WINDOWS\\Media\\tada.wav\" $GoodSound.Play() Static Class [System.Environment] | Get-Member -Static \\ [System.Environment]::OSVersion \\ [System.Environment]::Version \\ [System.Environment]::MachineName \\ [System.Environment]::UserName [System.Diagnostics.Process] | Get-Member -Static \\ [System.Diagnostics.Process]::Start('notepad.exe') [Clicker] $cSource = @' using System; using System.Drawing; using System.Runtime.InteropServices; using System.Windows.Forms; public class Clicker { //https://msdn.microsoft.com/en-us/library/windows/desktop/ms646270(v=vs.85).aspx [StructLayout(LayoutKind.Sequential)] struct INPUT { public int type; // 0 = INPUT_MOUSE, // 1 = INPUT_KEYBOARD // 2 = INPUT_HARDWARE public MOUSEINPUT mi; } //https://msdn.microsoft.com/en-us/library/windows/desktop/ms646273(v=vs.85).aspx [StructLayout(LayoutKind.Sequential)] struct MOUSEINPUT { public int dx ; public int dy ; public int mouseData ; public int dwFlags; public int time; public IntPtr dwExtraInfo; } //This covers most use cases although complex mice may have additional buttons //There are additional constants you can use for those cases, see the msdn page const int MOUSEEVENTF_MOVED = 0x0001 ; const int MOUSEEVENTF_LEFTDOWN = 0x0002 ; const int MOUSEEVENTF_LEFTUP = 0x0004 ; const int MOUSEEVENTF_RIGHTDOWN = 0x0008 ; const int MOUSEEVENTF_RIGHTUP = 0x0010 ; const int MOUSEEVENTF_MIDDLEDOWN = 0x0020 ; const int MOUSEEVENTF_MIDDLEUP = 0x0040 ; const int MOUSEEVENTF_WHEEL = 0x0080 ; const int MOUSEEVENTF_XDOWN = 0x0100 ; const int MOUSEEVENTF_XUP = 0x0200 ; const int MOUSEEVENTF_ABSOLUTE = 0x8000 ; const int screen_length = 0x10000 ; //https://msdn.microsoft.com/en-us/library/windows/desktop/ms646310(v=vs.85).aspx [System.Runtime.InteropServices.DllImport(\"user32.dll\")] extern static uint SendInput(uint nInputs, INPUT[] pInputs, int cbSize); public static void LeftClickAtPoint(int x, int y) { //Move the mouse INPUT[] input = new INPUT[3]; input[0].mi.dx = x*(65535/System.Windows.Forms.Screen.PrimaryScreen.Bounds.Width); input[0].mi.dy = y*(65535/System.Windows.Forms.Screen.PrimaryScreen.Bounds.Height); input[0].mi.dwFlags = MOUSEEVENTF_MOVED | MOUSEEVENTF_ABSOLUTE; //Left mouse button down input[1].mi.dwFlags = MOUSEEVENTF_LEFTDOWN; //Left mouse button up input[2].mi.dwFlags = MOUSEEVENTF_LEFTUP; SendInput(3, input, Marshal.SizeOf(input[0])); } } '@ Add-Type -TypeDefinition $cSource -ReferencedAssemblies System.Windows.Forms,System.Drawing \\ [Clicker]::LeftClickAtPoint(1900,1070) [Audio] Add-Type -Language CsharpVersion3 -TypeDefinition @\" using System.Runtime.InteropServices; [Guid(\"5CDF2C82-841E-4546-9722-0CF74078229A\"), InterfaceType(ComInterfaceType.InterfaceIsIUnknown)] interface IAudioEndpointVolume { // f(), g(), ... are unused COM method slots. Define these if you care int f(); int g(); int h(); int i(); int SetMasterVolumeLevelScalar(float fLevel, System.Guid pguidEventContext); int j(); int GetMasterVolumeLevelScalar(out float pfLevel); int k(); int l(); int m(); int n(); int SetMute([MarshalAs(UnmanagedType.Bool)] bool bMute, System.Guid pguidEventContext); int GetMute(out bool pbMute); } [Guid(\"D666063F-1587-4E43-81F1-B948E807363F\"), InterfaceType(ComInterfaceType.InterfaceIsIUnknown)] interface IMMDevice { int Activate(ref System.Guid id, int clsCtx, int activationParams, out IAudioEndpointVolume aev); } [Guid(\"A95664D2-9614-4F35-A746-DE8DB63617E6\"), InterfaceType(ComInterfaceType.InterfaceIsIUnknown)] interface IMMDeviceEnumerator { int f(); // Unused int GetDefaultAudioEndpoint(int dataFlow, int role, out IMMDevice endpoint); } [ComImport, Guid(\"BCDE0395-E52F-467C-8E3D-C4579291692E\")] class MMDeviceEnumeratorComObject { } public class Audio { static IAudioEndpointVolume Vol() { var enumerator = new MMDeviceEnumeratorComObject() as IMMDeviceEnumerator; IMMDevice dev = null; Marshal.ThrowExceptionForHR(enumerator.GetDefaultAudioEndpoint(/*eRender*/ 0, /*eMultimedia*/ 1, out dev)); IAudioEndpointVolume epv = null; var epvid = typeof(IAudioEndpointVolume).GUID; Marshal.ThrowExceptionForHR(dev.Activate(ref epvid, /*CLSCTX_ALL*/ 23, 0, out epv)); return epv; } public static float Volume { get {float v = -1; Marshal.ThrowExceptionForHR(Vol().GetMasterVolumeLevelScalar(out v)); return v;} set {Marshal.ThrowExceptionForHR(Vol().SetMasterVolumeLevelScalar(value, System.Guid.Empty));} } public static bool Mute { get { bool mute; Marshal.ThrowExceptionForHR(Vol().GetMute(out mute)); return mute; } set { Marshal.ThrowExceptionForHR(Vol().SetMute(value, System.Guid.Empty)); } } } \"@ [Audio]::Volume = 0.50 \\ [Audio]::Mute = $true NetSessionEnum Function \\ Source function Invoke-NetSessionEnum { param ( [Parameter(Mandatory = $True)][string]$HostName ) Add-Type -TypeDefinition @\" using System; using System.Diagnostics; using System.Runtime.InteropServices; [StructLayout(LayoutKind.Sequential)] public struct SESSION_INFO_10 { [MarshalAs(UnmanagedType.LPWStr)]public string OriginatingHost; [MarshalAs(UnmanagedType.LPWStr)]public string DomainUser; public uint SessionTime; public uint IdleTime; } public static class Netapi32 { [DllImport(\"Netapi32.dll\", SetLastError=true)] public static extern int NetSessionEnum( [In,MarshalAs(UnmanagedType.LPWStr)] string ServerName, [In,MarshalAs(UnmanagedType.LPWStr)] string UncClientName, [In,MarshalAs(UnmanagedType.LPWStr)] string UserName, Int32 Level, out IntPtr bufptr, int prefmaxlen, ref Int32 entriesread, ref Int32 totalentries, ref Int32 resume_handle); [DllImport(\"Netapi32.dll\", SetLastError=true)] public static extern int NetApiBufferFree( IntPtr Buffer); } \"@ # Create SessionInfo10 Struct $SessionInfo10 = New-Object SESSION_INFO_10 $SessionInfo10StructSize = [System.Runtime.InteropServices.Marshal]::SizeOf($SessionInfo10)` Grab size to loop bufptr $SessionInfo10 = $SessionInfo10.GetType()` Hacky, but we need this ;)) # NetSessionEnum params $OutBuffPtr = [IntPtr]::Zero` Struct output buffer $EntriesRead = $TotalEntries = $ResumeHandle = 0` Counters & ResumeHandle $CallResult = [Netapi32]::NetSessionEnum($HostName, \"\", \"\", 10, [ref]$OutBuffPtr, -1, [ref]$EntriesRead, [ref]$TotalEntries, [ref]$ResumeHandle) if ($CallResult -ne 0){ echo \"Mmm something went wrong!`nError Code: $CallResult\" } else { if ([System.IntPtr]::Size -eq 4) { echo \"`nNetapi32::NetSessionEnum Buffer Offset --> 0x$(\"{0:X8}\" -f $OutBuffPtr.ToInt32())\" } else { echo \"`nNetapi32::NetSessionEnum Buffer Offset --> 0x$(\"{0:X16}\" -f $OutBuffPtr.ToInt64())\" } echo \"Result-set contains $EntriesRead session(s)!\" # Change buffer offset to int $BufferOffset = $OutBuffPtr.ToInt64() # Loop buffer entries and cast pointers as SessionInfo10 for ($Count = 0; ($Count -lt $EntriesRead); $Count++){ $NewIntPtr = New-Object System.Intptr -ArgumentList $BufferOffset $Info = [system.runtime.interopservices.marshal]::PtrToStructure($NewIntPtr,[type]$SessionInfo10) $Info $BufferOffset = $BufferOffset + $SessionInfo10StructSize } echo \"`nCalling NetApiBufferFree, no memleaks here!\" [Netapi32]::NetApiBufferFree($OutBuffPtr) |Out-Null } } Invoke-NetSessionEnum localhost CopyFile Function \\ Source $MethodDefinition = @\" [DllImport(\"kernel32.dll\", CharSet = CharSet.Unicode)] public static extern bool CopyFile(string lpExistingFileName, string lpNewFileName, bool bFailIfExists); \"@ $Kernel32 = Add-Type -MemberDefinition $MethodDefinition -Name \"Kernel32\" -Namespace \"Win32\" -PassThru $Kernel32::CopyFile(\"$($Env:SystemRoot)\\System32\\calc.exe\", \"$($Env:USERPROFILE)\\Desktop\\calc.exe\", $False) ShowWindowAsync Function $Signature = @\" [DllImport(\"user32.dll\")]public static extern bool ShowWindowAsync(IntPtr hWnd, int nCmdShow); \"@ $ShowWindowAsync = Add-Type -MemberDefinition $Signature -Name \"Win32ShowWindowAsync\" -Namespace Win32Functions -PassThru $ShowWindowAsync | Get-Member -Static $ShowWindowAsync::ShowWindowAsync((Get-Process -Id $pid).MainWindowHandle, 2) $ShowWindowAsync::ShowWindowAsync((Get-Process -Id $Pid).MainWindowHandle, 3) $ShowWindowAsync::ShowWindowAsync((Get-Process -Id $Pid).MainWindowHandle, 4) GetAsyncKeyState Function Add-Type -AssemblyName System.Windows.Forms \\ [int][System.Windows.Forms.Keys]::F1 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c \u043d\u043e\u043c\u0435\u0440 [Int] \u043a\u043b\u0430\u0432\u0438\u0448\u0438 \u043f\u043e \u0435\u0435 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044e \\ 65..90 | % {\"{0} = {1}\" -f $_, [System.Windows.Forms.Keys]$_} \u043f\u043e\u0440\u044f\u0434\u043a\u043e\u0432\u044b\u0439 \u043d\u043e\u043c\u0435\u0440 \u0431\u0443\u043a\u0432 (A..Z) function Get-ControlKey { $key = 112 $Signature = @' [DllImport(\"user32.dll\", CharSet=CharSet.Auto, ExactSpelling=true)] public static extern short GetAsyncKeyState(int virtualKeyCode); '@ Add-Type -MemberDefinition $Signature -Name Keyboard -Namespace PsOneApi [bool]([PsOneApi.Keyboard]::GetAsyncKeyState($key) -eq -32767) } Write-Warning 'Press F1 to exit' while ($true) { Write-Host '.' -NoNewline if (Get-ControlKey) { break } Start-Sleep -Seconds 0.5 } Console API Source [Console] | Get-Member -Static \\ [Console]::BackgroundColor = \"Blue\" \\ [Console]::OutputEncoding \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c\u0430\u044f \u043a\u043e\u0434\u0438\u0440\u043e\u0432\u043a\u0430 \u0432 \u0442\u0435\u043a\u0443\u0449\u0435\u0439 \u0441\u0435\u0441\u0441\u0438\u0438 \\ [Console]::OutputEncoding = [System.Text.Encoding]::GetEncoding(\"utf-8\") \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043a\u043e\u0434\u0438\u0440\u043e\u0432\u043a\u0443 \u0434\u043b\u044f \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043a\u0438\u0440\u0438\u043b\u043b\u0438\u0446\u044b \\ [Console]::outputEncoding = [System.Text.Encoding]::GetEncoding(\"cp866\") \u0434\u043b\u044f ISE \\ [Console]::OutputEncoding = [System.Text.Encoding]::GetEncoding(\"windows-1251\") \u0434\u043b\u044f ps2exe \\ Get-Service | Out-File $home\\Desktop\\Service.txt -Encoding oem > \\ Get-Service | Out-File $home\\Desktop\\Service.txt -Append >> do { if ([Console]::KeyAvailable) { $keyInfo = [Console]::ReadKey($true) break } Write-Host \".\" -NoNewline sleep 1 } while ($true) Write-Host $keyInfo function Get-KeyPress { param ( [Parameter(Mandatory)][ConsoleKey]$Key, [System.ConsoleModifiers]$ModifierKey = 0 ) if ([Console]::KeyAvailable) { $pressedKey = [Console]::ReadKey($true) $isPressedKey = $key -eq $pressedKey.Key if ($isPressedKey) { $pressedKey.Modifiers -eq $ModifierKey } else { [Console]::Beep(1800, 200) $false }}} Write-Warning 'Press Ctrl+Shift+Q to exit' do { Write-Host \".\" -NoNewline $pressed = Get-KeyPress -Key Q -ModifierKey 'Control,Shift' if ($pressed) {break} sleep 1 } while ($true) Drawing API Add-Type -AssemblyName System.Drawing $Width = 800 $Height = 400 $image = New-Object System.Drawing.Bitmap($Width,$Height) $graphic = [System.Drawing.Graphics]::FromImage($image) $background_color = [System.Drawing.Brushes]::Blue # \u0437\u0430\u0434\u0430\u0442\u044c \u0446\u0432\u0435\u0442 \u0444\u043e\u043d\u0430 (\u0441\u0438\u043d\u0438\u0439) $graphic.FillRectangle($background_color, 0, 0, $image.Width, $image.Height) $text_color = [System.Drawing.Brushes]::White # \u0437\u0430\u0434\u0430\u0442\u044c \u0446\u0432\u0435\u0442 \u0442\u0435\u043a\u0441\u0442\u0430 (\u0431\u0435\u043b\u044b\u0439) $font = New-Object System.Drawing.Font(\"Arial\", 20, [System.Drawing.FontStyle]::Bold) # \u0437\u0430\u0434\u0430\u0442\u044c \u0448\u0440\u0438\u0444\u0442 $text = \"PowerShell\" # \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u0442\u0435\u043a\u0441\u0442 $text_position = New-Object System.Drawing.RectangleF(320, 180, 300, 100) # \u0437\u0430\u0434\u0430\u0442\u044c \u043f\u043e\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u0442\u0435\u043a\u0441\u0442\u0430 (x, y, width, height) $graphic.DrawString($text, $font, $text_color, $text_position) # \u043d\u0430\u043d\u0435\u0441\u0442\u0438 \u0442\u0435\u043a\u0441\u0442 \u043d\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 $image.Save(\"$home\\desktop\\powershell_image.bmp\", [System.Drawing.Imaging.ImageFormat]::Bmp) # \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 $image.Dispose() # \u043e\u0441\u0432\u043e\u0431\u043e\u0436\u0434\u0435\u043d\u0438\u0435 \u0440\u0435\u0441\u0443\u0440\u0441\u043e\u0432 $path = \"$home\\desktop\\powershell_image.bmp\" \\ Invoke-Item $path $src_image = [System.Drawing.Image]::FromFile($path) $Width = 400 $Height = 200 $dst_image = New-Object System.Drawing.Bitmap -ArgumentList $src_image, $Width, $Height # \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0440\u0430\u0437\u043c\u0435\u0440 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f $dst_image.Save(\"$home\\desktop\\powershell_image_resize.bmp\", [System.Drawing.Imaging.ImageFormat]::Bmp) $rotated_image = $src_image.Clone() # \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043a\u043e\u043f\u0438\u044e \u0438\u0441\u0445\u043e\u0434\u043d\u043e\u0433\u043e \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f $rotated_image.RotateFlip([System.Drawing.RotateFlipType]::Rotate180FlipNone) # \u043f\u0435\u0440\u0435\u0432\u0435\u0440\u043d\u0443\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u043d\u0430 180 \u0433\u0440\u0430\u0434\u0443\u0441\u043e\u0432 $rotated_image.Save(\"$home\\desktop\\powershell_image_rotated.bmp\", [System.Drawing.Imaging.ImageFormat]::Bmp) $src_image.Dispose() # \u0437\u0430\u043a\u0440\u044b\u0442\u044c (\u043e\u0442\u043f\u0443\u0441\u0442\u0438\u0442\u044c) \u0438\u0441\u0445\u043e\u0434\u043d\u044b\u0439 \u0444\u0430\u0439\u043b ObjectEvent $Timer = New-Object System.Timers.Timer $Timer.Interval = 1000 Register-ObjectEvent -InputObject $Timer -EventName Elapsed -SourceIdentifier Timer.Output -Action { $Random = Get-Random -Min 0 -Max 100 Write-Host $Random } $Timer.Enabled = $True $Timer.Enabled = $False \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \\ $Timer | Get-Member -MemberType Event \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u0441\u043e\u0431\u044b\u0442\u0438\u0439 \u043e\u0431\u044a\u0435\u043a\u0442\u0430 \\ Get-EventSubscriber \u0441\u043f\u0438\u0441\u043e\u043a \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0445 \u043f\u043e\u0434\u043f\u0438\u0441\u043e\u043a \u043d\u0430 \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u0432 \u0442\u0435\u043a\u0443\u0449\u0435\u0439 \u0441\u0435\u0441\u0441\u0438\u0438 \\ Unregister-Event -SourceIdentifier Timer.Output \u0443\u0434\u0430\u043b\u044f\u0435\u0442 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044e \u043f\u043e\u0434\u043f\u0438\u0441\u043a\u0438 \u043d\u0430 \u0441\u043e\u0431\u044b\u0442\u0438\u0435 \u043f\u043e \u0438\u043c\u0435\u043d\u0438 \u0441\u043e\u0431\u044b\u0442\u0438\u044f (EventName) \u0438\u043b\u0438 \u0432\u0441\u0435 * \\ -Forward \u043f\u0435\u0440\u0435\u043d\u0430\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u0438\u0437 \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u043e\u0433\u043e \u0441\u0435\u0430\u043d\u0441\u0430 (New-PSSession) \u0432 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u0439 \u0441\u0435\u0430\u043d\u0441 \\ -SupportEvent \u043d\u0435 \u0432\u044b\u0432\u043e\u0434\u0438\u0442 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u043d\u0430 \u044d\u043a\u0440\u0430\u043d (\u0438 Get-EventSubscriber \u0438 Get-Job) Register-EngineEvent -SourceIdentifier PowerShell.Exiting -Action { $date = Get-Date -f hh:mm:ss (New-Object -ComObject Wscript.Shell).Popup(\"PowerShell Exit: $date\",0,\"Action\",64) } Sockets UDP Socket Source function Start-UDPServer { param( $Port = 5201 ) $RemoteComputer = New-Object System.Net.IPEndPoint([System.Net.IPAddress]::Any, 0) do { $UdpObject = New-Object System.Net.Sockets.UdpClient($Port) $ReceiveBytes = $UdpObject.Receive([ref]$RemoteComputer) $UdpObject.Close() $ASCIIEncoding = New-Object System.Text.ASCIIEncoding [string]$ReturnString = $ASCIIEncoding.GetString($ReceiveBytes) [PSCustomObject]@{ LocalDateTime = $(Get-Date -UFormat \"%Y-%m-%d %T\") ClientIP = $RemoteComputer.address.ToString() ClientPort = $RemoteComputer.Port.ToString() Message = $ReturnString } } while (1) } Start-UDPServer -Port 5201 Test-NetUDPConnection function Test-NetUDPConnection { param( [string]$ComputerName = \"127.0.0.1\", [int32]$PortServer = 5201, [int32]$PortClient = 5211, $Message ) begin { $UdpObject = New-Object system.Net.Sockets.Udpclient($PortClient) $UdpObject.Connect($ComputerName, $PortServer) } process { $ASCIIEncoding = New-Object System.Text.ASCIIEncoding if (!$Message) {$Message = Get-Date -UFormat \"%Y-%m-%d %T\"} $Bytes = $ASCIIEncoding.GetBytes($Message) [void]$UdpObject.Send($Bytes, $Bytes.length) } end { $UdpObject.Close() } } Test-NetUDPConnection -ComputerName 127.0.0.1 -PortServer 5201 \\ Test-NetUDPConnection -ComputerName 127.0.0.1 -PortServer 514 -Message \"<30>May 31 00:00:00 HostName multipathd[784]: Test message\" TCP Socket function Start-TCPServer { param( $Port = 5201 ) do { $TcpObject = New-Object System.Net.Sockets.TcpListener($port) $ReceiveBytes = $TcpObject.Start() $ReceiveBytes = $TcpObject.AcceptTcpClient() $TcpObject.Stop() $ReceiveBytes.Client.RemoteEndPoint | select Address,Port } while (1) } Start-TCPServer -Port 5201 \\ Test-NetConnection -ComputerName 127.0.0.1 -Port 5201 WakeOnLan Broadcast package consisting of 6 byte filled \"0xFF\" and then 96 byte where the mac address is repeated 16 times function Send-WOL { param ( [Parameter(Mandatory = $True)]$Mac, $IP, [int]$Port = 9 ) $Mac = $Mac.replace(\":\", \"-\") if (!$IP) {$IP = [System.Net.IPAddress]::Broadcast} $SynchronizationChain = [byte[]](,0xFF * 6) $ByteMac = $Mac.Split(\"-\") | %{[byte](\"0x\" + $_)} $Package = $SynchronizationChain + ($ByteMac * 16) $UdpClient = New-Object System.Net.Sockets.UdpClient $UdpClient.Connect($IP, $port) $UdpClient.Send($Package, $Package.Length) $UdpClient.Close() } Send-WOL -Mac \"D8-BB-C1-70-A3-4E\" \\ Send-WOL -Mac \"D8-BB-C1-70-A3-4E\" -IP 192.168.3.100 Encoding $ByteText = [System.Text.Encoding]::UTF8.GetBytes(\"password\") \\ $Text = [System.Text.Encoding]::UTF8.GetString($ByteText) Base64 $text = \"password\" \\ $byte = [System.Text.Encoding]::Unicode.GetBytes($text) \\ $base64 = [System.Convert]::ToBase64String($byte) \\ $decode_base64 = [System.Convert]::FromBase64String($base64) \\ $decode_string = [System.Text.Encoding]::Unicode.GetString($decode_base64) $path_image = \"$home\\Documents\\1200x800.jpg\" \\ $BBase64 = [System.Convert]::ToBase64String((Get-Content $path_image -Encoding Byte)) \\ Add-Type -assembly System.Drawing \\ $Image = [System.Drawing.Bitmap]::FromStream([IO.MemoryStream][Convert]::FromBase64String($BBase64)) \\ $Image.Save(\"$home\\Desktop\\1200x800.jpg\") HTTP Listener $httpListener = New-Object System.Net.HttpListener $httpListener.Prefixes.Add(\"http://+:8888/\") $httpListener.Start() while (!([console]::KeyAvailable)) { $info = Get-Service | select name,status | ConvertTo-HTML $context = $httpListener.GetContext() $context.Response.StatusCode = 200 $context.Response.ContentType = 'text/HTML' $WebContent = $info $EncodingWebContent = [Text.Encoding]::UTF8.GetBytes($WebContent) $context.Response.OutputStream.Write($EncodingWebContent , 0, $EncodingWebContent.Length) $context.Response.Close() Get-NetTcpConnection -LocalPort 8888 (Get-Date).datetime } $httpListener.Close() WebClient [System.Net.WebClient] | Get-Member \\ (New-Object Net.WebClient).DownloadString(\"https://raw.githubusercontent.com/Lifailon/PowerShell-Commands/rsa/README.md\") Certificate function Get-WebCertificate ($srv) { $iwr = iwr $srv $status_code = $iwr.StatusCode $status = $iwr.BaseResponse.StatusCode $info = $iwr.BaseResponse.Server $spm = [System.Net.ServicePointManager]::FindServicePoint($srv) $date_end = $spm.Certificate.GetExpirationDateString() $cert_name = ($spm.Certificate.Subject) -replace \"CN=\" $cert_owner = ((($spm.Certificate.Issuer) -split \", \") | where {$_ -match \"O=\"}) -replace \"O=\" $Collections = New-Object System.Collections.Generic.List[System.Object] $Collections.Add([PSCustomObject]@{ Host = $srv; Server = $info; Status = $status; StatusCode = $status_code; Certificate = $cert_name; Issued = $cert_owner; End = $date_end }) $Collections } Get-WebCertificate https://google.com Excel $path = \"$home\\Desktop\\Services-to-Excel.xlsx\" $Excel = New-Object -ComObject Excel.Application $Excel.Visible = $false` \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043e\u0442\u043a\u0440\u044b\u0442\u0438\u0435 GUI $ExcelWorkBook = $Excel.Workbooks.Add()` \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043a\u043d\u0438\u0433\u0443 $ExcelWorkSheet = $ExcelWorkBook.Worksheets.Item(1)` \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043b\u0438\u0441\u0442 $ExcelWorkSheet.Name = \"Services\"` \u0437\u0430\u0434\u0430\u0442\u044c \u0438\u043c\u044f \u043b\u0438\u0441\u0442\u0430 $ExcelWorkSheet.Cells.Item(1,1) = \"Name service\" # \u0417\u0430\u0434\u0430\u0442\u044c \u0438\u043c\u0435\u043d\u0430 \u0441\u0442\u043e\u043b\u0431\u0446\u043e\u0432: $ExcelWorkSheet.Cells.Item(1,2) = \"Description\" $ExcelWorkSheet.Cells.Item(1,3) = \"Status\" $ExcelWorkSheet.Cells.Item(1,4) = \"Startup type\" $ExcelWorkSheet.Rows.Item(1).Font.Bold = $true` \u0432\u044b\u0434\u0435\u043b\u0438\u0442\u044c \u0436\u0438\u0440\u043d\u044b\u043c \u0448\u0440\u0438\u0444\u0442\u043e\u043c $ExcelWorkSheet.Rows.Item(1).Font.size=14 # \u0417\u0430\u0434\u0430\u0442\u044c \u0448\u0438\u0440\u0438\u043d\u0443 \u043a\u043e\u043b\u043e\u043d\u043e\u043a: $ExcelWorkSheet.Columns.Item(1).ColumnWidth=30 $ExcelWorkSheet.Columns.Item(2).ColumnWidth=80 $ExcelWorkSheet.Columns.Item(3).ColumnWidth=15 $ExcelWorkSheet.Columns.Item(4).ColumnWidth=25 $services = Get-Service $counter = 2` \u0437\u0430\u0434\u0430\u0442\u044c \u043d\u0430\u0447\u0430\u043b\u044c\u043d\u044b\u0439 \u043d\u043e\u043c\u0435\u0440 \u0441\u0442\u0440\u043e\u043a\u0438 \u0434\u043b\u044f \u0437\u0430\u043f\u0438\u0441\u0438 foreach ($service in $services) { $status = $service.Status if ($status -eq 1) { $status_type = \"Stopped\" } elseif ($status -eq 4) { $status_type = \"Running\" } $Start = $service.StartType if ($Start -eq 1) { $start_type = \"Delayed start\" } elseif ($Start -eq 2) { $start_type = \"Automatic\" } elseif ($Start -eq 3) { $start_type = \"Manually\" } elseif ($Start -eq 4) { $start_type = \"Disabled\" } $ExcelWorkSheet.Columns.Item(1).Rows.Item($counter) = $service.Name $ExcelWorkSheet.Columns.Item(2).Rows.Item($counter) = $service.DisplayName $ExcelWorkSheet.Columns.Item(3).Rows.Item($counter) = $status_type $ExcelWorkSheet.Columns.Item(4).Rows.Item($counter) = $start_type if ($status_type -eq \"Running\") { $ExcelWorkSheet.Columns.Item(3).Rows.Item($counter).Font.Bold = $true } $counter++` +1 \u0443\u0432\u0435\u043b\u0438\u0447\u0438\u0442\u044c \u0434\u043b\u044f \u0441\u0447\u0435\u0442\u0447\u0438\u043a\u0430 \u0441\u0442\u0440\u043e\u043a\u0438 Rows } $ExcelWorkBook.SaveAs($path) $ExcelWorkBook.close($true) $Excel.Quit() Excel.Application.Open $path = \"$home\\Desktop\\Services-to-Excel.xlsx\" $Excel = New-Object -ComObject Excel.Application $Excel.Visible = $false $ExcelWorkBook = $excel.Workbooks.Open($path)` \u043e\u0442\u043a\u0440\u044b\u0442\u044c xlsx-\u0444\u0430\u0439\u043b $ExcelWorkBook.Sheets | select Name,Index` \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043b\u0438\u0441\u0442\u044b $ExcelWorkSheet = $ExcelWorkBook.Sheets.Item(1)` \u043e\u0442\u043a\u0440\u044b\u0442\u044c \u043b\u0438\u0441\u0442 \u043f\u043e \u043d\u043e\u043c\u0435\u0440\u0443 Index 1..100 | %{$ExcelWorkSheet.Range(\"A$_\").Text}` \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0438\u0437 \u0441\u0442\u043e\u043b\u0431\u0446\u0430 \u0410 \u0441\u0442\u0440\u043e\u043a\u0438 c 1 \u043f\u043e 100 $Excel.Quit() ImportExcel Install-Module -Name ImportExcel \\ $data | Export-Excel .\\Data.xlsx \\ $data = Import-Excel .\\Data.xlsx $data = ps \\ $Chart = New-ExcelChartDefinition -XRange CPU -YRange WS -Title \"Process\" -NoLegend \\ $data | Export-Excel .\\ps.xlsx -AutoNameRange -ExcelChartDefinition $Chart -Show CSV Get-Service | Select Name,DisplayName,Status,StartType | Export-Csv -path \"$home\\Desktop\\Get-Service.csv\" -Append -Encoding Default \u044d\u043a\u0441\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 csv (-Encoding UTF8) \\ Import-Csv \"$home\\Desktop\\Get-Service.csv\" -Delimiter \",\" \u0438\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043c\u0430\u0441\u0441\u0438\u0432 $data = ConvertFrom-Csv @\" Region,State,Units,Price West,Texas,927,923.71 $null,Tennessee,466,770.67 \"@ $systeminfo = systeminfo /FO csv | ConvertFrom-Csv \u0432\u044b\u0432\u043e\u0434 \u0440\u0430\u0431\u043e\u0442\u044b \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u044b \u0432 CSV \u0438 \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0438\u044f \u0432 \u043e\u0431\u044a\u0435\u043a\u0442 \\ $systeminfo.\"\u041f\u043e\u043b\u043d\u044b\u0439 \u043e\u0431\u044a\u0435\u043c \u0444\u0438\u0437\u0438\u0447\u0435\u0441\u043a\u043e\u0439 \u043f\u0430\u043c\u044f\u0442\u0438\" \\ $systeminfo.\"\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u0430\u044f \u0444\u0438\u0437\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u043f\u0430\u043c\u044f\u0442\u044c\" ConvertFrom-String ' log = { level = 4; }; ' | ConvertFrom-String` \u0441\u043e\u0437\u0434\u0430\u0435\u0442 PSCustomObject (\u0440\u0430\u0437\u0431\u0438\u0432\u0430\u0435\u0442 \u043f\u043e \u043f\u0440\u043e\u0431\u0435\u043b\u0430\u043c, \u0443\u0434\u0430\u043b\u044f\u0435\u0442 \u0432\u0441\u0435 \u043f\u0440\u043e\u0431\u0435\u043b\u044b \u0438 \u043f\u0443\u0441\u0442\u044b\u0435 \u0441\u0442\u0440\u043e\u043a\u0438) ConvertFrom-StringData \" key1 = value1 key2 = value2 \" | ConvertFrom-StringData # \u0441\u043e\u0437\u0434\u0430\u0435\u0442 Hashtable XML $xml = [xml](Get-Content $home\\desktop\\test.rdg)` \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u0442\u044c \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 XML-\u0444\u0430\u0439\u043b\u0430 $xml.load(\"$home\\desktop\\test.rdg\")` \u043e\u0442\u043a\u0440\u044b\u0442\u044c \u0444\u0430\u0439\u043b $xml.RDCMan.file.group.properties.name` \u0438\u043c\u0435\u043d\u0430 \u0433\u0440\u0443\u043f\u043f $xml.RDCMan.file.group.server.properties` \u0438\u043c\u0435\u043d\u0430 \u0432\u0441\u0435\u0445 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u0432 $xml.RDCMan.file.group[3].server.properties` \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u0432 \u0432 4-\u0439 \u0433\u0440\u0443\u043f\u043f\u0435 ($xml.RDCMan.file.group[3].server.properties | ? name -like ADIRK).Name = \"New-Name\"` \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 $xml.RDCMan.file.group[3].server[0].properties.displayName = \"New-displayName\" $xml.RDCMan.file.group[3].server[1].RemoveAll()` \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043e\u0431\u044a\u0435\u043a\u0442 (2-\u0439 \u0441\u0435\u0440\u0432\u0435\u0440 \u0432 \u0441\u043f\u0438\u0441\u043a\u0435) $xml.Save($file)` \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u0430 \u0432 \u0444\u0430\u0439\u043b\u0430 Get-Service | Export-Clixml -path $home\\desktop\\test.xml \u044d\u043a\u0441\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043e\u0431\u044a\u0435\u043a\u0442 PowerShell \u0432 XML \\ Import-Clixml -Path $home\\desktop\\test.xml \u0438\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043e\u0431\u044a\u0435\u043a\u0442 XML \u0432 PowerShell \\ ConvertTo-Xml (Get-Service) Get-CredToXML function Get-CredToXML { param ( $CredFile = \"$home\\Documents\\cred.xml\" ) if (Test-Path $CredFile) { Import-Clixml -path $CredFile } elseif (!(Test-Path $CredFile)) { $Cred = Get-Credential -Message \"Enter credential\" if ($Cred -ne $null) { $Cred | Export-CliXml -Path $CredFile $Cred } else { return } } } $Cred = Get-CredToXML \\ $Login = $Cred.UserName \\ $PasswordText = $Cred.GetNetworkCredential().password \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \u0432 \u0442\u0435\u043a\u0441\u0442\u043e\u0432\u043e\u043c \u0432\u0438\u0434\u0435 XmlWriter (Extensible Markup Language) $XmlWriterSettings = New-Object System.Xml.XmlWriterSettings $XmlWriterSettings.Indent = $true` \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043e\u0442\u0441\u0442\u0443\u043f\u044b $XmlWriterSettings.IndentChars = \" \"` \u0437\u0430\u0434\u0430\u0442\u044c \u043e\u0442\u0441\u0442\u0443\u043f $XmlFilePath = \"$home\\desktop\\test.xml\" $XmlObjectWriter = [System.XML.XmlWriter]::Create($XmlFilePath, $XmlWriterSettings)` \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442 $XmlObjectWriter.WriteStartDocument()` \u043d\u0430\u0447\u0430\u0442\u044c \u0437\u0430\u043f\u0438\u0441\u044c \u0432 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442 $XmlObjectWriter.WriteComment(\"Comment\") $XmlObjectWriter.WriteStartElement(\"Root\")` \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0441\u0442\u0430\u0440\u0442\u043e\u0432\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0434\u043e\u0447\u0435\u0440\u043d\u0438\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b $XmlObjectWriter.WriteStartElement(\"Configuration\")` \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u0435\u0440\u0432\u044b\u0439 \u0434\u043e\u0447\u0435\u0440\u043d\u0438\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 \u0434\u043b\u044f BaseSettings $XmlObjectWriter.WriteElementString(\"Language\",\"RU\") $XmlObjectWriter.WriteStartElement(\"Fonts\") # <Fonts> $XmlObjectWriter.WriteElementString(\"Name\",\"Arial\") $XmlObjectWriter.WriteElementString(\"Size\",\"12\") $XmlObjectWriter.WriteEndElement() # </Fonts> $XmlObjectWriter.WriteEndElement()` \u043a\u043e\u043d\u0435\u0447\u043d\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 </Configuration> $XmlObjectWriter.WriteEndElement()` \u043a\u043e\u043d\u0435\u0447\u043d\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 </Root> $XmlObjectWriter.WriteEndDocument()` \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u0437\u0430\u043f\u0438\u0441\u044c \u0432 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442 $XmlObjectWriter.Flush() $XmlObjectWriter.Close() CreateElement $xml = [xml](gc $home\\desktop\\test.xml) $xml.Root.Configuration.Fonts $NewElement = $xml.CreateElement(\"Fonts\")` \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u044d\u043b\u0435\u043c\u0435\u043d\u0442 \u043a\u0443\u0434\u0430 \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c $NewElement.set_InnerXML(\"<Name>Times New Roman</Name><Size>14</Size>\")` \u0417\u0430\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f\u043c\u0438 \u0434\u043e\u0447\u0435\u0440\u043d\u0438\u0435 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u044b Fonts $xml.Root.Configuration.AppendChild($NewElement)` \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u044d\u043b\u0435\u043c\u0435\u043d\u0442 \u043d\u043e\u0432\u043e\u0439 \u0441\u0442\u0440\u043e\u043a\u043e\u0439 \u0432 Configuration (\u0440\u043e\u0434\u0438\u0442\u0435\u043b\u044c Fonts) $xml.Save(\"$home\\desktop\\test.xml\") JSON $log = ' { \"log\": { \"level\": 7 } } ' | ConvertFrom-Json Get-Service | ConvertTo-Json $OOKLA = ' { \"result\" : {\"date\":1683534970,\"id\":\"14708271987\",\"connection_icon\":\"wireless\",\"download\":33418,\"upload\":35442,\"latency\":15,\"distance\":50,\"country_code\":\"RU\",\"server_id\":2707,\"server_name\":\"Bryansk\",\"sponsor_name\":\"DOM.RU\",\"sponsor_url\":null,\"connection_mode\":\"multi\",\"isp_name\":\"Resource Link\",\"isp_rating\":\"4.0\",\"test_rank\":63,\"test_grade\":\"B-\",\"test_rating\":4,\"idle_latency\":\"17\",\"download_latency\":\"116\",\"upload_latency\":\"75\",\"additional_servers\": [{\"server_id\":8191,\"server_name\":\"Bryansk\",\"sponsor_name\":\"SectorTelecom.ru\"},{\"server_id\":46278,\"server_name\":\"Fokino\",\"sponsor_name\":\"Fokks - Promyshlennaya avtomatika Ltd.\"},{\"server_id\":18218,\"server_name\":\"Bryansk\",\"sponsor_name\":\"RIA-link Ltd.\"}], \"path\":\"result\\u002F14708271987\",\"hasSecondary\":true } } ' | ConvertFrom-Json $ookla.result YAML Import-Module PSYaml` \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0432 Docker/Ansible $netplan = \" network:` \u0441\u043b\u043e\u0432\u0430\u0440\u044c \u043f\u043e \u0442\u0438\u043f\u0443 - \u043a\u043b\u044e\u0447 : \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0441 \u0432\u043b\u043e\u0436\u0435\u043d\u043d\u044b\u043c\u0438 \u0441\u043b\u043e\u0432\u0430\u0440\u044f\u043c\u0438 ethernets: ens160: dhcp4: yes dhcp6: no nameservers: addresses:` [8.8.8.8, 1.1.1.1]` \u0441\u043f\u0438\u0441\u043e\u043a \u0434\u0430\u043d\u043d\u044b\u0445 (\u0441\u0442\u0440\u043e\u043a) - 8.8.8.8 - 1.1.1.1 version: 2 \" $network = ConvertFrom-Yaml $netplan $network.Values.ethernets.ens160.nameservers $DataType = \" int: !!int 10.1 flo: !!float 10.1 str: !!str string bool: !!bool` boolean \" HTML ConvertFrom-Html function ConvertFrom-Html { param ( [Parameter(ValueFromPipeline)]$url ) $irm = Invoke-RestMethod $url $HTMLFile = New-Object -ComObject HTMLFile $Bytes = [System.Text.Encoding]::Unicode.GetBytes($irm) $HTMLFile.write($Bytes) ($HTMLFile.all | where {$_.tagname -eq \"body\"}).innerText } $apache_status = \"http://192.168.3.102/server-status\" $apache_status | ConvertFrom-Html ConvertTo-Html Get-Process | select Name, CPU | ConvertTo-Html -As Table > \"$home\\desktop\\proc-table.html\" \u0432\u044b\u0432\u043e\u0434 \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 List (Format-List) \u0438\u043b\u0438 Table (Format-Table) $servers = \"ya.ru\",\"ya.com\",\"google.com\" $path = \"$home\\Desktop\\Ping.html\" $header = @\" <!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\"> <html xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"en\" xml:lang=\"en\"> <head> <title>\u041e\u0442\u0447\u0435\u0442 \u043e \u0441\u0442\u0430\u0442\u0443\u0441\u0435 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u0432</title> <style type=\"text/css\"> <!-- body { background-color: #E0E0E0; font-family: sans-serif } table, th, td { background-color: white; border-collapse:collapse; border: 1px solid black; padding: 5px } --> </style> \"@ $body = @\" <h1>Ping status</h1> <p>$(get-date -Format \"dd.MM.yyyy hh:mm\").</p> \"@ $results = foreach ($server in $servers) { if (Test-Connection $server -Count 1 -ea 0 -Quiet) { $status = \"Up\" } else { $status = \"Down\" } [PSCustomObject]@{ Name = $server Status = $status } } $results | ConvertTo-Html -head $header -body $body | foreach { $_ -replace \"<td>Down</td>\",\"<td style='background-color:#FF8080'>Down</td>\" -replace \"<td>Up</td>\",\"<td style='background-color:#5BCCF3'>Up</td>\" } | Out-File $path Invoke-Item $path PSWriteHTML Import-Module PSWriteHTML (Get-Module PSWriteHTML).ExportedCommands Get-Service | Out-GridHtml -FilePath ~\\Desktop\\Get-Service-Out-GridHtml.html HtmlReport Import-Module HtmlReport $topVM = ps | Sort PrivateMemorySize -Descending | Select -First 10 | %{,@(($_.ProcessName + \" \" + $_.Id), $_.PrivateMemorySize)} $topCPU = ps | Sort CPU -Descending | Select -First 10 | %{,@(($_.ProcessName + \" \" + $_.Id), $_.CPU)} New-Report -Title \"Piggy Processes\" -Input { New-Chart Bar \"Top VM Users\" -input $topVm New-Chart Column \"Top CPU Overall\" -input $topCPU ps | Select ProcessName, Id, CPU, WorkingSet, *MemorySize | New-Table \"All Processes\" } > ~\\Desktop\\Get-Process-HtmlReport.html HtmlAgilityPack Source # \u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0438 C#, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u043f\u0430\u0440\u0441\u0438\u0442\u044c HTML-\u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u044b, \u0432\u044b\u0431\u0438\u0440\u0430\u0442\u044c \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u044b DOM \u0438 \u0438\u0437\u0432\u043b\u0435\u043a\u0430\u0442\u044c \u0438\u0437 \u043d\u0438\u0445 \u0434\u0430\u043d\u043d\u044b\u0435 Add-Type -Path \"C:\\Users\\Lifailon\\Downloads\\HtmlAgilityPack\\Net40\\HtmlAgilityPack.dll\" $title = \"\u043d\u043e\u0432\u043e\u0431\u0440\u0430\u043d\u0435\u0446\" $url = \"http://fasts-torrent.net\" $ep = \"engine/ajax/search_torrent.php?title=$title\" $html = Invoke-RestMethod \"$url/$ep\" # \u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u043d\u043e\u0432\u043e\u0433\u043e \u043e\u0431\u044a\u0435\u043a\u0442\u0430 HtmlDocument \u0438\u0437 HtmlAgilityPack, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0431\u0443\u0434\u0435\u0442 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u0434\u043b\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0438 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438 HTML-\u043a\u043e\u0434\u0430 $HtmlDocument = New-Object HtmlAgilityPack.HtmlDocument # \u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 HTML \u0432 \u0441\u043e\u0437\u0434\u0430\u043d\u043d\u044b\u0439 \u043e\u0431\u044a\u0435\u043a\u0442 HtmlDocument $HtmlDocument.LoadHtml($html) $torrents = @() # \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 XPath \u0434\u043b\u044f \u0432\u044b\u0431\u043e\u0440\u0430 \u0432\u0441\u0435\u0445 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432 <tr> (\u0441\u0442\u0440\u043e\u043a \u0442\u0430\u0431\u043b\u0438\u0446\u044b) \u0432 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0435 $HtmlDocument.DocumentNode.SelectNodes(\"//tr\") | ForEach-Object { # \u0414\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0439 \u0441\u0442\u0440\u043e\u043a\u0438 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u0432\u044b\u0431\u0438\u0440\u0430\u0435\u043c \u043a\u043b\u0430\u0441\u0441\u044b, \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044e \u0440\u0430\u0437\u0434\u0430\u0447\u0438, \u0440\u0430\u0437\u043c\u0435\u0440\u0443 \u0438 \u0441\u0441\u044b\u043b\u043a\u0435 \u0434\u043b\u044f \u0441\u043a\u0430\u0447\u0438\u0432\u0430\u043d\u0438\u044f. $titleNode = $_.SelectSingleNode(\".//td[@class='torrent-title']\") $sizeNode = $_.SelectSingleNode(\".//td[@class='torrent-sp']\") $downloadLinkNode = $_.SelectSingleNode(\".//td[@class='torrent-d-btn']/a\") # \u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c, \u0447\u0442\u043e \u0432\u0441\u0435 \u043a\u043b\u0430\u0441\u0441\u044b \u043d\u0430\u0439\u0434\u0435\u043d\u044b if ($titleNode -ne $null -and $sizeNode -ne $null -and $downloadLinkNode -ne $null) { # \u0418\u0437\u0432\u043b\u0435\u0447\u0435\u043d\u0438\u0435 \u0442\u0435\u043a\u0441\u0442\u0430 \u0438\u0437 \u043a\u043b\u0430\u0441\u0441\u043e\u0432 $title = $titleNode.InnerText.Trim() $size = $sizeNode.InnerText.Trim() $downloadLink = $downloadLinkNode.Attributes[\"href\"].Value $torrent = New-Object PSObject -Property @{ Title = $title Size = $size DownloadLink = \"$($url)$($downloadLink)\" } $torrents += $torrent } } $torrents Title Size DownloadLink ----- ---- ------------ \u041d\u043e\u0432\u043e\u0431\u0440\u0430\u043d\u0435\u0446 (6 \u0441\u0435\u0437\u043e\u043d: 1-3 \u0441\u0435\u0440\u0438\u0438 \u0438\u0437 13) (2024) WEBRip | RuDub 1,55 \u0413\u0411 http://fasts-torrent.net/download/449613/torrent/-6-1-3-13-2024-webrip-rudub/ \u041d\u043e\u0432\u043e\u0431\u0440\u0430\u043d\u0435\u0446 (5 \u0441\u0435\u0437\u043e\u043d: 1-22 \u0441\u0435\u0440\u0438\u0438 \u0438\u0437 22) (2023) WEBRip 1080p | RuDub 54,15 \u0413\u0411 http://fasts-torrent.net/download/433749/torrent/-5-1-22-22-2023-webrip-1080p-rudub/ \u041d\u043e\u0432\u043e\u0431\u0440\u0430\u043d\u0435\u0446 (5 \u0441\u0435\u0437\u043e\u043d: 1-22 \u0441\u0435\u0440\u0438\u0438 \u0438\u0437 22) (2023) WEBRip 720p | RuDub 30,14 \u0413\u0411 http://fasts-torrent.net/download/433750/torrent/-5-1-22-22-2023-webrip-720p-rudub/ \u041d\u043e\u0432\u043e\u0431\u0440\u0430\u043d\u0435\u0446 (5 \u0441\u0435\u0437\u043e\u043d: 1-22 \u0441\u0435\u0440\u0438\u0438 \u0438\u0437 22) (2023) WEBRip | RuDub 11,55 \u0413\u0411 http://fasts-torrent.net/download/433751/torrent/-5-1-22-22-2023-webrip-rudub/ \u041d\u043e\u0432\u043e\u0431\u0440\u0430\u043d\u0435\u0446 (4 \u0441\u0435\u0437\u043e\u043d: 1-22 \u0441\u0435\u0440\u0438\u0438 \u0438\u0437 22) (2021) WEB-DL 720p | RG.Paravozik 21.33 Gb http://fasts-torrent.net/download/418618/torrent/-4-1-22-22-2021-web-dl-720p-rgparavozik/ \u041f\u043e\u043b\u0438\u0446\u0435\u0439\u0441\u043a\u0438\u0439 \u0441 \u043f\u043e\u043b\u043e\u0432\u0438\u043d\u043e\u0439: \u041d\u043e\u0432\u043e\u0431\u0440\u0430\u043d\u0435\u0446 (2017) WEB-DLRip 720p| \u0427\u0438\u0441\u0442\u044b\u0439 \u0437\u0432\u0443\u043a 3.41 Gb http://fasts-torrent.net/download/254846/torrent/-2017-web-dlrip-720p-/ \u041f\u043e\u043b\u0438\u0446\u0435\u0439\u0441\u043a\u0438\u0439 \u0441 \u043f\u043e\u043b\u043e\u0432\u0438\u043d\u043e\u0439: \u041d\u043e\u0432\u043e\u0431\u0440\u0430\u043d\u0435\u0446 (2017) WEB-DLRip | \u0427\u0438\u0441\u0442\u044b\u0439 \u0437\u0432\u0443\u043a 1.37 Gb http://fasts-torrent.net/download/254845/torrent/-2017-web-dlrip-/ \u041d\u043e\u0432\u043e\u0431\u0440\u0430\u043d\u0435\u0446 (2 \u0441\u0435\u0437\u043e\u043d: 1-20 \u0441\u0435\u0440\u0438\u0438 \u0438\u0437 20) (2019) WEBRip | BaibaKo 11.28 Gb http://fasts-torrent.net/download/364669/torrent/-2-1-20-20-2019-webrip-baibako/ \u041d\u043e\u0432\u043e\u0431\u0440\u0430\u043d\u0435\u0446 (2 \u0441\u0435\u0437\u043e\u043d: 1-20 \u0441\u0435\u0440\u0438\u0438 \u0438\u0437 20) (2019) WEBRip 1080p | Octopus 45.97 Gb http://fasts-torrent.net/download/364161/torrent/-2-1-20-20-2019-webrip-1080p-octopus/ \u041d\u043e\u0432\u043e\u0431\u0440\u0430\u043d\u0435\u0446 (2 \u0441\u0435\u0437\u043e\u043d: 1-20 \u0441\u0435\u0440\u0438\u0438 \u0438\u0437 20) (2019) WEB-DLRip | LostFilm 11.95 Gb http://fasts-torrent.net/download/364668/torrent/-2-1-20-20-2019-web-dlrip-lostfilm/ SQLite $path = \"$home\\Documents\\Get-Service.db\" $Module = Get-Module MySQLite if ($Module -eq $null) { Install-Module MySQLite -Repository PSGallery -Scope CurrentUser } Import-Module MySQLite New-MySQLiteDB -Path $path # \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0411\u0414 Invoke-MySQLiteQuery -Path $path -Query \"CREATE TABLE Service (Name TEXT NOT NULL, DisplayName TEXT NOT NULL, Status TEXT NOT NULL);\" # \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0442\u0430\u0431\u043b\u0438\u0446\u0443 $Service = Get-Service | select Name,DisplayName,Status foreach ($S in $Service) { $Name = $S.Name $DName = $S.DisplayName $Status = $S.Status Invoke-MySQLiteQuery -Path $path -Query \"INSERT INTO Service (Name, DisplayName, Status) VALUES ('$Name', '$DName', '$Status');\" } (Get-MySQLiteDB $path).Tables \u0441\u043f\u0438\u0441\u043e\u043a \u0442\u0430\u0431\u043b\u0438\u0446 \u0432 \u0431\u0430\u0437\u0435 \\ Invoke-MySQLiteQuery -Path $path -Query \"SELECT name FROM sqlite_master WHERE type='table';\" \u0441\u043f\u0438\u0441\u043e\u043a \u0442\u0430\u0431\u043b\u0438\u0446 \u0432 \u0431\u0430\u0437\u0435 \\ Invoke-MySQLiteQuery -Path $path -Query \"DROP TABLE Service;\" \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0442\u0430\u0431\u043b\u0438\u0446\u0443 $TableName = \"Service\" Invoke-MySQLiteQuery -Path $path -Query \"SELECT * FROM $TableName\" # \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u0442\u044c \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b (\u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u0430) Get-Service | select Name,DisplayName,Status | ConvertTo-MySQLiteDB -Path $path -TableName Service -force \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043e\u0431\u044a\u0435\u043a\u0442 \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0443 Database password $Connection = New-SQLiteConnection -DataSource $path $Connection.ChangePassword(\"password\") $Connection.Close() Invoke-SqliteQuery -Query \"SELECT * FROM Service\" -DataSource \"$path;Password=password\" MySQL apt -y install mysql-server mysql-client \\ mysql -V \\ systemctl status mysql \\ mysqladmin -u root password \u0437\u0430\u0434\u0430\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c root nano /etc/mysql/mysql.conf.d/mysqld.cnf [mysqld] user = mysql # pid-file = /var/run/mysqld/mysqld.pid # socket = /var/run/mysqld/mysqld.sock # port = 3306 # datadir = /var/lib/mysql # tmpdir = /tmp bind-address = 0.0.0.0 mysqlx-bind-address = 0.0.0.0 log_error = /var/log/mysql/error.log systemctl restart mysql \\ ss -tulnp | grep 3306 \\ ufw allow 3306/tcp \\ nc -zv 192.168.1.253 3306 \\ tnc 192.168.1.253 -p 3306 mysql -u root -p \\ SELECT user(), now(), version(); \\ quit; mysql -u root -p -e 'SHOW TABLES FROM db_aduser;' \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0442\u0430\u0431\u043b\u0438\u0446 \u0431\u0435\u0437 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u043a \u043a\u043e\u043d\u0441\u043e\u043b\u0438 MySQL CREATE \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0411\u0414, \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f, \u0442\u0430\u0431\u043b\u0438\u0446\u0443 \\ ALTER \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0441\u0442\u043e\u043b\u0431\u0446\u0430\u043c\u0438 \u0442\u0430\u0431\u043b\u0438\u0446\u0435 \\ DROP \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0411\u0414, \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f, \u0442\u0430\u0431\u043b\u0438\u0446\u0443 \\ USE \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0411\u0414 \\ SHOW \u0432\u044b\u0432\u0435\u0441\u043b\u0438 \u0441\u043f\u0438\u0441\u043e\u043a \u0411\u0414, \u043f\u0440\u0430\u0432 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f (GRANTS), \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044f \u0441\u0442\u043e\u043b\u0431\u0446\u043e\u0432 \u0438 \u0438\u0445 \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430 \\ GRANT \u0434\u0430\u0442\u044c \u0434\u043e\u0441\u0442\u0443\u043f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044e \u043a \u0411\u0414 \\ REVOKE \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0434\u043e\u0441\u0442\u0443\u043f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u043a \u0411\u0414 \\ UPDATE \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u0440\u0430\u0432\u0430 \u0434\u043e\u0441\u0442\u0443\u043f\u0430, \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0441 \u0442\u0430\u0431\u043b\u0438\u0446\u0435 \\ FLUSH \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u043f\u0440\u0430\u0432\u0430 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \\ SELECT \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u0443\u044e \u0411\u0414, \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439, \u0432\u044b\u0431\u043e\u0440\u043a\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0435 \\ INSERT \u0432\u043d\u0435\u0441\u0442\u0438 \u0434\u0430\u043d\u043d\u044b\u0435 \\ DELETE \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 (FROM) \u0442\u0430\u0431\u043b\u0438\u0446\u0435 DATA TYPE VARCHAR(N) \u0441\u0442\u0440\u043e\u043a\u0430 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u043e\u0439 \u0434\u043b\u0438\u043d\u044b, \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 ASCII, \u0433\u0434\u0435 \u043e\u0434\u0438\u043d \u0441\u0438\u043c\u0432\u043e\u043b \u0437\u0430\u043d\u0438\u043c\u0430\u0435\u0442 1 \u0431\u0430\u0439\u0442, \u0447\u0438\u0441\u043b\u043e\u043c N \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u0430\u044f \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u0430\u044f \u0434\u043b\u0438\u043d\u0430 \u0441\u0442\u0440\u043e\u043a\u0438 \\ NVARCHAR(N) \u0441\u0442\u0440\u043e\u043a\u0430 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u043e\u0439 \u0434\u043b\u0438\u043d\u044b, \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 Unicode, \u0433\u0434\u0435 \u043e\u0434\u0438\u043d \u0441\u0438\u043c\u0432\u043e\u043b \u0437\u0430\u043d\u0438\u043c\u0430\u0435\u0442 2 \u0431\u0430\u0439\u0442\u0430 \\ CHAR(N)/nchar(N) \u0441\u0442\u0440\u043e\u043a\u0430 \u0444\u0438\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0439 \u0434\u043b\u0438\u043d\u044b, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u0432\u0441\u0435\u0433\u0434\u0430 \u0434\u043e\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \u0441\u043f\u0440\u0430\u0432\u0430 \u043f\u0440\u043e\u0431\u0435\u043b\u0430\u043c\u0438 \u0434\u043e \u0434\u043b\u0438\u043d\u044b N \u0438 \u0432 \u0431\u0430\u0437\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 \u043e\u043d\u0430 \u0437\u0430\u043d\u0438\u043c\u0430\u0435\u0442 \u0440\u043e\u0432\u043d\u043e N \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432 \\ INT \u0446\u0435\u043b\u043e\u0435 \u0447\u0438\u0441\u043b\u043e, \u043e\u0442 -2147483648 \u0434\u043e 2147483647, \u0437\u0430\u043d\u0438\u043c\u0430\u0435\u0442 4 \u0431\u0430\u0439\u0442\u0430 \\ FLOAT \u0447\u0438\u0441\u043b\u043e, \u0432 \u043a\u043e\u0442\u043e\u0440\u043e\u043c \u043c\u043e\u0436\u0435\u0442 \u043f\u0440\u0438\u0441\u0443\u0442\u0441\u0442\u0432\u043e\u0432\u0430\u0442\u044c \u0434\u0435\u0441\u044f\u0442\u0438\u0447\u043d\u0430\u044f \u0442\u043e\u0447\u043a\u0430 (\u0437\u0430\u043f\u044f\u0442\u0430\u044f) \\ BIT \u0444\u043b\u0430\u0433, \u0414\u0430 - 1 \u0438\u043b\u0438 \u041d\u0435\u0442 - 0 \\ DATE \u0444\u043e\u0440\u043c\u0430\u0442 \u0434\u0430\u0442\u044b, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 25.05.2023 \\ TIME 23:30:55.1234567 \\ DATETIME 25.05.2023 23:30:55.1234567 DATABASE SHOW databases; # \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u0441\u043f\u0438\u0441\u043e\u043a \u0411\u0414 CREATE DATABASE db_aduser; # \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0411\u0414 CREATE DATABASE db_rep DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci; # \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0411\u0414 \u0441 \u043a\u043e\u0434\u0438\u0440\u043e\u0432\u043a\u043e\u0439 UTF-8 DROP DATABASE db_rep; # \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0411\u0414 USE db_aduser; # \u0432\u044b\u0431\u0440\u0430\u0442\u044c/\u043f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f \u043d\u0430 \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u0443\u044e \u0411\u0414 SELECT database(); # \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u0443\u044e \u0411\u0414 USER SELECT USER,HOST FROM mysql.user; # \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u0441\u043f\u0438\u0441\u043e\u043a \u0423\u0417 CREATE USER posh@localhost IDENTIFIED BY '1qaz!QAZ'; # \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0423\u0417, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u0431\u0443\u0434\u0435\u0442 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0430\u0442\u044c\u0441\u044f \u0441 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u043e\u0433\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u0430 CREATE USER posh@localhost IDENTIFIED BY '1qaz!QAZ'; # \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0423\u0417, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u0431\u0443\u0434\u0435\u0442 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0430\u0442\u044c\u0441\u044f \u0441 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0433\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u0430 CREATE USER posh@'192.168.3.99' IDENTIFIED BY '1qaz!QAZ'; # \u0423\u0417 \u0434\u043b\u044f \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u0441 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0433\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u0430 CREATE USER 'admin'@'%' IDENTIFIED BY 'Admin12#'; # \u0423\u0417 \u0434\u043b\u044f \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u0441 \u043b\u044e\u0431\u043e\u0433\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u0430 (% - wildcard) DROP USER posh@localhost; # \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f SHOW GRANTS FOR posh@'%'; # \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043f\u0440\u0430\u0432\u0430 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f GRANT ALL PRIVILEGES ON db_aduser.* TO posh@'192.168.3.99'; # \u043f\u043e\u043b\u043d\u044b\u0439 \u0434\u043e\u0441\u0442\u0443\u043f \u0434\u043b\u044f posh \u043a \u0411\u0414 db_aduser GRANT ALL PRIVILEGES ON *.* TO posh@'%'; # \u0434\u043e\u0441\u0442\u0443\u043f \u043a \u0432\u0441\u0435\u043c \u0411\u0414 c \u043b\u044e\u0431\u043e\u0433\u043e \u043a\u043b\u0438\u0435\u043d\u0442\u0441\u043a\u043e\u0433\u043e \u0445\u043e\u0441\u0442\u0430 GRANT SELECT,DELETE ON mysql.* TO posh@'%'; # \u043f\u0440\u0430\u0432\u0430 SELECT \u0438 DELETE \u043d\u0430 \u0432\u0441\u0442\u0440\u043e\u0435\u043d\u043d\u0443\u044e \u0411\u0414 mysql REVOKE DELETE ON mysql.* FROM posh@'%'; # \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0434\u043e\u0441\u0442\u0443\u043f DELETE UPDATE mysql.user SET super_priv='Y' WHERE USER='posh' AND host='%'; # \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u0440\u0438\u0432\u0435\u043b\u0435\u0433\u0438\u0438 \u0434\u043b\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f SELECT USER,HOST,super_priv FROM mysql.user; # \u0441\u043f\u0438\u0441\u043e\u043a \u0423\u0417 \u0438 \u0442\u0430\u0431\u043b\u0438\u0446\u0430 \u0441 \u043f\u0440\u0430\u0432\u0430\u043c\u0438 SUPER privilege FLUSH PRIVILEGES; # \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u043f\u0440\u0430\u0432\u0430 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 TABLE SHOW TABLES; # \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u0442\u0430\u0431\u043b\u0438\u0446 SHOW TABLES LIKE '%user'; # \u043f\u043e\u0438\u0441\u043a \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u043f\u043e wildcard-\u0438\u043c\u0435\u043d\u0438 CREATE TABLE table_aduser (id INT NOT NULL AUTO_INCREMENT, Name VARCHAR(100), email VARCHAR(100), PRIMARY KEY (ID)); # \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0442\u0430\u0431\u043b\u0438\u0446\u0443 DROP TABLE table_aduser; # \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0442\u0430\u0431\u043b\u0438\u0446\u0443 COLUMN SHOW COLUMNS FROM table_aduser; # \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0441\u0442\u043e\u0431\u0446\u043e\u0432 \u0438 \u0438\u0445 \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430 ALTER TABLE table_aduser DROP COLUMN id; # \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u0442\u043e\u043b\u0431\u0435\u0446 id ALTER TABLE table_aduser ADD COLUMN info VARCHAR(10); # \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0441\u0442\u043e\u043b\u0431\u0435\u0446 info ALTER TABLE table_aduser CHANGE info new_info VARCHAR(100); # \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0438\u043c\u044f \u0441\u0442\u043e\u043b\u0431\u0446\u0430 info \u043d\u0430 new_info \u0438 \u0435\u0433\u043e \u0442\u0438\u043f \u0434\u0430\u043d\u043d\u044b\u0445 ALTER TABLE table_aduser ADD COLUMN (id INT NOT NULL AUTO_INCREMENT, PRIMARY KEY (ID)); # \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0441\u0442\u043e\u043b\u0431\u0435\u0446 id INSERT INSERT table_aduser (Name,email) VALUES ('Alex','no-email'); INSERT table_aduser (Name,email) VALUES ('Alex','no-email'); INSERT table_aduser (Name) VALUES ('Support'); INSERT table_aduser (Name) VALUES ('Jack'); SELECT SELECT * FROM table_aduser; # \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u0432\u0441\u0435\u0445 \u0441\u0442\u043e\u0431\u0446\u043e\u0432 \u0432 \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u043e\u0439 (FROM) \u0442\u0430\u0431\u043b\u0438\u0446\u0435 SELECT Name,email FROM table_aduser; # \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u0445 \u0441\u0442\u043e\u0431\u0446\u043e\u0432 SELECT DISTINCT Name,Email FROM table_aduser; # \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0435 \u0437\u0430\u043f\u0438\u0441\u0438 (\u0431\u0435\u0437 \u043f\u043e\u0432\u0442\u043e\u0440\u0435\u043d\u0438\u0439) SELECT * FROM table_aduser ORDER BY Name; # \u043e\u0442\u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u043e Name SELECT * FROM table_aduser ORDER BY Name DESC; # \u043e\u0431\u0440\u0430\u0442\u043d\u0430\u044f \u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0430 SELECT COUNT(*) FROM table_aduser; # \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0441\u0442\u0440\u043e\u043a \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0435 SELECT COUNT(new_info) FROM table_aduser; # \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0441\u0442\u0440\u043e\u043a \u0432 \u0441\u0442\u043e\u043b\u0431\u0446\u0435 WHERE NOT; AND; OR # \u043f\u043e \u043f\u0440\u0438\u043e\u0440\u0438\u0442\u0435\u0442\u0430\u043c \u0443\u0441\u043b\u043e\u0432\u0438\u0439 SELECT * FROM table_aduser WHERE Name = 'Alex'; # \u043f\u043e\u0438\u0441\u043a \u043f\u043e \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u043c\u0443 SELECT * FROM table_aduser WHERE NOT Name != 'Alex'; # \u0443\u0441\u043b\u043e\u0432\u0438\u0435 NOT \u0433\u0434\u0435 Name \u043d\u0435 \u0440\u0430\u0432\u0435\u043d \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044e SELECT * FROM table_aduser WHERE email != ''; # \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u0441\u0442\u0440\u043e\u043a\u0438, \u0433\u0434\u0435 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 email \u043d\u0435 \u0440\u0430\u043d\u043e null SELECT * FROM table_aduser WHERE email != '' OR id > 1000; # \u0438\u043b\u0438 id \u0432\u044b\u0448\u0435 1000 SELECT * FROM table_aduser WHERE Name RLIKE \"support\"; # \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u043e\u043d\u0435\u0437\u0430\u0432\u0438\u0441\u0435\u043c\u044b\u0439 (RLIKE) \u043f\u043e\u0438\u0441\u043a SELECT * FROM table_aduser WHERE Name RLIKE \"^support\"; # \u043d\u0430\u0447\u0438\u043d\u0430\u044e\u0442\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u0441 \u044d\u0442\u043e\u0433\u043e \u0441\u043b\u043e\u0432\u043e\u0441\u043e\u0447\u0435\u0442\u0430\u043d\u0438\u044f DELETE SELECT * FROM table_aduser WHERE Name RLIKE \"alex\"; # \u043d\u0430\u0439\u0442\u0438 \u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u043f\u0435\u0440\u0435\u0434 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u0435\u043c DELETE FROM table_aduser WHERE Name RLIKE \"alex\"; # Query OK, 2 rows affected # \u0443\u0434\u0430\u043b\u0435\u043d\u043e \u0434\u0432\u0435 \u0441\u0442\u0440\u043e\u043a\u0438 DELETE FROM table_aduser; # \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0412\u0421\u0415 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f UPDATE SELECT * FROM table_aduser WHERE Name = 'Jack'; # \u043d\u0430\u0439\u0442\u0438 \u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u0435\u0440\u0435\u0434 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435\u043c UPDATE table_aduser SET Name = 'Alex' WHERE Name = 'Jack'; # \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 'Jack' \u043d\u0430 'Alex' UPDATE db_aduser.table_aduser SET Name='BCA' WHERE id=1; # \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0432 \u0441\u0442\u0440\u043e\u043a\u0435 \u0441 ID 1 CHECK CHECK TABLE db_aduser.table_aduser; # \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c ANALYZE TABLE db_aduser.table_aduser; # \u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c OPTIMIZE TABLE db_aduser.table_aduser; # \u043e\u043f\u0442\u0438\u043c\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c REPAIR TABLE db_aduser.table_aduser; # \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c TRUNCATE TABLE db_aduser.table_aduser; # \u043e\u0447\u0438\u0441\u0442\u0438\u0442\u044c DUMP mysqldump -u root -p --databases db_aduser > /bak/db_aduser.sql mysql -u root -p db_aduser < /bak/db_aduser.sql crontab -e 00 22 * * * /usr/bin/mysqldump -uroot -p1qaz!QAZ db_zabbix | /bin/bzip2 > `date +/dump/zabbix/zabbix-\\%d-\\%m-\\%Y-\\%H:\\%M.bz2` 00 23 * * * /usr/bin/mysqldump -uroot -p1qaz!QAZ db_zabbix > `date +/dump/smb/zabbix-\\%d-\\%m-\\%Y-\\%H:\\%M.sql` 0 0 * * * find /dump/zabbix -mtime +7 -exec rm {} \\; mysqldump -u root --single-transaction db_zabbix > /dump/zabbix/db_zabbix.sql mysql -u user_zabbix -p -e 'CREATE DATABASE db_zabbix;' mysql -u user_zabbix -p db_zabbix < /root/db_zabbix.sql innodb_force_recovery sed -i '/innodb_force_recovery/d' /etc/mysql/my.cnf # \u0443\u0434\u0430\u043b\u0438\u0442\u044c mode=6; sed -i \"/^\\[mysqld\\]/{N;s/$/\\ninnodb_force_recovery=$mode/}\" /etc/mysql/my.cnf # \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c mode 6 systemctl restart mysql [mysqld] innodb_force_recovery=1 # \u0441\u0435\u0440\u0432\u0435\u0440 \u043f\u044b\u0442\u0430\u0435\u0442\u0441\u044f \u043d\u0430\u0447\u0430\u0442\u044c \u0440\u0430\u0431\u043e\u0442\u0443 \u043d\u0435\u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e \u043e\u0442 \u0442\u043e\u0433\u043e, \u0435\u0441\u0442\u044c \u043b\u0438 \u043f\u043e\u0432\u0440\u0435\u0436\u0434\u0435\u043d\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 InnoDB \u0438\u043b\u0438 \u043d\u0435\u0442 innodb_force_recovery=2 # \u0443\u0434\u0430\u0435\u0442\u0441\u044f \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0440\u0430\u0431\u043e\u0442\u0443 \u0437\u0430 \u0441\u0447\u0435\u0442 \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \u043f\u043e\u0442\u043e\u043a\u0430 \u043a\u043e\u043c\u0430\u043d\u0434, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0431\u044b\u043b\u0438 \u0447\u0430\u0441\u0442\u0438\u0447\u043d\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u044b \u0438\u043b\u0438 \u043d\u0435 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u044b (\u043d\u0435 \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u0442 \u0444\u043e\u043d\u043e\u0432\u044b\u0435 \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0438) innodb_force_recovery=3 # \u043e\u0442\u043c\u0435\u043d\u044f\u0435\u0442 \u043e\u0442\u043a\u0430\u0442 \u043f\u043e\u0441\u043b\u0435 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u043f\u043e\u0432\u0440\u0435\u0436\u0434\u0435\u043d\u043d\u044b\u0445 \u0444\u0430\u0439\u043b\u043e\u0432 (\u043d\u0435 \u043f\u044b\u0442\u0430\u0435\u0442\u0441\u044f \u043e\u0442\u043a\u0430\u0442\u0438\u0442\u044c \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438) innodb_force_recovery=6 # \u0437\u0430\u043f\u0443\u0441\u043a \u0421\u0423\u0411\u0414 \u0432 \u0440\u0435\u0436\u0438\u043c\u0435 read only MySQL Connector NET Add-ADUser $ip = \"192.168.1.253\" $user = \"posh\" $pass = \"1qaz!QAZ\" $db = \"db_aduser\" Add-Type \u2013Path \"$home\\Documents\\MySQL-Connector-NET\\8.0.31-4.8\\MySql.Data.dll\" $Connection = [MySql.Data.MySqlClient.MySqlConnection]@{ ConnectionString=\"server=$ip;uid=$user;pwd=$pass;database=$db\" } $Connection.Open() $Command = New-Object MySql.Data.MySqlClient.MySqlCommand $Command.Connection = $Connection $UserList = Get-ADUser -filter * -properties name,EmailAddress foreach ($user in $UserList) { $uname=$user.Name $uemail=$user.EmailAddress $Command.CommandText = \"INSERT INTO table_aduser (Name,Email) VALUES ('$uname','$uemail')\" $Command.ExecuteNonQuery() } $Connection.Close() Get-ADUser $ip = \"192.168.1.253\" $user = \"posh\" $pass = \"1qaz!QAZ\" $db = \"db_aduser\" Add-Type \u2013Path \"$home\\Documents\\MySQL-Connector-NET\\8.0.31-4.8\\MySql.Data.dll\" $Connection = [MySql.Data.MySqlClient.MySqlConnection]@{ ConnectionString = \"server=$ip;uid=$user;pwd=$pass;database=$db\" } $Connection.Open() $Command = New-Object MySql.Data.MySqlClient.MySqlCommand $Command.Connection = $Connection $MYSQLDataAdapter = New-Object MySql.Data.MySqlClient.MySqlDataAdapter $MYSQLDataSet = New-Object System.Data.DataSet $Command.CommandText = \"SELECT * FROM table_aduser\" $MYSQLDataAdapter.SelectCommand = $Command $NumberOfDataSets = $MYSQLDataAdapter.Fill($MYSQLDataSet, \"data\") $Collections = New-Object System.Collections.Generic.List[System.Object] foreach($DataSet in $MYSQLDataSet.tables[0]) { $Collections.Add([PSCustomObject]@{ Name = $DataSet.name; Mail = $DataSet.email }) } $Connection.Close() $Collections MSSQL wget -qO- https://packages.microsoft.com/keys/microsoft.asc | apt-key add - \u0438\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c GPG-\u043a\u043b\u044e\u0447 \u0434\u043b\u044f \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u044f \\ https://packages.microsoft.com/config/ubuntu/ \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u0439 \u0438 \u0441\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c URL \\ add-apt-repository \"$(wget -qO- https://packages.microsoft.com/config/ubuntu/20.04/mssql-server-2019.list)\" \\ apt-get update \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u0430\u043a\u0435\u0442\u043e\u0432 \\ apt-get install mssql-server \\ /opt/mssql/bin/mssql-conf setup \u0441\u043a\u0440\u0438\u043f\u0442 \u043d\u0430\u0447\u0430\u043b\u044c\u043d\u043e\u0439 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438 (\u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0440\u0435\u0434\u0430\u043a\u0446\u0438\u044e, 3 - express \u0438 \u0440\u0443\u0441\u0441\u043a\u0438\u0439 \u044f\u0437\u044b\u043a 9 \u0438\u0437 11) \\ systemctl status mssql-server \\ curl https://packages.microsoft.com/keys/microsoft.asc | apt-key add - \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043a\u043b\u0438\u0435\u043d\u0442 \\ curl https://packages.microsoft.com/config/ubuntu/20.04/prod.list | tee /etc/apt/sources.list.d/msprod.list \\ apt-get update \\ apt-get install mssql-tools \\ echo 'export PATH=\"$PATH:/opt/mssql-tools/bin\"' >> ~/.bashrc \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u0434\u043e\u043c\u0430\u0448\u043d\u0438\u0439 \u043a\u0430\u0442\u0430\u043b\u043e\u0433 \u0444\u0430\u0439\u043b\u0430 bashrc, \u0447\u0442\u043e \u0431\u044b \u043d\u0435 \u043f\u0438\u0441\u0430\u0442\u044c \u043f\u0443\u0442\u044c \u043a \u0438\u0441\u043f\u043e\u043b\u043d\u044f\u0435\u043c\u043e\u043c\u0443 \u0444\u0430\u0439\u043b\u0443 \\ export PATH=\"$PATH:/opt/mssql-tools/bin\" \\ iptables -I INPUT 1 -p tcp --dport 1433 -j ACCEPT sqlcmd -S localhost -U SA CREATE DATABASE itinvent go SELECT name FROM master.dbo.sysdatabases go System.Data.SqlClient $user = \"itinvent\" $pass = \"itinvent\" $db = \"itinvent\" $srv = \"192.168.3.103\" $SqlConnection = New-Object System.Data.SqlClient.SqlConnection $SqlConnection.ConnectionString = \"server=$srv;database=$db;user id=$user;password=$pass;Integrated Security=false\" $SqlCommand = New-Object System.Data.SqlClient.SqlCommand` \u043a\u043b\u0430\u0441\u0441 \u0444\u043e\u0440\u043c\u0430\u0442\u0430 \u043a\u043e\u043c\u0430\u043d\u0434\u044b $SqlCommand.CommandText = \"SELECT * FROM ITINVENT.dbo.USERS\"` \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b #$SqlCommand.CommandText = \"SELECT LICENCE_DATE,DESCR,MODEL_NO,TYPE_NO FROM ITINVENT.dbo.ITEMS where LICENCE_DATE IS NOT NULL\" $SqlCommand.Connection = $SqlConnection` \u043f\u0435\u0440\u0435\u0434\u0430\u0442\u044c \u0444\u043e\u0440\u043c\u0430\u0442 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f $SqlAdapter = New-Object System.Data.SqlClient.SqlDataAdapter` \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0430\u0434\u0430\u043f\u0442\u0435\u0440 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u0434\u043b\u044f \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f SELECT \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 \u043a \u0411\u0414 $SqlAdapter.SelectCommand = $SqlCommand` \u043f\u0435\u0440\u0435\u0434\u0430\u0442\u044c \u043a\u043e\u043c\u0430\u043d\u0434\u0443 $DataSet = New-Object System.Data.DataSet` \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043e\u0431\u044a\u0435\u043a\u0442 \u043f\u0440\u0438\u0435\u043c\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 \u0444\u043e\u0440\u043c\u0430\u0442\u0430 XML $SqlAdapter.Fill($DataSet)` \u0437\u0430\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u043c\u0438 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u043d\u044b\u0435 \u043e\u0442 \u0430\u0434\u0430\u043f\u0442\u0435\u0440\u0430 (\u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u043a\u043e\u043b-\u0432\u043e \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432) $SqlConnection.Close() $Data = $DataSet.Tables $Data[0] | ft SqlClient INSERT $user = \"itinvent\" $pass = \"itinvent\" $db = \"db_test\" $srv = \"192.168.3.103\" $sql = \"INSERT INTO table_test (column_user) VALUES ('lifailon')\"` \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0443 table_test \u0432 \u043a\u043e\u043b\u043e\u043d\u043a\u0443 column_user $SqlConnection = New-Object System.Data.SqlClient.SqlConnection $SqlConnection.ConnectionString = \"server=$srv;database=$db;user id=$user;password=$pass;Integrated Security=false\" $SqlCommand = New-Object System.Data.SqlClient.SqlCommand $SqlCommand.CommandText = $sql $SqlCommand.Connection = $SqlConnection $SqlConnection.Open() $rowsAffected = $SqlCommand.ExecuteNonQuery();` \u0434\u043b\u044f \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 INSERT/UPDATE/DELETE \u043d\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f SqlDataAdapter $SqlConnection.Close() SSMS INSERT USE [db_test] GO INSERT INTO [dbo].[table_test] ([column_user]) VALUES ('lifailon') GO SELECT TOP (1000) [column_user] FROM [db_test].[dbo].[table_test] T-SQL DDL (Data Definition Language / \u042f\u0437\u044b\u043a \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u044f \u0434\u0430\u043d\u043d\u044b\u0445). \u041a \u044d\u0442\u043e\u043c\u0443 \u0442\u0438\u043f\u0443 \u043e\u0442\u043d\u043e\u0441\u044f\u0442\u0441\u044f \u043a\u043e\u043c\u0430\u043d\u0434\u044b, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0441\u043e\u0437\u0434\u0430\u044e\u0442 \u0431\u0430\u0437\u0443 \u0434\u0430\u043d\u043d\u044b\u0445, \u0442\u0430\u0431\u043b\u0438\u0446\u044b, \u0438\u043d\u0434\u0435\u043a\u0441\u044b, \u0445\u0440\u0430\u043d\u0438\u043c\u044b\u0435 \u043f\u0440\u043e\u0446\u0435\u0434\u0443\u0440\u044b. \\ CREATE \u0441\u043e\u0437\u0434\u0430\u0435\u0442 \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 (\u0441\u0430\u043c\u0443 \u0431\u0430\u0437\u0443 \u0434\u0430\u043d\u044b\u0445, \u0442\u0430\u0431\u043b\u0438\u0446\u044b, \u0438\u043d\u0434\u0435\u043a\u0441\u044b \u0438 \u0442.\u0434.) \\ ALTER \u0438\u0437\u043c\u0435\u043d\u044f\u0435\u0442 \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 \\ DROP \u0443\u0434\u0430\u043b\u044f\u0435\u0442 \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 \\ TRUNCATE \u0443\u0434\u0430\u043b\u044f\u0435\u0442 \u0432\u0441\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0438\u0437 \u0442\u0430\u0431\u043b\u0438\u0446 DML (Data Manipulation Language / \u042f\u0437\u044b\u043a \u043c\u0430\u043d\u0438\u043f\u0443\u043b\u044f\u0446\u0438\u0438 \u0434\u0430\u043d\u043d\u044b\u043c\u0438). \u041a \u044d\u0442\u043e\u043c\u0443 \u0442\u0438\u043f\u0443 \u043e\u0442\u043d\u043e\u0441\u044f\u0442 \u043a\u043e\u043c\u0430\u043d\u0434\u044b \u043f\u043e \u0432\u044b\u0431\u043e\u0440\u0443, \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044e, \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u044e \u0438 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u044e \u0434\u0430\u043d\u043d\u044b\u0445. \\ SELECT \u0438\u0437\u0432\u043b\u0435\u043a\u0430\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0435 \u0438\u0437 \u0411\u0414 \\ UPDATE \u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0435 \\ INSERT \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442 \u043d\u043e\u0432\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \\ DELETE \u0443\u0434\u0430\u043b\u044f\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0435 DCL (Data Control Language / \u042f\u0437\u044b\u043a \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043a \u0434\u0430\u043d\u043d\u044b\u043c). \u041a \u044d\u0442\u043e\u043c\u0443 \u0442\u0438\u043f\u0443 \u043e\u0442\u043d\u043e\u0441\u044f\u0442 \u043a\u043e\u043c\u0430\u043d\u0434\u044b, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0442 \u043f\u0440\u0430\u0432\u0430\u043c\u0438 \u043f\u043e \u0434\u043e\u0441\u0442\u0443\u043f\u0443 \u043a \u0434\u0430\u043d\u043d\u044b\u043c. \\ GRANT \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 \u043f\u0440\u0430\u0432\u0430 \u0434\u043b\u044f \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043a \u0434\u0430\u043d\u043d\u044b\u043c \\ REVOKE \u043e\u0442\u0437\u044b\u0432\u0430\u0435\u0442 \u043f\u0440\u0430\u0432\u0430 \u043d\u0430 \u0434\u043e\u0441\u0442\u0443\u043f \u043a \u0434\u0430\u043d\u043d\u044b\u043c -- \u041f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 DECLARE @text NVARCHAR(20), @int INT; SET @text='Test'; SET @int = 21; select @text,@int -- \u0418\u043c\u0435\u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u0438 \u044d\u043a\u0437\u0435\u043c\u043f\u043b\u044f\u0440\u0430 Select @@SERVERNAME as [Server\\Instance]; -- \u0432\u0435\u0440\u0441\u0438\u044f SQL Server Select @@VERSION as SQLServerVersion; -- \u0422\u0435\u043a\u0443\u0449\u0430\u044f \u0411\u0414 (\u0411\u0414, \u0432 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u0435 \u043a\u043e\u0442\u043e\u0440\u043e\u0439 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \u0437\u0430\u043f\u0440\u043e\u0441) Select DB_NAME() AS CurrentDB_Name; -- \u0412\u0440\u0435\u043c\u044f \u0440\u0430\u0431\u043e\u0442\u044b \u0441 \u043c\u043e\u043c\u0435\u043d\u0442\u0430 \u0437\u0430\u043f\u0443\u0441\u043a\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 SELECT @@Servername AS ServerName , create_date AS ServerStarted , DATEDIFF(s, create_date, GETDATE()) / 86400.0 AS DaysRunning , DATEDIFF(s, create_date, GETDATE()) AS SecondsRunnig FROM sys.databases WHERE name = 'tempdb'; -- \u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0445 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0439 SELECT @@Servername AS Server , DB_NAME(database_id) AS DatabaseName , COUNT(database_id) AS Connections , Login_name AS LoginName , MIN(Login_Time) AS Login_Time , MIN(COALESCE(last_request_end_time, last_request_start_time)) AS Last_Batch FROM sys.dm_exec_sessions WHERE database_id > 0 AND DB_NAME(database_id) NOT IN ( 'master', 'msdb' ) GROUP BY database_id , login_name ORDER BY DatabaseName; -- \u0421\u0442\u0430\u0442\u0443\u0441 Backup SELECT @@Servername AS ServerName , d.Name AS DBName , MAX(b.backup_finish_date) AS LastBackupCompleted FROM sys.databases d LEFT OUTER JOIN msdb..backupset b ON b.database_name = d.name AND b.[type] = 'D' GROUP BY d.Name ORDER BY d.Name; -- \u041f\u0443\u0442\u044c \u043a Backup SELECT @@Servername AS ServerName , d.Name AS DBName , b.Backup_finish_date , bmf.Physical_Device_name FROM sys.databases d INNER JOIN msdb..backupset b ON b.database_name = d.name AND b.[type] = 'D' INNER JOIN msdb.dbo.backupmediafamily bmf ON b.media_set_id = bmf.media_set_id ORDER BY d.NAME , b.Backup_finish_date DESC; -- \u0412\u044b\u0432\u0435\u0441\u0442\u0438 \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u0411\u0414, \u043c\u043e\u0434\u0435\u043b\u0438 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0438 \u043f\u0443\u0442\u044c \u043a mdf/ldf EXEC sp_helpdb; SELECT @@SERVERNAME AS Server , d.name AS DBName , create_date , recovery_model_Desc AS RecoveryModel , m.physical_name AS FileName FROM sys.databases d JOIN sys.master_files m ON d.database_id = m.database_id ORDER BY d.name; -- \u0420\u0430\u0437\u043c\u0435\u0440 \u0411\u0414 with fs as ( select database_id, type, size * 8.0 / 1024 size from sys.master_files ) select name, (select sum(size) from fs where type = 0 and fs.database_id = db.database_id) DataFileSizeMB, (select sum(size) from fs where type = 1 and fs.database_id = db.database_id) LogFileSizeMB from sys.databases -- \u041f\u043e\u0438\u0441\u043a \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u043f\u043e \u043c\u0430\u0441\u043a\u0435 \u0438\u043c\u0435\u043d\u0438 (\u0432\u044b\u0432\u043e\u0434: \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044f \u0441\u0445\u0435\u043c\u044b \u0433\u0434\u0435 \u0440\u0430\u0441\u043f\u043e\u043b\u043e\u0433\u0430\u0435\u0442\u0441\u044f \u043e\u0431\u044a\u0435\u043a\u0442, \u0442\u0438\u043f \u043e\u0431\u044a\u0435\u043a\u0442\u0430, \u0434\u0430\u0442\u0430 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f \u0438 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0439 \u043c\u043e\u0434\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438): select [object_id], [schema_id], schema_name([schema_id]) as [schema_name], [name], [type], [type_desc], [create_date], [modify_date] from sys.all_objects -- where [name]='INVENT'; where [name] like '%INVENT%'; -- \u041a\u043e\u043b-\u0432\u043e \u0441\u0442\u0440\u043e\u043a \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0430\u0445 SELECT @@ServerName AS Server , DB_NAME() AS DBName , OBJECT_SCHEMA_NAME(p.object_id) AS SchemaName , OBJECT_NAME(p.object_id) AS TableName , i.Type_Desc , i.Name AS IndexUsedForCounts , SUM(p.Rows) AS Rows FROM sys.partitions p JOIN sys.indexes i ON i.object_id = p.object_id AND i.index_id = p.index_id WHERE i.type_desc IN ( 'CLUSTERED', 'HEAP' ) -- This is key (1 index per table) AND OBJECT_SCHEMA_NAME(p.object_id) <> 'sys' GROUP BY p.object_id , i.type_desc , i.Name ORDER BY SchemaName , TableName; -- \u041d\u0430\u0439\u0442\u0438 \u0441\u0442\u0440\u043e\u043a\u043e\u0432\u043e\u0435 (nvarchar) \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 2023 \u043f\u043e \u0432\u0441\u0435\u043c \u0442\u0430\u0431\u043b\u0438\u0446\u0430\u043c \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 -- \u041e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u0442\u0441\u044f \u0432 \u043a\u0430\u043a\u043e\u0439 \u0442\u0430\u0431\u043b\u0438\u0446\u0435 \u0438 \u0441\u0442\u043e\u043b\u0431\u0446\u0435 \u0445\u0440\u0430\u043d\u0438\u0442\u0441\u044f \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435, \u0430 \u0442\u0430\u043a\u0436\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043d\u0430\u0439\u0434\u0435\u043d\u043d\u044b\u0445 \u043f\u0430\u0440\u044b \u0442\u0430\u0431\u043b\u0438\u0446\u0430-\u043a\u043e\u043b\u043e\u043d\u043a\u0430 set nocount on declare @name varchar(128), @substr nvarchar(4000), @column varchar(128) set @substr = '%2023%' declare @sql nvarchar(max); create table`rslt (table_name varchar(128), field_name varchar(128), [value] nvarchar(max)) declare s cursor for select table_name as table_name from information_schema.tables where table_type = 'BASE TABLE' order by table_name open s fetch next from s into @name while @@fetch_status = 0 begin declare c cursor for select quotename(column_name) as column_name from information_schema.columns where data_type in ('text', 'ntext', 'varchar', 'char', 'nvarchar', 'char', 'sysname', 'int', 'tinyint') and table_name = @name set @name = quotename(@name) open c fetch next from c into @column while @@fetch_status = 0 begin --print 'Processing table - ' + @name + ', column - ' + @column set @sql='insert into`rslt select ''' + @name + ''' as Table_name, ''' + @column + ''', cast(' + @column + ' as nvarchar(max)) from' + @name + ' where cast(' + @column + ' as nvarchar(max)) like ''' + @substr + ''''; print @sql; exec(@sql); fetch next from c into @column; end close c deallocate c fetch next from s into @name end select table_name as [Table Name], field_name as [Field Name], count(*) as [Found Mathes] from`rslt group by table_name, field_name order by table_name, field_name drop table`rslt close s deallocate s -- \u041f\u043e\u0438\u0441\u043a \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0435 [CI_HISTORY] \u0438 \u0441\u0442\u043e\u043b\u0431\u0446\u0443 [HIST_ID]: SELECT * FROM ITINVENT.dbo.CI_HISTORY where [HIST_ID] like '%2023%'; -- \u0423\u0437\u043d\u0430\u0442\u044c \u0444\u0440\u0430\u0433\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044e \u0438\u043d\u0434\u0435\u043a\u0441\u043e\u0432 DECLARE @db_id SMALLINT; SET @db_id = DB_ID(N'itinvent'); IF @db_id IS NULL BEGIN; PRINT N'\u041d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u0435 \u0438\u043c\u044f \u0431\u0430\u0437\u044b'; END; ELSE BEGIN; SELECT object_id AS [ID \u043e\u0431\u044a\u0435\u043a\u0442\u0430], index_id AS [ID \u0438\u043d\u0434\u0435\u043a\u0441\u0430], index_type_desc AS [\u0422\u0438\u043f \u0438\u043d\u0434\u0435\u043a\u0441\u0430], avg_fragmentation_in_percent AS [\u0424\u0440\u0430\u0433\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044f \u0432 %] FROM sys.dm_db_index_physical_stats(@db_id, NULL, NULL, NULL , 'LIMITED') ORDER BY [avg_fragmentation_in_percent] DESC; END; GO -- TempDB -- Initial size - \u043d\u0430\u0447\u0430\u043b\u044c\u043d\u044b\u0439/\u043c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439 \u0440\u0430\u0437\u043c\u0435\u0440 \u0411\u0414 (1024 MB) -- Autogrowh - \u043f\u0440\u0438\u0440\u043e\u0441\u0442 (512MB) -- \u041f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e tempdb \u043d\u0430\u0441\u0442\u0440\u043e\u0435\u043d\u0430 \u043d\u0430 \u0430\u0432\u0442\u043e-\u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u0435 (Autogrow) \u0438 \u043f\u0440\u0438 \u043a\u0430\u0436\u0434\u043e\u0439 \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0435 SQL Server \u043f\u0435\u0440\u0435\u0441\u043e\u0437\u0434\u0430\u0451\u0442 \u0444\u0430\u0439\u043b\u044b \u044d\u0442\u043e\u0439 \u0411\u0414 \u0441 \u043c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u043c \u0440\u0430\u0437\u043c\u0435\u0440\u043e\u043c \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438. -- \u0423\u0432\u0435\u043b\u0438\u0447\u0438\u0432 \u0440\u0430\u0437\u043c\u0435\u0440 \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 \u0444\u0430\u0439\u043b\u043e\u0432 tempdb, \u043c\u043e\u0436\u043d\u043e \u0441\u0432\u0435\u0441\u0442\u0438 \u043a \u043c\u0438\u043d\u0438\u043c\u0443\u043c\u0443 \u0437\u0430\u0442\u0440\u0430\u0442\u044b \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u044b\u0445 \u0440\u0435\u0441\u0443\u0440\u0441\u043e\u0432 \u043d\u0430 \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0438 \u0430\u0432\u0442\u043e-\u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u044f. -- \u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u0443\u0442\u044c \u043a \u0411\u0414: USE master; GO ALTER DATABASE tempdb MODIFY FILE (NAME = tempdev, FILENAME = 'F:\\tempdb.mdf'); GO ALTER DATABASE tempdb MODIFY FILE (NAME = temp2, FILENAME = 'F:\\tempdb_mssql_2.ndf'); GO ALTER DATABASE tempdb MODIFY FILE (NAME = temp3, FILENAME = 'F:\\tempdb_mssql_3.ndf'); GO ALTER DATABASE tempdb MODIFY FILE (NAME = temp4, FILENAME = 'F:\\tempdb_mssql_4.ndf'); GO ALTER DATABASE tempdb MODIFY FILE (NAME = temp5, FILENAME = 'F:\\tempdb_mssql_5.ndf'); GO ALTER DATABASE tempdb MODIFY FILE (NAME = temp6, FILENAME = 'F:\\tempdb_mssql_6.ndf'); GO ALTER DATABASE tempdb MODIFY FILE (NAME = temp7, FILENAME = 'F:\\tempdb_mssql_7.ndf'); GO ALTER DATABASE tempdb MODIFY FILE (NAME = temp8, FILENAME = 'F:\\tempdb_mssql_8.ndf'); GO ALTER DATABASE tempdb MODIFY FILE (NAME = templog, FILENAME = 'F:\\templog.ldf'); GO -- \u0423\u043a\u0430\u0437\u0430\u0442\u044c \u0440\u0430\u0437\u043c\u0435\u0440 \u0444\u0430\u0439\u043b\u0430: MODIFY FILE (NAME = temp2, FILENAME = 'F:\\tempdb_mssql_2.ndf' , SIZE = 1048576KB , FILEGROWTH = 524288KB); \u0422\u0438\u043f \u0440\u0435\u0437\u0435\u0440\u0432\u043d\u043e\u0439 \u043a\u043e\u043f\u0438\u0438 Full (\u041f\u043e\u043b\u043d\u0430\u044f \u043a\u043e\u043f\u0438\u044f). \u041a\u043e\u0433\u0434\u0430 \u0441\u0442\u0430\u0440\u0442\u0443\u0435\u0442 \u043f\u043e\u043b\u043d\u043e\u0435 \u0440\u0435\u0437\u0435\u0440\u0432\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435, \u0437\u0430\u043f\u0438\u0441\u044b\u0432\u0430\u0435\u0442\u0441\u044f Log Sequence Number (LSN - \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u043d\u043e\u043c\u0435\u0440 \u0436\u0443\u0440\u043d\u0430\u043b\u0430), \u0430 \u0442\u0430\u043a \u0436\u0435 LSN \u0437\u0430\u043f\u0438\u0441\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u0438 \u043f\u0440\u0438 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u0438 \u043f\u043e\u043b\u043d\u043e\u0433\u043e \u0440\u0435\u0437\u0435\u0440\u0432\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f. \u042d\u0442\u043e\u0442 LSN \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043c\u0435\u0445\u0430\u043d\u0438\u0437\u043c\u043e\u043c, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c\u044b\u043c SQL Server, \u0447\u0442\u043e\u0431\u044b \u0437\u043d\u0430\u0442\u044c, \u0432 \u043a\u0430\u043a\u043e\u043c \u043f\u043e\u0440\u044f\u0434\u043a\u0435 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u043b\u0438\u0441\u044c \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u044b INSERT, UPDATE \u0438\u043b\u0438 DELETE. \u041f\u0440\u0438 \u044d\u0442\u043e\u043c \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0437\u0430\u043f\u0438\u0441\u0430\u043d\u043d\u044b\u0445 LSN \u043d\u0430\u0447\u0430\u043b\u0430 \u0438 \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u044f, \u043a\u0430\u043a \u0447\u0430\u0441\u0442\u0438 \u043f\u043e\u043b\u043d\u043e\u0433\u043e \u0431\u044d\u043a\u0430\u043f\u0430, \u043e\u0431\u0435\u0441\u043f\u0435\u0447\u0438\u0432\u0430\u0435\u0442 \u0441\u043e\u0433\u043b\u0430\u0441\u043e\u0432\u0430\u043d\u043d\u043e\u0435 \u0441 \u0442\u043e\u0447\u043a\u0438 \u0437\u0440\u0435\u043d\u0438\u044f \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439 \u0440\u0435\u0437\u0435\u0440\u0432\u043d\u043e\u0435 \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435, \u043f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443 \u043f\u0440\u0438 \u043f\u043e\u043b\u043d\u043e\u043c \u0440\u0435\u0437\u0435\u0440\u0432\u043d\u043e\u043c \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0438 \u0443\u0447\u0438\u0442\u044b\u0432\u0430\u044e\u0442\u0441\u044f \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f, \u043f\u0440\u043e\u0438\u0437\u043e\u0448\u0435\u0434\u0448\u0438\u0435 \u0432\u043e \u0432\u0440\u0435\u043c\u044f \u0440\u0435\u0437\u0435\u0440\u0432\u043d\u043e\u0433\u043e \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f. \u042d\u0442\u043e \u043e\u0431\u0435\u0441\u043f\u0435\u0447\u0438\u0432\u0430\u0435\u0442 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0443 \u0442\u0430\u043a\u0438\u0445 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439 \u0432 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0435 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0431\u044d\u043a\u0430\u043f\u0430. Differential (\u0434\u0438\u0444\u0444\u0435\u0440\u0435\u043d\u0446\u0438\u0430\u043b\u044c\u043d\u0430\u044f/\u0440\u0430\u0437\u043d\u043e\u0441\u0442\u043d\u0430\u044f \u043a\u043e\u043f\u0438\u044f). \u0425\u0440\u0430\u043d\u0438\u0442 \u0434\u0430\u043d\u043d\u044b\u0445, \u0438\u0437\u043c\u0435\u043d\u0438\u0432\u0448\u0438\u0435\u0441\u044f \u0441 \u043c\u043e\u043c\u0435\u043d\u0442\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0439 \u041f\u043e\u043b\u043d\u043e\u0439 \u0440\u0435\u0437\u0435\u0440\u0432\u043d\u043e\u0439 \u043a\u043e\u043f\u0438\u0438. \u041f\u0440\u0438 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0438 \u043d\u0443\u0436\u043d\u043e \u0441\u043d\u0430\u0447\u0430\u043b\u0430 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u041f\u043e\u043b\u043d\u0443\u044e \u0440\u0435\u0437\u0435\u0440\u0432\u043d\u0443\u044e \u043a\u043e\u043f\u0438\u044e \u0432 \u0440\u0435\u0436\u0438\u043c\u0435 NORECOVERY, \u043f\u043e\u0442\u043e\u043c \u043c\u043e\u0436\u043d\u043e \u043f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c \u043b\u044e\u0431\u0443\u044e \u0438\u0437 \u043f\u043e\u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0445 \u0420\u0430\u0437\u043d\u043e\u0441\u0442\u043d\u044b\u0445 \u043a\u043e\u043f\u0438\u0439, \u0431\u0435\u0437 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0435\u0439 \u041f\u043e\u043b\u043d\u043e\u0439 \u0440\u0435\u0437\u0435\u0440\u0432\u043d\u043e\u0439 \u043a\u043e\u043f\u0438\u0438 \u0420\u0430\u0437\u043d\u043e\u0441\u0442\u043d\u0430\u044f \u043a\u043e\u043f\u0438\u044f \u0431\u0435\u0441\u043f\u043e\u043b\u0435\u0437\u043d\u0430. \u041a\u0430\u0436\u0434\u0430\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0430\u044f \u0420\u0430\u0437\u043d\u043e\u0441\u0442\u043d\u0430\u044f \u043a\u043e\u043f\u0438\u044f \u0431\u0443\u0434\u0435\u0442 \u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0432\u0441\u0435 \u0434\u0430\u043d\u043d\u044b\u0435, \u0432\u0445\u043e\u0434\u044f\u0449\u0438\u0435 \u0432 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0443\u044e \u0420\u0430\u0437\u043d\u043e\u0441\u0442\u043d\u0443\u044e \u0440\u0435\u0437\u0435\u0440\u0432\u043d\u0443\u044e \u043a\u043e\u043f\u0438\u044e, \u0441\u0434\u0435\u043b\u0430\u043d\u043d\u0443\u044e \u043f\u043e\u0441\u043b\u0435 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0435\u0439 \u041f\u043e\u043b\u043d\u043e\u0439 \u043a\u043e\u043f\u0438\u0438. Incremental (\u0438\u043d\u043a\u0440\u0435\u043c\u0435\u043d\u0442\u0430\u043b\u044c\u043d\u0430\u044f/\u043a\u043e\u043f\u0438\u044f \u0436\u0443\u0440\u043d\u0430\u043b\u043e\u0432 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439). \u0420\u0435\u0437\u0435\u0440\u0432\u043d\u043e\u0435 \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0436\u0443\u0440\u043d\u0430\u043b\u0430 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439 \u043a\u043e\u043f\u0438\u0440\u0443\u0435\u0442 \u0432\u0441\u0435 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0438 \u0441 \u043c\u043e\u043c\u0435\u043d\u0442\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u0440\u0435\u0437\u0435\u0440\u0432\u043d\u043e\u0433\u043e \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f, \u0430 \u0437\u0430\u0442\u0435\u043c \u0443\u0440\u0435\u0437\u0430\u0435\u0442 \u0436\u0443\u0440\u043d\u0430\u043b \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439 \u0434\u043b\u044f \u043e\u0441\u0432\u043e\u0431\u043e\u0436\u0434\u0435\u043d\u0438\u044f \u0434\u0438\u0441\u043a\u043e\u0432\u043e\u0433\u043e \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u0430. \u0422\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438 \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u044f\u0442 \u0432 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043d\u043e\u043c \u043f\u043e\u0440\u044f\u0434\u043a\u0435 (LSN), \u0431\u044d\u043a\u0430\u043f \u0436\u0443\u0440\u043d\u0430\u043b\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442 \u044d\u0442\u043e\u0442 \u043f\u043e\u0440\u044f\u0434\u043e\u043a \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439. \u0411\u044d\u043a\u0430\u043f\u044b \u0436\u0443\u0440\u043d\u0430\u043b\u043e\u0432 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439 \u0434\u043e\u043b\u0436\u043d\u044b \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0442\u044c\u0441\u044f \u043f\u043e \u043f\u043e\u0440\u044f\u0434\u043a\u0443. \u0414\u043b\u044f \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 \u043f\u043e\u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0432\u0441\u044f \u0446\u0435\u043f\u043e\u0447\u043a\u0430 \u0440\u0435\u0437\u0435\u0440\u0432\u043d\u044b\u0445 \u043a\u043e\u043f\u0438\u0439: \u043f\u043e\u043b\u043d\u0430\u044f \u0438 \u0432\u0441\u0435 \u043f\u043e\u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0435 \u0438\u043d\u043a\u0440\u0435\u043c\u0435\u043d\u0442\u0430\u043b\u044c\u043d\u044b\u0435 \u0436\u0443\u0440\u043d\u0430\u043b\u0430 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439. \u041c\u043e\u0434\u0435\u043b\u0438 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f Simple (\u041f\u0440\u043e\u0441\u0442\u0430\u044f). \u0425\u0440\u0430\u043d\u0438\u0442\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u044b\u0439 \u0434\u043b\u044f \u0436\u0438\u0437\u043d\u0438 \u043e\u0441\u0442\u0430\u0442\u043e\u043a \u0436\u0443\u0440\u043d\u0430\u043b\u0430 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439. \u0416\u0443\u0440\u043d\u0430\u043b \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439 (\u043b\u043e\u0433) \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u043e\u0447\u0438\u0449\u0430\u0435\u0442\u0441\u044f. \u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0440\u0435\u0437\u0435\u0440\u0432\u043d\u044b\u0445 \u043a\u043e\u043f\u0438\u0439 \u0436\u0443\u0440\u043d\u0430\u043b\u0430 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439 \u043d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u0430, \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u043e\u0441\u0442\u0430\u0435\u0442\u0441\u044f \u0441\u0430\u043c\u043e\u0435 \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u043d\u043e\u0435 \u0447\u0438\u0441\u043b\u043e \u043e\u043f\u0446\u0438\u0439 \u043f\u043e \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044e. \u041d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d \u0444\u0443\u043d\u043a\u0446\u0438\u043e\u043d\u0430\u043b: Always On, Point-In-Time \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435, \u0420\u0435\u0437\u0435\u0440\u0432\u043d\u044b\u0435 \u043a\u043e\u043f\u0438\u0438 \u0436\u0443\u0440\u043d\u0430\u043b\u0430 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439. Full (\u041f\u043e\u043b\u043d\u0430\u044f). \u0425\u0440\u0430\u043d\u0438\u0442\u0441\u044f \u0436\u0443\u0440\u043d\u0430\u043b \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439 \u0432\u0441\u0435\u0445 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0439 \u0432 \u0411\u0414 \u0441 \u043c\u043e\u043c\u0435\u043d\u0442\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u0440\u0435\u0437\u0435\u0440\u0432\u043d\u043e\u0433\u043e \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0436\u0443\u0440\u043d\u0430\u043b\u0430 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439. \u0416\u0443\u0440\u043d\u0430\u043b \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439 \u043d\u0435 \u0431\u0443\u0434\u0435\u0442 \u043e\u0447\u0438\u0449\u0430\u0442\u044c\u0441\u044f \u0434\u043e \u0442\u0435\u0445 \u043f\u043e\u0440, \u043f\u043e\u043a\u0430 \u043d\u0435 \u0431\u0443\u0434\u0435\u0442 \u0441\u0434\u0435\u043b\u0430\u043d\u0430 \u0440\u0435\u0437\u0435\u0440\u0432\u043d\u0430\u044f \u043a\u043e\u043f\u0438\u044f \u0436\u0443\u0440\u043d\u0430\u043b\u0430 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439. Bulk logged (\u0421 \u043d\u0435\u043f\u043e\u043b\u043d\u044b\u043c \u043f\u0440\u043e\u0442\u043e\u043a\u043e\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435\u043c). \u0418\u0434\u0435\u043d\u0442\u0438\u0447\u043d\u0430 Full, \u0437\u0430 \u0438\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435: SELECT INTO, BULK INSERT \u0438 BCP, INSERT INTO SELECT, \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0438 \u0441 \u0438\u043d\u0434\u0435\u043a\u0441\u0430\u043c\u0438 (CREATE INDEX, ALTER INDEX REBUILD, DROP INDEX) \u0421\u0438\u0441\u0442\u0435\u043c\u043d\u044b\u0435 \u0411\u0414 master. \u0425\u0440\u0430\u043d\u044f\u0442\u0441\u044f \u0432\u0441\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u043e\u0433\u043e \u0443\u0440\u043e\u0432\u043d\u044f (\u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f \u0441\u0438\u0441\u0442\u0435\u043c\u044b, \u0441\u0432\u0435\u0434\u0435\u043d\u044c\u044f \u043e\u0431 \u0443\u0447\u0435\u0442\u043d\u044b\u0445 \u0437\u0430\u043f\u0438\u0441\u044f\u0445 \u0432\u0445\u043e\u0434\u0430, \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043e\u0431\u043e \u0432\u0441\u0435\u0445 \u0434\u0440\u0443\u0433\u0438\u0445 \u0431\u0430\u0437\u0430\u0445 \u0434\u0430\u043d\u043d\u044b\u0445) \u0434\u043b\u044f \u044d\u043a\u0437\u0435\u043c\u043f\u043b\u044f\u0440\u0430 SQL Server. tempdb. \u0420\u0430\u0431\u043e\u0447\u0435\u0435 \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u043e \u0434\u043b\u044f \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0445 \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432, \u0442\u0430\u043a\u0438\u0445 \u043a\u0430\u043a \u0433\u043b\u043e\u0431\u0430\u043b\u044c\u043d\u044b\u0435 \u0438\u043b\u0438 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u0435 \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b, \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \u0445\u0440\u0430\u043d\u0438\u043c\u044b\u0435 \u043f\u0440\u043e\u0446\u0435\u0434\u0443\u0440\u044b, \u0442\u0430\u0431\u043b\u0438\u0447\u043d\u044b\u0435 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \u0438 \u043a\u0443\u0440\u0441\u043e\u0440\u044b. \u041f\u0435\u0440\u0435\u0441\u043e\u0437\u0434\u0430\u0451\u0442\u0441\u044f \u043f\u0440\u0438 \u043a\u0430\u0436\u0434\u043e\u043c \u0437\u0430\u043f\u0443\u0441\u043a\u0435 SQL Server. model. \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0432 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435 \u0448\u0430\u0431\u043b\u043e\u043d\u0430 \u0434\u043b\u044f \u0432\u0441\u0435\u0445 \u0431\u0430\u0437 \u0434\u0430\u043d\u043d\u044b\u0445, \u0441\u043e\u0437\u0434\u0430\u0432\u0430\u0435\u043c\u044b\u0445 \u0432 \u044d\u043a\u0437\u0435\u043c\u043f\u043b\u044f\u0440\u0435 SQL Server, \u0432\u0441\u0435 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 model, \u0432\u043a\u043b\u044e\u0447\u0430\u044f \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445, \u043a\u043e\u043f\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u0432 \u0441\u043e\u0437\u0434\u0430\u0432\u0430\u0435\u043c\u0443\u044e \u0431\u0430\u0437\u0443 \u0434\u0430\u043d\u043d\u044b\u0445. \u0422\u0430\u043a \u043a\u0430\u043a \u0431\u0430\u0437\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 tempdb \u0441\u043e\u0437\u0434\u0430\u0435\u0442\u0441\u044f \u043a\u0430\u0436\u0434\u044b\u0439 \u0440\u0430\u0437 \u043f\u0440\u0438 \u0437\u0430\u043f\u0443\u0441\u043a\u0435 SQL Server, \u0431\u0430\u0437\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 model \u0432\u0441\u0435\u0433\u0434\u0430 \u0434\u043e\u043b\u0436\u043d\u0430 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u043e\u0432\u0430\u0442\u044c \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435 SQL Server. msdb. \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0430\u0433\u0435\u043d\u0442\u043e\u043c SQL Server \u0434\u043b\u044f \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f \u0440\u0430\u0441\u043f\u0438\u0441\u0430\u043d\u0438\u044f \u043f\u0440\u0435\u0434\u0443\u043f\u0440\u0435\u0436\u0434\u0435\u043d\u0438\u0439 (\u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440) \u0438 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u0437\u0430\u0434\u0430\u043d\u0438\u0439, \u0430 \u0442\u0430\u043a\u0436\u0435 \u0434\u0440\u0443\u0433\u0438\u043c\u0438 \u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u0430\u043c\u0438. SQL Server \u0445\u0440\u0430\u043d\u0438\u0442 \u043f\u043e\u043b\u043d\u044b\u0439 \u0436\u0443\u0440\u043d\u0430\u043b \u0440\u0435\u0437\u0435\u0440\u0432\u043d\u043e\u0433\u043e \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0438 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0432 \u0431\u0430\u0437\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 msdb. \u0414\u043b\u044f \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 \u043f\u043e\u0447\u0442\u044b \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u0443 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f: USE [msdb]. resource. \u0414\u043e\u0441\u0442\u0443\u043f\u043d\u0430\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u0434\u043b\u044f \u0447\u0442\u0435\u043d\u0438\u044f \u0431\u0430\u0437\u0430 \u0434\u0430\u043d\u043d\u044b\u0445, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0432\u0441\u0435 \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u044b\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 sys.objects, \u0444\u0438\u0437\u0438\u0447\u0435\u0441\u043a\u0438 \u0445\u0440\u0430\u043d\u044f\u0442\u0441\u044f \u0432 \u0431\u0430\u0437\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 resource, \u043d\u043e \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u0438 \u043f\u0440\u0438\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044e\u0442 \u0432 \u0441\u0445\u0435\u043c\u0435 sys \u043a\u0430\u0436\u0434\u043e\u0439 \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445. \u0420\u0435\u0433\u043b\u0430\u043c\u0435\u043d\u0442\u043d\u044b\u0435 \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0438 \u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0446\u0435\u043b\u043e\u0441\u0442\u043d\u043e\u0441\u0442\u0438 \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 DBCC CHECKDB \u0418\u043d\u0434\u0435\u043a\u0441\u044b. \u0418\u043d\u0434\u0435\u043a\u0441\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442\u0441\u044f \u0434\u043b\u044f \u0431\u044b\u0441\u0442\u0440\u043e\u0433\u043e \u043f\u043e\u0438\u0441\u043a\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 \u0431\u0435\u0437 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e\u0441\u0442\u0438 \u043f\u043e\u0438\u0441\u043a\u0430/\u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0430 \u0432\u0441\u0435\u0445 \u0441\u0442\u0440\u043e\u043a \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0435 \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 \u043f\u0440\u0438 \u043a\u0430\u0436\u0434\u043e\u043c \u043e\u0431\u0440\u0430\u0449\u0435\u043d\u0438\u0438 \u043a \u0442\u0430\u0431\u043b\u0438\u0446\u0435 \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445. \u0418\u043d\u0434\u0435\u043a\u0441 \u0443\u0441\u043a\u043e\u0440\u044f\u0435\u0442 \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u0437\u0430\u043f\u0440\u043e\u0441\u0430, \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u044f \u0431\u044b\u0441\u0442\u0440\u044b\u0439 \u0434\u043e\u0441\u0442\u0443\u043f \u043a \u0441\u0442\u0440\u043e\u043a\u0430\u043c \u0434\u0430\u043d\u043d\u044b\u0445 \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0435, \u0430\u043d\u0430\u043b\u043e\u0433\u0438\u0447\u043d\u043e \u0442\u043e\u043c\u0443, \u043a\u0430\u043a \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c \u0432 \u043a\u043d\u0438\u0433\u0435 \u043f\u043e\u043c\u043e\u0433\u0430\u0435\u0442 \u0432\u0430\u043c \u0431\u044b\u0441\u0442\u0440\u043e \u043d\u0430\u0439\u0442\u0438 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u0443\u044e \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e. \u0418\u043d\u0434\u0435\u043a\u0441\u044b \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u044e\u0442 \u043f\u0443\u0442\u044c \u0434\u043b\u044f \u0431\u044b\u0441\u0442\u0440\u043e\u0433\u043e \u043f\u043e\u0438\u0441\u043a\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439 \u0432 \u044d\u0442\u0438\u0445 \u0441\u0442\u043e\u043b\u0431\u0446\u0430\u0445. \u0414\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0438\u043d\u0434\u0435\u043a\u0441\u0430 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u0440\u0430\u043d\u0438\u0442\u0441\u044f \u0435\u0433\u043e \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430. MS SQL Server \u0441\u0430\u043c\u043e\u0441\u0442\u043e\u044f\u0442\u0435\u043b\u044c\u043d\u043e \u0441\u043e\u0437\u0434\u0430\u0435\u0442 \u0438 \u0438\u0437\u043c\u0435\u043d\u044f\u0435\u0442 \u0438\u043d\u0434\u0435\u043a\u0441\u044b \u043f\u0440\u0438 \u0440\u0430\u0431\u043e\u0442\u0435 \u0441 \u0431\u0430\u0437\u043e\u0439. \u0421 \u0442\u0435\u0447\u0435\u043d\u0438\u0435\u043c \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u0438\u043d\u0434\u0435\u043a\u0441\u0435 \u0441\u0442\u0430\u043d\u043e\u0432\u044f\u0442\u0441\u044f \u0444\u0440\u0430\u0433\u043c\u0435\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u043c\u0438, \u0442.\u0435. \u0440\u0430\u0437\u0431\u0440\u043e\u0441\u0430\u043d\u043d\u044b\u043c\u0438 \u043f\u043e \u0431\u0430\u0437\u0435 \u0434\u0430\u043d\u043d\u044b\u0445, \u0447\u0442\u043e \u0441\u0435\u0440\u044c\u0435\u0437\u043d\u043e \u0441\u043d\u0438\u0436\u0430\u0435\u0442 \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432. \u0415\u0441\u043b\u0438 \u0444\u0440\u0430\u0433\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044f \u0441\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 \u043e\u0442 5 \u0434\u043e 30% (\u0441\u0442\u0430\u043d\u0434\u0430\u0440\u0442\u043d\u043e \u0432 \u0437\u0430\u0434\u0430\u043d\u0438\u0438 15%), \u0442\u043e \u0440\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u0435\u0442\u0441\u044f \u0435\u0435 \u0443\u0441\u0442\u0440\u0430\u043d\u0438\u0442\u044c \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0440\u0435\u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u0438, \u043f\u0440\u0438 \u0444\u0440\u0430\u0433\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u0438 \u0432\u044b\u0448\u0435 30% (\u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \u0432 \u0437\u0430\u0434\u0430\u0447\u0435 > 30% \u0444\u0440\u0430\u0433\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u0438 \u0438 \u0447\u0438\u0441\u043b\u043e \u0441\u0442\u0440\u0430\u043d\u0438\u0446 > 1000) \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043f\u043e\u043b\u043d\u043e\u0435 \u043f\u0435\u0440\u0435\u0441\u0442\u0440\u043e\u0435\u043d\u0438\u0435 \u0438\u043d\u0434\u0435\u043a\u0441\u043e\u0432. \u041f\u043e\u0441\u043b\u0435 \u043f\u0435\u0440\u0435\u0441\u0442\u0440\u043e\u0435\u043d\u0438\u044f \u043f\u043b\u0430\u043d\u043e\u0432\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u0440\u0435\u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u044f. \u0420\u0435\u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u044f (Reorganize) \u0438\u043b\u0438 \u0434\u0435\u0444\u0440\u0430\u0433\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044f \u0438\u043d\u0434\u0435\u043a\u0441\u0430 \u2014 \u044d\u0442\u043e \u0441\u0435\u0440\u0438\u044f \u043d\u0435\u0431\u043e\u043b\u044c\u0448\u0438\u0445 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u0445 \u043f\u0435\u0440\u0435\u043c\u0435\u0449\u0435\u043d\u0438\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446 \u0442\u0430\u043a, \u0447\u0442\u043e\u0431\u044b \u0438\u043d\u0434\u0435\u043a\u0441 \u043d\u0435 \u0431\u044b\u043b \u0444\u0440\u0430\u0433\u043c\u0435\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u043d. \u041f\u043e\u0441\u043b\u0435 \u0440\u0435\u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u0438 \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u043d\u0435 \u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u0442\u0441\u044f. \u0412\u043e \u0432\u0440\u0435\u043c\u044f \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u043f\u043e\u0447\u0442\u0438 \u0432\u0441\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b, \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438 \u0441\u043c\u043e\u0433\u0443\u0442 \u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c. sp_msforeachtable N'DBCC INDEXDEFRAG (<\u0438\u043c\u044f \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445>, ''?'')' \u041f\u0435\u0440\u0435\u0441\u0442\u0440\u043e\u0435\u043d\u0438\u0435 (Rebuild) \u0438\u043d\u0434\u0435\u043a\u0441\u043e\u0432 (\u0438\u043b\u0438 \u0437\u0430\u0434\u0430\u0447\u0430 \u0432 \u043c\u0430\u0441\u0442\u0435\u0440\u0435 \u043f\u043b\u0430\u043d\u043e\u0432 \u043e\u0431\u0441\u043b\u0443\u0436\u0438\u0432\u0430\u043d\u0438\u044f: \u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0438\u043d\u0434\u0435\u043a\u0441) \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u0442 \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u043f\u043e\u043b\u043d\u043e\u0433\u043e \u043f\u043e\u0441\u0442\u0440\u043e\u0435\u043d\u0438\u044f \u0438\u043d\u0434\u0435\u043a\u0441\u043e\u0432. \u0412 \u0432\u0435\u0440\u0441\u0438\u0438 MS SQL Server Standard \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442 \u043e\u0442\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u0432\u0441\u0435\u0445 \u043a\u043b\u0438\u0435\u043d\u0442\u043e\u0432 \u043e\u0442 \u0431\u0430\u0437\u044b \u043d\u0430 \u0432\u0440\u0435\u043c\u044f \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0438. \u041f\u043e\u0441\u043b\u0435 \u043f\u0435\u0440\u0435\u0441\u0442\u0440\u043e\u0435\u043d\u0438\u044f \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430. sp_msforeachtable N'DBCC DBREINDEX (''?'')' \u041e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0438. \u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u2014 \u043d\u0435\u0431\u043e\u043b\u044c\u0448\u0430\u044f \u0442\u0430\u0431\u043b\u0438\u0446\u0430 (\u043e\u0431\u044b\u0447\u043d\u043e \u0434\u043e 200 \u0441\u0442\u0440\u043e\u043a), \u0432 \u043a\u043e\u0442\u043e\u0440\u043e\u0439 \u0445\u0440\u0430\u043d\u0438\u0442\u0441\u044f \u043e\u0431\u043e\u0431\u0449\u0435\u043d\u043d\u0430\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043e \u0442\u043e\u043c, \u043a\u0430\u043a\u0438\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0438 \u043a\u0430\u043a \u0447\u0430\u0441\u0442\u043e \u0432\u0441\u0442\u0440\u0435\u0447\u0430\u044e\u0442\u0441\u044f \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0435. \u041d\u0430 \u043e\u0441\u043d\u043e\u0432\u0430\u043d\u0438\u0438 \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0438 \u0441\u0435\u0440\u0432\u0435\u0440 \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0435\u0442 \u0440\u0435\u0448\u0435\u043d\u0438\u0435, \u043a\u0430\u043a \u043b\u0443\u0447\u0448\u0435 \u043f\u043e\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0437\u0430\u043f\u0440\u043e\u0441. \u041a\u043e\u0433\u0434\u0430 \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u044f\u0442 \u0437\u0430\u043f\u0440\u043e\u0441\u044b \u043a \u0411\u0414 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, SELECT) \u0432\u044b \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442\u0435 \u0434\u0430\u043d\u043d\u044b\u0435, \u043d\u043e \u043d\u0435 \u043e\u043f\u0438\u0441\u044b\u0432\u0430\u0435\u0442\u0435 \u0442\u043e, \u043a\u0430\u043a \u044d\u0442\u0438 \u0434\u0430\u043d\u043d\u044b\u0435 \u0434\u043e\u043b\u0436\u043d\u044b \u0431\u044b\u0442\u044c \u0438\u0437\u0432\u043b\u0435\u0447\u0435\u043d\u044b. \u0412 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0438 \u0438 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 \u043f\u043e\u043c\u043e\u0433\u0430\u0435\u0442 \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430. \u0412\u043e \u0432\u0440\u0435\u043c\u044f \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u043f\u0440\u043e\u0446\u0435\u0434\u0443\u0440\u044b \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0438 \u0434\u0430\u043d\u043d\u044b\u0435 \u043d\u0435 \u0431\u043b\u043e\u043a\u0438\u0440\u0443\u044e\u0442\u0441\u044f. exec sp_msforeachtable N'UPDATE STATISTICS ? WITH FULLSCAN' \u041e\u0447\u0438\u0441\u0442\u043a\u0430 \u043f\u0440\u043e\u0446\u0435\u0434\u0443\u0440\u043d\u043e\u0433\u043e \u043a\u044d\u0448\u0430, \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \u043f\u043e\u0441\u043b\u0435 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0438. \u041e\u043f\u0442\u0438\u043c\u0438\u0437\u0430\u0442\u043e\u0440 MS SQL Server \u043a\u044d\u0448\u0438\u0440\u0443\u0435\u0442 \u043f\u043b\u0430\u043d\u044b \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 \u0434\u043b\u044f \u0438\u0445 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e\u0433\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f. \u042d\u0442\u043e \u0434\u0435\u043b\u0430\u0435\u0442\u0441\u044f \u0434\u043b\u044f \u0442\u043e\u0433\u043e, \u0447\u0442\u043e\u0431\u044b \u044d\u043a\u043e\u043d\u043e\u043c\u0438\u0442\u044c \u0432\u0440\u0435\u043c\u044f, \u0437\u0430\u0442\u0440\u0430\u0447\u0438\u0432\u0430\u0435\u043c\u043e\u0435 \u043d\u0430 \u043a\u043e\u043c\u043f\u0438\u043b\u044f\u0446\u0438\u044e \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u0432 \u0442\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435, \u0435\u0441\u043b\u0438 \u0442\u0430\u043a\u043e\u0439 \u0436\u0435 \u0437\u0430\u043f\u0440\u043e\u0441 \u0443\u0436\u0435 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u043b\u0441\u044f \u0438 \u0435\u0433\u043e \u043f\u043b\u0430\u043d \u0438\u0437\u0432\u0435\u0441\u0442\u0435\u043d. \u041f\u043e\u0441\u043b\u0435 \u043e\u0431\u043d\u043e\u0432\u0438\u044f \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0438, \u043d\u0435 \u0431\u0443\u0434\u0435\u0442 \u043e\u0447\u0438\u0449\u0435\u043d \u043f\u0440\u043e\u0446\u0435\u0434\u0443\u0440\u043d\u044b\u0439 \u043a\u044d\u0448, \u0442\u043e SQL Server \u043c\u043e\u0436\u0435\u0442 \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0441\u0442\u0430\u0440\u044b\u0439 (\u043d\u0435\u043e\u043f\u0442\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439) \u043f\u043b\u0430\u043d \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u0438\u0437 \u043a\u044d\u0448\u0430 \u0432\u043c\u0435\u0441\u0442\u043e \u0442\u043e\u0433\u043e, \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u043d\u043e\u0432\u044b\u0439 (\u0431\u043e\u043b\u0435\u0435 \u043e\u043f\u0442\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439) \u043f\u043b\u0430\u043d. DBCC FREEPROCCACHE InfluxDB Download InfluxDB 1.x Open Source InfluxDB-Studio Install Windows Invoke-RestMethod \"https://dl.influxdata.com/influxdb/releases/influxdb-1.8.10_windows_amd64.zip\" -OutFile \"$home\\Downloads\\influxdb-1.8.10_windows_amd64.zip\" Expand-Archive \"$home\\Downloads\\influxdb-1.8.10_windows_amd64.zip\" -DestinationPath \"$home\\Documents\\\" Remove-Item \"$home\\Downloads\\influxdb-1.8.10_windows_amd64.zip\" & \"$home\\Downloads\\influxdb-1.8.10-1\\influxd.exe\" Install Ubuntu wget https://dl.influxdata.com/influxdb/releases/influxdb_1.8.10_amd64.deb sudo dpkg -i influxdb_1.8.10_amd64.deb systemctl start influxdb systemctl status influxdb ps aux | grep influxdb | grep -Ev \"grep\" netstat -natpl | grep 80[8-9][3-9] API nano /etc/influxdb/influxdb.conf [http] enabled = true bind-address = \":8086\" auth-enabled = false systemctl restart influxdb Chronograf wget https://dl.influxdata.com/chronograf/releases/chronograf-1.10.2_windows_amd64.zip -UseBasicParsing -OutFile chronograf-1.10.2_windows_amd64.zip Expand-Archive .\\chronograf-1.10.2_windows_amd64.zip -DestinationPath 'C:\\Program Files\\InfluxData\\chronograf\\' wget https://dl.influxdata.com/chronograf/releases/chronograf_1.10.2_amd64.deb sudo dpkg -i chronograf_1.10.2_amd64.deb systemctl status influxdb http://192.168.3.102:8888 Grafana Download invoke-RestMethod https://dl.grafana.com/enterprise/release/grafana-enterprise-10.3.1.windows-amd64.msi -OutFile \"$home\\Download\\grafana.msi\" apt-get install -y adduser libfontconfig1 musl wget https://dl.grafana.com/enterprise/release/grafana-enterprise_10.3.1_amd64.deb dpkg -i grafana-enterprise_10.3.1_amd64.deb systemctl start grafana-server systemctl status grafana-server CLI Client apt install influxdb-client \\ influx \\ influx --host 192.168.3.102 --username admin --password password $influx_client_exec = \"$home\\Documents\\influxdb-1.8.10-1\\influx.exe\" & $influx_client_exec -host 192.168.3.102 -port 8086 help show databases use PowerShell SELECT * FROM \"HardwareMonitor\" WHERE time > now() - 5m USERS SHOW USERS \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \u0438 \u0438\u0445 \u043f\u0440\u0430\u0432\u0430 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \\ CREATE USER admin WITH PASSWORD 'password' WITH ALL PRIVILEGES \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \\ GRANT ALL PRIVILEGES TO \"admin\" \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u043f\u0440\u0430\u0432\u0430 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \\ GRANT READ ON \"database\" TO \"admin\" \u0434\u043e\u0441\u0442\u0443\u043f \u043d\u0430 \u0447\u0442\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u0411\u0414 \u0438\u043b\u0438 \u0437\u0430\u043f\u0438\u0441\u044c (WRITE) \\ REVOKE ALL PRIVILEGES FROM \"admin\" \u043e\u0442\u043e\u0437\u0432\u0430\u0442\u044c \u043f\u0440\u0430\u0432\u0430 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \\ SHOW GRANTS FOR \"admin\" \u0411\u0414 \u0438 \u043f\u0440\u0438\u0432\u0435\u043b\u0435\u0433\u0438\u0438 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u0434\u043b\u044f \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \\ SET PASSWORD FOR \"admin\" = 'new_password' \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \\ DROP USER \"admin\" \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f DATABASE CREATE DATABASE powershell \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0411\u0414 \\ SHOW DATABASES \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0411\u0414 \\ DROP DATABASE powershell \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0411\u0414 \\ USE powershell \\ SHOW measurements \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \\ INSERT performance,host=console,counter=CPU value=0.88 \u0437\u0430\u043f\u0438\u0441\u0430\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0443 performance MEASUREMENT SHOW TAG KEYS FROM \"HardwareMonitor\" \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u0442\u044d\u0433\u0438 \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0435 \\ SHOW TAG VALUES FROM \"HardwareMonitor\" WITH KEY = \"HardwareName\" \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0433\u043e \u0442\u044d\u0433\u0430 \\ SHOW FIELD KEYS FROM \"HardwareMonitor\" \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 Field Tags \u0438 \u0438\u0445 \u0442\u0438\u043f \u0434\u0430\u043d\u043d\u044b\u0445 \\ SHOW SERIES FROM \"HardwareMonitor\" \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0445 \u0441\u0435\u0440\u0438\u0439 \u0432 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0439 \u0442\u0430\u0431\u043b\u0438\u0446\u0435. \u0421\u0435\u0440\u0438\u044f - \u044d\u0442\u043e \u043d\u0430\u0431\u043e\u0440 \u0442\u043e\u0447\u0435\u043a \u0434\u0430\u043d\u043d\u044b\u0445, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0438\u043c\u0435\u044e\u0442 \u043e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u044b\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0434\u043b\u044f \u0432\u0441\u0435\u0445 \u0442\u0435\u0433\u043e\u0432, \u0437\u0430 \u0438\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435\u043c \u0432\u0440\u0435\u043c\u0435\u043d\u0438. \\ DROP SERIES FROM \"HardwareMonitor\" \u043e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u0432\u0441\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0435 \\ DROP MEASUREMENT \"HardwareMonitor\" \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0442\u0430\u0431\u043b\u0438\u0446\u0443 SELECT/WHERE SELECT * FROM performance \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0435 \\ SELECT value FROM performance \u043e\u0442\u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u043e \u0441\u0442\u043e\u043b\u0431\u0446\u0443 value (\u0442\u043e\u043b\u044c\u043a\u043e Field Keys) \\ SELECT * FROM performance limit 10 \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c 10 \u0435\u0434\u0438\u043d\u0438\u0446 \u0434\u0430\u043d\u043d\u044b\u0445 \\ SELECT * FROM performance WHERE time > now() -2d \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0437\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0435 2 \u0434\u043d\u044f \\ SELECT * FROM performance WHERE time > now() +3h -5m \u0434\u0430\u043d\u043d\u044b\u0435 \u0437\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0435 5 \u043c\u0438\u043d\u0443\u0442 (+3 \u0447\u0430\u0441\u0430 \u043e\u0442 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u043f\u043e UTC 0 -5 \u043c\u0438\u043d\u0443\u0442) \\ SELECT * FROM performance WHERE counter = 'CPU' \u0432\u044b\u0431\u043e\u0440\u043a\u0430 \u043f\u043e \u0442\u044d\u0433\u0443 \\ SELECT upload/1000 FROM speedtest WHERE upload/1000 <= 250 \u0432\u044b\u0431\u043e\u0440\u043a\u0430 \u043f\u043e \u0441\u0442\u043e\u043b\u0431\u0446\u0443 upload \u0438 \u0440\u0430\u0437\u0434\u0435\u043b\u0438\u0442\u044c \u0432\u044b\u0432\u043e\u0434 \u043d\u0430 1000, \u0432\u044b\u0432\u0435\u0441\u0442\u0438 upload \u043c\u0435\u043d\u044c\u0448\u0435 250 \\ DELETE FROM performance WHERE time > now() -1h \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0437\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0435 1/4 \u0447\u0430\u0441\u0430 \\ DELETE FROM performance WHERE time < now() -24h \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0441\u0442\u0430\u0440\u0448\u0435 24 \u0447\u0430\u0441\u043e\u0432 REGEX SELECT * FROM \"win_pdisk\" WHERE instance =~/.*C:/ and time > now() - 5m \u0438 \\ SELECT * FROM \"win_pdisk\" WHERE instance =~/.*E:/ or instance =~ /.*F:/ \u0438\u043b\u0438 \\ SELECT * FROM \"win_pdisk\" WHERE instance !~ /.*Total/ \u043d\u0435 \u0440\u0430\u0432\u043d\u043e (\u0438\u0441\u043a\u043b\u044e\u0447\u0438\u0442\u044c) \\ SELECT * FROM \"HardwareMonitor\" WHERE time > now() - 5m and HardwareName =~ /Intel/ \u043f\u0440\u0438\u0431\u043b\u0438\u0437\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0440\u0430\u0432\u043d\u043e \\ SELECT * FROM \"HardwareMonitor\" WHERE time > now() - 5m and HardwareName =~ /Intel.+i7/ \u044d\u043a\u0432\u0438\u0432\u0430\u043b\u0435\u043d\u0442 12th_Gen_Intel_Core_i7-1260P \\ SELECT * FROM \"HardwareMonitor\" WHERE time > now() - 5m and HardwareName =~ /^Intel/ \u043d\u0430\u0447\u0438\u043d\u0430\u0435\u0442\u0441\u044f \u043d\u0430 Intel \\ SELECT * FROM \"HardwareMonitor\" WHERE time > now() - 5m and HardwareName =~ /00$/ \u0437\u0430\u043a\u0430\u043d\u0447\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u043d\u0430 00 GROUP BY tag_key SELECT * FROM \"HardwareMonitor\" WHERE time > now() - 5m and SensorName = 'Temperature' GROUP BY HardwareName \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0435 \u0433\u0440\u0443\u043f\u043f\u044b \u043f\u043e \u0442\u044d\u0433\u0443 HardwareName \\ SELECT * FROM \"HardwareMonitor\" WHERE time > now() - 5m and SensorName = 'Temperature' GROUP BY Host,HardwareName \u0431\u043e\u043b\u044c\u0448\u0435 \u0433\u0440\u0443\u043f\u043f \u043f\u043e \u0434\u0432\u0443\u043c \u0442\u044d\u0433\u0430\u0430\u043c Functions(field_key) Functions SELECT instance,LAST(Avg._Disk_Read_Queue_Length) FROM \"win_pdisk\" GROUP BY instance \u043e\u0442\u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u044b\u0432\u043e\u0434 \u043f\u043e \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u043c\u0443/\u0442\u0435\u043a\u0443\u0449\u0435\u043c\u0443 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044e \\ SELECT instance,FIRST(Avg._Disk_Read_Queue_Length) FROM \"win_pdisk\" GROUP BY instance \u043e\u0442\u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u044b\u0432\u043e\u0434 \u043f\u043e \u043f\u0435\u0440\u0432\u043e\u043c\u0443 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044e \u0437\u0430 \u0432\u0435\u0441\u044c \u0438\u043b\u0438 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u0439 \u043e\u0442\u0440\u0435\u0437\u043e\u043a \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \\ SELECT instance,MIN(Avg._Disk_Read_Queue_Length) FROM \"win_pdisk\" GROUP BY instance \u043e\u0442\u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u044b\u0432\u043e\u0434 \u0441 \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435\u043c \u043c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0433\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \\ SELECT instance,MAX(Avg._Disk_Read_Queue_Length) FROM \"win_pdisk\" GROUP BY instance \u043e\u0442\u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u044b\u0432\u043e\u0434 \u0441 \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435\u043c \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0433\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \\ SELECT SUM(Bytes_Received_persec) FROM \"win_net\" GROUP BY instance \u0441\u0443\u043c\u043c\u0430\u0445 \u0432\u0441\u0435\u0445 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439 \\ SELECT COUNT(Bytes_Received_persec) FROM \"win_net\" WHERE Bytes_Received_persec >= 0 GROUP BY instance \u043a\u043e\u043b-\u0432\u043e \u0434\u0430\u043d\u043d\u044b\u0445, \u0433\u0434\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0432\u044b\u0448\u0435 \u0438\u043b\u0438 \u0440\u0430\u0432\u043d\u043e 0 \\ SELECT MEAN(Bytes_Received_persec) FROM \"win_net\" WHERE Bytes_Received_persec < 1000 GROUP BY instance \u0441\u0440\u0435\u0434\u043d\u0435\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 \u0441 \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c \u043e\u0442 0 \u0434\u043e 1000 (509) SELECT *,MAX(Value) FROM \"HardwareMonitor\" WHERE time > now() -1h GROUP BY SensorName,Host \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0433\u0440\u0443\u043f\u043f\u044b \u0434\u043b\u044f \u0432\u044b\u044f\u0432\u043b\u0435\u043d\u0438\u044f \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0433\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0441\u0442\u043e\u0431\u0446\u0430 Value \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0442\u044d\u0433\u0430 SensorName \u0438 \u0445\u043e\u0441\u0442\u0430 \u0437\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0439 \u0447\u0430\u0441 \\ SELECT *,MAX(Value) FROM \"HardwareMonitor\" WHERE time > now() -1h and SensorName = 'CPU_Package' GROUP BY Host \u043c\u0430\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 CPU_Package \u0437\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0439 \u0447\u0430\u0441 \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0445\u043e\u0441\u0442\u0430 \\ SELECT MEAN(Value) FROM \"HardwareMonitor\" WHERE time > now() -1h and SensorName = 'CPU_Package' GROUP BY Host \u0441\u0440\u0435\u0434\u043d\u0435\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 CPU_Package \u0437\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0439 \u0447\u0430\u0441 POLICY CREATE DATABASE powershell WITH DURATION 48h REPLICATION 1 NAME \"del2d\" \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0411\u0414 \u0441 \u043f\u043e\u043b\u0438\u0442\u0438\u043a\u043e\u0439 \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f 2 \u0434\u043d\u044f \\ CREATE RETENTION POLICY del2h ON powershell DURATION 2h REPLICATION 1 \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043d\u043e\u0432\u0443\u044e \u043f\u043e\u043b\u0438\u0442\u0438\u043a\u0443 \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0434\u043b\u044f \u0411\u0414 \\ CREATE RETENTION POLICY del6h ON powershell DURATION 6h REPLICATION 1 SHARD DURATION 2h \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u043f\u0435\u0440\u0438\u043e\u0434 \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f 6 \u0447\u0430\u0441\u043e\u0432 + 2 \u0447\u0430\u0441\u0430 \u0434\u043e \u043e\u0447\u0438\u0441\u0442\u043a\u0438 (\u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e 1\u0447 \u0438\u043b\u0438 \u0431\u043e\u043b\u044c\u0448\u0435) \\ ALTER RETENTION POLICY del6h ON powershell DEFAULT \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c (ALTER) \u043f\u043e\u043b\u0438\u0442\u0438\u043a\u0443 \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0434\u043b\u044f \u0411\u0414 \u043d\u0430 del6h (DEFAULT) \\ DROP RETENTION POLICY del2d ON powershell \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u043f\u043e\u043b\u0438\u0442\u0438\u043a\u0438 \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u043f\u0440\u0438\u0432\u043e\u0434\u0438\u0442 \u043a \u0431\u0435\u0437\u0432\u043e\u0437\u0432\u0440\u0430\u0442\u043d\u043e\u043c\u0443 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u044e \u0432\u0441\u0435\u0445 \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u0439 (\u0442\u0430\u0431\u043b\u0438\u0446) \u0438 \u0434\u0430\u043d\u043d\u044b\u0445, \u0445\u0440\u0430\u043d\u044f\u0449\u0438\u0445\u0441\u044f \u0432 \u043f\u043e\u043b\u0438\u0442\u0438\u043a\u0435 \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \\ SHOW RETENTION POLICIES ON PowerShell \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0434\u0435\u0439\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u043f\u043e\u043b\u0438\u0442\u0438\u043a\u0438 \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 PowerShell $data = Invoke-RestMethod http://192.168.3.102:8086/query?q=\"SHOW RETENTION POLICIES ON PowerShell\" $col = $data.results.series.columns $val = $data.results.series.values $mass = @() $mass += [string]$col foreach ($v in $val) { $mass += [string]$v } $mass = $mass -replace '^','\"' $mass = $mass -replace '$','\"' $mass = $mass -replace '\\s','\",\"' $mass | ConvertFrom-Csv API POST \u0412\u043c\u0435\u0441\u0442\u043e \u0442\u0430\u0431\u043b\u0438\u0446 \u0432 InfluxDB \u0438\u043c\u0435\u044e\u0442\u0441\u044f \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u044f. \u0412\u043c\u0435\u0441\u0442\u043e \u0441\u0442\u043e\u043b\u0431\u0446\u043e\u0432 \u0432 \u043d\u0435\u0439 \u0435\u0441\u0442\u044c \u0442\u0435\u0433\u0438 \u0438 \u043f\u043e\u043b\u044f. Table Tag (string/int) Field (double/int) TIMESTAMP measurement,Tag_Keys1=Tag_Values1,Tag_Keys2=Tag_Values2 Field_Keys1=\"Values\",Field_Keys2=\"Values\" 0000000000000000000 1 2 3 $ip = \"192.168.3.104\" $port = \"8086\" $db = \"powershell\" $table = \"speedtest\" $ipp = $ip+\":\"+$port $url = \"http://$ipp/write?db=$db\" $user = \"admin\" $pass = \"password\" | ConvertTo-SecureString -AsPlainText -Force $cred = [System.Management.Automation.PSCredential]::new($user,$pass) $unixtime = (New-TimeSpan -Start (Get-Date \"01/01/1970\") -End (Get-Date)).TotalSeconds $timestamp = ([string]$unixtime -replace \"\\..+\") + \"000000000\" Invoke-RestMethod -Method POST -Uri $url -Body \"$table,host=$(hostname) download=200000,upload=300000,ping=3 $timestamp\" API GET curl http://192.168.3.104:8086/query --data-urlencode \"q=SHOW DATABASES\" pwsh7 (ConvertFrom-Json) and bash $dbs = irm \"http://192.168.3.104:8086/query?q=SHOW DATABASES\" \\ $dbs = irm \"http://192.168.3.104:8086/query?epoch=ms&u=admin&p=password&q=SHOW DATABASES\" \\ $dbs.results.series.values $ip = \"192.168.3.104\" $port = \"8086\" $db = \"powershell\" $table = \"speedtest\" $query = \"SELECT * FROM $table\" $ipp = $ip+\":\"+$port $url = \"http://$ipp/query?db=$db&q=$query\" $data = Invoke-RestMethod -Method GET -Uri $url` -Credential $cred $data.results.series.name ` \u0438\u043c\u044f \u0442\u0430\u0431\u043b\u0438\u0446\u044b $data.results.series.columns` \u0441\u0442\u043e\u043b\u0431\u0446\u044b/\u043a\u043b\u044e\u0447\u0438 $data.results.series.values ` \u0434\u0430\u043d\u043d\u044b\u0435 \u043f\u043e\u0441\u0442\u0440\u043e\u0447\u043d\u043e Endpoints API doc $stats = irm http://192.168.3.104:8086/debug/vars` \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 $stats.\"database:powershell\".values` \u043a\u043e\u043b-\u0432\u043e \u0442\u0430\u0431\u043b\u0438\u0446 \u043a \u0411\u0414 $stats.queryExecutor.values` \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e query-\u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 (\u043e\u0431\u0440\u0430\u0449\u0435\u043d\u0438\u0439 \u043a endpoint /query) $stats.write.values` \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e write-\u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 $stats.system.uptime http://192.168.3.104:8086/debug/requests \u043a\u043e\u043b-\u0432\u043e \u043a\u043b\u0438\u0435\u043d\u0442\u0441\u043a\u0438\u0445 HTTP-\u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 \u043a \u043a\u043e\u043d\u0435\u0447\u043d\u044b\u043c \u0442\u043e\u0447\u043a\u0430\u043c /write\u0438 /query \\ http://192.168.3.104:8086/debug/pprof \\ http://192.168.3.104:8086/ping \\ http://192.168.3.104:8086/query \\ http://192.168.3.104:8086/write http://192.168.3.99:8086/api/v2/setup \\ http://192.168.3.99:8086/api/v2/config \\ http://192.168.3.99:8086/api/v2/write PingTo-InfluxDB while ($true) { $tz = (Get-TimeZone).BaseUtcOffset.TotalMinutes $unixtime = (New-TimeSpan -Start (Get-Date \"01/01/1970\") -End ((Get-Date).AddMinutes(-$tz))).TotalSeconds` -3h UTC $timestamp = ([string]$unixtime -replace \"\\..+\") + \"000000000\" $tnc = tnc 8.8.8.8 $Status = $tnc.PingSucceeded $RTime = $tnc.PingReplyDetails.RoundtripTime Invoke-RestMethod -Method POST -Uri \"http://192.168.3.104:8086/write?db=powershell\" -Body \"ping,host=$(hostname) status=$status,rtime=$RTime $timestamp\" sleep 1 } SELECT * FROM ping WHERE status = false PerformanceTo-InfluxDB function ConvertTo-Encoding ([string]$From, [string]$To) { Begin { $encFrom = [System.Text.Encoding]::GetEncoding($from) $encTo = [System.Text.Encoding]::GetEncoding($to) } Process { $bytes = $encTo.GetBytes($_) $bytes = [System.Text.Encoding]::Convert($encFrom, $encTo, $bytes) $encTo.GetString($bytes) } } $localization = (Get-Culture).LCID` \u0442\u0435\u043a\u0443\u0449\u0430\u044f \u043b\u043e\u043a\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f if ($localization -eq 1049) { $performance = \"\\\\$(hostname)\\\u041f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u0440(_Total)\\% \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d\u043d\u043e\u0441\u0442\u0438 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u0440\u0430\" | ConvertTo-Encoding UTF-8 windows-1251` \u0434\u0435\u043a\u043e\u0434\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043a\u0438\u0440\u0438\u043b\u043b\u0438\u0446\u0443 } else { $performance = \"\\Processor(_Total)\\% Processor Time\" } $tz = (Get-TimeZone).BaseUtcOffset.TotalMinutes while ($true) { $unixtime = (New-TimeSpan -Start (Get-Date \"01/01/1970\") -End ((Get-Date).AddMinutes(-$tz))).TotalSeconds` -3h UTC $timestamp = ([string]$unixtime -replace \"\\..+\") + \"000000000\" [double]$value = (Get-Counter $performance).CounterSamples.CookedValue.ToString(\"0.00\").replace(\",\",\".\")` \u043e\u043a\u0440\u0443\u0433\u043b\u0438\u0442\u044c \u0432 \u0442\u0438\u043f \u0434\u0430\u043d\u043d\u044b\u0445 Double Invoke-RestMethod -Method POST -Uri \"http://192.168.3.104:8086/write?db=powershell\" -Body \"performance,host=$(hostname),counter=CPU value=$value $timestamp\" sleep 5 } Service $powershell_Path = (Get-Command powershell).Source $NSSM_Path = \"C:\\NSSM\\NSSM-2.24.exe\" $Script_Path = \"C:\\NSSM\\PerformanceTo-InfluxDB.ps1\" $Service_Name = \"PerformanceTo-InfluxDB\" & $NSSM_Path install $Service_Name $powershell_Path -ExecutionPolicy Bypass -NoProfile -f $Script_Path Get-Service $Service_Name | Start-Service Get-Service $Service_Name | Set-Service -StartupType Automatic Telegraf Plugins iwr https://dl.influxdata.com/telegraf/releases/telegraf-1.27.1_windows_amd64.zip -UseBasicParsing -OutFile telegraf-1.27.1_windows_amd64.zip \\ Expand-Archive .\\telegraf-1.27.1_windows_amd64.zip -DestinationPath \"C:\\Telegraf\" \\ rm telegraf-1.27.1_windows_amd64.zip \\ cd C:\\Telegraf \\ .\\telegraf.exe -sample-config --input-filter cpu:mem:dns_query --output-filter influxdb > telegraf_nt.conf \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044e \u0441 \u0432\u044b\u0431\u0430\u0440\u043d\u043d\u044b\u043c\u0438 \u043f\u043b\u0430\u0433\u0438\u043d\u0430\u043c\u0438 \u0434\u043b\u044f \u0441\u0431\u043e\u0440\u0430 \u043c\u0435\u0442\u0440\u0438\u043a \\ Start-Process notepad++ C:\\Telegraf\\telegraf_nt.conf [[outputs.influxdb]] urls = [\"http://192.168.3.104:8086\"] database = \"telegraf_nt\" username = \"user\" password = \"pass\" [[inputs.cpu]] percpu = false totalcpu = true [[inputs.dns_query]] servers = [\"8.8.8.8\"] network = \"udp\" domains = [\".\"] record_type = \"A\" port = 53 timeout = \"2s\" .\\telegraf.exe --test -config C:\\Telegraf\\telegraf_nt.conf \u0442\u0435\u0441\u0442 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438 (\u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u043c\u0435\u0442\u0440\u0438\u043a \u0441 \u0432\u044b\u0432\u043e\u0434\u043e\u043c \u0432 \u043a\u043e\u043d\u0441\u043e\u043b\u044c) \\ C:\\Telegraf\\telegraf.exe -config C:\\Telegraf\\telegraf_nt.conf \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c telegraf (\u0442\u0435\u0441\u0442 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 \u0434\u0430\u043d\u043d\u044b\u0445) \\ .\\telegraf.exe --config \"C:\\Telegraf\\telegraf_nt.conf\" --service install \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0441\u043b\u0443\u0436\u0431\u0443 \\ Get-Service telegraf | Start-Service \\ .\\telegraf.exe --service uninstall USE telegraf \\ SELECT usage_idle,usage_system,usage_user FROM cpu Elasticsearch Install-Module -Name Elastic.Console -AllowPrerelease github source \\ Get-Command -Module Elastic.Console \\ Get-ElasticsearchVersion \\ Set-ElasticsearchVersion 7.3.0 \\ Invoke-Elasticsearch REST API \u0437\u0430\u043f\u0440\u043e\u0441\u044b CData PowerShell Gallery CData \\ Automate Elasticsearch Integration Tasks from PowerShell Install-Module ElasticsearchCmdlets \u043f\u0430\u043a\u0435\u0442 \u0434\u0440\u0430\u0439\u0432\u0435\u0440\u0430 \u0432 psgallery \\ Import-Module ElasticsearchCmdlets \\ Get-Command -Module ElasticsearchCmdlets $elasticsearch = Connect-Elasticsearch -Server \"$Server\" -Port \"$Port\" -User \"$User\" -Password \"$Password\" $shipcity = \"New York\" $orders = Select-Elasticsearch -Connection $elasticsearch -Table \"Orders\" -Where \"ShipCity = `'$ShipCity`'\"` \u043f\u043e\u0438\u0441\u043a \u0438 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 $orders = Invoke-Elasticsearch -Connection $elasticsearch -Query 'SELECT * FROM Orders WHERE ShipCity = @ShipCity' -Params @{'@ShipCity'='New York'}` SQL \u0437\u0430\u043f\u0440\u043e\u0441\u044b ADO.NET Assembly Install-Package CData.Elasticsearch \u043f\u0430\u043a\u0435\u0442 \u0434\u0440\u0430\u0439\u0432\u0435\u0440\u0430 \u0432 nuget \\ [Reflection.Assembly]::LoadFile(\"C:\\Program Files\\PackageManagement\\NuGet\\Packages\\CData.Elasticsearch.23.0.8565\\lib\\net40\\System.Data.CData.Elasticsearch.dll\") $connect = New-Object System.Data.CData.Elasticsearch.ElasticsearchConnection(\"Server=127.0.0.1;Port=9200;User=admin;Password=123456;\") $connect.Open() $sql = \"SELECT OrderName, Freight from Orders\" $da = New-Object System.Data.CData.Elasticsearch.ElasticsearchDataAdapter($sql, $conn) $dt = New-Object System.Data.DataTable $da.Fill($dt) $dt.Rows | foreach { Write-Host $_.ordername $_.freight } UPDATE Update-Elasticsearch -Connection $Elasticsearch -Columns @('OrderName','Freight') -Values @('MyOrderName', 'MyFreight') -Table Orders -Id \"MyId\" $cmd = New-Object System.Data.CData.Elasticsearch.ElasticsearchCommand(\"UPDATE Orders SET ShipCity='New York' WHERE Id = @myId\", $conn) $cmd.Parameters.Add(new System.Data.CData.Elasticsearch.ElasticsearchParameter(\"@myId\",\"10456255-0015501366\")) $cmd.ExecuteNonQuery() INSERT Add-Elasticsearch -Connection $Elasticsearch -Table Orders -Columns @(\"OrderName\", \"Freight\") -Values @(\"MyOrderName\", \"MyFreight\") $cmd = New-Object System.Data.CData.Elasticsearch.ElasticsearchCommand(\"INSERT INTO Orders (ShipCity) VALUES (@myShipCity)\", $conn) $cmd.Parameters.Add(new System.Data.CData.Elasticsearch.ElasticsearchParameter(\"@myShipCity\",\"New York\")) $cmd.ExecuteNonQuery() DELETE Remove-Elasticsearch -Connection $Elasticsearch -Table \"Orders\" -Id \"MyId\" $cmd = New-Object System.Data.CData.Elasticsearch.ElasticsearchCommand(\"DELETE FROM Orders WHERE Id=@myId\", $conn) $cmd.Parameters.Add(new System.Data.CData.Elasticsearch.ElasticsearchParameter(\"@myId\",\"001d000000YBRseAAH\")) $cmd.ExecuteNonQuery() ODBC Get-Command -Module Wdac \\ Get-OdbcDriver | ft \u0441\u043f\u0438\u0441\u043e\u043a \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044b\u0445 \u0434\u0440\u0430\u0439\u0432\u0435\u0440\u043e\u0432 Elasticsearch ODBC \u0434\u0440\u0430\u0439\u0432\u0435\u0440 \u0434\u043b\u044f \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043a \u0434\u0430\u043d\u043d\u044b\u043c Elasticsearch \u0438\u0437 Microsoft PowerShell $connectstring = \"DSN=Local Elasticsearch;\" $sql = \"SELECT * FROM library\" $conn = New-Object System.Data.Odbc.OdbcConnection($connectstring) $conn.open() $cmd = New-Object system.Data.Odbc.OdbcCommand($sql,$conn) $da = New-Object system.Data.Odbc.OdbcDataAdapter($cmd) $dt = New-Object system.Data.datatable $null = $da.fill($dt) $conn.close() $dt PostgreSQL \u0421\u043a\u0430\u0447\u0430\u0442\u044c \u0438 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0434\u0440\u0430\u0439\u0432\u0435\u0440 $dbServer = \"192.168.3.101\" $port = \"5432\" $dbName = \"test\" $dbUser = \"admin\" $dbPass = \"admin\" $szConnect = \"Driver={PostgreSQL Unicode(x64)};Server=$dbServer;Port=$port;Database=$dbName;Uid=$dbUser;Pwd=$dbPass;\" $cnDB = New-Object System.Data.Odbc.OdbcConnection($szConnect) $dsDB = New-Object System.Data.DataSet try { $cnDB.Open() $adDB = New-Object System.Data.Odbc.OdbcDataAdapter $adDB.SelectCommand = New-Object System.Data.Odbc.OdbcCommand(\"SELECT id, name, age, login FROM public.users\" , $cnDB) $adDB.Fill($dsDB) $cnDB.Close() } catch [System.Data.Odbc.OdbcException] { $_.Exception $_.Exception.Message $_.Exception.ItemName } foreach ($row in $dsDB[0].Tables[0].Rows) { $row.login $row.age } WMI WMI/CIM (Windows Management Instrumentation/Common Information Model) Get-WmiObjec -ComputerName localhost -Namespace root -class \"__NAMESPACE\" | select name,__namespace \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0434\u043e\u0447\u0435\u0440\u043d\u0438\u0438 Namespace (\u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0433\u0440\u0443\u043f\u043f\u044b) \\ Get-WmiObject -List \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u043a\u043b\u0430\u0441\u0441\u044b \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u0430 \u0438\u043c\u0435\u043d \"root\\cimv2\" (\u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e), \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430 (\u043e\u043f\u0438\u0441\u044b\u0432\u0430\u044e\u0442 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044e \u0438 \u0442\u0435\u043a\u0443\u0449\u0435\u0435 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u043c\u043e\u0433\u043e \u0440\u0435\u0441\u0443\u0440\u0441\u0430) \u0438 \u0438\u0445 \u043c\u0435\u0442\u043e\u0434\u044b (\u043a\u0430\u043a\u0438\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u043d\u0430\u0434 \u044d\u0442\u0438\u043c \u0440\u0435\u0441\u0443\u0440\u0441\u043e\u043c) \\ Get-WmiObject -List | Where-Object {$_.name -match \"video\"} \u043f\u043e\u0438\u0441\u043a \u043a\u043b\u0430\u0441\u0441\u0430 \u043f\u043e \u0438\u043c\u0435\u043d\u0438, \u0435\u0433\u043e \u0441\u0432\u043e\u0439\u0441\u0442\u0432 \u0438 \u043c\u0435\u0442\u043e\u0434\u043e\u0432 \\ Get-WmiObject -ComputerName localhost -Class Win32_VideoController \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u0441\u0432\u043e\u0439\u0441\u0442\u0432 \u043a\u043b\u0430\u0441\u0441\u0430 gwmi -List | where name -match \"service\" | ft -auto \u0435\u0441\u043b\u0438 \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0435 \u043f\u0440\u0438\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044e\u0442 Methods, \u0442\u043e \u043c\u043e\u0436\u043d\u043e \u0432\u0437\u0430\u0438\u043c\u043e\u0434\u0435\u0439\u0441\u0442\u0432\u043e\u0432\u0430\u0442\u044c {StartService, StopService} \\ gwmi -Class win32_service | select * \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u0441\u043b\u0443\u0436\u0431 \u0438 \u0432\u0441\u0435\u0445 \u0438\u0445 \u0441\u0432\u043e\u0439\u0441\u0442\u0432 \\ Get-CimInstance Win32_service \u043e\u0431\u0440\u0430\u0449\u0430\u0435\u0442\u0441\u044f \u043d\u0430 \u043f\u0440\u044f\u043c\u0443\u044e \u043a \"root\\cimv2\" \\ gwmi win32_service -Filter \"name='Zabbix Agent'\" \u043e\u0442\u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u044b\u0432\u043e\u0434 \u043f\u043e \u0438\u043c\u0435\u043d\u0438 \\ (gwmi win32_service -Filter \"name='Zabbix Agent'\").State \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0435 \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u043e \\ gwmi win32_service -Filter \"State = 'Running'\" \u043e\u0442\u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c \u0437\u0430\u043f\u0443\u0449\u0435\u043d\u043d\u044b\u0435 \u0441\u043b\u0443\u0436\u0431\u044b \\ gwmi win32_service -Filter \"StartMode = 'Auto'\" \u043e\u0442\u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u043b\u0443\u0436\u0431\u044b \u043f\u043e \u043c\u0435\u0442\u043e\u0434\u0443 \u0437\u0430\u043f\u0443\u0441\u043a\u0430 \\ gwmi -Query 'select * from win32_service where startmode=\"Auto\"' WQL-\u0437\u0430\u043f\u0440\u043e\u0441 (WMI Query Language) \\ gwmi win32_service | Get-Member -MemberType Method \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u043c\u0435\u0442\u043e\u0434\u044b \u0432\u0437\u0430\u0438\u043c\u043e\u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f \u0441 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u044f (Delete, StartService) \\ (gwmi win32_service -Filter 'name=\"Zabbix Agent\"').Delete() \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u043b\u0443\u0436\u0431\u0443 \\ (gwmi win32_service -Filter 'name=\"MSSQL$MSSQLE\"').StartService() \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0441\u043b\u0443\u0436\u0431\u0443 Get-CimInstance -ComputerName $srv Win32_OperatingSystem | select LastBootUpTime \u0432\u0440\u0435\u043c\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \\ gwmi -ComputerName $srv -Class Win32_OperatingSystem | select LocalDateTime,LastBootUpTime \u0442\u0435\u043a\u0443\u0449\u0435\u0435 \u0432\u0440\u0435\u043c\u044f \u0438 \u0432\u0440\u0435\u043c\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \\ gwmi Win32_OperatingSystem | Get-Member -MemberType Method \u043c\u0435\u0442\u043e\u0434\u044b reboot \u0438 shutdown \\ (gwmi Win32_OperatingSystem -EnableAllPrivileges).Reboot() \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0441 \u043a\u043b\u044e\u0447\u0435\u043c \u043f\u043e\u0432\u044b\u0448\u0435\u043d\u0438\u044f \u043f\u0440\u0438\u0432\u0435\u043b\u0435\u0433\u0438\u0439 \\ (gwmi Win32_OperatingSystem -EnableAllPrivileges).Win32Shutdown(0) \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u0435 \u0441\u0435\u0430\u043d\u0441\u0430 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f $system = Get-WmiObject -Class Win32_OperatingSystem $InstallDate = [Management.ManagementDateTimeconverter]::ToDateTime($system.installdate)` \u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u0434\u0430\u0442\u0443 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \u041e\u0421 $AfterInstallDays = ((Get-Date) \u2014 $Installdate).Days` \u0412\u044b\u0447\u0438\u0441\u043b\u044f\u0435\u043c \u0432\u0440\u0435\u043c\u044f, \u043f\u0440\u043e\u0448\u0435\u0434\u0448\u0435\u0435 \u0441 \u043c\u043e\u043c\u0435\u043d\u0442\u0430 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 $ShortInstallDate = \"{0:yyyy-MM-dd HH:MM}\" -f ($InstallDate) \"\u0421\u0438\u0441\u0442\u0435\u043c\u0430 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0430: $ShortInstallDate (\u041f\u0440\u043e\u0448\u043b\u043e $AfterInstalldays \u0434\u043d\u0435\u0439)\" (Get-WmiObject win32_battery).estimatedChargeRemaining \u0437\u0430\u0440\u044f\u0434 \u0431\u0430\u0442\u0430\u0440\u0435\u0438 \u0432 \u043f\u0440\u043e\u0446\u0435\u043d\u0442\u0430\u0445 \\ gwmi Win32_UserAccount \u0434\u043e\u043c\u0435\u043d\u043d\u044b\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438 \\ (gwmi Win32_SystemUsers).PartComponent \\ Get-CimInstance -ClassName Win32_LogonSession \\ Get-CimInstance -ClassName Win32_BIOS gwmi -list -Namespace root\\CIMV2\\Terminalservices \\ (gwmi -Class Win32_TerminalServiceSetting -Namespace root\\CIMV2\\TerminalServices).AllowTSConnections \\ (gwmi -Class Win32_TerminalServiceSetting -Namespace root\\CIMV2\\TerminalServices).SetAllowTSConnections(1) \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c RDP $srv = \"localhost\" gwmi Win32_logicalDisk -ComputerName $srv | where {$_.Size -ne $null} | select @{ Label=\"Value\"; Expression={$_.DeviceID}}, @{Label=\"AllSize\"; Expression={ [string]([int]($_.Size/1Gb))+\" GB\"}},@{Label=\"FreeSize\"; Expression={ [string]([int]($_.FreeSpace/1Gb))+\" GB\"}}, @{Label=\"Free%\"; Expression={ [string]([int]($_.FreeSpace/$_.Size*100))+\" %\"}} NLA (Network Level Authentication) (gwmi -class \"Win32_TSGeneralSetting\" -Namespace root\\cimv2\\Terminalservices -Filter \"TerminalName='RDP-tcp'\").UserAuthenticationRequired \\ (gwmi -class \"Win32_TSGeneralSetting\" -Namespace root\\cimv2\\Terminalservices -Filter \"TerminalName='RDP-tcp'\").SetUserAuthenticationRequired(1) \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c NLA \\ Get-ItemProperty -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp\" -Name SecurityLayer \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 (2) \\ Get-ItemProperty -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp\" -Name UserAuthentication \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 (1) \\ Set-ItemProperty -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp\" -Name SecurityLayer -Value 0 \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \\ Set-ItemProperty -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp\" -Name UserAuthentication -Value 0 \\ REG ADD HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\CredSSP\\Parameters /v AllowEncryptionOracle /t REG_DWORD /d 2 \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043d\u0430 \u043a\u043b\u0438\u0435\u043d\u0442\u0441\u043a\u043e\u043c \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0435 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0443 \u0432\u0435\u0440\u0441\u0438\u0438 CredSSP, \u0435\u0441\u043b\u0438 \u043d\u0430 \u0446\u0435\u043b\u0435\u0432\u043e\u043c \u043a\u043e\u043c\u044c\u044e\u0442\u0435\u0440\u0435-\u0441\u0435\u0440\u0432\u0435\u0440\u0435 \u043d\u0435 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u044b \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f KB4512509 \u043e\u0442 \u043c\u0430\u044f 2018 \u0433\u043e\u0434\u0430 Regedit Get-PSDrive \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0445 \u0434\u0438\u0441\u043a\u043e\u0432/\u0440\u0430\u0437\u0434\u0435\u043b\u043e\u0432, \u0438\u0445 \u0440\u0430\u0437\u043c\u0435\u0440 \u0438 \u0432\u0435\u0442\u043e\u043a \u0440\u0435\u0435\u0441\u0442\u0440\u0430 \\ cd HKLM:\\ HKEY_LOCAL_MACHINE \\ cd HKCU:\\ HKEY_CURRENT_USER \\ Get-Item \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u043e \u0432\u0435\u0442\u043a\u0435 \u0440\u0435\u0435\u0441\u0442\u0440\u0430 \\ New-Item \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043d\u043e\u0432\u044b\u0439 \u0440\u0430\u0437\u0434\u0435\u043b \u0440\u0435\u0435\u0441\u0442\u0440\u0430 \\ Remove-Item \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u0435\u0442\u043a\u0443 \u0440\u0435\u0435\u0441\u0442\u0440\u0430 \\ Get-ItemProperty \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043a\u043b\u044e\u0447\u0435\u0439/\u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u043e\u0432 \u0440\u0435\u0435\u0441\u0442\u0440\u0430 (\u044d\u0442\u043e \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430 \u0432\u0435\u0442\u043a\u0438 \u0440\u0435\u0435\u0441\u0442\u0440\u0430, \u0430\u043d\u0430\u043b\u043e\u0433\u0438\u0447\u043d\u043e \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430\u043c \u0444\u0430\u0439\u043b\u0430) \\ Set-ItemProperty \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0438\u043b\u0438 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430 \u0440\u0435\u0435\u0441\u0442\u0440\u0430 \\ New-ItemProperty \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 \u0440\u0435\u0435\u0441\u0442\u0440\u0430 \\ Remove-ItemProperty \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 Get-ItemProperty HKLM:\\Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\* | Select DisplayName \u0441\u043f\u0438\u0441\u043e\u043a \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044b\u0445 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c \\ Get-Item HKCU:\\SOFTWARE\\Microsoft\\Office\\16.0\\Outlook\\Profiles\\Outlook\\9375CFF0413111d3B88A00104B2A6676\\00000002 \u043f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 Items \\ (Get-ItemProperty HKCU:\\SOFTWARE\\Microsoft\\Office\\16.0\\Outlook\\Profiles\\Outlook\\9375CFF0413111d3B88A00104B2A6676\\00000002).\"New Signature\" \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 (Value) \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430 (Property) Items \\ $reg_path = \"HKCU:\\SOFTWARE\\Microsoft\\Office\\16.0\\Outlook\\Profiles\\Outlook\\9375CFF0413111d3B88A00104B2A6676\\00000002\" \\ $sig_name = \"auto\" \\ Set-ItemProperty -Path $reg_path -Name \"New Signature\" -Value $sig_name \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0438\u043b\u0438 \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043a\u043e\u0440\u043d\u0435 \u0432\u0435\u0442\u043a\u0438 (Path) \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u043e (Name) \u0441\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435\u043c (Value) \\ Set-ItemProperty -Path $reg_path -Name \"Reply-Forward Signature\" -Value $sig_name Windows Registry Editor Version 5.00 [HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\taskmgr.exe] \"Debugger\"=\"\\\"C:\\\\Windows\\\\System32\\\\Taskmgr.exe\\\"\" Performance lodctr /R \u043f\u0435\u0440\u0435\u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0441\u0447\u0435\u0442\u0447\u0438\u043a\u043e\u0432 \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u0438 \u0438\u0437 \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u043e\u0433\u043e \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0430 \u0430\u0440\u0445\u0438\u0432\u043e\u0432 (\u0442\u0430\u043a \u0436\u0435 \u0438\u0441\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u0441\u0447\u0435\u0442\u0447\u0438\u043a\u0438 \u0434\u043b\u044f CIM, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0434\u043b\u044f cpu Win32_PerfFormattedData_PerfOS_Processor \u0438 iops Win32_PerfFormattedData_PerfDisk_PhysicalDisk) \\ (Get-Counter -ListSet *).CounterSetName \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0445 \u0441\u0447\u0435\u0442\u0447\u0438\u043a\u043e\u0432 \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u0438 \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435 \\ (Get-Counter -ListSet *memory*).Counter \u043f\u043e\u0438\u0441\u043a \u043f\u043e wildcard-\u0438\u043c\u0435\u043d\u0438 \u0432\u043e \u0432\u0441\u0435\u0445 \u0441\u0447\u0435\u0442\u0447\u0438\u043a\u0430\u0445 (\u0432\u043a\u043b\u044e\u0447\u0430\u044f \u0434\u043e\u0447\u0435\u0440\u043d\u0438\u0438) \\ Get-Counter \"\\Memory\\Available MBytes\" \u043e\u0431\u044a\u0435\u043c \u0441\u0432\u043e\u0431\u043e\u0434\u043d\u043e\u0439 \u043e\u043f\u0435\u0440\u0430\u0442\u0438\u0432\u043d\u043e\u0439 \u043f\u0430\u043c\u044f\u0442\u0438 \\ Get-Counter -cn $srv \"\\LogicalDisk(*)\\% Free Space\" % \u0441\u0432\u043e\u0431\u043e\u0434\u043d\u043e\u0433\u043e \u043c\u0435\u0441\u0442\u0430 \u043d\u0430 \u0432\u0441\u0435\u0445 \u0440\u0430\u0437\u0434\u0435\u043b\u0430\u0445 \u0434\u0438\u0441\u043a\u043e\u0432 \\ (Get-Counter \"\\Process(*)\\ID Process\").CounterSamples \\ Get-Counter \"\\Processor(_Total)\\% Processor Time\" \u2013ComputerName $srv -MaxSamples 5 -SampleInterval 2 5 \u043f\u0440\u043e\u0432\u0435\u0440\u043e\u043a \u043a\u0430\u0436\u0434\u044b\u0435 2 \u0441\u0435\u043a\u0443\u043d\u0434\u044b \\ Get-Counter \"\\\u041f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u0440(_Total)\\% \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d\u043d\u043e\u0441\u0442\u0438 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u0440\u0430\" -Continuous \u043d\u0435\u043f\u0440\u0435\u0440\u044b\u0432\u043d\u043e \\ (Get-Counter \"\\\u041f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u0440(*)\\% \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d\u043d\u043e\u0441\u0442\u0438 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u0440\u0430\").CounterSamples (Get-Counter -ListSet *\u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441*).Counter \u043d\u0430\u0439\u0442\u0438 \u0432\u0441\u0435 \u0441\u0447\u0435\u0442\u0447\u0438\u043a\u0438 \\ Get-Counter \"\\\u0421\u0435\u0442\u0435\u0432\u043e\u0439 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441(*)\\\u0412\u0441\u0435\u0433\u043e \u0431\u0430\u0439\u0442/\u0441\" \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u0430\u0434\u0430\u043f\u0442\u0435\u0440\u044b (\u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0434\u0435\u0439\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0439 \u043f\u043e \u0442\u0440\u0430\u0444\u0438\u043a\u0443) $WARNING = 25 $CRITICAL = 50 $TransferRate = ((Get-Counter \"\\\\huawei-mb-x-pro\\\u0441\u0435\u0442\u0435\u0432\u043e\u0439 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441(intel[r] wi-fi 6e ax211 160mhz)\\\u0432\u0441\u0435\u0433\u043e \u0431\u0430\u0439\u0442/\u0441\" ).countersamples | select -ExpandProperty CookedValue)*8 $NetworkUtilisation = [math]::round($TransferRate/1000000000*100,2) if ($NetworkUtilisation -gt $CRITICAL){ Write-Output \"CRITICAL: $($NetworkUtilisation) % Network utilisation, $($TransferRate.ToString('N0')) b/s\" #exit 2 } if ($NetworkUtilisation -gt $WARNING){ Write-Output \"WARNING: $($NetworkUtilisation) % Network utilisation, $($TransferRate.ToString('N0')) b/s\" #exit 1 } Write-Output \"OK: $($NetworkUtilisation) % Network utilisation, $($TransferRate.ToString('N0')) b/s\" #exit 0 SNMP Setup SNMP Service Install-WindowsFeature SNMP-Service,SNMP-WMI-Provider -IncludeManagementTools \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0440\u043e\u043b\u044c SNMP \u0438 WMI \u043f\u0440\u043e\u0432\u0430\u0439\u0434\u0435\u0440 \u0447\u0435\u0440\u0435\u0437 Server Manager \\ Get-WindowsFeature SNMP* \\ Add-WindowsCapability -Online -Name SNMP.Client~~~~0.0.1.0 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442 Feature On Demand \u0434\u043b\u044f Windows 10/11 \\ Get-Service SNMP \\ Get-NetFirewallrule -DisplayName snmp | ft \\ Get-NetFirewallrule -DisplayName snmp* | Enable-NetFirewallRule` Setting SNMP Service via Regedit Agent: \\ New-ItemProperty -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\services\\SNMP\\Parameters\\RFC1156Agent\" -Name \"sysContact\" -Value \"lifailon-user\" \u0441\u043e\u0437\u0434\u0430\u0442\u044c (New) \u0438\u043b\u0438 \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c (Set) \\ New-ItemProperty -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\services\\SNMP\\Parameters\\RFC1156Agent\" -Name \"sysLocation\" -Value \"plex-server\" Security: \\ New-Item -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\services\\SNMP\\Parameters\\TrapConfiguration\\public\" \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043d\u043e\u0432\u044b\u0439 community string \\ New-ItemProperty -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\Services\\SNMP\\Parameters\\ValidCommunities\" -Name \"public\" -Value 16 \u043d\u0430\u0437\u043d\u0430\u0447\u0438\u0442\u044c \u043f\u0440\u0430\u0432\u0430 \u043d\u0430 public \\ 1 \u2014 NONE \\ 2 \u2014 NOTIFY \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u044c SNMP \u043b\u043e\u0432\u0443\u0448\u043a\u0438 \\ 4 \u2014 READ ONLY \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0441 \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0430 \\ 8 \u2014 READ WRITE \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0438 \u0438\u0437\u043c\u0435\u043d\u044f\u0442\u044c \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044e \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0430 \\ 16 \u2014 READ CREATE \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0447\u0438\u0442\u0430\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435, \u0438\u0437\u043c\u0435\u043d\u044f\u0442\u044c \u0438 \u0441\u043e\u0437\u0434\u0430\u0432\u0430\u0442\u044c \u043e\u0431\u044a\u0435\u043a\u0442\u044b \\ New-ItemProperty -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\Services\\SNMP\\Parameters\\PermittedManagers\" -Name \"1\" -Value \"192.168.3.99\" \u043e\u0442 \u043a\u043e\u0433\u043e \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u043e \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0442\u044c \u0437\u0430\u043f\u0440\u043e\u0441\u044b \\ Get-Service SNMP | Restart-Service snmpwalk snmpwalk -v 2c -c public 192.168.3.100 \\ snmpwalk -v 2c -c public -O e 192.168.3.100 SNMP Modules Install-Module -Name SNMP \\ Get-SnmpData -IP 192.168.3.100 -OID 1.3.6.1.2.1.1.4.0 -UDPport 161 -Community public \\ (Get-SnmpData -IP 192.168.3.100 -OID 1.3.6.1.2.1.1.4.0).Data \\ Invoke-SnmpWalk -IP 192.168.3.100 -OID 1.3.6.1.2.1.1 \u043f\u0440\u043e\u0439\u0442\u0438\u0441\u044c \u043f\u043e \u0434\u0435\u0440\u0435\u0432\u0443 OID \\ Invoke-SnmpWalk -IP 192.168.3.100 -OID 1.3.6.1.2.1.25.6.3.1.2 \u0441\u043f\u0438\u0441\u043e\u043a \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u043e\u0433\u043e \u041f\u041e \\ Invoke-SnmpWalk -IP 192.168.3.100 -OID 1.3.6.1.2.1.25.2.3.1 \u0441\u043f\u0438\u0441\u043e\u043a \u0440\u0430\u0437\u0434\u0435\u043b\u043e\u0432 \u0438 \u043f\u0430\u043c\u044f\u0442\u0438 (C: D: Virtual Memory \u0438 Physical Memory) \\ Set-SnmpData \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 \u043d\u0430 \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u043e\u043c \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0435 Install-Module -Name SNMPv3 \\ Invoke-SNMPv3Get \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 \u043f\u043e \u043e\u0434\u043d\u043e\u043c\u0443 OID \\ Invoke-SNMPv3Set \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 \\ Invoke-SNMPv3Walk \u043e\u0431\u0445\u043e\u0434 \u043f\u043e \u0434\u0435\u0440\u0435\u0432\u0443 OID \\ Invoke-SNMPv3Walk -UserName lifailon -Target 192.168.3.100 -AuthSecret password -PrivSecret password -OID 1.3.6.1.2.1.1 -AuthType MD5 -PrivType AES128 Lextm.SharpSnmpLib \u0421\u0438\u043d\u0442\u0430\u043a\u0441\u0438\u0441 \\ Download lib Add-Type -LiteralPath \"$home\\Desktop\\lextm.sharpsnmplib-12.5.2\\net471\\SharpSnmpLib.dll\" $port = 161 $OID = \"1.3.6.1.2.1.1.4.0\" $variableList = New-Object Collections.Generic.List[Lextm.SharpSnmpLib.Variable] $variableList.Add([Lextm.SharpSnmpLib.Variable]::new([Lextm.SharpSnmpLib.ObjectIdentifier]::new($OID))) $timeout = 3000 [Net.IPAddress]$ip = \"192.168.3.100\" $endpoint = New-Object Net.IpEndPoint $ip, $port $Community = \"public\" [Lextm.SharpSnmpLib.VersionCode]$Version = \"V2\" $message = [Lextm.SharpSnmpLib.Messaging.Messenger]::Get( $Version, $endpoint, $Community, $variableList, $TimeOut ) $message.Data.ToString() Walk [Lextm.SharpSnmpLib.ObjectIdentifier]$OID = \"1.3.6.1.2.1.1\" # \u0434\u0435\u0440\u0435\u0432\u043e \u0438\u043b\u0438 \u043a\u043e\u043d\u0435\u0447\u043d\u044b\u0439 OID $WalkMode = [Lextm.SharpSnmpLib.Messaging.WalkMode]::WithinSubtree # \u0440\u0435\u0436\u0438\u043c \u043e\u0431\u0445\u043e\u0434\u0430 \u043f\u043e \u0434\u0435\u0440\u0435\u0432\u0443 $results = New-Object Collections.Generic.List[Lextm.SharpSnmpLib.Variable] $message = [Lextm.SharpSnmpLib.Messaging.Messenger]::Walk( $Version, $endpoint, $Community, $OID, $results, $TimeOut, $WalkMode ) $results $results2 = @() foreach ($d in $results) { $results2 +=[PSCustomObject]@{'ID'=$d.id.ToString();'Data'=$d.Data.ToString()} # \u043f\u0435\u0440\u0435\u043a\u043e\u0434\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u044b\u0432\u043e\u0434 \u043f\u043e\u0441\u0442\u0440\u043e\u0447\u043d\u043e \u0432 \u0441\u0442\u0440\u043e\u043a\u0443 } $results2 Zabbix Zabbix Agent Deploy $url = \"https://cdn.zabbix.com/zabbix/binaries/stable/6.4/6.4.5/zabbix_agent2-6.4.5-windows-amd64-static.zip\" $path = \"$home\\Downloads\\zabbix-agent2-6.4.5.zip\" $WebClient = New-Object System.Net.WebClient $WebClient.DownloadFile($url, $path)` \u0441\u043a\u0430\u0447\u0430\u0442\u044c \u0444\u0430\u0439\u043b Expand-Archive $path -DestinationPath \"C:\\zabbix-agent2-6.4.5\\\"` \u0440\u0430\u0437\u0430\u0440\u0445\u0438\u0432\u0438\u0440\u043e\u0432\u0430\u0442\u044c Remove-Item $path` \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0430\u0440\u0445\u0438\u0432 New-NetFirewallRule -DisplayName \"Zabbix-Agent\" -Profile Any -Direction Inbound -Action Allow -Protocol TCP -LocalPort 10050,10051` \u043e\u0442\u043a\u0440\u044b\u0442\u044c \u043f\u043e\u0440\u0442\u044b \u0432 FW $Zabbix_Server = \"192.168.3.102\" $conf = \"C:\\zabbix-agent2-6.4.5\\conf\\zabbix_agent2.conf\" $cat = cat $conf $rep = $cat -replace \"Server=.+\",\"Server=$Zabbix_Server\" $rep | Select-String Server= $rep > $conf $exe = \"C:\\zabbix-agent2-6.4.5\\bin\\zabbix_agent2.exe\" .$exe --config $conf --install` \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0441\u043b\u0443\u0436\u0431\u0443 Get-Service *Zabbix*Agent* | Start-Service` \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0441\u043b\u0443\u0436\u0431\u0443 #.$exe --config $conf --uninstall` \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u043b\u0443\u0436\u0431\u0443 zabbix_sender \u0421\u043e\u0437\u0434\u0430\u0442\u044c host - \u0437\u0430\u0434\u0430\u0442\u044c \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u043b\u044c\u043d\u043e\u0435 \u0438\u043c\u044f (powershell-host) \u0438 \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u0433\u0440\u0443\u043f\u043f\u0443 \\ \u0421\u043e\u0437\u0434\u0430\u0442\u044c Items: \\ Name: Service Count \\ Type: Zabbix trapper \\ Key: service.count \\ Type of Information: Numeric $path = \"C:\\zabbix-agent2-6.4.5\\bin\" $scount = (Get-Service).Count .$path\\zabbix_sender.exe -z 192.168.3.102 -s \"powershell-host\" -k service.count -o $scount zabbix_get apt install zabbix-get \\ nano /etc/zabbix/zabbix_agentd.conf \\ Server=127.0.0.1,192.168.3.102,192.168.3.99 \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u0434\u043b\u044f \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u0434\u0430\u043d\u043d\u044b\u0445 zabbix_get \u0441 \u0430\u0433\u0435\u043d\u0442\u0430 (\u043a\u0430\u043a \u0438\u0445 \u0437\u0430\u043f\u0440\u0430\u0448\u0438\u0432\u0430\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\u0440) .$path\\zabbix_get -s 192.168.3.101 -p 10050 -k agent.version \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0432\u0435\u0440\u0441\u0438\u044e \u0430\u0433\u0435\u043d\u0442\u0430 \\ .$path\\zabbix_get -s 192.168.3.101 -p 10050 -k agent.ping 1 - ok \\ .$path\\zabbix_get -s 192.168.3.101 -p 10050 -k net.if.discovery \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u0435\u0442\u0435\u0432\u044b\u0445 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u043e\u0432 \\ .$path\\zabbix_get -s 192.168.3.101 -p 10050 -k net.if.in[\"ens33\"] \\ .$path\\zabbix_get -s 192.168.3.101 -p 10050 -k net.if.out[\"ens33\"] UserParameter UserParameter=process.count,powershell -Command \"(Get-Process).Count\" \\ UserParameter=process.vm[*],powershell -Command \"(Get-Process $1).ws\" Test: \\ C:\\zabbix-agent2-6.4.5\\bin\\zabbix_get.exe -s 127.0.0.1 -p 10050 -k process.count \\ C:\\zabbix-agent2-6.4.5\\bin\\zabbix_get.exe -s 127.0.0.1 -p 10050 -k process.vm[zabbix_agent2] \\ C:\\zabbix-agent2-6.4.5\\bin\\zabbix_get.exe -s 127.0.0.1 -p 10050 -k process.vm[powershell] \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043d\u043e\u0432\u044b\u0435 Items: \\ key: process.count \\ key: process.vm[zabbix_agent2] Include \u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 Include \u0434\u043b\u044f \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0445 \u0444\u0430\u0439\u043b\u043e\u0432 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0430\u0435\u043c\u044b\u0445 \u043f\u043b\u0430\u0433\u0438\u043d\u043e\u0432 'Include=.\\zabbix_agent2.d\\plugins.d\\*.conf' >> C:\\zabbix-agent2-6.4.5\\conf\\zabbix_agent2.conf \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0439 \u0444\u0430\u0439\u043b \u0441 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u0441\u043a\u0438\u043c\u0438 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u043c\u0438 \u0432 \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0435, \u043f\u0443\u0442\u044c \u043a \u043a\u043e\u0442\u043e\u0440\u043e\u043c\u0443 \u0443\u043a\u0430\u0437\u0430\u043d \u0432 zabbix_agentd.conf \\ 'UserParameter=Get-Query-Param[*],powershell.exe -noprofile -executionpolicy bypass -File C:\\zabbix-agent2-6.4.5\\conf\\zabbix_agent2.d\\scripts\\User-Sessions\\Get-Query-Param.ps1 $1' > C:\\zabbix-agent2-6.4.5\\conf\\zabbix_agent2.d\\plugins.d\\User-Sessions.conf \u041f\u043e\u043c\u0435\u0441\u0442\u0438\u0442\u044c \u0441\u043a\u0440\u0438\u043f\u0442 Get-Query-Param.ps1 \u0432 \u043a\u0430\u0442\u0430\u043b\u043e\u0433, \u043f\u0443\u0442\u044c \u043a \u043a\u043e\u0442\u043e\u0440\u043e\u043c\u0443 \u0443\u043a\u0430\u0437\u0430\u043d \u0432 User-Sessions.conf. \u0421\u043a\u0440\u0438\u043f\u0442 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u0441\u043a\u0438\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043e\u043d \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0435\u0442 \u043e\u0442 Zabbix \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u0434\u043b\u044f \u043f\u0435\u0440\u0435\u0434\u0430\u0447\u0438 \u0438\u0445 \u0432 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 \u0441\u043a\u0440\u0438\u043f\u0442\u0430. Param([string]$select) if ($select -eq \"ACTIVEUSER\") { (Get-Query | where status -match \"Active\").User } if ($select -eq \"INACTIVEUSER\") { (Get-Query | where status -match \"Disconnect\").User } if ($select -eq \"ACTIVECOUNT\") { (Get-Query | where status -match \"Active\").Status.Count } if ($select -eq \"INACTIVECOUNT\") { (Get-Query | where status -match \"Disconnect\").Status.Count } \u041f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0440\u0430\u0431\u043e\u0442\u0443 \u0441\u043a\u0440\u0438\u043f\u0442\u0430: $path = \"C:\\zabbix-agent2-6.4.5\\conf\\zabbix_agent2.d\\scripts\\User-Sessions\" \\ .$path\\Get-Query-Param.ps1 ACTIVEUSER \\ .$path\\Get-Query-Param.ps1 INACTIVEUSER \\ .$path\\Get-Query-Param.ps1 ACTIVECOUNT \\ .$path\\Get-Query-Param.ps1 INACTIVECOUNT \u0421\u043e\u0437\u0434\u0430\u0442\u044c Items \u0441 \u043a\u043b\u044e\u0447\u0430\u043c\u0438: Get-Query-Param[ACTIVEUSER] Type: Text \\ Get-Query-Param[INACTIVEUSER] Type: Text \\ Get-Query-Param[ACTIVECOUNT] Type: Int \\ Get-Query-Param[INACTIVECOUNT] Type: Int \u041c\u0430\u043a\u0440\u043e\u0441\u044b: {$ACTIVEMAX} = 16 \\ {$ACTIVEMIN} = 0 \u0422\u0440\u0438\u0433\u0433\u0435\u0440\u044b: last(/Windows-User-Sessions/Get-Query-Param[ACTIVECOUNT])>{$ACTIVEMAX} \\ min(/Windows-User-Sessions/Get-Query-Param[ACTIVECOUNT],24h)={$ACTIVEMIN} zabbix_agent2.conf # \u0410\u0433\u0435\u043d\u0442 \u043c\u043e\u0436\u0435\u0442 \u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c \u0432 \u043f\u0430\u0441\u0441\u0438\u0432\u043d\u043e\u043c (\u0441\u0435\u0440\u0432\u0435\u0440 \u0437\u0430\u0431\u0438\u0440\u0430\u0435\u0442 \u0441\u0430\u043c \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e) \u0438 \u0430\u043a\u0442\u0438\u0432\u043d\u043e\u043c \u0440\u0435\u0436\u0438\u043c\u0435 (\u0430\u0433\u0435\u043d\u0442 \u0441\u0430\u043c \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442): Server=192.168.3.102 ServerActive=192.168.3.102 # \u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0443\u043a\u0430\u0437\u0430\u0442\u044c hostname \u0434\u043b\u044f ServerActive: Hostname=huawei-book-01 # \u0415\u0441\u043b\u0438 \u043d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043e, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0434\u043b\u044f \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u0438 \u0438\u043c\u0435\u043d\u0438 \u0445\u043e\u0441\u0442\u0430 (\u0438\u0433\u043d\u043e\u0440\u0438\u0440\u0443\u0435\u0442\u0441\u044f, \u0435\u0441\u043b\u0438 \u0438\u043c\u044f \u0445\u043e\u0441\u0442\u0430 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043e): # HostnameItem=system.hostname # \u041a\u0430\u043a \u0447\u0430\u0441\u0442\u043e \u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0441\u043f\u0438\u0441\u043e\u043a \u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0445 \u043f\u0440\u043e\u0432\u0435\u0440\u043e\u043a, \u0432 \u0441\u0435\u043a\u0443\u043d\u0434\u0430\u0445 (Range: 60-3600): RefreshActiveChecks=120 # IP-\u0430\u0434\u0440\u0435\u0441 \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u0430 \u0434\u043b\u044f \u0438\u0441\u0445\u043e\u0434\u044f\u0449\u0438\u0445 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0439: # SourceIP= # \u0410\u0433\u0435\u043d\u0442 \u0431\u0443\u0434\u0435\u0442 \u0441\u043b\u0443\u0448\u0430\u0442\u044c \u043d\u0430 \u044d\u0442\u043e\u043c \u043f\u043e\u0440\u0442\u0443 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u043c (Range: 1024-32767): # ListenPort=10050 # \u0421\u043f\u0438\u0441\u043e\u043a IP-\u0430\u0434\u0440\u0435\u0441\u043e\u0432, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0430\u0433\u0435\u043d\u0442 \u0434\u043e\u043b\u0436\u0435\u043d \u043f\u0440\u043e\u0441\u043b\u0443\u0448\u0438\u0432\u0430\u0442\u044c \u0447\u0435\u0440\u0435\u0437 \u0437\u0430\u043f\u044f\u0442\u0443\u044e # ListenIP=0.0.0.0 # \u0410\u0433\u0435\u043d\u0442 \u0431\u0443\u0434\u0435\u0442 \u043f\u0440\u043e\u0441\u043b\u0443\u0448\u0438\u0432\u0430\u0442\u044c \u044d\u0442\u043e\u0442 \u043f\u043e\u0440\u0442 \u0434\u043b\u044f \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 \u0441\u0442\u0430\u0442\u0443\u0441\u0430 HTTP (Range: 1024-32767): # StatusPort= ControlSocket=\\\\.\\pipe\\agent.sock # \u041a\u0443\u0434\u0430 \u0432\u0435\u0441\u0442\u0438 \u0436\u0443\u0440\u043d\u0430\u043b (file/syslog/console): LogType=file LogFile=C:\\zabbix-agent2-6.4.5\\zabbix_agent2.log # \u0420\u0430\u0437\u043c\u0435\u0440 \u043b\u043e\u0433\u0430 \u043e\u0442 0-1024 MB (0 - \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u0440\u043e\u0442\u0430\u0446\u0438\u044e \u043b\u043e\u0433\u043e\u0432) LogFileSize=100 # \u0423\u0440\u043e\u0432\u0435\u043d\u044c \u043b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f. 4 - \u0434\u043b\u044f \u043e\u0442\u043b\u0430\u0434\u043a\u0438 (\u0432\u044b\u0434\u0430\u0435\u0442 \u043c\u043d\u043e\u0433\u043e \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438) DebugLevel=4 API Token Documentation $ip = \"192.168.3.102\" \\ $url = \"http://$ip/zabbix/api_jsonrpc.php\" $data = @{ \"jsonrpc\"=\"2.0\"; \"method\"=\"user.login\"; \"params\"=@{ \"username\"=\"Admin\";` \u0432 \u0432\u0435\u0440\u0441\u0438\u0438 \u0434\u043e 6.4 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 \"user\" \"password\"=\"zabbix\"; }; \"id\"=1; } $token = (Invoke-RestMethod -Method POST -Uri $url -Body ($data | ConvertTo-Json) -ContentType \"application/json\").Result $token = \"2eefd25fdf1590ebcdb7978b5bcea1fff755c65b255da8cbd723181b639bb789\" \u0441\u0433\u0435\u043d\u0435\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0442\u043e\u043a\u0435\u043d \u0432 UI (http://192.168.3.102/zabbix/zabbix.php?action=token.list) user.get $data = @{ \"jsonrpc\"=\"2.0\"; \"method\"=\"user.get\"; \"params\"=@{ }; \"auth\"=$token; \"id\"=1; } $users = (Invoke-RestMethod -Method POST -Uri $url -Body ($data | ConvertTo-Json) -ContentType \"application/json\").Result problem.get $data = @{ \"jsonrpc\"=\"2.0\"; \"method\"=\"problem.get\"; \"params\"=@{ }; \"auth\"=$token; \"id\"=1; } (Invoke-RestMethod -Method POST -Uri $url -Body ($data | ConvertTo-Json) -ContentType \"application/json\").Result host.get \u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u0445\u043e\u0441\u0442\u043e\u0432 (\u0438\u043c\u044f \u0438 id) Endpoint host host.create - creating new hosts \\ host.delete - deleting hosts \\ host.get - retrieving hosts \\ host.massadd - adding related objects to hosts \\ host.massremove - removing related objects from hosts \\ host.massupdate - replacing or removing related objects from hosts \\ host.update - updating hosts $data = @{ \"jsonrpc\"=\"2.0\"; \"method\"=\"host.get\"; \"params\"=@{ \"output\"=@(` \u043e\u0442\u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u044b\u0432\u043e\u0434 \"hostid\"; \"host\"; ); }; \"id\"=2; \"auth\"=$token; } $hosts = (Invoke-RestMethod -Method POST -Uri $url -Body ($data | ConvertTo-Json) -ContentType \"application/json\").Result $host_id = $hosts[3].hostid` \u0437\u0430\u0431\u0440\u0430\u0442\u044c id \u0445\u043e\u0441\u0442\u0430 \u043f\u043e \u0438\u043d\u0434\u0435\u043a\u0441\u0443 item.get \u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c id \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432 \u0434\u0430\u043d\u043d\u044b\u0445 \u043f\u043e \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u044e \u043a\u043b\u044e\u0447\u0430 \u0434\u043b\u044f \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0433\u043e \u0445\u043e\u0441\u0442\u0430 $data = @{ \"jsonrpc\"=\"2.0\"; \"method\"=\"item.get\"; \"params\"=@{ \"hostids\"=@($host_id);` \u043e\u0442\u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u043e \u0445\u043e\u0441\u0442\u0443 }; \"auth\"=$token; \"id\"=1; } $items = (Invoke-RestMethod -Method POST -Uri $url -Body ($data | ConvertTo-Json) -ContentType \"application/json\").Result $items_id = ($items | where key_ -match system.uptime).itemid` \u0437\u0430\u0431\u0440\u0430\u0442\u044c id \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 history.get \u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0432\u0441\u044e \u0438\u0441\u0442\u043e\u0440\u0438\u044e \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 \u043f\u043e \u0435\u0433\u043e id $data = @{ \"jsonrpc\"=\"2.0\"; \"method\"=\"history.get\"; \"params\"=@{ \"hostids\"=@($host_id); ` \u0444\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u044f \u043f\u043e \u0445\u043e\u0441\u0442\u0443 \"itemids\"=@($items_id);` \u0444\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u044f \u043f\u043e \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0443 \u0434\u0430\u043d\u043d\u044b\u0445 }; \"auth\"=$token; \"id\"=1; } $items_data_uptime = (Invoke-RestMethod -Method POST -Uri $url -Body ($data | ConvertTo-Json) -ContentType \"application/json\").Result` \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0432\u0441\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u043f\u043e \u043a\u043b\u044e\u0447\u0443 \u0443 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0433\u043e \u0445\u043e\u0441\u0442\u0430 Convert Secconds To TimeSpan and DateTime $sec = $items_data_uptime.value function ConvertSecondsTo-TimeSpan { param ( $insec ) $TimeSpan = [TimeSpan]::fromseconds($insec) \"{0:dd' day 'hh\\:mm\\:ss}\" -f $TimeSpan } $UpTime = ConvertSecondsTo-TimeSpan $sec[-1] Convert From Unix Time $time = $items_data_uptime.clock function ConvertFrom-UnixTime { param ( $intime ) $EpochTime = [DateTime]\"1/1/1970\" $TimeZone = Get-TimeZone $UTCTime = $EpochTime.AddSeconds($intime) $UTCTime.AddMinutes($TimeZone.BaseUtcOffset.TotalMinutes) } $GetDataTime = ConvertFrom-UnixTime $time[-1] ($hosts | where hostid -eq $host_id).host \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0438\u043c\u044f \u0445\u043e\u0441\u0442\u0430 \\ $UpTime \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0435 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0440\u0430\u0431\u043e\u0442\u044b \u0445\u043e\u0441\u0442\u0430 \\ $GetDataTime \u0432\u0440\u0435\u043c\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u043d\u043e\u0433\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f pki New-SelfSignedCertificate -CertStoreLocation Cert:\\LocalMachine\\My -DnsName \"$env:computername\" -FriendlyName \"Test Certificate\" -NotAfter (Get-Date).AddYears(5) \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0441\u0430\u043c\u043e\u043f\u043e\u0434\u043f\u0438\u0441\u0430\u043d\u043d\u044b\u0439 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 (\u0432 LocalMachine\\My - \u0421\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u044b \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0430\\\u041b\u0438\u0447\u043d\u043e\u0435) \u0441 \u0441\u0440\u043e\u043a\u043e\u043c \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f 5 \u043b\u0435\u0442 Get-ChildItem -Path Cert:\\CurrentUser\\Root\\ \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044b\u0445 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432 \u0432 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435 \u0414\u043e\u0432\u0435\u0440\u0435\u043d\u043d\u044b\u0435 \u043a\u043e\u0440\u043d\u0435\u0432\u044b\u0435 \u0426\u0421 \u0422\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \\ Get-ChildItem -Path Cert:\\CurrentUser\\My\\ \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u0430\u043c\u043e\u0437\u0430\u0432\u0435\u0440\u044f\u044e\u0449\u0438\u0445 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432 \u0432 \u041b\u0438\u0447\u043d\u043e\u0435 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435 \u0422\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \\ Get-ChildItem -Path Cert:\\LocalMachine\\My\\ \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u0430\u043c\u043e\u0437\u0430\u0432\u0435\u0440\u044f\u044e\u0449\u0438\u0445 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432 \u0432 \u041b\u0438\u0447\u043d\u043e\u0435 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435 \u041b\u043e\u043a\u0430\u043b\u044c\u043d\u043e\u0433\u043e \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0430 \\ Get-ChildItem -Path Cert:\\LocalMachine\\My\\ | select NotBefore,NotAfter,Thumbprint,Subject \u0441\u0440\u043e\u043a \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u0430 \\ Get-ChildItem -Path Cert:\\LocalMachine\\My\\ | where Thumbprint -eq D9356FB774EE0E6206B7D5B59B99102CA5B17BDA \u043f\u043e\u0438\u0441\u043a \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 \u043f\u043e \u043e\u0442\u043f\u0435\u0447\u0430\u0442\u043a\u0443 Get-ChildItem -Path $env:APPDATA\\Microsoft\\SystemCertificates\\My\\Certificates\\ \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u044b \u0432 \u0444\u0430\u0439\u043b\u043e\u0432\u043e\u0439 \u0441\u0438\u0441\u0442\u0435\u043c\u0435, \u043a\u0430\u0436\u0434\u044b\u0439 \u0444\u0430\u0439\u043b \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u0443, \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u043e\u043c\u0443 \u0432 \u043b\u0438\u0447\u043d\u043e\u043c \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \\ Get-ChildItem -Path $env:APPDATA\\Microsoft\\SystemCertificates\\My\\Keys\\ \u0441\u0441\u044b\u043b\u043a\u0438 \u043d\u0430 \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u0437\u0430\u043a\u0440\u044b\u0442\u044b\u0445 \u043a\u043b\u044e\u0447\u0435\u0439, \u0441\u043e\u0437\u0434\u0430\u043d\u043d\u044b\u0445 \u043f\u043e\u0441\u0442\u0430\u0432\u0449\u0438\u043a\u043e\u043c \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0430 \u043a\u043b\u044e\u0447\u0435\u0439 (KSP) \\ Get-ChildItem -Path HKCU:\\Software\\Microsoft\\SystemCertificates\\CA\\Certificates | ft -AutoSize \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432 \u0432 \u0440\u0435\u0435\u0441\u0442\u0440\u0435 \u0432\u043e\u0448\u0435\u0434\u0448\u0435\u0433\u043e \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0443 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f $cert = (Get-ChildItem -Path Cert:\\CurrentUser\\My\\)[1] \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 \\ $cert | Remove-Item \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 Export-Certificate -FilePath $home\\Desktop\\certificate.cer -Cert $cert \u044d\u043a\u0441\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 \\ $cert.HasPrivateKey \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0437\u0430\u043a\u0440\u044b\u0442\u043e\u0433\u043e \u043a\u043b\u044e\u0447\u0430 \\ $pass = \"password\" | ConvertTo-SecureString -AsPlainText -Force \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \u0434\u043b\u044f \u0448\u0438\u0444\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0437\u0430\u043a\u0440\u044b\u0442\u043e\u0433\u043e \u043a\u043b\u044e\u0447\u0430 \\ Export-PfxCertificate -FilePath $home\\Desktop\\certificate.pfx -Password $pass -Cert $certificate \u044d\u043a\u0441\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 \u0441 \u0437\u0430\u043a\u0440\u044b\u0442\u044b\u043c \u043a\u043b\u044e\u0447\u0435\u043c Import-Certificate -FilePath $home\\Desktop\\certificate.cer -CertStoreLocation Cert:\\CurrentUser\\My \u0438\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 \\ Import-PfxCertificate -Exportable -Password $pass -CertStoreLocation Cert:\\CurrentUser\\My -FilePath $home\\Desktop\\certificate.pfx OpenSSL Invoke-WebRequest -Uri https://slproweb.com/download/Win64OpenSSL_Light-3_1_1.msi -OutFile $home\\Downloads\\OpenSSL-Light-3.1.1.msi Start-Process $home\\Downloads\\OpenSSL-Light-3.1.1.msi -ArgumentList '/quiet' -Wait` \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c msi \u043f\u0430\u043a\u0435\u0442 \u0432 \u0442\u0438\u0445\u043e\u043c \u0440\u0435\u0436\u0438\u043c\u0435 (\u0437\u0430\u043f\u0443\u0441\u043a \u043e\u0442 \u0438\u043c\u0435\u043d\u0438 \u0410\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u0430) rm $home\\Downloads\\OpenSSL-Light-3.1.1.msi cd \"C:\\Program Files\\OpenSSL-Win64\\bin\" \u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \u0434\u043b\u044f PFX \\ openssl pkcs12 -in \"C:\\Cert\\domain.ru.pfx\" -out \"C:\\Cert\\domain.ru.pem\" -nodes \u044d\u043a\u0441\u043f\u043e\u0440\u0442\u0438\u0440\u0443\u0435\u043c \u0438\u043c\u0435\u044e\u0449\u0438\u0439\u0441\u044f \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 \u0438 \u0437\u0430\u043a\u0440\u044b\u0442\u044b\u0439 \u043a\u043b\u044e\u0447 \u0432 .pem-\u0444\u0430\u0439\u043b \u0431\u0435\u0437 \u043f\u0430\u0440\u043e\u043b\u044f \u0441 \u0443\u043a\u0430\u0437\u0430\u043d\u0438\u0435\u043c \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u043f\u0430\u0440\u043e\u043b\u044f \\ openssl pkcs12 -export -in \"C:\\Cert\\domain.ru.pem\" -out \"C:\\Cert\\domain.ru_password.pfx\" -nodes \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0438\u0440\u0443\u0435\u043c .pem \u043e\u0431\u0440\u0430\u0442\u043d\u043e \u0432 .pfx c \u0443\u043a\u0430\u0437\u0430\u043d\u0438\u0435\u043c \u043d\u043e\u0432\u043e\u0433\u043e \u043f\u0430\u0440\u043e\u043b\u044f \u041a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0438\u044f \u0438\u0437 \u0437\u0430\u043a\u0440\u044b\u0442\u043e\u0433\u043e \u0438 \u043e\u0442\u043a\u0440\u044b\u0442\u043e\u0433\u043e \u043a\u043b\u044e\u0447\u0430 PEM \u0432 PFX \\ openssl pkcs12 -export -in \"C:\\tmp\\vpn\\vpn.itproblog.ru-crt.pem\" -inkey \"C:\\tmp\\vpn\\vpn.itproblog.ru-key.pem\" -out \"C:\\tmp\\vpn\\vpn.iiproblog.ru.pfx\" \\ in \u2013 \u043f\u0443\u0442\u044c \u0434\u043e \u0444\u0430\u0439\u043b\u0430 \u0441 \u043e\u0442\u043a\u0440\u044b\u0442\u044b\u043c \u043a\u043b\u044e\u0447\u043e\u043c \\ inkey \u2013 \u043f\u0443\u0442\u044c \u0434\u043e \u0444\u0430\u0439\u043b\u0430 \u0441 \u0437\u0430\u043a\u0440\u044b\u0442\u044b\u043c \u043a\u043b\u044e\u0447\u043e\u043c \\ out \u2013 \u043f\u0443\u0442\u044c \u0434\u043e \u0444\u0430\u0439\u043b\u0430, \u0432 \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0431\u0443\u0434\u0435\u0442 \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u043d \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 (pfx) \u041a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0438\u044f PFX \u0432 CRT \\ openssl pkcs12 -in \"C:\\OpenSSL-Win64\\bin\\_.domain.ru.pfx\" -clcerts -out \"C:\\OpenSSL-Win64\\bin\\_.domain.ru.crt\" \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u0438 2 \u0440\u0430\u0437\u0430 \u043d\u043e\u0432\u044b\u0439 \u043f\u0430\u0440\u043e\u043b\u044c PEM pass phrase (\u0444\u0430\u0439\u043b \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 EGIN CERTIFICATE \u0438 BEGIN ENCRYPTED PRIVATE KEY) \\ openssl pkcs12 -in \"C:\\OpenSSL-Win64\\bin\\_.domain.ru.pfx\" -clcerts -nokeys -out \"C:\\OpenSSL-Win64\\bin\\_.domain.ru.crt\" \u0431\u0435\u0437 \u043a\u043b\u044e\u0447\u0430, \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043e\u0442\u043a\u0440\u044b\u0442\u0443\u044e \u0447\u0430\u0441\u0442\u044c (\u0444\u0430\u0439\u043b \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0442\u043e\u043b\u044c\u043a\u043e EGIN CERTIFICATE) \u041a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0438\u044f PFX \u0432 KEY \\ openssl pkcs12 -in \"C:\\OpenSSL-Win64\\bin\\_.domain.ru.pfx\" -nocerts -out \"C:\\OpenSSL-Win64\\bin\\_.domain.ru.key\" \u0444\u0430\u0439\u043b \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0442\u043e\u043b\u044c\u043a\u043e BEGIN ENCRYPTED PRIVATE KEY \u0421\u043d\u044f\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \u043a \u0437\u0430\u043a\u0440\u044b\u0442\u043e\u0433\u043e \u043a\u043b\u044e\u0447\u0430 .key \\ openssl rsa -in \"C:\\OpenSSL-Win64\\bin\\_.domain.ru.key\" -out \"C:\\OpenSSL-Win64\\bin\\_.domain.ru-decrypted.key\" CRT \u0438 KEY \u0432 PFX: \\ openssl pkcs12 -inkey certificate.key -in certificate.crt -export -out certificate.pfx OpenVPN Invoke-WebRequest -Uri https://swupdate.openvpn.org/community/releases/OpenVPN-2.6.5-I001-amd64.msi -OutFile $home\\Downloads\\OpenVPN-2.6.5.msi \\ Start-Process $home\\Downloads\\OpenVPN-2.6.5.msi -ArgumentList '/quiet /SELECT_OPENSSL_UTILITIES=1' -Wait \\ msiexec /i $home\\Downloads\\OpenVPN-2.6.5.msi ADDLOCAL=EasyRSA /passive /quiet # \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u044b\u0439 \u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442 EasyRSA Certificate Management Scripts \\ # msiexec /i $home\\Downloads\\OpenVPN-2.6.5.msi ADDLOCAL=OpenVPN.Service,Drivers,Drivers.Wintun,OpenVPN,OpenVPN.GUI,OpenVPN.GUI.OnLogon,EasyRSA /passive \u0432\u044b\u0431\u043e\u0440\u043e\u0447\u043d\u0430\u044f \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 \\ # Invoke-WebRequest -Uri https://github.com/OpenVPN/easy-rsa/releases/download/v3.1.5/EasyRSA-3.1.5-win64.zip -OutFile $home\\Downloads\\EasyRSA-3.1.5.zip \u0441\u043a\u0430\u0447\u0430\u0442\u044c \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u044b\u0439 \u043f\u0430\u043a\u0435\u0442 EasyRSA \\ rm $home\\Downloads\\OpenVPN-2.6.5.msi cd \"C:\\Program Files\\OpenVPN\\easy-rsa\" \\ Copy-Item vars.example vars \u0444\u0430\u0439\u043b \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438 \u0434\u043b\u044f EasyRSA set_var EASYRSA_TEMP_DIR \"$EASYRSA_PKI\" set_var EASYRSA_REQ_COUNTRY \"RU\" set_var EASYRSA_REQ_PROVINCE \"MSK\" set_var EASYRSA_REQ_CITY \"MSK\" set_var EASYRSA_REQ_ORG \"FAILON.NET\" set_var EASYRSA_REQ_EMAIL \"lifailon@domain.ru\" set_var EASYRSA_REQ_OU \"IT\" #set_var EASYRSA_KEY_SIZE 2048 #set_var EASYRSA_CA_EXPIRE 3650 #set_var EASYRSA_CERT_EXPIRE 825 .\\EasyRSA-Start.bat \u0441\u0440\u0435\u0434\u0430 EasyRSA Shell \\ easyrsa init-pki \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f PKI, \u0441\u043e\u0437\u0434\u0430\u0435\u0442 \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u044e: C:\\Program Files\\OpenVPN\\easy-rsa\\pki \u0438 \u0447\u0438\u0442\u0430\u0435\u0442 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \u0444\u0430\u0439\u043b\u0430 \\easy-rsa\\vars \\ easyrsa build-ca \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f \u043a\u043e\u0440\u043d\u0435\u0432\u043e\u0433\u043e CA \u0441 \u0443\u043a\u0430\u0437\u0430\u043d\u0438\u0435\u043c \u043f\u0430\u0440\u043e\u043b\u044f \u0438 \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u043b\u044c\u043d\u043e\u0435 \u0438\u043c\u044f \u0441\u0435\u0440\u0432\u0435\u0440\u0430 (\\pki\\ca.crt \u0438 \\pki\\private\\ca.key) \\ easyrsa gen-req server nopass \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u0430 \u0438 \u043a\u043b\u044e\u0447 \u0434\u043b\u044f \u0441\u0435\u0440\u0432\u0435\u0440\u0430 OpenVPN - yes (\\pki\\reqs\\server.req \u0438 \\pki\\private\\server.key) \\ easyrsa sign-req server server \u043f\u043e\u0434\u043f\u0438\u0441\u0430\u0442\u044c \u0437\u0430\u043f\u0440\u043e\u0441 \u043d\u0430 \u0432\u044b\u043f\u0443\u0441\u043a \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e CA - yes (\\pki\\issued\\server.crt) \\ easyrsa gen-dh \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043a\u043b\u044e\u0447 \u0414\u0438\u0444\u0444\u0438-\u0425\u0435\u043b\u043b\u043c\u0430\u043d\u0430 (\\pki\\dh.pem) \\ easyrsa gen-req client1 nopass \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u0430 \u0438 \u043a\u043b\u044e\u0447 \u0434\u043b\u044f \u043a\u043b\u0438\u0435\u043d\u0442\u0430 OpenVPN (\\pki\\reqs\\client1.req \u0438 \\pki\\private\\client1.key) \\ easyrsa sign-req client client1 \u043f\u043e\u0434\u043f\u0438\u0441\u0430\u0442\u044c \u0437\u0430\u043f\u0440\u043e\u0441 \u043d\u0430 \u0432\u044b\u043f\u0443\u0441\u043a \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u0430 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e CA - yes (\\pki\\issued\\client1.crt) \\ easyrsa revoke client1 \u043e\u0442\u043e\u0437\u0432\u0430\u0442\u044c \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \\ openssl rsa -in \"C:\\Program Files\\OpenVPN\\easy-rsa\\pki\\private\\client1.key\" -out \"C:\\Program Files\\OpenVPN\\easy-rsa\\pki\\private\\client1_nopass.key\" \u0441\u043d\u044f\u0442\u044c \u0437\u0430\u0449\u0438\u0442\u0443 \u043f\u0430\u0440\u043e\u043b\u0435\u043c \u0434\u043b\u044f \u043a\u043b\u044e\u0447\u0430 (BEGIN ENCRYPTED PRIVATE KEY -> BEGIN PRIVATE KEY) \\ exit \\ cd \"C:\\Program Files\\OpenVPN\\bin\" \\ .\\openvpn --genkey secret ta.key \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f \u043a\u043b\u044e\u0447\u0430 tls-auth (\\bin\\ta.key) \\ Move-Item \"C:\\Program Files\\OpenVPN\\bin\\ta.key\" \"C:\\Program Files\\OpenVPN\\easy-rsa\\pki\\\" server.ovpn # Copy-Item \"C:\\Program Files\\OpenVPN\\sample-config\\server.ovpn\" \"C:\\Program Files\\OpenVPN\\config-auto\\server.ovpn\" \\ New-Item -ItemType File -Path \"C:\\Program Files\\OpenVPN\\config-auto\\server.ovpn\" port 1194 proto udp # \u0427\u0442\u043e \u0438\u043c\u0435\u043d\u043d\u043e \u0438\u043d\u043a\u0430\u043f\u0441\u0443\u043b\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u0442\u0443\u043d\u043d\u0435\u043b\u0435 (ethernet \u0444\u0440\u0435\u0439\u043c\u044b - tap \u0438\u043b\u0438 ip \u043f\u0430\u043a\u0435\u0442\u044b - tun) dev tun ca \"C:\\\\Program Files\\\\OpenVPN\\\\easy-rsa\\\\pki\\\\ca.crt\" cert \"C:\\\\Program Files\\\\OpenVPN\\\\easy-rsa\\\\pki\\\\issued\\\\server.crt\" key \"C:\\\\Program Files\\\\OpenVPN\\\\easy-rsa\\\\pki\\\\private\\\\server.key\" dh \"C:\\\\Program Files\\\\OpenVPN\\\\easy-rsa\\\\pki\\\\dh.pem\" server 192.168.4.0 255.255.255.0 # \u0425\u0440\u0430\u043d\u0438\u0442 \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u043e\u043f\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u044f ip \u0434\u043b\u044f \u043a\u043b\u0438\u0435\u043d\u0442\u043e\u0432, \u0447\u0442\u043e \u0431\u044b \u043d\u0430\u0437\u043d\u0430\u0447\u0438\u0442\u044c \u0442\u043e\u0442 \u0436\u0435 \u0430\u0434\u0440\u0435\u0441 \u043f\u0440\u0438 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a\u0435 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 # ifconfig-pool-persist \"C:\\\\Program Files\\\\OpenVPN\\\\dhcp-client-list.txt\" # \u0420\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u044c \u043a\u043b\u0438\u0435\u043d\u0442\u0430\u043c \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0430\u0442\u044c\u0441\u044f \u043f\u043e\u0434 \u043e\u0434\u043d\u0438\u043c \u043a\u043b\u044e\u0447\u043e\u043c # duplicate-cn # max-clients 30 # \u0420\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u044c \u043e\u0431\u043c\u0435\u043d \u0442\u0440\u0430\u0444\u0438\u043a\u043e\u043c \u043c\u0435\u0436\u0434\u0443 \u043a\u043b\u0438\u0435\u043d\u0442\u0430\u043c\u0438 client-to-client # compress tls-auth \"C:\\\\Program Files\\\\OpenVPN\\\\easy-rsa\\\\pki\\\\ta.key\" 0 cipher AES-256-GCM keepalive 20 60 # \u041d\u0435 \u043f\u0435\u0440\u0435\u0447\u0438\u0442\u0430\u0432\u0430\u0442\u044c \u0444\u0430\u0439\u043b\u044b \u043a\u043b\u044e\u0447\u0435\u0439 \u043f\u0440\u0438 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a\u0435 \u0442\u0443\u043d\u043d\u0435\u043b\u044f persist-key # \u041e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 \u0431\u0435\u0437 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0430 tun/tap \u043f\u0440\u0438 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a\u0435 OpenVPN persist-tun status \"C:\\\\Program Files\\\\OpenVPN\\\\log\\\\status.log\" log \"C:\\\\Program Files\\\\OpenVPN\\\\log\\\\openvpn.log\" verb 3 mute 20 windows-driver wintun # \u041e\u0442\u043a\u0440\u044b\u0442\u044c \u0434\u043e\u0441\u0442\u0443\u043f \u043a \u043f\u043e\u0434\u0441\u0435\u0442\u0438 \u0437\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u043c push \"route 192.168.3.0 255.255.255.0\" push \"route 192.168.4.0 255.255.255.0\" # \u0417\u0430\u0432\u0435\u0440\u043d\u0443\u0442\u044c \u0432\u0441\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u044b \u043a\u043b\u0438\u0435\u043d\u0442\u0430 (\u0432 \u0442\u043e\u043c \u0447\u0438\u0441\u043b\u0435 \u0418\u043d\u0442\u0435\u0440\u043d\u0435\u0442 \u0442\u0440\u0430\u0444\u0438\u043a) \u043d\u0430 OpenVPN \u0441\u0435\u0440\u0432\u0435\u0440 # push \"redirect-gateway def1\" # push \"dhcp-option DNS 192.168.3.101\" # push \"dhcp-option DOMAIN failon.net\" New-NetFirewallRule -DisplayName \"AllowOpenVPN-In\" -Direction Inbound -Protocol UDP \u2013LocalPort 1194 -Action Allow \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435 \\ New-NetFirewallRule -DisplayName \"AllowOpenVPN-Out\" -Direction Outbound -Protocol UDP \u2013LocalPort 1194 -Action Allow \u043d\u0430 \u043a\u043b\u0438\u0435\u043d\u0442\u0435 \\ Get-Service *openvpn* | Restart-Service client.ovpn # Copy-Item \"C:\\Program Files\\OpenVPN\\sample-config\\client.ovpn\" \"C:\\Program Files\\OpenVPN\\config-auto\\client.ovpn\" \\ New-Item -ItemType File -Path \"C:\\Program Files\\OpenVPN\\config-auto\\client.ovpn\" client dev tun proto udp remote 26.115.154.67 1194 resolv-retry infinite nobind persist-key persist-tun ca ca.crt cert client1.crt key client1.key remote-cert-tls server tls-auth ta.key 1 cipher AES-256-GCM connect-retry-max 25 # \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0434\u0440\u0430\u0439\u0432\u0435\u0440 wintun \u0438 \u043f\u043e\u043b\u043d\u044b\u0439 \u043f\u0443\u0442\u044c \u0434\u043e \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432 \u043f\u0440\u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0438 openvpn gui windows-driver wintun verb 3 Client iwr -Uri https://openvpn.net/downloads/openvpn-connect-v3-windows.msi -OutFile \"$home\\downloads\\OpenVPN-Connect-3.msi\" \\ \u041f\u0435\u0440\u0435\u0434\u0430\u0442\u044c \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044e \u0438 \u043a\u043b\u044e\u0447\u0438: \\ client.ovpn \\ ca.crt \\ dh.pem \\ ta.key \\ client1.crt \\ client1.key Route Get-Service RemoteAccess | Stop-Service \\ Set-ItemProperty -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\Services\\Tcpip\\Parameters\" -Name \"IPEnableRouter\" -Value 1 \u0432\u043a\u043b\u044e\u0447\u0430\u0435\u0442 IP \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0430\u0446\u0438\u044e \\ (Get-ItemProperty \"HKLM:\\SYSTEM\\CurrentControlSet\\Services\\Tcpip\\Parameters\").IPEnableRouter \\ Get-NetIPInterface | select ifIndex,InterfaceAlias,AddressFamily,ConnectionState,Forwarding | ft \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u0435\u0442\u0435\u0432\u044b\u0435 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u044b \\ Set-NetIPInterface -ifIndex 13 -Forwarding Enabled \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043f\u0435\u0440\u0435\u0430\u0434\u0440\u0435\u0441\u0430\u0446\u0438\u044e \u043d\u0430 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u0435 sysctl net.ipv4.ip_forward=1 \\ echo \"sysctl net.ipv4.ip_forward = 1\" >> /etc/sysctl.conf Get-NetRoute \\ New-NetRoute -DestinationPrefix \"192.168.3.0/24\" -NextHop \"192.168.4.1\" -InterfaceIndex 8 \\ route -p add 192.168.3.0 mask 255.255.255.0 192.168.4.1 metric 1 \\ route -p change 192.168.3.0 mask 255.255.255.0 192.168.4.1 metric 2 \\ route -p add 192.168.3.0 mask 255.255.255.0 192.168.4.1 metric 1 if 7 \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u043d\u043e\u043c\u0435\u0440 \u0441\u0435\u0442\u0435\u0432\u043e\u0433\u043e \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u0430 \u043d\u0430 \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043f\u043e\u0441\u044b\u043b\u0430\u0442\u044c \u043f\u0430\u043a\u0435\u0442 (Wintun Userspace Tunnel) \\ route print -4 \\ route delete 192.168.3.0 tracert 192.168.3.101 \u0441 192.168.4.6 1 17 ms * 22 ms 192.168.4.1 2 12 ms 13 ms 14 ms 192.168.3.101 route add -net 192.168.4.0 netmask 255.255.255.0 gw 192.168.3.100 \\ route -e traceroute 192.168.4.6 \u0441 192.168.3.101 1 192.168.3.100 (192.168.3.100) 0.148 ms 0.110 ms 0.106 ms 2 192.168.4.6 (192.168.4.6) 14.573 ms * * ping 192.168.3.101 -t \u0441 192.168.4.6 \\ tcpdump -n -i ens33 icmp \u043d\u0430 192.168.3.101 14:36:34.533771 IP 192.168.4.6 > 192.168.3.101: ICMP echo request, id 1, seq 2962, length 40 # \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u043b \u0437\u0430\u043f\u0440\u043e\u0441 14:36:34.533806 IP 192.168.3.101 > 192.168.4.6: ICMP echo reply, id 1, seq 2962, length 40 # \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u043b \u043e\u0442\u0432\u0435\u0442 NAT Get-Command -Module NetNat \\ New-NetNat -Name LocalNat -InternalIPInterfaceAddressPrefix \"192.168.3.0/24\" \\ Add-NetNatStaticMapping -NatName LocalNat -Protocol TCP -ExternalIPAddress 0.0.0.0 -ExternalPort 80 -InternalIPAddress 192.168.3.102 -InternalPort 80 \\ Remove-NetNatStaticMapping -StaticMappingID 0 \\ Remove-NetNat -Name LocalNat WireGuard Invoke-WebRequest \"https://download.wireguard.com/windows-client/wireguard-amd64-0.5.3.msi\" -OutFile \"$home\\Downloads\\WireGuard-Client-0.5.3.msi\" \\ msiexec.exe /i \"$home\\Downloads\\WireGuard-Client-0.5.3.msi\" DO_NOT_LAUNCH=1 /qn \\ Invoke-WebRequest \"http://www.wiresock.net/downloads/wiresock-vpn-gateway-x64-1.1.4.1.msi\" -OutFile \"$home\\Downloads\\WireSock-VPN-Gateway-1.1.4.1.msi\" \\ msiexec.exe /i \"http://www.wiresock.net/downloads/wiresock-vpn-gateway-x64-1.1.4.1.msi\" /qn \\ $env:Path = [System.Environment]::GetEnvironmentVariable(\"Path\",\"Machine\") + \";\" + [System.Environment]::GetEnvironmentVariable(\"Path\",\"User\") \\ wg-quick-config -add -start \\ 26.115.154.67:8181 \\ 192.168.21.4/24 \\ Successfully saved client configuration: C:\\ProgramData\\NT KERNEL\\WireSock VPN Gateway\\wsclient_1.conf \\ Successfully saved server configuration: C:\\ProgramData\\NT KERNEL\\WireSock VPN Gateway\\wiresock.conf \\ get-service *wire* \\ wg show \\ wg-quick-config -add -restart add client wiresock.conf [Interface] PrivateKey = gCHC0g2JPwr6sXPiaOL4/KTkMyjN9TculrJUA/GORV8= Address = 192.168.21.5/24 ListenPort = 8181 [Peer] PublicKey = NoSxjew2RCHiUzI6mlahjd4I+0EcLsoYom/H01z91yU= AllowedIPs = 192.168.21.6/32 wsclient_1.conf (\u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u044b \u0434\u043b\u044f \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u0432 AllowedIPs) [Interface] PrivateKey = yIpRQRmaGrrk9Y+49E8JhEpFmKzSeecvUAdeNgf1hUM= Address = 192.168.21.6/24 DNS = 8.8.8.8, 1.1.1.1 MTU = 1420 [Peer] PublicKey = Fp7674VSYeGj8CYt6RCKR7Qz1y/IKUXCw8ImOFhX3hk= AllowedIPs = 192.168.21.0/24, 192.168.3.0/24 Endpoint = 26.115.154.67:8181 PersistentKeepalive = 25 VpnClient Get-Command -Module VpnClient \\ Add-VpnConnection -Name \"vpn-failon\" -ServerAddress \"26.115.154.67\" -TunnelType L2TP -L2tpPsk \"123098\" -EncryptionLevel \"Required\" -AuthenticationMethod MSChapv2 -RememberCredential -AllUserConnection \u2013PassThru -Force \\ -TunnelType PPTP/L2TP/SSTP/IKEv2/Automatic \\ -L2tpPsk \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043e\u0431\u0449\u0438\u0439 \u043a\u043b\u044e\u0447 \u0434\u043b\u044f \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438 (\u0431\u0435\u0437 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430, \u0434\u043b\u044f L2TP \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442) \\ -AuthenticationMethod Pap/Chap/MSChapv2/Eap/MachineCertificate \\ -EncryptionLevel NoEncryption/Optional/Required/Maximum/Custom \\ -SplitTunneling \u0437\u0430\u0432\u043e\u0440\u0430\u0447\u0438\u0432\u0430\u0442\u044c \u0432\u0435\u0441\u044c \u0442\u0440\u0430\u0444\u0438\u043a \u0447\u0435\u0440\u0435\u0437 VPN-\u0442\u0443\u043d\u043d\u0435\u043b\u044c (\u0432\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 Use default gateway on remote network \u0432 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430\u0445 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430 VPN \u0430\u0434\u0430\u043f\u0442\u0435\u0440\u0430) \\ -UseWinlogonCredential \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0443\u0447\u0435\u0442\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0434\u043b\u044f \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438 \u043d\u0430 VPN \u0441\u0435\u0440\u0432\u0435\u0440\u0435 \\ -RememberCredential \u0440\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u044c \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0442\u044c \u0443\u0447\u0435\u0442\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0434\u043b\u044f VPN \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f (\u0443\u0447\u0435\u0442\u043d\u0430\u044f \u0437\u0430\u043f\u0438\u0441\u044c \u0438 \u043f\u0430\u0440\u043e\u043b\u044c \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u044e\u0442\u0441\u044f \u0432 \u0434\u0438\u0441\u043f\u0435\u0442\u0447\u0435\u0440 \u0443\u0447\u0435\u0442\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445 Windows \u043f\u043e\u0441\u043b\u0435 \u043f\u0435\u0440\u0432\u043e\u0433\u043e \u0443\u0441\u043f\u0435\u0448\u043d\u043e\u0433\u043e \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f) \\ -DnsSuffix domain.local \\ -AllUserConnection \u0440\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u044c \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c VPN \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u0432\u0441\u0435\u0445 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0430 (\u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u0442\u0441\u044f \u0432 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0439 \u0444\u0430\u0439\u043b: C:\\ProgramData\\Microsoft\\Network\\Connections\\Pbk\\rasphone.pbk) Install-Module -Name VPNCredentialsHelper \u043c\u043e\u0434\u0443\u043b\u044c \u0434\u043b\u044f \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u043b\u043e\u0433\u0438\u043d\u0430 \u0438 \u043f\u0430\u0440\u043e\u043b\u044f \u0432 Windows Credential Manager \u0434\u043b\u044f VPN \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \\ Set-VpnConnectionUsernamePassword -connectionname vpn-failon -username user1 -password password rasdial \"vpn-failon\" \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f \\ Get-VpnConnection -AllUserConnection | select * \u0441\u043f\u0438\u0441\u043e\u043a VPN \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f, \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0445 \u0434\u043b\u044f \u0432\u0441\u0435\u0445 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439, \u043d\u0430\u0439\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u0438 \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u0441\u0442\u0430\u0442\u0443\u0441 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f (ConnectionStatus) \\ Add-VpnConnectionRoute -ConnectionName vpn-failon -DestinationPrefix 192.168.3.0/24 \u2013PassThru \u0434\u0438\u043d\u0430\u043c\u0438\u0447\u0435\u0441\u043a\u0438 \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0443 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0430\u0446\u0438\u0438 \u043c\u0430\u0440\u0448\u0440\u0443\u0442, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0431\u0443\u0434\u0435\u0442 \u0430\u043a\u0442\u0438\u0432\u0435\u043d \u043f\u0440\u0438 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0438 \u043a VPN \\ Remove-VpnConnection -Name vpn-failon -AllUserConnection -Force \u0443\u0434\u0430\u043b\u0438\u0442\u044c Set-VpnConnection -Name \"vpn-failon\" -SplitTunneling $True \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0440\u0430\u0437\u0434\u0435\u043b\u044c\u043d\u043e\u0435 \u0442\u0443\u043d\u0435\u043b\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \\ Add-VpnConnectionRoute -ConnectionName \"vpn-failon\" -DestinationPrefix 172.22.22.0/24 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0430\u0446\u0438\u044e \u043a \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0439 \u043f\u043e\u0434\u0441\u0435\u0442\u0438 \u0447\u0435\u0440\u0435\u0437 VPN-\u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \\ (Get-VpnConnection -ConnectionName \"vpn-failon\").routes \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0442\u0430\u0431\u043b\u0438\u0446\u0443 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0430\u0446\u0438\u0438 \u0434\u043b\u044f \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0433\u043e \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f \\ Remove-VpnConnectionRoute -ConnectionName \"vpn-failon\" -DestinationPrefix \"172.22.23.0/24\" Proxy $user = \"lifailon\" \\ $pass = \"Proxy\" \\ $SecureString = ConvertTo-SecureString $pass -AsPlainText -Force \\ $Credential = New-Object System.Management.Automation.PSCredential($user, $SecureString) \\ [System.Net.Http.HttpClient]::DefaultProxy = New-Object System.Net.WebProxy(\"http://192.168.3.100:9090\") \\ [System.Net.Http.HttpClient]::DefaultProxy.Credentials = [System.Net.CredentialCache]::DefaultCredentials \\ [System.Net.Http.HttpClient]::DefaultProxy.Credentials = $Credential \\ Invoke-RestMethod http://ifconfig.me/ip \\ Invoke-RestMethod https://kinozal.tv/rss.xml netsh Proxy netsh interface portproxy add v4tov4 listenport=8080 listenaddress=0.0.0.0 connectport=80 connectaddress=192.168.3.108 \\ netsh interface portproxy show all \\ netsh interface portproxy delete v4tov4 listenport=8080 listenaddress=0.0.0.0 Wlan netsh wlan show profile \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u043d\u044b \u043f\u0440\u043e\u0444\u0438\u043b\u0435\u0439 Wi-Fi \u0438 \u043f\u0430\u0440\u043e\u043b\u0435\u0439 \\ netsh wlan show interfaces \u0445\u0430\u0440-\u043a\u0438 \u0442\u0435\u043a\u0443\u0449\u0435\u0439 \u0441\u0435\u0442\u0438 (MAC, speed) \\ netsh wlan show profile SSID-Name-Network key=clear \u043e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \\ netsh wlan show networks \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0438\u0434\u0435\u043c\u044b\u0445 \u0441\u0435\u0442\u0435\u0439 \\ netsh wlan disconnect \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f \u043e\u0442 Wi-Fi \\ netsh wlan connect name=\"SSID-Name-Network\" \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f \\ netsh wlan show drivers \u0434\u0440\u0430\u0439\u0432\u0435\u0440 Wi-Fi \\ netsh wlan set hostednetwork mode=allow ssid=\"WiFi-Test\" key=\"password\" \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0442\u043e\u0447\u043a\u0438 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 Wi-Fi (SoftAP) Firewall netsh advfirewall set allprofiles state off \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c fw \\ netsh advfirewall reset \u0441\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \\ netsh advfirewall firewall add rule name=\"Open Remote Desktop\" protocol=TCP dir=in localport=3389 action=allow \u043e\u0442\u043a\u0440\u044b\u0442\u044c \u043f\u043e\u0440\u0442 3389 \\ netsh advfirewall firewall add rule name=\"All ICMP V4\" dir=in action=allow protocol=icmpv4 \u043e\u0442\u043a\u0440\u044b\u0442\u044c icmp OpenSSH Get-WindowsCapability -Online | ? Name -like 'OpenSSH.Client*' \\ Add-WindowsCapability -Online -Name OpenSSH.Client* \\ dism /Online /Add-Capability /CapabilityName:OpenSSH.Client~~~~0.0.1.0 \\ iwr https://github.com/PowerShell/Win32-OpenSSH/releases/download/v9.2.2.0p1-Beta/OpenSSH-Win64-v9.2.2.0.msi -OutFile $home\\Downloads\\OpenSSH-Win64-v9.2.2.0.msi \u0441\u043a\u0430\u0447\u0430\u0442\u044c \\ msiexec /i $home\\Downloads\\OpenSSH-Win64-v9.2.2.0.msi \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c msi \u043f\u0430\u043a\u0435\u0442 \\ Set-Service sshd -StartupType Automatic \\ Get-NetTCPConnection | where LocalPort -eq 22 \\ New-NetFirewallRule -Name sshd -DisplayName 'OpenSSH Server (sshd)' -Enabled True -Direction Inbound -Protocol TCP -Action Allow -LocalPort 22 \\ Get-NetFirewallRule -Name *ssh* \\ Start-Process notepad++ C:\\Programdata\\ssh\\sshd_config \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0439 \u0444\u0430\u0439\u043b \\ GSSAPIAuthentication yes \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c Kerberos \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u044e (\u0447\u0435\u0440\u0435\u0437 AD) \\ SyslogFacility LOCAL0 \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u043e\u0435 \u0432\u0435\u0434\u0435\u043d\u0438\u0435 \u0436\u0443\u0440\u043d\u0430\u043b\u0430 \u0432 \u0444\u0430\u0439\u043b (C:\\ProgramData\\ssh\\logs\\sshd.log) \\ LogLevel INFO \\ Restart-Service sshd \\ ssh -K $srv \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c Kerberos \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u044e \\ ssh Lifailon@192.168.3.99 -p 22 \\ pwsh -command Get-Service \\ ssh -L 3101:192.168.3.101:22 -R 3101:192.168.3.101:22 lifailon@192.168.3.101 -p 22 SSH Tunnel lifailon@localhost:3101 -> 192.168.3.101:3101 WinRM Enter-PSSession -ComputerName $srv \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f \u043a PowerShell \u0441\u0435\u0441\u0441\u0438\u0438 \u0447\u0435\u0440\u0435\u0437 PSRemoting. \u041f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0442\u043e\u043b\u044c\u043a\u043e \u043f\u043e FQDN-\u0438\u043c\u0435\u043d\u0438 \\ Invoke-Command $srv -ScriptBlock {Get-ComputerInfo} \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u043a\u043e\u043c\u0430\u043d\u0434\u044b \u0447\u0435\u0440\u0435\u0437 PSRemoting \\ $session = New-PSSession $srv \u043e\u0442\u043a\u0440\u044b\u0442\u044c \u0441\u0435\u0441\u0441\u0438\u044e \\ Get-PSSession \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0435 \u0441\u0435\u0441\u0441\u0438\u0438 \\ icm -Session $session {$srv = $using:srv} \u043f\u0435\u0440\u0435\u0434\u0430\u0442\u044c \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0443\u044e \u0442\u0435\u043a\u0443\u0449\u0435\u0439 \u0441\u0435\u0441\u0441\u0438\u0438 ($using) \u0432 \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u0443\u044e \\ Disconnect-PSSession $session \u0437\u0430\u043a\u0440\u044b\u0442\u044c \u0441\u0435\u0441\u0441\u0438\u044e \\ Remove-PSSession $session \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u0435\u0441\u0441\u0438\u044e \\ Import-Module -Name ActiveDirectory -PSSession $srv \u0438\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043c\u043e\u0434\u0443\u043b\u044c \u0441 \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u043e\u0433\u043e \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0430 \u0432 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u0443\u044e \u0441\u0435\u0441\u0441\u0438\u044e Windows Remote Management Configuration winrm quickconfig -quiet \u0438\u0437\u043c\u0435\u043d\u0438\u0442 \u0437\u0430\u043f\u0443\u0441\u043a \u0441\u043b\u0443\u0436\u0431\u044b WinRM \u043d\u0430 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439, \u0437\u0430\u0434\u0430\u0441\u0442 \u0441\u0442\u0430\u043d\u0434\u0430\u0440\u0442\u043d\u044b\u0435 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 WinRM \u0438 \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0438\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u0434\u043b\u044f \u043f\u043e\u0440\u0442\u043e\u0432 \u0432 fw \\ Enable-PSRemoting \u2013Force \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c PowerShell Remoting, \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u0434\u043b\u044f \u0434\u043e\u043c\u0435\u043d\u043d\u043e\u0433\u043e \u0438 \u0447\u0430\u0441\u0442\u043d\u043e\u0433\u043e \u0441\u0435\u0442\u0435\u0432\u044b\u0445 \u043f\u0440\u043e\u0444\u0438\u043b\u0435\u0439 Windows \\ Enable-PSRemoting -SkipNetworkProfileCheck -Force \u0434\u043b\u044f \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0430 \u0432 \u043e\u0431\u0449\u0435\u0439 (public) \u0441\u0435\u0442\u0438 (\u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u0441 \u0432\u0435\u0440\u0441\u0438\u0438 powershell 6) $NetProfiles = Get-NetConnectionProfile \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u0438 \u0441\u0435\u0442\u0435\u0432\u044b\u0445 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0439 \\ Set-NetConnectionProfile -InterfaceIndex $NetProfiles[1].InterfaceIndex -NetworkCategory Private \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0442\u0438\u043f \u0441\u0435\u0442\u0438 \u0434\u043b\u044f \u043f\u0440\u043e\u0444\u0438\u043b\u044f (DomainAuthenticated/Public) \\ (Get-CimInstance -ClassName Win32_ComputerSystem).PartOfDomain \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c, \u0447\u0442\u043e \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d \u0432 \u0434\u043e\u043c\u0435\u043d AD \\ Get-Service WinRM | Set-Service -StartupType AutomaticDelayedStart \u043e\u0442\u043b\u043e\u0436\u0435\u043d\u043d\u044b\u0439 \u0437\u0430\u043f\u0443\u0441\u043a \\ Get-Service -Name winrm -RequiredServices \u0441\u0442\u0430\u0442\u0443\u0441 \u0437\u0430\u0432\u0438\u0441\u0438\u043c\u044b\u0445 \u0441\u043b\u0443\u0436\u0431 \\ New-NetFirewallRule -Profile Any -DisplayName \"WinRM HTTP\" -Direction Inbound -Protocol TCP -LocalPort 5985,5986 \\ Test-NetConnection $srv -port 5895 \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u043f\u043e\u0440\u0442 \\ Test-WSMan $srv -ErrorAction Ignore \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0440\u0430\u0431\u043e\u0442\u0443 WinRM \u043d\u0430 \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u043e\u043c \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0435 (\u0438\u0433\u043d\u043e\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u044b\u0432\u043e\u0434 \u043e\u0448\u0438\u0431\u043e\u043a \u0434\u043b\u044f \u0441\u043a\u0440\u0438\u043f\u0442\u0430) \u0438\u043b\u0438 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u043e (localhost) $Cert = New-SelfSignedCertificate -CertStoreLocation Cert:\\LocalMachine\\My -DnsName \"$env:computername\" -FriendlyName \"WinRM HTTPS Certificate\" -NotAfter (Get-Date).AddYears(5) \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0441\u0430\u043c\u043e\u043f\u043e\u0434\u043f\u0438\u0441\u0430\u043d\u043d\u044b\u0439 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 \\ $Thumbprint = $Cert.Thumbprint \u0437\u0430\u0431\u0440\u0430\u0442\u044c \u043e\u0442\u043f\u0435\u0447\u0430\u0442\u043e\u043a \\ New-Item -Path WSMan:\\Localhost\\Listener -Transport HTTPS -Address * -CertificateThumbprint $Thumbprint -Name WinRM_HTTPS_Listener -Force \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u0440\u043e\u0441\u043b\u0443\u0448\u0438\u0432\u0430\u0442\u0435\u043b\u044c \\ New-NetFirewallRule -DisplayName 'WinRM HTTPS' -Profile Domain,Private -Direction Inbound -Action Allow -Protocol TCP -LocalPort 5986 \u043e\u0442\u043a\u0440\u044b\u0442\u044c \u043f\u043e\u0440\u0442 \u0432 fw $selector_set = @{ Address = \"*\" Transport = \"HTTPS\" } $value_set = @{ CertificateThumbprint = \"66ABFDA044D8C85135048186E2FDC0DBE6125163\" } New-WSManInstance -ResourceURI \"winrm/config/Listener\" -SelectorSet $selector_set -ValueSet $value_set winrm get winrm/config \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u044e \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044e (Client/Service) \\ winrm get winrm/config/service/auth \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435 \\ winrm enumerate winrm/config/listener \u0442\u0435\u043a\u0443\u0449\u0430\u044f \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f \u043f\u0440\u043e\u0441\u043b\u0443\u0448\u0438\u0432\u0430\u0442\u0435\u043b\u0435\u0439 WinRM (\u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u0442 \u043e\u0442\u043f\u0435\u0447\u0430\u0442\u043e\u043a \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u0430 \u0434\u043b\u044f HTTPS 5986) \\ Get-ChildItem -Path Cert:\\LocalMachine\\My\\ | where Thumbprint -eq D9356FB774EE0E6206B7D5B59B99102CA5B17BDA | select * \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043e \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u0435 ls WSMan:\\localhost\\Client \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044e \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \\ ls WSMan:\\localhost\\Service \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \\ ls WSMan:\\localhost\\Service\\auth \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0439 \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438 WinRM \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \\ Set-Item -path WSMan:\\localhost\\Service\\auth\\basic -value $true \u0440\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u044c \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u0443\u044e \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u044e \u043a \u0442\u0435\u043a\u0443\u0449\u0435\u043c\u0443 \u0441\u0435\u0440\u0432\u0435\u0440\u0443 \\ ls HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\WSMAN \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u0432 \u0440\u0435\u0435\u0441\u0442\u0440\u0435 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0434\u043b\u044f \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u0430\u0443\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438 \u0432 \\Service\\auth_basic = 1) \\ Set-Item WSMan:\\localhost\\Client\\TrustedHosts -Value 192.168.* -Force \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0434\u043e\u0432\u0435\u0440\u0435\u043d\u043d\u044b\u0435 \u0445\u043e\u0441\u0442\u044b \u0432 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044e \u043d\u0430 \u043a\u043b\u0438\u0435\u043d\u0442\u0435, \u0447\u0442\u043e\u0431\u044b \u0440\u0430\u0431\u043e\u0442\u0430\u043b\u0430 Negotiate \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u044f \u0447\u0435\u0440\u0435\u0437 NTLM \\ Set-Item WSMan:\\localhost\\Client\\TrustedHosts -Value 192.168.3.100 -Concatenate -Force \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432\u0442\u043e\u0440\u043e\u0439 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440 \\ ls WSMan:\\localhost\\Client\\TrustedHosts \\ Set-Item WSMan:\\localhost\\Client\\AllowUnencrypted $true \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043f\u0435\u0440\u0435\u0434\u0430\u0447\u0430 \u043d\u0435\u0437\u0430\u0448\u0438\u0444\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \\ Set-Item WSMan:\\localhost\\Service\\AllowUnencrypted $true \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043f\u0435\u0440\u0435\u0434\u0430\u0447\u0430 \u043d\u0435\u0437\u0430\u0448\u0438\u0444\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 (\u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0431\u044b\u0442\u044c \u0432 private \u0441\u0435\u0442\u0438) Get-PSSessionConfiguration \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c, \u0432\u043a\u043b\u044e\u0447\u0435\u043d \u043b\u0438 PSremoting \u0438 \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \u0438 \u0433\u0440\u0443\u043f\u043f, \u043a\u043e\u0442\u043e\u0440\u044b\u043c \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u043e \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0430\u0442\u044c\u0441\u044f \u0447\u0435\u0440\u0435\u0437 WinRM \\ Set-PSSessionConfiguration -Name Microsoft.PowerShell -ShowSecurityDescriptorUI \u043d\u0430\u0437\u043d\u0430\u0447\u0438\u0442\u044c \u043f\u0440\u0430\u0432\u0430 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u0447\u0435\u0440\u0435\u0437 \u0434\u0435\u0441\u043a\u0440\u0438\u043f\u0442\u043e\u0440 \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u0438 \u0442\u0435\u043a\u0443\u0449\u0435\u0439 \u0441\u0435\u0441\u0441\u0438\u0438 (\u0434\u043e \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u043a\u0438) \\ (Get-PSSessionConfiguration -Name \"Microsoft.PowerShell\").SecurityDescriptorSDDL \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u0434\u0435\u0441\u043a\u0440\u0438\u043f\u0442\u043e\u0440\u0430 \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 SDDL \\ Set-PSSessionConfiguration -Name Microsoft.PowerShell -SecurityDescriptorSDDL $SDDL \u043f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u0434\u0435\u0441\u043a\u0440\u0438\u043f\u0442\u043e\u0440\u0430 \u043d\u0430 \u0434\u0440\u0443\u0433\u043e\u043c \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0435 \u0431\u0435\u0437 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f GUI \\ New-LocalUser \"WinRM-Writer\" -Password (ConvertTo-SecureString -AsPlainText \"123098\") \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \\ Add-LocalGroupMember -Group \"Remote Management Users\" -Member \"WinRM-Writer\" \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f WinRM-Writer \u0432 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u0443\u044e \u0433\u0440\u0443\u043f\u043f\u0443 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438 \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u043e\u0433\u043e \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u044f\" \\ cmdkey /add:192.168.3.99 /user:WinRM-Writer /pass:123098 \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \u0432 CredentialManager cmdkey /list \\ Import-Module CredentialManager \\ Add-Type -AssemblyName System.Web \\ New-StoredCredential -Target 192.168.3.99 -UserName WinRM-Writer -Password 123098 -Comment WinRM \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \u0432 CredentialManager (\u0438\u0437 PS5) \\ Get-StoredCredential -AsCredentialObject \\ $cred = Get-StoredCredential -Target 192.168.3.99 \\ Enter-PSSession -ComputerName 192.168.3.99 -Credential $cred -Authentication Negotiate \\ Enter-PSSession -ComputerName 192.168.3.99 -Credential $cred -Authentication Basic -Port 5985 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u043f\u0440\u0438 \u043e\u0442\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0438 allowunencrypted \u043d\u0430 \u0441\u0442\u043e\u0440\u043e\u043d\u0435 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u0438 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \\ winrs -r:http://192.168.3.100:5985/wsman -u:WinRM-Writer -p:123098 ipconfig \u043f\u0435\u0440\u0435\u0434\u0430\u0442\u044c \u043a\u043e\u043c\u0430\u043d\u0434\u0443 \u0447\u0435\u0440\u0435\u0437 winrs (-?) \\ winrs -r:https://192.168.3.100:5985/wsman -u:WinRM-Writer -p:123098 -ssl ipconfig \u0447\u0435\u0440\u0435\u0437 https \\ pwsh -Command \"Install-Module -Name PSWSMan\" \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043c\u043e\u0434\u0443\u043b\u044c \u0434\u043b\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f \u0432 Linux \u0441\u0438\u0441\u0442\u0435\u043c\u0435 Kerberos .\\CheckMaxTokenSize.ps1 -Principals login -OSEmulation $true -Details $true \u0443\u0437\u043d\u0430\u0442\u044c \u0440\u0430\u0437\u043c\u0435\u0440 \u0442\u043e\u043a\u0435\u043d\u0430 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0432 \u0434\u043e\u043c\u0435\u043d\u0435 \\ Get-ItemProperty -Path HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\Kerberos\\Parameters | select maxtokensize \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439 \u0440\u0430\u0437\u043c\u0435\u0440 \u0442\u043e\u043a\u0435\u043d\u0430 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435 \\ HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\services\\HTTP\\Parameters \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0440\u0430\u0437\u043c\u0435\u0440\u0430, \u0435\u0441\u043b\u0438 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a \u043f\u0430\u043a\u0435\u0442\u0430 \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438 \u043f\u0440\u0435\u0432\u044b\u0448\u0430\u0435\u0442 16 \u041a\u0431 (\u0438\u0437 \u0437\u0430 \u0431\u043e\u043b\u044c\u0448\u043e\u0433\u043e \u043a\u043e\u043b-\u0432\u0430 \u0433\u0440\u0443\u043f\u043f) \\ MaxFieldLength \u0443\u0432\u0435\u043b\u0438\u0447\u0438\u0442\u044c \u0434\u043e 0000ffff (65535) \\ MaxRequestBytes \u0443\u0432\u0435\u043b\u0438\u0447\u0438\u0442\u044c \u0434\u043e 0000ffff (65535) PackageManagement Import-Module PackageManagement \u0438\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043c\u043e\u0434\u0443\u043b\u044c \\ Get-Module PackageManagement \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043e \u043c\u043e\u0434\u0443\u043b\u0435 \\ Get-Command -Module PackageManagement \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u043a\u043e\u043c\u0430\u043d\u0434\u043b\u0435\u0442\u044b \u043c\u043e\u0434\u0443\u043b\u044f \\ Get-Package \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044b\u0435 \u043f\u0430\u043a\u0435\u0442\u044b PowerShellGallery \\ Get-Package -ProviderName msi,Programs \u0441\u043f\u0438\u0441\u043e\u043a \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044b\u0445 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12 \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u043f\u0440\u043e\u0442\u043e\u043a\u043e\u043b TLS 1.2 (\u0435\u0441\u043b\u0438 \u043d\u0435 \u043e\u0442\u043a\u043b\u044e\u0447\u0435\u043d\u044b \u043f\u0440\u043e\u0442\u043e\u043a\u043e\u043b\u044b TLS 1.0 \u0438 1.1) \\ Find-PackageProvider \u043f\u043e\u0438\u0441\u043a \u043f\u0440\u043e\u0432\u0430\u0439\u0434\u0435\u0440\u043e\u0432 \\ Install-PackageProvider PSGallery -force \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a \\ Install-PackageProvider NuGet -force \\ Install-PackageProvider Chocolatey -force \\ Get-PackageSource \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u0438 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \u043f\u0430\u043a\u0435\u0442\u043e\u0432 \\ Set-PackageSource -Name PSGallery -Trusted \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \\ Find-Package -Name *Veeam* -Source PSGallery \u043f\u043e\u0438\u0441\u043a \u043f\u0430\u043a\u0435\u0442\u043e\u0432 \u0441 \u0443\u043a\u0430\u0437\u0430\u043d\u0438\u0435\u043c \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u0430 \\ Install-Package -Name VeeamLogParser -ProviderName PSGallery -scope CurrentUser \\ Get-Command *Veeam* \\ Import-Module -Name VeeamLogParser \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u043c\u043e\u0434\u0443\u043b\u044c \\ Get-Module VeeamLogParser | select -ExpandProperty ExportedCommands \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0444\u0443\u043d\u043a\u0446\u0438\u0439 winget Source Web winget list \u0441\u043f\u0438\u0441\u043e\u043a \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044b\u0445 \u043f\u0430\u043a\u0435\u0442\u043e\u0432 \\ winget search VLC \u043d\u0430\u0439\u0442\u0438 \u043f\u0430\u043a\u0435\u0442 \\ winget show VideoLAN.VLC \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043e \u043f\u0430\u043a\u0435\u0442\u0435 \\ winget show VideoLAN.VLC --versions \u0441\u043f\u0438\u0441\u043e\u043a \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0445 \u0432\u0435\u0440\u0441\u0438\u0439 \u0432 \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u0438 \\ winget install VideoLAN.VLC \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043f\u0430\u043a\u0435\u0442 \\ winget uninstall VideoLAN.VLC \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043f\u0430\u043a\u0435\u0442 \\ winget download jqlang.jq \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438\u0442\u044c \u043f\u0430\u043a\u0435\u0442 (https://github.com/jqlang/jq/releases/download/jq-1.7/jq-windows-amd64.exe) \\ winget install jqlang.jq \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442 \u0432 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0443\u044e \u0441\u0440\u0435\u0434\u0443 \u0438 \u043f\u0441\u0435\u0432\u0434\u043e\u043d\u0438\u043c \u043a\u043e\u043c\u0430\u043d\u0434\u043d\u043e\u0439 \u0441\u0442\u0440\u043e\u043a\u0438 jq \\ winget uninstall jqlang.jq jqlang-install [uri]$url = $($(irm https://api.github.com/repos/jqlang/jq/releases/latest).assets.browser_download_url -match \"windows-amd64\").ToString() # \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0432\u0435\u0440\u0441\u0438\u044e latest \u043d\u0430 GitHub irm $url -OutFile \"C:\\Windows\\System32\\jq.exe\" # \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c jq.exe Scoop Set-ExecutionPolicy RemoteSigned -Scope CurrentUser \\ irm get.scoop.sh | iex \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 \\ scoop help \\ scoop search jq \\ scoop info jq \\ (scoop info jq).version \\ scoop cat jq \\ scoop download jq C:\\Users\\lifailon\\scoop\\cache \\ scoop install jq C:\\Users\\lifailon\\scoop\\apps\\jq\\1.7 \\ scoop list \\ (scoop list).version \\ scoop uninstall jq Chocolatey Set-ExecutionPolicy Bypass -Scope Process -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1')) choco -v \\ choco -help \\ choco list \\ choco install adobereader NuGet Invoke-RestMethod https://dist.nuget.org/win-x86-commandline/latest/nuget.exe -OutFile \"$home\\Documents\\nuget.exe\" \\ Invoke-Expression \"$home\\Documents\\nuget.exe search Selenium.WebDriver\" \\ Invoke-Expression \"$home\\Documents\\nuget.exe install Selenium.WebDriver\" \\ Get-Item $home\\Documents\\*Selenium* & \"$home\\Documents\\nuget.exe\" list console-translate \\ $nuget_api_key = \"<API-KEY>\" \\ $source = \"https://api.nuget.org/v3/index.json\" \\ $Name = \"Console-Translate\" \\ $path = \"$home\\Documents\\$Name\" \\ New-Item -Type Directory $path \\ Copy-Item \"$home\\Documents\\Git\\$Name\\$Name\\0.2\\*\" \"$path\\\" \\ Copy-Item \"$home\\Documents\\Git\\$Name\\LICENSE\" \"$path\\\" \\ Copy-Item \"$home\\Documents\\Git\\$Name\\README.md\" \"$path\\\" '<?xml version=\"1.0\"?> <package > <metadata> <id>Console-Translate</id> <version>0.2.2</version> <authors>Lifailon</authors> <owners>Lifailon</owners> <description>Cross-platform client for translating text in the console, uses API Google (edded public free token), MyMemory and DeepLX (no token required)</description> <tags>PowerShell, Module, Translate, api</tags> <projectUrl>https://github.com/Lifailon/Console-Translate</projectUrl> <contentFiles> <files include=\"Console-Translate.psm1\" buildAction=\"Content\" /> <files include=\"Console-Translate.psd1\" buildAction=\"Content\" /> <files include=\"lang-iso-639-1.csv\" buildAction=\"Content\" /> <files include=\"README.md\" buildAction=\"Content\" /> <files include=\"LICENSE\" buildAction=\"Content\" /> </contentFiles> </metadata> </package>' > \"$path\\$Name.nuspec\" Set-Location $path \\ & \"$home\\Documents\\nuget.exe\" pack \"$path\\$Name.nuspec\" \\ & \"$home\\Documents\\nuget.exe\" push \"$path\\$Name.0.2.2.nupkg\" -ApiKey $nuget_api_key -Source $source \\ & \"$home\\Documents\\nuget.exe\" push \"$path\\$Name.0.2.2.nupkg\" -ApiKey $nuget_api_key -Source $source -SkipDuplicate Install-Package Console-Translate -Source nuget.org \\ Get-Package Console-Translate | select * Register-PSRepository -Name \"NuGet\" -SourceLocation \"https://www.nuget.org/api/v2\" -InstallationPolicy Trusted \\ Get-PSRepository \\ Find-Module -Name Console-Translate \\ Install-Module Console-Translate -Repository NuGet & \"$home\\Documents\\nuget.exe\" delete Console-Translate 0.2.0 -Source https://api.nuget.org/v3/index.json -ApiKey $nuget_api_key -NoPrompt Git git --version \\ git config --global user.name \"Lifailon\" \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0438\u043c\u044f \u0434\u043b\u044f \u043a\u043e\u043c\u043c\u0438\u0442\u043e\u0432 \\ git config --global user.email \"lifailon@yandex.ru\" \\ git config --global --edit \\ ssh-keygen -t rsa -b 4096 \\ Get-Service | where name -match \"ssh-agent\" | Set-Service -StartupType Automatic \\ Get-Service | where name -match \"ssh-agent\" | Start-Service \\ Get-Service | where name -match \"ssh-agent\" | select Name,Status,StartType \\ ssh-agent \\ ssh-add C:\\Users\\Lifailon\\.ssh\\id_rsa \\ cat ~\\.ssh\\id_rsa.pub | Set-Clipboard copy to settings keys \\ cd $home\\Documents\\Git \\ git clone git@github.com:Lifailon/lifailon.github.io \\ cd lifailon.github.io \\ git grep \"ping ya.ru\" \u043f\u043e\u0438\u0441\u043a \u0442\u0435\u043a\u0441\u0442\u0430 \u0432 \u0444\u0430\u0439\u043b\u0430\u0445 \\ git fetch \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0438\u0437 \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u043e\u0433\u043e \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0430 \u0434\u043b\u044f \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0432\u0441\u0435\u0445 \u0432\u0435\u0442\u043e\u043a \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u043e\u0433\u043e \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u044f, \u043d\u0435 \u0437\u0430\u0442\u0440\u0430\u0433\u0438\u0432\u0430\u044f \u0442\u0435\u043a\u0443\u0449\u0443\u044e \u0440\u0430\u0431\u043e\u0447\u0443\u044e \u0432\u0435\u0442\u043a\u0443 (\u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u0442 \u0432\u0441\u0435 \u043a\u043e\u043c\u043c\u0438\u0442\u044b, \u0432\u0435\u0442\u043a\u0438 \u0438 \u0442.\u0434. \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043d\u0435 \u043f\u0440\u0438\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044e\u0442 \u0432 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u043e\u043c \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u0438) \\ git pull \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0438\u0437 \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u043e\u0433\u043e \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0430 \u0434\u043b\u044f \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u043e\u0433\u043e \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u044f (\u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442 git fetch \u0434\u043b\u044f \u0441\u0438\u043d\u0445\u0440\u043e\u043d\u0438\u0437\u0430\u0446\u0438\u0438 \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u043e\u0433\u043e \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u044f \u0441 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u043c \u0438 git merge \u0434\u043b\u044f \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0442\u0435\u043a\u0443\u0449\u0435\u0439 \u0440\u0430\u0431\u043e\u0447\u0435\u0439 \u0432\u0435\u0442\u043a\u0438) \\ git status \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u0442\u0430\u0442\u0443\u0441 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0439 \u043f\u043e \u0444\u0430\u0439\u043b\u0430\u043c \\ git diff \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0438\u0441\u0442\u043e\u0440\u0438\u044e \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0439 \u043f\u043e\u0441\u0442\u0440\u043e\u0447\u043d\u043e \\ git diff pandoc \u0441\u0440\u0430\u0432\u043d\u0438\u0432\u0430\u0435\u0442 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0432 \u0442\u0435\u043a\u0443\u0449\u0435\u0439 \u0440\u0430\u0431\u043e\u0447\u0435\u0439 \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u0438 \u0441 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u043c \u043a\u043e\u043c\u043c\u0438\u0442\u043e\u043c \u0432 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0439 \u0432\u0435\u0442\u043a\u0435 \\ git add . \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c (\u043f\u0440\u043e\u0438\u043d\u0434\u0435\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u0442\u044c) \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0432\u043e \u0432\u0441\u0435\u0445 \u0444\u0430\u0439\u043b\u0430\u0445 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0430 \\ git commit -m \"update powershell commands\" \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0441 \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0435\u043c \\ git push \u0441\u0438\u043d\u0445\u0440\u043e\u043d\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u0435 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0441 \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u0435\u043c \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435 \\ git branch hugo \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043d\u043e\u0432\u0443\u044e \u0432\u0435\u0442\u043a\u0443 \\ git branch -m hugo-public \u043f\u0435\u0440\u0435\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u0442\u044c \u0442\u0435\u043a\u0443\u0449\u0443\u044e \u0432\u0435\u0442\u043a\u0443 \\ git branch -d hugo-public \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u0435\u0442\u043a\u0443 \\ git switch hugo \u043f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f \u043d\u0430 \u0434\u0440\u0443\u0433\u0443\u044e \u0432\u0435\u0442\u043a\u0443 \\ git push origin hugo \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0432 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u0443\u044e \u0432\u0435\u0442\u043a\u0443 \\ git push --set-upstream origin hugo \u043e\u0442\u0441\u043b\u0435\u0436\u0438\u0432\u0430\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0432 \u0432\u0435\u0442\u043a\u0435 (\u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0434\u0435\u043b\u0430\u0442\u044c push \u0431\u0435\u0437 \u0443\u043a\u0430\u0437\u0430\u043d\u0438\u044f \u0432\u0435\u0442\u043a\u0438) \\ git merge hugo \u0441\u043b\u0438\u044f\u043d\u0438\u0435 \u0442\u0435\u043a\u0443\u0449\u0435\u0439 \u0432\u0435\u0442\u043a\u0438 (pandoc) \u0441 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0439 (hugo) \\ git log --oneline --all \u043b\u043e\u0433 \u043a\u043e\u043c\u043c\u0438\u0442\u043e\u0432 \\ git log --graph \u043a\u043e\u043c\u043c\u0438\u0442\u044b \u0438 \u0441\u043b\u0435\u0434\u043e\u0432\u0430\u043d\u0438\u0435 \u0432\u0435\u0442\u043e\u043a \\ git log --author=\"Lifailon\" \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442 \u0438\u0441\u0442\u043e\u0440\u0438\u044e \u043a\u043e\u043c\u043c\u0438\u0442\u043e\u0432 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \\ git blame index.html \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442, \u043a\u0442\u043e \u0438 \u043a\u043e\u0433\u0434\u0430 \u0432\u043d\u0435\u0441 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0432 \u043a\u0430\u0436\u0434\u0443\u044e \u0441\u0442\u0440\u043e\u043a\u0443 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0433\u043e \u0444\u0430\u0439\u043b\u0430 \\ git show d01f09dead3a6a8d75dda848162831c58ca0ee13 \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043f\u043e\u0434\u0440\u043e\u0431\u043d\u044b\u0439 \u043b\u043e\u0433 \u043f\u043e \u043d\u043e\u043c\u0435\u0440\u0443 \u043a\u043e\u043c\u043c\u0438\u0442\u0430 \\ git restore filename \u043e\u0442\u043c\u0435\u043d\u0438\u0442\u044c \u0432\u0441\u0435 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u0435 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0432 \u0440\u0430\u0431\u043e\u0447\u0435\u0439 \u043a\u043e\u043f\u0438\u0438 \u043d\u0435\u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e \u043e\u0442 \u0442\u043e\u0433\u043e, \u0431\u044b\u043b\u0438 \u043e\u043d\u0438 \u043f\u0440\u043e\u0438\u043d\u0434\u0435\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u044b \u0438\u043b\u0438 \u043d\u0435\u0442 (\u0435\u0441\u043b\u0438 \u0431\u044b\u043b\u0430 \u0438\u043d\u0434\u0435\u043a\u0441\u0430\u0446\u0438\u044f \u0447\u0435\u0440\u0435\u0437 add), \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u044f \u0435\u0433\u043e \u043a \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044e \u043d\u0430 \u043c\u043e\u043c\u0435\u043d\u0442 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u043a\u043e\u043c\u043c\u0438\u0442\u0430 \\ git restore --source d01f09dead3a6a8d75dda848162831c58ca0ee13 filename \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0444\u0430\u0439\u043b \u043d\u0430 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u0443\u044e \u0432\u0435\u0440\u0441\u0438\u044e \u043f\u043e \u0445\u044d\u0448\u0443 \u0438\u043d\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440\u0430 \u043a\u043e\u043c\u043c\u0438\u0442\u0430 \\ git checkout filename \u043e\u0442\u043a\u0430\u0442\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u043d\u0435 \u043f\u0440\u043e\u0438\u043d\u0434\u0435\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0435 \u0434\u043b\u044f \u043a\u043e\u043c\u043c\u0438\u0442\u0430, \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u044f \u0435\u0433\u043e \u043a \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044e, \u043a\u0430\u043a\u0438\u043c \u043e\u043d\u043e \u0431\u044b\u043b\u043e \u043d\u0430 \u043c\u043e\u043c\u0435\u043d\u0442 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u043a\u043e\u043c\u043c\u0438\u0442\u0430 (\u0435\u0441\u043b\u0438 \u043d\u0435 \u0431\u044b\u043b\u043e \u0438\u043d\u0434\u0435\u043a\u0441\u0430\u0446\u0438\u0438 \u0447\u0435\u0440\u0435\u0437 add) \\ git checkout d01f09dead3a6a8d75dda848162831c58ca0ee13 \u043f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u0435 \u0444\u0430\u0439\u043b\u044b \u0440\u0430\u0431\u043e\u0447\u0435\u0439 \u043a\u043e\u043f\u0438\u0438 \u043d\u0430 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u0439 \u043a\u043e\u043c\u043c\u0438\u0442 (\u043f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0430\u0435\u0442 HEAD \u043d\u0430 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u0439 \u043a\u043e\u043c\u043c\u0438\u0442) \\ git reset HEAD filename \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u0439 \u0444\u0430\u0439\u043b \u0438\u0437 \u0438\u043d\u0434\u0435\u043a\u0441\u0430 \u0431\u0435\u0437 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u044f \u0441\u0430\u043c\u0438\u0445 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0439 \u0432 \u0444\u0430\u0439\u043b\u0435 \u0434\u043b\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u0439 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e\u0439 \u0438\u043d\u0434\u0435\u043a\u0441\u0430\u0446\u0438\u0438 (\u0435\u0441\u043b\u0438 \u0431\u044b\u043b add \u043d\u043e \u043d\u0435 \u0431\u044b\u043b\u043e commit, \u043f\u043e\u0442\u043e\u043c \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c checkout) \\ git reset --soft HEAD^ \u043e\u0442\u043c\u0435\u043d\u044f\u0435\u0442 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0439 (^) \u043a\u043e\u043c\u043c\u0438\u0442, \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u044f \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0438\u0437 \u044d\u0442\u043e\u0433\u043e \u043a\u043e\u043c\u043c\u0438\u0442\u0430 \u0432 \u0440\u0430\u0431\u043e\u0447\u0435\u043c \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0435 \u0438 \u0438\u043d\u0434\u0435\u043a\u0441\u0435 (\u043f\u043e\u0434\u0433\u043e\u0442\u043e\u0432\u043b\u0435\u043d\u043d\u043e\u0439 \u043e\u0431\u043b\u0430\u0441\u0442\u0438), \u043c\u043e\u0436\u043d\u043e \u0432\u043d\u0435\u0441\u0442\u0438 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0432 \u0444\u0430\u0439\u043b\u044b \u0438 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e \u0438\u0445 \u0437\u0430\u0444\u0438\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u0442\u044c \\ git reset --hard HEAD^ \u043f\u043e\u043b\u043d\u043e\u0441\u0442\u044c\u044e \u043e\u0442\u043c\u0435\u043d\u044f\u0435\u0442 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0439 \u043a\u043e\u043c\u043c\u0438\u0442, \u0443\u0434\u0430\u043b\u044f\u044f \u0432\u0441\u0435 \u0435\u0433\u043e \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0438\u0437 \u0440\u0430\u0431\u043e\u0447\u0435\u0433\u043e \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0430 \u0438 \u0438\u043d\u0434\u0435\u043a\u0441\u0430 \u0434\u043e \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u043a\u043e\u043c\u043c\u0438\u0442\u0430 \\ git reset --hard d01f09dead3a6a8d75dda848162831c58ca0ee13 \u043e\u0442\u043a\u0430\u0442\u044b\u0432\u0430\u0435\u0442 HEAD \u043a \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u043c\u0443 \u043a\u043e\u043c\u043c\u0438\u0442\u0443 \u0438 \u0443\u0434\u0430\u043b\u044f\u0435\u0442 \u0432\u0441\u0435 \u043a\u043e\u043c\u043c\u0438\u0442\u044b, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0431\u044b\u043b\u0438 \u0441\u0434\u0435\u043b\u0430\u043d\u044b \u043f\u043e\u0441\u043b\u0435 \u043d\u0435\u0433\u043e (\u0431\u0443\u0434\u0443\u0442 \u043f\u043e\u0442\u0435\u0440\u044f\u043d\u044b \u0432\u0441\u0435 \u043d\u0435\u0437\u0430\u043a\u043e\u043c\u043c\u0438\u0447\u0435\u043d\u043d\u044b\u0435 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0438 \u0438\u0441\u0442\u043e\u0440\u0438\u044e \u043a\u043e\u043c\u043c\u0438\u0442\u043e\u0432 \u043f\u043e\u0441\u043b\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0433\u043e) \\ git revert HEAD --no-edit \u0441\u043e\u0437\u0434\u0430\u0435\u0442 \u043d\u043e\u0432\u044b\u0439 \u043a\u043e\u043c\u043c\u0438\u0442, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043e\u0442\u043c\u0435\u043d\u044f\u0435\u0442 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0439 \u043a\u043e\u043c\u043c\u0438\u0442 (HEAD) \u0438 \u043d\u043e\u0432\u044b\u0439 \u043a\u043e\u043c\u043c\u0438\u0442 \u0431\u0443\u0434\u0435\u0442 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d \u043f\u043e\u0432\u0435\u0440\u0445 \u043d\u0435\u0433\u043e (\u0441\u043e\u0431\u044b\u0442\u0438\u044f \u0437\u0430\u043f\u0438\u0441\u044b\u0432\u0430\u044e\u0442\u0441\u044f \u0432 git log) \\ git revert d01f09dead3a6a8d75dda848162831c58ca0ee13 \u0441\u043e\u0437\u0434\u0430\u0435\u0442 \u043d\u043e\u0432\u044b\u0439 \u043a\u043e\u043c\u043c\u0438\u0442, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043e\u0442\u043c\u0435\u043d\u044f\u0435\u0442 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f, \u0432\u043d\u0435\u0441\u0435\u043d\u043d\u044b\u0435 \u0432 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u0439 \u043a\u043e\u043c\u043c\u0438\u0442 \u0441 \u0445\u0435\u0448\u0435\u043c (\u043d\u0435 \u0438\u0437\u043c\u0435\u043d\u044f\u0435\u0442 \u0438\u0441\u0442\u043e\u0440\u0438\u044e \u043a\u043e\u043c\u043c\u0438\u0442\u043e\u0432, \u0430 \u0441\u043e\u0437\u0434\u0430\u0435\u0442 \u043d\u043e\u0432\u044b\u0439 \u043a\u043e\u043c\u043c\u0438\u0442 \u0441 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f\u043c\u0438 \u043e\u0442\u043c\u0435\u043d\u044b) \\ git stash \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u0442 \u0442\u0435\u043a\u0443\u0449\u0438\u0435 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0432 \u0441\u0442\u044d\u0448 (\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e\u0435 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435) \u0438 \u043e\u0447\u0438\u0449\u0430\u0435\u0442 \u0440\u0430\u0431\u043e\u0447\u0443\u044e \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u044e \\ git stash pop \u043f\u0440\u0438\u043c\u0435\u043d\u044f\u0435\u0442 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0435 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0438\u0437 \u0441\u0442\u044d\u0448\u0430 \u043a \u0442\u0435\u043a\u0443\u0449\u0435\u0439 \u0432\u0435\u0442\u043a\u0435 GitHub $user = \"Lifailon\" \\ $repository = \"ReverseProxyNET\" \\ Invoke-RestMethod https://api.github.com/users/$($user) \\ Invoke-RestMethod https://api.github.com/users/$($user)/repos \\ Invoke-RestMethod https://api.github.com/repos/$($user)/$($repository)/contents \\ Invoke-RestMethod https://api.github.com/repos/$($user)/$($repository)/contents/source/rpnet.cs \\ Invoke-RestMethod https://api.github.com/repos/$($user)/$($repository)/commits \\ $sha = $(Invoke-RestMethod https://api.github.com/repos/$($user)/$($repository)/commits).sha \\ Invoke-RestMethod https://api.github.com/repos/$($user)/$($repository)/commits/$($sha[-1]) \\ Invoke-RestMethod \"https://api.github.com/repos/$($user)/$($repository)/releases/latest\" \\ $(Invoke-RestMethod \"https://api.github.com/repos/$($user)/$($repository)/releases/latest\").assets.name \\ $issues = Invoke-RestMethod https://api.github.com/repos/LibreHardwareMonitor/LibreHardwareMonitor/issues \\ $issue_number = $($issues | Where-Object title -match \"PowerShell\").number \\ Invoke-RestMethod https://api.github.com/repos/LibreHardwareMonitor/LibreHardwareMonitor/issues/$($issue_number)/comments \\ Invoke-RestMethod https://api.github.com/repos/LibreHardwareMonitor/LibreHardwareMonitor/pulls \\ Invoke-RestMethod https://api.github.com/repos/LibreHardwareMonitor/LibreHardwareMonitor/languages \\ Invoke-RestMethod https://api.github.com/repos/LibreHardwareMonitor/LibreHardwareMonitor/stargazers \\ Invoke-RestMethod https://api.github.com/repos/LibreHardwareMonitor/LibreHardwareMonitor/forks \\ Invoke-RestMethod https://api.github.com/repos/LibreHardwareMonitor/LibreHardwareMonitor/subscribers DSC Import-Module PSDesiredStateConfiguration \\ Get-Command -Module PSDesiredStateConfiguration \\ (Get-Module PSDesiredStateConfiguration).ExportedCommands \\ Get-DscLocalConfigurationManager Get-DscResource \\ Get-DscResource -Name File -Syntax \u0441\u0438\u043d\u0442\u0430\u043a\u0441\u0438\u0441 Ensure = Present \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430 \u0434\u043e\u043b\u0436\u043d\u0430 \u0431\u044b\u0442\u044c \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u0430 (\u043a\u0430\u0442\u0430\u043b\u043e\u0433 \u0434\u043e\u043b\u0436\u0435\u043d \u043f\u0440\u0438\u0441\u0443\u0442\u0441\u0442\u0432\u043e\u0432\u0430\u0442\u044c, \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u0437\u0430\u043f\u0443\u0449\u0435\u043d, \u0435\u0441\u043b\u0438 \u043d\u0435\u0442 \u2013 \u0441\u043e\u0437\u0434\u0430\u0442\u044c, \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c) \\ Ensure = Absent \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430 \u0434\u043e\u043b\u0436\u043d\u0430 \u0431\u044b\u0442\u044c \u0432\u044b\u043a\u043b\u044e\u0447\u0435\u043d\u0430 (\u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0430 \u0431\u044b\u0442\u044c \u043d\u0435 \u0434\u043e\u043b\u0436\u043d\u043e, \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u043d\u0435 \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u0437\u0430\u043f\u0443\u0449\u0435\u043d, \u0435\u0441\u043b\u0438 \u043d\u0435\u0442 \u2013 \u0443\u0434\u0430\u043b\u0438\u0442\u044c, \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c) Configuration TestConfiguraion { Ctrl+Space } Configuration DSConfigurationProxy { Node vproxy-01 { File CreateDir { Ensure = \"Present\" Type = \"Directory\" DestinationPath = \"C:\\Temp\" } Service StopW32time { Name = \"w32time\" State = \"Stopped\"` Running } WindowsProcess RunCalc { Ensure = \"Present\" Path = \"C:\\WINDOWS\\system32\\calc.exe\" Arguments = \"\" } Registry RegSettings { Ensure = \"Present\" Key = \"HKEY_LOCAL_MACHINE\\SOFTWARE\\MySoft\" ValueName = \"TestName\" ValueData = \"TestValue\" ValueType = \"String\" } # WindowsFeature IIS # { # Ensure = \"Present\" # Name = \"Web-Server\" # } } } $Path = (DSConfigurationProxy).DirectoryName \\ Test-DscConfiguration -Path $Path | select * ResourcesInDesiredState - \u0443\u0436\u0435 \u043d\u0430\u0441\u0442\u0440\u043e\u0435\u043d\u043e, ResourcesNotInDesiredState - \u043d\u0435 \u043d\u0430\u0441\u0442\u0440\u043e\u0435\u043d\u043e (\u043d\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442) \\ Start-DscConfiguration -Path $Path \\ Get-Job \\ $srv = \"vproxy-01\" \\ Get-Service -ComputerName $srv | ? name -match w32time # Start-Service \\ icm $srv {Get-Process | ? ProcessName -match calc} | ft # Stop-Process -Force \\ icm $srv {ls C:\\ | ? name -match Temp} | ft rm` Configuration InstallPowerShellCore { Import-DscResource -ModuleName PSDesiredStateConfiguration Node localhost { Script InstallPowerShellCore { GetScript = { return @{ GetScript = $GetScript } } SetScript = { [string]$url = $(Invoke-RestMethod https://api.github.com/repos/PowerShell/PowerShell/releases/latest).assets.browser_download_url -match \"win-x64.zip\" $downloadPath = \"$home\\Downloads\\PowerShell.zip\" $installPath = \"$env:ProgramFiles\\PowerShell\\7\" Invoke-WebRequest -Uri $url -OutFile $downloadPath Expand-Archive -Path $downloadPath -DestinationPath $installPath -Force } TestScript = { return Test-Path \"$env:ProgramFiles\\PowerShell\\7\\pwsh.exe\" } } } } $Path = (InstallPowerShellCore).DirectoryName \\ Test-DscConfiguration -Path $Path \\ Start-DscConfiguration -Path $path -Wait -Verbose \\ Get-Job Ansible apt -y update && apt -y upgrade \\ apt -y install ansible v2.10.8 \\ apt -y install ansible-core v2.12.0 \\ apt -y install sshpass ansible-galaxy collection install ansible.windows \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043a\u043e\u043b\u043b\u0435\u043a\u0446\u0438\u044e \u043c\u043e\u0434\u0443\u043b\u0435\u0439 \\ ansible-galaxy collection install community.windows \\ ansible-galaxy collection list | grep windows \\ ansible-config dump | grep DEFAULT_MODULE_PATH \u043f\u0443\u0442\u044c \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u043c\u043e\u0434\u0443\u043b\u0435\u0439 apt-get -y install python-dev libkrb5-dev krb5-user \u043f\u0430\u043a\u0435\u0442\u044b \u0434\u043b\u044f Kerberos \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438 \\ apt install python3-pip \\ pip3 install requests-kerberos \\ nano /etc/krb5.conf \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c [realms] \u0438 [domain_realm] \\ kinit -C support4@domail.local \\ klist ansible --version \\ config file = None \\ nano /etc/ansible/ansible.cfg \u0444\u0430\u0439\u043b \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438 [defaults] inventory = /etc/ansible/hosts # uncomment this to disable SSH key host checking # \u041e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0443 \u043a\u043b\u044e\u0447\u0430 ssh (\u0434\u043b\u044f \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044f \u043f\u0430\u0440\u043e\u043b\u044c) host_key_checking = False Hosts nano /etc/ansible/hosts [us] pi-hole-01 ansible_host=192.168.3.101 zabbix-01 ansible_host=192.168.3.102 grafana-01 ansible_host=192.168.3.103 netbox-01 ansible_host=192.168.3.104 [all:vars] ansible_ssh_port=2121 ansible_user=lifailon ansible_password=123098 path_user=/home/lifailon ansible_python_interpreter=/usr/bin/python3 [ws] huawei-book-01 ansible_host=192.168.3.99 plex-01 ansible_host=192.168.3.100 [ws:vars] ansible_port=5985 #ansible_port=5986 ansible_user=Lifailon #ansible_user=support4@DOMAIN.LOCAL ansible_password=123098 ansible_connection=winrm ansible_winrm_scheme=http ansible_winrm_transport=basic #ansible_winrm_transport=kerberos ansible_winrm_server_cert_validation=ignore validate_certs=false [win_ssh] huawei-book-01 ansible_host=192.168.3.99 plex-01 ansible_host=192.168.3.100 [win_ssh:vars] ansible_python_interpreter=C:\\Users\\Lifailon\\AppData\\Local\\Programs\\Python\\Python311\\` \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0443\u044e \u0441\u0440\u0435\u0434\u044b \u0438\u043d\u0442\u0435\u0440\u043f\u0440\u0438\u0442\u0430\u0442\u043e\u0440\u0430 Python \u0432 Windows ansible_connection=ssh #ansible_shell_type=cmd ansible_shell_type=powershell ansible-inventory --list \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044e (\u0447\u0438\u0442\u0430\u0435\u0442 \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 JSON) \u0438\u043b\u0438 YAML (-y) \u0441 \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u043e\u043c \u0432\u0441\u0435 \u043f\u0440\u0438\u043c\u0435\u043d\u044f\u0435\u043c\u044b\u0445 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0445 Win_Modules ansible us -m ping \\ ansible win_ssh -m ping \\ ansible us -m shell -a \"uptime && df -h | grep lv\" \\ ansible us -m setup | grep -iP \"mem|proc\" \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043e \u0436\u0435\u043b\u0435\u0437\u0435 \\ ansible us -m apt -a \"name=mc\" -b \u043f\u043e\u0432\u044b\u0441\u0438\u0442\u044c \u043f\u0440\u0438\u0432\u0438\u043b\u0435\u0433\u0438\u0438 sudo (-b) \\ ansible us -m service -a \"name=ssh state=restarted enabled=yes\" -b \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0441\u043b\u0443\u0436\u0431\u0443 \\ echo \"echo test\" > test.sh \\ ansible us -m copy -a \"src=test.sh dest=/root mode=777\" -b \\ ansible us -a \"ls /root\" -b \\ ansible us -a \"cat /root/test.sh\" -b ansible-doc -l | grep win_ \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u043c\u043e\u0434\u0443\u043b\u0435\u0439 Windows \\ ansible ws -m win_ping windows \u043c\u043e\u0434\u0443\u043b\u044c \\ ansible ws -m win_ping -u WinRM-Writer \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u043b\u043e\u0433\u0438\u043d \\ ansible ws -m setup \u0441\u043e\u0431\u0440\u0430\u0442\u044c \u043f\u043e\u0434\u0440\u043e\u0431\u043d\u0443\u044e \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u043e \u0441\u0438\u0441\u0442\u0435\u043c\u0435 \\ ansible ws -m win_whoami \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043e \u043f\u0440\u0430\u0432\u0430\u0445 \u0434\u043e\u0441\u0442\u0443\u043f\u0430\u0445, \u0433\u0440\u0443\u043f\u043f\u0430\u0445 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \\ ansible ws -m win_shell -a '$PSVersionTable' \\ ansible ws -m win_shell -a 'Get-Service | where name -match \"ssh|winrm\"' \\ ansible ws -m win_service -a \"name=sshd state=stopped\" \\ ansible ws -m win_service -a \"name=sshd state=started\" win_shell (vars/debug) nano /etc/ansible/PowerShell-Vars.yml - hosts: ws ` \u0423\u043a\u0430\u0437\u0430\u0442\u044c \u043a\u043e\u043b\u043b\u0435\u043a\u0446\u0438\u044e \u043c\u043e\u0434\u0443\u043b\u0435\u0439 collections: - ansible.windows ` \u0417\u0430\u0434\u0430\u0442\u044c \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 vars: SearchName: PermitRoot tasks: - name: Get port ssh win_shell: | Get-Content \"C:\\Programdata\\ssh\\sshd_config\" | Select-String \"{{SearchName}}\" ` \u041f\u0435\u0440\u0435\u0434\u0430\u0442\u044c \u0432\u044b\u0432\u043e\u0434 \u0432 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0443\u044e register: command_output - name: Output port ssh ` \u0412\u044b\u0432\u0435\u0441\u0442\u0438 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0443\u044e \u043d\u0430 \u044d\u043a\u0440\u0430\u043d debug: var: command_output.stdout_lines ansible-playbook /etc/ansible/PowerShell-Vars.yml \\ ansible-playbook /etc/ansible/PowerShell-Vars.yml --extra-vars \"SearchName='LogLevel|Syslog'\" \u043f\u0435\u0440\u0435\u0434\u0430\u0442\u044c \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0443\u044e win_powershell nano /etc/ansible/powershell-param.yml - hosts: ws tasks: - name: Run PowerShell script with parameters ansible.windows.win_powershell: parameters: Path: C:\\Temp Force: true script: | [CmdletBinding()] param ( [String]$Path, [Switch]$Force ) New-Item -Path $Path -ItemType Directory -Force:$Force ansible-playbook /etc/ansible/powershell-param.yml win_chocolatey nano /etc/ansible/setup-adobe-acrobat.yml - hosts: ws tasks: - name: Install Acrobat Reader win_chocolatey: name: adobereader state: present ansible-playbook /etc/ansible/setup-adobe-acrobat.yml nano /etc/ansible/setup-openssh.yml - hosts: ws tasks: - name: install the Win32-OpenSSH service win_chocolatey: name: openssh package_params: /SSHServerFeature state: present ansible-playbook /etc/ansible/setup-openssh.yml win_regedit nano /etc/ansible/win-set-shell-ssh-ps7.yml - hosts: ws tasks: - name: Set the default shell to PowerShell 7 for Windows OpenSSH win_regedit: path: HKLM:\\SOFTWARE\\OpenSSH name: DefaultShell ` data: C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe data: 'C:\\Program Files\\PowerShell\\7\\pwsh.exe' type: string state: present ansible-playbook /etc/ansible/win-set-shell-ssh-ps7.yml win_service nano /etc/ansible/win-service.yml - hosts: ws tasks: - name: Start service win_service: name: sshd state: started # state: stopped # state: restarted # start_mode: auto ansible-playbook /etc/ansible/win-service.yml win_service_info nano /etc/ansible/get-service.yml - hosts: ws tasks: - name: Get info for a single service win_service_info: name: sshd register: service_info - name: Print returned information ansible.builtin.debug: var: service_info.services ansible-playbook /etc/ansible/get-service.yml fetch/slurp nano /etc/ansible/copy-from-win-to-local.yml - hosts: ws tasks: - name: Retrieve remote file on a Windows host # \u0421\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0444\u0430\u0439\u043b \u0438\u0437 Windows-\u0441\u0438\u0441\u0442\u0435\u043c\u044b ansible.builtin.fetch: # \u041f\u0440\u043e\u0447\u0438\u0442\u0430\u0442\u044c \u0444\u0430\u0439\u043b (\u043f\u0435\u0440\u0435\u0434\u0430\u0442\u044c \u0432 \u043f\u0430\u043c\u044f\u0442\u044c \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 Base64) # ansible.builtin.slurp: src: C:\\Telegraf\\telegraf.conf dest: /root/telegraf.conf flat: yes register: telegraf_conf - name: Print returned information ansible.builtin.debug: msg: \"{{ telegraf_conf['content'] | b64decode }}\" ansible-playbook /etc/ansible/copy-from-win-to-local.yml win_copy echo \"Get-Service | where name -eq vss | Start-Service\" > /home/lifailon/Start-Service-VSS.ps1 \\ nano /etc/ansible/copy-file-to-win.yml - hosts: ws tasks: - name: Copy file to win hosts win_copy: src: /home/lifailon/Start-Service-VSS.ps1 dest: C:\\Users\\Lifailon\\Desktop\\Start-Service-VSS.ps1 ansible-playbook /etc/ansible/copy-file-to-win.yml curl -OL https://github.com/PowerShell/PowerShell/releases/download/v7.3.6/PowerShell-7.3.6-win-x64.msi \\ nano /etc/ansible/copy-file-to-win.yml - hosts: ws tasks: - name: Copy file to win hosts win_copy: src: /home/lifailon/PowerShell-7.3.6-win-x64.msi dest: C:\\Install\\PowerShell-7.3.6.msi ansible-playbook /etc/ansible/copy-file-to-win.yml win_command nano /etc/ansible/run-script-ps1.yml - hosts: ws tasks: - name: Run PowerShell Script win_command: powershell -ExecutionPolicy ByPass -File C:\\Users\\Lifailon\\Desktop\\Start-Service-VSS.ps1 ansible-playbook /etc/ansible/run-script-ps1.yml win_package nano /etc/ansible/setup-msi-package.yml - hosts: ws tasks: - name: Install MSI Package win_package: # path: C:\\Install\\7z-23.01.msi path: C:\\Install\\PowerShell-7.3.6.msi arguments: - /quiet - /passive - /norestart ansible-playbook /etc/ansible/setup-msi-package.yml win_firewall_rule nano /etc/ansible/win-fw-open.yml - hosts: ws tasks: - name: Open RDP port win_firewall_rule: name: Open RDP port localport: 3389 action: allow direction: in protocol: tcp state: present enabled: yes ansible-playbook /etc/ansible/win-fw-open.yml win_group nano /etc/ansible/win-creat-group.yml - hosts: ws tasks: - name: Create a new group win_group: name: deploy description: Deploy Group state: present ansible-playbook /etc/ansible/win-creat-group.yml win_group_membership nano /etc/ansible/add-user-to-group.yml - hosts: ws tasks: - name: Add a local and domain user to a local group win_group_membership: name: deploy members: - WinRM-Writer state: present ansible-playbook /etc/ansible/add-user-to-group.yml win_user nano /etc/ansible/creat-win-user.yml - hosts: ws tasks: - name: Creat user win_user: name: test password: 123098 state: present groups: - deploy ansible-playbook /etc/ansible/creat-win-user.yml nano /etc/ansible/delete-win-user.yml - hosts: ws tasks: - name: Delete user ansible.windows.win_user: name: test state: absent ansible-playbook /etc/ansible/delete-win-user.yml win_feature nano /etc/ansible/install-feature.yml - hosts: ws tasks: - name: Install Windows Feature win_feature: name: SNMP-Service state: present ansible-playbook /etc/ansible/install-feature.yml win_reboot nano /etc/ansible/win-reboot.yml - hosts: ws tasks: - name: Reboot a slow machine that might have lots of updates to apply win_reboot: reboot_timeout: 3600 ansible-playbook /etc/ansible/win-reboot.yml win_find nano /etc/ansible/win-ls.yml - hosts: ws tasks: - name: Find files in multiple paths ansible.windows.win_find: paths: - D:\\Install\\OpenSource patterns: ['*.rar','*.zip','*.msi'] ` \u0424\u0430\u0439\u043b \u0441\u043e\u0437\u0434\u0430\u043d\u043d\u044b\u0439 \u043c\u0435\u043d\u0435\u0435 7 \u0434\u043d\u0435\u0439 \u043d\u0430\u0437\u0430\u0434 age: -7d ` \u0420\u0430\u0437\u043c\u0435\u0440 \u0444\u0430\u0439\u043b\u0430 \u0431\u043e\u043b\u044c\u0448\u0435 10MB size: 10485760 ` \u0420\u0435\u043a\u0443\u0440\u0441\u0438\u0432\u043d\u044b\u0439 \u043f\u043e\u0438\u0441\u043a (\u0432 \u0434\u043e\u0447\u0435\u0440\u043d\u0438\u0445 \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u044f\u0445) recurse: true register: command_output - name: Output debug: var: command_output ansible-playbook /etc/ansible/win-ls.yml win_uri nano /etc/ansible/rest-get.yml - hosts: ws tasks: - name: REST GET request to endpoint github ansible.windows.win_uri: url: https://api.github.com/repos/Lifailon/pSyslog/releases/latest register: http_output - name: Output debug: var: http_output ansible-playbook /etc/ansible/rest-get.yml win_updates nano /etc/ansible/win-update.yml - hosts: ws tasks: - name: Install only particular updates based on the KB numbers ansible.windows.win_updates: category_names: - SecurityUpdates - CriticalUpdates - UpdateRollups - Drivers ` \u0424\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u044f ` accept_list: ` - KB2267602 ` \u041f\u043e\u0438\u0441\u043a \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0439 ` state: searched ` \u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f ` state: downloaded ` \u0423\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f state: installed log_path: C:\\Ansible-Windows-Upadte-Log.txt reboot: false register: wu_output - name: Output debug: var: wu_output ansible-playbook /etc/ansible/win-update.yml win_chocolatey Install \\ API \\ Deployment - name: Ensure Chocolatey installed from internal repo win_chocolatey: name: chocolatey state: present # source: URL-\u0430\u0434\u0440\u0435\u0441 \u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u0435\u0433\u043e \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u044f source: https://community.chocolatey.org/api/v2/ChocolateyInstall.ps1 GigaChat Developers chat 1. \u0423\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432: Invoke-WebRequest \"https://gu-st.ru/content/lending/russian_trusted_root_ca_pem.crt\" -OutFile \"$home\\Downloads\\russian_trusted_root_ca.cer\" \u0441\u043a\u0430\u0447\u0430\u0442\u044c \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 \u043c\u0438\u043d\u0446\u0438\u0444\u0440\u044b \\ Invoke-WebRequest \"https://gu-st.ru/content/lending/russian_trusted_sub_ca_pem.crt\" -OutFile \"$home\\Downloads\\russian_trusted_sub_ca.cer\" \\ Import-Certificate -FilePath \"$home\\Downloads\\russian_trusted_root_ca.cer\" -CertStoreLocation \"Cert:\\CurrentUser\\Root\" \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 \u043c\u0438\u043d\u0446\u0438\u0444\u0440\u044b \\ Import-Certificate -FilePath \"$home\\Downloads\\russian_trusted_sub_ca.cer\" -CertStoreLocation \"Cert:\\CurrentUser\\CA\" 2. \u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f \u043f\u043e Sber ID \u0438 \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f \u043d\u043e\u0432\u044b\u0445 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445 \u0434\u043b\u044f \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u0442\u043e\u043a\u0435\u043d\u0430: Developers (\u0432\u0440\u0435\u043c\u044f \u0436\u0438\u0437\u043d\u0438 30 \u043c\u0438\u043d\u0443\u0442) 3. \u0424\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445 \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 Base64 \u0438\u0437 Client ID \u0438 Client Secret: $Client_ID = \"7e6d2f9f-825e-49b7-98f4-62fbb7506427\" # [System.Guid]::Parse(\"7e6d2f9f-825e-49b7-98f4-62fbb7506427\") $Client_Secret = \"c35113ee-6757-47ba-9853-ea1d0d9db1ef\" # [System.Guid]::Parse(\"c35113ee-6757-47ba-9853-ea1d0d9db1ef\") $Client_Join = $Client_ID+\":\"+$Client_Secret # \u043e\u0431\u044a\u0435\u0434\u0438\u043d\u044f\u0435\u043c \u0434\u0432\u0430 UUID \u0432 \u043e\u0434\u043d\u0443 \u0441\u0442\u0440\u043e\u043a\u0443, \u0440\u0430\u0437\u0434\u0435\u043b\u044f\u044f \u0438\u0445 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u043c ':' $Bytes = [System.Text.Encoding]::UTF8.GetBytes($Client_Join) # \u043f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u0443\u0435\u043c \u0441\u0442\u0440\u043e\u043a\u0443 \u0432 \u043c\u0430\u0441\u0441\u0438\u0432 \u0431\u0430\u0439\u0442 $Cred_Base64 = [Convert]::ToBase64String($Bytes) # \u043a\u043e\u0434\u0438\u0440\u0443\u0435\u043c \u0431\u0430\u0439\u0442\u044b \u0432 \u0441\u0442\u0440\u043e\u043a\u0443 Base64 4. \u041f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 \u0442\u043e\u043a\u0435\u043d\u0430: $Cred_Base64 = \"N2U2ZDJmOWYtODI1ZS00OWI3LTk4ZjQtNjJmYmI3NTA2NDI3OmIyYzgwZmZmLTEzOGUtNDg1Mi05MjgwLWE2MGI4NTc0YTM2MQ==\" \\ $UUID = [System.Guid]::NewGuid() \u0433\u0435\u043d\u0435\u0440\u0438\u0440\u0443\u0435\u043c UUID \u0434\u043b\u044f \u0436\u0443\u0440\u043d\u0430\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0432\u0445\u043e\u0434\u044f\u0449\u0438\u0445 \u0432\u044b\u0437\u043e\u0432\u043e\u0432 \u0438 \u0440\u0430\u0437\u0431\u043e\u0440\u0430 \u0438\u043d\u0446\u0438\u0434\u0435\u043d\u0442\u043e\u0432 $url = \"https://ngw.devices.sberbank.ru:9443/api/v2/oauth\" $headers = @{ \"Authorization\" = \"Basic $Cred_Base64\" \"RqUID\" = \"$UUID\" \"Content-Type\" = \"application/x-www-form-urlencoded\" } $body = @{ scope = \"GIGACHAT_API_PERS\" } $GIGA_TOKEN = $(Invoke-RestMethod -Uri $url -Method POST -Headers $headers -Body $body).access_token 5. \u041f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b: [string]$content = \"\u041f\u043e\u0441\u0447\u0438\u0442\u0430\u0439 \u0441\u0443\u043c\u043c\u0443 \u0447\u0438\u0441\u0435\u043b: 22+33\" [string]$role = \"user\" # \u0440\u043e\u043b\u044c \u0430\u0432\u0442\u043e\u0440\u0430 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f (user/assistant/system) [float]$temperature = 0.7 # \u0442\u0435\u043c\u043f\u0435\u0440\u0430\u0442\u0443\u0440\u0430 \u0432\u044b\u0431\u043e\u0440\u043a\u0438 \u0432 \u0434\u0438\u0430\u043f\u0430\u0437\u043e\u043d\u0435 \u043e\u0442 0 \u0434\u043e 2. \u0427\u0435\u043c \u0432\u044b\u0448\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435, \u0442\u0435\u043c \u0431\u043e\u043b\u0435\u0435 \u0441\u043b\u0443\u0447\u0430\u0439\u043d\u044b\u043c \u0431\u0443\u0434\u0435\u0442 \u043e\u0442\u0432\u0435\u0442 \u043c\u043e\u0434\u0435\u043b\u0438. [float]$top_p = 0.1 # \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u043a\u0430\u043a \u0430\u043b\u044c\u0442\u0435\u0440\u043d\u0430\u0442\u0438\u0432\u0430 temperature \u0438 \u0438\u0437\u043c\u0435\u043d\u044f\u0435\u0442\u0441\u044f \u0432 \u0434\u0438\u0430\u043f\u0430\u0437\u043e\u043d\u0435 \u043e\u0442 0 \u0434\u043e 1. \u0417\u0430\u0434\u0430\u0435\u0442 \u0432\u0435\u0440\u043e\u044f\u0442\u043d\u043e\u0441\u0442\u043d\u0443\u044e \u043c\u0430\u0441\u0441\u0443 \u0442\u043e\u043a\u0435\u043d\u043e\u0432, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0434\u043e\u043b\u0436\u043d\u0430 \u0443\u0447\u0438\u0442\u044b\u0432\u0430\u0442\u044c \u043c\u043e\u0434\u0435\u043b\u044c. \u0422\u0430\u043a, \u0435\u0441\u043b\u0438 \u043f\u0435\u0440\u0435\u0434\u0430\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 0.1, \u043c\u043e\u0434\u0435\u043b\u044c \u0431\u0443\u0434\u0435\u0442 \u0443\u0447\u0438\u0442\u044b\u0432\u0430\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0442\u043e\u043a\u0435\u043d\u044b, \u0447\u044c\u044f \u0432\u0435\u0440\u043e\u044f\u0442\u043d\u043e\u0441\u0442\u043d\u0430\u044f \u043c\u0430\u0441\u0441\u0430 \u0432\u0445\u043e\u0434\u0438\u0442 \u0432 \u0432\u0435\u0440\u0445\u043d\u0438\u0435 10%. [int64]$n = 1 # \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u043e\u0432 \u043e\u0442\u0432\u0435\u0442\u043e\u0432 (1..4), \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043d\u0443\u0436\u043d\u043e \u0441\u0433\u0435\u043d\u0435\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0432\u0445\u043e\u0434\u043d\u043e\u0433\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f [int64]$max_tokens = 512 # \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0442\u043e\u043a\u0435\u043d\u043e\u0432, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0431\u0443\u0434\u0443\u0442 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u044b \u0434\u043b\u044f \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f \u043e\u0442\u0432\u0435\u0442\u043e\u0432 [boolean]$stream = $false # \u043f\u0435\u0440\u0435\u0434\u0430\u0432\u0430\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u043f\u043e \u0447\u0430\u0441\u0442\u044f\u043c \u0432 \u043f\u043e\u0442\u043e\u043a\u0435 6. \u0421\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432: $url = \"https://gigachat.devices.sberbank.ru/api/v1/chat/completions\" $headers = @{ \"Authorization\" = \"Bearer $GIGA_TOKEN\" \"Content-Type\" = \"application/json\" } $(Invoke-RestMethod -Uri \"https://gigachat.devices.sberbank.ru/api/v1/models\" -Headers $headers).data # \u0441\u043f\u0438\u0441\u043e\u043a \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0445 \u043c\u043e\u0434\u0435\u043b\u0435\u0439 $body = @{ model = \"GigaChat:latest\" messages = @( @{ role = $role content = $content } ) temperature = $temperature n = $n max_tokens = $max_tokens stream = $stream } | ConvertTo-Json $Request = Invoke-RestMethod -Method POST -Uri $url -Headers $headers -Body $body $Request.choices.message.content Curl \u0423\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432 \u0432 Ubuntu: wget https://gu-st.ru/content/lending/russian_trusted_root_ca_pem.crt \\ wget https://gu-st.ru/content/lending/russian_trusted_sub_ca_pem.crt \\ mkdir /usr/local/share/ca-certificates/russian_trusted \\ cp russian_trusted_root_ca_pem.crt russian_trusted_sub_ca_pem.crt /usr/local/share/ca-certificates/russian_trusted \\ update-ca-certificates -v \\ wget -qS --spider --max-redirect=0 https://www.sberbank.ru \u041f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 \u0442\u043e\u043a\u0435\u043d\u0430: Cred_Base64=\"N2U2ZDJmOWYtODI1ZS00OWI3LTk4ZjQtNjJmYmI3NTA2NDI3OmIyYzgwZmZmLTEzOGUtNDg1Mi05MjgwLWE2MGI4NTc0YTM2MQ==\" UUID=$(uuidgen) GIGA_TOKEN=$(curl -s --location --request POST \"https://ngw.devices.sberbank.ru:9443/api/v2/oauth\" \\ --header \"Authorization: Basic $Cred_Base64\" \\ --header \"RqUID: $UUID\" \\ --header \"Content-Type: application/x-www-form-urlencoded\" \\ --data-urlencode 'scope=GIGACHAT_API_PERS' | jq -r .access_token) curl -s --location \"https://gigachat.devices.sberbank.ru/api/v1/models\" --header \"Authorization: Bearer $GIGA_TOKEN\" | jq . \u0434\u043b\u044f \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u0421\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u0430: request=$(curl -s https://gigachat.devices.sberbank.ru/api/v1/chat/completions \\ -H \"Content-Type: application/json\" \\ -H \"Authorization: Bearer $GIGA_TOKEN\" \\ -d '{ \"model\": \"GigaChat:latest\", \"messages\": [ { \"role\": \"user\", \"content\": \"\u041a\u043e\u0433\u0434\u0430 \u0443\u0436\u0435 \u0418\u0418 \u0437\u0430\u0445\u0432\u0430\u0442\u0438\u0442 \u044d\u0442\u043e\u0442 \u043c\u0438\u0440?\" } ], \"temperature\": 0.7 }') echo $request | jq -r .choices[].message.content YandexGPT \u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c OAuth-Token: Create AIM Token \u0432\u0440\u0435\u043c\u044f \u0436\u0438\u0437\u043d\u0438 IAM-\u0442\u043e\u043a\u0435\u043d\u0430 \u043d\u0435 \u0431\u043e\u043b\u044c\u0448\u0435 12 \u0447\u0430\u0441\u043e\u0432 \\ yandexPassportOauthToken=\"y0_AgAAAAAGaLFLAATuwQAAAAD3xtRLQE4hvlazQ5euKO43XXXXXXXXXXX\" \u0434\u043b\u044f bash \\ $yandexPassportOauthToken = \"y0_AgAAAAAGaLFLAATuwQAAAAD3xtRLQE4hvlazQ5euKO43XXXXXXXXXXX\" \u0434\u043b\u044f PowerShell \u041e\u0431\u043c\u0435\u043d\u044f\u0442\u044c OAuth-Token \u043d\u0430 IAM-Token: IAM_TOKEN=$(curl -s -d \"{\\\"yandexPassportOauthToken\\\":\\\"$yandexPassportOauthToken\\\"}\" \"https://iam.api.cloud.yandex.net/iam/v1/tokens\" | jq -r .iamToken) \\ $IAM_TOKEN = $(Invoke-RestMethod -Method POST -Uri \"https://iam.api.cloud.yandex.net/iam/v1/tokens\" -Body $(@{yandexPassportOauthToken = \"$yandexPassportOauthToken\"} | ConvertTo-Json -Compress)).iamToken \u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c FOLDER_ID: CLOUD_ID=$(curl -s -H \"Authorization: Bearer $IAM_TOKEN\" https://resource-manager.api.cloud.yandex.net/resource-manager/v1/clouds | jq -r .clouds[].id) # \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c cloud id curl -s --request GET -H \"Authorization: Bearer $IAM_TOKEN\" https://resource-manager.api.cloud.yandex.net/resource-manager/v1/folders -d \"{\\\"cloudId\\\": \\\"$CLOUD_ID\\\"}\" # \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u0439 \u0432 \u043e\u0431\u043b\u0430\u043a\u0435 curl -s --request POST -H \"Authorization: Bearer $IAM_TOKEN\" https://resource-manager.api.cloud.yandex.net/resource-manager/v1/folders -d \"{\\\"cloudId\\\": \\\"$CLOUD_ID\\\", \\\"name\\\": \\\"test\\\"}\" # \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u044e \u0432 \u043e\u0431\u043b\u0430\u043a\u0435 FOLDER_ID=$(curl -s --request GET -H \"Authorization: Bearer $IAM_TOKEN\" https://resource-manager.api.cloud.yandex.net/resource-manager/v1/folders -d '{\"cloudId\": \"b1gf9n6heihqj0pt5piu\"}' | jq -r '.folders[] | select(.name == \"test\") | .id') # \u0437\u0430\u0431\u0440\u0430\u0442\u044c id \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u0438 $CLOUD_ID = $(Invoke-RestMethod -Method Get -Uri \"https://resource-manager.api.cloud.yandex.net/resource-manager/v1/clouds\" -Headers @{\"Authorization\"=\"Bearer $IAM_TOKEN\"; \"Content-Type\"=\"application/json\"}).clouds.id $FOLDER_ID = $(Invoke-RestMethod -Method Get -Uri \"https://resource-manager.api.cloud.yandex.net/resource-manager/v1/folders\" -Headers @{\"Authorization\"=\"Bearer $IAM_TOKEN\"; \"Content-Type\"=\"application/json\"} -Body (@{\"cloudId\"= $CLOUD_ID} | ConvertTo-Json)).folders | Where-Object name -eq test | Select-Object -ExpandProperty id \u0421\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u0430: model=\"gpt://$FOLDER_ID/yandexgpt/latest\" # https://cloud.yandex.ru/ru/docs/yandexgpt/concepts/models body=$(cat <<EOF { \"modelUri\": \"$model\", \"completionOptions\": { \"stream\": false, \"temperature\": 0.6, \"maxTokens\": 2000 }, \"messages\": [ { \"role\": \"user\", \"text\": \"\u041f\u043e\u0441\u0447\u0438\u0442\u0430\u0439 \u0441\u0443\u043c\u043c\u0443 22+33\" } ] } EOF) curl --request POST \\ -H \"Content-Type: application/json\" \\ -H \"Authorization: Bearer $IAM_TOKEN\" \\ -H \"x-folder-id: $FOLDER_ID\" \\ -d \"$body\" \\ \"https://llm.api.cloud.yandex.net/foundationModels/v1/completion\" $model = \"gpt://$FOLDER_ID/yandexgpt/latest\" $body = @\" { \"modelUri\": \"$model\", \"completionOptions\": { \"stream\": false, \"temperature\": 0.6, \"maxTokens\": 2000 }, \"messages\": [ { \"role\": \"user\", \"text\": \"\u041f\u043e\u0441\u0447\u0438\u0442\u0430\u0439 \u0441\u0443\u043c\u043c\u0443 22+33\" } ] } \"@ Invoke-RestMethod -Method POST -Uri \"https://llm.api.cloud.yandex.net/foundationModels/v1/completion\" -Headers @{\"Content-Type\"=\"application/json\"; \"Authorization\"=\"Bearer $IAM_TOKEN\"; \"x-folder-id\"=\"$FOLDER_ID\"} -Body $body SuperAGI Source \\ Playground generate \\ API Doc (exaples) SUPERAGI_API_KEY=\"31f72164129XXXXX\" prompt=\"\u043f\u043e\u0441\u0447\u0438\u0442\u0430\u0439 \u0441\u0443\u043c\u043c\u0443 22+33, \u0434\u0430\u0439 \u0442\u043e\u043b\u044c\u043a\u043e \u043e\u0442\u0432\u0435\u0442 \u0431\u0435\u0437 \u043b\u0438\u0448\u043d\u0435\u0433\u043e \u0442\u0435\u043a\u0441\u0442\u0430\" request=$(curl -s -X POST 'https://api.superagi.com/v1/generate/65437cbf227a4018516ad1ce' \\ -H 'Content-Type: application/json' \\ -H \"Authorization: Bearer $SUPERAGI_API_KEY\" \\ -d '{ \"prompt\": [\"$prompt\"], \"max_tokens\": 500, \"temperature\": 0.9, \"top_p\": 0.15, \"repetition_penalty\": 0, \"best_of\": 1.05, \"top_k\": 50, \"stream\": false }') echo $request | sed \"s/data: //\" | jq -r .choices[].text $SUPERAGI_API_KEY = \"31f72164129XXXXX\" $prompt = \"\u043f\u043e\u0441\u0447\u0438\u0442\u0430\u0439 \u0441\u0443\u043c\u043c\u0443 22+33, \u0434\u0430\u0439 \u0442\u043e\u043b\u044c\u043a\u043e \u043e\u0442\u0432\u0435\u0442 \u0431\u0435\u0437 \u043b\u0438\u0448\u043d\u0435\u0433\u043e \u0442\u0435\u043a\u0441\u0442\u0430\" $request = Invoke-RestMethod -Method Post -Uri 'https://api.superagi.com/v1/generate/65437cbf227a4018516ad1ce' -Headers @{ 'Content-Type' = 'application/json' 'Authorization' = \"Bearer $SUPERAGI_API_KEY\" } -Body (@{ prompt = @($prompt) max_tokens = 500 temperature = 0.9 top_p = 0.15 repetition_penalty = 0 best_of = 1.05 top_k = 50 stream = $false } | ConvertTo-Json) $($request -replace \"^data: \" | ConvertFrom-Json).choices.text Replicate API curl examples REPLICATE_API_TOKEN=\"r8_STyeUNXiGonkLfxE1FSKaqll26lXXXXXXXXXX\" prompt=\"\u0416\u0438\u0440\u0430\u0444 \u0432 \u043f\u043e\u043b\u043e\u0441\u043a\u0443 \u0437\u0435\u0431\u0440\u044b\" request=$(curl -s -X POST \\ -H \"Authorization: Token $REPLICATE_API_TOKEN\" \\ -H \"Content-Type: application/json\" \\ -d $'{ \"version\": \"ac732df83cea7fff18b8472768c88ad041fa750ff7682a21affe81863cbe77e4\", \"input\": { \"prompt\": \"$prompt\" } }' \\ https://api.replicate.com/v1/predictions) request_url=$(echo $request | jq -r .urls.get) response_status=$(curl -s -H \"Authorization: Token $REPLICATE_API_TOKEN\" $request_url | jq -r .status) while [[ $response_status != succeeded ]]; do response_status=$(curl -s -H \"Authorization: Token $REPLICATE_API_TOKEN\" $request_url | jq -r .status) done curl -s -H \"Authorization: Token $REPLICATE_API_TOKEN\" $request_url | jq -r .output[] $REPLICATE_API_TOKEN = \"r8_STyeUNXiGonkLfxE1FSKaqll26lXXXXXXXXXX\" $prompt = \"\u0416\u0438\u0440\u0430\u0444 \u0432 \u043f\u043e\u043b\u043e\u0441\u043a\u0443 \u0437\u0435\u0431\u0440\u044b\" $body = @{ version = \"ac732df83cea7fff18b8472768c88ad041fa750ff7682a21affe81863cbe77e4\" input = @{ prompt = $prompt } } | ConvertTo-Json $headers = @{ \"Authorization\" = \"Token $REPLICATE_API_TOKEN\" \"Content-Type\" = \"application/json\" } $request = Invoke-RestMethod -Uri \"https://api.replicate.com/v1/predictions\" -Method POST -Body $body -Headers $headers $response = Invoke-RestMethod $($request.urls.get) -Headers @{\"Authorization\" = \"Token $REPLICATE_API_TOKEN\"} while ($response.status -ne \"succeeded\") { $response = Invoke-RestMethod $($request.urls.get) -Headers @{\"Authorization\" = \"Token $REPLICATE_API_TOKEN\"} } $response.output Google-Filter https://www.google.com/search?q=the+rookie+2018+imdb \u0444\u043e\u0440\u043c\u0430\u0442 url-\u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u043f\u043e\u0438\u0441\u043a\u0430 \u0441 \u043f\u0440\u043e\u0431\u0435\u043b\u0430\u043c\u0438 \\ https://www.google.com/search?q=the+rookie+2018+site:imdb.com \u043f\u043e\u0438\u0441\u043a \u043f\u043e \u0441\u0430\u0439\u0442\u0443 \\ https://www.google.com/search?q=the+rookie+intitle:index.of+\"last modified\"+(mkv|avi) \u0438\u0441\u043a\u0430\u0442\u044c \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b, \u043d\u0430 \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u0443\u043a\u0430\u0437\u0430\u043d\u043e \"last modified\" (\u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0435 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f), \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b \u0447\u0435\u0440\u0435\u0437 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u043d\u044b\u0439 \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440 \u043f\u043e\u0438\u0441\u043a\u0430 (\u0432\u0441\u0435 \u043f\u0435\u0440\u0435\u0447\u0438\u0441\u043b\u0435\u043d\u043d\u044b\u0435 \u0441\u043b\u043e\u0432\u0430 \u0434\u043e\u043b\u0436\u043d\u044b \u0432\u0441\u0442\u0440\u0435\u0447\u0430\u0442\u044c\u0441\u044f \u0432 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0435) \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0441\u043b\u043e\u0432\u043e \"index.of\" (\u0443\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442 \u043d\u0430 \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u044e \u043d\u0430 \u0432\u0435\u0431-\u0441\u0435\u0440\u0432\u0435\u0440\u0435, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0441\u043f\u0438\u0441\u043e\u043a \u0444\u0430\u0439\u043b\u043e\u0432) \u0438 \u0438\u0441\u043a\u0430\u0442\u044c \u0444\u0430\u0439\u043b\u044b \u0441 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u044f\u043c\u0438 .mkv \u0438\u043b\u0438 (|) .avi \\ https://www.google.com/search?q=the+rookie+2018+filetype:torrent \\ \u0438\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u044f gopro hero 11 filetype:pdf \u0438\u0441\u043a\u0430\u0442\u044c \u0441\u0440\u0430\u0437\u0443 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442 (\u043d\u0430 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435 .pdf \u0438\u043b\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430) \\ \"\u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f/\u0433\u043b\u0430\u0433\u043e\u043b\u044b, \u0443\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u043d\u044b\u0435 \u0434\u043b\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f \u0432 \u043a\u043e\u043c\u0430\u043d\u0434\u043b\u0435\u0442\u0430\u0445\" \u0438\u0441\u043a\u0430\u0442\u044c \u043f\u043e \u0444\u0440\u0430\u0437\u0435 \u0446\u0435\u043b\u0438\u043a\u043e\u043c, \u0431\u0435\u0437 \u0440\u0430\u0437\u0431\u0438\u0435\u043d\u0438\u044f \u043d\u0430 \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u044b\u0435 \u0441\u043b\u043e\u0432\u0430 \\ \"\u044f\u0433\u0443\u0430\u0440 \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u044c -\u0436\u0438\u0432\u043e\u0442\u043d\u043e\u0435 -xe -xj\" \u0443\u0437\u043d\u0430\u0435\u043c \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u044c \u042f\u0433\u0443\u0430\u0440\u0430, \u0438\u0441\u043a\u043b\u044e\u0447\u0430\u0435\u043c \u0436\u0438\u0432\u043e\u0442\u043d\u043e\u0435 \u0438 \u043c\u043e\u0434\u0435\u043b\u0438 \u0430\u0432\u0442\u043e\u043c\u043e\u0431\u0438\u043b\u044f \\ \"intitle:\u043b\u0443\u0447\u0448\u0438\u0435 \u0444\u0438\u043b\u044c\u043c\u044b 2023\" \u0437\u0430\u043f\u0440\u043e\u0441 \u0438\u0449\u0435\u0442 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b, \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0438 (title HTML \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430) \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442 \u0441\u043b\u043e\u0432\u0430 \"\u043b\u0443\u0447\u0448\u0438\u0435\", \"\u0444\u0438\u043b\u044c\u043c\u044b\" \u0438 \"2023\" (\u0432\u0441\u0435 \u0441\u043b\u043e\u0432\u0430 \u0434\u043e\u043b\u0436\u043d\u044b \u0431\u044b\u0442\u044c \u0432 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0435) \\ \"allintitle:\u043b\u0443\u0447\u0448\u0438\u0435 \u0444\u0438\u043b\u044c\u043c\u044b 2023\" \u0437\u0430\u043f\u0440\u043e\u0441 \u0438\u0449\u0435\u0442 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b, \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0438 (title HTML \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430) \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442 \u0441\u043b\u043e\u0432\u0430 \"\u043b\u0443\u0447\u0448\u0438\u0435\", \"\u0444\u0438\u043b\u044c\u043c\u044b\" \u0438\u043b\u0438 \"2023\" (\u043e\u0434\u043d\u043e \u0438\u0437) \\ \"intext:telegram \u0431\u043e\u0442 powershell\" \u043f\u043e\u0438\u0441\u043a \u0441\u0442\u0440\u0430\u043d\u0438\u0446, \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0449\u0438\u0445 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0435 \u043a\u043b\u044e\u0447\u0435\u0432\u043e\u0435 \u0441\u043b\u043e\u0432\u043e \u0432 \u0442\u0435\u043a\u0441\u0442\u0435 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b (\u0430 \u043d\u0435 \u0442\u043e\u043b\u044c\u043a\u043e \u0432 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0435) \\ \"inurl:lifailon\" \u043f\u043e\u0438\u0441\u043a \u0441\u0442\u0440\u0430\u043d\u0438\u0446, \u0432 URL \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442\u0441\u044f \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0435 \u043a\u043b\u044e\u0447\u0435\u0432\u043e\u0435 \u0441\u043b\u043e\u0432\u043e \\ intitle:index.of \"game of thrones\" mkv daterange:2010..2015 \u0444\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u044f \u043f\u043e \u0434\u0430\u0442\u0435 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f, \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440 \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0437\u0430\u0434\u0430\u0442\u044c \u0434\u0438\u0430\u043f\u0430\u0437\u043e\u043d \u0434\u0430\u0442 \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 YYYYMMDD..YYYYMMDD \\ intitle:index.of \"game of thrones\" mkv after:2015 \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0438\u0442\u044c \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b \u043f\u043e\u0438\u0441\u043a\u0430 \u0444\u0430\u0439\u043b\u043e\u0432, \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u043d\u044b\u0445 \u0434\u043e (before) \u0438\u043b\u0438 \u043f\u043e\u0441\u043b\u0435 (after) \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0439 \u0434\u0430\u0442\u044b \\ intitle:index.of \"game of thrones\" mkv from:2010 to:2015 \u0444\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u044f \u043f\u043e \u0434\u0438\u0430\u043f\u0430\u0437\u043e\u043d\u0443 \u0434\u0430\u0442 \\ https://www.google.com/search?q=the-rookie-2018+site:imdb.com&btnI \u0440\u0435\u0434\u0438\u0440\u0435\u043a\u0442 \u043d\u0430 \u043f\u0435\u0440\u0432\u044b\u0439 url Google-API Google-Translate $Key = \"<TOKEN_API>\" # \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0442\u043e\u043a\u0435\u043d: https://console.cloud.google.com/apis/credentials $Text = \"You can see in the right corner how long each translation request takes (this does not depend on the amount of text being transferred).\" $LanguageTarget = \"RU\" $LanguageSource = \"EN\" $url = \"https://translation.googleapis.com/language/translate/v2?key=$key\" $Header = @{ \"Content-Type\" = \"application/json\" } $Body = @{ \"q\" = \"$Text\" \"target\" = \"$LanguageTarget\" \"source\" = \"$LanguageSource\" } | ConvertTo-Json $WebClient = New-Object System.Net.WebClient foreach ($key in $Header.Keys) { $WebClient.Headers.Add($key, $Header[$key]) } $Response = $WebClient.UploadString($url, \"POST\", $Body) | ConvertFrom-Json $Response.data.translations.translatedText Google-Search $Key = \"<TOKEN_API>\" # \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0442\u043e\u043a\u0435\u043d: https://developers.google.com/custom-search/v1/overview?hl=ru (\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u0441\u043a\u0438\u0439 \u043f\u043e\u0438\u0441\u043a JSON API \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 100 \u043f\u043e\u0438\u0441\u043a\u043e\u0432\u044b\u0445 \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 \u0432 \u0434\u0435\u043d\u044c \u0431\u0435\u0441\u043f\u043b\u0430\u0442\u043d\u043e) $cx = \"35c78340f49eb474a\" # \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u043e\u0438\u0441\u043a\u043e\u0432\u0443\u044e \u0441\u0438\u0441\u0442\u0435\u043c\u0443 https://programmablesearchengine.google.com/controlpanel/all $Query = \"\u043a\u0430\u043a \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0431\u043e\u0442\u0430 discord\" $Lang = \"ru\" $Num = 10 $Start = 0 $response = Invoke-RestMethod \"https://www.googleapis.com/customsearch/v1?q=$Query&key=$Key&cx=$cx&lr=lang_$Lang&num=$Num&$start=$Start\" $response.items | Select-Object title,snippet,displayLink,link | Format-List RapidAPI Google-Search72 $Key = \"<TOKEN_API>\" $headers=@{} $headers.Add(\"X-RapidAPI-Key\", \"$Key\") $headers.Add(\"X-RapidAPI-Host\", \"google-search72.p.rapidapi.com\") $query = \"\u043a\u0430\u043a \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0431\u043e\u0442\u0430 discord\" $response = Invoke-RestMethod \"https://google-search72.p.rapidapi.com/search?q=$query%20gitgub&gl=us&lr=lang_ru&num=20&start=0\" -Method GET -Headers $headers $response.items | Select-Object title,snippet,displayLink,link | Format-List IMDb IMDb8 $key = \"<TOKEN_API>\" # 500 \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 \u0432 \u043c\u0435\u0441\u044f\u0446 $query=\"Break\" $headers=@{} $headers.Add(\"X-RapidAPI-Key\", \"$key\") $headers.Add(\"X-RapidAPI-Host\", \"imdb8.p.rapidapi.com\") $response = Invoke-RestMethod \"https://imdb8.p.rapidapi.com/title/find?q=$query\" -Method GET -Headers $headers $response.results | select title,titletype,year,runningTimeInMinutes,id | Format-Table \"https://www.imdb.com$($response.results.id[0])\" $response.results.principals # \u0430\u043a\u0442\u0435\u0440\u044b $response.results.image MoviesDatabase MoviesDatabase $key = \"<TOKEN_API>\" $imdb_id = \"tt0455275\" $headers=@{} $headers.Add(\"X-RapidAPI-Key\", \"$key\") $headers.Add(\"X-RapidAPI-Host\", \"moviesdatabase.p.rapidapi.com\") $response = Invoke-RestMethod \"https://moviesdatabase.p.rapidapi.com/titles/$imdb_id\" -Method GET -Headers $headers $response.results TMDB Developer TMDB $TOKEN = \"548e444e7812575caa0a7eXXXXXXXXXX\" $Endpoint = \"search/tv\" # \u043f\u043e\u0438\u0441\u043a \u0441\u0435\u0440\u0438\u0430\u043b\u0430 (tv) \u0438 \u0444\u0438\u043b\u044c\u043c\u0430 (movie) \u043f\u043e \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044e $Query = \"\u0437\u0438\u043c\u043e\u0440\u043e\u0434\u043e\u043a\" $url = $(\"https://api.themoviedb.org/3/$Endpoint\"+\"?api_key=$TOKEN&query=$Query\") $(Invoke-RestMethod -Uri $url -Method Get).results $id = $(Invoke-RestMethod -Uri $url -Method Get).results.id # \u0437\u0430\u0431\u0440\u0430\u0442\u044c id \u0441\u0435\u0440\u0438\u0430\u043b\u0430 (210865) https://www.themoviedb.org/tv/210865 $Endpoint = \"tv/$id\" # \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438 \u043e \u0441\u0435\u0440\u0438\u0430\u043b\u0435 \u043f\u043e \u0435\u0433\u043e ID $url = $(\"https://api.themoviedb.org/3/$Endpoint\"+\"?api_key=$TOKEN\") $(Invoke-RestMethod -Uri $url -Method Get) # \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u0435\u0437\u043e\u043d\u043e\u0432 (.seasons), \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u044d\u043f\u0438\u0437\u043e\u0434\u043e\u0432 (.seasons.episode_count) (Invoke-RestMethod -Uri \"https://api.themoviedb.org/3/tv/$id/season/2?api_key=$Token\" -Method Get).episodes # \u0432\u044b\u0432\u0435\u0441\u0442\u0438 2 \u0441\u0435\u0437\u043e\u043d Invoke-RestMethod -Uri \"https://api.themoviedb.org/3/tv/$id/season/2/episode/8?api_key=$Token\" -Method Get # \u0432\u044b\u0432\u0435\u0441\u0442\u0438 8 \u044d\u043f\u0438\u0437\u043e\u0434 OMDb \u041f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 API \u043a\u043b\u044e\u0447\u0430 \u043f\u043e email $API_KEY = \"XXXXXXXX\" \\ $IMDb_ID = \"tt7587890\" \\ curl -s \"https://omdbapi.com/?apikey=$($API_KEY)&i=$($IMDb_ID)\" | jq . \\ curl -s \"https://omdbapi.com/?apikey=$($API_KEY)&i=$($IMDb_ID)\" | ConvertFrom-Json \\ Invoke-RestMethod \"https://omdbapi.com/?apikey=$($API_KEY)&s=The Rookie\" \\ Invoke-RestMethod \"https://omdbapi.com/?apikey=$($API_KEY)&t=The Rookie\" \u043f\u043e\u0438\u0441\u043a \u043f\u043e Title \\ Invoke-RestMethod \"https://omdbapi.com/?apikey=$($API_KEY)&t=The Rookie&y=1990\" \u043f\u043e\u0438\u0441\u043a \u043f\u043e Title \u0438 \u0433\u043e\u0434\u0443 \u0432\u044b\u0445\u043e\u0434\u0430 \\ Invoke-RestMethod \"https://omdbapi.com/?apikey=$($API_KEY)&t=The Rookie&type=movie\" \u043f\u043e\u0438\u0441\u043a \u0442\u043e\u043b\u044c\u043a\u043e \u0444\u0438\u043b\u044c\u043c\u0430 (movie) \u0438\u043b\u0438 \u0441\u0435\u0440\u0438\u0430\u043b\u0430 (series) \\ $(Invoke-RestMethod \"https://omdbapi.com/?apikey=$($API_KEY)&s=The Rookie\").Search \u043f\u043e\u0438\u0441\u043a \u0432\u0441\u0435\u0445 \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439 (\u0444\u0438\u043b\u044c\u043c\u044b \u0438 \u0441\u0435\u0440\u0438\u0430\u043b\u044b) ivi ivi api doc Invoke-RestMethod https://api.ivi.ru/mobileapi/categories \u0441\u043f\u0438\u0441\u043e\u043a \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0439 \u0438 \u0436\u0430\u043d\u0440\u043e\u0432 (genres/meta_genres) \\ Invoke-RestMethod https://api.ivi.ru/mobileapi/collections \u043f\u043e\u0434\u0431\u043e\u0440\u043a\u0438 (Invoke-RestMethod \"https://api.ivi.ru/mobileapi/search/v7/?query=zimorodok\").result.seasons.number \u043a\u043e\u043b-\u0432\u043e \u0441\u0435\u0437\u043e\u043d\u043e\u0432 \\ (Invoke-RestMethod \"https://api.ivi.ru/mobileapi/search/v7/?query=zimorodok\").result.seasons[1].episode_count \u043a\u043e\u043b-\u0432\u043e \u0441\u0435\u0440\u0438\u0439 \u0432\u043e \u0432\u0442\u043e\u0440\u043e\u043c \u0441\u0435\u0437\u043e\u043d\u0435 \\ (Invoke-RestMethod \"https://api.ivi.ru/mobileapi/search/v7/?query=zimorodok\").result.seasons[1].ivi_release_info.date_interval_min \u0434\u0430\u0442\u0430 \u0432\u044b\u0445\u043e\u0434\u0430 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u0439 \u0441\u0435\u0440\u0438\u0438 \\ (Invoke-RestMethod \"https://api.ivi.ru/mobileapi/search/v7/?query=zimorodok\").result.kp_rating \u0440\u0435\u0439\u0442\u0438\u043d\u0433 \u0432 \u041a\u0438\u043d\u043e\u043f\u043e\u0438\u0441\u043a (8.04) $id = (Invoke-RestMethod \"https://api.ivi.ru/mobileapi/search/v7/?query=zimorodok\").result.kp_id \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c id \u0432 \u041a\u0438\u043d\u043e\u043f\u043e\u0438\u0441\u043a (5106881) \\ id=$(curl -s https://api.ivi.ru/mobileapi/search/v7/?query=zimorodok | jq .result[].kp_id) \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c id \u0432 \u041a\u0438\u043d\u043e\u043f\u043e\u0438\u0441\u043a Kinopoisk id=5106881 get=$(curl -s https://www.kinopoisk.ru/film/$id/episodes/) printf \"%s\\n\" \"${get[@]}\" | grep -A 1 \"\u0421\u0435\u0437\u043e\u043d 2\" | grep \"\u044d\u043f\u0438\u0437\u043e\u0434\u043e\u0432\" | sed -r \"s/^.+\\: //\" # \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u044d\u043f\u0438\u0437\u0434\u043e\u0432\u043e\u0434 \u0432\u043e \u0432\u0442\u043e\u0440\u043e\u043c \u0441\u0435\u0437\u043e\u043d\u0435 kinopoisk.dev \u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0442\u043e\u043a\u0435\u043d \\ \u0414\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044f \u043f\u043e API \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 OpenAPI GET /v1.4/movie/{id} \u043f\u043e\u0438\u0441\u043a \u043f\u043e id $id = 5106881 $API_KEY = \"ZYMNJJA-0J8MNPN-PB4N7R7-XXXXXXX\" $Header = @{ \"accept\" = \"application/json\" \"X-API-KEY\" = \"$API_KEY\" } $irm = Invoke-RestMethod \"https://api.kinopoisk.dev/v1.4/movie/$id\" -Method GET -Headers $Header $irm.rating.kp # \u0440\u0435\u0439\u0442\u0438\u043d\u0433 \u0432 \u041a\u0438\u043d\u043e\u043f\u043e\u0438\u0441\u043a (8,079) $irm.seasonsInfo # \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0441\u0435\u0437\u043e\u043d\u043e\u0432 \u0438 \u044d\u043f\u0438\u0437\u043e\u0434\u043e\u0432 \u0432 \u043d\u0438\u0445 id=5106881 API_KEY=\"ZYMNJJA-0J8MNPN-PB4N7R7-XXXXXXX\" get=$(curl -s -X GET \\ \"https://api.kinopoisk.dev/v1.4/movie/$id\" \\ -H \"accept: application/json\" \\ -H \"X-API-KEY: $API_KEY\") echo $get | jq .rating.kp # \u0440\u0435\u0439\u0442\u0438\u043d\u0433 \u0432 \u041a\u0438\u043d\u043e\u043f\u043e\u0438\u0441\u043a (8,079) echo $get | jq .seasonsInfo[1].episodesCount # \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u044d\u043f\u0438\u0437\u043e\u0434\u043e\u0432 \u0432\u043e \u0432\u0442\u043e\u0440\u043e\u043c [1] \u0441\u0435\u0437\u043e\u043d\u0435 (6) GET /v1.4/movie/search query=\"zimorodok\" page=1 # \u043a\u043e\u043b-\u0432\u043e \u0441\u0442\u0440\u0430\u043d\u0438\u0446 \u0434\u043b\u044f \u0432\u044b\u0431\u043e\u0440\u043a\u0438 limit=1 # \u043a\u043e\u043b-\u0432\u043e \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432 \u043d\u0430 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435 curl -s -X GET \\ \"https://api.kinopoisk.dev/v1.4/movie/search?page=$page&limit=$limit&query=$query\" \\ -H \"accept: application/json\" \\ -H \"X-API-KEY: $API_KEY\" | jq . limit=5 request=$(curl -s -X GET \\ \"https://api.kinopoisk.dev/v1.4/movie/search?page=$page&limit=$limit&query=%D0%B7%D0%B8%D0%BC%D0%BE%D1%80%D0%BE%D0%B4%D0%BE%D0%BA\" \\ -H \"accept: application/json\" \\ -H \"X-API-KEY: $API_KEY\" | jq .) echo $request | jq '.docs[] | select(.year == 2022)' # \u043e\u0442\u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u044b\u0432\u043e\u0434 \u043f\u043e \u0433\u043e\u0434\u0443 \u0432\u044b\u0445\u043e\u0434\u0430 $API_KEY = \"ZYMNJJA-0J8MNPN-PB4N7R7-XXXXXXX\" $page = 1 $limit = 5 $query = \"%D0%B7%D0%B8%D0%BC%D0%BE%D1%80%D0%BE%D0%B4%D0%BE%D0%BA\" $request = Invoke-RestMethod -Uri \"https://api.kinopoisk.dev/v1.4/movie/search?page=$page&limit=$limit&query=$query\" -Headers @{\"accept\"=\"application/json\"; \"X-API-KEY\"=\"$API_KEY\"} $request.docs | Where-Object year -eq 2022 UrlCode function Get-PercentEncode ($str) { $bytes = [System.Text.Encoding]::UTF8.GetBytes($str) ($bytes | ForEach-Object { \"{0:X2}\" -f $_ }) -join '%' -replace \"^\",\"%\" } Get-PercentEncode \"\u0437\u0438\u043c\u043e\u0440\u043e\u0434\u043e\u043a\" function Get-UrlEncode($str) { [System.Web.HttpUtility]::UrlEncode($str) } UrlEncode \"\u0437\u0438\u043c\u043e\u0440\u043e\u0434\u043e\u043a\" percent-encode() { str=$1 echo -n \"$1\" | iconv -t utf8 | od -An -tx1 | tr ' ' % | tr -d '\\n' } percent-encode \"\u0437\u0438\u043c\u043e\u0440\u043e\u0434\u043e\u043a\" function Get-UrlDecode($encoded) { [System.Uri]::UnescapeDataString($encoded) } Get-UrlDecode \"%D0%B7%D0%B8%D0%BC%D0%BE%D1%80%D0%BE%D0%B4%D0%BE%D0%BA\" percent-decode() { encoded=$1 local url_encoded=\"${1//+/ }\" printf '%b' \"${url_encoded//%/\\\\x}\" } percent-decode \"%D0%B7%D0%B8%D0%BC%D0%BE%D1%80%D0%BE%D0%B4%D0%BE%D0%BA\" KinopoiskApiUnofficial \u0411\u0435\u0441\u043f\u043b\u0430\u0442\u043d\u043e 500 \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 \u0432 \u0441\u0443\u0442\u043a\u0438. Swagger documentation API_KEY=\"828ec96a-f45d-4e3d-84b1-XXXXXXXXXXXX\" $headers = @{ \"accept\" = \"application/json\" \"X-API-KEY\" = \"$API_KEY\" } Invoke-RestMethod -Uri 'https://kinopoiskapiunofficial.tech/api/v2.2/films/1142153' -Headers $headers curl -s \"https://kinopoiskapiunofficial.tech/api/v2.2/films/1142153\" -H \"accept: application/json\" -H \"X-API-KEY: $API_KEY\" | jq . Kinobox $url = \"https://www.kinopoisk.ru/film/694051\" \\ $kp_id = $url -replace \".+/\" \\ https://kinomix.web.app/#694051 \\ curl -s -X GET \"https://kinobox.tv/api/players/main?kinopoisk=$kp_id\" -H \"accept: application/json\" \u043f\u043e\u0438\u0441\u043a \u043f\u043e id \u041a\u0438\u043d\u043e\u043f\u043e\u0438\u0441\u043a \\ curl -s -X GET \"https://kinobox.tv/api/players/main?imdb=tt2293640\" -H \"accept: application/json\" \u043f\u043e\u0438\u0441\u043a \u043f\u043e id IMDb \\ curl -s -X GET \"https://kinobox.tv/api/players/main?title=minions\" -H \"accept: application/json\" \u043f\u043e\u0438\u0441\u043a \u043e\u0441\u043d\u043e\u0432\u043d\u044b\u0445 \u043f\u043b\u0435\u0435\u0440\u043e\u0432 \u043f\u043e \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044e \\ curl -s -X GET \"https://kinobox.tv/api/players/all?title=minions\" -H \"accept: application/json\" \u043f\u043e\u0438\u0441\u043a \u0432\u0441\u0435\u0445 \u043f\u043b\u0435\u0435\u0440\u043e\u0432 \\ curl -s -X GET \"https://kinobox.tv/api/popular/films\" -H \"accept: application/json\" \u043f\u043e\u043f\u0443\u043b\u044f\u0440\u043d\u044b\u0435 \u0444\u0438\u043b\u044c\u043c\u044b \\ curl -s -X GET \"https://kinobox.tv/api/popular/series\" -H \"accept: application/json\" \u043f\u043e\u043f\u0443\u043b\u044f\u0440\u043d\u044b\u0435 \u0441\u0435\u0440\u0438\u0430\u043b\u044b VideoCDN API \\ Source \\ API JSON $kp_id = 5106881 $token = \"YfTWH2p3Mai7ziqDoGjS3yXXXXXXXXXX\" $ep = \"tv-series\" $(Invoke-RestMethod $(\"https://videocdn.tv/api/$ep\"+\"?api_token=$token&field=kinopoisk_id&query=$kp_id\")).data.episodes | Where-Object season_num -eq 2 | Select-Object @{Name=\"Episode\"; Expression={$_.num}}, @{Name=\"Voice\"; Expression={$_.media.translation.title}} # \u043e\u0442\u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u0435\u0440\u0438\u0438 \u043f\u043e \u0432\u0442\u043e\u0440\u043e\u043c\u0443 \u0441\u0435\u0437\u043e\u043d\u0443 \u0438 \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u043e\u0437\u0432\u0443\u0447\u043a\u0438 \u043a \u0441\u0435\u0440\u0438\u044f\u043c kp_id=5106881 token=\"YfTWH2p3Mai7ziqDoGjS3yXXXXXXXXXX\" ep=\"tv-series\" curl -s \"https://videocdn.tv/api/$ep?api_token=$token&field=kinopoisk_id&query=$kp_id\" | jq \".data[].episodes | length\" # \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0441\u0435\u0440\u0438\u0439 curl -s \"https://videocdn.tv/api/$ep?api_token=$token&field=kinopoisk_id&query=$kp_id\" | jq \".data[].episodes[] | select(.season_num == 2) | {episode: .ru_title, voice: .media[].translation.title}\" # \u043e\u0442\u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u0432\u044b\u0432\u043e\u0434\u0430 Telegram @BotFather (https://t.me/BotFather) /newbot Format: https://api.telegram.org/bot<token>/<endpoint> getupdates function Get-FromTelegram { param ( $Token = \"687...:AAF...\", [switch]$Date, [switch]$Last, [switch]$ChatID ) $endpoint = \"getUpdates\" $url = \"https://api.telegram.org/bot$Token/$endpoint\" $result = Invoke-RestMethod -Uri $url if ($Date) { $Collections = New-Object System.Collections.Generic.List[System.Object] foreach ($r in $($result.result)) { $EpochTime = [DateTime]\"1/1/1970\" $TimeZone = Get-TimeZone $UTCTime = $EpochTime.AddSeconds($r.message.date) $d = $UTCTime.AddMinutes($TimeZone.BaseUtcOffset.TotalMinutes) $Collections.Add([PSCustomObject]@{ Message = $r.message.text; Date = $d }) } $Collections } else { if ($Last) { $result.result.message.text[-1] } elseif ($ChatID) { $Collections = New-Object System.Collections.Generic.List[System.Object] foreach ($r in $($result.result)) { $Collections.Add([PSCustomObject]@{ Message = $r.message.text; UserName = $r.message.chat.username; ChatID = $r.message.chat.id; ChatType = $r.message.chat.type }) } $Collections } else { $result.result.message.text } } } Get-FromTelegram \\ Get-FromTelegram -Last \\ Get-FromTelegram -Date \\ Get-FromTelegram -ChatID sendmessage function Send-ToTelegram { param ( [Parameter(Mandatory = $True)]$Text, $Token = \"687...:AAF...\", $Chat = \"125468108\", $Keyboard ) $endpoint = \"sendMessage\" $url = \"https://api.telegram.org/bot$Token/$endpoint\" $Body = @{ chat_id = $Chat text = $Text } if ($keyboard -ne $null) { $Body += @{reply_markup = $keyboard} } Invoke-RestMethod -Uri $url -Body $Body } Send-ToTelegram -Text \"Send test from powershell\" $LastDate = (Get-FromTelegram -date)[-1].Date while ($true) { $LastMessage = (Get-FromTelegram -date)[-1] Start-Sleep 1 $LastDateTest = $LastMessage.Date if (($LastMessage.Message -match \"/Service\") -and ($LastDate -ne $LastDateTest)) { $ServiceName = $($LastMessage.Message -split \" \")[-1] $Result = $(Get-Service $ServiceName -ErrorAction Ignore).Status if ($Result) { Send-ToTelegram -Text $Result } else { Send-ToTelegram -Text \"Service not found\" } $LastDate = $LastDateTest } } /Service vpnagent \\ /Service WinRM \\ /Service test Button $keyboard = '{ \"inline_keyboard\":[[ {\"text\":\"Uptime\",\"callback_data\":\"/Uptime\"}, {\"text\":\"Test\",\"callback_data\":\"/Test\"} ]] }' Send-ToTelegram -Text \"Test buttons\" -Keyboard $keyboard $request = (Invoke-RestMethod -Uri \"https://api.telegram.org/bot$Token/getUpdates\").result.callback_query $request.data # \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u0442\u044c callback_data \u043d\u0430\u0436\u0430\u0442\u043e\u0439 \u043a\u043d\u043e\u043f\u043a\u0438 $request.message.date Discord Developers \u0421\u043e\u0437\u0434\u0430\u0435\u043c Applications (General Information). \u0412 Bot \u043f\u0440\u0438\u0432\u044f\u0437\u044b\u0432\u0430\u0435\u043c \u043a Application \u0438 \u043a\u043e\u043f\u0438\u0440\u0443\u0435\u043c \u0442\u043e\u043a\u0435\u043d \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438. \u0412 OAuth2 - URL Generator \u0432\u044b\u0431\u0438\u0440\u0430\u0435\u043c bot \u0438 \u043f\u0440\u0430\u0432\u0430 Administrator \u0438 \u043a\u043e\u043f\u0438\u0440\u0443\u0435\u043c \u0441\u043e\u0437\u0434\u0430\u043d\u043d\u044b\u0439 URL \u0434\u043b\u044f \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u043d\u0430 \u043a\u0430\u043d\u0430\u043b. \u041f\u0435\u0440\u0435\u0445\u043e\u0434\u0438\u043c \u043f\u043e url \u0438 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c \u0431\u043e\u0442\u0430 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440. \u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c ID \u043a\u0430\u043d\u0430\u043b\u0430 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435 (\u0442\u0435\u043a\u0441\u0442\u043e\u0432\u044b\u0435 \u043a\u0430\u043d\u0430\u043b\u044b, \u043f\u0440\u0430\u0432\u043e\u0439 \u043a\u043d\u043e\u043f\u043a\u043e\u0439 \u043c\u044b\u0448\u0438 \u043a\u043e\u043f\u0438\u0440\u0443\u0435\u043c \u0441\u0441\u044b\u043b\u043a\u0443 \u0438 \u0437\u0430\u0431\u0438\u0440\u0430\u0435\u043c \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0439 id \u0432 url). Send to Discord DISCORD_TOKEN=\"MTE5NzE1NjM0NTM3NjQxMTcyOQ.XXXXXX.EzBF6RA9Kx_MSuhLW5elH1U-XXXXXXXXXXXXXX\" DISCORD_CHANNEL_ID=\"119403124XXXXXXXXXX\" TEXT=\"test from bash\" URL=\"https://discordapp.com/api/channels/$DISCORD_CHANNEL_ID/messages\" curl -s -X POST $URL \\ -H \"Authorization: Bot $DISCORD_TOKEN\" \\ -H \"Content-Type: application/json\" \\ -d \"{\\\"content\\\": \\\"$TEXT\\\"}\" $DISCORD_TOKEN = \"MTE5NzE1NjM0NTM3NjQxMTcyOQ.XXXXXX.EzBF6RA9Kx_MSuhLW5elH1U-XXXXXXXXXXXXXX\" $DISCORD_CHANNEL_ID = \"119403124XXXXXXXXXX\" $TEXT = \"test from PowerShell\" $URL = \"https://discordapp.com/api/channels/$DISCORD_CHANNEL_ID/messages\" $Body = @{ content = $TEXT } | ConvertTo-Json curl -s $URL -X POST -H \"Authorization: Bot $DISCORD_TOKEN\" -H \"Content-Type: application/json\" -d $Body Read from Discord curl -s -X GET $URL \\ -H \"Authorization: Bot $DISCORD_TOKEN\" \\ -H \"Content-Type: application/json\" | jq -r .[0].content $messages = (curl -s -X GET $URL -H \"Authorization: Bot $DISCORD_TOKEN\" -H \"Content-Type: application/json\" | ConvertFrom-Json) $messages | Select-Object content,timestamp,{$_.author.username} HttpClient $DISCORD_TOKEN = \"MTE5NzE1NjM0NTM3NjQxMTcyOQ.XXXXXX.EzBF6RA9Kx_MSuhLW5elH1U-XXXXXXXXXXXXXX\" $DISCORD_CHANNEL_ID = \"119403124XXXXXXXXXX\" $URL = \"https://discordapp.com/api/channels/$DISCORD_CHANNEL_ID/messages\" $HttpClient = New-Object System.Net.Http.HttpClient $HttpClient.DefaultRequestHeaders.Authorization = \"Bot $DISCORD_TOKEN\" $response = $HttpClient.GetAsync($URL).Result $messages = $response.Content.ReadAsStringAsync().Result ($messages | ConvertFrom-Json).content Button curl -X POST $URL \\ -H \"Content-Type: application/json\" \\ -H \"Authorization: Bot $DISCORD_TOKEN\" \\ -d ' { \"content\": \"Test text for button\", \"components\": [ { \"type\": 1, \"components\": [ { \"type\": 2, \"label\": \"Button\", \"style\": 1, \"custom_id\": \"button_click\" } ] } ] }' Discord.Net.Webhook Add-Type -Path $(ls \"$home\\Documents\\Discord.NET\\*.dll\").FullName # https://discordapp.com/api/webhooks/<webhook_id>/<webhook_token> (\u041d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u043a\u0430\u043d\u0430\u043b - \u0418\u043d\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u044f) $webhookId = 1197577280000000000 $webhookToken = \"rs8AA-XXXXXXXXXXX_Vk5RUI4A6HuSGhpCCTepq25duwCwLXasfv6u23a7XXXXXXXXXX\" $messageContent = \"Test dotNET\" $client = New-Object Discord.Webhook.DiscordWebhookClient($webhookId, $webhookToken) $client.SendMessageAsync($messageContent).Wait() Discord.Net.WebSocket $DiscordAssemblies = $(ls \"$home\\Documents\\Discord.NET\\*.dll\").FullName foreach ($assembly in $DiscordAssemblies) { Add-Type -Path $assembly } $DISCORD_TOKEN = \"MTE5NzE1NjM0NTM3NjQxMTcyOQ.XXXXXX.EzBF6RA9Kx_MSuhLW5elH1U-XXXXXXXXXXXXXX\" $Client = New-Object Discord.WebSocket.DiscordSocketClient $Client.Add_MessageReceived({ param($message) if ($message.Author.Id -ne $Client.CurrentUser.Id) { Write-Host (\"Received message from \" + $message.Author.Username + \": \" + $message.Content) if ($message.Content.Contains(\"ping\")) { $message.Channel.SendMessageAsync(\"pong\").GetAwaiter().GetResult() } } }) $Client.LoginAsync([Discord.TokenType]::Bot, $DISCORD_TOKEN).GetAwaiter().GetResult() #$Client.StartAsync().Wait() $Client.StartAsync().GetAwaiter().GetResult() $Client.ConnectionState [console]::ReadKey($true) $Client.LogoutAsync().GetAwaiter().GetResult() $Client.Dispose() oh-my-posh Install winget install JanDeDobbeleer.OhMyPosh -s winget \\ choco install oh-my-posh -y \\ scoop install https://github.com/JanDeDobbeleer/oh-my-posh/releases/latest/download/oh-my-posh.json \\ Set-ExecutionPolicy Bypass -Scope Process -Force; Invoke-Expression ((New-Object System.Net.WebClient).DownloadString('https://ohmyposh.dev/install.ps1')) Themes Get-PoshThemes \\ oh-my-posh init pwsh --config \"$env:POSH_THEMES_PATH/di4am0nd.omp.json\" | Invoke-Expression \\ oh-my-posh init pwsh --config \"https://raw.githubusercontent.com/JanDeDobbeleer/oh-my-posh/main/themes/cert.omp.json\" | Invoke-Expression New-Item -Path $PROFILE -Type File -Force \\ notepad $PROFILE \\ oh-my-posh init pwsh --config \"$env:POSH_THEMES_PATH/di4am0nd.omp.json\" | Invoke-Expression themes-performance Install-Module themes-performance -Repository NuGet Import-Module themes-performance Set-PoshTheme -Theme System-Sensors # -Save Set-PoshTheme -Theme System-Performance # -Save Set-PoshTheme -Theme Pwsh-Process-Performance # -Save Terminal-Icons Install-Module -Name Terminal-Icons -Repository PSGallery \\ scoop bucket add extras \\ scoop install terminal-icons notepad $PROFILE \\ Import-Module -Name Terminal-Icons \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442 \u0448\u0440\u0438\u0444\u0442\u044b, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u0445 \u043f\u0440\u043e\u0444\u0438\u043b\u044f PowerShell: Nerd Fonts \\ \u0421\u043f\u0438\u0441\u043e\u043a \u0448\u0440\u0438\u0444\u0442\u043e\u0432 \\ \u0421\u043a\u0430\u0447\u0430\u0442\u044c \u0438 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0448\u0440\u0438\u0444\u0442 \u043f\u043e\u0445\u043e\u0436\u0438\u0439 \u043d\u0430 Cascadia Code - CaskaydiaCove Pester Source Install-Module -Name Pester -Repository PSGallery -Force -AllowClobber \\ Import-Module Pester \\ $(Get-Module Pester -ListAvailable).Version .Tests.ps1 function Add-Numbers { param ( [int]$a, [int]$b ) $a + $b } Describe \"Add-Numbers\" { Context \"\u041f\u0440\u0438 \u0441\u043b\u043e\u0436\u0435\u043d\u0438\u0438 \u0434\u0432\u0443\u0445 \u0447\u0438\u0441\u0435\u043b\" { It \"\u0414\u043e\u043b\u0436\u043d\u0430 \u0432\u0435\u0440\u043d\u0443\u0442\u044c\u0441\u044f \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u0430\u044f \u0441\u0443\u043c\u043c\u0430\" { $result = Add-Numbers -a 3 -b 4 $result | Should -Be 7 } } Context \"\u041f\u0440\u0438 \u0441\u043b\u043e\u0436\u0435\u043d\u0438\u0438 \u0434\u0432\u0443\u0445 \u0447\u0438\u0441\u0435\u043b\" { It \"\u0414\u043e\u043b\u0436\u043d\u0430 \u0432\u0435\u0440\u043d\u0443\u0442\u044c\u0441\u044f \u043e\u0448\u0438\u0431\u043a\u0430 (5+0 -ne 4)\" { $result = Add-Numbers -a 5 -b 0 $result | Should -Be 4 } } } function Get-RunningProcess { return Get-Process | Select-Object -ExpandProperty Name } Describe \"Get-RunningProcess\" { Context \"\u041f\u0440\u0438 \u043d\u0430\u043b\u0438\u0447\u0438\u0438 \u0437\u0430\u043f\u0443\u0449\u0435\u043d\u043d\u044b\u0445 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u0432\" { It \"\u0414\u043e\u043b\u0436\u0435\u043d \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0438\u043c\u0435\u043d \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u0432\" { $result = Get-RunningProcess $result | Should -Contain \"svchost\" $result | Should -Contain \"explorer\" } } Context \"\u041a\u043e\u0433\u0434\u0430 \u043d\u0435\u0442 \u0437\u0430\u043f\u0443\u0449\u0435\u043d\u043d\u044b\u0445 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u0432\" { It \"\u0414\u043e\u043b\u0436\u0435\u043d \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0442\u044c \u043f\u0443\u0441\u0442\u043e\u0439 \u0441\u043f\u0438\u0441\u043e\u043a\" { # \u0417\u0430\u043c\u043e\u043a\u0430\u0442\u044c \u0444\u0443\u043d\u043a\u0446\u0438\u044e Get-Process, \u0447\u0442\u043e\u0431\u044b \u043e\u043d\u0430 \u0432\u0441\u0435\u0433\u0434\u0430 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u043b\u0430 \u043f\u0443\u0441\u0442\u043e\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u0432 Mock Get-Process { return @() } $result = Get-RunningProcess $result | Should -BeEmpty } } } Pandoc $release_latest = Invoke-RestMethod \"https://api.github.com/repos/jgm/pandoc/releases/latest\" $url = $($release_latest.assets | Where-Object name -match \"windows-x86_64.zip\").browser_download_url Invoke-RestMethod $url -OutFile $home\\Downloads\\pandoc.zip Expand-Archive -Path \"$home\\Downloads\\pandoc.zip\" -DestinationPath \"$home\\Downloads\\\" $path = $(Get-ChildItem \"$home\\Downloads\\pandoc-*\\*.exe\").FullName Copy-Item -Path $path -Destination \"C:\\Windows\\System32\\pandoc.exe\" Remove-Item \"$home\\Downloads\\pandoc*\" -Force -Recurse pandoc -s README.md -o index.html \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0438\u044f \u0438\u0437 Markdown \u0432 HTML \\ pandoc README.md -o index.html --css=styles.css \u043f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c \u0441\u0442\u0438\u043b\u0438 \u0438\u0437 css \\ pandoc -s index.html -o README.md \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0438\u044f \u0438\u0437 HTML \u0432 Markdown \\ pandoc -s README.md -o README.docx \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0438\u044f \u0432 Word \\ pandoc -s README.md -o README.epub \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0438\u044f \u0432 \u043e\u0442\u043a\u0440\u044b\u0442\u044b\u0439 \u0444\u043e\u0440\u043c\u0430\u0442 \u044d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u044b\u0445 \u0432\u0435\u0440\u0441\u0438\u0439 \u043a\u043d\u0438\u0433 \\ pandoc -s README.md -o README.pdf \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0438\u044f \u0432 PDF (\u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f rsvg-convert) Import-Module ImportExcel Import-Excel -Path srv.xlsx | Export-Csv -Path $csvFilePath -NoTypeInformation -Encoding UTF8 # \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0438\u044f Excel \u0432 csv pandoc -s -f csv -t markdown input.csv -o output.md # \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0438\u044f \u0442\u0430\u0431\u043b\u0438\u0446\u0443 csv \u0432 markdown FFmpeg $release_latest = Invoke-RestMethod \"https://api.github.com/repos/BtbN/FFmpeg-Builds/releases/latest\" $url = $($release_latest.assets | Where-Object name -match \"ffmpeg-master-latest-win64-gpl.zip\").browser_download_url Invoke-RestMethod $url -OutFile $home\\Downloads\\ffmpeg-master-latest-win64-gpl.zip Expand-Archive -Path \"$home\\Downloads\\ffmpeg-master-latest-win64-gpl.zip\" -DestinationPath \"$home\\Downloads\\\" Copy-Item -Path \"$home\\Downloads\\ffmpeg-master-latest-win64-gpl\\bin\\ffmpeg.exe\" -Destination \"C:\\Windows\\System32\\ffmpeg.exe\" Remove-Item \"$home\\Downloads\\ffmpeg-*\" -Force -Recurse ffmpeg -i input.mp4 output.gif \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c mp4 \u0432 gif \\ ffmpeg -i input.mp4 -filter_complex \"scale=1440:-1:flags=lanczos\" output.gif \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u0435 \u043d\u0430 \u0432\u044b\u0445\u043e\u0434\u0435 \\ ffmpeg -i input.mp4 -filter_complex \"scale=1440:-1:flags=lanczos\" -r 10 output.gif \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043a\u0430\u0434\u0440\u043e\u0432 \u0432 \u0441\u0435\u043a\u0443\u043d\u0434\u0443 \u043d\u0430 \u0432\u044b\u0445\u043e\u0434\u0435 \\ ffmpeg -i input.mp4 -filter_complex \"fps=5,scale=960:-1:flags=lanczos,split[s0][s1];[s0]palettegen=max_colors=32[p];[s1][p]paletteuse=dither=bayer\" output.gif \u0441\u0436\u0430\u0442\u0438\u0435 \u0437\u0430 \u0441\u0447\u0435\u0442 \u0446\u0432\u0435\u0442\u043e\u0432\u043e\u0439 \u043f\u043e\u043b\u0438\u0442\u0440\u044b \\ ffmpeg -i input.mp4 -ss 00:00:10 -frames:v 1 -q:v 1 output.jpg \u0432\u044b\u0442\u0430\u0449\u0438\u0442\u044c \u0441\u043a\u0440\u0438\u043d\u0448\u043e\u0442 \u0438\u0437 \u0432\u0438\u0434\u0435\u043e \u043d\u0430 10 \u0441\u0435\u043a\u0443\u043d\u0434\u0435 \\ ffmpeg -i input.mp4 -ss 00:00:05 -to 00:00:10 -c copy output.mp4 \u0432\u044b\u0442\u0430\u0449\u0438\u0442\u044c \u043a\u0443\u0441\u043e\u043a \u0432\u0438\u0434\u0435\u043e \\ ffmpeg -i \"%d.jpeg\" -framerate 2 -c:v libx264 -r 30 -pix_fmt yuv420p output.mp4 \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0432\u0438\u0434\u0435\u043e \u0438\u0437 \u0444\u043e\u0442\u043e (1.jpeg, 2.jpeg \u0438 \u0442.\u0434.) \u0441 framerate (\u0447\u0430\u0441\u0442\u043e\u0442\u043e\u0439 \u043a\u0430\u0434\u0440\u043e\u0432) \u0432 \u0441\u043e\u0437\u0434\u0430\u0432\u0430\u0435\u043c\u043e\u043c \u0432\u0438\u0434\u0435\u043e 2 \u043a\u0430\u0434\u0440\u0430 \u0432 \u0441\u0435\u043a\u0443\u043d\u0434\u0443 \\ ffmpeg -i \"rtsp://admin:password@192.168.3.201:554\" -rtsp_transport tcp -c:v copy -c:a aac -strict experimental output.mp4 \u0437\u0430\u043f\u0438\u0441\u044c \u0431\u0435\u0437 \u043f\u0435\u0440\u0435\u043a\u043e\u0434\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f (copy) RTSP-\u043f\u043e\u0442\u043e\u043a\u0430 \u0441 \u043a\u0430\u043c\u0435\u0440\u044b \u0432\u0438\u0434\u0435\u043e\u043d\u0430\u0431\u043b\u044e\u0434\u0435\u043d\u0438\u044f (+ \u0430\u0443\u0434\u0438\u043e \u0432 \u043a\u043e\u0434\u0435\u043a\u0435 AAC) \u0432 \u0444\u0430\u0439\u043b \\ ffmpeg -i \"rtsp://admin:password@192.168.3.201:554\" -rtsp_transport tcp -c:v copy -c:a aac -strict experimental -movflags +faststart+frag_keyframe+empty_moov output.mp4 \u043f\u0435\u0440\u0435\u043c\u0435\u0441\u0442\u0438\u0442\u044c \u043c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u043d\u0430\u0447\u0430\u043b\u043e \u0444\u0430\u0439\u043b\u0430, \u0447\u0442\u043e \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u043d\u0430\u0447\u0430\u0442\u044c \u0432\u043e\u0441\u043f\u0440\u043e\u0438\u0437\u0432\u0435\u0434\u0435\u043d\u0438\u0435 \u0444\u0430\u0439\u043b\u0430 \u0432 \u0432\u0438\u0434\u0435\u043e\u043f\u043b\u0435\u0435\u0440\u0435 \u0434\u043e \u0435\u0433\u043e \u043f\u043e\u043b\u043d\u043e\u0439 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \\ ffmpeg -i \"rtsp://admin:password@192.168.3.201:554\" -rtsp_transport tcp -frames:v 1 -c:v mjpeg output.jpg \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u0441\u043a\u0440\u0438\u043d\u0448\u043e\u0442 ImageMagick Source: ImageMagick magick identify -verbose PowerShell-Commands.png \u0438\u0437\u0432\u043b\u0435\u0447\u044c \u043c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \\ magick PowerShell-Commands.png output.jpg \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0438\u044f \u0444\u043e\u0440\u043c\u0430\u0442\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \\ magick PowerShell-Commands.png -resize 800x600 output.jpg \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0440\u0430\u0437\u043c\u0435\u0440 (\u0443\u0432\u0435\u043b\u0438\u0447\u0438\u0442\u044c \u0438\u043b\u0438 \u0443\u043c\u0435\u043d\u044c\u0448\u0438\u0442\u044c) \\ magick PowerShell-Commands.png -crop 400x300+100+50 output.jpg \u043e\u0431\u0440\u0435\u0437\u0430\u0442\u044c \\ magick PowerShell-Commands.png -rotate 90 output.jpg \u043f\u043e\u0432\u0435\u0440\u043d\u0443\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \\ magick PowerShell-Commands.png -fill white -pointsize 24 -gravity center -annotate +0+0 \"PowerShell\" output.jpg \u043d\u0430\u043b\u043e\u0436\u0438\u0442\u044c \u0442\u0435\u043a\u0441\u0442 \u043d\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \\ magick PowerShell-Commands.png -brightness-contrast +20x+10 output.jpg \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u044f\u0440\u043a\u043e\u0441\u0442\u044c \u0438 \u043a\u043e\u043d\u0442\u0440\u0430\u0441\u0442\u043d\u043e\u0441\u0442\u044c \\ magick convert -delay 100 1.png 2.png 3.png output.gif \u0441\u043e\u0437\u0434\u0430\u0442\u044c gif \u0438\u0437 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0439 \\ magick convert image1.jpg image2.jpg -append output.jpg \u0432\u0435\u0440\u0442\u0438\u043a\u0430\u043b\u044c\u043d\u043e \u043e\u0431\u044a\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f Hugo Source winget install Hugo.Hugo.Extended \\ scoop install hugo-extended \\ choco install hugo-extended $user = \"gohugoio\" $repository = \"hugo\" $release_latest = Invoke-RestMethod \"https://api.github.com/repos/$($user)/$($repository)/releases/latest\" $url = $($release_latest.assets | Where-Object name -match \"hugo_extended_[\\d.]+_windows-amd64\\.zip\").browser_download_url Invoke-RestMethod $url -OutFile $home\\Downloads\\hugo.zip Expand-Archive -Path \"$home\\Downloads\\hugo.zip\" -DestinationPath \"$home\\Downloads\\hugo\\\" Copy-Item -Path \"$home\\Downloads\\hugo\\hugo.exe\" -Destination \"C:\\Windows\\System32\\hugo.exe\" Remove-Item \"$home\\Downloads\\hugo*\" -Force -Recurse \u0421\u043f\u0438\u0441\u043e\u043a \u0442\u0435\u043c \\ \u0421\u043f\u0438\u0441\u043e\u043a \u043a\u043e\u043c\u0430\u043d\u0434 \\ hugo completion powershell | Out-String | Invoke-Expression \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0443 \u0430\u0432\u0442\u043e\u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044f \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u043e\u0432 \\ hugo version hugo new site lifailon.github.io.hugo # \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0438 \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043d\u043e\u0432\u044b\u0439 \u0441\u0430\u0439\u0442 cd lifailon.github.io.hugo git init # \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439\u0442\u0435 \u043f\u0443\u0441\u0442\u043e\u0439 \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u0439 Git \u0432 \u0442\u0435\u043a\u0443\u0449\u0435\u043c \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0435 \u0434\u043b\u044f \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 \u0442\u0435\u043c\u044b \u043a\u0430\u0442\u0430\u043b\u043e\u0433 themes, \u0434\u043e\u0431\u0430\u0432\u0438\u0432 \u0435\u0435 \u0432 \u0441\u0432\u043e\u0439 \u043f\u0440\u043e\u0435\u043a\u0442 \u043a\u0430\u043a \u043f\u043e\u0434\u043c\u043e\u0434\u0443\u043b\u044c Git (\u0435\u0441\u043b\u0438 \u043d\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u043a\u043b\u043e\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435) git submodule add -f https://github.com/JingWangTW/dark-theme-editor.git themes/dark-theme-editor echo 'theme = \"dark-theme-editor\"' >> hugo.toml #git submodule add https://github.com/rhazdon/hugo-theme-hello-friend-ng.git themes/hello-friend-ng #echo 'theme = \"hello-friend-ng\"' >> hugo.toml mkdir \"$home\\Downloads\\lifailon.github.io.hugo\\content\\powershell\\\" cp \"$home\\Downloads\\README.md\" \"$home\\Downloads\\lifailon.github.io.hugo\\content\\powershell\\index.md\" # \u0441\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c markdown \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442 \u0432 \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u044e \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430 hugo server # \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u0439 \u0432\u0435\u0431-\u0441\u0435\u0440\u0432\u0435\u0440 \u0441 \u043f\u0440\u043e\u0435\u043a\u0442\u043e\u043c (http://localhost:1313) Dark-Theme-Editor code hugo.toml baseURL = 'https://lifailon.github.io' languageCode = 'en-us' title = 'PS-Commands' theme = \"dark-theme-editor\" [taxonomies] autor = \"Lifailon\" tag = \"Code\" category = \"PowerShell\" [params] [params.site] faviconUrl = \"\" [params.header] title = \"Lifailon.GitHub.io\" subtitle = \"\u0411\u043e\u043b\u044c\u0448\u0430\u044f \u0431\u0430\u0437\u0430 \u0437\u0430\u043c\u0435\u0442\u043e\u043a PowerShell \u043d\u0430 \u0440\u0443\u0441\u0441\u043a\u043e\u043c \u044f\u0437\u044b\u043a\u0435.\" [params.header.logo] imgUrl = \"\" logoLink = \"\" [params.footer] copyrightStr = \"GitHub\" counter = false language = false hugoVersion = true theme = true modifiedTime = true dateFormat = \"Jan 02 2006\" gitHash = false [params.footer.socialLink] github = \"https://github.com/Lifailon\" [params.globalFrontmatter] author = \"Lifailon\" description = \"Large base of PowerShell notes in Russian language\" keywords = \"PowerShell\" [params.homePage] siteLongDescriptionTitle = \"PowerShell Commands\" siteLongDescription = \"\u0421\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430 \u044f\u0437\u044b\u043a\u0430, \u0441\u0438\u043d\u0442\u0430\u043a\u0441\u0438\u0441 \u043a\u043e\u043c\u0430\u043d\u0434\u043b\u0435\u0442\u043e\u0432 \u0438 \u043c\u043e\u0434\u0443\u043b\u0435\u0439, \u0440\u0430\u0431\u043e\u0442\u0430 \u0441 \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u044b\u043c\u0438 \u0438 \u0432\u043d\u0435\u0448\u043d\u0438\u043c\u0438 \u0443\u0442\u0438\u043b\u0438\u0442\u0430\u043c\u0438, \u043f\u043b\u0430\u0442\u0444\u043e\u0440\u043c\u043e\u0439 .NET, \u0440\u0430\u0437\u043b\u0438\u0447\u043d\u044b\u043c\u0438 \u0441\u0435\u0440\u0432\u0438\u0441\u0430\u043c\u0438 \u0447\u0435\u0440\u0435\u0437 REST API, \u0430 \u0442\u0430\u043a \u0436\u0435 \u0441\u0438\u0441\u0442\u0435\u043c\u0430\u043c\u0438 AD, Exchange, Hyper-V, VMWare, \u0431\u0430\u0437\u0430\u043c\u0438 \u0434\u0430\u043d\u043d\u044b\u0445 \u0438 \u0442.\u0434.\" showRecentPostsBlock = false numOfRecentPosts = 5 recentPostShowUrl = false [params.page] includeToc = false showAuthor = true showDate = true dateFormat = \"Jan 02 2006\" showTimeToRead = true showBreadcrumb = true codeBlockCopible = true code \"content\\powershell\\index.md\" --- title: \"PowerShell Commands\" author: \"Lifailon\" date: \"2024-03-14T03:00:00+03:00\" categories: [\"PowerShell\"] tags: [\"dotNET\", \"REST API\", \"Active Dirtctory\", \"EMShell\", \"PowerCLI\", \"Database\"] --- Hugo-Theme-Hello-Friend-ng baseURL = 'https://lifailon.github.io' title = \"Shell Commands\" languageCode = \"en-us\" theme = \"hello-friend-ng\" contentDir = \"content\" [taxonomies] autor = \"Lifailon\" tag = \"PowerShell\" category = \"Code\" [params.author] name = \"Lifailon\" [params.footer] trademark = \"2022-2024\" bottomText = [\"GitHub \u25b6\ufe0f <a href=\\\"https://github.com/Lifailon\\\">Lifailon</a>\"] [params.logo] logoMark = \">\" logoText = \"$ /home/lifailon/\" logoHomeLink = \"/\" logoCursorColor = \"#67a2c9\" logoCursorAnimate = \"2s\" logoCursorPathname = true logoCursorDisabled = false #[params.portrait] #path = \"/img/image.jpg\" #alt = \"Portrait\" #maxWidth = \"1500px\" [[params.social]] name = \"github\" url = \"https://github.com/Lifailon\" [menu] [[menu.main]] identifier = \"ps\" name = \"PowerShell Commands\" url = \"/powershell/\" hugo \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f \u0441\u0430\u0439\u0442\u0430 (\u0441\u043e\u0437\u0434\u0430\u0441\u0442 \u043f\u0430\u043f\u043a\u0443 public \u0441 \u0433\u043e\u0442\u043e\u0432\u044b\u043c\u0438 \u0444\u0430\u0439\u043b\u0430\u043c\u0438 \u0441\u0430\u0439\u0442\u0430 \u0434\u043b\u044f \u0440\u0430\u0437\u0432\u0435\u0440\u0442\u044b\u0432\u0430\u043d\u0438\u044f)","title":"PowerShell"},{"location":"#powershell-commands","text":"\u0411\u043e\u043b\u044c\u0448\u0430\u044f \u0431\u0430\u0437\u0430 \u0437\u0430\u043c\u0435\u0442\u043e\u043a PowerShell \u043d\u0430 \u0440\u0443\u0441\u0441\u043a\u043e\u043c \u044f\u0437\u044b\u043a\u0435. \u27a1\ufe0f \u0412\u0435\u0431-\u0432\u0435\u0440\u0441\u0438\u044f \ud83d\udce2 Habr: PowerShell \u0438 \u0435\u0433\u043e \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u0438 Help Object npp Regex DataType Module Bit Cycle Files Credential WinEvent Firewall Defender WindowsUpdate DISM Scheduled Network RDP Shutdown LocalAccounts SMB ActiveDirectory repadmin dcdiag ntdsutil GPO ServerManager DNS DHCP DFS StorageReplica PS2EXE NSSM Jobs SMTP Hyper-V VMWare/PowerCLI Exchange/EMShell TrueNAS Veeam REST API Pode Selenium IE COM dotNET Console API Drawing ObjectEvent Sockets Excel CSV XML JSON YAML HTML HtmlAgilityPack SQLite MySQL MSSQL InfluxDB Telegraf Elasticsearch CData ODBC PostgreSQL WMI Regedit Performance SNMP Zabbix pki OpenSSL OpenVPN Route NAT WireGuard VpnClient Proxy netsh OpenSSH WinRM PackageManagement NuGet Git GitHub DSC Ansible Win_Modules GigaChat YandexGPT SuperAGI Replicate Google-Filter Google-API RapidAPI TMDB OMDb ivi Kinopoisk VideoCDN Telegram Discord oh-my-posh Pester Pandoc FFmpeg ImageMagick Hugo","title":"PowerShell Commands"},{"location":"#help","text":"Get-Verb \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f/\u0433\u043b\u0430\u0433\u043e\u043b\u044b, \u0443\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u043d\u044b\u0435 \u0434\u043b\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f \u0432 \u043a\u043e\u043c\u0430\u043d\u0434\u043b\u0435\u0442\u0430\u0445 \\ Get-Command *Language* \u043f\u043e\u0438\u0441\u043a \u043a\u043e\u043c\u0430\u043d\u0434\u044b \u043f\u043e \u0438\u043c\u0435\u043d\u0438 \\ (Get-Command Get-Language).Module \u0443\u0437\u043d\u0430\u0442\u044c \u043a \u043a\u0430\u043a\u043e\u043c\u0443 \u043c\u043e\u0434\u0443\u043b\u044e \u043f\u0440\u0438\u043d\u0430\u0434\u043b\u0435\u0436\u0438\u0442 \u043a\u043e\u043c\u0430\u043d\u0434\u0430 \\ Get-Command Get-Content | fl Module,DLL \u0443\u0437\u043d\u0430\u0442\u044c \u043f\u0440\u0438\u043d\u0430\u0434\u043b\u0435\u0436\u043d\u043e\u0441\u0442\u044c \u043a\u043e\u043c\u0430\u043d\u0434\u044b \u043a \u043c\u043e\u0434\u0443\u043b\u044e \u0438 dll \\ Get-Command -Module LanguagePackManagement \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u043a\u043e\u043c\u0430\u043d\u0434 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0433\u043e \u043c\u043e\u0434\u0443\u043b\u044f \\ (Get-Module LanguagePackManagement).ExportedCommands.Values \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u043a\u043e\u043c\u0430\u043d\u0434 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0433\u043e \u043c\u043e\u0434\u0443\u043b\u044f \\ Get-Language | Get-Member \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u043c\u0435\u0442\u043e\u0434\u043e\u0432 \u043a\u043e\u043c\u0430\u043d\u0434\u044b (\u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f), \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u0432\u044b\u0432\u043e\u0434\u0430 \u0438 Event (\u0441\u043e\u0431\u044b\u0442\u0438\u044f \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432: Click) \\ (Get-Help Get-Service).Aliases \u0443\u0437\u043d\u0430\u0442\u044c \u043f\u0441\u0435\u0432\u0434\u043e\u043d\u0438\u043c\u043e\u043c \u043a\u043e\u043c\u0430\u043d\u0434\u044b \\ Get-Alias gsv \u0443\u0437\u043d\u0430\u0442\u044c \u0438\u043c\u044f \u043a\u043e\u043c\u0430\u043d\u0434\u044b \u043f\u043e \u043f\u0441\u0435\u0432\u0434\u043e\u043d\u0438\u043c\u0443 \\ Get-Help Get-Service \u0441\u0438\u043d\u0442\u0430\u043a\u0441\u0438\u0441 \\ Get-Help Get-Service -Parameter * \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u0432\u0441\u0435\u0445 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u043e\u0432 \\ Get-Help Get-Service -Online \\ Get-Help Get-Service -ShowWindow \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u043e\u0432 \u0432 GUI \u0441 \u0444\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u0435\u0439 \\ Show-Command \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u0441\u043f\u0438\u0441\u043e\u043a \u043a\u043e\u043c\u0430\u043d\u0434 \u0432 GUI \\ Show-Command Get-Service \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u043e\u0432 \u043a\u043e\u043c\u0430\u043d\u0434\u044b \u0432 GUI \\ Invoke-Expression iex \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0435\u0442 \u0442\u0435\u043a\u0441\u0442 \u0434\u043b\u044f \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u0432 \u043a\u043e\u043d\u0441\u043e\u043b\u0438 \u043a\u0430\u043a \u043a\u043e\u043c\u0430\u043d\u0434\u044b \\ $PSVersionTable \u0432\u0435\u0440\u0441\u0438\u044f PowerShell \\ Set-ExecutionPolicy Unrestricted \\ Get-ExecutionPolicy \\ $Metadata = New-Object System.Management.Automation.CommandMetaData (Get-Command Get-Service) \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u043e \u043a\u043e\u043c\u0430\u043d\u0434\u043b\u0435\u0442\u0435 \\ [System.Management.Automation.ProxyCommand]::Create($Metadata) \u0438\u0441\u0445\u043e\u0434\u043d\u044b\u0439 \u043a\u043e\u0434 \u0444\u0443\u043d\u043a\u0446\u0438\u0438","title":"Help"},{"location":"#object","text":"","title":"Object"},{"location":"#variable","text":"$var = Read-Host \"Enter\" \u0440\u0443\u0447\u043d\u043e\u0439 \u0432\u0432\u043e\u0434 \\ $pass = Read-Host \"Enter Password\" -AsSecureString \u0441\u043a\u0440\u044b\u0432\u0430\u0442\u044c \u043d\u0430\u0431\u043e\u0440 \\ $global:path = \"\\\\path\" \u0437\u0430\u0434\u0430\u0442\u044c \u0433\u043b\u043e\u0431\u0430\u043b\u044c\u043d\u0443\u044e \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0443\u044e, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 \u0432 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 \\ $using:srv \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0443\u044e \u0442\u0435\u043a\u0443\u0449\u0435\u0439 \u0441\u0435\u0441\u0441\u0438 \u0432 Invoke-\u0441\u0435\u0441\u0441\u0438\u0438 \\ Get-Variable \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \\ ls variable:/ \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \\ Get-Variable *srv* \u043d\u0430\u0439\u0442\u0438 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0443\u044e \u043f\u043e \u0438\u043c\u0435\u043d\u0438 \\ Get-Variable -Scope Global \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u0433\u043b\u043e\u0431\u0430\u043b\u044c\u043d\u044b\u0435 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \\ Get-Variable Error \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u044f\u044f \u043a\u043e\u043c\u0430\u043d\u0434\u0430 \u0441 \u043e\u0448\u0438\u0431\u043a\u043e\u0439 \\ Remove-Variable -Name * \u043e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u0432\u0441\u0435 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \\ $LASTEXITCODE \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u043a\u043e\u0434 \u0432\u044b\u0432\u043e\u0434\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0439 \u0437\u0430\u043f\u0443\u0449\u0435\u043d\u043d\u043e\u0439 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u044b, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 ping. \u0415\u0441\u043b\u0438 \u043a\u043e\u0434 \u0432\u043e\u0437\u0432\u0440\u0430\u0442\u0430 \u043f\u043e\u043b\u043e\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 (True), \u0442\u043e $LastExitCode = 0","title":"Variable"},{"location":"#env","text":"Get-ChildItem Env: \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \u043e\u043a\u0440\u0443\u0436\u0435\u043d\u0438\u044f \\ $env:PSModulePath \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u0438 \u0438\u043c\u043f\u043e\u0440\u0442\u0430 \u043c\u043e\u0434\u0443\u043b\u0435\u0439 \\ $env:userprofile \\ $env:computername \\ $env:username \\ $env:userdnsdomain \\ $env:logonserver \\ ([DirectoryServices.ActiveDirectory.Forest]::GetCurrentForest()).Name \\ [Environment]::GetFolderPath('ApplicationData')","title":"ENV"},{"location":"#history","text":"Get-History \u0438\u0441\u0442\u043e\u0440\u0438\u044f \u043a\u043e\u043c\u0430\u043d\u0434 \u0442\u0435\u043a\u0443\u0449\u0435\u0439 \u0441\u0435\u0441\u0441\u0438\u0438 \\ (Get-History)[-1].Duration.TotalSeconds \u0432\u0440\u0435\u043c\u044f \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0439 \u043a\u043e\u043c\u0430\u043d\u0434\u044b \\ (Get-PSReadLineOption).HistorySavePath \u043f\u0443\u0442\u044c \u043a \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u043d\u043e\u043c\u0443 \u0444\u0430\u0439\u043b\u0443 \u0441 4096 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0445 \u043a\u043e\u043c\u0430\u043d\u0434 (\u0438\u0437 \u043c\u043e\u0434\u0443\u043b\u044f PSReadLine) \\ Get-Content (Get-PSReadlineOption).HistorySavePath | Select-String Get \u043f\u043e\u0438\u0441\u043a \u043f\u043e \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u043c\u0443 \u0444\u0430\u0439\u043b\u0430 (GREP) \\ Set-PSReadlineOption -MaximumHistoryCount 10000 \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u043c\u044b\u0445 \u043a\u043e\u043c\u0430\u043d\u0434 \u0432 \u0444\u0430\u0439\u043b \\ Get-PSReadLineOption | select MaximumHistoryCount \\ Set-PSReadlineOption -HistorySaveStyle SaveNothing \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0432\u0435\u0434\u0435\u043d\u0438\u0435 \u0436\u0443\u0440\u043d\u0430\u043b\u0430 \\ F2 \u043f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f \u0441 InlineView \u043d\u0430 ListView","title":"History"},{"location":"#clipboard","text":"Set-Clipboard $srv \u0441\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u0443\u0444\u0435\u0440 \u043e\u0431\u043c\u0435\u043d\u0430 \\ Get-Clipboard \u0432\u0441\u0442\u0430\u0432\u0438\u0442\u044c","title":"Clipboard"},{"location":"#write","text":"Write-Host -ForegroundColor Black -BackgroundColor Green \"Test\" -NoNewline \\ Write-Error Test \\ Foreach ($n in 1..100) {Write-Progress -Activity \"Test Progress\" -PercentComplete $n}","title":"Write"},{"location":"#array","text":"$srv = @(\"server-01\", \"server-02\") \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043c\u0430\u0441\u0441\u0438\u0432 \\ $srv += @(\"server-03\") \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043c\u0430\u0441\u0441\u0438\u0432 \u043d\u043e\u0432\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 \\ $srv.Count \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043a\u043e\u043b-\u0432\u043e \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432 \u0432 \u043c\u0430\u0441\u0441\u0438\u0432\u0435 \\ Out-String \u043f\u043e\u0441\u0442\u0440\u043e\u0447\u043d\u044b\u0439 \u0432\u044b\u0432\u043e\u0434","title":"Array"},{"location":"#index","text":"$srv[0] \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u043f\u0435\u0440\u0432\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430 \u043c\u0430\u0441\u0441\u0438\u0432\u0430 \\ $srv[0] = Name \u0437\u0430\u043c\u0435\u043d\u0430 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430 \u0432 \u043c\u0430\u0441\u0441\u0438\u0432\u0435 \\ $srv[0].Length \u0443\u0437\u043d\u0430\u0442\u044c \u043a\u043e\u043b-\u0432\u043e \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432 \u043f\u0435\u0440\u0432\u043e\u0433\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0432 \u043c\u0430\u0441\u0441\u0438\u0432\u0435 \\ $srv[10..100] \u0441\u0440\u0435\u0437 $array = \"a\",\"b\",\"c\",\"d\" $num = 0 foreach ($a in $array) { $num += 1 $index = [array]::IndexOf($array, $a) # \u0443\u0437\u043d\u0430\u0442\u044c \u043d\u043e\u043c\u0435\u0440 \u0438\u043d\u0434\u0435\u043a\u0441\u0430 \u043f\u043e \u0437\u0430\u0447\u0435\u043d\u0438\u044e $array[$index] = $num # \u043f\u0435\u0440\u0435\u0441\u043e\u0431\u0440\u0430\u0442\u044c \u0438\u0441\u0445\u043e\u0434\u043d\u044b\u0439 \u043c\u0430\u0441\u0441\u0438\u0432 }","title":"Index"},{"location":"#hashtable","text":"$hashtable = @{\"User\" = \"$env:username\"; \"Server\" = \"$env:computername\"} # \u0441\u043e\u0437\u0434\u0430\u0442\u044c $hashtable += @{\"User2\" = \"$env:username\"; \"Server2\" = \"$env:computername\"} # \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043a\u043b\u044e\u0447\u0438 $hashtable.Keys # \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u043a\u043b\u044e\u0447\u0435\u0439 $hashtable[\"User\"] # \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 (Values) \u043f\u043e \u043a\u043b\u044e\u0447\u0443 $hashtable[\"User\"] = \"Test\" # \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c $hashtable.Remove(\"User\") # \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043a\u043b\u044e\u0447 $Tag = @{$true = 'dev'; $false = 'prod'}[([System.Net.Dns]::GetHostEntry(\"localhost\").HostName) -match '.*.TestDomain$']","title":"HashTable"},{"location":"#collectionslist","text":"$Collections = New-Object System.Collections.Generic.List[System.Object] $Collections.Add([PSCustomObject]@{User = $env:username; Server = $env:computername})","title":"Collections/List"},{"location":"#pscustomobject","text":"$CustomObject = [PSCustomObject][ordered]@{User = $env:username; Server = $env:computername} $CustomObject | Add-Member \u2013MemberType NoteProperty \u2013Name Arr \u2013Value @(1,2,3) # \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c Property (\u0441\u0432\u043e\u0439\u0441\u0442\u0432\u043e/\u0441\u0442\u043e\u0431\u0435\u0446) $CustomObject.Arr = @(1,3,5) # \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 $CustomObject.PsObject.Properties.Remove('User') # \u0443\u0434\u0430\u043b\u0438\u0442\u044c Property","title":"PSCustomObject"},{"location":"#add-member","text":"$ScriptBlock = {Get-Service} $CustomObject | Add-Member -Name \"TestMethod\" -MemberType ScriptMethod -Value $ScriptBlock # \u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c Method $CustomObject | Get-Member $CustomObject.TestMethod()","title":"Add-Member"},{"location":"#class","text":"Class CustomClass { [string]$User [string]$Server Start([bool]$Param1) { If ($Param1) {Write-Host \"Start Function\"}} } $Class = New-Object -TypeName CustomClass $Class.User = $env:username $Class.Server = $env:computername $Class.Start(1)","title":"Class"},{"location":"#pipeline","text":"$obj | Add-Member -MemberType NoteProperty -Name \"Type\" -Value \"user\" -Force \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043e\u0431\u044a\u043a\u0442\u0430 \u0432\u044b\u0432\u043e\u0434\u0430 NoteProperty \\ $obj | Add-Member -MemberType NoteProperty -Name \"User\" -Value \"admin\" -Force \u0438\u0437\u043c\u0435\u043d\u0435\u0438\u0435 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0433\u043e \u0434\u043b\u044f \u0441\u0443\u0449\u043d\u043e\u0441\u0442\u0438 \u043e\u0431\u044a\u0435\u043a\u0442\u0430 User \\ ping $srv | Out-Null \u043f\u0435\u0440\u0435\u043d\u0430\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u0432\u044b\u0432\u043e\u0434\u0430 \u0432 Out-Null","title":"Pipeline"},{"location":"#select-object","text":"Get-Process | Select-Object -Property * \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u0432\u044b\u0432\u043e\u0434\u0430 \\ Get-Process | select -Unique \"Name\" \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043f\u043e\u0432\u0442\u043e\u0440\u044f\u044e\u0449\u0438\u0435\u0441\u044f \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0432 \u043c\u0430\u0441\u0441\u0438\u0432\u0435 \\ Get-Process | select -ExpandProperty ProcessName \u043f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u044c \u0438\u0437 \u043e\u0431\u044a\u0435\u043a\u0442\u0430-\u043a\u043e\u043b\u043b\u0435\u043a\u0446\u0438\u0438 \u0432 \u043c\u0430\u0441\u0441\u0438\u0432 (\u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u0431\u0435\u0437 \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u044f \u0441\u0442\u043e\u043b\u0431\u0446\u0430) \\ (Get-Process | ? Name -match iperf).Modules \u0441\u043f\u0438\u0441\u043e\u043a \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c\u044b\u0445 \u043c\u043e\u0434\u0443\u043b\u0435\u0439 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u043c","title":"Select-Object"},{"location":"#expression","text":"ps | Sort-Object -Descending CPU | select -first 10 ProcessName, # \u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0430 \u043f\u043e CPU, \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u043f\u0435\u0440\u0432\u044b\u0445 10 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439 (-first) @{Name=\"ProcessorTime\"; Expression={$_.TotalProcessorTime -replace \"\\.\\d+$\"}}, # \u0437\u0430\u0442\u0440\u0430\u0447\u0435\u043d\u043e \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u0440\u043d\u043e\u0433\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0432 \u043c\u0438\u043d\u0443\u0442\u0430\u0445 @{Name=\"Memory\"; Expression={[string]([int]($_.WS / 1024kb))+\"MB\"}}, # \u0434\u0435\u043b\u0438\u043c \u0431\u0430\u0439\u0442\u044b \u043d\u0430 \u041a\u0411 @{Label=\"RunTime\"; Expression={((Get-Date) - $_.StartTime) -replace \"\\.\\d+$\"}} # \u0432\u044b\u0447\u0435\u0441\u0442\u044c \u0438\u0437 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438 - \u0432\u0440\u0435\u043c\u044f \u0437\u0430\u043f\u0443\u0441\u043a\u0430, \u0438 \u0443\u0434\u0430\u043b\u0438\u0442\u044c milisec","title":"Expression"},{"location":"#select-string","text":"$(ipconfig | Select-String IPv4) -replace \".+: \" | Where-Object {$_ -match \"^172.\"} \u0443\u0437\u043d\u0430\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e IP \\ $Current_IP = Get-Content $RDCMan_RDG_PATH | Select-String $RDCMan_Display_Name -Context 0,1 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0434\u0432\u0435 \u0441\u0442\u0440\u043e\u043a\u0438 \\ $Current_IP = $Current_IP.Context.DisplayPostContext[0] -replace \".+<name>|<\\/name>\" \u0437\u0430\u0431\u0440\u0430\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0432\u0442\u043e\u0440\u0443\u044e \u0441\u0442\u0440\u043e\u043a\u0443 \u0438 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0442\u044d\u0433\u0438","title":"Select-String"},{"location":"#format-tableformat-list","text":"Get-Process | ft ProcessName, StartTime -Autosize \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u0433\u0440\u0443\u043f\u043f\u0438\u0440\u043e\u0432\u043a\u0430 \u0440\u0430\u0437\u043c\u0435\u0440\u0430 \u0441\u0442\u043e\u043b\u0431\u0446\u043e\u0432","title":"Format-Table/Format-List"},{"location":"#measure-object","text":"Get-Process | Measure | select Count \u043a\u043e\u043b-\u0432\u043e \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 \\ Get-Process | Measure -Line -Word -Character \u043a\u043e\u043b-\u0432\u043e \u0441\u0442\u0440\u043e\u043a, \u0441\u043b\u043e\u0432 \u0438 Char \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 \\ Get-Process | Measure-Object PM -sum | Select-Object Count,@{Name=\"MEM_MB\"; Expression={[int]($_.Sum/1mb)}} \u043a\u043e\u043b-\u0432\u043e \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u0432 \u0438 \u043e\u0431\u0449\u0438\u0439 \u043e\u0431\u044a\u0435\u043c \u0437\u0430\u043d\u044f\u0442\u043e\u0439 \u043f\u0430\u043c\u044f\u0442\u0438 \u0432 \u041c\u0411\u0430\u0439\u0442","title":"Measure-Object"},{"location":"#compare-object","text":"Compare-Object -ReferenceObject (Get-Content -Path .\\file1.txt) -DifferenceObject (Get-Content -Path .\\file2.txt) \u0441\u0440\u0430\u0432\u043d\u0435\u043d\u0438\u0435 \u0434\u0432\u0443\u0445 \u0444\u0430\u0439\u043b\u043e\u0432 \\ $group1 = Get-ADGroupMember -Identity \"Domain Admins\" \\ $group2 = Get-ADGroupMember -Identity \"Enterprise Admins\" \\ Compare-Object -ReferenceObject $group1 -DifferenceObject $group2 -IncludeEqual == \u043d\u0435\u0442 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0439 \\ <= \u0435\u0441\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0432 $group1 \\ => \u0435\u0441\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0432 $group2","title":"Compare-Object"},{"location":"#where-object","text":"Get-Process | Where-Object {$_.ProcessName -match \"zabbix\"} \u0444\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u044f/\u043f\u043e\u0438\u0441\u043a \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u0432 \u043f\u043e \u0438\u043c\u0435\u043d\u0438 \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430 \u043e\u0431\u044a\u0435\u043a\u0442\u0430 \\ Get-Process | where CPU -gt 10 | Sort-Object -Descending CPU \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u043e\u0431\u044a\u0435\u043a\u0442\u044b, \u0433\u0434\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f CPU \u0431\u043e\u043b\u044c\u0448\u0435 10 \\ Get-Process | where WS -gt 200MB \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u044b \u0433\u0434\u0435 WS \u0432\u044b\u0448\u0435 200\u041c\u0411 \\ Get-Service | where Name -match \"zabbix\" \u043f\u043e\u0438\u0441\u043a \u0441\u043b\u0443\u0436\u0431\u044b \\ Get-Service -ComputerName $srv | Where {$_.Name -match \"WinRM\"} | Restart-Service \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0441\u043b\u0443\u0436\u0431\u0443 \u043d\u0430 \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u043e\u043c \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0435 \\ (Get-Service).DisplayName \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430 \u043c\u0430\u0441\u0441\u0438\u0432\u0430 \\ netstat -an | where {$_ -match 443} \\ netstat -an | ?{$_ -match 443} \\ (netstat -an) -match 443","title":"Where-Object (?)"},{"location":"#sort-object","text":"Get-Process | Sort-Object -Descending CPU | ft \u043e\u0431\u0440\u0430\u0442\u043d\u0430\u044f (-Descending) \u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0430 \u043f\u043e CPU \\ $path[-1..-10] \u043e\u0431\u0440\u0430\u0442\u043d\u0430\u044f \u0441\u0431\u043e\u0440\u043a\u0430 \u043c\u0430\u0441\u0441\u0438\u0432\u0430 \u0431\u0435\u0437 \u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0438","title":"Sort-Object"},{"location":"#lastfirst","text":"Get-Process | Sort-Object -Descending CPU | select -First 10 \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u043f\u0435\u0440\u0432\u044b\u0445 10 \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 \\ Get-Process | Sort-Object -Descending CPU | select -Last 10 \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0445 10 \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432","title":"Last/First"},{"location":"#group-object","text":"$Groups = Get-CimInstance -Class Win32_PnPSignedDriver | Select-Object DriverProviderName, FriendlyName, Description, DriverVersion, DriverDate | Group-Object DriverProviderName, FriendlyName, Description, DriverVersion, DriverDate $(foreach ($Group in $Groups) { $Group.Group[0] }) | Format-Table","title":"Group-Object"},{"location":"#error","text":"$Error \u0432\u044b\u0432\u043e\u0434\u0438\u0442 \u0432\u0441\u0435 \u043e\u0448\u0438\u0431\u043a\u0438 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u0441\u0435\u0430\u043d\u0441\u0430 \\ $Error[0].InvocationInfo \u0440\u0430\u0437\u0432\u0435\u0440\u043d\u0443\u0442\u044b\u0439 \u043e\u0442\u0447\u0435\u0442 \u043e\u0431 \u043e\u0448\u0438\u0431\u043a\u0435 \\ $Error.clear() \\ $LASTEXITCODE \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0439 \u043a\u043e\u043c\u0430\u043d\u0434\u044b (0 - \u0443\u0441\u043f\u0435\u0445) \\ exit 1 \u043a\u043e\u0434 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044f, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442\u0441\u044f $LASTEXITCODE","title":"Error"},{"location":"#property","text":"$srv.Count \u043a\u043e\u043b-\u0432\u043e \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432 \u0432 \u043c\u0430\u0441\u0441\u0438\u0432\u0435 \\ $srv.Length \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u043c \u0441\u0442\u0440\u043e\u043a\u0438 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u043e\u0439 [string] \u0438\u043b\u0438 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439 (\u0441\u0442\u0440\u043e\u043a) \u043e\u0431\u044a\u0435\u043a\u0442\u0430 \\ $srv.Chars(2) \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c 3-\u0439 \u0441\u0438\u043c\u0432\u043e\u043b \u0432 \u0441\u0442\u0440\u043e\u043a\u0435 \\ $srv[2] \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c 3-\u044e \u0441\u0442\u0440\u043e\u043a\u0443 \u0432 \u043c\u0430\u0441\u0441\u0438\u0432\u0435","title":"Property"},{"location":"#method","text":"$srv.Insert(0,\"https://\") \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u0435\u0440\u0435\u0434 \u043f\u0435\u0440\u0432\u044b\u043c \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u043c \\ $srv.Substring(4) \u0443\u0434\u0430\u043b\u0438\u0442\u044c (\u0438\u0437 \u0432\u0441\u0435\u0433\u043e \u043c\u0430\u0441\u0441\u0438\u0432\u0430) \u043f\u0435\u0440\u0432\u044b\u0435 4 \u0441\u0438\u043c\u0432\u043e\u043b\u0430 \\ $srv.Remove(3) \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0438\u0437 \u0432\u0441\u0435\u0433\u043e \u043c\u0430\u0441\u0441\u0438\u0432\u0430 \u0432\u0441\u0435 \u043f\u043e\u0441\u043b\u0435 3 \u0441\u0438\u043c\u0432\u043e\u043b\u0430 \\ $string = \"123\" \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0441\u0442\u0440\u043e\u043a\u0443 \\ $int = [convert]::ToInt32($string) \u043f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u044c \u0441\u0442\u0440\u043e\u043a\u0443 \u0432 \u0442\u0438\u043f \u0434\u0430\u043d\u043d\u044b\u0445 \u0447\u0438\u0441\u043b\u043e \\ [string]::Concat($text,$num) \u043e\u0431\u044a\u0435\u0434\u0435\u043d\u0438\u0442\u044c \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \u0432 \u043e\u0434\u043d\u0443 \u0441\u0442\u0440\u043e\u043a\u0443 \\ [string]::Join(\":\",$text,$num) \u043e\u0431\u044a\u0435\u0434\u0435\u043d\u0438\u0442\u044c \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044f \u0440\u0430\u0437\u0434\u0435\u043b\u0438\u0442\u0435\u043b\u044c \\ [string]::Compare($text,$num,$true) \u0432\u044b\u0434\u0430\u0435\u0442 0 \u043f\u0440\u0438 \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0438 \u0438\u043b\u0438 1/-1 \u043f\u0440\u0438 \u043d\u0435\u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0438, $true (\u0431\u0435\u0437 \u0443\u0447\u0435\u0442\u0430 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430) \u0438\u043b\u0438 $false (\u0441 \u0443\u0447\u0435\u0442\u043e\u043c \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430) \\ [string]::Equals($text,$num) \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u0442 \u0441\u0440\u0430\u0432\u043d\u0435\u043d\u0438\u0435 \u0434\u0432\u0443\u0445 \u0441\u0442\u0440\u043e\u043a \u0438 \u0432\u044b\u0434\u0430\u0435\u0442 $true \u043f\u0440\u0438 \u0438\u0445 \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0438 \u0438\u043b\u0438 $false \u043f\u0440\u0438 \u043d\u0435\u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0438 \\ [string]::IsNullOrEmpty($text) \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0441\u0442\u0440\u043e\u043a\u0438, \u0435\u0441\u043b\u0438 \u0441\u0442\u0440\u043e\u043a\u0430 \u043f\u0443\u0441\u0442\u0430 $true, \u0435\u0441\u043b\u0438 \u043d\u0435\u0442 $false \\ [string]::IsNullOrWhiteSpace($text2) \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u043d\u0430 \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0442\u043e\u043b\u044c\u043a\u043e \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432 \u043f\u0440\u043e\u0431\u0435\u043b, \u0442\u0430\u0431\u0443\u043b\u044f\u0446\u0438\u044f \u0438\u043b\u0438 \u0441\u0438\u043c\u0432\u043e\u043b \u043d\u043e\u0432\u043e\u0439 \u0441\u0442\u0440\u043e\u043a\u0438","title":"Method"},{"location":"#datetime","text":"Get-TimeZone \u0447\u0430\u0441\u043e\u0432\u043e\u0439 \u043f\u043e\u044f\u0441 \\ [DateTime]::UtcNow \u0432\u0440\u0435\u043c\u044f \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 UTC 0 \\ (Get-Date).AddHours(-3) \\ $Date = (Get-Date -Format \"dd/MM/yyyy hh:mm:ss\") \\ $Date = Get-Date -f \"dd/MM/yyyy\" \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u0442\u0438\u043f \u0434\u0430\u043d\u043d\u044b\u0445 [string] \\ [DateTime]$gDate = Get-Date \"$Date\" \u043f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u044c \u0432 \u0442\u0438\u043f [DateTime] \\ [int32]$days=($fDate-$gDate).Days \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0440\u0430\u0437\u043d\u0438\u0446\u0443 \u0432 \u0434\u043d\u044f\u0445 \\ \"5/7/07\" -as [DateTime] \u043f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u044c \u0432\u0445\u043e\u0434\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u0442\u0438\u043f \u0434\u0430\u043d\u043d\u044b\u0445 [DateTime] \\ New-TimeSpan -Start $VBRRP.CreationTimeUTC -End $VBRRP.CompletionTimeUTC \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0440\u0430\u0437\u043d\u0438\u0446\u0443 \u0432\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438","title":"DateTime"},{"location":"#measure-command","text":"(Measure-Command {ping ya.ru}).TotalSeconds \u0443\u0437\u043d\u0430\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0432\u0440\u0435\u043c\u044f \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \\ (Get-History)[-1] | select @{Name=\"RunTime\"; Expression={$_.EndExecutionTime - $_.StartExecutionTime}},ExecutionStatus,CommandLine \u043f\u043e\u0441\u0447\u0438\u0442\u0430\u0442\u044c \u0432\u0440\u0435\u043c\u044f \u0440\u0430\u0431\u043e\u0442\u044b \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0439 [-1] (select -Last 1) \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u043d\u043e\u0439 \u043a\u043e\u043c\u0430\u043d\u0434\u044b \u0438 \u0443\u0437\u043d\u0430\u0442\u044c \u0435\u0435 \u0441\u0442\u0430\u0442\u0443\u0441","title":"Measure-Command"},{"location":"#timer","text":"$start_time = Get-Date \u0437\u0430\u0444\u0438\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u0440\u0435\u043c\u044f \u0434\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u043a\u043e\u043c\u0430\u043d\u0434\u044b \\ $end_time = Get-Date \u0437\u0430\u0444\u0438\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u0440\u0435\u043c\u044f \u043f\u043e \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044e \\ $time = $end_time - $start_time \u0432\u044b\u0441\u0447\u0438\u0442\u0430\u0442\u044c \u0432\u0440\u0435\u043c\u044f \u0440\u0430\u0431\u043e\u0442\u044b \u0441\u043a\u0440\u0438\u043f\u0442\u0430 \\ $min = $time.minutes \\ $sec = $time.seconds \\ Write-Host \"$min \u043c\u0438\u043d\u0443\u0442 $sec \u0441\u0435\u043a\u0443\u043d\u0434\" \\ $timer = [System.Diagnostics.Stopwatch]::StartNew() \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0442\u0430\u0439\u043c\u0435\u0440 \\ $timer.IsRunning \u0441\u0442\u0430\u0442\u0443\u0441 \u0440\u0430\u0431\u043e\u0442\u044b \u0442\u0430\u0439\u043c\u0435\u0440\u0430 \\ $timer.Elapsed.TotalSeconds \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0440\u0435\u043c\u044f \u0441 \u043c\u043e\u043c\u0435\u043d\u0442\u0430 \u0437\u0430\u043f\u0443\u0441\u043a\u0430 (\u0432 \u0441\u0435\u043a\u0443\u043d\u0434\u0430\u0445) \\ $timer.Stop() \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0442\u0430\u0439\u043c\u0435\u0440","title":"Timer"},{"location":"#npp","text":"pwsh -NoExit -ExecutionPolicy Unrestricted -WindowStyle Maximized -File \"$(FULL_CURRENT_PATH)\" %AppData%\\Notepad++ themes/shortcuts.xml \\ <?xml version=\"1.0\" encoding=\"UTF-8\" ?> <NotepadPlus> <InternalCommands /> <Macros> <Macro name=\"`+\\+&gt;\" Ctrl=\"yes\" Alt=\"no\" Shift=\"no\" Key=\"190\"> <Action type=\"0\" message=\"2453\" wParam=\"0\" lParam=\"0\" sParam=\"\" /> <Action type=\"1\" message=\"2170\" wParam=\"0\" lParam=\"0\" sParam=\"`\" /> <Action type=\"0\" message=\"2451\" wParam=\"0\" lParam=\"0\" sParam=\"\" /> <Action type=\"0\" message=\"2451\" wParam=\"0\" lParam=\"0\" sParam=\"\" /> <Action type=\"1\" message=\"2170\" wParam=\"0\" lParam=\"0\" sParam=\" \" /> <Action type=\"1\" message=\"2170\" wParam=\"0\" lParam=\"0\" sParam=\"\\\" /> <Action type=\"0\" message=\"2300\" wParam=\"0\" lParam=\"0\" sParam=\"\" /> </Macro> </Macros> <UserDefinedCommands> <Command name=\"PowerShell7\" Ctrl=\"no\" Alt=\"yes\" Shift=\"no\" Key=\"116\">pwsh -NoExit -ExecutionPolicy Unrestricted -WindowStyle Maximized -File &quot;$(FULL_CURRENT_PATH)&quot;</Command> </UserDefinedCommands> <PluginCommands /> <ScintillaKeys /> </NotepadPlus> Parsing text to Markdown: \\ Macros: FnLeft+'+FnRight+FnRight+\\s\\\\+Down \\ Replace: \"# \",\"'\" . # \u041e\u0431\u043e\u0437\u043d\u0430\u0447\u0430\u0435\u0442 \u043b\u044e\u0431\u043e\u0439 \u0441\u0438\u043c\u0432\u043e\u043b \\ # \u042d\u043a\u0440\u0430\u043d\u0438\u0440\u0443\u044e\u0449\u0438\u0439 \u0441\u0438\u043c\u0432\u043e\u043b. \u0421\u0438\u043c\u0432\u043e\u043b\u044b \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u044d\u043a\u0440\u0430\u043d\u0438\u0440\u0443\u044e\u0442\u0441\u044f: ^, [, ., $, {, *, (, ), \\, +, |, ?, <, > ^ # \u041d\u0430\u0447\u0430\u043b\u043e \u0441\u0442\u0440\u043e\u043a\u0438 $ # \u041a\u043e\u043d\u0435\u0446 \u0441\u0442\u0440\u043e\u043a\u0438 \\n # \u041d\u043e\u0432\u0430\u044f \u0441\u0442\u0440\u043e\u043a\u0430 \\d # \u041b\u044e\u0431\u0430\u044f \u0446\u0438\u0444\u0440\u0430 \\D # \u041d\u0435 \u0446\u0438\u0444\u0440\u0430 \\w # \u041b\u044e\u0431\u0430\u044f \u0431\u0443\u043a\u0432\u0430 \u043b\u0430\u0442\u0438\u043d\u0438\u0446\u044b, \u0446\u0438\u0444\u0440\u0430, \u0438\u043b\u0438 \u0437\u043d\u0430\u043a \u043f\u043e\u0434\u0447\u0451\u0440\u043a\u0438\u0432\u0430\u043d\u0438\u044f \\W # \u041d\u0435 \u043b\u0430\u0442\u0438\u043d\u0438\u0446\u0430, \u043d\u0435 \u0446\u0438\u0444\u0440\u0430, \u043d\u0435 \u043f\u043e\u0434\u0447\u0451\u0440\u043a\u0438\u0432\u0430\u043d\u0438\u0435 \\s # \u041f\u0440\u043e\u0431\u0435\u043b, \u0442\u0430\u0431\u0443\u043b\u044f\u0446\u0438\u044f, \u043f\u0435\u0440\u0435\u043d\u043e\u0441 \u0441\u0442\u0440\u043e\u043a\u0438 \\S # \u041d\u0435 \u043f\u0440\u043e\u0431\u0435\u043b \\b # \u0413\u0440\u0430\u043d\u0438\u0446\u0430 \u0441\u043b\u043e\u0432\u0430. \u041f\u0440\u0438\u043c\u0435\u043d\u044f\u0435\u0442\u0441\u044f \u043a\u043e\u0433\u0434\u0430 \u043d\u0443\u0436\u043d\u043e \u0432\u044b\u0434\u0435\u043b\u0438\u0442\u044c, \u0447\u0442\u043e \u0438\u0441\u043a\u043e\u043c\u044b\u0435 \u0441\u0438\u043c\u0432\u043e\u043b\u044b \u044f\u0432\u043b\u044f\u044e\u0442\u0441\u044f \u0441\u043b\u043e\u0432\u043e\u043c, \u0430 \u043d\u0435 \u0447\u0430\u0441\u0442\u044c\u044e \u0434\u0440\u0443\u0433\u043e\u0433\u043e \u0441\u043b\u043e\u0432\u0430 \\B # \u041d\u0435 \u0433\u0440\u0430\u043d\u0438\u0446\u0430 \u0441\u043b\u043e\u0432\u0430 \\< # \u041d\u0430\u0447\u0430\u043b\u043e \u0441\u043b\u043e\u0432\u0430 \\> # \u041a\u043e\u043d\u0435\u0446 \u0441\u043b\u043e\u0432\u0430 \\A # \u041d\u0430\u0447\u0430\u043b\u043e \u0442\u0435\u043a\u0441\u0442\u0430 \\Z # \u041a\u043e\u043d\u0435\u0446 \u0442\u0435\u043a\u0441\u0442\u0430 * # \u041f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435\u043b\u044c. \u041e\u0437\u043d\u0430\u0447\u0430\u0435\u0442 \u0447\u0442\u043e \u043f\u0440\u0435\u0434\u0448\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0439 \u0441\u0438\u043c\u0432\u043e\u043b \u043c\u043e\u0436\u0435\u0442 \u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c 0 \u0438 \u0431\u043e\u043b\u0435\u0435 \u0440\u0430\u0437 + # \u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043f\u0440\u0435\u0434\u0448\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0435\u0433\u043e \u043d\u0435 \u043c\u0435\u043d\u0435\u0435 1-\u0433\u043e. ? # \u041e\u0433\u0440\u0430\u043d\u0438\u0447\u0438\u0442\u0435\u043b\u044c. \u041d\u0435 \u0431\u043e\u043b\u0435\u0435 \u043e\u0434\u043d\u043e\u0433\u043e \u0440\u0430\u0437\u0430 | # \u0418\u043b\u0438. \u0421\u043e\u0435\u0434\u0438\u043d\u044f\u0435\u0442 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u043e\u0432 () # \u0412 \u043a\u0440\u0443\u0433\u043b\u044b\u0435 \u0441\u043a\u043e\u0431\u043a\u0438 \u0437\u0430\u043a\u043b\u044e\u0447\u0430\u044e\u0442\u0441\u044f \u0432\u0441\u0435 \u043a\u043e\u043c\u0431\u0438\u043d\u0430\u0446\u0438\u0438 \u0441 \"\u0438\u043b\u0438\" \u0438 \u043f\u043e\u0438\u0441\u043a \u043d\u0430\u0447\u0430\u043b\u0430 \u0438 \u043a\u043e\u043d\u0446\u0430 \u0441\u0442\u0440\u043e\u043a [ ] # \u0412 \u043a\u0432\u0430\u0434\u0440\u0430\u0442\u043d\u044b\u0445 \u0441\u043a\u043e\u0431\u043a\u0430\u0445 \u0437\u0430\u0434\u0430\u044e\u0442\u0441\u044f \u0441\u0438\u043c\u0432\u043e\u043b\u044b \u043a \u043f\u043e\u0438\u0441\u043a\u0443, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 [a-\u044f\u0410-\u042f], \u0438\u043b\u0438 [0-9] [^ ] # \u0418\u0441\u043a\u043b\u044e\u0447\u0430\u0435\u0442 \u0438\u0437 \u043f\u043e\u0438\u0441\u043a\u0430 \u0441\u0438\u043c\u0432\u043e\u043b\u044b \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u0435 \u0432 \u043a\u0432\u0430\u0434\u0440\u0430\u0442\u043d\u044b\u0445 \u0441\u043a\u043e\u0431\u043a\u0430\u0445 { } # \u0412 \u0444\u0438\u0433\u0443\u0440\u043d\u044b\u0445 \u0441\u043a\u043e\u0431\u043a\u0430\u0445 \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u0442\u043e\u0447\u043d\u043e\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0432\u0445\u043e\u0436\u0434\u0435\u043d\u0438\u0439 \\d{2} # \u041d\u0430\u0439\u0442\u0438 \u0434\u0432\u0435 \u0446\u0438\u0444\u0440\u044b \\d{2,4} # \u041d\u0430\u0439\u0442\u0438 \u0434\u0432\u0435 \u0438\u043b\u0438 \u0447\u0435\u0442\u044b\u0440\u0435 {4,} # \u041d\u0430\u0439\u0442\u0438 \u0447\u0435\u0442\u044b\u0440\u0435 \u0438 \u0431\u043e\u043b\u0435\u0435 ^\\s{1,}#.+` \u043f\u043e\u0438\u0441\u043a \u0432\u043d\u0430\u0447\u0430\u043b\u0435 \u0441\u0442\u0440\u043e\u043a\u0438 \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u044f \u0438 \u043f\u0440\u043e\u0431\u0435\u043b \u043f\u043e\u0441\u043b\u0435 \u043d\u0435\u0433\u043e 1 \u0438\u043b\u0438 \u0431\u043e\u043b\u044c\u0448\u0435 \u0438 \u043b\u044e\u0431\u043e\u0435 \u043a\u043e\u043b-\u0432\u043e \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432","title":"npp"},{"location":"#regex","text":"-replace \"1\",\"2\" \u0437\u0430\u043c\u0435\u043d\u0430 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432 \u0432 \u0438\u043d\u0434\u0435\u043a\u0441\u0430\u0445 \u043c\u0430\u0441\u0441\u0438\u0432\u0430 (\u0432\u0435\u0437\u0434\u0435 \u0433\u0434\u0435 \u043f\u0440\u0438\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 1, \u0437\u0430\u043c\u0435\u043d\u0438\u0442\u044c \u043d\u0430 2), \u0434\u043b\u044f \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u043f\u0435\u0440\u0432\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \\ -split \" \" \u043f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u044c \u0441\u0442\u0440\u043e\u043a\u0443 \u0432 \u043c\u0430\u0441\u0441\u0438\u0432, \u0440\u0430\u0437\u0434\u0435\u043b\u0438\u0442\u0435\u043b\u0435\u043c \u0443\u043a\u0430\u0437\u0430\u043d \u043f\u0440\u043e\u0431\u0435\u043b, \u043a\u043e\u0442\u043e\u0440\u043e\u0439 \u0443\u0434\u0430\u043b\u044f\u0435\u0442\u0441\u044f ($url.Split(\"/\")[-1]) \\ -join \" \" \u043f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u044c \u043c\u0430\u0441\u0441\u0438\u0432 (\u043a\u043e\u043b\u043b\u0435\u043a\u0446\u0438\u044e) \u0432 \u0435\u0434\u0438\u043d\u0443\u044e \u0441\u0442\u0440\u043e\u043a\u0443 (string), \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0440\u0430\u0437\u0434\u0435\u043b\u0438\u0442\u0435\u043b\u0435\u043c \u043f\u0440\u043e\u0431\u0435\u043b \\ -like *txt* \u043f\u043e\u0438\u0441\u043a \u043f\u043e \u043c\u0430\u0441\u043a\u0430\u043c wildcard, \u0432\u044b\u0432\u043e\u0434\u0438\u0442 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043d\u0430 \u044d\u043a\u0440\u0430\u043d \\ -match txt \u043f\u043e\u0438\u0441\u043a\u0430 \u043f\u043e \u0448\u0430\u0431\u043b\u043e\u043d\u0430\u043c, \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u043d\u0430 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0435 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0433\u043e \u0442\u0435\u043a\u0441\u0442\u0430 \\ -match \"zabbix|rpc\" \u0443\u0441\u043b\u043e\u0432\u0438\u044f, \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430 \u043f\u043e \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u043c \u0441\u043b\u043e\u0432\u0430\u043c \\ -NotMatch \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u043d\u0430 \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0438\u0435 \u0432\u0445\u043e\u0436\u0434\u0435\u043d\u0438\u044f \\","title":"Regex"},{"location":"#matches","text":"$ip = \"192.168.10.1\" \\ $ip -match \"(\\.\\d{1,3})\\.\\d{1,2}\" True \\ $Matches \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u043f\u043e\u0434\u0445\u043e\u0434\u044f\u0449\u0438\u0435 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u043f\u043e\u0438\u0441\u043a\u0430, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0432\u0445\u043e\u0434\u044f\u0442 \u0438 \u043d\u0435 \u0432\u0445\u043e\u0434\u044f\u0442 \u0432 \u0433\u0440\u0443\u043f\u043f\u044b () $String = \"09/14/2017 12:00:27 - mtbill_post_201709141058.txt 7577_Delivered: OK\" \\ $String -Match \".*(?=\\.txt)\" | Out-Null \\ $Matches[0][-4..-1] -Join \"\" $string.Substring($string.IndexOf(\".txt\")-4, 4) 2-\u0439 \u0432\u0430\u0440\u0438\u0430\u043d\u0442 (IndexOf)`","title":"Matches"},{"location":"#net-method-format","text":"[string]::Format(\"{1} {0}\",\"Index0\",\"Index1\") \\ \"{1} {0}\" -f \"Index0\",\"Index1\" \\ \"{0:###-##-##}\" -f 1234567 \u0437\u0430\u043f\u0438\u0441\u0430\u0442\u044c \u0447\u0438\u0441\u043b\u043e \u0432 \u0434\u0440\u0443\u0433\u043e\u043c \u0444\u043e\u0440\u043c\u0430\u0442\u0435 (#) \\ \"{0:0000}\" -f 123 \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u0447\u0438\u0441\u043b\u043e \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 \u043d\u0435 \u043c\u0435\u043d\u044c\u0448\u0435 4 \u0437\u043d\u0430\u043a\u043e\u0432 (0123) \\ \"{0:P0}\" -f (220/1000) \u043f\u043e\u0441\u0447\u0438\u0442\u0430\u0442\u044c \u0432 \u043f\u0440\u043e\u0446\u0435\u043d\u0442\u0430\u0445 (P) \\ \"{0:P}\" -f (512MB/1GB) \u0441\u043a\u043e\u043b\u044c\u043a\u043e % \u0441\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 512\u041c\u0431 \u043e\u0442 1\u0413\u0431 \\ \"{0:0.0%}\" -f 0.123 \u0443\u043c\u043d\u043e\u0436\u0438\u0442\u044c \u043d\u0430 100% $gp = Get-Process | sort cpu -Descending | select -First 10 foreach ($p in $gp) { \"{0} - {1:N2}\" -f $p.processname, $p.cpu # \u043e\u043a\u0440\u0443\u0433\u043b\u0438\u0442\u044c }","title":"\u0424\u043e\u0440\u043c\u0430\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 (.NET method format)"},{"location":"#_1","text":"$rh = Read-Host \\ if ($rh -eq 1) {ipconfig} elseif ($rh -eq 2) {getmac} else {hostname} \\ \u0415\u0441\u043b\u0438 \u0443\u0441\u043b\u043e\u0432\u0438\u0435 if () \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0438\u0441\u0442\u0435\u043d\u043d\u044b\u043c ($True), \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435 \u0432 {} \\ \u0415\u0441\u043b\u0438 \u0443\u0441\u043b\u043e\u0432\u0438\u0435 if () \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043b\u043e\u0436\u043d\u044b\u043c ($False), \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435 \u043d\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u0430 else \\ \u0423\u0441\u043b\u043e\u0432\u0438\u0435 Elseif \u0438\u0434\u0451\u0442 \u043f\u043e\u0441\u043b\u0435 \u0443\u0441\u043b\u043e\u0432\u0438\u044f if \u0434\u043b\u044f \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u0443\u0441\u043b\u043e\u0432\u0438\u0439 \u043f\u0435\u0440\u0435\u0434 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u0430 else. \u041e\u043f\u0435\u0440\u0430\u0442\u043e\u0440, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043f\u0435\u0440\u0432\u044b\u0439 \u0432\u0435\u0440\u043d\u0435\u0442 $True, \u043e\u0442\u043c\u0435\u043d\u0438\u0442 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0445 \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u0443\u0441\u043b\u043e\u0432\u0438\u0439 \\ \u0415\u0441\u043b\u0438 \u043f\u0435\u0440\u0435\u0434\u0430\u0442\u044c \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0443\u044e \u0432 \u0443\u0441\u043b\u043e\u0432\u0438\u0435 \u0431\u0435\u0437 \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u0430, \u0442\u043e \u0431\u0443\u0434\u0435\u0442 \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0442\u044c\u0441\u044f \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0443 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u043e\u0439 \u043d\u0430 $True/$False \\ if ((tnc $srv -Port 80).TcpTestSucceeded) {\"Opened port\"} else {\"Closed port\"}","title":"\u0423\u0441\u043b\u043e\u0432\u043d\u044b\u0439 \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440"},{"location":"#_2","text":"-eq \u0440\u0430\u0432\u043d\u043e (equal) \\ -ceq \u0443\u0447\u0438\u0442\u044b\u0432\u0430\u0442\u044c \u0440\u0435\u0433\u0438\u0441\u0442\u0440 \\ -ne \u043d\u0435 \u0440\u0430\u0432\u043d\u043e (not equal) \\ -gt \u0431\u043e\u043b\u044c\u0448\u0435 (greater) \\ -ge \u0431\u043e\u043b\u044c\u0448\u0435 \u0438\u043b\u0438 \u0440\u0430\u0432\u043d\u043e \\ -lt \u043c\u0435\u043d\u044c\u0448\u0435 (less) \\ -le \u043c\u0435\u043d\u044c\u0448\u0435 \u0438\u043b\u0438 \u0440\u0430\u0432\u043d\u043e \\ -in \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u043d\u0430 \u043d\u0430\u043b\u0438\u0447\u0438\u0435 (5 -in @(1,2,3,4,5)) \\ -NOT \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u041d\u0415\u0422 !(Test-Path $path) \\ -and \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u0418 \\ -or \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u0418\u041b\u0418 \\ if ((($1 -eq 1) -and ($2 -eq 2)) -or ($1 -ne 3)) {\"$true\"} else {\"$false\"} \u0434\u0432\u0430 \u0443\u0441\u043b\u043e\u0432\u0438\u044f: (\u0435\u0441\u043b\u0438 $1 = 1 \u0438 $2 = 2) \u0438\u043b\u0438 $1 \u043d\u0435 \u0440\u0430\u0432\u043d\u043e 3","title":"\u041e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u044b"},{"location":"#pipeline-operators","text":"Write-Output \"First\" && Write-Output \"Second\" \u0434\u0432\u0435 \u0443\u0441\u043f\u0435\u0448\u043d\u044b\u0435 \u043a\u043e\u043c\u0430\u043d\u0434\u044b \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u044e\u0442\u0441\u044f \\ Write-Error \"Bad\" && Write-Output \"Second\" \u043f\u0435\u0440\u0432\u0430\u044f \u043a\u043e\u043c\u0430\u043d\u0434\u0430 \u0437\u0430\u0432\u0435\u0440\u0448\u0430\u0435\u0442\u0441\u044f \u043e\u0448\u0438\u0431\u043a\u043e\u0439, \u0438\u0437-\u0437\u0430 \u0447\u0435\u0433\u043e \u0432\u0442\u043e\u0440\u0430\u044f \u043a\u043e\u043c\u0430\u043d\u0434\u0430 \u043d\u0435 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \\ Write-Error \"Bad\" || Write-Output \"Second\" \u043f\u0435\u0440\u0432\u0430\u044f \u043a\u043e\u043c\u0430\u043d\u0434\u0430 \u0437\u0430\u0432\u0435\u0440\u0448\u0430\u0435\u0442\u0441\u044f \u043e\u0448\u0438\u0431\u043a\u043e\u0439, \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \u0432\u0442\u043e\u0440\u0430\u044f \u043a\u043e\u043c\u0430\u043d\u0434\u0430 \\ Write-Output \"First\" || Write-Output \"Second\" \u043f\u0435\u0440\u0432\u0430\u044f \u043a\u043e\u043c\u0430\u043d\u0434\u0430 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0430 \u0443\u0441\u043f\u0435\u0448\u043d\u043e, \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u0432\u0442\u043e\u0440\u0430\u044f \u043a\u043e\u043c\u0430\u043d\u0434\u0430 \u043d\u0435 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f","title":"Pipeline Operators"},{"location":"#invocation-operator","text":"$addr = \"8.8.8.8\" \\ $ping = \"ping\" \\ & $ping $addr \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u0442 \u0442\u0435\u043a\u0441\u0442 \u043a\u0430\u043a \u043a\u043e\u043c\u0430\u043d\u0434\u0443 & $ping $addr & \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u043a\u043e\u043c\u0430\u043d\u0434\u0443 \u0432 \u0444\u043e\u043d\u0435 \\ (Get-Job)[-1] | Receive-Job -Keep","title":"Invocation Operator"},{"location":"#_3","text":"\\d \u0447\u0438\u0441\u043b\u043e \u043e\u0442 0 \u0434\u043e 9 (20-07-2022 \u044d\u043a\u0432\u0438\u0432\u0430\u043b\u0435\u043d\u0442: \"\\d\\d-\\d\\d-\\d\\d\\d\\d\") \\ \\D \u043e\u0431\u043e\u0437\u043d\u0430\u0447\u0430\u0435\u0442 \u043b\u044e\u0431\u043e\u0439 \u0441\u0438\u043c\u0432\u043e\u043b, \u043a\u0440\u043e\u043c\u0435 \u0446\u0438\u0444\u0440\u044b. \u0423\u0434\u0430\u043b\u0435\u043d\u0438\u044f \u0432\u0441\u0435\u0445 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432, \u043a\u0440\u043e\u043c\u0435 \u0446\u0438\u0444\u0440: [int]$(\"123 test\" -replace \"\\D\") \\ \\w \u0431\u0443\u043a\u0432\u0430 \u043e\u0442 \"a\" \u0434\u043e \"z\" \u0438 \u043e\u0442 \"A\" \u0434\u043e \"Z\" \u0438\u043b\u0438 \u0447\u0438\u0441\u043b\u043e \u043e\u0442 0 \u0434\u043e 9 \\ \\s \u043f\u0440\u043e\u0431\u0435\u043b, \u044d\u043a\u0432\u0438\u0432\u0430\u043b\u0435\u043d\u0442: \" \" \\ \\n \u043d\u043e\u0432\u0430\u044f \u0441\u0442\u0440\u043e\u043a\u0430 \\ \\b \u043c\u0430\u0441\u043a\u0430, \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u0435\u0442 \u043d\u0430\u0447\u0430\u043b\u043e \u0438 \u043a\u043e\u043d\u0435\u0446 \u0446\u0435\u043b\u043e\u0433\u043e \u0441\u043b\u043e\u0432\u043e\u0441\u043e\u0447\u0435\u0442\u0430\u043d\u0438\u044f \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430 \\ . \u043e\u0431\u043e\u0437\u043d\u0430\u0447\u0430\u0435\u0442 \u043b\u044e\u0431\u043e\u0439 \u0441\u0438\u043c\u0432\u043e\u043b, \u043a\u0440\u043e\u043c\u0435 \u043d\u043e\u0432\u043e\u0439 \u0441\u0442\u0440\u043e\u043a\u0438 \\ \\ \u044d\u043a\u0440\u0430\u043d\u0438\u0440\u0443\u0435\u0442 \u043b\u044e\u0431\u043e\u0439 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u044c\u043d\u044b \u0441\u0438\u043c\u0432\u043e\u043b (\u043c\u0435\u0442\u0430\u0441\u0438\u043c\u0432\u043e\u043b). \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f, \u0435\u0441\u043b\u0438 \u043d\u0443\u0436\u043d\u043e \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0439 \u0441\u0438\u043c\u0432\u043e\u043b, \u0432\u043c\u0435\u0441\u0442\u043e \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u044c\u043d\u043e\u0433\u043e ({ } [ ] / \\ + * . $ ^ | ?) \\ + \u043f\u043e\u0432\u0442\u043e\u0440\u044f\u0435\u0442\u0441\u044f 1 \u0438 \u0431\u043e\u043b\u0435\u0435 \u0440\u0430\u0437 (\\s+) \\ {1,25} \u043a\u0432\u0430\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440, \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043f\u043e\u0432\u0442\u043e\u0440\u0435\u043d\u0438\u0439 \u0441\u0438\u043c\u0432\u043e\u043b\u0430 \u0441\u043b\u0435\u0432\u0430 \u043d\u0430 \u043f\u0440\u0430\u0432\u043e (\u043e\u0442 1 \u0434\u043e 25 \u0440\u0430\u0437) \\ [] \u043f\u043e\u0438\u0441\u043a \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u044f \u043b\u044e\u0431\u043e\u0439 \u0431\u0443\u043a\u0432\u044b, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, [A-z0-9] \u043e\u0442 A \u0434\u043e z \u0438 \u0446\u0438\u0444\u0440\u044b \u043e\u0442 0 \u0434\u043e 9 (\"192.168.1.1\" -match \"192.1[6-7][0-9]\")","title":"\u0421\u043f\u0435\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u0435 \u0441\u0438\u043c\u0432\u043e\u043b\u044b"},{"location":"#_4","text":"^ \u0438\u043b\u0438 \\A \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u0435\u0442 \u043d\u0430\u0447\u0430\u043b\u043e \u0441\u0442\u0440\u043e\u043a\u0438. $url -replace '^','https:' \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043d\u0430\u0447\u0430\u043b\u043e; \\ $ \u0438\u043b\u0438 \\Z \u043e\u0431\u043e\u0437\u043d\u0430\u0447\u0430\u044e\u0442 \u043a\u043e\u043d\u0435\u0446 \u0441\u0442\u0440\u043e\u043a\u0438. $ip -replace \"\\d{1,3}$\",\"0\" \\ (?=text) \u043f\u043e\u0438\u0441\u043a \u0441\u043b\u043e\u0432\u0430 \u0441\u043b\u0435\u0432\u0430. \u041f\u0438\u0448\u0435\u043c \u0441\u043b\u0435\u0432\u0430 \u043d\u0430 \u043f\u0440\u0430\u0432\u043e \u043e\u0442 \u0438\u0441\u043a\u043e\u043c\u043e\u0433\u043e (\u0438\u0449\u0435\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u0446\u0435\u043b\u044b\u0435 \u0441\u043b\u043e\u0432\u043e\u0441\u043e\u0447\u0435\u0442\u0430\u043d\u0438\u044f) \"Server:\\s(.{1,30})\\s(?=$username)\" \\ (?<=text) \u043f\u043e\u0438\u0441\u043a \u0441\u043b\u043e\u0432\u0430 \u0441\u043f\u0440\u0430\u0432\u0430. $in_time -replace \".+(?<=Last)\" \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u0441\u0435 \u0434\u043e \u0441\u043b\u043e\u0432\u0430 Last \\ (?!text) \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u0435\u0442 \u0441\u043e \u0441\u043b\u043e\u0432\u043e\u043c \u0441\u043b\u0435\u0432\u0430 \\ (?<!text) \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u0435\u0442 \u0441\u043e \u0441\u043b\u043e\u0432\u043e\u043c \u0441\u043f\u0440\u0430\u0432\u0430 $test = \"string\" \\ $test -replace \".{1}$\" \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043b\u044e\u0431\u043e\u0435 \u043a\u043e\u043b-\u0432\u043e \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432 \u0432 \u043a\u043e\u043d\u0446\u0435 \u0441\u0442\u0440\u043e\u043a\u0438 \\ $test -replace \"^.{1}\" \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043b\u044e\u0431\u043e\u0435 \u043a\u043e\u043b-\u0432\u043e \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432 \u0432 \u043d\u0430\u0447\u0430\u043b\u0435 \u0441\u0442\u0440\u043e\u043a\u0438 \\","title":"\u042f\u043a\u043e\u0440\u0438"},{"location":"#_5","text":"$date = '12.31.2021' \\ $date -replace '^(\\d{2}).(\\d{2})','$2.$1' \u043f\u043e\u043c\u0435\u043d\u044f\u0442\u044c \u043c\u0435\u0441\u0442\u0430\u043c\u0438 \\ $1 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u043f\u0435\u0440\u0432\u043e\u0439 \u0433\u0440\u0443\u043f\u043f\u044b \u0432 \u0441\u043a\u043e\u0431\u043a\u0430\u0445 \\ $2 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u0432\u0442\u043e\u0440\u043e\u0439 \u0433\u0440\u0443\u043f\u043f\u044b","title":"\u0413\u0440\u0443\u043f\u043f\u044b \u0437\u0430\u0445\u0432\u0430\u0442\u0430"},{"location":"#datatype","text":"$srv.GetType() \u0443\u0437\u043d\u0430\u0442\u044c \u0442\u0438\u043f \u0434\u0430\u043d\u043d\u044b\u0445 \\ $srv -is [string] \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u043d\u0430 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0435 \u0442\u0438\u043f\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 \\ $srv -isnot [System.Object] \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u043d\u0430 \u043d\u0435\u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0435 \\ [Object] \u043c\u0430\u0441\u0441\u0438\u0432 (BaseType:System.Array) \\ [DateTime] \u0444\u043e\u0440\u043c\u0430\u0442 \u0432\u0440\u0435\u043c\u0435\u043d\u0438 (BaseType:System.ValueType) \\ [Bool]/[Boolean] \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 ($True/$False) \u0438\u043b\u0438 1/0 (1 \u0431\u0438\u0442) \u043d\u0430\u043b\u0438\u0447\u0438\u0435/\u043e\u0442\u0441\u0443\u0441\u0442\u0432\u0438\u0435 \u043d\u0430\u043f\u0440\u044f\u0436\u0435\u043d\u0438\u044f \\ [Byte] 8-\u0431\u0438\u0442\u043d\u043e\u0435 (1 \u0431\u0430\u0439\u0442) \u0446\u0435\u043b\u043e\u0435 \u0447\u0438\u0441\u043b\u043e \u0431\u0435\u0437 \u0437\u043d\u0430\u043a\u0430 (0..255) \\ [Int16] 16-\u0431\u0438\u0442\u043d\u043e\u0435 \u0437\u043d\u0430\u043a\u043e\u0432\u043e\u0435 \u0446\u0435\u043b\u043e\u0435 \u0447\u0438\u0441\u043b\u043e \u043e\u0442 -32767 \u0434\u043e 32767 (\u0442\u0438\u043f \u0434\u0430\u043d\u043d\u044b\u0445 WORD 0..65535) \\ [Int] 32-\u0431\u0438\u0442\u043d\u043e\u0435 (4 \u0431\u0430\u0439\u0442\u0430) \u0437\u043d\u0430\u043a\u043e\u0432\u043e\u0435 \u0446\u0435\u043b\u043e\u0435 \u0447\u0438\u0441\u043b\u043e \u043e\u0442 \u20132147483648 \u0434\u043e 2147483647 (DWORD) \\ [Int64] 64-\u0431\u0438\u0442\u043d\u043e\u0435 \u043e\u0442 -9223372036854775808 \u0434\u043e 9223372036854775808 (LWORD) \\ [Decimal] 128-\u0431\u0438\u0442\u043d\u043e\u0435 \u0434\u0435\u0441\u044f\u0442\u0438\u0447\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043e\u0442 \u201379228162514264337593543950335 \u0434\u043e 79228162514264337593543950335 \\ [Single] \u0447\u0438\u0441\u043b\u043e \u0441 \u043f\u043b\u0430\u0432\u0430\u044e\u0449\u0435\u0439 \u0437\u0430\u043f\u044f\u0442\u043e\u0439 (32-\u0440\u0430\u0437\u0440\u044f\u0434\u043d\u043e\u0435) \\ [Double] \u0447\u0438\u0441\u043b\u043e \u0441 \u043f\u043b\u0430\u0432\u0430\u044e\u0449\u0435\u0439 \u0437\u0430\u043f\u044f\u0442\u043e\u0439 \u0441 \u0434\u0432\u043e\u0439\u043d\u043e\u0439 \u0442\u043e\u0447\u043d\u043e\u0441\u0442\u044c\u044e (64-\u0440\u0430\u0437\u0440\u044f\u0434\u043d\u043e\u0435) \\ [String] \u043d\u0435\u0438\u0437\u043c\u0435\u043d\u044f\u0435\u043c\u0430\u044f \u0441\u0442\u0440\u043e\u043a\u0430 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432 \u042e\u043d\u0438\u043a\u043e\u0434\u0430 \u0444\u0438\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0439 \u0434\u043b\u0438\u043d\u044b (BaseType:System.Object)","title":"DataType"},{"location":"#math","text":"[math] | Get-Member -Static \\ [math]::Pow(2,4) 2 \u0432 4 \u0441\u0442\u0435\u043f\u0435\u043d\u0438 \\ [math]::Truncate(1.8) \u0433\u0440\u0443\u0431\u043e\u0435 \u043e\u043a\u0440\u0443\u0433\u043b\u0435\u043d\u0438\u0435, \u0443\u0434\u0430\u043b\u044f\u0435\u0442 \u0434\u0440\u043e\u0431\u043d\u0443\u044e \u0447\u0430\u0441\u0442\u044c \\ [math]::Ceiling(1.8) \u043e\u043a\u0440\u0443\u0433\u043b\u044f\u0435\u0442 \u0447\u0438\u0441\u043b\u043e \u0432 \u0431\u043e\u043b\u044c\u0448\u0443\u044e \u0441\u0442\u043e\u0440\u043e\u043d\u0443 \u0434\u043e \u0431\u043b\u0438\u0436\u0430\u0439\u0448\u0435\u0433\u043e \u0446\u0435\u043b\u043e\u0433\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \\ [math]::Floor(-1.8) \u043e\u043a\u0440\u0443\u0433\u043b\u044f\u0435\u0442 \u0447\u0438\u0441\u043b\u043e \u0432 \u043c\u0435\u043d\u044c\u0448\u0443\u044e \u0441\u0442\u043e\u0440\u043e\u043d\u0443 \\ [math]::Min(33,22) \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u043d\u0430\u0438\u043c\u0435\u043d\u044c\u0448\u0435\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0434\u0432\u0443\u0445 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439 \\ [math]::Max(33,22) \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u043d\u0430\u0438\u0431\u043e\u043b\u044c\u0448\u0435\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0434\u0432\u0443\u0445 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439","title":"Math"},{"location":"#round","text":"[double]::Round(87.5, 0) 88 (\u043d\u0435\u0447\u0435\u0442\u043d\u043e\u0435), \u0432 .NET \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u043e\u043a\u0440\u0443\u0433\u043b\u0435\u043d\u0438\u0435 \u0432 \u0441\u0440\u0435\u0434\u043d\u0435\u0439 \u0442\u043e\u0447\u043a\u0435 ToEven, \u0433\u0434\u0435 *.5 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u043e\u043a\u0440\u0443\u0433\u043b\u044f\u044e\u0442\u0441\u044f \u0434\u043e \u0431\u043b\u0438\u0436\u0430\u0439\u0448\u0435\u0433\u043e \u0447\u0435\u0442\u043d\u043e\u0433\u043e \u0446\u0435\u043b\u043e\u0433\u043e \u0447\u0438\u0441\u043b\u0430. \\ [double]::Round(88.5, 0) 88 (\u0447\u0435\u0442\u043d\u043e\u0435) \\ [double]::Round(88.5, 0, 1) 89 (\u043e\u043a\u0440\u0443\u0433\u043b\u044f\u0442\u044c \u0432 \u0431\u043e\u043b\u044c\u0448\u0443\u044e \u0441\u0442\u043e\u0440\u043e\u043d\u0443) \\ [double]::Round(1234.56789, 2) \u043e\u043a\u0440\u0443\u0433\u043b\u0438\u0442\u044c \u0434\u043e 2 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432 \u043f\u043e\u0441\u043b\u0435 \u0437\u0430\u043f\u044f\u0442\u043e\u0439","title":"Round"},{"location":"#tostring","text":"(4164539/1MB).ToString(\"0.00\") \u0440\u0430\u0437\u0434\u0435\u043b\u0438\u0442\u044c \u043d\u0430 \u0434\u0432\u0430\u0436\u0434\u044b \u043d\u0430 1024/1024 \u0438 \u043e\u043a\u0440\u0443\u0433\u043b\u0438\u0442\u044c \u0434\u043e 3,97","title":"ToString"},{"location":"#char","text":"[Char] c\u0438\u043c\u0432\u043e\u043b \u042e\u043d\u0438\u043a\u043e\u0434\u0430 (16-\u0440\u0430\u0437\u0440\u044f\u0434\u043d\u044b\u0439) \\ $char = $srv.ToCharArray() \u0440\u0430\u0437\u0431\u0438\u0442\u044c \u0441\u0442\u0440\u043e\u043a\u0443 [string] \u043d\u0430 \u043c\u0430\u0441\u0441\u0438\u0432 [System.Array] \u0438\u0437 \u0431\u0443\u043a\u0432 \\","title":"Char"},{"location":"#module","text":"","title":"Module"},{"location":"#psd1","text":"@{ RootModule = \"Get-Function.psm1\" ModuleVersion = \"0.1\" Author = \"Lifailon\" CompanyName = \"Open Source Community\" Copyright = \"Apache-2.0\" Description = \"Function example\" PowerShellVersion = \"7.2\" PrivateData = @{ PSData = @{ Tags = @(\"Function\",\"Example\") ProjectUri = \"https://github.com/Lifailon/PS-Commands\" LicenseUri = \"https://github.com/Lifailon/Console-Translate/blob/rsa/LICENSE\" ReleaseNotes = \"Second release\" } } }","title":"psd1"},{"location":"#psm1","text":"function Get-Function { <# .SYNOPSIS \u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 .DESCRIPTION \u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 .LINK https://github.com/Lifailon/PS-Commands #> param ( [Parameter(Mandatory,ValueFromPipeline)][string]$Text, [ValidateSet(\"Test1\",\"Test2\")][string]$Provider = \"Test1\", [ValidateRange(1,3)][int]$Number = 2, [Switch]$Switch ) Write-Host Param Text: $Text Write-Host Param Provider: $Provider Write-Host Param Number: $Number Write-Host Param Switch: $Switch } Get-Function Test","title":"psm1"},{"location":"#switch","text":"$MMM = Get-Date -UFormat \"%m\" switch($MMM) { \"01\" {$Month = 'Jan'} \"02\" {$Month = 'Feb'} \"03\" {$Month = 'Mar'} \"04\" {$Month = 'Apr'} \"05\" {$Month = 'May'} \"06\" {$Month = 'Jun'} \"07\" {$Month = 'Jul'} \"08\" {$Month = 'Aug'} \"09\" {$Month = 'Sep'} \"10\" {$Month = 'Oct'} \"11\" {$Month = 'Nov'} \"12\" {$Month = 'Dec'} }","title":"Switch"},{"location":"#function-switch","text":"Function fun-switch ( [switch]$param ) { If ($param) {\"yes\"} else {\"no\"} } fun-switch -param","title":"function switch"},{"location":"#bit","text":"\u0414\u0432\u043e\u0438\u0447\u043d\u043e\u0435 \u0414\u0435\u0441\u044f\u0442\u0438\u0447\u043d\u043e\u0435 1 1 10 2 11 3 100 4 101 5 110 6 111 7 1000 8 1001 9 1010 10 1011 11 1100 12 1101 13 1110 14 1111 15 1 0000 16 \u0414\u0432\u043e\u0438\u0447\u043d\u043e\u0435 \u0414\u0435\u0441\u044f\u0442\u0438\u0447\u043d\u043e\u0435 \u041d\u043e\u043c\u0435\u0440 \u0440\u0430\u0437\u0440\u044f\u0434\u0430 1 1 0 10 2 1 100 4 2 1000 8 3 1 0000 16 4 10 0000 32 5 100 0000 64 6 1000 0000 128 7 1 0000 0000 256 8 \u0418\u0437 \u0434\u0432\u043e\u0438\u0447\u043d\u043e\u0433\u043e => \u0434\u0435\u0441\u044f\u0442\u0438\u0447\u043d\u043e\u0435 (1-\u0439 \u0432\u0430\u0440\u0438\u0430\u043d\u0442 \u043f\u043e \u0442\u0430\u0431\u043b\u0438\u0446\u0435) 1001 0011 = 1000 0000 + 1 0000 + 10 + 1 = 128 + 16 + 2 + 1 = 147 2-\u0439 \u0432\u0430\u0440\u0438\u0430\u043d\u0442 7654 3210 (\u0440\u0430\u0437\u0440\u044f\u0434\u044b \u0434\u0432\u043e\u0438\u0447\u043d\u043e\u0433\u043e \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u044f) = (1*2^7)+(0*2^6)+(0*2^5)+(1*2^4)+(0*2^3)+(0*2^2)+(1*2^1)+(1*2^0) = 147 [math]::Pow(2,7) + [math]::Pow(2,4) + [math]::Pow(2,1) + [math]::Pow(2,0) = 147` \u0438\u0441\u043a\u043b\u044e\u0447\u0438\u0442\u044c 0 \u0438 \u0441\u043b\u043e\u0436\u0438\u0442\u044c \u0441\u0442\u0435\u043f\u0435\u043d\u044c \u0418\u0437 \u0434\u0435\u0441\u044f\u0442\u0438\u0447\u043d\u043e\u0433\u043e => \u0434\u0432\u043e\u0438\u0447\u043d\u043e\u0435 (1-\u0439 \u0432\u0430\u0440\u0438\u0430\u043d\u0442 \u043f\u043e \u0442\u0430\u0431\u043b\u0438\u0446\u0435) 347 \u0432\u044b\u0447\u0435\u0441\u0442\u044c \u0431\u043b\u0438\u0436\u0430\u0439\u0448\u0438\u0435 256 = 91 (+ 1 0000 0000 \u0437\u0430\u0431\u0440\u0430\u0442\u044c \u0434\u0432\u043e\u0438\u0447\u043d\u044b\u0439 \u043e\u0441\u0442\u0430\u0442\u043e\u043a) 91 - 64 = 27 \u0431\u043b\u0438\u0436\u0430\u0439\u0448\u0435\u0435 16 (+ 100 0000) 27 - 16 = 11 \u0431\u043b\u0438\u0436\u0430\u0439\u0448\u0435\u0435 8 (+ 1 0000) 11 - 8 = 3 \u0431\u043b\u0438\u0436\u0430\u0439\u0448\u0435\u0435 2 (+ 1000) 3 - 2 = 1 (+ 10) 1 - 1 = 0 (+ 1) 1 0101 1011 2-\u0439 \u0432\u0430\u0440\u0438\u0430\u043d\u0442 \u041f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0435 \u0434\u0435\u043b\u0435\u043d\u0438\u044f \u0447\u0438\u0441\u043b\u0430 \u043d\u0430 2, \u043f\u0440\u0435\u0434\u0432\u043e\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0437\u0430\u0431\u0438\u0440\u0430\u044f \u043e\u0441\u0442\u0430\u0442\u043e\u043a \u0434\u043b\u044f \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u0447\u0435\u0442\u043d\u043e\u0433\u043e \u0447\u0438\u0441\u043b\u0430 \u0432 \u043c\u0435\u043d\u044c\u0448\u0443\u044e \u0441\u0442\u043e\u0440\u043e\u043d\u0443 347 - 346 = \u043e\u0441\u0442\u0430\u0442\u043e\u043a 1, (347-1)/2 = 173 173 - 172 = \u043e\u0441\u0442\u0430\u0442\u043e\u043a 1, (172-1)/2 = 86 86 - 86 = \u043e\u0441\u0442\u0430\u0442\u043e\u043a 0, 86/2 = 43 43 - 42 = \u043e\u0441\u0442\u0430\u0442\u043e\u043a 1, (43-1)/2 = 21 21 - 20 = \u043e\u0441\u0442\u0430\u0442\u043e\u043a 1, (21-1)/2 = 10 10 - 10 = \u043e\u0441\u0442\u0430\u0442\u043e\u043a 0, 10/2 = 5 5 - 4 = \u043e\u0441\u0442\u0430\u0442\u043e\u043a 1, (5-1)/2 = 2 2 - 2 = \u043e\u0441\u0442\u0430\u0442\u043e\u043a 0, 2/2 = 1 1 - 2 = \u043e\u0441\u0442\u0430\u0442\u043e\u043a 1, (1-1)/2 = 0 \u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u0434\u0435\u043b\u0435\u043d\u0438\u044f \u0437\u0430\u043f\u0438\u0441\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u0441\u043d\u0438\u0437\u0443 \u0432\u0432\u0435\u0440\u0445","title":"Bit"},{"location":"#bit-convertor","text":"function ConvertTo-Bit { param ( [Int]$int ) [array]$bits = @() $test = $true while ($test -eq $true) { if (($int/2).GetType() -match [double]) { $int = ($int-1)/2 [array]$bits += 1 } elseif (($int/2).GetType() -match [int]) { $int = $int/2 [array]$bits += 0 } if ($int -eq 0) { $test = $false } } $bits = $bits[-1..-999] ([string]($bits)) -replace \"\\s\" } ConvertTo-Bit 347 function ConvertFrom-Bit { param ( $bit ) [int]$int = 0 $bits = $bit.ToString().ToCharArray() $index = ($bits.Count)-1 foreach ($b in $bits) { if ($b -notlike 0) { $int += [math]::Pow(2,$index) } $index -= 1 } $int } ConvertFrom-Bit 10010011 Get-Process pwsh | fl ProcessorAffinity \u043f\u0440\u0438\u0432\u044f\u0437\u043a\u0430 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 \u043a \u044f\u0434\u0440\u0430\u043c, \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 \u0438\u0437 \u0441\u0435\u0431\u044f \u0431\u0438\u0442\u043e\u0432\u0443\u044e \u043c\u0430\u0441\u043a\u0443 (bitmask), \u0433\u0434\u0435 \u043a\u0430\u0436\u0434\u043e\u043c\u0443 \u0431\u0438\u0442\u0443 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u044f\u0434\u0440\u043e \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u0440\u0430. \u0415\u0441\u043b\u0438 \u0434\u043b\u044f \u044f\u0434\u0440\u0430 \u043e\u0442\u043c\u0435\u0447\u0435\u043d\u043e \u0441\u0445\u043e\u0434\u0441\u0442\u0432\u043e (affinity), \u0442\u043e \u0431\u0438\u0442 \u0432\u044b\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0432 1, \u0435\u0441\u043b\u0438 \u043d\u0435\u0442 \u2014 \u0442\u043e \u0432 0. \u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0435\u0441\u043b\u0438 \u0432\u044b\u0431\u0440\u0430\u043d\u044b \u0432\u0441\u0435 16 \u044f\u0434\u0435\u0440, \u0442\u043e \u044d\u0442\u043e 1111 1111 1111 1111 \u0438\u043b\u0438 65535. \\ (Get-Process pwsh).ProcessorAffinity = 15 0000000000001111 \u043f\u0440\u0438\u0441\u0432\u043e\u0438\u0442\u044c 4 \u043f\u0435\u0440\u0432\u044b\u0445 \u044f\u0434\u0440\u0430 \\ (Get-Process pwsh).ProcessorAffinity = 61440 1111000000000000 \u043f\u0440\u0438\u0441\u0432\u043e\u0438\u0442\u044c 4 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0445 \u044f\u0434\u0440\u0430 \\ (Get-Process pwsh).ProcessorAffinity = (ConvertFrom-Bit 1111000000000000)","title":"Bit Convertor"},{"location":"#cycle","text":"","title":"Cycle"},{"location":"#foreach","text":"$list = 100..110 \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043c\u0430\u0441\u0441\u0438\u0432 \u0438\u0437 \u0446\u0438\u0444\u0440 \u043e\u0442 100 \u0434\u043e 110 \\ foreach ($srv in $list) {ping 192.168.3.$srv -n 1 -w 50} $srv \u0445\u0440\u0430\u043d\u0438\u0442 \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 \u0438\u0437 $list \u0438 \u043f\u043e\u0432\u0442\u043e\u0440\u044f\u0435\u0442 \u043a\u043e\u043c\u0430\u043d\u0434\u0443 \u0434\u043e \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430 \u0432 \u043c\u0430\u0441\u0441\u0438\u0432\u0435 \\ $foreach.Current \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 \u0432 \u0446\u0438\u043a\u043b\u0435 \\ $foreach.Reset() \u043e\u0431\u043d\u0443\u043b\u044f\u0435\u0442 \u0438\u0442\u0435\u0440\u0430\u0446\u0438\u044e, \u043f\u0435\u0440\u0435\u0431\u043e\u0440 \u043d\u0430\u0447\u043d\u0435\u0442\u0441\u044f \u0437\u0430\u043d\u043e\u0432\u043e, \u0447\u0442\u043e \u043f\u0440\u0438\u0432\u043e\u0434\u0438\u0442 \u043a \u0431\u0435\u0441\u043a\u043e\u043d\u0435\u0447\u043d\u043e\u043c\u0443 \u0446\u0438\u043a\u043b\u0443 \\ $foreach.MoveNext() \u043f\u0435\u0440\u0435\u0445\u043e\u0434 \u043a \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u043c\u0443 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0443 \u0432 \u0446\u0438\u043a\u043b\u0435","title":"Foreach"},{"location":"#foreach-object","text":"100..110 | %{ping -n 1 -w 50 192.168.3.$_ > $null if ($LastExitCode -eq 0) {Write-Host \"192.168.3.$_\" -ForegroundColor green } else { Write-Host \"192.168.3.$_\"-ForegroundColor Red}} % # \u043f\u0435\u0440\u0435\u0434\u0430\u0442\u044c \u0446\u0438\u043a\u043b \u0447\u0435\u0440\u0435\u0437 \u043a\u043e\u043d\u0432\u0435\u0435\u0440 (ForEach-Object) $_ # \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0430\u044f \u0446\u0438\u043a\u043b\u0430 \u0438 \u043a\u043e\u043d\u0432\u0435\u0435\u0440\u0430 ($PSItem) gwmi Win32_QuickFixEngineering | where {$_.InstalledOn.ToString() -match \"2022\"} | %{($_.HotFixID.Substring(2))} # gwmi \u0441\u043e\u0437\u0434\u0430\u0435\u0442 \u043c\u0430\u0441\u0441\u0438\u0432, \u0432\u044b\u0432\u043e\u0434 \u043a\u043e\u043c\u0430\u043d\u0434\u044b \u043f\u0435\u0440\u0435\u0434\u0430\u0435\u0442\u0441\u044f where \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430 \u043f\u043e\u0434\u0445\u043e\u0434\u044f\u0449\u0438\u0445 \u043f\u043e\u0434 \u043a\u0440\u0438\u0442\u0435\u0440\u0438\u0438 \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432. \u041f\u043e \u043a\u043e\u043d\u0432\u0435\u0435\u0440\u0443 \u043f\u0435\u0440\u0435\u0434\u0430\u0435\u0442\u0441\u044f \u0432 \u0446\u0438\u043a\u043b \u0434\u043b\u044f \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u044f \u043f\u0435\u0440\u0432\u044b\u0445 (2) \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432 \u043c\u0435\u0442\u043e\u0434\u043e\u043c Substring \u0438\u0437 \u0432\u0441\u0435\u0445 \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 HotFixID.","title":"ForEach-Object (%)"},{"location":"#while","text":"$srv = \"yandex.ru\" $out2 = \"\u0415\u0441\u0442\u044c \u043f\u0438\u043d\u0433\" $out3 = \"\u041d\u0435\u0442 \u043f\u0438\u043d\u0433\u0430\" $out = $false # \u043f\u0440\u0435\u0434\u0432\u0430\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0441\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0443\u044e, While \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u0443\u0441\u043b\u043e\u0432\u0438\u0435 \u0434\u043e \u0437\u0430\u043f\u0443\u0441\u043a\u0430 \u0446\u0438\u043a\u043b\u0430 While ($out -eq $false){ # \u043f\u043e\u043a\u0430 \u0443\u0441\u043b\u043e\u0432\u0438\u0435 \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f $true, \u0446\u0438\u043a\u043b \u0431\u0443\u0434\u0435\u0442 \u043f\u043e\u0432\u0442\u043e\u0440\u044f\u0442\u044c\u0441\u044f $out = ping -n 1 -w 50 $srv if ($out -match \"ttl\") {$out = $true; $out2} else {$out = $false; $out3; sleep 1} } while ($True){ # \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0431\u0435\u0441\u043a\u043e\u043d\u0435\u0447\u043d\u044b\u0439 \u0446\u0438\u043a\u043b $result = ping yandex.ru -n 1 -w 50 if ($result -match \"TTL\"){ # \u0443\u0441\u043b\u043e\u0432\u0438\u0435, \u043f\u0440\u0438 \u043a\u043e\u0442\u043e\u0440\u043e\u043c \u0431\u0443\u0434\u0435\u0442 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d break Write-Host \"\u0421\u0430\u0439\u0442 \u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d\" break # \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442 \u0446\u0438\u043a\u043b } else {Write-Host \"\u0421\u0430\u0439\u0442 \u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d\"; sleep 1} }","title":"While"},{"location":"#try-catch-finally","text":"Try {$out = pping 192.168.3.1} Catch {Write-Warning \"$($error[0])\"} # \u0432\u044b\u0432\u043e\u0434\u0438\u0442 \u0432 \u0441\u043b\u0443\u0447\u0430\u0435 \u043e\u0448\u0438\u0431\u043a\u0438 (\u0432\u043c\u0435\u0441\u0442\u043e \u043e\u0448\u0438\u0431\u043a\u0438) finally {$out = \"End\"} # \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \u0432 \u043a\u043e\u043d\u0446\u0435 \u0432 \u043b\u044e\u0431\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435","title":"Try-Catch-Finally"},{"location":"#files","text":"$file = [System.IO.File]::Create(\"$home\\desktop\\test.txt\") \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0444\u0430\u0439\u043b \\ $file.Close() \u0437\u0430\u043a\u0440\u044b\u0442\u044c \u0444\u0430\u0439\u043b \\ [System.IO.File]::ReadAllLines(\"$home\\desktop\\test.txt\") \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u0442\u044c \u0444\u0430\u0439\u043b \\ $file = New-Object System.IO.StreamReader(\"$home\\desktop\\test.txt\") \u0444\u0430\u0439\u043b \u0431\u0443\u0434\u0435\u0442 \u0437\u0430\u043d\u044f\u0442 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u043c PowerShell \\ $file | gm \\ $file.ReadLine() \u043f\u043e\u0441\u0442\u0440\u043e\u0447\u043d\u044b\u0439 \u0432\u044b\u0432\u043e\u0434 \\ $file.ReadToEnd() \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u0442\u044c \u0444\u0430\u0439\u043b \u0446\u0435\u043b\u0438\u043a\u043e\u043c","title":"Files"},{"location":"#readwrite-bytes","text":"$file = [io.file]::ReadAllBytes(\"$home\\desktop\\powershell.jpg\") \u043c\u0435\u0442\u043e\u0434 \u043e\u0442\u043a\u0440\u044b\u0432\u0430\u0435\u0442 \u0434\u0432\u043e\u0438\u0447\u043d\u044b\u0439 \u0444\u0430\u0439\u043b, \u0441\u0447\u0438\u0442\u044b\u0432\u0430\u0435\u0442 \u0435\u0433\u043e \u0432 \u043c\u0430\u0441\u0441\u0438\u0432 \u0431\u0430\u0439\u0442 \u0438 \u0437\u0430\u043a\u0440\u044b\u0432\u0430\u0435\u0442 \u0444\u0430\u0439\u043b \\ [io.file]::WriteAllBytes(\"$home\\desktop\\tloztotk-2.jpg\",$file) \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0431\u0430\u0439\u0442\u044b \u0432 \u0444\u0430\u0439\u043b (\u043c\u043e\u0436\u043d\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0434\u043b\u044f \u0432\u044b\u0433\u0440\u0443\u0437\u043a\u0438 \u0434\u0432\u043e\u0438\u0447\u043d\u044b\u0445 \u0444\u0430\u0439\u043b\u043e\u0432 \u0438\u0437 \u0411\u0414) Get-Content $home/desktop\\test.txt -Wait \u0430\u043d\u0430\u043b\u043e\u0433 tail \\ Test-Path $path \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u043e\u0441\u0442\u044c \u043f\u0443\u0442\u0438 \\ Get-ChildItem $path -Filter *.txt -Recurse \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0430 (Alias: ls/gci/dir) \u0438 \u0434\u043e\u0447\u0435\u0440\u043d\u0438\u0445 \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u043e\u0432 (-Recurse) \u0438 \u043e\u0442\u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u044b\u0432\u043e\u0434 \\ Get-Location \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0442\u0435\u043a\u0443\u0449\u0438\u0435 \u043c\u0435\u0441\u0442\u043e\u0440\u0430\u0441\u043f\u043e\u043b\u043e\u0436\u0435\u043d\u0438\u0435 (Alias: pwd/gl) \\ Set-Location $path \u043f\u0435\u0440\u0435\u043c\u0435\u0449\u0435\u043d\u0438\u0435 \u043f\u043e \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0430\u043c (Alias: cd/sl) \\ Invoke-Item $path \u043e\u0442\u043a\u0440\u044b\u0442\u044c \u0444\u0430\u0439\u043b (Alias: ii/start) \\ Get-ItemProperty $env:userprofile\\Documents\\dns-list.txt | select FullName,Directory,Name,BaseName,Extension \u0441\u0432\u043e\u0439\u0442\u0441\u0432\u0430 \u0444\u0430\u0439\u043b\u0430 \\ Get-ItemProperty -Path $path\\* | select FullName,CreationTime,LastWriteTime \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430 \u0444\u0430\u0439\u043b\u043e\u0432 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0433\u043e \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u0438, \u0434\u0430\u0442\u0430 \u0438\u0445 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f \u0438 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \\ New-Item -Path \"C:\\test\\\" -ItemType \"Directory\" \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u044e (Alias: mkdir/md) \\ New-Item -Path \"C:\\test\\file.txt\" -ItemType \"File\" -Value \"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0442\u0435\u043a\u0441\u0442 \u0432 \u0444\u0430\u0439\u043b\" \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0444\u0430\u0439\u043b \\ \"test\" > \"C:\\test\\file.txt\" \u0437\u0430\u043c\u0435\u043d\u0438\u0442\u044c \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \\ \"test\" >> \"C:\\test\\file.txt\" \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0441\u0442\u0440\u043e\u043a\u0443 \u0432 \u0444\u0430\u0439\u043b \\ New-Item -Path \"C:\\test\\test\\file.txt\" -Force \u043a\u043b\u044e\u0447 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0434\u043b\u044f \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0445 \u0432 \u043f\u0443\u0442\u0438 \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u0439 \u0438\u043b\u0438 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0438\u0441\u0438 \u0444\u0430\u0439\u043b\u0430 \u0435\u0441\u043b\u0438 \u043e\u043d \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \\ Move-Item \u043f\u0435\u0440\u0435\u043c\u0435\u0449\u0435\u043d\u0438\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 (Alias: mv/move) \\ Remove-Item \"$path\\\" -Recurse \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0432\u0441\u0435\u0445 \u0444\u0430\u0439\u043b\u043e\u0432 \u0432\u043d\u0443\u0442\u0440\u0438 \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0430, \u0431\u0435\u0437 \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u043f\u043e\u0434\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u044f (Alias: rm/del) \\ Remove-Item $path -Recurse -Include \"*.txt\",\"*.temp\" -Exclude \"log.txt\" \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u0441\u0435 \u0444\u0430\u0439\u043b\u044b \u0441 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u0435\u043c txt \u0438 temp ([Array]), \u043a\u0440\u043e\u043c\u0435 log.txt \\ Rename-Item \"C:\\test\\*.*\" \"*.jpg\" \u043f\u0435\u0440\u0435\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u0442\u044c \u0444\u0430\u0439\u043b\u044b \u043f\u043e \u043c\u0430\u0441\u043a\u0435 (Alias: ren) \\ Copy-Item \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0444\u0430\u0439\u043b\u043e\u0432 \u0438 \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u043e\u0432 (Alias: cp/copy) \\ Copy-Item -Path \"\\\\server-01\\test\" -Destination \"C:\\\" -Recurse \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u044e \u0441 \u0435\u0435 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u044b\u043c (-Recurse) \\ Copy-Item -Path \"C:\\*.txt\" -Destination \"C:\\test\\\" \u0437\u043d\u0430\u043a '\\' \u0432 \u043a\u043e\u043d\u0446\u0435 Destination \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0434\u043b\u044f \u043f\u0435\u0440\u0435\u043d\u043e\u0441\u0430 \u043f\u0430\u043f\u043a\u0438 \u0432\u043d\u0443\u0442\u0440\u044c \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0439, \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0438\u0435, \u0447\u0442\u043e \u044d\u0442\u043e \u043d\u043e\u0432\u043e\u0435 \u0438\u043c\u044f \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u0438 \\ Copy-Item -Path \"C:\\*\" -Destination \"C:\\test\\\" -Include '*.txt','*.jpg' \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u0441 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u043c \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u0435\u043c (Include) \\ Copy-Item -Path \"C:\\*\" -Destination \"C:\\test\\\" -Exclude '*.jpeg' \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043e\u0431\u044a\u0435\u043a\u0442\u044b, \u0437\u0430 \u0438\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435\u043c \u0444\u0430\u0439\u043b\u043e\u0432 \u0441 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u0435\u043c (Exclude) \\ $log = Copy-Item \"C:\\*.txt\" \"C:\\test\\\" -PassThru \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f (\u043b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435) \u0432 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0443\u044e, \u043c\u043e\u0436\u043d\u043e \u0437\u0430\u0431\u0438\u0440\u0430\u0442\u044c \u0441\u0442\u0440\u043e\u043a\u0438 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0438\u043d\u0434\u0435\u043a\u0441\u043e\u0432 $log[0].FullName","title":"Read/Write Bytes"},{"location":"#clear-env-temp-14-days","text":"$ls = Get-Item $env:TEMP\\*.tmp # \u0441\u0447\u0438\u0442\u0430\u0442\u044c \u0432\u0441\u0435 \u0444\u0430\u0439\u043b\u044b \u0441 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u043c \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u0435\u043c $date = (Get-Date).AddDays(-14) foreach ($l in $ls) { if ($l.LastWriteTime -le $date) { $l.FullName Remove-Item $l.FullName -Recurse } }","title":"Clear-env-Temp-14-days"},{"location":"#filehash","text":"Get-Filehash -Algorithm SHA256 \"$env:USERPROFILE\\Documents\\RSA.conf.txt\"","title":"Filehash"},{"location":"#microsoftpowershellarchive","text":"Compress-Archive -Path $sourcepath -DestinationPath $dstpath -CompressionLevel Optimal \u0430\u0440\u0445\u0438\u0432\u0438\u0440\u043e\u0432\u0430\u0442\u044c \\ Expand-Archive .\\powerlinefonts.zip \u0440\u0430\u0437\u0430\u0440\u0445\u0438\u0432\u0438\u0440\u043e\u0432\u0430\u0442\u044c","title":"Microsoft.PowerShell.Archive"},{"location":"#credential","text":"$Cred = Get-Credential \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u0442 \u043a\u0440\u0435\u0434\u044b \u0432 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 $Cred.Username \u0438 $Cred.Password \\ $Cred.GetNetworkCredential().password \u0438\u0437\u0432\u043b\u0435\u0447\u044c \u043f\u0430\u0440\u043e\u043b\u044c \\ cmdkey /generic:\"TERMSRV/$srv\" /user:\"$username\" /pass:\"$password\" \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u0435 \u043a\u0440\u0435\u0434\u044b \u0430\u0443\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438 \u043d\u0430 \u043d\u0430 \u0442\u0435\u0440\u043c\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u0439 \u0441\u0435\u0440\u0432\u0435\u0440 \u0434\u043b\u044f \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u0431\u0435\u0437 \u043f\u0430\u0440\u043e\u043b\u044f \\ mstsc /admin /v:$srv \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f \\ cmdkey /delete:\"TERMSRV/$srv\" \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u043d\u044b\u0435 \u043a\u0440\u0435\u0434\u044b \u0430\u0443\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438 \u0438\u0437 \u0441\u0438\u0441\u0442\u0435\u043c\u044b \\ rundll32.exe keymgr.dll,KRShowKeyMgr \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435 Stored User Names and Password \\ Get-Service VaultSvc \u0441\u043b\u0443\u0436\u0431\u0430 \u0434\u043b\u044f \u0440\u0430\u0431\u043e\u0442\u044b Credential Manager \\ Install-Module CredentialManager \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043c\u043e\u0434\u0443\u043b\u044c \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u044f Credential Manager \u043a \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0443 PasswordVault \u0438\u0437 PowerShell \\ [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.SecurityProtocolType]'Tls11,Tls12' \u0434\u043b\u044f \u0443\u0441\u0442\u0430\u043d\u043e\u043a\u0438 \u043c\u043e\u0434\u0443\u043b\u044f \\ Get-StoredCredential \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0443\u0447\u0435\u0442\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0438\u0437 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0430 Windows Vault \\ Get-StrongPassword \u0433\u0435\u043d\u0435\u0440\u0430\u0442\u043e\u0440 \u043f\u0430\u0440\u043e\u043b\u044f \\ New-StoredCredential -UserName test -Password \"123456\" \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0443\u0447\u0435\u0442\u043d\u0443\u044e \u0437\u0430\u043f\u0438\u0441\u044c \\ Remove-StoredCredential \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0443\u0447\u0435\u0442\u043d\u0443\u044e \u0437\u0430\u043f\u0438\u0441\u044c \\ $Cred = Get-StoredCredential | where {$_.username -match \"admin\"} \\ $pass = $cred.password \\ $BSTR = [System.Runtime.InteropServices.Marshal]::SecureStringToBSTR($pass) \\ [System.Runtime.InteropServices.Marshal]::PtrToStringAuto($BSTR)","title":"Credential"},{"location":"#out-gridview","text":"Get-Service -cn $srv | Out-GridView -Title \"Service $srv\" -OutputMode Single \u2013PassThru | Restart-Service \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u0443\u044e \u0441\u043b\u0443\u0436\u0431\u0443","title":"Out-Gridview"},{"location":"#out-file","text":"Read-Host \u2013AsSecureString | ConvertFrom-SecureString | Out-File \"$env:userprofile\\desktop\\password.txt\" \u043f\u0438\u0441\u0430\u0442\u044c \u0432 \u0444\u0430\u0439\u043b. \u041f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \u0432 \u0444\u043e\u0440\u043c\u0430\u0442 SecureString \u0441 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435\u043c \u0448\u0438\u0444\u0440\u043e\u0432\u0430\u043d\u0438\u044f Windows Data Protection API (DPAPI)","title":"Out-File"},{"location":"#get-content-gccattype","text":"$password = gc \"$env:userprofile\\desktop\\password.txt\" | ConvertTo-SecureString \u0447\u0438\u0442\u0430\u0442\u044c \u0445\u044d\u0448 \u043f\u0430\u0440\u043e\u043b\u044f \u0438\u0437 \u0444\u0430\u0439\u043b\u0430 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u043a\u043b\u044e\u0447\u0435\u0439, \u0445\u0440\u0430\u043d\u044f\u0449\u0438\u0445\u0441\u044f \u0432 \u043f\u0440\u043e\u0444\u0438\u043b\u0435 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u0442\u044c \u043d\u0430 \u0434\u0440\u0443\u0433\u043e\u043c \u043a\u043e\u043f\u044c\u044e\u0442\u0435\u0440\u0435","title":"Get-Content (gc/cat/type)"},{"location":"#aes-key","text":"$AESKey = New-Object Byte[] 32 \\ [Security.Cryptography.RNGCryptoServiceProvider]::Create().GetBytes($AESKey) \\ $AESKey | Out-File \"C:\\password.key\" \\ $Cred.Password | ConvertFrom-SecureString -Key (Get-Content \"C:\\password.key\") | Set-Content \"C:\\password.txt\" \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \u0432 \u0444\u0430\u0439\u043b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044f \u0432\u043d\u0435\u0448\u043d\u0438\u0439 \u043a\u043b\u044e\u0447 \\ $pass = Get-Content \"C:\\password.txt\" | ConvertTo-SecureString -Key (Get-Content \"\\\\Server\\Share\\password.key\") \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \u043d\u0430 \u0432\u0442\u043e\u0440\u043e\u043c \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0435","title":"AES Key"},{"location":"#winevent","text":"Get-WinEvent -ListLog * \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u0436\u0443\u0440\u043d\u0430\u043b\u044b \u043b\u043e\u0433\u043e\u0432 \\ Get-WinEvent -ListLog * | where RecordCount -ne 0 | where RecordCount -ne $null | sort -Descending RecordCount \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043d\u0435 \u043f\u0443\u0441\u0442\u044b\u0435 \u0436\u0443\u0440\u043d\u0430\u043b\u044b \u0441 \u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u043e\u0439 \u043f\u043e \u043a\u043e\u043b-\u0432\u0443 \u0437\u0430\u043f\u0438\u0441\u0435\u0439 \\ Get-WinEvent -ListProvider * | ft \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435\u0445 \u043f\u0440\u043e\u0432\u0430\u0439\u0434\u0435\u0440\u043e\u0432 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0439 \\ Get-WinEvent -ListProvider GroupPolicy \u043d\u0430\u0439\u0442\u0438 \u0432 \u043a\u0430\u043a\u043e\u0439 \u0436\u0443\u0440\u043d\u0430\u043b LogLinks {Application} \u043f\u0438\u0448\u0443\u0442\u0441\u044f \u043b\u043e\u0433\u0438 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f \\ Get-WinEvent -ListProvider *smb* \\ Get-WinEvent -ListLog * | where logname -match SMB | sort -Descending RecordCount \u043d\u0430\u0439\u0442\u0438 \u0432\u0441\u0435 \u0436\u0443\u0440\u043d\u0430\u043b\u044b \u043f\u043e \u0438\u043c\u0435\u043d\u0438 \\ Get-WinEvent -LogName \"Microsoft-Windows-SmbClient/Connectivity\" \\ Get-WinEvent -ListProvider *firewall*","title":"WinEvent"},{"location":"#filter-xpathhashtable","text":"Get-WinEvent -FilterHashtable @{LogName=\"Security\";ID=4624} \u043d\u0430\u0439\u0442\u0438 \u043b\u043e\u0433\u0438 \u043f\u043e ID \u0432 \u0436\u0443\u0440\u043d\u0430\u043b\u0435 Security \\ Get-WinEvent -FilterHashtable @{LogName=\"System\";Level=2} \u043d\u0430\u0439\u0442\u0438 \u0432\u0441\u0435 \u0437\u0430\u043f\u0438\u0441\u0438 \u043e\u0448\u0438\u0431\u043a\u0438 (1 - \u043a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439, 3 - \u043f\u0440\u0435\u0434\u0443\u043f\u0440\u0435\u0436\u0434\u0435\u043d\u0438\u0435, 4 - \u0441\u0432\u0435\u0434\u0435\u043d\u0438\u044f) \\ Get-WinEvent -FilterHashtable @{LogName=\"System\";Level=2;ProviderName=\"Service Control Manager\"} \u043e\u0442\u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u043e \u0438\u043c\u0435\u043d\u0438 \u043f\u0440\u043e\u0432\u0430\u0439\u0434\u0435\u0440\u0430 ([xml](Get-WinEvent -FilterHashtable @{LogName=\"Security\";ID=4688} -MaxEvents 1).ToXml()).Event.EventData.Data \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430, \u0445\u0440\u0430\u043d\u0438\u043c\u044b\u0435 \u0432 EventData (Message) \\ Get-WinEvent -FilterHashtable @{logname=\"security\";ID=4688} -MaxEvents 1 | select timecreated,{$_.Properties[5].value} \u043e\u0442\u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u0440\u0435\u043c\u044f \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u0438 \u0438\u043c\u044f \u0437\u0430\u043f\u0443\u0449\u0435\u043d\u043d\u043e\u0433\u043e \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 $query = ' <QueryList> <Query Id=\"0\" Path=\"Security\"> <Select Path=\"Security\"> *[System[EventID=4688]] and *[EventData[Data[@Name=\"NewProcessName\"]=\"C:\\Windows\\System32\\autochk.exe\" or Data[@Name=\"NewProcessName\"]=\"C:\\Windows\\System32\\services.exe\"]] </Select> </Query> </QueryList> ' Get-WinEvent -LogName Security -FilterXPath $query","title":"Filter XPath/Hashtable"},{"location":"#reboot","text":"$query = ' <QueryList> <Query Id=\"0\" Path=\"System\"> <Select Path=\"System\"> *[ System[ EventID=41 or EventID=1074 or EventID=1076 or EventID=6005 or EventID=6006 or EventID=6008 or EventID=6009 or EventID=6013 ] ] </Select> </Query> </QueryList> ' Get-WinEvent -LogName System -FilterXPath $query 41 ` \u0421\u0438\u0441\u0442\u0435\u043c\u0430 \u0431\u044b\u043b\u0430 \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d\u0430 \u0431\u0435\u0437 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e\u0433\u043e \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044f \u0440\u0430\u0431\u043e\u0442\u044b. 1074` \u0421\u0438\u0441\u0442\u0435\u043c\u0430 \u0431\u044b\u043b\u0430 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e\u0433\u043e \u0432\u044b\u043a\u043b\u044e\u0447\u0435\u043d\u0430 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u043c \u0438\u043b\u0438 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u043c. 1076` \u0421\u043b\u0435\u0434\u0443\u0435\u0442 \u0437\u0430 Event ID 6008 \u0438 \u043e\u0437\u043d\u0430\u0447\u0430\u0435\u0442, \u0447\u0442\u043e \u043f\u0435\u0440\u0432\u044b\u0439 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c (\u0441 \u043f\u0440\u0430\u0432\u043e\u043c \u0432\u044b\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u0441\u0438\u0441\u0442\u0435\u043c\u044b) \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0432\u0448\u0438\u0439\u0441\u044f \u043a \u0441\u0435\u0440\u0432\u0435\u0440\u0443 \u043f\u043e\u0441\u043b\u0435 \u043d\u0435\u043e\u0436\u0438\u0434\u0430\u043d\u043d\u043e\u0439 \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0438\u043b\u0438 \u0432\u044b\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f, \u0443\u043a\u0430\u0437\u0430\u043b \u043f\u0440\u0438\u0447\u0438\u043d\u0443 \u044d\u0442\u043e\u0433\u043e \u0441\u043e\u0431\u044b\u0442\u0438\u044f. 6005` \u0417\u0430\u043f\u0443\u0441\u043a \"\u0416\u0443\u0440\u043d\u0430\u043b\u0430 \u0441\u043e\u0431\u044b\u0442\u0438\u0439 Windows\" (Event Log). \u0423\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442 \u043d\u0430 \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u0441\u0438\u0441\u0442\u0435\u043c\u044b. 6006` \u041e\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 \u00ab\u0416\u0443\u0440\u043d\u0430\u043b\u0430 \u0441\u043e\u0431\u044b\u0442\u0438\u0439 Windows\u00bb. \u0423\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442 \u043d\u0430 \u0432\u044b\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u0441\u0438\u0441\u0442\u0435\u043c\u044b. 6008` \u041f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0435\u0435 \u0432\u044b\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u0441\u0438\u0441\u0442\u0435\u043c\u044b \u0431\u044b\u043b\u043e \u043d\u0435\u043e\u0436\u0438\u0434\u0430\u043d\u043d\u044b\u043c. 6009` \u0412\u0435\u0440\u0441\u0438\u044f \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u043e\u0439 \u0441\u0438\u0441\u0442\u0435\u043c\u044b, \u0437\u0430\u0444\u0438\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u0430\u044f \u043f\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0435 \u0441\u0438\u0441\u0442\u0435\u043c\u044b. 6013` \u0412\u0440\u0435\u043c\u044f \u0440\u0430\u0431\u043e\u0442\u044b \u0441\u0438\u0441\u0442\u0435\u043c\u044b (system uptime) \u0432 \u0441\u0435\u043a\u0443\u043d\u0434\u0430\u0445.","title":"Reboot"},{"location":"#logon","text":"$srv = \"localhost\" $FilterXPath = '<QueryList><Query Id=\"0\"><Select>*[System[EventID=21]]</Select></Query></QueryList>' $RDPAuths = Get-WinEvent -ComputerName $srv -LogName \"Microsoft-Windows-TerminalServices-LocalSessionManager/Operational\" -FilterXPath $FilterXPath [xml[]]$xml = $RDPAuths | Foreach {$_.ToXml()} $EventData = Foreach ($event in $xml.Event) { New-Object PSObject -Property @{ \"Connection Time\" = (Get-Date ($event.System.TimeCreated.SystemTime) -Format 'yyyy-MM-dd hh:mm K') \"User Name\" = $event.UserData.EventXML.User \"User ID\" = $event.UserData.EventXML.SessionID \"User Address\" = $event.UserData.EventXML.Address \"Event ID\" = $event.System.EventID }} $EventData | ft","title":"Logon"},{"location":"#eventlog","text":"Get-EventLog -List \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u043a\u043e\u0440\u043d\u0435\u0432\u044b\u0435 \u0436\u0443\u0440\u043d\u0430\u043b\u044b \u043b\u043e\u0433\u043e\u0432 \u0438 \u0438\u0445 \u0440\u0430\u0437\u043c\u0435\u0440 \\ Clear-EventLog Application \u043e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u043b\u043e\u0433\u0438 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0433\u043e \u0436\u0443\u0440\u043d\u0430\u043b\u0430 \\ Get-EventLog -LogName Security -InstanceId 4624 \u043d\u0430\u0439\u0442\u0438 \u043b\u043e\u0433\u0438 \u043f\u043e ID \u0432 \u0436\u0443\u0440\u043d\u0430\u043b\u0435 Security","title":"EventLog"},{"location":"#firewall","text":"$days = 5 $obj = @() $fw = Get-WinEvent \"Microsoft-Windows-Windows Firewall With Advanced Security/Firewall\" foreach ($temp_fw in $fw) { if ($temp_fw.id -eq 2097) { # 2004 $type = \"Added Rule\" } elseif ($temp_fw.id -eq 2006) { $type = \"Deleted Rule\" } $port = $temp_fw.Properties[7] | select -ExpandProperty value $name = $temp_fw.Properties[1] | select -ExpandProperty value $obj += [PSCustomObject]@{ Time = $temp_fw.TimeCreated; Type = $type; Port = $port; Name = $name} } $obj | Where-Object time -gt (Get-Date).AddDays(-$days) New-NetFirewallRule -Profile Any -DisplayName \"Open Port 135 RPC\" -Direction Inbound -Protocol TCP -LocalPort 135 \u043e\u0442\u043a\u0440\u044b\u0442\u044c in-\u043f\u043e\u0440\u0442 \\ Get-NetFirewallRule | where DisplayName -match kms | select * \u043d\u0430\u0439\u0442\u0438 \u043f\u0440\u0430\u0432\u0438\u043b\u043e \u043f\u043e \u0438\u043c\u0435\u043d\u0438 \\ Get-NetFirewallPortFilter | where LocalPort -like 80 \u043d\u0430\u0439\u0442\u0438 \u0434\u0435\u0439\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u043f\u0440\u0430\u0432\u0438\u043b\u043e \u043f\u043e \u043d\u043e\u043c\u0435\u0440\u0443 \u043f\u043e\u0440\u0442\u0430 Get-NetFirewallRule -Enabled True -Direction Inbound | select -Property DisplayName, @{Name='Protocol';Expression={($_ | Get-NetFirewallPortFilter).Protocol}}, @{Name='LocalPort';Expression={($_ | Get-NetFirewallPortFilter).LocalPort}}, @{Name='RemotePort';Expression={($_ | Get-NetFirewallPortFilter).RemotePort}}, @{Name='RemoteAddress';Expression={($_ | Get-NetFirewallAddressFilter).RemoteAddress}}, Enabled,Profile","title":"Firewall"},{"location":"#firewall-manager","text":"Install-Module Firewall-Manager \\ Export-FirewallRules -Name * -CSVFile $home\\documents\\fw.csv -Inbound -Outbound -Enabled -Disabled -Allow -Block (\u0444\u0438\u043b\u044c\u0442\u0440 \u043f\u0440\u0430\u0432\u0438\u043b \u0434\u043b\u044f \u044d\u043a\u0441\u043f\u043e\u0440\u0442\u0430) \\ Import-FirewallRules -CSVFile $home\\documents\\fw.csv","title":"Firewall-Manager"},{"location":"#defender","text":"Import-Module Defender \\ Get-Command -Module Defender \\ Get-MpComputerStatus \\ (Get-MpComputerStatus).AntivirusEnabled \u0441\u0442\u0430\u0442\u0443\u0441 \u0440\u0430\u0431\u043e\u0442\u044b \u0430\u043d\u0442\u0438\u0432\u0438\u0440\u0443\u0441\u0430 $session = NewCimSession -ComputerName hostname \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f \u043a \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u043e\u043c\u0443 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0443, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f WinRM \\ Get-MpComputerStatus -CimSession $session | fl fullscan* \u0443\u0437\u043d\u0430\u0442\u044c \u0434\u0430\u0442\u0443 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u043d\u0430 \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u043e\u043c \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0435 Get-MpPreference \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \\ (Get-MpPreference).ScanPurgeItemsAfterDelay \u0432\u0440\u0435\u043c\u044f \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0437\u0430\u043f\u0438\u0441\u0435\u0439 \u0436\u0443\u0440\u043d\u0430\u043b\u0430 \u0437\u0430\u0449\u0438\u0442\u043d\u0438\u043a\u0430 \u0432 \u0434\u043d\u044f\u0445 \\ Set-MpPreference -ScanPurgeItemsAfterDelay 30 \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0432\u0440\u0435\u043c\u044f \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \\ ls \"C:\\ProgramData\\Microsoft\\Windows Defender\\Scans\\History\" \\ Get-MpPreference | select disable* \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u0442\u0430\u0442\u0443\u0441 \u0432\u0441\u0435\u0445 \u0432\u0438\u0434\u043e\u0432 \u043f\u0440\u043e\u0432\u0435\u0440\u043e\u043a/\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0439 \\ Set-MpPreference -DisableRealtimeMonitoring $true \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0437\u0430\u0449\u0438\u0442\u0443 Defender \u0432 \u0440\u0435\u0430\u043b\u044c\u043d\u043e\u043c \u0432\u0440\u0435\u043c\u0435\u043d\u0438 (\u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0440\u0443\u0447\u043d\u043e\u0435 \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435) \\ Set-MpPreference -DisableRemovableDriveScanning $false \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 USB \u043d\u0430\u043a\u043e\u043f\u0438\u0442\u0435\u043b\u0435\u0439 \\ Get-MpPreference | select excl* \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u0438\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0439 \\ (Get-MpPreference).ExclusionPath \\ Add-MpPreference -ExclusionPath C:\\install \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u044e \u0432 \u0438\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \\ Remove-MpPreference -ExclusionPath C:\\install \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0438\u0437 \u0438\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \\ New-ItemProperty -Path \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\" -Name DisableAntiSpyware -Value 1 -PropertyType DWORD -Force \u043f\u043e\u043b\u043d\u043e\u0441\u0442\u044c\u044e \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c Windows Defender Set-MpPreference -SignatureDefinitionUpdateFileSharesSources \\\\FileShare1\\Updates \u0434\u043b\u044f \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0438\u0437 \u0441\u0435\u0442\u0435\u0432\u043e\u0439 \u043f\u0430\u043f\u043a\u0438 \u043d\u0443\u0436\u043d\u043e \u043f\u0440\u0435\u0434\u0432\u0430\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0441\u043a\u0430\u0447\u0430\u0442\u044c \u0444\u0430\u0439\u043b\u044b \u0441 \u0441\u0438\u0433\u043d\u0430\u0442\u0443\u0440\u0430\u043c\u0438 \u0431\u0430\u0437 \u0441 \u0441\u0430\u0439\u0442\u0430 https://www.microsoft.com/security/portal/definitions/adl.aspx \u0438 \u043f\u043e\u043c\u0435\u0441\u0442\u0438\u0442\u044c \u0432 \u0441\u0435\u0442\u0435\u0432\u043e\u0439 \u043a\u0430\u0442\u0430\u043b\u043e\u0433 Update-MpSignature -UpdateSource FileShares \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0439 (MicrosoftUpdateServer \u2013 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0439 MS \u0432 \u0438\u043d\u0442\u0435\u0440\u043d\u0435\u0442\u0435, InternalDefinitionUpdateServer \u2014 \u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u0438\u0439 WSUS \u0441\u0435\u0440\u0432\u0435\u0440) \\ Update-MpSignature \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0441\u0438\u0433\u043d\u0430\u0442\u0443\u0440\u044b Start-MpScan -ScanType QuickScan \u0431\u044b\u0441\u0442\u0440\u0430\u044f \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0438\u043b\u0438 FullScan \\ Start-MpScan -ScanType FullScan -AsJob \\ Set-MpPreference -RemediationScheduleDay 1-7 \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0434\u043d\u0438, \u043d\u0430\u0447\u0438\u043d\u0430\u044f \u0441 \u0432\u043e\u0441\u043a\u0440\u0435\u0441\u0435\u043d\u044c\u044f \u0438\u043b\u0438 0 \u043a\u0430\u0436\u0434\u044b\u0439 \u0434\u0435\u043d\u044c, 8 - \u0441\u0431\u0440\u043e\u0441\u0438\u0442\u044c \\ Set-MpPreference -ScanScheduleQuickScanTime 14:00:00 \\ Start-MpScan -ScanType CustomScan -ScanPath \"C:\\Program Files\" \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u0443\u044e \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u044e Get-MpThreat \u0438\u0441\u0442\u043e\u0440\u0438\u044f \u0443\u0433\u0440\u043e\u0437 \u0438 \u0442\u0438\u043f \u0443\u0433\u0440\u043e\u0437\u044b (ThreatName: HackTool/Trojan) \\ Get-MpThreatCatalog \u0441\u043f\u0438\u0441\u043e\u043a \u0438\u0437\u0432\u0435\u0441\u0442\u043d\u044b\u0445 \u0432\u0438\u0434\u043e\u0432 \u0443\u0433\u0440\u043e\u0437 \\ Get-MpThreatDetection \u0438\u0441\u0442\u043e\u0440\u0438\u044f \u0437\u0430\u0449\u0438\u0442\u044b (\u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0445 \u0438 \u043f\u0440\u043e\u0448\u043b\u044b\u0435) \u0438 ID \u0443\u0433\u0440\u043e\u0437\u044b \\ Get-MpThreat -ThreatID 2147760253 ls \"C:\\ProgramData\\Microsoft\\Windows Defender\\Quarantine\\\" \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u044f \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0444\u0430\u0439\u043b\u043e\u0432 \u0432 \u043a\u0430\u0440\u0430\u043d\u0442\u0438\u043d\u0435 \\ cd \"C:\\Program Files\\Windows Defender\\\" \\ .\\MpCmdRun.exe -restore -name $ThreatName \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0444\u0430\u0439\u043b \u0438\u0437 \u043a\u0430\u0440\u0430\u043d\u0442\u0438\u043d\u0430 \\ .\\MpCmdRun.exe -restore -filepath $path_file","title":"Defender"},{"location":"#windowsupdate","text":"Get-Hotfix | Sort-Object -Descending InstalledOn \u0441\u043f\u0438\u0441\u043e\u043a \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044b\u0445 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0439 (\u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u0438\u0437 cimv2) \\ Get-Hotfix -Description \"Security update\" \\ Get-CimInstance Win32_QuickFixEngineering \\ Get-Command -Module WindowsUpdate \\ Get-WindowsUpdateLog \\ Get-Service uhssvc \u0441\u043b\u0443\u0436\u0431\u0430 Microsoft Health Update Tools, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442 \u0437\u0430 \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0439 Install-Module -Name PSWindowsUpdate -Scope CurrentUser \\ Import-Module PSWindowsUpdate \\ Get-Command -Module PSWindowsUpdate \\ Get-WindowsUpdate \u0441\u043f\u0438\u0441\u043e\u043a \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0439 \u0434\u043b\u044f \u0441\u043a\u0430\u0447\u0430\u0442\u044c \u0438 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 WSUS \u0438\u043b\u0438 Microsoft Update \\ Get-WindowsUpdate -Download \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \\ Get-WindowsUpdate \u2013Install \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0432\u0441\u0435 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \\ Install-WindowsUpdate -MicrosoftUpdate -AcceptAll -IgnoreReboot \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0432\u0441\u0435 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0431\u0435\u0437 \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \\ Get-WindowsUpdate -KBArticleID KB2267602, KB4533002 -Install \\ Get-WindowsUpdate -KBArticleID KB2538243 -Hide \u0441\u043a\u0440\u044b\u0442\u044c \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f, \u0447\u0442\u043e \u0431\u044b \u043e\u043d\u0438 \u043d\u0438\u043a\u043e\u0433\u0434\u0430 \u043d\u0435 \u0443\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u043b\u0438\u0441\u044c \\ Get-WindowsUpdate \u2013IsHidden \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043a\u0440\u044b\u0442\u044b\u0435 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f (Hide-WindowsUpdate) \\ Remove-WindowsUpdate -KBArticleID KB4011634 -NoRestart \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \\ Uninstall-WindowsUpdate \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \\ Add-WUServiceManager \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f (Windows Update Service Manager) \\ Enable-WURemoting \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043f\u0440\u0430\u0432\u0438\u043b\u0430 Windows Defender, \u0440\u0430\u0437\u0440\u0435\u0448\u0430\u044e\u0449\u0438\u0435 \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u043e\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u043a\u043e\u043c\u0430\u043d\u0434\u043b\u0435\u0442\u0430 PSWindowsUpdate \\ Get-WUApiVersion \u0432\u0435\u0440\u0441\u0438\u044f Windows Update Agent \\ Get-WUHistory \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044b\u0445 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0439 (\u0438\u0441\u0442\u043e\u0440\u0438\u044f \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0439) \\ Get-WUHistory | Where-Object {$_.Title -match \"KB4517389\"} \u043f\u043e\u0438\u0441\u043a \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \\ Get-WULastResults \u0434\u0430\u0442\u044b \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u043f\u043e\u0438\u0441\u043a\u0430 \u0438 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0439 \\ Get-WURebootStatus \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c, \u043d\u0443\u0436\u043d\u0430 \u043b\u0438 \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0434\u043b\u044f \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0433\u043e \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \\ Get-WUServiceManager \u0432\u044b\u0432\u043e\u0434\u0438\u0442 \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u0438 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0439 \\ Get-WUInstallerStatus \u0441\u0442\u0430\u0442\u0443\u0441 \u0441\u043b\u0443\u0436\u0431\u044b Windows Installer \\ Remove-WUServiceManager \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c Windows Update Service Manager","title":"WindowsUpdate"},{"location":"#dism","text":"Get-Command -Module Dism -Name *Driver* \\ Export-WindowsDriver -Online -Destination C:\\Users\\Lifailon\\Documents\\Drivers\\ \u0438\u0437\u0432\u043b\u0435\u0447\u0435\u043d\u0438\u0435 \u0434\u0440\u0430\u0439\u0432\u0435\u0440\u043e\u0432 \u0438\u0437 \u0442\u0435\u043a\u0443\u0449\u0435\u0439 \u0441\u0438\u0441\u0442\u0435\u043c\u044b (C:\\Windows\\System32\\DriverStore\\FileRepository), \u0432\u044b\u0433\u0440\u0443\u0436\u0430\u0435\u0442 \u0441\u043f\u0438\u0441\u043e\u043a \u0444\u0430\u0439\u043b\u043e\u0432, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u044b \u0434\u043b\u044f \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \u0434\u0440\u0430\u0439\u0432\u0435\u0440\u0430 (dll,sys,exe) \u0432 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0438 \u0441\u043e \u0441\u043f\u0438\u0441\u043a\u043e\u043c \u0444\u0430\u0439\u043b\u043e\u0432, \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u0445 \u0432 \u0441\u0435\u043a\u0446\u0438\u0438 [CopyFiles] inf-\u0444\u0430\u0439\u043b\u0430 \u0434\u0440\u0430\u0439\u0432\u0435\u0440\u0430. \\ Export-WindowsDriver -Path C:\\win_image -Destination C:\\drivers \u0438\u0437\u0432\u043b\u0435\u0447\u044c \u0434\u0440\u0430\u0439\u0432\u0435\u0440\u0430 \u0438\u0437 \u043e\u0444\u043b\u0430\u0439\u043d \u043e\u0431\u0440\u0430\u0437\u0430 Windows, \u0441\u043c\u043e\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0433\u043e \u0432 \u043a\u0430\u0442\u0430\u043b\u043e\u0433 c:\\win_image \\ $BackupDrivers = Export-WindowsDriver -Online -Destination C:\\Drivers \\ $BackupDrivers | ft Driver,ClassName,ProviderName,Date,Version,ClassDescription \u0441\u043f\u0438\u0441\u043e\u043a \u0434\u0440\u0430\u0439\u0432\u0435\u0440\u043e\u0432 \u0432 \u043e\u0431\u044a\u0435\u043a\u0442\u043d\u043e\u043c \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0438 \\ $BackupDrivers | where classname -match printer \\ pnputil.exe /add-driver C:\\drivers\\*.inf /subdirs /install \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0432\u0441\u0435 (\u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 subdirs) \u0434\u0440\u0430\u0439\u0432\u0435\u0440\u0430 \u0438\u0437 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0439 \u043f\u0430\u043f\u043a\u0438 (\u0432\u043a\u043b\u044e\u0447\u0430\u044f \u0432\u043b\u043e\u0436\u0435\u043d\u043d\u044b\u0435) sfc /scannow \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0446\u0435\u043b\u043e\u0441\u0442\u043d\u043e\u0441\u0442\u044c \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u044b\u0445 \u0444\u0430\u0439\u043b\u043e\u0432 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0443\u0442\u0438\u043b\u0438\u0442\u044b SFC (System File Checker), \u0432 \u0441\u043b\u0443\u0447\u0430\u0435 \u043f\u043e\u0438\u0441\u043a\u0430 \u043e\u0448\u0438\u0431\u043e\u043a, \u043f\u043e\u043f\u0440\u043e\u0431\u0443\u0435\u0442 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0438\u0445 \u043e\u0440\u0438\u0433\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u0435 \u043a\u043e\u043f\u0438\u0438 \u0438\u0437 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0430 \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u044b\u0445 \u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u043e\u0432 Windows (\u043a\u0430\u0442\u0430\u043b\u043e\u0433 C:\\Windows\\WinSxS). \u0412\u044b\u0432\u043e\u0434 \u0440\u0430\u0431\u043e\u0442\u044b \u043b\u043e\u0433\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u0432 C:\\Windows\\Logs\\CBS \u0441 \u0442\u0435\u0433\u043e\u043c SR \\ Get-ComputerInfo | select * \u043f\u043e\u0434\u0440\u043e\u0431\u043d\u0430\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043e \u0441\u0438\u0441\u0442\u0435\u043c\u0435 (WindowsVersion,WindowsEditionId, Bios ) \\ Get-WindowsImage -ImagePath E:\\sources\\install.wim \u0441\u043f\u0438\u0441\u043e\u043a \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0445 \u0432\u0435\u0440\u0441\u0438\u0439 \u0432 \u043e\u0431\u0440\u0430\u0437\u0435 \\ Repair-WindowsImage -Online \u2013ScanHealth \\ Repair-WindowsImage -Online -RestoreHealth \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0430 \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u044b\u0445 \u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u043e\u0432 \\ Repair-WindowsImage -Online -RestoreHealth -Source E:\\sources\\install.wim:3 \u2013LimitAccess \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0432 \u043e\u0444\u0444\u043b\u0430\u0439\u043d \u0440\u0435\u0436\u0438\u043c\u0435 \u0438\u0437 \u043e\u0431\u0440\u0430\u0437\u0430 \u043f\u043e \u043d\u043e\u043c\u0435\u0440\u0443 \u0438\u043d\u0434\u0435\u043a\u0441\u0430","title":"DISM"},{"location":"#scheduled","text":"$Trigger = New-ScheduledTaskTrigger -At 01:00am -Daily 1:00 \u043d\u043e\u0447\u0438 \\ $Trigger = New-ScheduledTaskTrigger \u2013AtLogon \u0437\u0430\u043f\u0443\u0441\u043a \u043f\u0440\u0438 \u0432\u0445\u043e\u0434\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0443 \\ $Trigger = New-ScheduledTaskTrigger -AtStartup \u043f\u0440\u0438 \u0437\u0430\u043f\u0443\u0441\u043a\u0435 \u0441\u0438\u0441\u0442\u0435\u043c\u044b \\ $User = \"NT AUTHORITY\\SYSTEM\" \\ $Action = New-ScheduledTaskAction -Execute \"PowerShell.exe\" -Argument \"$home\\Documents\\DNS-Change-Tray-1.3.ps1\" \\ $Action = New-ScheduledTaskAction -Execute \"PowerShell.exe\" -Argument \"-NoProfile -NoLogo -NonInteractive -ExecutionPolicy Unrestricted -WindowStyle Hidden -File $home\\Documents\\DNS-Change-Tray-1.3.ps1\" \\ Register-ScheduledTask -TaskName \"DNS-Change-Tray-Startup\" -Trigger $Trigger -User $User -Action $Action -RunLevel Highest \u2013Force Get-ScheduledTask | ? state -ne Disabled \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0445 \u0437\u0430\u0434\u0430\u043d\u0438\u0439 \\ Start-ScheduledTask DNS-Change-Tray-Startup \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0437\u0430\u0434\u0430\u043d\u0438\u0435 \u043d\u0435\u043c\u0435\u0434\u043b\u0435\u043d\u043d\u043e \\ Get-ScheduledTask DNS-Change-Tray-Startup | Disable-ScheduledTask \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0437\u0430\u0434\u0430\u043d\u0438\u0435 \\ Get-ScheduledTask DNS-Change-Tray-Startup | Enable-ScheduledTask \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0437\u0430\u0434\u0430\u043d\u0438\u0435 \\ Unregister-ScheduledTask DNS-Change-Tray-Startup \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0437\u0430\u0434\u0430\u043d\u0438\u0435 \\ Export-ScheduledTask DNS-Change-Tray-Startup | Out-File $home\\Desktop\\Task-Export-Startup.xml \u044d\u043a\u0441\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0437\u0430\u0434\u0430\u043d\u0438\u0435 \u0432 xml \\ Register-ScheduledTask -Xml (Get-Content $home\\Desktop\\Task-Export-Startup.xml | Out-String) -TaskName \"DNS-Change-Tray-Startup\"","title":"Scheduled"},{"location":"#network","text":"","title":"Network"},{"location":"#ping","text":"Test-Connection -Count 1 $srv1, $srv2 \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c icmp-\u043f\u0430\u043a\u0435\u0442 \u0434\u0432\u0443\u043c \u0445\u043e\u0441\u0442\u0430\u043c \\ Test-Connection $srv -ErrorAction SilentlyContinue \u043d\u0435 \u0432\u044b\u0432\u043e\u0434\u0438\u0442\u044c \u043e\u0448\u0438\u0431\u043e\u043a, \u0435\u0441\u043b\u0438 \u0445\u043e\u0441\u0442 \u043d\u0435 \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442 \\ Test-Connection -Source $srv1 -ComputerName $srv2 \u043f\u0438\u043d\u0433 \u0441 \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u043e\u0433\u043e \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0430 function Test-PingNetwork { param ( [Parameter(Mandatory,ValueFromPipeline)][string[]]$Network, [ValidateRange(100,10000)][int]$Timeout = 100 ) $ping = New-Object System.Net.NetworkInformation.Ping $Network = $Network -replace \"0$\" $net = @() foreach ($r in @(1..254)) { $net += \"$network$r\" } foreach ($n in $net) { $ping.Send($n, $timeout) | select @{Name=\"Address\"; Expression={$n -replace \".+\\.\"}}, Status } } Test-PingNetwork -Network 192.168.3.0 \\ Test-PingNetwork -Network 192.168.3.0 -Timeout 1000 Get-CimInstance -Class Win32_PingStatus -Filter \"Address='127.0.0.1'\" \\ Get-CimInstance -Class Win32_PingStatus -Filter \"Address='127.0.0.1'\" | Format-Table -Property Address,ResponseTime,StatusCode -Autosize 0 - \u0443\u0441\u043f\u0435\u0445 \\ '127.0.0.1','8.8.8.8' | ForEach-Object -Process {Get-CimInstance -Class Win32_PingStatus -Filter (\"Address='$_'\") | Select-Object -Property Address,ResponseTime,StatusCode} \\ $ips = 1..254 | ForEach-Object -Process {'192.168.1.' + $_} \u0441\u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043c\u0430\u0441\u0441\u0438\u0432 \u0438\u0437 ip-\u0430\u0434\u0440\u0435\u0441\u043e\u0432 \u043f\u043e\u0434\u0441\u0435\u0442\u0438","title":"ping"},{"location":"#dhcp","text":"Get-CimInstance -Class Win32_NetworkAdapterConfiguration -Filter \"DHCPEnabled=$true\" \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0430\u0434\u0430\u043f\u0442\u0435\u0440\u044b \u0441 \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u043d\u044b\u043c DHCP \\ $wql = 'SELECT * from Win32_NetworkAdapterConfiguration WHERE IPEnabled=True and DHCPEnabled=False' \\ Invoke-CimMethod -MethodName ReleaseDHCPLease -Query $wql \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 DHCP \u043d\u0430 \u0432\u0441\u0435\u0445 \u0430\u0434\u0430\u043f\u0442\u0435\u0440\u0430\u0445 \\ Invoke-CimMethod -ClassName Win32_NetworkAdapterConfiguration -MethodName ReleaseDHCPLeaseAll \u043e\u0442\u043c\u0435\u043d\u0438\u0442\u044c \u0430\u0440\u0435\u043d\u0434\u0443 \u0430\u0434\u0440\u0435\u0441\u043e\u0432 DHCP \u043d\u0430 \u0432\u0441\u0435\u0445 \u0430\u0434\u0430\u043f\u0442\u0435\u0440\u0430\u0445 \\ Invoke-CimMethod -ClassName Win32_NetworkAdapterConfiguration -MethodName RenewDHCPLeaseAll \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0430\u0440\u0435\u043d\u0434\u0443 \u0430\u0434\u0440\u0435\u0441\u043e\u0432 DHCP \u043d\u0430 \u0432\u0441\u0435\u0445 \u0430\u0434\u0430\u043f\u0442\u0435\u0440\u0430\u0445","title":"dhcp"},{"location":"#port","text":"tnc $srv -p 5985 \\ tnc $srv -CommonTCPPort WINRM HTTP,RDP,SMB \\ tnc ya.ru \u2013TraceRoute -Hops 2 TTL=2 \\ tnc ya.ru -DiagnoseRouting \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0430\u0446\u0438\u044f \u0434\u043e \u0445\u043e\u0441\u0442\u0430, \u043a\u0443\u0434\u0430 (DestinationPrefix: 0.0.0.0/0) \u0447\u0435\u0440\u0435\u0437 (NextHop: 192.168.1.254)","title":"port"},{"location":"#nslookup","text":"nslookup ya.ru 1.1.1.1 \u0441 \u0443\u043a\u0430\u0437\u0430\u043d\u0438\u0435\u043c DNS \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \\ nslookup -type=any ya.ru \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u0442\u0438\u043f \u0437\u0430\u043f\u0438\u0441\u0438 \\ Resolve-DnsName ya.ru -Type MX ALL,ANY,A,NS,SRV,CNAME,PTR,TXT(spf) \\ [System.Net.Dns]::GetHostEntry(\"ya.ru\")","title":"nslookup"},{"location":"#ipconfig","text":"Get-NetIPConfiguration \\ Get-NetIPConfiguration -InterfaceIndex 14 -Detailed","title":"ipconfig"},{"location":"#adapter","text":"Get-NetAdapter \\ Set-NetIPInterface -InterfaceIndex 14 -Dhcp Disabled \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c DHCP \\ Get-NetAdapter -InterfaceIndex 14 | New-NetIPAddress \u2013IPAddress 192.168.3.99 -DefaultGateway 192.168.3.1 -PrefixLength 24 \u0437\u0430\u0434\u0430\u0442\u044c/\u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0441\u0442\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439 IP-\u0430\u0434\u0440\u0435\u0441 \\ Set-NetIPAddress -InterfaceIndex 14 -IPAddress 192.168.3.98 \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c IP-\u0430\u0434\u0440\u0435\u0430\u0441 \u043d\u0430 \u0430\u0434\u0430\u043f\u0442\u0435\u0440\u0435 \\ Remove-NetIPAddress -InterfaceIndex 14 -IPAddress 192.168.3.99 \u0443\u0434\u0430\u043b\u0438\u0442\u044c IP-\u0430\u0434\u0440\u0435\u0441 \u043d\u0430 \u0430\u0434\u0430\u043f\u0442\u0435\u0440\u0435 \\ Set-NetIPInterface -InterfaceIndex 14 -Dhcp Enabled \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c DHCP","title":"Adapter"},{"location":"#dnsclient","text":"Get-DNSClientServerAddress \\ Set-DNSClientServerAddress -InterfaceIndex 14 -ServerAddresses 8.8.8.8","title":"DNSClient"},{"location":"#dnscache","text":"Get-DnsClientCache \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043a\u044d\u0448\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0435 \u0437\u0430\u043f\u0438\u0441\u0438 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 DNS \\ Clear-DnsClientCache \u043e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u043a\u044d\u0448","title":"DNSCache"},{"location":"#binding","text":"Get-NetAdapterBinding -Name Ethernet -IncludeHidden -AllBindings \\ Get-NetAdapterBinding -Name \"\u0411\u0435\u0441\u043f\u0440\u043e\u0432\u043e\u0434\u043d\u0430\u044f \u0441\u0435\u0442\u044c\" -DisplayName \"IP \u0432\u0435\u0440\u0441\u0438\u0438 6 (TCP/IPv6)\" | Set-NetAdapterBinding -Enabled $false \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c IPv6 \u043d\u0430 \u0430\u0434\u0430\u043f\u0442\u0435\u0440\u0435","title":"Binding"},{"location":"#tcpsetting","text":"Get-NetTCPSetting \\ Set-NetTCPSetting -SettingName DatacenterCustom,Datacenter -CongestionProvider DCTCP \\ Set-NetTCPSetting -SettingName DatacenterCustom,Datacenter -CwndRestart True \\ Set-NetTCPSetting -SettingName DatacenterCustom,Datacenter -ForceWS Disabled","title":"TCPSetting"},{"location":"#netstat","text":"netstat -anop tcp -n/-f/-b \\ Get-NetTCPConnection -State Established,Listen | ? LocalPort -Match 3389 \\ Get-NetTCPConnection -State Established,Listen | ? RemotePort -Match 22 \\ Get-NetUDPEndpoint | ? LocalPort -Match 514 netstat -ap udp`","title":"netstat"},{"location":"#statistics","text":"netstat -se \\ Get-NetAdapterStatistics","title":"Statistics"},{"location":"#hostname","text":"$env:computername \\ hostname.exe \\ (Get-CIMInstance CIM_ComputerSystem).Name \\ (New-Object -ComObject WScript.Network).ComputerName \\ [System.Environment]::MachineName \\ [System.Net.Dns]::GetHostName()","title":"hostname"},{"location":"#arp","text":"ipconfig /all | Select-String \"\u0444\u0438\u0437\" grep \\ Get-NetNeighbor -AddressFamily IPv4 function Get-ARP { Param ( $proxy, $search ) if (!$proxy) { $arp = arp -a } if ($proxy) { $arp = icm $proxy {arp -a} } $mac = $arp[3..260] $mac = $mac -replace \"^\\s\\s\" $mac = $mac -replace \"\\s{1,50}\",\" \" $mac_coll = New-Object System.Collections.Generic.List[System.Object] foreach ($m in $mac) { $smac = $m -split \" \" $mac_coll.Add([PSCustomObject]@{ IP = $smac[0]; MAC = $smac[1]; Type = $smac[2] }) } if ($search) { if ($search -NotMatch \"\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\") { #$ns = nslookup $search #$ns = $ns[-2] #$global:ns = $ns -replace \"Address:\\s{1,10}\" $rdns = Resolve-DnsName $search -ErrorAction Ignore $ns = $rdns.IPAddress if ($ns -eq $null) { return } } else { $ns = $search } $mac_coll = $mac_coll | ? ip -Match $ns } $mac_coll } Get-ARP -search 192.168.3.100 \\ Get-ARP -search 192.168.3.100 -proxy dc-01","title":"arp"},{"location":"#rdp","text":"Get-ItemProperty -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp\" -Name \"PortNumber\" \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043d\u043e\u043c\u0435\u0440 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e RDP \u043f\u043e\u0440\u0442\u0430 \\ Set-ItemProperty -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp\" -Name \"PortNumber\" -Value \"3390\" \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c RDP-\u043f\u043e\u0440\u0442 \\ $(Get-ItemProperty -Path \"HKLM:\\System\\CurrentControlSet\\Control\\Terminal Server\\\" -Name \"fDenyTSConnections\").fDenyTSConnections \u0435\u0441\u043b\u0438 0, \u0442\u043e \u0432\u043a\u043b\u044e\u0447\u0435\u043d \\ Set-ItemProperty -Path \"HKLM:\\System\\CurrentControlSet\\Control\\Terminal Server\\\" -Name \"fDenyTSConnections\" -Value 0 \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c RDP \\ reg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\" /v fDenyTSConnections /t REG_DWORD /d 0 /f \\ (gcim -Class Win32_TerminalServiceSetting -Namespace root\\CIMV2\\TerminalServices).SetAllowTSConnections(0) \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c RDP (\u0434\u043b\u044f Windows Server) \\ Get-Service TermService | Restart-Service -Force \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c rdp-\u0441\u043b\u0443\u0436\u0431\u0443 \\ New-NetFirewallRule -Profile Any -DisplayName \"RDP 3390\" -Direction Inbound -Protocol TCP -LocalPort 3390 \u043e\u0442\u043a\u0440\u044b\u0442\u044c RDP-\u043f\u043e\u0440\u0442","title":"RDP"},{"location":"#ipban","text":"auditpol /get /category:* \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u043f\u043e\u043b\u0438\u0442\u0438\u043a\u0438 \u0430\u0443\u0434\u0438\u0442\u0430 \\ auditpol /get /category:\u0412\u0445\u043e\u0434/\u0432\u044b\u0445\u043e\u0434 \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u0435 \u043f\u043e\u043b\u0438\u0442\u0438\u043a\u0438 \u0430\u0443\u0434\u0438\u0442\u0430 \u0434\u043b\u044f \u0412\u0445\u043e\u0434\u0430 \u0438 \u0412\u044b\u0445\u043e\u0434\u0430 \u0438\u0437 \u0441\u0438\u0441\u0442\u0435\u043c\u044b \\ auditpol /set /subcategory:\"\u0412\u0445\u043e\u0434 \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0443\" /success:enable /failure:enable \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u0435 \u043f\u043e\u043b\u0438\u0442\u0438\u043a\u0438 - \u0410\u0443\u0434\u0438\u0442 \u0432\u0445\u043e\u0434\u0430 \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0443 \\ auditpol /set /subcategory:\"\u0412\u044b\u0445\u043e\u0434 \u0438\u0437 \u0441\u0438\u0441\u0442\u0435\u043c\u044b\" /success:enable /failure:enable $url = $($(Invoke-RestMethod https://api.github.com/repos/DigitalRuby/IPBan/releases/latest).assets | Where-Object name -match \".+win.+x64.+\").browser_download_url \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0441\u0441\u044b\u043b\u043a\u0443 \u0434\u043b\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0439 \u0432\u0435\u0440\u0441\u0438\u0438 \\ $version = $(Invoke-RestMethod https://api.github.com/repos/DigitalRuby/IPBan/releases/latest).tag_name \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043d\u043e\u043c\u0435\u0440 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0439 \u0432\u0435\u0440\u0441\u0438\u0438 \\ $path = \"$home\\Documents\\ipban-$version\" \u043f\u0443\u0442\u044c \u0434\u043b\u044f \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \\ Invoke-RestMethod $url -OutFile \"$home\\Downloads\\IPBan-$version.zip\" \u0441\u043a\u0430\u0447\u0430\u0442\u044c \u0434\u0438\u0441\u0442\u0440\u0438\u0431\u0443\u0442\u0438\u0432 \\ Expand-Archive \"$home\\Downloads\\ipban-$version.zip\" -DestinationPath $path \u0440\u0430\u0437\u0430\u0440\u0445\u0438\u0432\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u043f\u0443\u0442\u044c \u0434\u043b\u044f \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \\ Remove-Item \"$home\\Downloads\\ipban-$version.zip\" \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0434\u0438\u0441\u0442\u0440\u0438\u0431\u0443\u0442\u0438\u0432 \\ sc create IPBan type=own start=delayed-auto binPath=\"$path\\DigitalRuby.IPBan.exe\" DisplayName=IPBan \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0441\u043b\u0443\u0436\u0431\u0443 \\ Get-Service IPBan \u0441\u0442\u0430\u0442\u0443\u0441 \u0441\u043b\u0443\u0436\u0431\u044b \\ $conf = $(Get-Content \"$path\\ipban.config\") \u0447\u0438\u0442\u0430\u0435\u043c \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044e \\ $conf = $conf -replace '<add key=\"Whitelist\" value=\"\"/>','<add key=\"Whitelist\" value=\"192.168.3.0/24\"/>' \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u0431\u0435\u043b\u044b\u0439 \u043b\u0438\u0441\u0442 \u0434\u043e\u043c\u0430\u0448\u043d\u044e\u044e \u0441\u0435\u0442\u044c \u0434\u043b\u044f \u0438\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \\ $conf = $conf -replace '<add key=\"ProcessInternalIPAddresses\" value=\"false\"/>','<add key=\"ProcessInternalIPAddresses\" value=\"true\"/>' \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0443 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u0445 (\u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u0438\u0445) ip-\u0430\u0434\u0440\u0435\u0441\u043e\u0432 \\ $conf = $conf -replace '<add key=\"FailedLoginAttemptsBeforeBanUserNameWhitelist\" value=\"20\"/>','<add key=\"FailedLoginAttemptsBeforeBanUserNameWhitelist\" value=\"5\"/>' \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043f\u043e\u043f\u044b\u0442\u043e\u043a \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u0434\u043e \u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u043a\u0438 \\ $conf = $conf -replace '<add key=\"ExpireTime\" value=\"01:00:00:00\"/>','<add key=\"ExpireTime\" value=\"00:01:00:00\"/>' \u0437\u0430\u0434\u0430\u0442\u044c \u0432\u0440\u0435\u043c\u044f \u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u043a\u0438 1 \u0447\u0430\u0441 \\ $conf > \"$path\\ipban.config\" \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044e \\ Get-Service IPBan | Start-Service \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0441\u043b\u0443\u0436\u0431\u0443 Get-NetFirewallRule | Where-Object DisplayName -Match \"IPBan\" | ForEach-Object { $Name = $_.DisplayName Get-NetFirewallAddressFilter -AssociatedNetFirewallRule $_ | Select-Object @{Name=\"Name\"; Expression={$Name}},LocalIP,RemoteIP } # \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043e\u0431\u043b\u0430\u0441\u0442\u044c \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u043f\u0440\u0430\u0432\u0438\u043b \u0411\u0440\u0430\u043d\u0434\u043c\u0430\u0443\u044d\u0440\u0430 \u0434\u043b\u044f IPBan Get-Content -Wait \"$path\\logfile.txt\" \u0447\u0438\u0442\u0430\u0442\u044c \u043b\u043e\u0433 \\ Get-Service IPBan | Stop-Service \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0441\u043b\u0443\u0436\u0431\u0443 \\ sc delete IPBan \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u043b\u0443\u0436\u0431\u0443","title":"IPBan"},{"location":"#shutdown","text":"shutdown /r /o \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0432 \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u044b\u0439 \u0440\u0435\u0436\u0438\u043c \\ shutdown /s /t 600 /c \"Power off after 10 minutes\" \u0432\u044b\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \\ shutdown /s /f \u043f\u0440\u0438\u043d\u0443\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0435 \u0437\u0430\u043a\u0440\u044b\u0442\u0438\u0435 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0439 \\ shutdown /a \u043e\u0442\u043c\u0435\u043d\u0430 \\ shutdown /r /t 0 /m \\\\192.168.3.100 \\ Restart-Computer -ComputerName 192.168.3.100 -Protocol WSMan \u0447\u0435\u0440\u0435\u0437 WinRM \\ Restart-Computer \u2013ComputerName 192.168.3.100 \u2013Force \u0447\u0435\u0440\u0435\u0437 WMI \\ Set-ItemProperty -Path \"HKLM:\\SOFTWARE\\Microsoft\\PolicyManager\\default\\Start\\HideShutDown\" -Name \"value\" -Value 1 \u0441\u043a\u0440\u044b\u0442\u044c \u043a\u043d\u043e\u043f\u043a\u0443 \u0432\u044b\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \\ Set-ItemProperty -Path \"HKLM:\\SOFTWARE\\Microsoft\\PolicyManager\\default\\Start\\HideRestart\" -Name \"value\" -Value 1 \u0441\u043a\u0440\u044b\u0442\u044c \u043a\u043d\u043e\u043f\u043a\u0443 \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 function Start-Shutdown { <# .SYNOPSIS Module for shutdown and restart the computer at a specified time .DESCRIPTION Example: # Start-Shutdown -Time \"18:00\" # Start-Shutdown -Restart -Time \"18:00\" # Start-Shutdown -Cancel .LINK https://github.com/Lifailon/PS-Commands #> param( [string]$Time, [switch]$Restart, [switch]$Cancel ) if ($Time) { $currentDateTime = Get-Date $shutdownTime = Get-Date $Time if ($shutdownTime -lt $currentDateTime) { $shutdownTime = $shutdownTime.AddDays(1) } $timeUntilShutdown = $shutdownTime - $currentDateTime $secondsUntilShutdown = [math]::Round($timeUntilShutdown.TotalSeconds) } if ($Cancel) { Start-Process -FilePath \"shutdown.exe\" -ArgumentList \"/a\" } elseif ($Restart) { Write-Host \"The computer will restart after $($timeUntilShutdown.Hours) hours and $($timeUntilShutdown.Minutes) minutes.\" Start-Process -FilePath \"shutdown.exe\" -ArgumentList \"/r\", \"/f\", \"/t\", \"$secondsUntilShutdown\" } else { Write-Host \"The computer will shutdown after $($timeUntilShutdown.Hours) hours and $($timeUntilShutdown.Minutes) minutes.\" Start-Process -FilePath \"shutdown.exe\" -ArgumentList \"/s\", \"/f\", \"/t\", \"$secondsUntilShutdown\" } }","title":"shutdown"},{"location":"#localaccounts","text":"Get-Command -Module Microsoft.PowerShell.LocalAccounts \\ Get-LocalUser \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \\ Get-LocalGroup \u0441\u043f\u0438\u0441\u043e\u043a \u0433\u0440\u0443\u043f\u043f \\ New-LocalUser \"1C\" -Password $Password -FullName \"1C Domain\" \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \\ Set-LocalUser -Password $Password 1C \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \\ Add-LocalGroupMember -Group \"Administrators\" -Member \"1C\" \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u0433\u0440\u0443\u043f\u043f\u0443 \u0410\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u043e\u0432 \\ Get-LocalGroupMember \"Administrators\" \u0447\u043b\u0435\u043d\u044b \u0433\u0440\u0443\u043f\u043f\u044b @(\"vproxy-01\",\"vproxy-02\",\"vproxy-03\") | %{ icm $_ {Add-LocalGroupMember -Group \"Administrators\" -Member \"support4\"} icm $_ {Get-LocalGroupMember \"Administrators\"} }","title":"LocalAccounts"},{"location":"#smb","text":"Get-SmbServerConfiguration \\ Set-SmbServerConfiguration -EnableSMB1Protocol $false -Force \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043f\u0440\u043e\u0442\u043e\u043a\u043e\u043b SMB v1 \\ Get-WindowsFeature | Where-Object {$_.name -eq \"FS-SMB1\"} | ft Name,Installstate \u043c\u043e\u0434\u0443\u043b\u044c ServerManager, \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d \u043b\u0438 \u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442 SMB1 \\ Install-WindowsFeature FS-SMB1 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c SMB1 \\ Uninstall-WindowsFeature \u2013Name FS-SMB1 \u2013Remove \u0443\u0434\u0430\u043b\u0438\u0442\u044c SMB1 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 (\u043f\u043e\u043d\u0430\u0434\u043e\u0431\u0438\u0442\u0441\u044f \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430) \\ Get-WindowsOptionalFeature -Online \u043c\u043e\u0434\u0443\u043b\u044c DISM, \u0434\u043b\u044f \u0440\u0430\u0431\u043e\u0442\u044b \u0441 \u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u0430\u043c\u0438 Windows \\ Disable-WindowsOptionalFeature -Online -FeatureName SMB1Protocol -Remove \u0443\u0434\u0430\u043b\u0438\u0442\u044c SMB1 \\ Set-SmbServerConfiguration \u2013AuditSmb1Access $true \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0430\u0443\u0434\u0438\u0442 SMB1 \\ Get-SmbConnection \u0441\u043f\u0438\u0441\u043e\u043a \u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0445 \u0441\u0435\u0441\u0441\u0438\u0439 \u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c\u0430\u044f \u0432\u0435\u0440\u0441\u0438\u044f SMB (Dialect) \\ Get-SmbOpenFile | select ClientUserName,ClientComputerName,Path,SessionID \u0441\u043f\u0438\u0441\u043e\u043a \u043e\u0442\u043a\u0440\u044b\u0442\u044b\u0445 \u0444\u0430\u0439\u043b\u043e\u0432 \\ Get-SmbShare \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u0435\u0442\u0435\u0432\u044b\u0445 \u043f\u0430\u043f\u043e\u043a \\ New-SmbShare -Name xl-share -Path E:\\test \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043d\u043e\u0432\u0443\u044e \u043e\u0431\u0449\u0443\u044e \u0441\u0435\u0442\u0435\u0432\u0443\u044e \u043f\u0430\u043f\u043a\u0443 (\u0440\u0430\u0441\u0448\u0430\u0440\u0438\u0442\u044c) \\ -EncryptData $True \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0448\u0438\u0444\u0440\u043e\u0432\u0430\u043d\u0438\u0435 SMB \\ -Description \u0438\u043c\u044f \u0432 \u0441\u0435\u0442\u0435\u0432\u043e\u043c \u043e\u043a\u0440\u0443\u0436\u0435\u043d\u0438\u0438 \\ -ReadAccess \"domain\\username\" \u0434\u043e\u0441\u0442\u0443\u043f \u043d\u0430 \u0447\u0442\u0435\u043d\u0438\u0435 \\ -ChangeAccess \u0434\u043e\u0441\u0442\u0443\u043f \u043d\u0430 \u0437\u0430\u043f\u0438\u0441\u044c \\ -FullAccess \u043f\u043e\u043b\u043d\u044b\u0439 \u0434\u043e\u0441\u0442\u0443\u043f \\ -NoAccess ALL \u043d\u0435\u0442 \u043f\u0440\u0430\u0432 \\ -FolderEnumerationMode [AccessBased | Unrestricted] \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0441\u043a\u0440\u044b\u0442\u044c \u0432 \u0441\u0435\u0442\u0435\u0432\u043e\u0439 \u043f\u0430\u043f\u043a\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b, \u043d\u0430 \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u0443 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u043d\u0435\u0442 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e Access-Based Enumeration (ABE) \\ Get-SmbShare xl-share | Set-SmbShare -FolderEnumerationMode AccessBased \u043a\u043b\u044e\u0447\u0438\u0442\u044c ABE \u0434\u043b\u044f \u0432\u0441\u0435\u0445 \u0440\u0430\u0441\u0448\u0430\u0440\u0435\u043d\u043d\u044b\u0445 \u043f\u0430\u043f\u043e\u043a \\ Remove-SmbShare xl-share -force \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u0435\u0442\u0435\u0432\u043e\u0439 \u0434\u043e\u0441\u0442\u0443\u043f (\u0448\u0430\u0440\u0443) \\ Get-SmbShareAccess xl-share \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u0441\u043f\u0438\u0441\u043e\u043a \u0434\u043e\u0441\u0442\u0443\u043f\u043e\u0432 \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u0438 \u043a \u0448\u0430\u0440\u0435 \\ Revoke-SmbShareAccess xl-share -AccountName Everyone \u2013Force \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0433\u0440\u0443\u043f\u043f\u0443 \u0438\u0437 \u0441\u043f\u0438\u0441\u043a\u0430 \u0434\u043e\u0441\u0442\u0443\u043f\u043e\u0432 \\ Grant-SmbShareAccess -Name xl-share -AccountName \"domain\\XL-Share\" -AccessRight Change \u2013force \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c/\u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u044f \u043d\u0430 \u0437\u0430\u043f\u0438\u0441\u044c (Full,Read) \\ Grant-SmbShareAccess -Name xl-share -AccountName \"\u0432\u0441\u0435\" -AccessRight Change \u2013force \\ Block-SmbShareAccess -Name xl-share -AccountName \"domain\\noAccess\" -Force \u043f\u0440\u0438\u043d\u0443\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u0437\u0430\u043f\u0440\u0435\u0442 \\ New-SmbMapping -LocalPath X: -RemotePath \\\\$srv\\xl-share -UserName support4 -Password password \u2013Persistent $true \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0441\u0435\u0442\u0435\u0432\u043e\u0439 \u0434\u0438\u0441\u043a \\ -Persistent \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f \u043f\u043e\u0441\u043b\u0435 \u043e\u0442\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0430 \u0438\u043b\u0438 \u0441\u0435\u0442\u0438 \\ -SaveCredential \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0443\u0447\u0435\u0442\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0434\u043b\u044f \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u0432 \u0434\u0438\u0441\u043f\u0435\u0442\u0447\u0435\u0440 \u0443\u0447\u0435\u0442\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445 Windows Credential Manager \\ Stop-Process -Name \"explorer\" | Start-Process -FilePath \"C:\\Windows\\explorer.exe\" \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u0434\u043b\u044f \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0432 \u043f\u0440\u043e\u0432\u043e\u0434\u043d\u0438\u043a\u0435 \\ Get-SmbMapping \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u043d\u044b\u0445 \u0441\u0435\u0442\u0435\u0432\u044b\u0445 \u0434\u0438\u0441\u043a\u043e\u0432 \\ Remove-SmbMapping X: -force \u043e\u0442\u043c\u043e\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u0435\u0442\u0435\u0432\u043e\u0439 \u0434\u0438\u0441\u043a \\ $CIMSession = New-CIMSession \u2013Computername $srv \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0441\u0435\u0430\u043d\u0441 CIM (\u0430\u0443\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u044f \u043d\u0430 SMB) \\ Get-SmbOpenFile -CIMSession $CIMSession | select ClientUserName,ClientComputerName,Path | Out-GridView -PassThru | Close-SmbOpenFile -CIMSession $CIMSession -Confirm:$false \u2013Force \u0437\u0430\u043a\u0440\u044b\u0442\u044c \u0444\u0430\u0439\u043b\u044b (\u043e\u0442\u043a\u0440\u044b\u0442\u044c \u043a \u043d\u0438\u043c \u0441\u0435\u0442\u0435\u0432\u043e\u0439 \u0434\u043e\u0441\u0442\u0443\u043f)","title":"SMB"},{"location":"#get-acl","text":"(Get-Acl \\\\$srv\\xl-share).access \u0434\u043e\u0441\u0442\u0443\u043f ACL \u043d\u0430 \u0443\u0440\u043e\u0432\u043d\u0435 NTFS \\ Get-Acl C:\\Drivers | Set-Acl C:\\Distr \u0441\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c NTFS \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u044f \u0441 \u043e\u0434\u043d\u043e\u0439 \u043f\u0430\u043f\u043a\u0438 \u0438 \u043f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c \u0438\u0445 \u043d\u0430 \u0434\u0440\u0443\u0433\u0443\u044e","title":"Get-Acl"},{"location":"#ntfssecurity","text":"Install-Module -Name NTFSSecurity -force \\ Get-Item \"\\\\$srv\\xl-share\" | Get-NTFSAccess \\ Add-NTFSAccess -Path \"\\\\$srv\\xl-share\" -Account \"domain\\xl-share\" -AccessRights Fullcontrol -PassThru \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \\ Remove-NTFSAccess -Path \"\\\\$srv\\xl-share\" -Account \"domain\\xl-share\" -AccessRights FullControl -PassThru \u0443\u0434\u0430\u043b\u0438\u0442\u044c \\ Get-ChildItem -Path \"\\\\$srv\\xl-share\" -Recurse -Force | Clear-NTFSAccess \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u0441\u0435 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u044f, \u0431\u0435\u0437 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u044f \u0443\u043d\u0430\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u043d\u043d\u044b\u0445 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u0439 \\ Get-ChildItem -Path \"\\\\$srv\\xl-share\" -Recurse -Force | Enable-NTFSAccessInheritance \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c NTFS \u043d\u0430\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u043d\u0438\u0435 \u0434\u043b\u044f \u0432\u0441\u0435\u0445 \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 \u0432 \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0435","title":"NTFSSecurity"},{"location":"#storage","text":"Get-Command -Module Storage \\ Get-Disk \u0441\u043f\u0438\u0441\u043e\u043a \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u0434\u0438\u0441\u043a\u043e\u0432 \\ Get-Partition \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0440\u0430\u0437\u0434\u0435\u043b\u044b \u043d\u0430 \u0432\u0441\u0435\u0445 \u0434\u0438\u0441\u043a\u0430\u0445 \\ Get-Volume \u0441\u043f\u0438\u0441\u043e\u043a \u043b\u043e\u0433\u0438\u0447\u043a\u0438\u0445 \u0440\u0430\u0437\u0434\u0435\u043b\u043e\u0432 \\ Get-PhysicalDisk \u0441\u043f\u0438\u0441\u043e\u043a \u0444\u0438\u0437\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u0434\u0438\u0441\u043a\u043e\u0432 \\ Initialize-Disk 1 \u2013PartitionStyle MBR \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0434\u0438\u0441\u043a \\ New-Partition -DriveLetter D \u2013DiskNumber 1 -Size 500gb \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0440\u0430\u0437\u0434\u0435\u043b (\u0432\u044b\u0434\u0435\u043b\u0438\u0442\u044c \u0432\u0441\u0435 \u043c\u0435\u0441\u0442\u043e -UseMaximumSize) \\ Format-Volume -DriveLetter D -FileSystem NTFS -NewFileSystemLabel Disk-D \u0444\u043e\u0440\u043c\u0430\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0440\u0430\u0437\u0434\u0435\u043b \\ Set-Partition -DriveLetter D -IsActive $True \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u0430\u043a\u0442\u0438\u0432\u043d\u044b\u043c \\ Remove-Partition -DriveLetter D \u2013DiskNumber 1 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0440\u0430\u0437\u0434\u0435\u043b \\ Clear-Disk -Number 1 -RemoveData \u043e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u0434\u0438\u0441\u043a \\ Repair-Volume \u2013driveletter C \u2013Scan Check disk \\ Repair-Volume \u2013driveletter C \u2013SpotFix \\ Repair-Volume \u2013driverletter C -Scan \u2013Cimsession $CIMSession","title":"Storage"},{"location":"#iscsi","text":"New-IscsiVirtualDisk -Path D:\\iSCSIVirtualDisks\\iSCSI2.vhdx -Size 20GB \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0434\u0438\u043d\u0430\u043c\u0438\u0447\u0435\u0441\u043a\u0438\u0439 vhdx-\u0434\u0438\u0441\u043a (\u0434\u043b\u044f \u0444\u0438\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0433\u043e \u0440\u0430\u0437\u043c\u0435\u0440\u0430 -UseFixed) \\ New-IscsiServerTarget -TargetName iscsi-target-2 -InitiatorIds \"IQN:iqn.1991-05.com.microsoft:srv3.contoso.com\" \u0441\u043e\u0437\u0434\u0430\u0442\u044c Target \\ Get-IscsiServerTarget | fl TargetName, LunMappings \\ Connect-IscsiTarget -NodeAddress \"iqn.1995-05.com.microsoft:srv2-iscsi-target-2-target\" -IsPersistent $true \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f \u0438\u043d\u0438\u0446\u0438\u0430\u0442\u043e\u0440\u043e\u043c \u043a \u0442\u0430\u0440\u0433\u0435\u0442\u0443 \\ Get-IscsiTarget | fl \\ Disconnect-IscsiTarget -NodeAddress \"iqn.1995-05.com.microsoft:srv2-iscsi-target-2-target\" -Confirm:$false \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f","title":"iSCSI"},{"location":"#activedirectory","text":"","title":"ActiveDirectory"},{"location":"#rsat-remote-server-administration-tools","text":"DISM.exe /Online /add-capability /CapabilityName:Rsat.ActiveDirectory.DS-LDS.Tools~~~~0.0.1.0 /CapabilityName:Rsat.GroupPolicy.Management.Tools~~~~0.0.1.0 \\ Add-WindowsCapability \u2013online \u2013Name Rsat.Dns.Tools~~~~0.0.1.0 \\ Add-WindowsCapability -Online -Name Rsat.DHCP.Tools~~~~0.0.1.0 \\ Add-WindowsCapability \u2013online \u2013Name Rsat.FileServices.Tools~~~~0.0.1.0 \\ Add-WindowsCapability -Online -Name Rsat.WSUS.Tools~~~~0.0.1.0 \\ Add-WindowsCapability -Online -Name Rsat.CertificateServices.Tools~~~~0.0.1.0 \\ Add-WindowsCapability -Online -Name Rsat.RemoteDesktop.Services.Tools~~~~0.0.1.0 \\ Get-WindowsCapability -Name RSAT* -Online | Select-Object -Property DisplayName, State \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044b\u0445 \u043a\u043e\u043c\u043f\u0430\u043d\u0435\u043d\u0442\u043e\u0432","title":"RSAT (Remote Server Administration Tools)"},{"location":"#import-module-activedirectory","text":"$Session = New-PSSession -ComputerName $srv -Credential $cred \\ Export-PSsession -Session $Session -Module ActiveDirectory -OutputModule ActiveDirectory \u044d\u043a\u0441\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043c\u043e\u0434\u0443\u043b\u044c \u0438\u0437 \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u043e\u0439 \u0441\u0435\u0441\u0441\u0438 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0441 DC) \\ Remove-PSSession -Session $Session \\ Import-Module ActiveDirectory \\ Get-Command -Module ActiveDirectory`","title":"Import-Module ActiveDirectory"},{"location":"#adsi-active-directory-service-interface","text":"$d0 = $env:userdnsdomain \\ $d0 = $d0 -split \"\\.\" \\ $d1 = $d0[0] \\ $d2 = $d0[1] \\ $group = [ADSI]\"LDAP://OU=Domain Controllers,DC=$d1,DC=$d2\" \\ $group | select * $Local_User = [ADSI]\"WinNT://./\u0410\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440,user\" \\ $Local_User | Get-Member \\ $Local_User.Description \\ $Local_User.LastLogin \u0432\u0440\u0435\u043c\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0439 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u043e\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f","title":"ADSI (Active Directory Service Interface)"},{"location":"#ldap-lightweight-directory-access-protocol","text":"$ldapsearcher = New-Object System.DirectoryServices.DirectorySearcher \\ $ldapsearcher.SearchRoot = \"LDAP://OU=Domain Controllers,DC=$d1,DC=$d2\" \\ $ldapsearcher.Filter = \"(objectclass=computer)\" \\ $dc = $ldapsearcher.FindAll().path $usr = $env:username c\u043f\u0438\u0441\u043e\u043a \u0433\u0440\u0443\u043f\u043f \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \\ $ldapsearcher = New-Object System.DirectoryServices.DirectorySearcher \\ $ldapsearcher.Filter = \"(&(objectCategory=User)(samAccountName=$usr))\" \\ $usrfind = $ldapsearcher.FindOne() \\ $groups = $usrfind.properties.memberof -replace \"(,OU=.+)\" \\ $groups = $groups -replace \"(CN=)\" DC (Domain Component) - \u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442 \u0434\u043e\u043c\u0435\u043d\u043d\u043e\u0433\u043e \u0438\u043c\u0435\u043d\u0438 \\ OU (Organizational Unit) - \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0435 \u043f\u043e\u0434\u0440\u0430\u0437\u0434\u0435\u043b\u0435\u043d\u0438\u044f (type), \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442\u0441\u044f \u0434\u043b\u044f \u0443\u043f\u043e\u0440\u044f\u0434\u043e\u0447\u0435\u043d\u0438\u044f \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 \\ Container - \u0442\u0430\u043a \u0436\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0434\u043b\u044f \u0443\u043f\u043e\u0440\u044f\u0434\u043e\u0447\u0435\u043d\u0438\u044f \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432, \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u044b \u0432 \u043e\u0442\u043b\u0438\u0447\u0438\u0438 \u043e\u0442 \u043f\u043e\u0434\u0440\u0430\u0434\u0435\u043b\u0435\u043d\u0438\u0439 \u043d\u0435 \u043c\u043e\u0433\u0443\u0442 \u0431\u044b\u0442\u044c \u043f\u0435\u0440\u0435\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u044b, \u0443\u0434\u0430\u043b\u0435\u043d\u044b, \u0441\u043e\u0437\u0434\u0430\u043d\u044b \u0438\u043b\u0438 \u0441\u0432\u044f\u0437\u0430\u043d\u044b \u0441 \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u043c \u0433\u0440\u0443\u043f\u043f\u043e\u0432\u043e\u0439 \u043f\u043e\u043b\u0438\u0442\u0438\u043a\u0438 (Computers, Domain Controllers, Users) \\ DN (Distinguished Name) \u2014 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u043e\u0435 \u0438\u043c\u044f \u043e\u0431\u044a\u0435\u043a\u0442\u0430 \u0438 \u043c\u0435\u0441\u0442\u043e\u043f\u043e\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u0432 \u043b\u0435\u0441\u0443 AD. \u0412 DN \u043e\u043f\u0438\u0441\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u043e\u0432 \u0432 \u0434\u0435\u0440\u0435\u0432\u0435 (\u043f\u0443\u0442\u044c \u043d\u0430\u0432\u0438\u0433\u0430\u0446\u0438\u0438), \u0442\u0440\u0435\u0431\u0443\u0435\u043c\u043e\u0435 \u0434\u043b\u044f \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043a \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0439 \u0437\u0430\u043f\u0438\u0441\u0438 \u0438\u043b\u0438 \u0435\u0435 \u043f\u043e\u0438\u0441\u043a\u0430 \\ CN (Common Name) - \u043e\u0431\u0449\u0435\u0435 \u0438\u043c\u044f (Get-ADObject (Get-ADRootDSE).DefaultNamingContext -Properties wellKnownObjects).wellKnownObjects \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u044b \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \\ redircmp OU=Client Computers,DC=root,DC=domain,DC=local \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u043e\u0432 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \\ redirusr \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e","title":"LDAP (Lightweight Directory Access Protocol)"},{"location":"#laps-local-admin-password-management","text":"Import-module AdmPwd.ps \u0438\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043c\u043e\u0434\u0443\u043b\u044c \\ Get-AdmPwdPassword -ComputerName NAME \u043f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \\ Reset-AdmPwdPassword -ComputerName NAME \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \\ Get-ADComputer -Filter * -SearchBase \"DC=$d1,DC=$d2\" | Get-AdmPwdPassword -ComputerName {$_.Name} | select ComputerName,Password,ExpirationTimestamp | Out-GridView \\ Get-ADComputer -Identity $srv | Get-AdmPwdPassword -ComputerName {$_.Name} | select ComputerName,Password,ExpirationTimestamp","title":"LAPS (Local Admin Password Management)"},{"location":"#recycle-bin","text":"\u0423\u0434\u0430\u043b\u0435\u043d\u043d\u044b\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u0445\u0440\u0430\u043d\u044f\u0442\u0441\u044f \u0432 \u043a\u043e\u0440\u0437\u0438\u043d\u0435 AD \u0432 \u0442\u0435\u0447\u0435\u043d\u0438\u0438 \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0437\u0430\u0445\u043e\u0440\u043e\u043d\u0435\u043d\u0438\u044f (\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u0435\u0442\u0441\u044f \u0432 \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u0435 \u0434\u043e\u043c\u0435\u043d\u0430 msDS-deletedObjectLifetime), \u0437\u0430\u0434\u0430\u043d\u043d\u043e\u043c \u0434\u043b\u044f \u043b\u0435\u0441\u0430. \u041f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \u044d\u0442\u043e 180 \u0434\u043d\u0435\u0439. \u0415\u0441\u043b\u0438 \u0434\u0430\u043d\u043d\u044b\u0439 \u0441\u0440\u043e\u043a \u043f\u0440\u043e\u0448\u0435\u043b, \u043e\u0431\u044a\u0435\u043a\u0442 \u0432\u0441\u0435 \u0435\u0449\u0435 \u043e\u0441\u0442\u0430\u0435\u0442\u0441\u044f \u0432 \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u0435 Deleted Objects, \u043d\u043e \u0431\u043e\u043b\u044c\u0448\u0438\u043d\u0441\u0442\u0432\u043e \u0435\u0433\u043e \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u043e\u0432 \u0438 \u0441\u0432\u044f\u0437\u0435\u0439 \u043e\u0447\u0438\u0449\u0430\u044e\u0442\u0441\u044f (Recycled Object). \u041f\u043e\u0441\u043b\u0435 \u0438\u0441\u0442\u0435\u0447\u0435\u043d\u0438\u044f \u043f\u0435\u0440\u0438\u043e\u0434\u0430 tombstoneLifetime (\u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \u0442\u0430\u043a\u0436\u0435 180 \u0434\u043d\u0435\u0439, \u043d\u043e \u043c\u043e\u0436\u043d\u043e \u0443\u0432\u0435\u043b\u0438\u0447\u0438\u0442\u044c) \u043e\u0431\u044a\u0435\u043a\u0442 \u043f\u043e\u043b\u043d\u043e\u0441\u0442\u044c\u044e \u0443\u0434\u0430\u043b\u044f\u0435\u0442\u0441\u044f \u0438\u0437 AD \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u043c \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u043c \u043e\u0447\u0438\u0441\u0442\u043a\u0438. \\ Get-ADForest domain.local \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0443\u0440\u043e\u0432\u0435\u043d\u044c \u0440\u0430\u0431\u043e\u0442\u044b \u043b\u0435\u0441\u0430 \\ Set-ADForestMode -Identity domain.local -ForestMode Windows2008R2Forest -force \u0443\u0432\u0435\u043b\u0438\u0447\u0438\u0442\u044c \u0443\u0440\u043e\u0432\u0435\u043d\u044c \u0440\u0430\u0431\u043e\u0442\u044b \u043b\u0435\u0441\u0430 \\ Enable-ADOptionalFeature \u2013Identity \"CN=Recycle Bin Feature,CN=Optional Features,CN=Directory Service,CN=Windows NT,CN=Services,CN=Configuration,DC=domain,DC=local\" \u2013Scope ForestOrConfigurationSet \u2013Target \"domain.local\" \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043a\u043e\u0440\u0437\u0438\u043d\u0443 \\ Get-ADOptionalFeature \"Recycle Bin Feature\" | select-object name,EnabledScopes \u0435\u0441\u043b\u0438 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 EnabledScopes \u043d\u0435 \u043f\u0443\u0441\u0442\u043e\u0435, \u0437\u043d\u0430\u0447\u0438\u0442 \u0432 \u0434\u043e\u043c\u0435\u043d\u0435 \u043a\u043e\u0440\u0437\u0438\u043d\u0430 Active Directory \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u0430 \\ Get-ADObject -Filter 'Name -like \"*tnas*\"' -IncludeDeletedObjects \u043d\u0430\u0439\u0442\u0438 \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u0443\u044e (Deleted: True) \u0423\u0417 (ObjectClass: user) \u0432 AD \\ Get-ADObject -Filter 'Name -like \"*tnas*\"' \u2013IncludeDeletedObjects -Properties *| select-object Name, sAMAccountName, LastKnownParent, memberOf, IsDeleted | fl \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u0430 IsDeleted, \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440, \u0432 \u043a\u043e\u0442\u043e\u0440\u043e\u043c \u043d\u0430\u0445\u043e\u0434\u0438\u043b\u0441\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435 \u043f\u0435\u0440\u0435\u0434 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u0435\u043c (LastKnownParent) \u0438 \u0441\u043f\u0438\u0441\u043e\u043a \u0433\u0440\u0443\u043f\u043f, \u0432 \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u043e\u043d \u0441\u043e\u0441\u0442\u043e\u044f\u043b \\ Get-ADObject \u2013filter {Deleted -eq $True -and ObjectClass -eq \"user\"} \u2013includeDeletedObjects \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u0441\u043f\u0438\u0441\u043e\u043a \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u044b\u0445 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \\ Restore-ADObject -Identity \"3dc33c7c-b912-4a19-b1b7-415c1395a34e\" \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043f\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044e \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u0430 ObjectGUID \\ Get-ADObject -Filter 'SAMAccountName -eq \"tnas-01\"' \u2013IncludeDeletedObjects | Restore-ADObject \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043f\u043e SAMAccountName \\ Get-ADObject -Filter {Deleted -eq $True -and ObjectClass -eq 'group' -and Name -like '*Allow*'} \u2013IncludeDeletedObjects | Restore-ADObject \u2013Verbose \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0433\u0440\u0443\u043f\u043f\u0443 \u0438\u043b\u0438 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440","title":"Recycle Bin"},{"location":"#thumbnailphoto","text":"$photo = [byte[]](Get-Content C:\\Install\\adm.jpg -Encoding byte) \u043f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u044c \u0444\u0430\u0439\u043b \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0438 \u0432 \u043c\u0430\u0441\u0441\u0438\u0432 \u0431\u0430\u0439\u0442\u043e\u0432 (jpeg/bmp \u0444\u0430\u0439\u043b, \u0440\u0430\u0437\u043c\u0435\u0440\u043e\u043c \u0444\u043e\u0442\u043e \u0434\u043e 100 \u041a\u0431 \u0438 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u0435\u043c 96?96) \\ Set-ADUser support4 -Replace @{thumbnailPhoto=$photo} \u0437\u0430\u0434\u0430\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u0430 thumbnailPhoto","title":"thumbnailPhoto"},{"location":"#addomaincontroller","text":"Get-ADDomainController \u0432\u044b\u0432\u043e\u0434\u0438\u0442 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u043e \u0442\u0435\u043a\u0443\u0449\u0435\u043c \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0435 \u0434\u043e\u043c\u0435\u043d\u0430 (LogonServer), \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0434\u0430\u043d\u043d\u044b\u043c \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u043e\u043c \u0434\u043b\u044f \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438 (DC \u0432\u044b\u0431\u0438\u0440\u0430\u0435\u0442\u0441\u044f \u043f\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0435 \u0432 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0438 \u0441 \u0442\u043e\u043f\u043e\u043b\u043e\u0433\u0438\u0435\u0439 \u0441\u0430\u0439\u0442\u043e\u0432 AD) \\ Get-ADDomainController -Discover -Service PrimaryDC \u043d\u0430\u0439\u0442\u0438 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440 \u0441 \u0440\u043e\u043b\u044c\u044e PDC \u0432 \u0434\u043e\u043c\u0435\u043d\u0435 \\ Get-ADDomainController -Filter * | ft HostName,IPv4Address,Name,Site,OperatingSystem,IsGlobalCatalog \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435 DC, \u043f\u0440\u0438\u043d\u0430\u0434\u043b\u0435\u0436\u043d\u043e\u0441\u0442\u044c \u043a \u0441\u0430\u0439\u0442\u0443, \u0432\u0435\u0440\u0441\u0438\u0438 \u041e\u0421 \u0438 GC \u041f\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0435 \u041e\u0421 \u0441\u043b\u0443\u0436\u0431\u0430 NetLogon \u0434\u0435\u043b\u0430\u0435\u0442 DNS \u0437\u0430\u043f\u0440\u043e\u0441 \u0441\u043e \u0441\u043f\u0438\u0441\u043a\u043e\u043c \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u043e\u0432 \u0434\u043e\u043c\u0435\u043d\u0430 (\u043a SRV \u0437\u0430\u043f\u0438\u0441\u0438 ldap._tcp.dc._msdcs.domain ), DNS \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0441\u043f\u0438\u0441\u043e\u043a DC \u0432 \u0434\u043e\u043c\u0435\u043d\u0435 \u0441 \u0437\u0430\u043f\u0438\u0441\u044c\u044e Service Location (SRV). \u041a\u043b\u0438\u0435\u043d\u0442 \u0434\u0435\u043b\u0430\u0435\u0442 LDAP \u0437\u0430\u043f\u0440\u043e\u0441 \u043a DC \u0434\u043b\u044f \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u044f \u0441\u0430\u0439\u0442\u0430 AD \u043f\u043e \u0441\u0432\u043e\u0435\u043c\u0443 IP \u0430\u0434\u0440\u0435\u0441\u0443. \u041a\u043b\u0438\u0435\u043d\u0442 \u0447\u0435\u0440\u0435\u0437 DNS \u0437\u0430\u043f\u0440\u0430\u0448\u0438\u0432\u0430\u0435\u0442 \u0441\u043f\u0438\u0441\u043e\u043a \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u043e\u0432 \u0434\u043e\u043c\u0435\u043d\u0430 \u0432 \u0441\u0430\u0439\u0442\u0435 (\u0432 \u0440\u0430\u0437\u0434\u0435\u043b\u0435 _tcp.sitename._sites...). USN (Update Sequence Numbers) - \u0441\u0447\u0435\u0442\u0447\u0438\u043a \u043d\u043e\u043c\u0435\u0440\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \u0443 \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u043e\u0431\u044a\u0435\u043a\u0442\u0430 AD. \u041f\u0440\u0438 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u044b \u043e\u0431\u043c\u0435\u043d\u0438\u0432\u0430\u044e\u0442\u0441\u044f \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f\u043c\u0438 USN, \u043e\u0431\u044a\u0435\u043a\u0442 \u0441 \u0431\u043e\u043b\u0435\u0435 \u043d\u0438\u0437\u043a\u0438\u043c USN \u0431\u0443\u0434\u0435\u0442 \u043f\u0440\u0438 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0438\u0441\u0430\u043d \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u043c \u0441 \u0431\u043e\u043b\u0435\u0435 \u0432\u044b\u0441\u043e\u043a\u0438\u043c USN. \u041d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u0432 \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430\u0445 - Object (\u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c View - Advanced Features). \u041a\u0430\u0436\u0434\u044b\u0439 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440 \u0434\u043e\u043c\u0435\u043d\u0430 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u044b\u0439 \u0441\u0447\u0435\u0442\u0447\u0438\u043a USN, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043d\u0430\u0447\u0438\u043d\u0430\u0435\u0442 \u043e\u0442\u0441\u0447\u0435\u0442 \u0432 \u043c\u043e\u043c\u0435\u043d\u0442 \u0437\u0430\u043f\u0443\u0441\u043a\u0430 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 Dcpromo \u0438 \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0430\u0435\u0442 \u0443\u0432\u0435\u043b\u0438\u0447\u0438\u0432\u0430\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0432 \u0442\u0435\u0447\u0435\u043d\u0438\u0435 \u0432\u0441\u0435\u0433\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u044f \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0430 \u0434\u043e\u043c\u0435\u043d\u0430. \u0417\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0441\u0447\u0435\u0442\u0447\u0438\u043a\u0430 USN \u0443\u0432\u0435\u043b\u0438\u0447\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u043a\u0430\u0436\u0434\u044b\u0439 \u0440\u0430\u0437, \u043a\u043e\u0433\u0434\u0430 \u043d\u0430 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0435 \u0434\u043e\u043c\u0435\u043d\u0430 \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u044f, \u044d\u0442\u043e \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0438 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f, \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0438\u043b\u0438 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u044f \u043e\u0431\u044a\u0435\u043a\u0442\u0430. Get-ADDomainController -Filter * | % { \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c USN \u043e\u0431\u044a\u0435\u043a\u0442\u0430 \u043d\u0430 \u0432\u0441\u0435\u0445 DC \u0432 \u0434\u043e\u043c\u0435\u043d\u0435 \\ Get-ADUser -Server $_.HostName -Identity support4 -Properties uSNChanged | select SamAccountName,uSNChanged \\ }` dcpromo /forceremoval \u043f\u0440\u0438\u043d\u0443\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442 \u043f\u043e\u043d\u0438\u0436\u0435\u043d\u0438\u0435 \u0432 \u0440\u043e\u043b\u0438 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0430 \u0434\u043e\u043c\u0435\u043d\u0430 \u0434\u043e \u0443\u0440\u043e\u0432\u043d\u044f \u0440\u044f\u0434\u043e\u0432\u043e\u0433\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u0430. \u041f\u043e\u0441\u043b\u0435 \u043f\u043e\u043d\u0438\u0436\u0435\u043d\u0438\u044f \u0440\u043e\u043b\u0438 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0432\u0441\u0435\u0445 \u0441\u0441\u044b\u043b\u043e\u043a \u0432 \u0434\u043e\u043c\u0435\u043d\u0435 \u043d\u0430 \u044d\u0442\u043e\u0442 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440. \u0414\u0430\u043b\u0435\u0435 \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u0442 \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u0432 \u0441\u043e\u0441\u0442\u0430\u0432 \u0434\u043e\u043c\u0435\u043d\u0430, \u0438 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u043e\u0431\u0440\u0430\u0442\u043d\u043e\u0433\u043e \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430, \u0442.\u0435. \u043f\u043e\u0432\u044b\u0448\u0435\u043d\u0438\u0435 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u0434\u043e \u0443\u0440\u043e\u0432\u043d\u044f \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0430 \u0434\u043e\u043c\u0435\u043d\u0430.","title":"ADDomainController"},{"location":"#adcomputer","text":"nltest /DSGETDC:$env:userdnsdomain \u0443\u0437\u043d\u0430\u0442\u044c \u043d\u0430 \u043a\u0430\u043a\u043e\u043c DC \u0430\u0443\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u0446\u0438\u0440\u043e\u0432\u0430\u043d \u0445\u043e\u0441\u0442 (Logon Server) \\ nltest /SC_RESET:$env:userdnsdomain\\srv-dc2.$env:userdnsdomain \u043f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440 \u043d\u0430 \u0434\u0440\u0443\u0433\u043e\u0439 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440 \u0434\u043e\u043c\u0435\u043d\u0430 AD \u0432\u0440\u0443\u0447\u043d\u0443\u044e (The command completed successfully) \\ Get-ADComputer \u2013Identity $env:computername -Properties PasswordLastSet \u0432\u0440\u0435\u043c\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0439 \u0441\u043c\u0435\u043d\u044b \u043f\u0430\u0440\u043e\u043b\u044f \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435 \\ Test-ComputerSecureChannel \u2013verbose \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0434\u043e\u0432\u0435\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u043e\u0442\u043d\u043e\u0448\u0435\u043d\u0438\u044f \u0441 \u0434\u043e\u043c\u0435\u043d\u043e\u043c (\u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043b\u0438 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u0439 \u043f\u0430\u0440\u043e\u043b\u044c \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0430 \u043f\u0430\u0440\u043e\u043b\u044e, \u0445\u0440\u0430\u043d\u044f\u0449\u0435\u043c\u0443\u0441\u044f \u0432 AD) \\ Reset-ComputerMachinePassword -Credential domain\\admin \u043f\u0440\u0438\u043d\u0443\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \\ Netdom ResetPWD /Server:dc-01 /UserD:domain\\admin /PasswordD:* \u0441\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u0445\u044d\u0448 \u043f\u0430\u0440\u043e\u043b\u044f \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0430 \u0432 \u0434\u043e\u043c\u0435\u043d\u0435 (\u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u043d\u0435 \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f) \\ Search-ADAccount -AccountDisabled -ComputersOnly | select Name,LastLogonDate,Enabled \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u043e\u0442\u043a\u043b\u044e\u0447\u0435\u043d\u043d\u044b\u0435 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u044b Get-ADComputer -Filter * -Properties * | select name \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u043e\u0432 \u0432 \u0434\u043e\u043c\u0435\u043d\u0435 (Filter), \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u0432\u0441\u0435 \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430 (Properties) \\ Get-ADComputer -Identity $srv -Properties * | ft Name,LastLogonDate,PasswordLastSet,ms-Mcs-AdmPwd -Autosize \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0433\u043e \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0430 \u0432 AD (Identity) \\ Get-ADComputer -SearchBase \"OU=Domain Controllers,DC=$d1,DC=$d2\" -Filter * -Properties * | ft Name, LastLogonDate, distinguishedName -Autosize \u043f\u043e\u0438\u0441\u043a \u0432 \u0431\u0430\u0437\u0435 \u043f\u043e DN (SearchBase) (Get-ADComputer -Filter {enabled -eq \"true\"}).count \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043e\u0431\u0449\u0435\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0445 (\u043d\u0435\u0437\u0430\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0445) \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u043e\u0432 \\ (Get-ADComputer -Filter {enabled -eq \"true\" -and OperatingSystem -like \"*Windows Server 2016*\"}).count \u043a\u043e\u043b-\u0432\u043e \u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0445 \u043a\u043e\u043f\u044c\u044e\u0442\u0435\u0440\u043e\u0432 \u0441 \u041e\u0421 WS 2016 Get-ADComputer -Filter * -Properties * | select @{Label=\"Ping Status\"; Expression={ \\ $ping = ping -n 1 -w 50 $_.Name \\ if ($ping -match \"TTL\") {\"Online\"} else {\"Offline\"} \\ }}, \\ @{Label=\"Status\"; Expression={ \\ if ($_.Enabled -eq \"True\") {$_.Enabled -replace \"True\",\"Active\"} else {$_.Enabled -replace \"False\",\"Blocked\"} \\ }}, Name, IPv4Address, OperatingSystem, @{Label=\"UserOwner\"; Expression={$_.ManagedBy -replace \"(CN=|,.+)\"} \\ },Created | Out-GridView","title":"ADComputer"},{"location":"#aduser","text":"Get-ADUser -Identity support4 -Properties * \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u043e\u0432 \\ Get-ADUser -Identity support4 -Properties DistinguishedName, EmailAddress, Description \u043f\u0443\u0442\u044c DN, email \u0438 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \\ Get-ADUser -Filter {(Enabled -eq \"True\") -and (mail -ne \"null\")} -Properties mail | ft Name,mail \u0441\u043f\u0438\u0441\u043e\u043a \u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0445 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \u0438 \u0435\u0441\u0442\u044c \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0439 \u044f\u0449\u0438\u043a \\ Get-ADUser -Filter {SamAccountName -like \"*\"} | Measure-Object \u043f\u043e\u0441\u0447\u0438\u0442\u0430\u0442\u044c \u043a\u043e\u043b-\u0432\u043e \u0432\u0441\u0435\u0445 \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u043e\u0432 (Count) \\ Get-ADUser -Filter * -Properties WhenCreated | sort WhenCreated | ft Name, whenCreated \u0434\u0430\u0442\u0430 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f \\ Get-ADUser -Identity support4 -property LockedOut | select samaccountName,Name,Enabled,Lockedout \\ Enabled=True \u0443\u0447\u0435\u0442\u043d\u0430\u044f \u0437\u0430\u043f\u0438\u0441\u044c \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u0430 - \u0434\u0430 \\ Lockedout=False \u0443\u0447\u0435\u0442\u043d\u0430\u044f \u0437\u0430\u043f\u0438\u0441\u044c \u0437\u0430\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u043d\u0430 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u043f\u043e\u043b\u0438\u0442\u0438\u043a\u043e\u0439 \u043f\u0430\u0440\u043e\u043b\u0435\u0439) - \u043d\u0435\u0442 \\ Get-ADUser -Identity support4 | Unlock-ADAccount \u0440\u0430\u0437\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0443\u0447\u0435\u0442\u043d\u0443\u044e \u0437\u0430\u043f\u0438\u0441\u044c \\ Disable-ADAccount -Identity support4 \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0443\u0447\u0435\u0442\u043d\u0443\u044e \u0437\u0430\u043f\u0438\u0441\u044c \\ Enable-ADAccount -Identity support4 \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0443\u0447\u0435\u0442\u043d\u0443\u044e \u0437\u0430\u043f\u0438\u0441\u044c \\ Search-ADAccount -LockedOut \u043d\u0430\u0439\u0442\u0438 \u0432\u0441\u0435 \u0437\u0430\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0435 \u0443\u0447\u0435\u0442\u043d\u044b\u0435 \u0437\u0430\u043f\u0438\u0441\u0438 \\ Search-ADAccount -AccountDisabled | select Name,LastLogonDate,Enabled \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u043e\u0442\u043a\u043b\u044e\u0447\u0435\u043d\u043d\u044b\u0435 \u0443\u0447\u0435\u0442\u043d\u044b\u0435 \u0437\u0430\u043f\u0438\u0441\u0438 \u0441 \u0432\u0440\u0435\u043c\u0435\u043d\u0435\u043c \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u0432\u0445\u043e\u0434\u0430 Get-ADUser -Identity support4 -Properties PasswordLastSet,PasswordExpired,PasswordNeverExpires \\ PasswordLastSet \u0432\u0440\u0435\u043c\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0439 \u0441\u043c\u0435\u043d\u044b \u043f\u0430\u0440\u043e\u043b\u044f \\ PasswordExpired=False \u043f\u0430\u0440\u043e\u043b\u044c \u0438\u0441\u0442\u0435\u043a - \u043d\u0435\u0442 \\ PasswordNeverExpires=True \u0441\u0440\u043e\u043a \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f \u043f\u0430\u0440\u043e\u043b\u044f \u043d\u0435 \u0438\u0441\u0442\u0435\u043a\u0430\u0435\u0442 - \u0434\u0430 \\ Set-ADAccountPassword support4 -Reset -NewPassword (ConvertTo-SecureString -AsPlainText \"password\" -Force -Verbose) \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \u0443\u0447\u0435\u0442\u043d\u043e\u0439 \u0437\u0430\u043f\u0438\u0441\u0438 \\ Set-ADUser -Identity support4 -ChangePasswordAtLogon $True \u0441\u043c\u0435\u043d\u0430 \u043f\u0430\u0440\u043e\u043b\u044f \u043f\u0440\u0438 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u043c \u0432\u0445\u043e\u0434\u0435 \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0443 $day = (Get-Date).adddays(-90) \\ Get-ADUser -filter {(passwordlastset -le $day)} | ft \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043d\u0435 \u043c\u0435\u043d\u044f\u043b\u0438 \u0441\u0432\u043e\u0439 \u043f\u0430\u0440\u043e\u043b\u044c \u0431\u043e\u043b\u044c\u0448\u0435 90 \u0434\u043d\u0435\u0439 $day = (Get-Date).adddays(-30) \\ Get-ADUser -filter {(Created -ge $day)} -Property Created | select Name,Created \u041d\u043e\u0432\u044b\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438 \u0437\u0430 30 \u0434\u043d\u0435\u0439 $day = (Get-Date).adddays(-360) \\ Get-ADUser -Filter {(LastLogonTimestamp -le $day)} -Property LastLogonTimestamp | select Name,SamAccountName,@{n='LastLogonTimestamp';e={[DateTime]::FromFileTime($_.LastLogonTimestamp)}} | sort -Descending LastLogonTimestamp \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043d\u0435 \u043b\u043e\u0433\u0438\u043d\u0438\u043b\u0438\u0441\u044c \u0431\u043e\u043b\u044c\u0448\u0435 360 \u0434\u043d\u0435\u0439. \u0420\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u044f \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u0430 LastLogonTimestamp \u0441\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 \u043e\u0442 9 \u0434\u043e 14 \u0434\u043d\u0435\u0439. \\ | Disable-ADAccount $_.SamAccountName \u0437\u0430\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u0442\u044c \\ -WhatIf \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u044b\u0432\u043e\u0434 \u0431\u0435\u0437 \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0439","title":"ADUser"},{"location":"#adgroupmember","text":"(Get-ADUser -Identity support4 -Properties MemberOf).memberof \u0441\u043f\u0438\u0441\u043e\u043a \u0433\u0440\u0443\u043f\u043f \u0432 \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u0441\u043e\u0441\u0442\u043e\u0438\u0442 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \\ Get-ADGroupMember -Identity \"Domain Admins\" | Select Name,SamAccountName \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \u0432 \u0433\u0440\u0443\u043f\u043f\u0435 \\ Add-ADGroupMember -Identity \"Domain Admins\" -Members support5 \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u0433\u0440\u0443\u043f\u043f\u0443 \\ Remove-ADGroupMember -Identity \"Domain Admins\" -Members support5 -force \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0438\u0437 \u0433\u0440\u0443\u043f\u043f\u044b \\ Get-ADGroup -filter * | where {!($_ | Get-ADGroupMember)} | Select Name \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u0443\u0441\u0442\u044b\u0445 \u0433\u0440\u0443\u043f\u043f (-Not)","title":"ADGroupMember"},{"location":"#adreplication","text":"Get-Command -Module ActiveDirectory -Name *Replication* \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u043a\u043e\u043c\u0430\u043d\u0434\u043b\u0435\u0442\u043e\u0432 \u043c\u043e\u0434\u0443\u043b\u044f \\ Get-ADReplicationFailure -Target dc-01 \u0441\u043f\u0438\u0441\u043e\u043a \u043e\u0448\u0438\u0431\u043e\u043a \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u0441 \u043f\u0430\u0440\u0442\u043d\u0435\u0440\u0430\u043c\u0438 \\ Get-ADReplicationFailure -Target $env:userdnsdomain -Scope Domain \\ Get-ADReplicationPartnerMetadata -Target dc-01 | select Partner,LastReplicationAttempt,LastReplicationSuccess,LastReplicationResult,LastChangeUsn \u0432\u0440\u0435\u043c\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0439 \u0438 \u0432\u0440\u0435\u043c\u044f \u0443\u0441\u043f\u0435\u0448\u043d\u043e\u0439 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u0441 \u043f\u0430\u0440\u0442\u043d\u0435\u0440\u0430\u043c\u0438 \\ Get-ADReplicationUpToDatenessVectorTable -Target dc-01 Update Sequence Number (USN) \u0443\u0432\u0435\u043b\u0438\u0447\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u043a\u0430\u0436\u0434\u044b\u0439 \u0440\u0430\u0437, \u043a\u043e\u0433\u0434\u0430 \u043d\u0430 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0435 \u0434\u043e\u043c\u0435\u043d\u0430 \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u044f (\u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0438 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f, \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0438\u043b\u0438 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u044f \u043e\u0431\u044a\u0435\u043a\u0442\u0430), \u043f\u0440\u0438 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 DC \u043e\u0431\u043c\u0435\u043d\u0438\u0432\u0430\u044e\u0442\u0441\u044f \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f\u043c\u0438 USN, \u043e\u0431\u044a\u0435\u043a\u0442 \u0441 \u0431\u043e\u043b\u0435\u0435 \u043d\u0438\u0437\u043a\u0438\u043c USN \u043f\u0440\u0438 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u0431\u0443\u0434\u0435\u0442 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0438\u0441\u0430\u043d \u0432\u044b\u0441\u043e\u043a\u0438\u043c USN.","title":"ADReplication"},{"location":"#repadmin","text":"repadmin /replsummary \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u0442 \u0432\u0440\u0435\u043c\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0439 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u043d\u0430 \u0432\u0441\u0435\u0445 DC \u043f\u043e \u043d\u0430\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u044e (Source \u0438 Destination) \u0438 \u0438\u0445 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0441 \u0443\u0447\u0435\u0442\u043e\u043c \u043f\u0430\u0440\u0442\u043d\u0435\u0440\u043e\u0432 \\ repadmin /showrepl $srv \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u0442 \u0432\u0441\u0435\u0445 \u043f\u0430\u0440\u0442\u043d\u0435\u0440\u043e\u0432 \u043f\u043e \u0440\u0435\u043f\u043b\u043a\u0430\u0446\u0438\u0438 \u0438 \u0438\u0445 \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043b\u044f \u0432\u0441\u0435\u0445 \u0440\u0430\u0437\u0434\u0435\u043b\u043e\u0432 Naming Contexts (DC=ForestDnsZones, DC=DomainDnsZones, CN=Schema, CN=Configuration) \\ repadmin /replicate $srv2 $srv1 DC=domain,DC=local \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u044e \u0441 $srv1 \u043d\u0430 $srv2 \u0442\u043e\u043b\u044c\u043a\u043e \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u0439 \u0440\u0430\u0437\u0434\u0435\u043b\u0430 \u0434\u043e\u043c\u0435\u043d\u0430 \\ repadmin /SyncAll /AdeP \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u043c\u0435\u0436\u0441\u0430\u0439\u0442\u043e\u0432\u0443\u044e \u0438\u0441\u0445\u043e\u0434\u044f\u0449\u0443\u044e \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u044e \u0432\u0441\u0435\u0445 \u0440\u0430\u0437\u0434\u0435\u043b\u043e\u0432 \u043e\u0442 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u0441\u043e \u0432\u0441\u0435\u043c\u0438 \u043f\u0430\u0440\u0442\u043d\u0435\u0440\u0430\u043c\u0438 \u043f\u043e \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ /A \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0434\u043b\u044f \u0432\u0441\u0435\u0445 \u0440\u0430\u0437\u0434\u0435\u043b\u043e\u0432 NC \\ /d \u0432 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f\u0445 \u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u0446\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u0435\u0440\u0432\u0435\u0440\u044b \u043f\u043e DN (\u0432\u043c\u0435\u0441\u0442\u043e GUID DNS - \u0433\u043b\u043e\u0431\u0430\u043b\u044c\u043d\u044b\u043c \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u043c \u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440\u0430\u043c) \\ /e \u043c\u0435\u0436\u0441\u0430\u0439\u0442\u043e\u0432\u0430\u044f \u0441\u0438\u043d\u0445\u0440\u043e\u043d\u0438\u0437\u0430\u0446\u0438\u044f (\u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \u0441\u0438\u043d\u0445\u0440\u043e\u043d\u0438\u0437\u0438\u0440\u0443\u0435\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u0441 DC \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u0441\u0430\u0439\u0442\u0430) \\ /P \u0438\u0437\u0432\u0435\u0449\u0430\u0442\u044c \u043e\u0431 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f\u0445 \u0441 \u044d\u0442\u043e\u0433\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u0430 (\u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e: \u043e\u043f\u0440\u0430\u0448\u0438\u0432\u0430\u0442\u044c \u043e\u0431 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f\u0445) \\ repadmin /Queue $srv \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u0442 \u043a\u043e\u043b-\u0432\u043e \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 \u0432\u0445\u043e\u0434\u044f\u0449\u0435\u0439 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 (\u043e\u0447\u0435\u0440\u0435\u0434\u044c), \u043a\u043e\u0442\u043e\u0440\u043e\u0435 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c (\u043f\u0440\u0438\u0447\u0438\u043d\u043e\u0439 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u0431\u043e\u043b\u044c\u0448\u043e\u0435 \u043a\u043e\u043b-\u0432\u043e \u043f\u0430\u0440\u0442\u043d\u0435\u0440\u043e\u0432 \u0438\u043b\u0438 \u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 1000 \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 \u0441\u043a\u0440\u0438\u043f\u0442\u043e\u043c) \\ repadmin /showbackup * \u0443\u0437\u043d\u0430\u0442\u044c \u0434\u0430\u0442\u0443 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e Backup Error: 1722 \u0441\u0435\u0440\u0432\u0435\u0440 rpc \u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d (\u043e\u0448\u0438\u0431\u043a\u0430 \u043e\u0442\u043a\u0430\u0442\u0430 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438). \u041f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0438\u043c\u044f \u0434\u043e\u043c\u0435\u043d\u0430 \u0432 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430\u0445 \u0441\u0435\u0442\u0435\u0432\u043e\u0433\u043e \u0430\u0434\u0430\u043f\u0442\u0435\u0440\u0430, \u043f\u0435\u0440\u0432\u044b\u043c \u0434\u043e\u043b\u0436\u0435\u043d \u0438\u0434\u0442\u0438 \u0430\u0434\u0440\u0435\u0441 DNS-\u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u0434\u0440\u0443\u0433\u043e\u0433\u043e \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0430 \u0434\u043e\u043c\u0435\u043d\u0430, \u0432\u0442\u043e\u0440\u044b\u043c \u0441\u0432\u043e\u0439 \u0430\u0434\u0440\u0435\u0441. \\ Get-Service -ComputerName $srv | select name,status | ? name -like \"RpcSs\" \\ Get-Service -ComputerName $srv -Name RpcSs -RequiredServices \u0437\u0430\u0432\u0438\u0441\u0438\u043c\u044b\u0435 \u0441\u043b\u0443\u0436\u0431\u044b \\ \u0417\u0430\u0432\u0438\u0441\u0438\u043c\u044b\u0435 \u0441\u043b\u0443\u0436\u0431\u044b RPC: \\ \"\u0421\u043b\u0443\u0436\u0431\u0430 \u0441\u0432\u0435\u0434\u0435\u043d\u0438\u0439 \u043e \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u043d\u044b\u0445 \u0441\u0435\u0442\u044f\u0445\" - \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u0432\u043a\u043b\u044e\u0447\u0435\u043d \u043e\u0442\u043b\u043e\u0436\u0435\u043d\u043d\u044b\u0439 \u0437\u0430\u043f\u0443\u0441\u043a. \u0415\u0441\u043b\u0438 \u0441\u043b\u0443\u0436\u0431\u0430 \u0441\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u0435\u0442 \u0434\u043e \"\u0441\u043b\u0443\u0436\u0431\u044b \u0441\u043f\u0438\u0441\u043a\u0430 \u0441\u0435\u0442\u0435\u0439\", \u043c\u043e\u0436\u0435\u0442 \u043f\u0430\u0434\u0430\u0442\u044c \u0441\u0432\u044f\u0437\u044c \u0441 \u0434\u043e\u043c\u0435\u043d\u043e\u043c (netlogon) \\ \"\u0426\u0435\u043d\u0442\u0440 \u0440\u0430\u0441\u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u043a\u043b\u044e\u0447\u0435\u0439 Kerberos\" \\ \"DNS-\u0441\u0435\u0440\u0432\u0435\u0440\" \\ nslookup $srv \\ tnc $srv -p 135 \\ repadmin /retry \u043f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u044c \u043f\u043e\u043f\u044b\u0442\u043a\u0443 \u043f\u0440\u0438\u0432\u044f\u0437\u043a\u0438 \u043a \u0446\u0435\u043b\u0435\u0432\u043e\u043c\u0443 DC, \u0435\u0441\u043b\u0438 \u0431\u044b\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430 1722 \u0438\u043b\u0438 1753 (RPC \u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d) repadmin /showrepl $srv \\ Last attempt @ 2022-07-15 10:46:01 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0430 \u0441 \u043e\u0448\u0438\u0431\u043a\u043e\u0439, \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 8456 (0x2108) \u043f\u0440\u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 showrepl \u044d\u0442\u043e\u0433\u043e \u043f\u0430\u0440\u0442\u043d\u0435\u0440\u0430, \u0435\u0433\u043e \u043e\u0448\u0438\u0431\u043a\u0430: 8457 (0x2109) \\ Last success @ 2022-07-11 02:29:46 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0439 \u0443\u0441\u043f\u0435\u0445 \\ \u041a\u043e\u0433\u0434\u0430 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u044f \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u043e\u0442\u043a\u043b\u044e\u0447\u0435\u043d\u0430, \u041e\u0421 \u0437\u0430\u043f\u0438\u0441\u044b\u0432\u0430\u0435\u0442 \u0432 DSA - not writable \u043e\u0434\u043d\u043e \u0438\u0437 \u0447\u0435\u0442\u044b\u0440\u0435\u0445 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439: \\ Path: HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Services\\NTDS\\Parameters \\ Dsa Not Writable \\ #define DSA_WRITABLE_GEN 1 \u0432\u0435\u0440\u0441\u0438\u044f \u043b\u0435\u0441\u0430 \u043d\u0435\u0441\u043e\u0432\u043c\u0435\u0441\u0442\u0438\u043c\u0430 \u0441 \u041e\u0421 \\ #define DSA_WRITABLE_NO_SPACE 2 \u043d\u0430 \u0434\u0438\u0441\u043a\u0435, \u0433\u0434\u0435 \u0440\u0430\u0437\u043c\u0435\u0449\u0435\u043d\u0430 \u0431\u0430\u0437\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 Active Directory \u0438\u043b\u0438 \u0444\u0430\u0439\u043b\u044b \u0436\u0443\u0440\u043d\u0430\u043b\u043e\u0432 (\u043b\u043e\u0433\u0438), \u043d\u0435\u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u043e \u0441\u0432\u043e\u0431\u043e\u0434\u043d\u043e\u0433\u043e \u043c\u0435\u0441\u0442\u0430 \\ #define DSA_WRITABLE_USNROLLBCK 4 \u043e\u0442\u043a\u0430\u0442 USN \u043f\u0440\u043e\u0438\u0437\u043e\u0448\u0435\u043b \u0438\u0437-\u0437\u0430 \u043d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u0433\u043e \u043e\u0442\u043a\u0430\u0442\u0430 \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 Active Directory \u0432\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438 (\u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0438\u0437 \u0441\u043d\u0430\u043f\u0448\u043e\u0442\u0430) \\ #define DSA_WRITABLE_CORRUPT_UTDV 8 \u0432\u0435\u043a\u0442\u043e\u0440 \u0430\u043a\u0442\u0443\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u0438 \u043f\u043e\u0432\u0440\u0435\u0436\u0434\u0435\u043d \u043d\u0430 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u043e\u043c \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0435 \u0434\u043e\u043c\u0435\u043d\u0430","title":"repadmin"},{"location":"#dcdiag","text":"dcdiag /s:<DomainController> [/n:<NamingContext>] [[/u:<domain\\user>] [/p:<password>]] [{/a|/e}{/q|/v}] [/f:<LogFile>] [/ferr:<ErrorLog>] [/test:<test>] [/fix] \\ dcdiag /Test:replications /s:dc-01 \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u0442 \u043e\u0448\u0438\u0431\u043a\u0438 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ dcdiag /Test:DNS /e /v /q \u0442\u0435\u0441\u0442 DNS \\ /a \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0432\u0441\u0435\u0445 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u0432 \u0434\u0430\u043d\u043d\u043e\u0433\u043e \u0441\u0430\u0439\u0442\u0430 \\ /e \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0432\u0441\u0435\u0445 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u0432 \u043f\u0440\u0435\u0434\u043f\u0440\u0438\u044f\u0442\u0438\u044f \\ /q \u0432\u044b\u0432\u043e\u0434\u0438\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u043e\u0431 \u043e\u0448\u0438\u0431\u043a\u0430\u0445 \\ /v \u0432\u044b\u0432\u043e\u0434\u0438\u0442\u044c \u043f\u043e\u0434\u0440\u043e\u0431\u043d\u0443\u044e \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \\ /fix \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u0438\u0441\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u043e\u0448\u0438\u0431\u043a\u0438 \\ /test: \\ NetLogons \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u043f\u0440\u0430\u0432 \u043d\u0430 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Connectivity \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044e DNS \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0430 \u0434\u043e\u043c\u0435\u043d\u0430, \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u0442\u0435\u0441\u0442\u043e\u0432\u044b\u0439 \u044d\u0445\u043e-\u043f\u0430\u043a\u0435\u0442 \u043d\u0430 \u043a\u0430\u0436\u0434\u044b\u0439 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440 \u0434\u043e\u043c\u0435\u043d\u0430 \u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u043f\u043e \u043f\u0440\u043e\u0442\u043e\u043a\u043e\u043b\u0430\u043c LDAP \u0438 RPC \u043a \u043a\u0430\u0436\u0434\u043e\u043c\u0443 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0443 \u0434\u043e\u043c\u0435\u043d\u0430 \\ Services \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u0440\u0430\u0431\u043e\u0442\u043e\u0441\u043f\u043e\u0441\u043e\u0431\u043d\u043e\u0441\u0442\u044c \u0432\u0441\u0435\u0445 \u0441\u043b\u0443\u0436\u0431, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u044b\u0445 \u0434\u043b\u044f \u0440\u0430\u0431\u043e\u0442\u044b \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0430 \u0434\u043e\u043c\u0435\u043d\u0430, \u043d\u0430 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u043c \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0435 \u0434\u043e\u043c\u0435\u043d\u0430 \\ Systemlog \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u043e\u0448\u0438\u0431\u043e\u043a \u0432 \u0436\u0443\u0440\u043d\u0430\u043b\u0430\u0445 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0430 \u0434\u043e\u043c\u0435\u043d\u0430 \\ FRSEvent \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u043e\u0448\u0438\u0431\u043a\u0438 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u0432 \u0440\u0430\u0431\u043e\u0442\u0435 \u0441\u043b\u0443\u0436\u0431\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u0444\u0430\u0439\u043b\u043e\u0432, \u0447\u0442\u043e \u043c\u043e\u0436\u0435\u0442 \u043e\u0437\u043d\u0430\u0447\u0430\u0442\u044c \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u043f\u0440\u043e\u0431\u043b\u0435\u043c \u0432 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 SYSVOL \u0438, \u0442\u0430\u043a\u0438\u043c \u043e\u0431\u0440\u0430\u0437\u043e\u043c, \u0446\u0435\u043b\u043e\u0441\u0442\u043d\u043e\u0441\u0442\u0438 \u043a\u043e\u043f\u0438\u0439 \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 \u0433\u0440\u0443\u043f\u043f\u043e\u0432\u044b\u0445 \u043f\u043e\u043b\u0438\u0442\u0438\u043a \\ FSMOCheck \u043d\u0435 \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u0440\u043e\u043b\u0438 \u0445\u043e\u0437\u044f\u0435\u0432 \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0439, \u0430 \u0432\u043c\u0435\u0441\u0442\u043e \u044d\u0442\u043e\u0433\u043e \u0437\u0430\u043f\u0440\u0430\u0448\u0438\u0432\u0430\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\u0440 \u0433\u043b\u043e\u0431\u0430\u043b\u044c\u043d\u043e\u0433\u043e \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0430, \u043f\u0435\u0440\u0432\u0438\u0447\u043d\u044b\u0439 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440 \u0434\u043e\u043c\u0435\u043d\u0430, \u043f\u0440\u0435\u0434\u043f\u043e\u0447\u0442\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u0441\u0435\u0440\u0432\u0435\u0440 \u0432\u0440\u0435\u043c\u0435\u043d\u0438, \u0441\u0435\u0440\u0432\u0435\u0440 \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0438 \u0446\u0435\u043d\u0442\u0440 \u0440\u0430\u0441\u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u043a\u043b\u044e\u0447\u0435\u0439 (\u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440 \u0434\u043e\u043c\u0435\u043d\u0430 \u043c\u043e\u0436\u0435\u0442 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f \u043a KDC, PDC, \u0441\u0435\u0440\u0432\u0435\u0440\u0443 \u0433\u043b\u043e\u0431\u0430\u043b\u044c\u043d\u043e\u0433\u043e \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0430) \\ KnowsOfRoleHolders \u043fg\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u044c \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u043e\u0432 \u0434\u043e\u043c\u0435\u043d\u0430 \u043a\u043e \u0432\u0441\u0435\u043c \u043f\u044f\u0442\u0438 \u0445\u043e\u0437\u044f\u0435\u0432\u0430\u043c \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0439 (\u0440\u043e\u043b\u044f\u043c\u0438 FSMO) \\ MachineAccount \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u0443\u0447\u0435\u0442\u043d\u043e\u0439 \u0437\u0430\u043f\u0438\u0441\u0438 \u0446\u0435\u043b\u0435\u0432\u043e\u0433\u043e \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0430 \u0438 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u043e\u0431\u044a\u044f\u0432\u043b\u0435\u043d\u0438\u0439 \u0441\u043b\u0443\u0436\u0431 \u044d\u0442\u043e\u0433\u043e \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0430 (\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e\u0441\u0442\u044c \u0434\u043e\u0432\u0435\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u043e\u0442\u043d\u043e\u0448\u0435\u043d\u0438\u044f \u0441 \u0434\u043e\u043c\u0435\u043d\u043e\u043c). \u0415\u0441\u043b\u0438 \u043e\u0431\u043d\u0430\u0440\u0443\u0436\u0435\u043d\u0430 \u043e\u0448\u0438\u0431\u043a\u0430, \u0435\u0435 \u043c\u043e\u0436\u043d\u043e \u0438\u0441\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0443\u0442\u0438\u043b\u0438\u0442\u044b dcdiag, \u0443\u043a\u0430\u0437\u0430\u0432 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b /fixmachineaccount \u0438\u043b\u0438 /recreatemachineaccount \\ Advertising \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442, \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e \u043b\u0438 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440 \u0434\u043e\u043c\u0435\u043d\u0430 \u0441\u043e\u043e\u0431\u0449\u0430\u0435\u0442 \u043e \u0441\u0435\u0431\u0435 \u0438 \u043e \u0441\u0432\u043e\u0435\u0439 \u0440\u043e\u043b\u0438 \u0445\u043e\u0437\u044f\u0438\u043d\u0430 \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0439. \u042d\u0442\u043e\u0442 \u0442\u0435\u0441\u0442 \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c\u0441\u044f \u043d\u0435\u0443\u0434\u0430\u0447\u043d\u043e, \u0435\u0441\u043b\u0438 \u0441\u043b\u0443\u0436\u0431\u0430 NetLogon \u043d\u0435 \u0437\u0430\u043f\u0443\u0449\u0435\u043d\u0430 \\ CheckSDRefDom \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0434\u043e\u043c\u0435\u043d\u043e\u0432 \u0441\u0441\u044b\u043b\u043e\u043a \u0434\u0435\u0441\u043a\u0440\u0438\u043f\u0442\u043e\u0440\u043e\u0432 \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u0438 \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0440\u0430\u0437\u0434\u0435\u043b\u0430 \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u043e\u0432 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c \\ CrossRefValidation \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u043f\u0435\u0440\u0435\u043a\u0440\u0435\u0441\u0442\u043d\u044b\u0445 \u0441\u0441\u044b\u043b\u043e\u043a \u0434\u043b\u044f \u0434\u043e\u043c\u0435\u043d\u043e\u0432 \\ RRSSysvol \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0433\u043e\u0442\u043e\u0432\u043d\u043e\u0441\u0442\u0438 \u0434\u043b\u044f FRS SYSVOL \\ Intersite \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u043e\u0448\u0438\u0431\u043e\u043a, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043c\u043e\u0433\u0443\u0442 \u043f\u043e\u043c\u0435\u0448\u0430\u0442\u044c \u043d\u043e\u0440\u043c\u0430\u043b\u044c\u043d\u043e\u0439 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u043c\u0435\u0436\u0434\u0443 \u0441\u0430\u0439\u0442\u0430\u043c\u0438. \u041a\u043e\u043c\u043f\u0430\u043d\u0438\u044f Microsoft \u043f\u0440\u0435\u0434\u0443\u043f\u0440\u0435\u0436\u0434\u0430\u0435\u0442, \u0447\u0442\u043e \u0438\u043d\u043e\u0433\u0434\u0430 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b \u044d\u0442\u043e\u0433\u043e \u0442\u0435\u0441\u0442\u0430 \u043c\u043e\u0433\u0443\u0442 \u043e\u043a\u0430\u0437\u0430\u0442\u044c\u0441\u044f \u043d\u0435\u0442\u043e\u0447\u043d\u044b\u043c\u0438 \\ KCCEvent \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u0431\u0435\u0437\u043e\u0448\u0438\u0431\u043e\u0447\u043d\u043e\u0441\u0442\u044c \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0439 \u0434\u043b\u044f \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u043c\u0435\u0436\u0434\u0443 \u0441\u0430\u0439\u0442\u0430\u043c\u0438 \\ NCSecDesc \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u0439 \u0434\u043b\u044f \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u0432 \u0434\u0435\u0441\u043a\u0440\u0438\u043f\u0442\u043e\u0440\u0430\u0445 \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u0438 \u0434\u043b\u044f \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u043e\u0432 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u0430 \u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u044f \\ ObjectsReplicated \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u0430\u0433\u0435\u043d\u0442\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u043e\u0432 \u0438 \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 \u0443\u0447\u0435\u0442\u043d\u044b\u0445 \u0437\u0430\u043f\u0438\u0441\u0435\u0439 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u043e\u0432 \\ OutboundSecureChannels \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442\u0441\u044f \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u044b\u0445 \u043a\u0430\u043d\u0430\u043b\u043e\u0432 \u043c\u0435\u0436\u0434\u0443 \u0432\u0441\u0435\u043c\u0438 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0430\u043c\u0438 \u0434\u043e\u043c\u0435\u043d\u0430 \u0432 \u0438\u043d\u0442\u0435\u0440\u0435\u0441\u0443\u044e\u0449\u0435\u043c \u0434\u043e\u043c\u0435\u043d\u0435 \\ Replications \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u044c \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u043c\u0435\u0436\u0434\u0443 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0430\u043c\u0438 \u0434\u043e\u043c\u0435\u043d\u0430 \u0438 \u0441\u043e\u043e\u0431\u0449\u0430\u0435\u0442 \u043e\u0431\u043e \u0432\u0441\u0435\u0445 \u043e\u0448\u0438\u0431\u043a\u0430\u0445 \u043f\u0440\u0438 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ RidManager \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u0440\u0430\u0431\u043e\u0442\u043e\u0441\u043f\u043e\u0441\u043e\u0431\u043d\u043e\u0441\u0442\u044c \u0438 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u043e\u0441\u0442\u044c \u0445\u043e\u0437\u044f\u0438\u043d\u0430 \u043e\u0442\u043d\u043e\u0441\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440\u043e\u0432 \\ VerifyEnterpriseReferences \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u044b\u0445 \u0441\u0441\u044b\u043b\u043e\u043a \u0441\u043b\u0443\u0436\u0431\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u0444\u0430\u0439\u043b\u043e\u0432 \u0434\u043b\u044f \u0432\u0441\u0435\u0445 \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 \u043d\u0430 \u0432\u0441\u0435\u0445 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0430\u0445 \u0434\u043e\u043c\u0435\u043d\u0430 \u0432 \u043b\u0435\u0441\u0443 \\ VerifyReferences \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u044b\u0445 \u0441\u0441\u044b\u043b\u043e\u043a \u0441\u043b\u0443\u0436\u0431\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u0444\u0430\u0439\u043b\u043e\u0432 \u0434\u043b\u044f \u0432\u0441\u0435\u0445 \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 \u043d\u0430 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u043c \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0435 \u0434\u043e\u043c\u0435\u043d\u0430 \\ VerifyReplicas \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0432\u0441\u0435\u0445 \u0440\u0430\u0437\u0434\u0435\u043b\u043e\u0432 \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0430 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f \u043d\u0430 \u0432\u0441\u0435\u0445 \u0441\u0435\u0440\u0432\u0435\u0440\u0430\u0445, \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u044e\u0449\u0438\u0445 \u0443\u0447\u0430\u0441\u0442\u0438\u0435 \u0432 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438","title":"dcdiag"},{"location":"#ntdsutil","text":"\u041f\u0435\u0440\u0435\u043d\u043e\u0441 \u0411\u0414 AD (ntds.dit): \\ Get-Acl C:\\Windows\\NTDS | Set-Acl D:\\AD-DB \u0441\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c NTFS \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u044f \u043d\u0430 \u043d\u043e\u0432\u044b\u0439 \u043a\u0430\u0442\u0430\u043b\u043e\u0433 \\ Stop-Service -ComputerName dc -name NTDS \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0441\u043b\u0443\u0436\u0431\u0443 Active Directory Domain Services \\ ntdsutil \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0443\u0442\u0438\u043b\u0438\u0442\u0443 ntdsutil \\ activate instance NTDS \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0439 \u044d\u043a\u0437\u0435\u043c\u043f\u043b\u044f\u0440 \u0431\u0430\u0437\u044b AD \\ files \u043f\u0435\u0440\u0435\u0439\u0434\u0435\u043c \u0432 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442 files, \u0432 \u043a\u043e\u0442\u043e\u0440\u043e\u043c \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u044f \u0441 \u0444\u0430\u0439\u043b\u0430\u043c\u0438 \u0431\u0430\u0437\u044b ntds.dit \\ move DB to D:\\AD-DB\\ \u043f\u0435\u0440\u0435\u043d\u0435\u0441\u0442\u0438 \u0431\u0430\u0437\u0443 AD \u0432 \u043d\u043e\u0432\u044b\u0439 \u043a\u0430\u0442\u0430\u043b\u043e\u0433 (\u043f\u0440\u0435\u0434\u0432\u0430\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u043d\u0443\u0436\u043d\u043e \u0435\u0433\u043e \u0441\u043e\u0437\u0434\u0430\u0442\u044c) \\ info \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c, \u0447\u0442\u043e \u0411\u0414 \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u0432 \u043d\u043e\u0432\u043e\u043c \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0435 \\ move logs to D:\\AD-DB\\ \u043f\u0435\u0440\u0435\u043c\u0435\u0441\u0442\u0438\u043c \u0432 \u0442\u043e\u0442 \u0436\u0435 \u043a\u0430\u0442\u0430\u043b\u043e\u0433 \u0444\u0430\u0439\u043b\u044b \u0441 \u0436\u0443\u0440\u043d\u0430\u043b\u0430\u043c\u0438 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439 \\ quit \\ Start-Service -ComputerName dc -name NTDS \u0421\u0431\u0440\u043e\u0441 \u043f\u0430\u0440\u043e\u043b\u044f DSRM (\u0440\u0435\u0436\u0438\u043c \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0441\u043b\u0443\u0436\u0431 \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u043e\u0432): \\ ntdsutil \\ set dsrm password \\ reset password on server NULL \\ \u043d\u043e\u0432\u044b\u0439 \u043f\u0430\u0440\u043e\u043b\u044c \\ \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u0435 \u043f\u0430\u0440\u043e\u043b\u044f \\ quit \\ quit \u0421\u0438\u043d\u0445\u0440\u043e\u043d\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441 \u043f\u0430\u0440\u043e\u043b\u0435\u043c \u0423\u0417 \u0432 AD: \\ ntdsutil \\ set dsrm password \\ sync from domain account dsrmadmin \\ quit \\ quit \u041e\u0448\u0438\u0431\u043a\u0430 0x00002e2 \u043f\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0435 \u041e\u0421. \\ \u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c\u0441\u044f \u0432 \u0440\u0435\u0436\u0438\u043c\u0435 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0435\u043d\u0438\u044f WinRE (Windows Recovery Environment) - Startup Settings - Restart - DSRM (Directory Services Restore Mode) \\ reagentc /boottore shutdown /f /r /o /t 0 \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0432 \u0440\u0435\u0436\u0438\u043c\u0435 WinRE - \u041e\u0421 \u043d\u0430 \u0431\u0430\u0437\u0435 WinPE (Windows Preinstallation Environment), \u043e\u0431\u0440\u0430\u0437 winre.wim \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u043d\u0430 \u0441\u043a\u0440\u044b\u0442\u043e\u043c \u0440\u0430\u0437\u0434\u0435\u043b\u0435 System Restore \\ \u041d\u0430 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0435 \u0434\u043e\u043c\u0435\u043d\u0430 \u0435\u0434\u0438\u043d\u0441\u0442\u0432\u0435\u043d\u043d\u0430\u044f \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u0430\u044f \u0443\u0447\u0435\u0442\u043d\u0430\u044f \u0437\u0430\u043f\u0438\u0441\u044c \u2014 \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440 DSRM. \u041f\u0430\u0440\u043e\u043b\u044c \u0441\u043e\u0437\u0434\u0430\u0435\u0442\u0441\u044f \u043f\u0440\u0438 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0435 \u0440\u043e\u043b\u0438 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0430 \u0434\u043e\u043c\u0435\u043d\u0430 ADDS \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435 (SafeModeAdministratorPassword). \\ ntdsutil \\ activate instance ntds \\ Files \\ Info \\ integrity \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0446\u0435\u043b\u043e\u0441\u0442\u043d\u043e\u0441\u0442\u044c \u0411\u0414 \\ \u041e\u0448\u0438\u0431\u043a\u0430: Failed to open DIT for AD DS/LDS instance NTDS. Error -2147418113 \\ mkdir c:\\ntds_bak \\ xcopy c:\\Windows\\NTDS\\*.* c:\\ntds_bak backup \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0433\u043e \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0430 \u0441 \u0411\u0414 \\ esentutl /g c:\\windows\\ntds\\ntds.dit \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u043c \u0446\u0435\u043b\u043e\u0441\u0442\u043d\u043e\u0441\u0442\u044c \u0444\u0430\u0439\u043b\u0430 \\ \u0412\u044b\u0432\u043e\u0434: Integrity check completed. Database is CORRUPTED \u043e\u0448\u0438\u0431\u043a\u0430, \u0431\u0430\u0437\u0430 AD \u043f\u043e\u0432\u0440\u0435\u0436\u0434\u0435\u043d\u0430 \\ esentutl /p c:\\windows\\ntds\\ntds.dit \u0438\u0441\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u043e\u0448\u0438\u0431\u043a\u0438 \\ \u0412\u044b\u0432\u043e\u0434: Operation completed successfully in xx seconds. \u043d\u0435\u0442 \u043e\u0448\u0438\u0431\u043e\u043a \\ esentutl /g c:\\windows\\ntds\\ntds.dit \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u043c \u0446\u0435\u043b\u043e\u0441\u0442\u043d\u043e\u0441\u0442\u044c \u0444\u0430\u0439\u043b\u0430 \\ \u0412\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0430\u043d\u0430\u043b\u0438\u0437 \u0441\u0435\u043c\u0430\u043d\u0442\u0438\u043a\u0438 \u0431\u0430\u0437\u044b \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e ntdsutil: \\ ntdsutil \\ activate instance ntds \\ semantic database analysis \\ go \\ go fixup \u0438\u0441\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0441\u0435\u043c\u0430\u043d\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u043e\u0448\u0438\u0431\u043a\u0438 \\ \u0421\u0436\u0430\u0442\u044c \u0444\u0430\u0439\u043b \u0411\u0414: \\ activate instance ntds \\ files \\ compact to C:\\Windows\\NTDS\\TEMP \\ copy C:\\Windows\\NTDS\\TEMP\\ntds.dit C:\\Windows\\NTDS\\ntds.dit \u0437\u0430\u043c\u0435\u043d\u0438\u0442\u044c \u043e\u0440\u0438\u0433\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u0439 \u0444\u0430\u0439\u043b ntds.dit \\ Del C:\\Windows\\NTDS\\*.log \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u0441\u0435 \u043b\u043e\u0433 \u0444\u0430\u0439\u043b\u044b \u0438\u0437 \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0430 NTDS","title":"ntdsutil"},{"location":"#gpo","text":"Get-Command -Module GroupPolicy \\ Get-GPO -Domain domain.local -All | ft \\ Get-GPO -Name LAPS \\ [xml](Get-GPOReport LAPS -ReportType Xml) \\ Get-GPPermission -Name LAPS -All \\ Get-GPO LAPS | New-GPLink -Target \"ou=servers,dc=domain,dc=local\" \\ Set-GPLink -Name LAPS -Target \"ou=servers,dc=domain,dc=local\" -LinkEnabled No \\ Backup-GPO -Name LAPS -Path \"$home\\Desktop\" \\ Backup-GPO -All -Path \"$home\\Desktop\" \\ Restore-GPO -Name LAPS -Path C:\\Backup\\GPOs\\","title":"GPO"},{"location":"#servermanager","text":"Get-Command *WindowsFeature* source module ServerManager \\ Get-WindowsFeature -ComputerName \"localhost\" \\ Get-WindowsFeature | where Installed -eq $True \u0441\u043f\u0438\u0441\u043e\u043a \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044b\u0445 \u0440\u043e\u043b\u0435\u0439 \u0438 \u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u043e\u0432 \\ Get-WindowsFeature | where FeatureType -eq \"Role\" \u043e\u0442\u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u043e \u0441\u043f\u0438\u0441\u043a\u0443 \u0440\u043e\u043b\u0435\u0439 \\ Install-WindowsFeature -Name DNS \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0440\u043e\u043b\u044c \\ Get-Command *DNS* \\ Get-DnsServerSetting -ALL \\ Uninstall-WindowsFeature -Name DNS \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0440\u043e\u043b\u044c","title":"ServerManager"},{"location":"#pswa","text":"Install-WindowsFeature -Name WindowsPowerShellWebAccess -IncludeManagementTools \\ Install-PswaWebApplication -UseTestCertificate \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0432\u0435\u0431-\u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435 /pswa \\ Add-PswaAuthorizationRule -UserGroupName \"$domain\\Domain Admins\" -ComputerName * -ConfigurationName * -RuleName \"For Admins\" \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043f\u0440\u0430\u0432\u0430 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438","title":"PSWA"},{"location":"#wsb-windows-server-backup","text":"\u041f\u0440\u0438 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0438 backup DC \u0447\u0435\u0440\u0435\u0437 WSB, \u0441\u043e\u0437\u0434\u0430\u0435\u0442\u0441\u044f \u043a\u043e\u043f\u0438\u044f \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f \u0441\u0438\u0441\u0442\u0435\u043c\u044b (System State), \u043a\u0443\u0434\u0430 \u043f\u043e\u043f\u0430\u0434\u0430\u0435\u0442 \u0431\u0430\u0437\u0430 AD (NTDS.DIT), \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u0433\u0440\u0443\u043f\u043f\u043e\u0432\u044b\u0445 \u043f\u043e\u043b\u0438\u0442\u0438\u043a, \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0430 SYSVOL, \u0440\u0435\u0435\u0441\u0442\u0440, \u043c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u0435 IIS, \u0431\u0430\u0437\u0430 AD CS, \u0438 \u0434\u0440\u0443\u0433\u0438\u0435 \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u044b\u0435 \u0444\u0430\u0439\u043b\u044b \u0438 \u0440\u0435\u0441\u0443\u0440\u0441\u044b. \u0420\u0435\u0437\u0435\u0440\u0432\u043d\u0430\u044f \u043a\u043e\u043f\u0438\u044f \u0441\u043e\u0437\u0434\u0430\u0435\u0442\u0441\u044f \u0447\u0435\u0440\u0435\u0437 \u0441\u043b\u0443\u0436\u0431\u0443 \u0442\u0435\u043d\u0435\u0432\u043e\u0433\u043e \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f VSS. \\ Get-WindowsFeature Windows-Server-Backup \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0430 \u043b\u0438 \u0440\u043e\u043b\u044c \\ Add-Windowsfeature Windows-Server-Backup \u2013Includeallsubfeature \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0440\u043e\u043b\u044c $path=\"\\\\$srv\\bak-dc\\dc-03\\\" [string]$TargetUNC=$path+(get-date -f 'yyyy-MM-dd') if ((Test-Path -Path $path) -eq $true) {New-Item -Path $TargetUNC -ItemType directory} # \u0435\u0441\u043b\u0438 \u043f\u0443\u0442\u044c \u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d, \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043d\u043e\u0432\u0443\u044e \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u044e \u043f\u043e \u0434\u0430\u0442\u0435 $WBadmin_cmd = \"wbadmin.exe START BACKUP -backupTarget:$TargetUNC -systemState -noverify -vssCopy -quiet\" # $WBadmin_cmd = \"wbadmin start backup -backuptarget:$path -include:C:\\Windows\\NTDS\\ntds.dit -quiet\" # Backup DB NTDS Invoke-Expression $WBadmin_cmd","title":"WSB (Windows Server Backup)"},{"location":"#rds","text":"Get-Command -Module RemoteDesktop \\ Get-RDServer -ConnectionBroker $broker \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u0432 \u0432 \u0444\u0435\u0440\u043c\u0435\u044b, \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u043f\u043e\u043b\u043d\u043e\u0435 \u0434\u043e\u043c\u0435\u043d\u043d\u043e\u0435 \u0438\u043c\u044f \u043f\u0440\u0438 \u043e\u0431\u0440\u0430\u0449\u0435\u043d\u0438\u0435 \u043a \u0441\u0435\u0440\u0432\u0435\u0440\u0443 \u0441 \u0440\u043e\u043b\u044c\u044e RDCB \\ Get-RDRemoteDesktop -ConnectionBroker $broker \u0441\u043f\u0438\u0441\u043e\u043a \u043a\u043e\u043b\u043b\u0435\u043a\u0446\u0438\u0439 \\ (Get-RDLicenseConfiguration -ConnectionBroker $broker | select *).LicenseServer \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u0432 \u0441 \u0440\u043e\u043b\u044c\u044e RDL \\ Get-RDUserSession -ConnectionBroker $broker \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0445 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \\ Disconnect-RDUser -HostServer $srv -UnifiedSessionID $id -Force \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0441\u0435\u0441\u0441\u0438\u044e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \\ Get-RDAvailableApp -ConnectionBroker $broker -CollectionName C03 \u0441\u043f\u0438\u0441\u043e\u043a \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u043e\u0433\u043e \u041f\u041e \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430\u0445 \u0432 \u043a\u043e\u043b\u043b\u0435\u043a\u0446\u0438\u0438 \\ (Get-RDSessionCollectionConfiguration -ConnectionBroker $broker -CollectionName C03 | select *).CustomRdpProperty use redirection server name:i:1 \\ Get-RDConnectionBrokerHighAvailability","title":"RDS"},{"location":"#dnsserver","text":"Get-Command -Module DnsServer \\ Show-DnsServerCache \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0435\u0441\u044c \u043a\u044d\u0448 DNS-\u0441\u0435\u0440\u0432\u0435\u0440\u0430 \\ Show-DnsServerCache | where HostName -match ru \\ Clear-DnsServerCache \\ Get-DnsServerCache \\ Get-DnsServerDiagnostics $zone = icm $srv {Get-DnsServerZone} | select ZoneName,ZoneType,DynamicUpdate,ReplicationScope,SecureSecondaries, DirectoryPartitionName | Out-GridView -Title \"DNS Server: $srv\" \u2013PassThru $zone_name = $zone.ZoneName if ($zone_name -ne $null) { icm $srv {Get-DnsServerResourceRecord -ZoneName $using:zone_name | sort RecordType | select RecordType,HostName, @{ Label=\"IPAddress\"; Expression={$_.RecordData.IPv4Address.IPAddressToString}},TimeToLive,Timestamp } | select RecordType,HostName,IPAddress,TimeToLive,Timestamp | Out-GridView -Title \"DNS Server: $srv\" } Sync-DnsServerZone \u2013passthru \u0441\u0438\u043d\u0445\u0440\u043e\u043d\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0437\u043e\u043d\u044b \u0441 \u0434\u0440\u0443\u0433\u0438\u043c\u0438 DC \u0432 \u0434\u043e\u043c\u0435\u043d\u0435 \\ Remove-DnsServerZone -Name domain.local \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0437\u043e\u043d\u0443 \\ Get-DnsServerResourceRecord -ZoneName domain.local -RRType A \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u0432\u0441\u0435 \u0410-\u0437\u0430\u043f\u0438\u0441\u0438 \u0432 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0439 \u0437\u043e\u043d\u0435 \\ Add-DnsServerResourceRecordA -Name new-host-name -IPv4Address 192.168.1.100 -ZoneName domain.local -TimeToLive 01:00:00 -CreatePtr \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0410-\u0437\u0430\u043f\u0438\u0441\u044c \u0438 PTR \u0434\u043b\u044f \u043d\u0435\u0435 \\ Remove-DnsServerResourceRecord -ZoneName domain.local -RRType A -Name new-host-name \u2013Force \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0410-\u0437\u0430\u043f\u0438\u0441\u044c $DNSServer = \"DC-01\" $DNSFZone = \"domain.com\" $DataFile = \"C:\\Scripts\\DNS-Create-A-Records-from-File.csv\" # cat $DataFile # \"HostName;IP\" # \"server-01;192.168.1.10\" $DNSRR = [WmiClass]\"\\\\$DNSServer\\root\\MicrosoftDNS:MicrosoftDNS_ResourceRecord\" $ConvFile = $DataFile + \"_unicode\" Get-Content $DataFile | Set-Content $ConvFile -Encoding Unicode Import-CSV $ConvFile -Delimiter \";\" | ForEach-Object { $FQDN = $_.HostName + \".\" + $DNSFZone $IP = $_.HostIP $TextA = \"$FQDN IN A $IP\" [Void]$DNSRR.CreateInstanceFromTextRepresentation($DNSServer,$DNSFZone,$TextA) }","title":"DNSServer"},{"location":"#dhcpserver","text":"Get-Command -Module DhcpServer $mac = icm $srv -ScriptBlock {Get-DhcpServerv4Scope | Get-DhcpServerv4Lease} | select AddressState, HostName,IPAddress,ClientId,DnsRegistration,DnsRR,ScopeId,ServerIP | Out-GridView -Title \"HDCP Server: $srv\" \u2013PassThru (New-Object -ComObject Wscript.Shell).Popup($mac.ClientId,0,$mac.HostName,64) Add-DhcpServerv4Reservation -ScopeId 192.168.1.0 -IPAddress 192.168.1.10 -ClientId 00-50-56-C0-00-08 -Description \"new reservation\"","title":"DHCPServer"},{"location":"#dfs","text":"dfsutil /root:\\\\domain.sys\\public /export:C:\\export-dfs.txt \u044d\u043a\u0441\u043f\u043e\u0440\u0442 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438 namespace root \\ dfsutil /AddFtRoot /Server:\\\\$srv /Share:public \u043d\u0430 \u043d\u043e\u0432\u043e\u0439 \u043c\u0430\u0448\u0438\u043d\u0435 \u043f\u0440\u0435\u0434\u0432\u0430\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043a\u043e\u0440\u0435\u043d\u044c \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 \u0434\u043e\u043c\u0435\u043d\u0430 \\ dfsutil /root:\\\\domain.sys\\public /import:C:\\export-dfs.txt /<verify /set Import (\u043f\u0435\u0440\u0435\u0434 \u0438\u043c\u043f\u043e\u0440\u0442\u043e\u043c \u0434\u0430\u043d\u043d\u044b\u0445 \u0432 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0439 \u043a\u043e\u0440\u0435\u043d\u044c DFS, \u0443\u0442\u0438\u043b\u0438\u0442\u0430 \u0441\u043e\u0437\u0434\u0430\u0435\u0442 \u0440\u0435\u0437\u0435\u0440\u0432\u043d\u0443\u044e \u043a\u043e\u043f\u0438\u044e \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438 \u043a\u043e\u0440\u043d\u044f \u0432 \u0442\u0435\u043a\u0443\u0449\u0435\u043c \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0435, \u0438\u0437 \u043a\u043e\u0442\u043e\u0440\u043e\u0433\u043e \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u0442\u0441\u044f \u0443\u0442\u0438\u043b\u0438\u0442\u0430 dfsutil) \\ /verify \u0432\u044b\u0432\u043e\u0434\u0438\u0442 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0431\u0443\u0434\u0443\u0442 \u0432\u043d\u0435\u0441\u0435\u043d\u044b \u0432 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0435 \u0438\u043c\u043f\u043e\u0440\u0442\u0430, \u0431\u0435\u0437 \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u044f \\ /set \u043c\u0435\u043d\u044f\u0435\u0442 \u0446\u0435\u043b\u0435\u0432\u043e\u0435 \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u043e \u0438\u043c\u0435\u043d \u043f\u0443\u0442\u0435\u043c \u043f\u043e\u043b\u043d\u043e\u0439 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0438\u0441\u0438 \u0438 \u0437\u0430\u043c\u0435\u043d\u044b \u043d\u0430 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044e \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u0430 \u0438\u043c\u0435\u043d \u0438\u0437 \u0438\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u0443\u0435\u043c\u043e\u0433\u043e \u0444\u0430\u0439\u043b\u0430 \\ /merge \u0438\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u0443\u0435\u0442 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044e \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u0430 \u0438\u043c\u0435\u043d \u0432 \u0434\u043e\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u043a \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0435\u0439 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438 \u0434\u043b\u044f \u0441\u043b\u0438\u044f\u043d\u0438\u044f, \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u0438\u0437 \u0444\u0430\u0439\u043b\u0430 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438 \u0431\u0443\u0434\u0443\u0442 \u0438\u043c\u0435\u0442\u044c \u0431\u043e\u043b\u044c\u0448\u0438\u0439 \u043f\u0440\u0438\u043e\u0440\u0438\u0442\u0435\u0442, \u0447\u0435\u043c \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u0430 \u0438\u043c\u0435\u043d Export-DfsrClone \u044d\u043a\u0441\u043f\u043e\u0440\u0442\u0438\u0440\u0443\u0435\u0442 \u043a\u043b\u043e\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u0443\u044e \u0431\u0430\u0437\u0443 \u0434\u0430\u043d\u043d\u044b\u0445 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 DFS \u0438 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438 \u0442\u043e\u043c\u0430 \\ Get-DfsrCloneState \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0438 \u043a\u043b\u043e\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 \\ Import-DfsrClone \u0438\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u0443\u0435\u0442 \u043a\u043b\u043e\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u0443\u044e \u0431\u0430\u0437\u0443 \u0434\u0430\u043d\u043d\u044b\u0445 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 DFS \u0438 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438 \u0442\u043e\u043c\u0430 net use x: \\\\$srv1\\public\\* \u043f\u0440\u0438\u043c\u043e\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0434\u0438\u0441\u043a \\ Get-DfsrFileHash x:\\* | Out-File C:\\$srv1.txt \u0437\u0430\u0431\u0440\u0430\u0442\u044c hash \u0432\u0441\u0435\u0445 \u0444\u0430\u0439\u043b\u043e\u0432 \u0434\u0438\u0441\u043a\u0430 \u0432 \u0444\u0430\u0439\u043b (\u0444\u0430\u0439\u043b\u044b \u0441 \u043e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u044b\u043c\u0438 \u0445\u0435\u0448\u0430\u043c\u0438 \u0432\u0441\u0435\u0433\u0434\u0430 \u044f\u0432\u043b\u044f\u044e\u0442\u0441\u044f \u0442\u043e\u0447\u043d\u044b\u043c\u0438 \u043a\u043e\u043f\u0438\u044f\u043c\u0438 \u0434\u0440\u0443\u0433 \u0434\u0440\u0443\u0433\u0430) \\ net use x: /d \u043e\u0442\u043c\u043e\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \\ net use x: \\\\$srv2\\public\\* \\ Get-DfsrFileHash x:\\* | Out-File C:\\$srv2.txt \\ net use x: /d \\ Compare-Object -ReferenceObject (Get-Content C:\\$srv1.txt) -DifferenceObject (Get-Content C:\\$srv2.txt) -IncludeEqual \u0441\u0440\u0430\u0432\u043d\u0438\u0442\u044c \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u0444\u0430\u0439\u043b\u043e\u0432 Get-DfsrBacklog -DestinationComputerName \"fs-06\" -SourceComputerName \"fs-05\" -GroupName \"folder-rep\" -FolderName \"folder\" -Verbose \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u0441\u043f\u0438\u0441\u043e\u043a \u043e\u0436\u0438\u0434\u0430\u044e\u0449\u0438\u0445 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0439 \u0444\u0430\u0439\u043b\u043e\u0432 \u043c\u0435\u0436\u0434\u0443 \u0434\u0432\u0443\u043c\u044f \u043f\u0430\u0440\u0442\u043d\u0435\u0440\u0430\u043c\u0438 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 DFS \\ Get-DfsrConnection \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u0442 \u0433\u0440\u0443\u043f\u043f\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438, \u0443\u0447\u0430\u0441\u0442\u043d\u0438\u043a\u043e\u0432 \u0438 \u0441\u0442\u0430\u0442\u0443\u0441 \\ Get-DfsReplicatedFolder \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u0442 \u0438\u043c\u044f \u0438 \u043f\u043e\u043b\u043d\u044b\u0439 \u043f\u0443\u0442\u044c \u043a \u043f\u0430\u043f\u043a\u0430\u043c \u0440\u0435\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435 DFS \\ Get-DfsrState -ComputerName fs-06 -Verbose \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 DFS \u0434\u043b\u044f \u0447\u043b\u0435\u043d\u0430 \u0433\u0440\u0443\u043f\u043f\u044b \\ Get-DfsReplicationGroup \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u0442 \u0433\u0440\u0443\u043f\u043f\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u0438 \u0438\u0445 \u0441\u0442\u0430\u0442\u0443\u0441 \\ Add-DfsrConnection \u0441\u043e\u0437\u0434\u0430\u0435\u0442 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u043c\u0435\u0436\u0434\u0443 \u0447\u043b\u0435\u043d\u0430\u043c\u0438 \u0433\u0440\u0443\u043f\u043f\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Add-DfsrMember \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u044b \u0432 \u0433\u0440\u0443\u043f\u043f\u0443 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ ConvertFrom-DfsrGuid \u043f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u0443\u0435\u0442 \u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440\u044b GUID \u0432 \u043f\u043e\u043d\u044f\u0442\u043d\u044b\u0435 \u0438\u043c\u0435\u043d\u0430 \u0432 \u0437\u0430\u0434\u0430\u043d\u043d\u043e\u0439 \u0433\u0440\u0443\u043f\u043f\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Get-DfsrConnectionSchedule \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u0440\u0430\u0441\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0439 \u043c\u0435\u0436\u0434\u0443 \u0447\u043b\u0435\u043d\u0430\u043c\u0438 \u0433\u0440\u0443\u043f\u043f\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Get-DfsrGroupSchedule \u0438\u0437\u0432\u043b\u0435\u043a\u0430\u0435\u0442 \u0440\u0430\u0441\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u0433\u0440\u0443\u043f\u043f\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Get-DfsrIdRecord \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u0437\u0430\u043f\u0438\u0441\u0438 ID \u0434\u043b\u044f \u0440\u0435\u043f\u043b\u0438\u0446\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0445 \u0444\u0430\u0439\u043b\u043e\u0432 \u0438\u043b\u0438 \u043f\u0430\u043f\u043e\u043a \u0438\u0437 \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 DFS \\ Get-DfsrMember \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u044b \u0432 \u0433\u0440\u0443\u043f\u043f\u0435 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Get-DfsrMembership \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u0447\u043b\u0435\u043d\u0441\u0442\u0432\u0430 \u0434\u043b\u044f \u0447\u043b\u0435\u043d\u043e\u0432 \u0433\u0440\u0443\u043f\u043f \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Get-DfsrPreservedFiles \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u0441\u043f\u0438\u0441\u043e\u043a \u0444\u0430\u0439\u043b\u043e\u0432 \u0438 \u043f\u0430\u043f\u043e\u043a, \u0440\u0430\u043d\u0435\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u043d\u044b\u0445 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0435\u0439 DFS \\ Get-DfsrServiceConfiguration \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u0441\u043b\u0443\u0436\u0431\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 DFS \u0434\u043b\u044f \u0447\u043b\u0435\u043d\u043e\u0432 \u0433\u0440\u0443\u043f\u043f\u044b \\ Grant-DfsrDelegation \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u044f \u0443\u0447\u0430\u0441\u0442\u043d\u0438\u043a\u0430\u043c \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u0438 \u0434\u043b\u044f \u0433\u0440\u0443\u043f\u043f\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Revoke-DfsrDelegation \u043e\u0442\u043c\u0435\u043d\u044f\u0435\u0442 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u044f \u0443\u0447\u0430\u0441\u0442\u043d\u0438\u043a\u043e\u0432 \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u0438 \u0434\u043b\u044f \u0433\u0440\u0443\u043f\u043f\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ New-DfsReplicationGroup \u0441\u043e\u0437\u0434\u0430\u0435\u0442 \u0433\u0440\u0443\u043f\u043f\u0443 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ New-DfsReplicatedFolder \u0441\u043e\u0437\u0434\u0430\u0435\u0442 \u0440\u0435\u043f\u043b\u0438\u0446\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u0443\u044e \u043f\u0430\u043f\u043a\u0443 \u0432 \u0433\u0440\u0443\u043f\u043f\u0435 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Remove-DfsrConnection \u0443\u0434\u0430\u043b\u044f\u0435\u0442 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u043c\u0435\u0436\u0434\u0443 \u0447\u043b\u0435\u043d\u0430\u043c\u0438 \u0433\u0440\u0443\u043f\u043f\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Remove-DfsReplicatedFolder \u0443\u0434\u0430\u043b\u044f\u0435\u0442 \u0440\u0435\u043f\u043b\u0438\u0446\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u0443\u044e \u043f\u0430\u043f\u043a\u0443 \u0438\u0437 \u0433\u0440\u0443\u043f\u043f\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Remove-DfsReplicationGroup \u0443\u0434\u0430\u043b\u044f\u0435\u0442 \u0433\u0440\u0443\u043f\u043f\u0443 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Remove-DfsrMember \u0443\u0434\u0430\u043b\u044f\u0435\u0442 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u044b \u0438\u0437 \u0433\u0440\u0443\u043f\u043f\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Restore-DfsrPreservedFiles \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u0442 \u0444\u0430\u0439\u043b\u044b \u0438 \u043f\u0430\u043f\u043a\u0438, \u0440\u0430\u043d\u0435\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u043d\u044b\u0435 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0435\u0439 DFS \\ Set-DfsrConnection \u0438\u0437\u043c\u0435\u043d\u044f\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f \u043c\u0435\u0436\u0434\u0443 \u0447\u043b\u0435\u043d\u0430\u043c\u0438 \u0433\u0440\u0443\u043f\u043f\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Set-DfsrConnectionSchedule \u0438\u0437\u043c\u0435\u043d\u044f\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u0440\u0430\u0441\u043f\u0438\u0441\u0430\u043d\u0438\u044f \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0439 \u043c\u0435\u0436\u0434\u0443 \u0447\u043b\u0435\u043d\u0430\u043c\u0438 \u0433\u0440\u0443\u043f\u043f\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Set-DfsReplicatedFolder \u0438\u0437\u043c\u0435\u043d\u044f\u0435\u0442 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u0440\u0435\u043f\u043b\u0438\u0446\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0439 \u043f\u0430\u043f\u043a\u0438 \\ Set-DfsReplicationGroup \u0438\u0437\u043c\u0435\u043d\u044f\u0435\u0442 \u0433\u0440\u0443\u043f\u043f\u0443 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Set-DfsrGroupSchedule \u0438\u0437\u043c\u0435\u043d\u044f\u0435\u0442 \u0440\u0430\u0441\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u0433\u0440\u0443\u043f\u043f\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Set-DfsrMember \u0438\u0437\u043c\u0435\u043d\u044f\u0435\u0442 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u043e \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0435-\u0443\u0447\u0430\u0441\u0442\u043d\u0438\u043a\u0435 \u0432 \u0433\u0440\u0443\u043f\u043f\u0435 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Set-DfsrMembership \u043d\u0430\u0441\u0442\u0440\u0430\u0438\u0432\u0430\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u0447\u043b\u0435\u043d\u0441\u0442\u0432\u0430 \u0434\u043b\u044f \u0447\u043b\u0435\u043d\u043e\u0432 \u0433\u0440\u0443\u043f\u043f\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Set-DfsrServiceConfiguration \u0438\u0437\u043c\u0435\u043d\u044f\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u0441\u043b\u0443\u0436\u0431\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 DFS \\ Sync-DfsReplicationGroup \u0441\u0438\u043d\u0445\u0440\u043e\u043d\u0438\u0437\u0438\u0440\u0443\u0435\u0442 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u044e \u043c\u0435\u0436\u0434\u0443 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0430\u043c\u0438 \u043d\u0435\u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e \u043e\u0442 \u0440\u0430\u0441\u043f\u0438\u0441\u0430\u043d\u0438\u044f \\ Suspend-DfsReplicationGroup \u043f\u0440\u0438\u043e\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u0442 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u044e \u043c\u0435\u0436\u0434\u0443 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0430\u043c\u0438 \u043d\u0435\u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e \u043e\u0442 \u0440\u0430\u0441\u043f\u0438\u0441\u0430\u043d\u0438\u044f \\ Update-DfsrConfigurationFromAD \u0438\u043d\u0438\u0446\u0438\u0438\u0440\u0443\u0435\u0442 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0441\u043b\u0443\u0436\u0431\u044b \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 DFS \\ Write-DfsrHealthReport \u0441\u043e\u0437\u0434\u0430\u0435\u0442 \u043e\u0442\u0447\u0435\u0442 \u043e \u0440\u0430\u0431\u043e\u0442\u043e\u0441\u043f\u043e\u0441\u043e\u0431\u043d\u043e\u0441\u0442\u0438 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 DFS \\ Write-DfsrPropagationReport \u0441\u043e\u0437\u0434\u0430\u0435\u0442 \u043e\u0442\u0447\u0435\u0442\u044b \u0434\u043b\u044f \u0442\u0435\u0441\u0442\u043e\u0432\u044b\u0445 \u0444\u0430\u0439\u043b\u043e\u0432 \u0440\u0430\u0441\u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0432 \u0433\u0440\u0443\u043f\u043f\u0435 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ Start-DfsrPropagationTest \u0441\u043e\u0437\u0434\u0430\u0435\u0442 \u0442\u0435\u0441\u0442\u043e\u0432\u044b\u0439 \u0444\u0430\u0439\u043b \u0440\u0430\u0441\u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0432 \u0440\u0435\u043f\u043b\u0438\u0446\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0439 \u043f\u0430\u043f\u043a\u0435","title":"DFS"},{"location":"#storagereplica","text":"Install-WindowsFeature Storage-Replica \u2013IncludeManagementTools -Restart \\ Get-Command -Module StorageReplica \\ Test-SRTopology \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043b\u0438 \u0441\u0435\u0440\u0432\u0435\u0440 \u0438 \u043a\u0430\u043d\u0430\u043b \u0441\u0432\u044f\u0437\u0438 \u0442\u0435\u0445\u043d\u043e\u043b\u043e\u0433\u0438\u0438 Storage Replica \\ New-SRPartnership -SourceComputerName srv-01 -SourceRGName srv-01-rep-group-01 -SourceVolumeName D: -SourceLogVolumeName L: -DestinationComputerName srv-02 -DestinationRGName srv-02-rep-group-01 -DestinationVolumeName D: -DestinationLogVolumeName L: -LogSizeInBytes 1GB \\ Get-Counter -Counter \"\\Storage Replica Statistics(*)\" \\ Get-WinEvent -ProviderName Microsoft-Windows-StorageReplica -max 10 \\ Set-SRPartnership -ReplicationMode Asynchronous \u043f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0440\u0435\u0436\u0438\u043c \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u043d\u0430 \u0430\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u044b\u0439 \\ Set-SRPartnership -NewSourceComputerName srv-02 -SourceRGName srv-02-rep-group-01 -DestinationComputerName srv-01 -DestinationRGName srv-01-rep-group-01 \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0432\u0440\u0443\u0447\u043d\u0443\u044e \u043d\u0430\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u0434\u0430\u043d\u043d\u044b\u0445, \u043f\u0435\u0440\u0435\u0432\u0435\u0434\u044f \u0432\u0442\u043e\u0440\u0438\u0447\u043d\u0443\u044e \u043a\u043e\u043f\u0438\u044e \u0432 \u043e\u043d\u043b\u0430\u0439\u043d \u0440\u0435\u0436\u0438\u043c (\u043f\u0440\u0438 \u0432\u044b\u0445\u043e\u0434\u0435 \u0438\u0437 \u0441\u0442\u0440\u043e\u044f \u043e\u0441\u043d\u043e\u0432\u043d\u043e\u0433\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u0430) \\ Get-SRGroup \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043e \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0433\u0440\u0443\u043f\u043f\u044b \u0440\u0435\u043f\u043b\u0438\u0437\u0430\u0446\u0438\u0438 \\ Get-SRPartnerShip \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043e \u043d\u0430\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0438 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \\ (Get-SRGroup).Replicas | Select-Object numofbytesremaining \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0434\u043b\u0438\u043d\u0443 \u043e\u0447\u0435\u0440\u0435\u0434\u0438 \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \\ Get-SRPartnership | Remove-SRPartnership \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0440\u0435\u043f\u043b\u0438\u0437\u0430\u0446\u0438\u044e \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u043d\u043e\u043c \u0441\u0435\u0440\u0432\u0435\u0440\u0435 \\ Get-SRGroup | Remove-SRGroup \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0440\u0435\u043f\u043b\u0438\u0437\u0430\u0446\u0438\u044e \u043d\u0430 \u043e\u0431\u043e\u0438\u0445 \u0441\u0435\u0440\u0432\u0435\u0440\u0430\u0445","title":"StorageReplica"},{"location":"#ps2exe","text":"Install-Module ps2exe -Repository PSGallery \\ Get-Module -ListAvailable \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u043c\u043e\u0434\u0443\u043b\u0435\u0439 \\ -noConsole \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c GUI, \u0431\u0435\u0437 \u043e\u043a\u043d\u0430 \u043a\u043e\u043d\u0441\u043e\u043b\u0438 powershell \\ -noOutput \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u0432 \u0444\u043e\u043d\u0435 \\ -noError \u0431\u0435\u0437 \u0432\u044b\u0432\u043e\u0434\u0430 \u043e\u0448\u0438\u0431\u043e\u043a \\ -requireAdmin \u043f\u0440\u0438 \u0437\u0430\u043f\u0443\u0441\u043a\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u0438\u0442\u044c \u043f\u0440\u0430\u0432\u0430 \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u0430 \\ -credentialGUI \u0432\u044b\u0432\u043e\u0434 \u0434\u0438\u0430\u043b\u043e\u0433\u043e\u0432\u043e\u0433\u043e \u043e\u043a\u043d\u0430 \u0434\u043b\u044f \u0432\u0432\u043e\u0434\u0430 \u0443\u0447\u0435\u0442\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445 \\ Invoke-ps2exe -inputFile \"$home\\Desktop\\WinEvent-Viewer-1.1.ps1\" -outputFile \"$home\\Desktop\\WEV-1.1.exe\" -iconFile \"$home\\Desktop\\log_48px.ico\" -title \"WinEvent-Viewer\" -noConsole -noOutput -noError","title":"PS2EXE"},{"location":"#nssm","text":"$powershell_Path = (Get-Command powershell).Source \\ $NSSM_Path = (Get-Command \"C:\\WinPerf-Agent\\NSSM-2.24.exe\").Source \\ $Script_Path = \"C:\\WinPerf-Agent\\WinPerf-Agent-1.1.ps1\" \\ $Service_Name = \"WinPerf-Agent\" \\ & $NSSM_Path install $Service_Name $powershell_Path -ExecutionPolicy Bypass -NoProfile -f $Script_Path \u0441\u043e\u0437\u0434\u0430\u0442\u044c Service \\ & $NSSM_Path start $Service_Name \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \\ & $NSSM_Path status $Service_Name \u0441\u0442\u0430\u0442\u0443\u0441 \\ $Service_Name | Restart-Service \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \\ $Service_Name | Get-Service \u0441\u0442\u0430\u0442\u0443\u0441 \\ $Service_Name | Stop-Service \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \\ & $NSSM_Path set $Service_Name description \"Check performance CPU and report email\" \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \\ & $NSSM_Path remove $Service_Name \u0443\u0434\u0430\u043b\u0438\u0442\u044c","title":"NSSM"},{"location":"#jobs","text":"Get-Job \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 \u0441\u043f\u0438\u0441\u043a\u0430 \u0437\u0430\u0434\u0430\u0447 \\ Start-Job \u0437\u0430\u043f\u0443\u0441\u043a \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 \\ Stop-Job \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 \\ Suspend-Job \u043f\u0440\u0438\u043e\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 \u0440\u0430\u0431\u043e\u0442\u044b \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 \\ Resume-Job \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0440\u0430\u0431\u043e\u0442\u044b \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 \\ Wait-Job \u043e\u0436\u0438\u0434\u0430\u043d\u0438\u0435 \u0432\u044b\u0432\u043e\u0434\u0430 \u043a\u043e\u043c\u0430\u043d\u0434\u044b \\ Receive-Job \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u043d\u043e\u0433\u043e \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 \\ Remove-Job \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0437\u0430\u0434\u0430\u0447\u0443 function Start-PingJob ($Network) { $RNetwork = $Network -replace \"\\.\\d{1,3}$\",\".\" foreach ($4 in 1..254) { $ip = $RNetwork+$4 # \u0441\u043e\u0437\u0434\u0430\u0435\u043c \u0437\u0430\u0434\u0430\u043d\u0438\u044f, \u0437\u0430\u0431\u0438\u0440\u0430\u0435\u043c 3-\u044e \u0441\u0442\u0440\u043e\u043a\u0443 \u0432\u044b\u0432\u043e\u0434\u0430 \u0438 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c \u043a \u0432\u044b\u0432\u043e\u0434\u0443 ip-\u0430\u0434\u0440\u0435\u0441: (Start-Job {\"$using:ip : \"+(ping -n 1 -w 50 $using:ip)[2]}) | Out-Null } while ($True){ $status_job = (Get-Job).State[-1] # \u0437\u0430\u0431\u0438\u0440\u0430\u0435\u043c \u0441\u0442\u0430\u0442\u0443\u0441 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u0437\u0430\u0434\u0430\u043d\u0438\u044f if ($status_job -like \"Completed\"){ # \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c \u043d\u0430 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 (\u0437\u0430\u0434\u0430\u043d\u0438\u044f \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u044e\u0442\u0441\u044f \u043f\u043e \u043e\u0447\u0435\u0440\u0435\u0434\u0438 \u0441\u0432\u0435\u0440\u0445\u0443 \u0432\u043d\u0438\u0437) $ping_out = Get-Job | Receive-Job # \u0435\u0441\u043b\u0438 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d, \u0437\u0430\u0431\u0438\u0440\u0430\u0435\u043c \u0432\u044b\u0432\u043e\u0434 \u0432\u0441\u0435\u0445 \u0437\u0430\u0434\u0430\u043d\u0438\u0439 Get-Job | Remove-Job -Force # \u0443\u0434\u0430\u043b\u044f\u0435\u043c \u0437\u0430\u0434\u0430\u043d\u0438\u044f $ping_out break # \u0437\u0430\u0432\u0435\u0440\u0448\u0430\u0435\u043c \u0446\u0438\u043a\u043b }} } Start-PingJob -Network 192.168.3.0 \\ (Measure-Command {Start-PingJob -Network 192.168.3.0}).TotalSeconds 60 Seconds","title":"Jobs"},{"location":"#threadjob","text":"Install-Module -Name ThreadJob \\ Get-Module ThreadJob -list \\ Start-ThreadJob {ping ya.ru} | Out-Null \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0444\u043e\u043d\u043e\u0432\u0443\u044e \u0437\u0430\u0434\u0430\u0447\u0443 \\ Get-Job | Receive-Job -Keep \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0438 \u043d\u0435 \u0443\u0434\u0430\u043b\u044f\u0442\u044c \u0432\u044b\u0432\u043e\u0434 \\ (Get-Job).HasMoreData \u0435\u0441\u043b\u0438 False, \u0442\u043e \u0432\u044b\u0432\u043e\u0434 \u043a\u043e\u043c\u0430\u043d\u044b \u0443\u0434\u0430\u043b\u0435\u043d \\ (Get-Job)[-1].Output \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u044b\u0432\u043e\u0434 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0439 \u0437\u0430\u0434\u0430\u0447\u0438 function Start-PingThread ($Network) { $RNetwork = $Network -replace \"\\.\\d{1,3}$\",\".\" foreach ($4 in 1..254) { $ip = $RNetwork+$4 # \u0441\u043e\u0437\u0434\u0430\u0435\u043c \u0437\u0430\u0434\u0430\u043d\u0438\u044f, \u0437\u0430\u0431\u0438\u0440\u0430\u0435\u043c 3-\u044e \u0441\u0442\u0440\u043e\u043a\u0443 \u0432\u044b\u0432\u043e\u0434\u0430 \u0438 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c \u043a \u0432\u044b\u0432\u043e\u0434\u0443 ip-\u0430\u0434\u0440\u0435\u0441: (Start-ThreadJob {\"$using:ip : \"+(ping -n 1 -w 50 $using:ip)[2]}) | Out-Null } while ($True){ $status_job = (Get-Job).State[-1] # \u0437\u0430\u0431\u0438\u0440\u0430\u0435\u043c \u0441\u0442\u0430\u0442\u0443\u0441 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u0437\u0430\u0434\u0430\u043d\u0438\u044f if ($status_job -like \"Completed\"){ # \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c \u043d\u0430 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 (\u0437\u0430\u0434\u0430\u043d\u0438\u044f \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u044e\u0442\u0441\u044f \u043f\u043e \u043e\u0447\u0435\u0440\u0435\u0434\u0438 \u0441\u0432\u0435\u0440\u0445\u0443 \u0432\u043d\u0438\u0437) $ping_out = Get-Job | Receive-Job # \u0435\u0441\u043b\u0438 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d, \u0437\u0430\u0431\u0438\u0440\u0430\u0435\u043c \u0432\u044b\u0432\u043e\u0434 \u0432\u0441\u0435\u0445 \u0437\u0430\u0434\u0430\u043d\u0438\u0439 Get-Job | Remove-Job -Force # \u0443\u0434\u0430\u043b\u044f\u0435\u043c \u0437\u0430\u0434\u0430\u043d\u0438\u044f $ping_out break # \u0437\u0430\u0432\u0435\u0440\u0448\u0430\u0435\u043c \u0446\u0438\u043a\u043b }} } Start-PingThread -Network 192.168.3.0 \\ (Measure-Command {Start-PingThread -Network 192.168.3.0}).TotalSeconds 24 Seconds","title":"ThreadJob"},{"location":"#poshrsjob","text":"function Start-PingRSJob ($Network) { $RNetwork = $Network -replace \"\\.\\d{1,3}$\",\".\" foreach ($4 in 1..254) { $ip = $RNetwork+$4 (Start-RSJob {\"$using:ip : \"+(ping -n 1 -w 50 $using:ip)[2]}) | Out-Null } $ping_out = Get-RSJob | Receive-RSJob $ping_out Get-RSJob | Remove-RSJob } Start-PingRSJob -Network 192.168.3.0 \\ (Measure-Command {Start-PingRSJob -Network 192.168.3.0}).TotalSeconds 10 Seconds","title":"PoshRSJob"},{"location":"#smtp","text":"function Send-SMTP { param ( [Parameter(Mandatory = $True)]$mess ) $srv_smtp = \"smtp.yandex.ru\" $port = \"587\" $from = \"login1@yandex.ru\" $to = \"login2@yandex.ru\" $user = \"login1\" $pass = \"password\" $subject = \"Service status on Host: $hostname\" $Message = New-Object System.Net.Mail.MailMessage $Message.From = $from $Message.To.Add($to) $Message.Subject = $subject $Message.IsBodyHTML = $true $Message.Body = \"<h1> $mess </h1>\" $smtp = New-Object Net.Mail.SmtpClient($srv_smtp, $port) $smtp.EnableSSL = $true $smtp.Credentials = New-Object System.Net.NetworkCredential($user, $pass); $smtp.Send($Message) } Send-SMTP $(Get-Service)","title":"SMTP"},{"location":"#hyper-v","text":"Install-WindowsFeature -Name Hyper-V -IncludeManagementTools -Restart \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0440\u043e\u043b\u044c \u043d\u0430 Windows Server \\ Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Hyper-V \u2013All \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0440\u043e\u043b\u044c \u043d\u0430 Windows Desktop \\ Get-Command -Module hyper-v \\ Get-VMHost New-VMSwitch -name NAT -SwitchType Internal # \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0432\u0438\u0440\u0442\u0443\u0430\u043b\u044c\u043d\u044b\u0439 \u043a\u043e\u043c\u043c\u0443\u0442\u0430\u0442\u043e\u0440 \u0438 \u0430\u0434\u0430\u043f\u0442\u0435\u0440 \u0434\u043b\u044f \u043d\u0435\u0433\u043e Get-NetAdapter | where InterfaceDescription -match Hyper-V # \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u0435\u0442\u0435\u0432\u044b\u0445 \u0430\u0434\u0430\u043f\u0442\u0435\u0440\u043e\u0432 New-NetNat -Name LocalNat -InternalIPInterfaceAddressPrefix \"192.168.3.0/24\" # \u0437\u0430\u0434\u0430\u0442\u044c \u0441\u0435\u0442\u044c Get-NetAdapter \"vEthernet (NAT)\" | New-NetIPAddress -IPAddress 192.168.3.200 -AddressFamily IPv4 -PrefixLength 24 # \u043f\u0440\u0438\u0441\u0432\u043e\u0438\u0442\u044c \u0430\u0434\u0440\u0435\u0441, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043d\u0430 \u0412\u041c \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u0448\u043b\u044e\u0437 192.168.3.200, \u0447\u0442\u043e \u0431\u044b \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u044c\u0441\u044f \u0437\u0430 NAT, \u0438\u043b\u0438 \u0432 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430 \u0412\u041c \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0439 \u0430\u0434\u0430\u043f\u0442\u0435\u0440 Add-NetNatStaticMapping -NatName LocalNat -Protocol TCP -ExternalIPAddress 0.0.0.0 -ExternalPort 2222 -InternalIPAddress 192.168.3.103 -InternalPort 2121 # \u043f\u0440\u043e\u0431\u0440\u043e\u0441, \u0432\u0435\u0441\u0442 \u0442\u0440\u0430\u0444\u0438\u043a \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043f\u0440\u0438\u0445\u043e\u0434\u0438\u0442 \u043d\u0430 \u0445\u043e\u0441\u0442 Hyper-V TCP/2222, \u0431\u0443\u0434\u0435\u0442 \u043f\u0435\u0440\u0435\u043d\u0430\u043f\u0440\u0430\u0432\u043b\u044f\u0442\u044c\u0441\u044f \u043d\u0430 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0439 \u043f\u043e\u0440\u0442 \u0432\u0438\u0440\u0442\u0443\u0430\u043b\u044c\u043d\u043e\u0439 \u043c\u0430\u0448\u0438\u043d\u044b \u0437\u0430 NAT. (Get-NetAdapter | where Name -match NAT).Status Get-NetNatStaticMapping \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043f\u0440\u043e\u0431\u0440\u043e\u0441\u044b (NAT) \\ Get-NetNat \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u0435\u0442\u0435\u0439 \\ Remove-NetNatStaticMapping -StaticMappingID 0 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043f\u0440\u043e\u0431\u0440\u043e\u0441 \\ Remove-NetNat -Name LocalNat \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u0435\u0442\u044c New-VMSwitch -Name Local -AllowManagementOS $True -NetAdapterName \"Ethernet 4\" -SwitchType External \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0432\u0448\u0435\u043d\u0438\u0439 (External) \u0432\u0438\u0440\u0442\u0443\u0430\u043b\u044c\u043d\u044b\u0439 \u043a\u043e\u043c\u043c\u0443\u0442\u0430\u0442\u043e\u0440 \\ $VMName = \"hv-dc-01\" $VM = @{ Name = $VMName MemoryStartupBytes = 4Gb Generation = 2 NewVHDPath = \"D:\\VM\\$VMName\\$VMName.vhdx\" NewVHDSizeBytes = 50Gb BootDevice = \"VHD\" Path = \"D:\\VM\\$VMName\" SwitchName = \"NAT\" } New-VM @VM Set-VMDvdDrive -VMName $VMName -Path \"C:\\Users\\Lifailon\\Documents\\WS-2016.iso\" \\ New-VHD -Path \"D:\\VM\\$VMName\\disk_d.vhdx\" -SizeBytes 10GB \u0441\u043e\u0437\u0434\u0430\u0442\u044c VHDX \u0434\u0438\u0441\u043a \\ Add-VMHardDiskDrive -VMName $VMName -Path \"D:\\VM\\$VMName\\disk_d.vhdx\" \u043f\u0440\u0438\u043c\u043e\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0434\u0438\u0441\u043a \\ Get-VM \u2013VMname $VMName | Set-VM \u2013AutomaticStartAction Start \u0430\u0432\u0442\u043e\u0437\u0430\u043f\u0443\u0441\u043a \\ Get-VM -Name $VMName | Set-VMMemory -StartupBytes 8Gb \\ Set-VMProcessor $VMName -Count 2 \\ Get-VM -Name $VMName | Checkpoint-VM -SnapshotName \"Snapshot-1\" \\ Restore-VMCheckpoint -Name Snapshot-1\" -VMName $VMName -Confirm:$false \\ Get-VM | Select -ExpandProperty NetworkAdapters | Select VMName,IPAddresses,Status \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c IP \u0430\u0434\u0440\u0435\u0441 \u0432\u0441\u0435\u0445 \u0412\u041c \\ vmconnect.exe localhost $VMHost Get-NetTCPConnection -State Established,Listen | Where-Object LocalPort -Match 2179 \u043d\u0430\u0439\u0442\u0438 \u043f\u043e\u0440\u0442 \u0441\u043b\u0443\u0448\u0430\u0442\u0435\u043b\u044f Get-Process -Id (Get-NetTCPConnection -State Established,Listen | Where-Object LocalPort -Match 2179).OwningProcess \u043d\u0430\u0439\u0442\u0438 \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u043f\u043e ID (vmms/VMConnect) \\ New-NetFirewallRule -Name \"Hyper-V\" -DisplayName \"Hyper-V\" -Group \"Hyper-V\" -Direction Inbound -Protocol TCP -LocalPort 2179 -Action Allow -Profile Public \\ Get-LocalGroupMember -Group \"\u0410\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u044b Hyper-V\" \u0438\u043b\u0438 \"Hyper-V Administrators\" \\ Add-LocalGroupMember -Group \"\u0410\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u044b Hyper-V\" -Member \"lifailon\" \\ Get-VM * | select name,ID \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c id \u0432 RDCMan \u0434\u043b\u044f \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \\ Grant-VMConnectAccess -ComputerName plex-01 -VMName hv-devops-01 -UserName lifailon \u0434\u0430\u0442\u044c \u0434\u043e\u0441\u0442\u0443\u043f \u043d\u0430 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u043d\u0435 \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u0443 \\ Grant-VMConnectAccess -ComputerName huawei-book -VMName hv-devops-01 -UserName lifailon \\ Get-VMConnectAccess \\ Revoke-VMConnectAccess -VMName hv-devops-01 -UserName lifailon Error: Unknown disconnection reason 3848 - \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043a\u043b\u044e\u0447\u0438 \u0440\u0435\u0435\u0441\u0442\u0440\u0430 \u043d\u0430 \u0441\u0442\u043e\u0440\u043e\u043d\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 New-ItemProperty -Path HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\Credssp\\PolicyDefaults\\AllowFreshCredentialsDomain -Name Hyper-V -PropertyType String -Value \"Microsoft Virtual Console Service/*\" -Force New-ItemProperty -Path HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\Credssp\\PolicyDefaults\\AllowDefaultCredentials -Name Hyper-V -PropertyType String -Value \"Microsoft Virtual Console Service/*\" -Force New-ItemProperty -Path HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\Credssp\\PolicyDefaults\\AllowFreshCredentialsWhenNTLMOnlyDomain -Name Hyper-V -PropertyType String -Value \"Microsoft Virtual Console Service/*\" -Force ItemProperty -Path HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\Credssp\\PolicyDefaults\\AllowDefaultCredentialsDomain -Name Hyper-V -PropertyType String -Value \"Microsoft Virtual Console Service/*\" -Force New-ItemProperty -Path HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\Credssp\\PolicyDefaults\\AllowFreshCredentials -Name Hyper-V -PropertyType String -Value \"Microsoft Virtual Console Service/*\" -Force New-ItemProperty -Path HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\Credssp\\PolicyDefaults\\AllowFreshCredentialsWhenNTLMOnly -Name Hyper-V -PropertyType String -Value \"Microsoft Virtual Console Service/*\" -Force New-ItemProperty -Path HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\Credssp\\PolicyDefaults\\AllowSavedCredentialsWhenNTLMOnly -Name Hyper-V -PropertyType String -Value \"Microsoft Virtual Console Service/*\" -Force New-ItemProperty -Path HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\Credssp\\PolicyDefaults\\AllowSavedCredentials -Name Hyper-V -PropertyType String -Value \"Microsoft Virtual Console Service/*\" -Force New-ItemProperty -Path HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\Credssp\\PolicyDefaults\\AllowSavedCredentialsDomain -Name Hyper-V -PropertyType String -Value \"Microsoft Virtual Console Service/*\" -Force","title":"Hyper-V"},{"location":"#vmwarepowercli","text":"Install-Module -Name VMware.PowerCLI # -AllowClobber \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043c\u043e\u0434\u0443\u043b\u044c (PackageProvider: nuget) \\ Get-Module -ListAvailable VMware* | Select Name,Version \\ Import-Module VMware.VimAutomation.Core \u0438\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u0441\u0435\u0441\u0441\u0438\u044e \\ Get-PSProvider | format-list Name,PSSnapIn,ModuleName \u0441\u043f\u0438\u0441\u043e\u043a \u043e\u0441\u043d\u0430\u0441\u0442\u043e\u043a Windows PowerShell Get-PowerCLIConfiguration \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \\ Set-PowerCLIConfiguration -Scope AllUsers -InvalidCertificateAction ignore -confirm:$false e\u0441\u043b\u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0441\u0430\u043c\u043e\u043f\u043e\u0434\u043f\u0438\u0441\u0430\u043d\u043d\u044b\u0439 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442, \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430 InvalidCertificateAction \u0441 Unset \u043d\u0430 Ignore/Warn \\ Set-PowerCLIConfiguration -Scope AllUsers -ParticipateInCeip $false \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0435 \u0441\u0431\u043e\u0440\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 \u0447\u0435\u0440\u0435\u0437 VMware Customer Experience Improvement Program (CEIP) Read-Host \u2013AsSecureString | ConvertFrom-SecureString | Out-File \"$home\\Documents\\vcsa_password.txt\" \u0437\u0430\u0448\u0438\u0444\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \u0438 \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0432 \u0444\u0430\u0439\u043b \\ $esxi = \"vcsa.domain.local\" \\ $user = \"administrator@vsphere.local\" \\ $pass = Get-Content \"$home\\Documents\\vcsa_password.txt\" | ConvertTo-SecureString \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \\ $pass = \"password\" \\ $Cred = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList $user ,$pass \\ Connect-VIServer $esxi -User $Cred.Username -Password $Cred.GetNetworkCredential().password \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044f PSCredential ($Cred) \\ Connect-VIServer $esxi -User $user -Password $pass \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044f \u043b\u043e\u0433\u0438\u043d \u0438 \u043f\u0430\u0440\u043e\u043b\u044c Get-Command \u2013Module *vmware* \\ Get-Command \u2013Module *vmware* -name *get*iscsi* \\ Get-IScsiHbaTarget \\ Get-Datacenter \\ Get-Cluster \\ Get-VMHost \\ Get-VMHost | select Name,Model,ProcessorType,MaxEVCMode,NumCpu,CpuTotalMhz,CpuUsageMhz,MemoryTotalGB,MemoryUsageGB \\ Get-VMHostDisk | select VMHost,ScsiLun,TotalSectors Get-Datastore \\ Get-Datastore TNAS-vmfs-4tb-01 \\ Get-Datastore TNAS-vmfs-4tb-01 | get-vm \\ Get-Datastore -RelatedObject vm-01 \\ (Get-Datastore TNAS-vmfs-4tb-01).ExtensionData.Info.GetType() \\ (Get-Datastore TNAS-vmfs-4tb-01).ExtensionData.Info.Vmfs.Extent Get-Command \u2013Module *vmware* -name *disk* \\ Get-VM vm-01 | Get-Datastore \\ Get-VM vm-01 | Get-HardDisk \\ Get-VM | Get-HardDisk | select Parent,Name,CapacityGB,StorageFormat,FileName | ft \\ Copy-HardDisk \\ Get-VM | Get-Snapshot \\ Get-VM | where {$_.Powerstate -eq \"PoweredOn\"} \\ Get-VMHost esxi-05 | Get-VM | where {$_.Powerstate -eq \"PoweredOff\"} | Move-VM \u2013Destination (Get-VMHost esxi-06) Get-VM | select Name,VMHost,PowerState,NumCpu,MemoryGB, \\ @{Name=\"UsedSpaceGB\"; Expression={[int32]($_.UsedSpaceGB)}},@{Name=\"ProvisionedSpaceGB\"; Expression={[int32]($_.ProvisionedSpaceGB)}}, \\ CreateDate,CpuHotAddEnabled,MemoryHotAddEnabled,CpuHotRemoveEnabled,Notes Get-VMGuest vm-01 | Update-Tools \\ Get-VMGuest vm-01 | select OSFullName,IPAddress,HostName,State,Disks,Nics,ToolsVersion \\ Get-VMGuest * | select -ExpandProperty IPAddress \\ Restart-VMGuest -vm vm-01 -Confirm:$False \\ Start-VM -vm vm-01 -Confirm:$False \\ Shutdown-VMGuest -vm vm-01 -Confirm:$false New-VM \u2013Name vm-01 -VMHost esxi-06 \u2013ResourcePool Production \u2013DiskGB 60 \u2013DiskStorageFormat Thin \u2013Datastore TNAS-vmfs-4tb-01 \\ Get-VM vm-01 | Copy-VMGuestFile -Source \"\\\\$srv\\Install\\Soft\\Btest.exe\" -Destination \"C:\\Install\\\" -LocalToGuest -GuestUser USER -GuestPassword PASS -force Get-VM -name vm-01 | Export-VApp -Destination C:\\Install -Format OVF Export template (.ovf, .vmdk, .mf) \\ Get-VM -name vm-01 | Export-VApp -Destination C:\\Install -Format OVA Get-VMHostNetworkAdapter | select VMHost,Name,Mac,IP,@{Label=\"Port Group\"; Expression={$_.ExtensionData.Portgroup}} | ft \\ Get-VM | Get-NetworkAdapter | select Parent,Name,Id,Type,MacAddress,ConnectionState,WakeOnLanEnabled | ft Get-Command \u2013Module *vmware* -name *event* \\ Get-VIEvent -MaxSamples 1000 | where {($_.FullFormattedMessage -match \"power\")} | select username,CreatedTime,FullFormattedMessage \\ Get-logtype | select Key,SourceEntityId,Filename,Creator,Info \\ (Get-Log vpxd:vpxd.log).Entries | select -Last 50 Get-Command \u2013Module *vmware* -name *syslog* \\ Set-VMHostSysLogServer -VMHost esxi-05 -SysLogServer \"tcp://192.168.3.100\" -SysLogServerPort 3515 \\ Get-VMHostSysLogServer -VMHost esxi-05","title":"VMWare/PowerCLI"},{"location":"#exchangeemshell","text":"$srv_cas = \"exchange-cas\" \\ $session_exchange = New-PSSession -ConfigurationName Microsoft.Exchange -ConnectionUri http://$srv_cas/PowerShell/ -Credential $Cred -Authentication Kerberos \\ Get-PSSession \\ Import-PSSession $session_exchange -DisableNameChecking \u0438\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u0442\u0435\u043a\u0443\u0449\u0443\u044e \u0441\u0435\u0441\u0441\u0438\u044e Get-ExchangeServer | select name,serverrole,admindisplayversion,Edition,OriginatingServer,WhenCreated,WhenChanged,DataPath | ft \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u0432 Get-ImapSettings \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 IMAP \\ Get-ExchangeCertificate \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432 \\ Get-ExchangeCertificate -Thumbprint \"5CEC8544D4743BC279E5FEA1679F79F5BD0C2B3A\" | Enable-ExchangeCertificate -Services IMAP, POP, IIS, SMTP \\ iisreset \\ Get-ClientAccessService | fl identity, *uri* \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u0441\u043b\u0443\u0436\u0431\u044b \u0430\u0432\u0442\u043e\u043e\u0431\u043d\u0430\u0440\u0443\u0436\u0435\u043d\u0438\u044f \u0432 Exchange 2016 \\ Get-ClientAccessService -Identity $srv | Set-ClientAccessService -AutoDiscoverServiceInternalUri https://mail.domain.ru/Autodiscover/Autodiscover.xml \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043d\u0430 \u0432\u043d\u0435\u0448\u043d\u0438\u0439 \u0430\u0434\u0440\u0435\u0441 \\ Get-OutlookAnywhere OA \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u043a\u043b\u0438\u0435\u043d\u0442\u0430\u043c Outlook \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0430\u0442\u044c\u0441\u044f \u043a \u0441\u0432\u043e\u0438\u043c \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u043c \u044f\u0449\u0438\u043a\u0430\u043c \u0437\u0430 \u043f\u0440\u0435\u0434\u0435\u043b\u0430\u043c\u0438 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u043e\u0439 \u0441\u0435\u0442\u0438 (\u0431\u0435\u0437 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f VPN) \\ Get-WebServicesVirtualDirectory \\ Get-OwaVirtualDirectory \\ Get-ActiveSyncVirtualDirectory \\ Get-OabVirtualDirectory \u0432\u0438\u0440\u0442\u0443\u0430\u043b\u044c\u043d\u0430\u044f \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u044f \u0430\u0432\u0442\u043e\u043d\u043e\u043c\u043d\u043e\u0439 \u0430\u0434\u0440\u0435\u0441\u043d\u043e\u0439 \u043a\u043d\u0438\u0433\u0438 \\ Get-OabVirtualDirectory -Server $srv | Set-OabVirtualDirectory -InternalUrl \"https://mail.domain.ru/OAB\" -ExternalUrl \"https://mail.domain.ru/OAB\"","title":"Exchange/EMShell"},{"location":"#roles","text":"MS (Mailbox) - \u0441\u0435\u0440\u0432\u0435\u0440 \u0441 \u0411\u0414 \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0445 \u044f\u0449\u0438\u043a\u043e\u0432 \u0438 \u043e\u0431\u0449\u0438\u0445 \u043f\u0430\u043f\u043e\u043a, \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u0437\u0430 \u0438\u0445 \u0440\u0430\u0437\u043c\u0435\u0449\u0435\u043d\u0438\u0435 \u0438 \u043d\u0435 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0430\u0446\u0438\u044e \u043d\u0438\u043a\u0430\u043a\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439. \\ CAS (Client Access Server) - \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043a\u043b\u0438\u0435\u043d\u0442\u0441\u043a\u0438\u0445 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0439 \u043a \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u043c \u044f\u0449\u0438\u043a\u0430\u043c, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0441\u043e\u0437\u0434\u0430\u044e\u0442\u0441\u044f \u043a\u043b\u0438\u0435\u043d\u0442\u0430\u043c\u0438 Outlook Web Access (HTTP \u0434\u043b\u044f Outlook Web App), Outlook Anywhere, ActiveSync (\u0434\u043b\u044f \u043c\u043e\u0431\u0438\u043b\u044c\u043d\u044b\u0445 \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432), \u0438\u043d\u0442\u0435\u0440\u043d\u0435\u0442 \u043f\u0440\u043e\u0442\u043e\u043a\u043e\u043b\u044b POP3 \u0438 IMAP4, MAPI \u0434\u043b\u044f \u043a\u043b\u0438\u0435\u043d\u0442\u043e\u0432 Microsoft Outlook. \\ Hub Transort - \u043e\u0442\u0432\u0435\u0442\u0432\u0435\u0447\u0430\u0435\u0442 \u0437\u0430 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0430\u0446\u0438\u044e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0438\u043d\u0442\u0435\u0440\u043d\u0435\u0442\u0430 \u0438 \u0438\u043d\u0444\u0440\u0430\u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u043e\u0439 Exchange, \u0430 \u0442\u0430\u043a\u0436\u0435 \u043c\u0435\u0436\u0434\u0443 \u0441\u0435\u0440\u0432\u0435\u0440\u0430\u043c\u0438 Exchange. \u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u0432\u0441\u0435\u0433\u0434\u0430 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0438\u0440\u0443\u044e\u0442\u0441\u044f \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0440\u043e\u043b\u0438 \u0442\u0440\u0430\u043d\u0441\u043f\u043e\u0440\u0442\u043d\u043e\u0433\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u0430-\u043a\u043e\u043d\u0446\u0435\u043d\u0442\u0440\u0430\u0442\u043e\u0440\u0430, \u0434\u0430\u0436\u0435 \u0435\u0441\u043b\u0438 \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0435 \u044f\u0449\u0438\u043a\u0438 \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u0430 \u0438 \u043d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u043d\u0430\u0445\u043e\u0434\u044f\u0442\u0441\u044f \u0432 \u043e\u0434\u043d\u043e\u0439 \u0431\u0430\u0437\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0445 \u044f\u0449\u0438\u043a\u043e\u0432. \\ Relay - \u0440\u043e\u043b\u044c \u043f\u043e\u0433\u0440\u0430\u043d\u0438\u0447\u043d\u043e\u0433\u043e \u0442\u0440\u0430\u043d\u0441\u043f\u043e\u0440\u0442\u043d\u043e\u0433\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u0430 (\u0448\u043b\u044e\u0437 SMTP \u0432 \u043f\u0435\u0440\u0438\u043c\u0435\u0442\u0440\u0435 \u0441\u0435\u0442\u0438). SCP (Service Connection Point) - \u0437\u0430\u043f\u0438\u0441\u044c \u043f\u0440\u043e\u043f\u0438\u0441\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u0432 AD, \u043f\u0440\u0438 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 CAS. Outlook \u0437\u0430\u043f\u0440\u0430\u0448\u0438\u0432\u0430\u0435\u0442 SCP, \u0432\u044b\u0431\u0438\u0440\u0430\u0435\u0442 \u0442\u0435, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043d\u0430\u0445\u043e\u0434\u044f\u0442\u0441\u044f \u0432 \u043e\u0434\u043d\u043e\u043c \u0441\u0430\u0439\u0442\u0435 \u0441 \u043d\u0438\u043c \u0438 \u043f\u043e \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0443 WhenCreated \u2013 \u043f\u043e \u0434\u0430\u0442\u0435 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f, \u0432\u044b\u0431\u0438\u0440\u0430\u044f \u0441\u0430\u043c\u044b\u0439 \u0441\u0442\u0430\u0440\u044b\u0439. \\ Autodiscover. Outlook \u0432\u044b\u0431\u0438\u0440\u0430\u0435\u0442 \u0432 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 Client Access \u0442\u043e\u0442, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043f\u0440\u043e\u043f\u0438\u0441\u0430\u043d \u0432 \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u0435 RPCClientAccessServer \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f. \u0421\u0432\u0435\u0434\u0435\u043d\u0438\u044f \u043e \u0431\u0430\u0437\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 \u0438 \u0441\u0435\u0440\u0432\u0435\u0440\u0435 mailbox, \u043d\u0430 \u043a\u043e\u0442\u043e\u0440\u043e\u043c \u043e\u043d\u0430 \u043b\u0435\u0436\u0438\u0442, \u0431\u0435\u0440\u0443\u0442\u0441\u044f \u0438\u0437 AD.","title":"Roles"},{"location":"#messagetrackinglog","text":"Get-MessageTrackingLog -ResultSize Unlimited | select Timestamp,Sender,Recipients,RecipientCount,MessageSubject,Source,EventID,ClientHostname,ServerHostname,ConnectorId, @{Name=\"MessageSize\"; Expression={[string]([int]($_.TotalBytes / 1024))+\" KB\"}},@{Name=\"MessageLatency\"; Expression={$_.MessageLatency -replace \"\\.\\d+$\"}} \\ Get-MessageTrackingLog -Start (Get-Date).AddHours(-24) -ResultSize Unlimited | where {[string]$_.recipients -like \"*@yandex.ru\"} \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u0437\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0435 24 \u0447\u0430\u0441\u0430, \u0433\u0434\u0435 \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u0435\u043b\u0435\u043c \u0431\u044b\u043b \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u0439 \u0434\u043e\u043c\u0435\u043d \\ -Start \"04/01/2023 09:00:00\" -End \"04/01/2023 18:00:00\" - \u043f\u043e\u0438\u0441\u043a \u043f\u043e \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u043c\u0443 \u043f\u0440\u043e\u043c\u0435\u0436\u0443\u0442\u043a\u0443 \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \\ -MessageSubject \"\u0422\u0435\u0441\u0442\" - \u043f\u043e\u0438\u0441\u043a \u043f\u043e \u0442\u0435\u043c\u0435 \u043f\u0438\u0441\u044c\u043c\u0430 \\ -Recipients \"support4@domain.ru\" - \u043f\u043e\u0438\u0441\u043a \u043f\u043e \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u0435\u043b\u044e \\ -Sender - \u043f\u043e\u0438\u0441\u043a \u043f\u043e \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u0435\u043b\u044e \\ -EventID \u2013 \u043f\u043e\u0438\u0441\u043a \u043f\u043e \u043a\u043e\u0434\u0443 \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u0441\u0435\u0440\u0432\u0435\u0440\u0430 (RECEIVE, SEND, FAIL, DSN, DELIVER, BADMAIL, RESOLVE, EXPAND, REDIRECT, TRANSFER, SUBMIT, POISONMESSAGE, DEFER) \\ -Server \u2013 \u043f\u043e\u0438\u0441\u043a \u043d\u0430 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043d\u043e\u043c \u0442\u0440\u0430\u043d\u0441\u043f\u043e\u0440\u0442\u043d\u043e\u043c \u0441\u0435\u0440\u0432\u0435\u0440\u0435 \\ -messageID \u2013 \u0442\u0440\u0435\u043a\u0438\u043d\u0433 \u043f\u0438\u0441\u044c\u043c\u0430 \u043f\u043e \u0435\u0433\u043e ID","title":"MessageTrackingLog"},{"location":"#mailbox","text":"Get-Mailbox -Database \"it2\" \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0445 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u0432 \u0432 \u0431\u0430\u0437\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 \\ Get-Mailbox -resultsize unlimited | ? Emailaddresses -like \"support4\" | format-list name,emailaddresses,database,servername \u043a\u0430\u043a\u0443\u044e \u0411\u0414, \u0441\u0435\u0440\u0432\u0435\u0440 \u0438 smtp-\u0430\u0434\u0440\u0435\u0441\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442 \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0439 \u044f\u0449\u0438\u043a \\ Get-Mailbox -Database $db_name -Archive \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0430\u0440\u0445\u0438\u0432\u043d\u044b\u0435 \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0435 \u044f\u0449\u0438\u043a\u0438 Get-MailboxFolderStatistics -Identity \"support4\" -FolderScope All | select Name,ItemsInFolder,FolderSize \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043a\u043e\u043b-\u0432\u043e \u043f\u0438\u0441\u0435\u043c \u0438 \u0440\u0430\u0437\u043c\u0435\u0440 \u0432 \u043a\u0430\u0436\u0434\u043e\u0439 \u043f\u0430\u043f\u043a\u0435 \\ Get-MailboxStatistics \"support4\" | select DisplayName,LastLoggedOnUserAccount,LastLogonTime,LastLogoffTime,ItemCount,TotalItemSize,DeletedItemCount,TotalDeletedItemSize,Database,ServerName \u043e\u0431\u0449\u0435\u0435 \u043a\u043e\u043b-\u0432\u043e \u043f\u0438\u0441\u0435\u043c, \u0438\u0445 \u0440\u0430\u0437\u043c\u0435\u0440, \u0432\u0440\u0435\u043c\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u0432\u0445\u043e\u0434\u0430 \u0438 \u0432\u044b\u0445\u043e\u0434\u0430, \u0438\u043c\u044f \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u0438 \u0411\u0414 \\ Get-Mailbox -Server s2 | Get-MailboxStatistics | where {$_.Lastlogontime -lt (get-date).AddDays(-30)} | Sort Lastlogontime -desc | ft displayname,Lastlogontime,totalitemsize \u044f\u0449\u0438\u043a\u0438, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043d\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043b\u0438\u0441\u044c 30 \u0438 \u0431\u043e\u043b\u0435\u0435 \u0434\u043d\u0435\u0439 Enable-Mailbox -Identity support9 -Database test_base \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0439 \u044f\u0449\u0438\u043a \u0434\u043b\u044f \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0435\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0432 AD \\ New-Mailbox -Name $login -UserPrincipalName \"$login@$domain\" -Database $select_db -OrganizationalUnit $path -Password (ConvertTo-SecureString -String \"$password\" -AsPlainText -Force) \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043d\u043e\u0432\u044b\u0439 \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0439 \u044f\u0449\u0438\u043a \u0431\u0435\u0437 \u043f\u0440\u0438\u0432\u044f\u0437\u043a\u0438 \u043a \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044e AD \\ Get-MailboxDatabase -Database $db_name | Remove-MailboxDatabase \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0411\u0414 Set-MailBox \"support4\" -PrimarySmtpAddress support24@domain.ru -EmailAddressPolicyEnabled $false \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0438 \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043e\u0441\u043d\u043e\u0432\u043d\u043e\u0439 SMTP-\u0430\u0434\u0440\u0435\u0441 \u044d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u043e\u0439 \u043f\u043e\u0447\u0442\u044b \u0434\u043b\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \\ Set-Mailbox -Identity \"support4\" -DeliverToMailboxAndForward $true -ForwardingSMTPAddress \"username@outlook.com\" \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043f\u0435\u0440\u0435\u0430\u0434\u0440\u0435\u0441\u0430\u0446\u0438\u044e \u043f\u043e\u0447\u0442\u044b (\u044d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u0430\u044f \u043f\u043e\u0447\u0442\u0430 \u043f\u043e\u043f\u0430\u0434\u0430\u0435\u0442 \u0432 \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0439 \u044f\u0449\u0438\u043a \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f support4 \u0438 \u043e\u0434\u043d\u043e\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e \u043f\u0435\u0440\u0435\u0441\u044b\u043b\u0430\u0435\u0442\u0441\u044f \u043f\u043e \u0430\u0434\u0440\u0435\u0441\u0443 username@outlook.com)","title":"Mailbox"},{"location":"#moverequest","text":"Get-Mailbox -Database $db_in | New-MoveRequest -TargetDatabase $db_out \u043f\u0435\u0440\u0435\u043c\u0435\u0441\u0442\u0438\u0442\u044c \u0432\u0441\u0435 \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0435 \u044f\u0449\u0438\u043a\u0438 \u0438\u0437 \u043e\u0434\u043d\u043e\u0439 \u0411\u0414 \u0432 \u0434\u0440\u0443\u0433\u0443\u044e \\ New-MoveRequest -Identity $db_in -TargetDatabase $db_out \u043f\u0435\u0440\u0435\u043c\u0435\u0441\u0442\u0438\u0442\u044c \u043e\u0434\u0438\u043d \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0439 \u044f\u0449\u0438\u043a \\ Get-MoveRequest | Suspend-MoveRequest \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0437\u0430\u043f\u0440\u043e\u0441\u044b \u043f\u0435\u0440\u0435\u043c\u0435\u0449\u0435\u043d\u0438\u044f \\ Get-MoveRequest | Remove-MoveRequest \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0437\u0430\u043f\u0440\u043e\u0441\u044b \u043d\u0430 \u043f\u0435\u0440\u0435\u043c\u0435\u0449\u0435\u043d\u0438\u0435 \\ Get-MoveRequest | Get-MoveRequestStatistics \u0441\u0442\u0430\u0442\u0443\u0441 \u043f\u0435\u0440\u0435\u043c\u0435\u0449\u0435\u043d\u0438\u044f Status: \\ Cleanup - \u043d\u0443\u0436\u043d\u043e \u043f\u043e\u0434\u043e\u0436\u0434\u0430\u0442\u044c \\ Queued - \u0432 \u043e\u0447\u0435\u0440\u0435\u0434\u0438 \\ InProgress - \u0432 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0435 \\ Percent Complete - \u043f\u0440\u043e\u0446\u0435\u043d\u0442 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \\ CompletionInProgress - \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u0435 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 \\ Completed - \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u043e Remove-MoveRequest -Identity $db_name \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u043f\u0435\u0440\u0435\u043c\u0435\u0449\u0435\u043d\u0438\u044f (\u0443\u0431\u0440\u0430\u0442\u044c \u0441\u0442\u0430\u0442\u0443\u0441 \u043f\u0435\u0440\u0435\u043c\u0435\u0449\u0435\u043d\u0438\u044f \u0441 \u043f\u043e\u0447\u0442\u043e\u0432\u043e\u0433\u043e \u044f\u0449\u0438\u043a\u0430 \u0438 \u043e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u0435\u0440\u0435\u043c\u0435\u0449\u0435\u043d\u0438\u0439) \\ Get-MailboxDatabase | Select Name, MailboxRetention \u043f\u043e\u0441\u043b\u0435 \u043f\u0435\u0440\u0435\u043c\u0435\u0449\u0435\u043d\u0438\u044f \u044f\u0449\u0438\u043a\u043e\u0432, \u0440\u0430\u0437\u043c\u0435\u0440 \u0431\u0430\u0437\u044b \u043d\u0435 \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u0441\u044f, \u043f\u043e\u043b\u043d\u043e\u0435 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0438\u0437 \u0431\u0430\u0437\u044b \u043f\u0440\u043e\u0438\u0437\u043e\u0439\u0434\u0435\u0442, \u043a\u0430\u043a \u043f\u0440\u043e\u0439\u0434\u0435\u0442 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0434\u043d\u0435\u0439, \u0432\u044b\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043d\u043e\u0435 \u0432 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0435 MailboxRetention \\ Set-MailboxDatabase -MailboxRetention '0.00:00:00' -Identity $db_name \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435","title":"MoveRequest"},{"location":"#archive","text":"Enable-Mailbox -Identity $name -Archive \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0430\u0440\u0445\u0438\u0432 \u0434\u043b\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \\ Get-Mailbox $name | New-MoveReques \u2013ArchiveOnly \u2013ArchiveTargetDatabase DBArch \u043f\u0435\u0440\u0435\u043c\u0435\u0441\u0442\u0438\u0442\u044c \u0430\u0440\u0445\u0438\u0432\u043d\u044b\u0439 \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0439 \u044f\u0449\u0438\u043a \u0432 \u0434\u0440\u0443\u0433\u0443\u044e \u0411\u0414 \\ Get-Mailbox $name | fl Name,Database,ArchiveDatabase \u043c\u0435\u0441\u0442\u043e \u0440\u0430\u0441\u043f\u043e\u043b\u043e\u0436\u0435\u043d\u0438\u044f \u0411\u0414 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0438 \u0411\u0414 \u0435\u0433\u043e \u0430\u0440\u0445\u0438\u0432\u0430 \\ Disable-Mailbox -Identity $name -Archive \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0430\u0440\u0445\u0438\u0432 \\ Connect-Mailbox -Identity \"8734c04e-981e-4ccf-a547-1c1ac7ebf3e2\" -Archive -User $name -Database it2 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u0430\u0440\u0445\u0438\u0432\u0430 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u043a \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u043c\u0443 \u043f\u043e\u0447\u0442\u043e\u0432\u043e\u043c\u0443 \u044f\u0449\u0438\u043a\u0443 \\ Get-Mailbox $name | Set-Mailbox -ArchiveQuota 20GB -ArchiveWarningQuota 19GB \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u043a\u0432\u043e\u0442\u044b \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0430\u0440\u0445\u0438\u0432\u0430","title":"Archive"},{"location":"#quota","text":"Get-Mailbox -Identity $mailbox | fl IssueWarningQuota, ProhibitSendQuota, ProhibitSendReceiveQuota, UseDatabaseQuotaDefaults \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043a\u0432\u043e\u0442\u044b \u043f\u043e\u0447\u0442\u043e\u0432\u043e\u0433\u043e \u044f\u0449\u0438\u043a\u0430 \\ IssueWarningQuota \u2014 \u043a\u0432\u043e\u0442\u0430, \u043f\u0440\u0438 \u0434\u043e\u0441\u0442\u0438\u0436\u0435\u043d\u0438\u0438 \u043a\u043e\u0442\u043e\u0440\u043e\u0439 Exchange \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442 \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0435 \\ ProhibitSendQuota \u2014 \u043f\u0440\u0438 \u0434\u043e\u0441\u0442\u0438\u0436\u0435\u043d\u0438\u0438 \u0431\u0443\u0434\u0435\u0442 \u0437\u0430\u043f\u0440\u0435\u0449\u0435\u043d\u0430 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0430 \\ ProhibitSendReceiveQuota \u2014 \u043f\u0440\u0438 \u0434\u043e\u0441\u0442\u0438\u0436\u0435\u043d\u0438\u0438 \u0431\u0443\u0434\u0435\u0442 \u0437\u0430\u043f\u0440\u0435\u0449\u0435\u043d\u0430 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0430 \u0438 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 \\ UseDatabaseQuotaDefaults \u2014 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u043b\u0438 \u043a\u0432\u043e\u0442\u0430 \u0411\u0414 \u0438\u043b\u0438 false - \u0438\u043d\u0434\u0432\u0438\u0434\u0438\u0443\u0430\u043b\u044c\u043d\u044b\u0435 \\ Set-Mailbox -Identity $mailbox -UseDatabaseQuotaDefaults $false -IssueWarningQuota \"3 GB\" -ProhibitSendQuota \"4 GB\" -ProhibitSendReceiveQuota \"5 GB\" \u0437\u0430\u0434\u0430\u0442\u044c \u043a\u0432\u043e\u0442\u0443 \u0434\u043b\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f Get-MailboxDatabase $db_name | fl Name, *Quota \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043a\u0432\u043e\u0442\u044b \u043d\u0430\u043b\u043e\u0436\u0435\u043d\u043d\u044b\u0435 \u043d\u0430 \u0411\u0414 \\ Set-MailboxDatabase $db -ProhibitSendReceiveQuota \"5 GB\" -ProhibitSendQuota \"4 GB\" -IssueWarningQuota \"3 GB\" \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u043a\u0432\u043e\u0442\u044b \u043d\u0430 \u0411\u0414","title":"Quota"},{"location":"#database","text":"Get-MailboxDatabase -Status | select ServerName,Name,DatabaseSize \u0441\u043f\u0438\u0441\u043e\u043a \u0438 \u0440\u0430\u0437\u043c\u0435\u0440 \u0432\u0441\u0435\u0445 \u0411\u0414 \u043d\u0430 \u0432\u0441\u0435\u0445 MX-\u0441\u0435\u0440\u0432\u0435\u0440\u0430\u0445 \\ New-MailboxDatabase -Name it_2022 -EdbFilePath E:\\Bases\\it_2022\\it_2022.edb -LogFolderPath G:\\Logs\\it_2022 -OfflineAddressBook \"Default Offline Address List\" -server exch-mx-01 \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0411\u0414 \\ Restart-Service MSExchangeIS \\ Get-Service | Where {$_ -match \"exchange\"} | Restart-Service \\ Get-MailboxDatabase -Server exch-01 \u0441\u043f\u0438\u0441\u043e\u043a \u0431\u0430\u0437 \u0434\u0430\u043d\u043d\u044b\u0445 \u043d\u0430 MX-\u0441\u0435\u0440\u0432\u0435\u0440\u0435 \\ New-MoveRequest -Identity \"support4\" -TargetDatabase it_2022 \u043f\u0435\u0440\u0435\u043c\u0435\u0441\u0442\u0438\u0442\u044c \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0439 \u044f\u0449\u0438\u043a \u0432 \u043d\u043e\u0432\u0443\u044e \u0411\u0414 \\ Move-Databasepath $db_name \u2013EdbFilepath \"F:\\DB\\$db_name\\$db_name.edb\" \u2013LogFolderpath \"E:\\DB\\$db_name\\logs\\\" \u043f\u0435\u0440\u0435\u043c\u0435\u0441\u0442\u0438\u0442\u044c \u0411\u0414 \u0438 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u043e\u043d\u043d\u044b\u0435 \u043b\u043e\u0433\u0438 \u043d\u0430 \u0434\u0440\u0443\u0433\u043e\u0439 \u0434\u0438\u0441\u043a \\ Set-MailboxDatabase -CircularLoggingEnabled $true -Identity $db_name \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0446\u0438\u043a\u043b\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u0432\u0435\u0434\u0435\u043d\u0438\u0435 \u0436\u0443\u0440\u043d\u0430\u043b\u0430 (Circular Logging), \u0433\u0434\u0435 \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u043f\u0438\u0448\u0443\u0442\u0441\u044f 4 \u0444\u0430\u0439\u043b\u0430 \u043b\u043e\u0433\u043e\u0432 \u043f\u043e 5 \u041c\u0411, \u043f\u043e\u0441\u043b\u0435 \u0447\u0435\u0433\u043e \u043f\u0435\u0440\u0432\u044b\u0439 \u043b\u043e\u0433-\u0444\u0430\u0439\u043b \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0438\u0441\u044b\u0432\u0430\u0435\u0442\u0441\u044f \\ Set-MailboxDatabase -CircularLoggingEnabled $false -Identity $db_name \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0446\u0438\u043a\u043b\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u0432\u0435\u0434\u0435\u043d\u0438\u0435 \u0436\u0443\u0440\u043d\u0430\u043b\u0430 \\ Get-MailboxDatabase -Server \"exch-mx-01\" -Status | select EdbFilePath,LogFolderPath,LogFilePrefix \u043f\u0443\u0442\u044c \u043a \u0411\u0414, \u043b\u043e\u0433\u0430\u043c, \u0438\u043c\u044f \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u0430\u043a\u0442\u0443\u0430\u043b\u044c\u043d\u043e\u0433\u043e \u043b\u043e\u0433-\u0444\u0430\u0439\u043b\u0430","title":"Database"},{"location":"#mailboxrepairrequest","text":"New-MailboxRepairRequest -Database it2 -CorruptionType ProvisionedFolder, SearchFolder, AggregateCounts, Folderview \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u0442\u0435\u0441\u0442 (\u0432 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0439 \u043c\u043e\u043c\u0435\u043d\u0442 \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u043d\u0435 \u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d \u043e\u0434\u0438\u043d \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0439 \u044f\u0449\u0438\u043a) \u0438 \u0438\u0441\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043e\u0448\u0438\u0431\u043e\u043a \u043d\u0430 \u043f\u0440\u0438\u043a\u043b\u0430\u0434\u043d\u043e\u043c \u0443\u0440\u043e\u0432\u043d\u0435 \\ Get-MailboxRepairRequest -Database it2 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \\ \u041f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0438\u0441\u043f\u0440\u0430\u0432\u0438\u0442\u044c: \\ ProvisionedFolder \u2013 \u043d\u0430\u0440\u0443\u0448\u0435\u043d\u0438\u044f \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u043e\u0439 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u044b \u043f\u0430\u043f\u043e\u043a \\ SearchFolder \u2013 \u043e\u0448\u0438\u0431\u043a\u0438 \u0432 \u043f\u0430\u043f\u043a\u0430\u0445 \u043f\u043e\u0438\u0441\u043a\u0430 \\ AggregateCounts \u2013 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0438 \u0438\u0441\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438 \u043e \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u0435 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432 \u0432 \u043f\u0430\u043f\u043a\u0430\u0445 \u0438 \u0438\u0445 \u0440\u0430\u0437\u043c\u0435\u0440\u0435 \\ FolderView \u2013 \u043d\u0435\u0432\u0435\u0440\u043d\u043e\u0435 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435, \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u043c\u043e\u0435 \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u044f\u043c\u0438 \u043f\u0430\u043f\u043e\u043a","title":"MailboxRepairRequest"},{"location":"#eseutil","text":"\u041f\u0440\u0438 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0435/\u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0438 \u043b\u044e\u0431\u043e\u0433\u043e \u043f\u0438\u0441\u044c\u043c\u0430 Exchange \u0441\u043d\u0430\u0447\u0430\u043b\u0430 \u0432\u043d\u043e\u0441\u0438\u0442 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u0432 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u043e\u043d\u043d\u044b\u0439 \u043b\u043e\u0433, \u0438 \u0442\u043e\u043b\u044c\u043a\u043e \u043f\u043e\u0442\u043e\u043c \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u0442 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 \u043d\u0435\u043f\u043e\u0441\u0440\u0435\u0434\u0441\u0442\u0432\u0435\u043d\u043d\u043e \u0432 \u0431\u0430\u0437\u0443 \u0434\u0430\u043d\u043d\u044b\u0445. \u0420\u0430\u0437\u043c\u0435\u0440 \u043e\u0434\u043d\u043e\u0433\u043e \u043b\u043e\u0433 \u0444\u0430\u0439\u043b\u0430 - 1 \u041c\u0431. \u0415\u0441\u0442\u044c \u0442\u0440\u0438 \u0441\u043f\u043e\u0441\u043e\u0431\u0430 \u0443\u0440\u0435\u0437\u0430\u043d\u0438\u044f \u043b\u043e\u0433\u043e\u0432: DAG, Backup \u043d\u0430 \u0431\u0430\u0437\u0435 Volume Shadow Copy, Circular Logging. \u0420\u0443\u0447\u043d\u043e\u0435 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0436\u0443\u0440\u043d\u0430\u043b\u043e\u0432 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439: \\ cd E:\\MS_Exchange_2010\\MailBox\\Reg_v1_MailBoxes\\ \u043f\u0435\u0440\u0435\u0439\u0442\u0438 \u0432 \u043a\u0430\u0442\u0430\u043b\u043e\u0433 \u0441 \u043b\u043e\u0433\u0430\u043c\u0438 \\ ls E*.chk \u0443\u0437\u043d\u0430\u0442\u044c \u0438\u043c\u044f \u0444\u0430\u0439\u043b\u0430, \u0432 \u043a\u043e\u0442\u043e\u0440\u043e\u043c \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u0438\u0437 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044c\u043d\u043e\u0439 \u0442\u043e\u0447\u043a\u0438 \u0444\u0438\u043a\u0441\u0430\u0446\u0438\u0438 \u0436\u0443\u0440\u043d\u0430\u043b\u043e\u0432 \\ eseutil /mk .\\E18.chk \u0443\u0437\u043d\u0430\u0442\u044c \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0439 \u0444\u0430\u0439\u043b \u0436\u0443\u0440\u043d\u0430\u043b\u0430, \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f \u0438\u0437 \u043a\u043e\u0442\u043e\u0440\u043e\u0433\u043e \u0431\u044b\u043b\u0438 \u0437\u0430\u043d\u0435\u0441\u0435\u043d\u044b \u0432 \u0411\u0414 Exchange \\ Checkpoint: (0x561299,8,16) 561299 \u0438\u043c\u044f \u0444\u0430\u0439\u043b\u0430, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0431\u044b\u043b \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u043c \u0437\u0430\u0444\u0438\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d (\u0435\u0433\u043e \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u0443\u0436\u0435 \u0432 \u0431\u0430\u0437\u0435 \u0434\u0430\u043d\u043d\u044b\u0445) \\ \u041d\u0430\u0445\u043e\u0434\u0438\u043c \u0432 \u043f\u0440\u043e\u0432\u043e\u0434\u043d\u0438\u043a\u0435 \u0444\u0430\u0439\u043b E0500561299.txt, \u043c\u043e\u0436\u043d\u043e \u0443\u0434\u0430\u043b\u044f\u0442\u044c \u0432\u0441\u0435 \u0444\u0430\u0439\u043b\u044b \u0436\u0443\u0440\u043d\u0430\u043b\u043e\u0432, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0441\u0442\u0430\u0440\u0448\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043d\u043e\u0433\u043e \u0444\u0430\u0439\u043b\u0430 \u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0411\u0414 (\u0435\u0441\u043b\u0438 \u0434\u0432\u0435 \u043a\u043e\u043f\u0438\u0438 \u0411\u0414 \u0441 \u043e\u0448\u0438\u0431\u043a\u043e\u0439): \\ Get-MailboxDatabaseCopyStatus -Identity db_name\\* | Format-List Name,Status,ContentIndexState \\ Status : FailedAndSuspended \\ ContentIndexState : Failed \\ Status : Dismounted \\ ContentIndexState : Failed Get-MailboxDatabase -Server exch-mx-01 -Status | fl Name,EdbFilePath,LogFolderPath \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0440\u0430\u0441\u043f\u043e\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u0431\u0430\u0437\u044b \u0438 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u043e\u043d\u043d\u044b\u0445 \u043b\u043e\u0433\u043e\u0432 \\ LogFolderPath - \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u044f \u043b\u043e\u0433\u043e\u0432 \\ E18 - \u0438\u043c\u044f \u0442\u0440\u0430\u043d\u043a\u0437\u0430\u043a\u0446\u0438\u043e\u043d\u043d\u043e\u0433\u043e \u043b\u043e\u0433\u0430 (\u0438\u0437 \u043d\u0435\u0433\u043e \u0447\u0438\u0442\u0430\u044e\u0442\u0441\u044f \u043e\u0441\u0442\u0430\u043b\u044c\u043d\u044b\u0435 \u043b\u043e\u0433\u0438) \\ dismount-Database db_name \u043e\u0442\u043c\u0430\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0411\u0414 \\ eseutil /mh D:\\MS_Exchange_2010\\Mailbox\\db_name\\db_name.edb \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0431\u0430\u0437\u0443 \\ State: Dirty Shutdown - \u043d\u0435\u0441\u043e\u0433\u043b\u0430\u0441\u043e\u0432\u0430\u043d\u043d\u043e\u0435 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435, \u043e\u0437\u043d\u0430\u0447\u0430\u0435\u0442, \u0447\u0442\u043e \u0447\u0430\u0441\u0442\u044c \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439 \u043d\u0435 \u043f\u0435\u0440\u0435\u043d\u0435\u0441\u0435\u043d\u0430 \u0432 \u0431\u0430\u0437\u0443, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u043f\u043e\u0441\u043b\u0435 \u0442\u043e\u0433\u043e, \u043a\u0430\u043a \u0431\u044b\u043b\u0430 \u043e\u0441\u0443\u0449\u0435\u0441\u0442\u0432\u043b\u0435\u043d\u0430 \u0430\u0432\u0430\u0440\u0438\u0439\u043d\u0430\u044f \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430. \\ eseutil /ml E:\\MS_Exchange_2010\\MailBox\\db_name\\E18 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0446\u0435\u043b\u043e\u0441\u0442\u043d\u043e\u0441\u0442\u0438 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u043e\u043d\u043d\u044b\u0445 \u043b\u043e\u0433\u0438, \u0435\u0441\u043b\u0438 \u0435\u0441\u0442\u044c \u043b\u043e\u0433\u0438 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439 \u0438 \u043e\u043d\u0438 \u043d\u0435 \u0438\u0441\u043f\u043e\u0440\u0447\u0435\u043d\u044b, \u0442\u043e \u043c\u043e\u0436\u043d\u043e \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0438\u0437 \u043d\u0438\u0445, \u0438\u0437 \u0444\u0430\u0439\u043b\u0430 E18 \u0441\u0447\u0438\u0442\u044b\u0432\u0430\u044e\u0442\u0441\u044f \u0432\u0441\u0435 \u043b\u043e\u0433\u0438, \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u0441\u0442\u0430\u0442\u0443\u0441 - \u041e\u041a Soft Recovery (\u043c\u044f\u0433\u043a\u043e\u0435 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435) - \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043f\u0435\u0440\u0435\u0432\u0435\u0441\u0442\u0438 \u0431\u0430\u0437\u0443 \u0432 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e\u0433\u043e \u043e\u0442\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f (Clear shutdown) \u043f\u0443\u0442\u0435\u043c \u0437\u0430\u043f\u0438\u0441\u0438 \u043d\u0435\u0434\u043e\u0441\u0442\u0430\u044e\u0449\u0438\u0445 \u0444\u0430\u0439\u043b\u043e\u0432 \u0436\u0443\u0440\u043d\u0430\u043b\u043e\u0432 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439 \u0432 \u0411\u0414. \\ eseutil /R E18 /l E:\\MS_Exchange_2010\\MailBox\\db_name\\ /d D:\\MS_Exchange_2010\\Mailbox\\db_name\\db_name.edb \\ eseutil /R E18 /a /i /l E:\\MS_Exchange_2010\\MailBox\\db_name\\ /d D:\\MS_Exchange_2010\\Mailbox\\db_name\\db_name.edb \u0435\u0441\u043b\u0438 \u0441 \u043b\u043e\u0433\u0430\u043c\u0438 \u0447\u0442\u043e-\u0442\u043e \u043d\u0435 \u0442\u0430\u043a, \u043c\u043e\u0436\u043d\u043e \u043f\u043e\u043f\u0440\u043e\u0431\u043e\u0432\u0430\u0442\u044c \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0431\u0430\u0437\u0443 \u0438\u0433\u043d\u043e\u0440\u0438\u0440\u0443\u044f \u043e\u0448\u0438\u0431\u043a\u0443 \u0432 \u043b\u043e\u0433\u0430\u0445 \\ eseutil /mk D:\\MS_Exchange_2010\\Mailbox\\db_name\\db_name.edb c\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0438 \u0444\u0430\u0439\u043b\u0430 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044c\u043d\u044b\u0445 \u0442\u043e\u0447\u0435\u043a \\ eseutil /g D:\\MS_Exchange_2010\\Mailbox\\db_name\\db_name.edb \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0446\u0435\u043b\u043e\u0441\u0442\u043d\u043e\u0441\u0442\u0438 \u0411\u0414 \\ eseutil /k D:\\MS_Exchange_2010\\Mailbox\\db_name\\db_name.edb \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044c\u043d\u044b\u0445 \u0441\u0443\u043c\u043c \u0431\u0430\u0437\u044b (CRC) Hard Recovery - \u0435\u0441\u043b\u0438 \u043b\u043e\u0433\u0438 \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442 \u043e\u0448\u0438\u0431\u043a\u0438 \u0438 \u0431\u0430\u0437\u0430 \u043d\u0435 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u0442\u0441\u044f, \u0442\u043e \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u043c \u0431\u0430\u0437\u0443 \u0431\u0435\u0437 \u043b\u043e\u0433\u043e\u0432. \\ eseutil /p D:\\MS_Exchange_2010\\Mailbox\\db_name\\db_name.edb \\ /p - \u0443\u0434\u0430\u043b\u0438\u0442 \u043f\u043e\u0432\u0440\u0435\u0436\u0434\u0435\u043d\u043d\u044b\u0435 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b, \u044d\u0442\u0430 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u0431\u0443\u0434\u0435\u0442 \u0443\u0434\u0430\u043b\u0435\u043d\u0430 \u0438\u0437 \u0411\u0414 \u0438 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442 \u0446\u0435\u043b\u043e\u0441\u0442\u043d\u043e\u0441\u0442\u044c \\ esetuil /d D:\\MS_Exchange_2010\\Mailbox\\db_name\\db_name.edb \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0434\u0435\u0444\u0440\u0430\u0433\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044e (\u0435\u0441\u043b\u0438 \u0431\u044b\u043b \u043f\u043e\u0442\u0435\u0440\u044f\u043d \u0431\u043e\u043b\u044c\u0448\u043e\u0439 \u043e\u0431\u044a\u0435\u043c \u0434\u0430\u043d\u043d\u044b\u0445, \u0442\u043e \u043c\u043e\u0436\u0435\u0442 \u0441\u0438\u043b\u044c\u043d\u043e \u0441\u043d\u0438\u0437\u0438\u0442\u044c\u0441\u044f \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c) \\ \u041f\u043e\u0441\u043b\u0435 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u043a\u043e\u043c\u0430\u043d\u0434 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0432\u0440\u0443\u0447\u043d\u0443\u044e \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u0441\u0435 \u0444\u0430\u0439\u043b\u044b \u0441 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u0435\u043c log \u0432 \u043f\u0430\u043f\u043a\u0435 MDBDATA, \u043f\u0435\u0440\u0435\u0434 \u043f\u043e\u043f\u044b\u0442\u043a\u043e\u0439 \u0441\u043c\u043e\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0431\u0430\u0437\u0443 \u0434\u0430\u043d\u043d\u044b\u0445. \\ isinteg -s \"db_name.edb\" -test alltests \u043f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u0446\u0435\u043b\u043e\u0441\u0442\u043d\u043e\u0441\u0442\u044c \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 \\ isinteg -s \"server_name\" -fix -test -alltests \u0435\u0441\u043b\u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0431\u0443\u0434\u0435\u0442 \u043f\u0440\u043e\u0432\u0430\u043b\u0435\u043d\u0430. \u0412\u044b\u043f\u043e\u043b\u043d\u044f\u0442\u044c \u043a\u043e\u043c\u0430\u043d\u0434\u0443 \u0434\u043e \u0442\u0435\u0445 \u043f\u043e\u0440, \u043f\u043e\u043a\u0430 \u0443 \u0432\u0441\u0435\u0445 \u043e\u0448\u0438\u0431\u043e\u043a \u043d\u0435 \u0441\u0442\u0430\u043d\u0435\u0442 \u0441\u0442\u0430\u0442\u0443\u0441 0 \u0438\u043b\u0438 \u0441\u0442\u0430\u0442\u0443\u0441 \u043d\u0435 \u043f\u0435\u0440\u0435\u0441\u0442\u0430\u043d\u0435\u0442 \u043c\u0435\u043d\u044f\u0442\u044c\u0441\u044f, \u0438\u043d\u043e\u0433\u0434\u0430 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e 3 \u043f\u0440\u043e\u0445\u043e\u0434\u0430 \u0434\u043b\u044f \u0434\u043e\u0441\u0442\u0438\u0436\u0435\u043d\u0438\u044f \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0430. \\ eseutil /mh D:\\MS_Exchange_2010\\Mailbox\\db_name\\db_name.edb | Select-String -Pattern \"State:\",\"Log Required:\" \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0441\u0442\u0430\u0442\u0443\u0441 \\ State: Clear shutdown - \u0443\u0441\u043f\u0435\u0448\u043d\u044b\u0439 \u0441\u0442\u0430\u0442\u0443\u0441 \\ Log Required \u0442\u0440\u0435\u0431\u0443\u044e\u0442\u0441\u044f \u043b\u0438 \u0444\u0430\u0439\u043b\u044b \u0436\u0443\u0440\u043d\u0430\u043b\u043e\u0432, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u044b\u0435 \u0431\u0430\u0437\u0435, \u0447\u0442\u043e\u0431\u044b \u043f\u0435\u0440\u0435\u0439\u0442\u0438 \u0432 \u0441\u043e\u0433\u043b\u0430\u0441\u043e\u0432\u0430\u043d\u043d\u043e\u0435 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435. \u0415\u0441\u043b\u0438 \u0431\u0430\u0437\u0430 \u0440\u0430\u0437\u043c\u043e\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0430 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e, \u0442\u043e \u044d\u0442\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0431\u0443\u0434\u0435\u0442 \u0440\u0430\u0432\u043d\u044f\u0442\u044c\u0441\u044f 0. \\ mount-Database -force db_name \u043f\u0440\u0438\u043c\u043e\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0411\u0414 \\ Get-MailboxDatabase \u2013Status db_name | fl Mounted \u0441\u0442\u0430\u0442\u0443\u0441 \u0411\u0414 \\ New-MailboxRepairRequest -Database db_name -CorruptionType SearchFolder,AggregateCounts,ProvisionedFolder,FolderView \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u043e\u0439 \u0446\u0435\u043b\u043e\u0441\u0442\u043d\u043e\u0441\u0442\u0438 \u0434\u0430\u043d\u043d\u044b\u0445 \\ \u041f\u043e\u0441\u043b\u0435 \u044d\u0442\u043e\u0433\u043e \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c Index. \\ \u0415\u0441\u043b\u0438 \u0438\u043d\u0434\u0435\u043a\u0441\u044b \u043d\u0435 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u044e\u0442\u0441\u044f, \u043d\u043e \u0411\u0414 \u043c\u043e\u043d\u0442\u0438\u0440\u0443\u0435\u0442\u0441\u044f, \u0442\u043e \u043f\u0435\u0440\u0435\u043d\u0435\u0441\u0442\u0438 \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0435 \u044f\u0449\u0438\u043a\u0438 \u0432 \u043d\u043e\u0432\u0443\u044e \u0411\u0414. \u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0411\u0414 \u0438\u0437 Backup: 1-\u0439 \u0432\u0430\u0440\u0438\u0430\u043d\u0442: 1. \u041e\u0442\u043c\u0430\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0442\u0435\u043a\u0443\u0449\u0443\u044e \u0411\u0414 \u0438 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0438\u043b\u0438 \u043f\u0435\u0440\u0435\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u0442\u044c \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u044e \u0441 \u0444\u0430\u0439\u043b\u0430\u043c\u0438 \u0442\u0435\u043a\u0443\u0449\u0435\u0439 \u0411\u0414. 3. \u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0432 \u0442\u0443 \u0436\u0435 \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u044e \u0438\u0437 Backup \u0431\u0430\u0437\u0443 \u0441 \u043b\u043e\u0433\u0430\u043c\u0438. 4. \u0417\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u043c\u044f\u0433\u043a\u043e\u0435 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0411\u0414 (Soft Recovery). 5. \u041f\u0440\u0438\u043c\u043e\u043d\u0438\u0442\u043e\u0440\u0432\u0430\u0442\u044c. 2-\u0439 \u0432\u0430\u0440\u0438\u0430\u043d\u0442: 1. \u041e\u0442\u043c\u0430\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0438 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0442\u0435\u043a\u0443\u0449\u0443\u044e \u0411\u0414. 2. \u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0411\u0414 \u0441 \u043b\u043e\u0433\u0430\u043c\u0438 \u0438\u0437 Backup \u0432 \u043b\u044e\u0431\u043e\u0435 \u043c\u0435\u0441\u0442\u043e. 3. \u0417\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u043c\u044f\u0433\u043a\u043e\u0435 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0411\u0414 (Soft Recovery). 4. \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043d\u043e\u0432\u0443\u044e \u0411\u0414. 5. \u0421\u043e\u0437\u0434\u0430\u0442\u044c Recovery Database \u0438 \u0441\u043c\u043e\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u043d\u0435\u0435 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u0443\u044e \u0438\u0437 \u0431\u044d\u043a\u0430\u043f\u0430 \u0411\u0414, \u0441\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0438\u0437 \u043d\u0435\u0451 \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0435 \u044f\u0449\u0438\u043a\u0438 \u0432 \u043d\u043e\u0432\u0443\u044e \u0411\u0414 \u0438 \u043f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043d\u0430 \u043d\u0438\u0445 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439. 6. \u0415\u0441\u043b\u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c Dial Tone Recovery, \u0442\u043e \u0442\u0430\u043a \u0436\u0435 \u043f\u0435\u0440\u0435\u043d\u0435\u0441\u0442\u0438 \u0438\u0437 \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e\u0439 \u0411\u0414 \u043f\u0440\u043e\u043c\u0435\u0436\u0443\u0442\u043e\u0447\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0445 \u044f\u0449\u0438\u043a\u043e\u0432. 3-\u0439 \u0432\u0430\u0440\u0438\u0430\u043d\u0442: 1. \u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0446\u0435\u043b\u043e\u0441\u0442\u043d\u043e\u0441\u0442\u044c Soft Repair \u0438\u043b\u0438 Hard Recovery. 2. \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043d\u043e\u0432\u0443\u044e \u0411\u0414. \u0423\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c \u0432 \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430\u0445: \u00ab\u0431\u0430\u0437\u0430 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0438\u0441\u0430\u043d\u0430 \u043f\u0440\u0438 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0438\u00bb. 3. \u0415\u0441\u043b\u0438 \u0431\u0430\u0437\u0430 \u0431\u044b\u043b\u0430 \u0442\u043e\u043b\u044c\u043a\u043e \u0447\u0442\u043e \u043e\u0437\u0434\u0430\u043d\u0430 \u0438 \u0435\u0449\u0435 \u043d\u0435 \u0431\u044b\u043b\u0430 \u043f\u043e\u0434\u043c\u043e\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0430, \u0442\u043e \u044d\u0442\u0430 \u043f\u0430\u043f\u043a\u0430 \u0431\u0443\u0434\u0435\u0442 \u043f\u0443\u0441\u0442\u0430, \u0442\u0443\u0434\u0430 \u043f\u0435\u0440\u0435\u043c\u0435\u0449\u0430\u0435\u043c \u0431\u0430\u0437\u0443 \u0438\u0437 Backup, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u0431\u044b\u043b\u0430 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u043d\u0430 ESEUTIL \u0432\u043c\u0435\u0441\u0442\u0435 \u0441\u043e \u0432\u0441\u0435\u043c\u0438 \u0444\u0430\u0439\u043b\u0430\u043c\u0438. \u0423\u043a\u0430\u0437\u0430\u0442\u044c \u0438\u043c\u044f .edb \u0442\u0430\u043a\u043e\u0435 \u0436\u0435, \u043a\u043e\u0442\u043e\u0440\u043e\u0435 \u0431\u044b\u043b\u043e \u043f\u0440\u0438 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0438 \u043d\u043e\u0432\u043e\u0439 \u0431\u0430\u0437\u044b. 4. \u041c\u043e\u043d\u0442\u0438\u0440\u0443\u0435\u043c \u0431\u0430\u0437\u0443. 5. \u041f\u0435\u0440\u0435\u043d\u0430\u0446\u0435\u043b\u0438\u0432\u0430\u0435\u043c \u044f\u0449\u0438\u043a\u0438 \u0441\u043e \u0441\u0442\u0430\u0440\u043e\u0439 (Mailbox_DB_02), \u043d\u0435\u0438\u0441\u043f\u0440\u0430\u0432\u043d\u043e\u0439 \u0431\u0430\u0437\u044b, \u043d\u0430 \u043d\u043e\u0432\u0443\u044e \u0431\u0430\u0437\u0443 (Mailbox_DB_02_02): Get-Mailbox -Database Mailbox_DB_02 | where {$_.ObjectClass -NotMatch '(SystemAttendantMailbox|ExOleDbSystemMailbox)'} | Set-Mailbox -Database Mailbox_DB_02_02 6. \u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u043e\u0439 \u0446\u0435\u043b\u043e\u0441\u0442\u043d\u043e\u0441\u0442\u0438 \u0434\u0430\u043d\u043d\u044b\u0445: New-MailboxRepairRequest -Database \"Mailbox_DB_02_02\" -CorruptionType ProvisionedFolder, SearchFolder, AggregateCounts, Folderview","title":"eseutil"},{"location":"#dial-tone-recovery","text":"Get-Mailbox -Database \"MailboxDB\" | Set-Mailbox -Database \"TempDB\" \u043f\u0435\u0440\u0435\u043d\u0430\u0446\u0435\u043b\u0438\u0442\u044c \u044f\u0449\u0438\u043a\u0438 \u0441 \u043e\u0434\u043d\u043e\u0439 \u0411\u0414 (\u043d\u0435\u0440\u0430\u0431\u043e\u0447\u0435\u0439) \u043d\u0430 \u0434\u0440\u0443\u0433\u0443\u044e (\u043f\u0443\u0441\u0442\u0443\u044e) \\ Get-Mailbox -Database TempDB \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0435 \u044f\u0449\u0438\u043a\u0438 \u0432 \u0411\u0414 TempDB \\ Restart-Service MSExchangeIS \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0441\u043b\u0443\u0436\u0431\u0443 Mailbox Information Store (\u0431\u0430\u043d\u043a\u0430 \u0434\u0430\u043d\u043d\u044b\u0445), \u0438\u043d\u0430\u0447\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438 \u0431\u0443\u0434\u0443\u0442 \u043f\u043e-\u043f\u0440\u0435\u0436\u043d\u0435\u043c\u0443 \u043f\u044b\u0442\u0430\u0442\u044c\u0441\u044f \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f \u043a \u0441\u0442\u0430\u0440\u043e\u0439 \u0411\u0414 \\ iisreset \\ Get-Mailbox -Database \"TempDB\" | Set-Mailbox -Database \"MailboxDB\" \u043f\u043e\u0441\u043b\u0435 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0441\u0442\u0430\u0440\u043e\u0439 \u0411\u0414, \u043d\u0443\u0436\u043d\u043e \u043f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \u0441 \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e\u0439 \u0411\u0414 \u043e\u0431\u0440\u0430\u0442\u043d\u043e \\ \u041f\u043e\u0441\u043b\u0435 \u044d\u0442\u043e\u0433\u043e \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u0441\u043b\u0438\u044f\u043d\u0438\u0435 \u0441 \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e\u0439 \u0411\u0414 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e Recovery.","title":"Dial Tone Recovery"},{"location":"#recovery-database-rdb","text":"New-MailboxDatabase \u2013Recovery \u2013Name RecoveryDB \u2013Server $exch_mx \u2013EdbFilePath \"D:\\TempDB\\TempDB.edb\" -LogFolderPath \"D:\\TempDB\" \u0434\u043b\u044f \u043f\u0435\u0440\u0435\u043d\u043e\u0441\u0430 \u043d\u043e\u0432\u044b\u0445 \u043f\u0438\u0441\u0435\u043c \u0438\u0437 \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e\u0439 \u0411\u0414 \u0432 \u043e\u0441\u043d\u043e\u0432\u043d\u0443\u044e \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c \u0442\u043e\u043b\u044c\u043a\u043e \u0441\u0430\u043c \u0444\u0430\u0439\u043b TempDB.edb \u0441\u043e \u0441\u0442\u0430\u0442\u0443\u0441\u043e\u043c Clean Shutdown, \u0438\u0437 \u043d\u0435\u0435 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0441\u043b\u0443\u0436\u0435\u0431\u043d\u0443\u044e \u0411\u0414 (\u043a\u043b\u044e\u0447 -Recovery) \\ Mount-Database \"D:\\TempDB\\TempDB.edb\" \u043f\u0440\u0438\u043c\u043e\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0411\u0414 \\ Get-MailboxStatistics -Database RecoveryDB \\ New-MailboxRestoreRequest \u2013SourceDatabase RecoveryDB \u2013SourceStoreMailbox support \u2013TargetMailbox support \u0441\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u043f\u043e\u0447\u0442\u043e\u0432\u043e\u0433\u043e \u044f\u0449\u0438\u043a\u0430 \u0441 DisplayName: support \u0438\u0437 RecoveryDB \u0432 \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0439 \u044f\u0449\u0438\u043a \u0441 \u043f\u0441\u0435\u0432\u0434\u043e\u043d\u0438\u043c\u043e\u043c support \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0435\u0439 \u0431\u0430\u0437\u044b. \u041f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \u0438\u0449\u0435\u0442 \u0432 \u043f\u043e\u0447\u0442\u043e\u0432\u043e\u0439 \u0431\u0430\u0437\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u044e\u0449\u0438\u0435 LegacyExchangeDN \u043b\u0438\u0431\u043e \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0435 \u0430\u0434\u0440\u0435\u0441\u0430 X500, \u0435\u0441\u043b\u0438 \u043d\u0443\u0436\u043d\u043e \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u0434\u0440\u0443\u0433\u043e\u0439 \u044f\u0449\u0438\u043a, \u043d\u0443\u0436\u043d\u043e \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c \u043a\u043b\u044e\u0447 -AllowLegacyDNMisMatch \\ New-MailboxRestoreRequest \u2013SourceDatabase RecoveryDB \u2013SourceStoreMailbox support \u2013TargetMailbox support \u2013TargetRootFolder \"Restore\" \u0441\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0438\u0441\u044c\u043c\u0430 \u0432 \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u0443\u044e \u043f\u0430\u043f\u043a\u0443 \u0432 \u044f\u0449\u0438\u043a\u0435 \u043d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f (\u0441\u043e\u0437\u0434\u0430\u0435\u0442\u0441\u044f \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438), \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0439 \u043f\u0430\u043f\u043a\u0438 -IncludeFolders \"#Inbox#\" \\ Get-MailboxRestoreRequest | Get-MailboxRestoreRequestStatistics \u0441\u0442\u0430\u0442\u0443\u0441 \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \\ Get-MailboxRestoreRequestStatistics -Identity support \\ Get-MailboxRestoreRequest -Status Completed | Remove-MailboxRestoreRequest \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u0441\u0435 \u0443\u0441\u043f\u0435\u0448\u043d\u044b\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u044b","title":"Recovery database (RDB)"},{"location":"#transport","text":"Get-TransportServer $srv_cas | select MaxConcurrentMailboxDeliveries,MaxConcurrentMailboxSubmissions,MaxConnectionRatePerMinute,MaxOutboundConnections,MaxPerDomainOutboundConnections,PickupDirectoryMaxMessagesPerMinute \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u043f\u0440\u043e\u043f\u0443\u0441\u043a\u043d\u043e\u0439 \u0441\u043f\u043e\u0441\u043e\u0431\u043d\u043e\u0441\u0442\u0438 \u0442\u0440\u0430\u043d\u0441\u043f\u043e\u0440\u0442\u043d\u043e\u0433\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \\ MaxConcurrentMailboxDeliveries \u2014 \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043e\u0434\u043d\u043e\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0445 \u043f\u043e\u0442\u043e\u043a\u043e\u0432, \u043a\u043e\u0442\u043e\u0440\u043e\u0435 \u043c\u043e\u0436\u0435\u0442 \u043e\u0442\u043a\u0440\u044b\u0442\u044c \u0441\u0435\u0440\u0432\u0435\u0440 \u0434\u043b\u044f \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 \u043f\u0438\u0441\u0435\u043c. \\ MaxConcurrentMailboxSubmissions \u2014 \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043e\u0434\u043d\u043e\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0445 \u043f\u043e\u0442\u043e\u043a\u043e\u0432, \u043a\u043e\u0442\u043e\u0440\u043e\u0435 \u043c\u043e\u0436\u0435\u0442 \u043e\u0442\u043a\u0440\u044b\u0442\u044c \u0441\u0435\u0440\u0432\u0435\u0440 \u0434\u043b\u044f \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u043f\u0438\u0441\u0435\u043c. \\ MaxConnectionRatePerMinute \u2014 \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u0430\u044f \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u044c \u043e\u0442\u043a\u0440\u044b\u0442\u0438\u044f \u0432\u0445\u043e\u0434\u044f\u0449\u0438\u0445 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0439 \u0432 \u043c\u0438\u043d\u0443\u0442\u0443. \\ MaxOutboundConnections \u2014 \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0439, \u043a\u043e\u0442\u043e\u0440\u043e\u0435 \u043c\u043e\u0436\u0435\u0442 \u043e\u0442\u043a\u0440\u044b\u0442\u044c Exchange \u0434\u043b\u044f \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438. \\ MaxPerDomainOutboundConnections \u2014 \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0438\u0441\u0445\u043e\u0434\u044f\u0449\u0438\u0445 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0439, \u043a\u043e\u0442\u043e\u0440\u043e\u0435 \u043c\u043e\u0436\u0435\u0442 \u043e\u0442\u043a\u0440\u044b\u0442\u044c Exchange \u0434\u043b\u044f \u043e\u0434\u043d\u043e\u0433\u043e \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u043e\u0433\u043e \u0434\u043e\u043c\u0435\u043d\u0430. \\ PickupDirectoryMaxMessagesPerMinute \u2014 \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u044c \u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u0435\u0439 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0432 \u043c\u0438\u043d\u0443\u0442\u0443 (\u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u0435 \u043f\u0438\u0441\u0435\u043c \u043f\u043e \u043f\u0430\u043f\u043a\u0430\u043c). \\ Set-TransportServer exchange-cas -MaxConcurrentMailboxDeliveries 21 -MaxConcurrentMailboxSubmissions 21 -MaxConnectionRatePerMinute 1201 -MaxOutboundConnections 1001 -MaxPerDomainOutboundConnections 21 -PickupDirectoryMaxMessagesPerMinute 101 \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f Get-TransportConfig | select MaxSendSize, MaxReceiveSize \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u0435 \u0440\u0430\u0437\u043c\u0435\u0440\u0430 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u043d\u0430 \u0443\u0440\u043e\u0432\u043d\u0435 \u0442\u0440\u0430\u0441\u043f\u043e\u0440\u0442\u0430 (\u043d\u0430\u0438\u043c\u0435\u043d\u044c\u0448\u0438\u0439 \u043f\u0440\u0438\u043e\u0440\u0438\u0442\u0435\u0442, \u043f\u043e\u0441\u043b\u0435 \u043a\u043e\u043d\u043d\u0435\u043a\u0442\u043e\u0440\u0430 \u0438 \u043f\u043e\u0447\u0442\u043e\u0432\u043e\u0433\u043e \u044f\u0449\u0438\u043a\u0430). \\ New-TransportRule -Name AttachmentLimit -AttachmentSizeOver 15MB -RejectMessageReasonText \"Sorry, messages with attachments over 15 MB are not accepted\" \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0442\u0440\u0430\u043d\u0441\u043f\u043e\u0440\u0442\u043d\u043e\u0435 \u043f\u0440\u0430\u0432\u0438\u043b\u043e \u0434\u043b\u044f \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u0440\u0430\u0437\u043c\u0435\u0440\u0430 \u0432\u043b\u043e\u0436\u0435\u043d\u0438\u044f","title":"Transport"},{"location":"#connector","text":"Get-ReceiveConnector | select Name,MaxMessageSize,RemoteIPRanges,WhenChanged \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u044f \u0440\u0430\u0437\u043c\u0435\u0440\u0430 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u043d\u0430 \u0443\u0440\u043e\u0432\u043d\u0435 \u043a\u043e\u043d\u043d\u0435\u043a\u0442\u043e\u0440\u0430 (\u043f\u0440\u0438\u043e\u0440\u0438\u0442\u0435\u0442 \u043d\u0438\u0436\u0435, \u0447\u0435\u043c \u0443 \u043f\u043e\u0447\u0442\u043e\u0432\u043e\u0433\u043e \u044f\u0449\u0438\u043a\u0430) \\ Set-ReceiveConnector ((Get-ReceiveConnector).Identity)[-1] -MaxMessageSize 30Mb \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0440\u0430\u0437\u043c\u0435\u0440 \u0443 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u043a\u043e\u043d\u043d\u0435\u043a\u0442\u043e\u0440\u0430 \u0432 \u0441\u043f\u0438\u0441\u043a\u0435 (\u043f\u0440\u0438\u043e\u0440\u0438\u0442\u0435\u0442 \u0432\u044b\u0448\u0435, \u0447\u0435\u043c \u0443 \u0442\u0440\u0430\u0441\u043f\u043e\u0440\u0442\u0430) \\ Get-Mailbox \"support4\" | select MaxSendSize, MaxReceiveSize \u043d\u0430\u0438\u0432\u044b\u0441\u0448\u0438\u0439 \u043f\u0440\u0438\u043e\u0440\u0438\u0442\u0435\u0442 \\ Set-Mailbox \"support4\" -MaxSendSize 30MB -MaxReceiveSize 30MB \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0440\u0430\u0437\u043c\u0435\u0440 Set-SendConnector -Identity \"ConnectorName\" -Port 26 \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u043e\u0440\u0442 \u043a\u043e\u043d\u043d\u0435\u043a\u0442\u043e\u0440\u0430 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 \\ Get-SendConnector \"proxmox\" | select port Get-ReceiveConnector | select Name,MaxRecipientsPerMessage \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e Exchange \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0435\u0442 \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u043d\u043e\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0430\u0434\u0440\u0435\u0441\u0430\u0442\u043e\u0432 \u0432 \u043e\u0434\u043d\u043e\u043c \u043f\u0438\u0441\u044c\u043c\u0435 (200) \\ Set-ReceiveConnector ((Get-ReceiveConnector).Identity)[-1] -MaxRecipientsPerMessage 50 \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \\ Set-ReceiveConnector ((Get-ReceiveConnector).Identity)[-1] -MessageRateLimit 1000 \u0437\u0430\u0434\u0430\u0442\u044c \u043b\u0438\u043c\u0438\u0442 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0432 \u043c\u0438\u043d\u0443\u0442\u0443 \u0434\u043b\u044f \u043a\u043e\u043d\u043d\u0435\u043a\u0442\u043e\u0440\u0430 Get-OfflineAddressbook | Update-OfflineAddressbook \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c OAB \\ Get-ClientAccessServer | Update-FileDistributionService","title":"Connector"},{"location":"#pst","text":"New-MailboxExportRequest -Mailbox $name -filepath \"\\\\$srv\\pst\\$name.PST\" # -ContentFilter {(Received -lt \"01/01/2021\")} -Priority Highest/Lower # -IsArchive \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u044d\u043a\u0441\u043f\u043e\u0440\u0442 \u0438\u0437 \u0430\u0440\u0445\u0438\u0432\u0430 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \\ New-MailboxExportRequest -Mailbox $name -IncludeFolders \"#Inbox#\" -FilePath \"\\\\$srv\\pst\\$name.PST\" \u0442\u043e\u043b\u044c\u043a\u043e \u043f\u0430\u043f\u043a\u0443 \u0432\u0445\u043e\u0434\u044f\u0449\u0438\u0435 \\ New-MailboxImportRequest -Mailbox $name \"\\\\$srv\\pst\\$name.PST\" \u0438\u043c\u043f\u043e\u0440\u0442 \u0438\u0437 PST \\ Get-MailboxExportRequest \u0441\u0442\u0430\u0442\u0443\u0441 \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 \\ Get-MailboxExportRequest -Status Completed | Remove-MailboxExportRequest \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u043d\u044b\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u044b \\ Remove-MailboxExportRequest -RequestQueue MBXDB01 -RequestGuid 25e0eaf2-6cc2-4353-b83e-5cb7b72d441f \u043e\u0442\u043c\u0435\u043d\u0438\u0442\u044c \u044d\u043a\u0441\u043f\u043e\u0440\u0442","title":"PST"},{"location":"#distributiongroup","text":"Get-DistributionGroup \u0441\u043f\u0438\u0441\u043e\u043a \u0433\u0440\u0443\u043f\u043f \u0440\u0430\u0441\u0441\u044b\u043b\u043a\u0438 \\ Get-DistributionGroupMember \"!_\u041e\u0444\u0438\u0441\" \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \u0432 \u0433\u0440\u0443\u043f\u043f\u0435 \\ Add-DistributionGroupMember -Identity \"!_\u041e\u0444\u0438\u0441\" -Member \"$name@$domain\" \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u0433\u0440\u0443\u043f\u043f\u0443 \u0440\u0430\u0441\u0441\u044b\u043b\u043a\u0438 \\ Remove-DistributionGroupMember -Identity \"!_\u041e\u0444\u0438\u0441\" -Member \"$name@$domain\" \\ New-DistributionGroup -Name \"!_\u0422\u0435\u0441\u0442\" -Members \"$name@$domain\" \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0433\u0440\u0443\u043f\u043f\u0443 \\ Set-DistributionGroup -Identity \"support4\" -HiddenFromAddressListsEnabled $true (\u0438\u043b\u0438 Set-Mailbox) \u0441\u043a\u0440\u044b\u0442\u044c \u0438\u0437 \u0441\u043f\u0438\u0441\u043a\u0430 \u0430\u0434\u0440\u0435\u0441\u043e\u0432 Exchange","title":"DistributionGroup"},{"location":"#search","text":"Search-Mailbox -Identity \"support4\" -SearchQuery '\u0422\u0435\u043c\u0430:\"Mikrotik DOWN\"' \u043f\u043e\u0438\u0441\u043a \u043f\u0438\u0441\u0435\u043c \u043f\u043e \u0442\u0435\u043c\u0435 \\ Search-Mailbox -Identity \"support4\" -SearchQuery 'Subject:\"Mikrotik DOWN\"' \\ Search-Mailbox -Identity \"support4\" -SearchQuery 'attachment -like:\"*.rar\"' \\ Search-Mailbox -Identity \"support4\" -SearchQuery \"\u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043e: < 01/01/2020\" -DeleteContent -Force \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u043f\u0438\u0441\u0435\u043c \u043f\u043e \u0434\u0430\u0442\u0435 \u0424\u043e\u0440\u043c\u0430\u0442 \u0434\u0430\u0442\u044b \u0432 \u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e\u0441\u0442\u0438 \u043e\u0442 \u0440\u0435\u0433\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u044b\u0445 \u043d\u0430\u0441\u0442\u0440\u043e\u0435\u043a \u0441\u0435\u0440\u0432\u0435\u0440\u0430: \\ 20/07/2018 \\ 07/20/2018 \\ 20-Jul-2018 \\ 20/July/2018","title":"Search"},{"location":"#auditlog","text":"Get-AdminAuditLogConfig \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u0430\u0443\u0434\u0438\u0442\u0430 \\ Set-Mailbox -Identity \"support4\" -AuditOwner HardDelete \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 HardDelete \u043f\u0438\u0441\u0435\u043c \\ Set-mailbox -identity \"support4\" -AuditlogAgelimit 120 \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u0432\u0440\u0435\u043c\u044f \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \\ Get-mailbox -identity \"support4\" | Format-list Audit* \u0434\u0430\u043d\u043d\u044b\u0435 \u0430\u0443\u0434\u0438\u0442\u0430 \\ Search-MailboxAuditLog -Identity \"support4\" -LogonTypes Delegate -ShowDetails -Start \"2022-02-22 18:00\" -End \"2022-03-22 18:00\" \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u043b\u043e\u0433\u043e\u0432 \\ Search-AdminAuditLog -StartDate \"02/20/2022\" | ft CmdLetName,Caller,RunDate,ObjectModified -Autosize \u043f\u043e\u0438\u0441\u043a \u0441\u043e\u0431\u044b\u0442\u0438\u0439 \u0438\u0441\u0442\u043e\u0440\u0438\u0438 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u044b\u0445 \u043a\u043e\u043c\u0430\u043d\u0434 \u0432 \u0436\u0443\u0440\u043d\u0430\u043b\u0435 \u0430\u0443\u0434\u0438\u0442\u0430 Exchange","title":"AuditLog"},{"location":"#test","text":"Test-ServiceHealth \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u043e\u0441\u0442\u044c \u0440\u043e\u043b\u0435\u0439 \u0441\u0435\u0440\u0432\u0435\u0440\u0430: \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0445 \u044f\u0449\u0438\u043a\u043e\u0432, \u043a\u043b\u0438\u0435\u043d\u0442\u0441\u043a\u043e\u0433\u043e \u0434\u043e\u0441\u0442\u0443\u043f\u0430, \u0435\u0434\u0438\u043d\u043e\u0439 \u0441\u0438\u0441\u0442\u0435\u043c\u044b \u043e\u0431\u043c\u0435\u043d\u0430 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f\u043c\u0438, \u0442\u0440\u0430\u0441\u043f\u043e\u0440\u0442\u043d\u043e\u0433\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \\ $mx_srv_list | %{Test-MapiConnectivity -Server $_} \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f MX-\u0441\u0435\u0440\u0432\u0435\u0440\u043e\u0432 \u043a \u0411\u0414 \\ Test-MAPIConnectivity -Database $db \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u0438 \u043b\u043e\u0433\u0438\u043d\u0430 \u0432 \u0431\u0430\u0437\u0443 \\ Test-MAPIConnectivity \u2013Identity $user@$domain \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u0438 \u043b\u043e\u0433\u0438\u043d\u0430 \u0432 \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0439 \u044f\u0449\u0438\u043a \\ Test-ComputerSecureChannel \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0440\u0430\u0431\u043e\u0442\u044b \u0441\u043b\u0443\u0436\u0431\u044b AD \\ Test-MailFlow \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u0442\u0435\u0441\u0442\u043e\u0432\u043e\u0433\u043e \u043f\u043e\u0442\u043e\u043a\u0430 \u043f\u043e\u0447\u0442\u044b","title":"Test"},{"location":"#queue","text":"Get-TransportServer | %{Get-Queue -Server $_.Name} \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043e\u0447\u0435\u0440\u0435\u0434\u0438 \u043d\u0430 \u0432\u0441\u0435\u0445 \u0442\u0440\u0430\u043d\u0441\u043f\u043e\u0440\u0442\u043d\u044b\u0445 \u0441\u0435\u0440\u0432\u0435\u0440\u0430\u0445 \\ Get-Queue -Identity EXCHANGE-CAS\\155530 | Format-List \u043f\u043e\u0434\u0440\u043e\u0431\u043d\u0430\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043e\u0431 \u043e\u0447\u0435\u0440\u0435\u0434\u0438 \\ Get-Queue -Identity EXCHANGE-CAS\\155530 | Get-Message -ResultSize Unlimited | Select FromAddress,Recipients \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u0435\u043b\u0435\u0439 (FromAddress) \u0438 \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u0435\u043b\u0435\u0439 \u0432 \u043e\u0447\u0435\u0440\u0435\u0434\u0438 (Recipients) \\ Get-Message -Queue EXCHANGE-CAS\\155530 \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0438\u043d\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0432 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0439 \u043e\u0447\u0435\u0440\u0435\u0434\u0438 (\u0441\u0435\u0440\u0432\u0435\u0440\\\u043e\u0447\u0435\u0440\u0435\u0434\u044c\\\u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440 \u043f\u0438\u0441\u044c\u043c\u0430) \\ Resume-Message EXCHANGE-CAS\\155530\\444010 \u043f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u044c \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0443 \u043f\u0438\u0441\u044c\u043c\u0430 \u0438\u0437 \u043e\u0447\u0435\u0440\u0435\u0434\u0438 \\ Retry-Queue -Filter {Status -eq \"Retry\"} \u043f\u0440\u0438\u043d\u0443\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u043f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u044c \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0443 \u0432\u0441\u0435\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 c \u0441\u0442\u0430\u0442\u0443\u0441\u043e\u043c \"\u041f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u044c\" \\ Get-Queue -Identity EXCHANGE-CAS\\155530 | Get-Message -ResultSize unlimited | Remove-Message -WithNDR $False \u043e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u043e\u0447\u0435\u0440\u0435\u0434\u044c \\ Get-transportserver EXCHANGE-CAS | Select MessageExpirationTimeout \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0440\u0435\u043c\u044f \u0436\u0438\u0437\u043d\u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0432 \u043e\u0447\u0435\u0440\u0435\u0434\u0438 (\u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e, 2 \u0434\u043d\u044f) Error Exchange 452 4.3.1 Insufficient system resources - \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u0435 \u0441\u0432\u043e\u0431\u043e\u0434\u043d\u043e\u0433\u043e \u043c\u0435\u0441\u0442\u0430 \u043d\u0430 \u0434\u0438\u0441\u043a\u0435, \u043d\u0430 \u043a\u043e\u0442\u043e\u0440\u043e\u043c \u043d\u0430\u0445\u043e\u0434\u044f\u0442\u0441\u044f \u043e\u0447\u0435\u0440\u0435\u0434\u0438 \u0441\u043b\u0443\u0436\u0431\u044b Exchange Hub Transport, \u0437\u0430 \u043c\u043e\u043d\u0438\u0442\u043e\u0440\u0438\u043d\u0433 \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442 \u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0445 \u0440\u0435\u0441\u0443\u0440\u0441\u043e\u0432 Back Pressure, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0432 \u0442\u043e\u043c \u0447\u0438\u0441\u043b\u0435 \u043e\u0442\u0441\u043b\u0435\u0436\u0438\u0432\u0430\u0435\u0442 \u0441\u0432\u043e\u0431\u043e\u0434\u043d\u043e\u0435 \u043c\u0435\u0441\u0442\u043e \u043d\u0430 \u0434\u0438\u0441\u043a\u0435 \\ \u041f\u043e\u0440\u043e\u0433 Medium (90%) \u2014 \u043f\u0435\u0440\u0435\u0441\u0442\u0430\u0442\u044c \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0442\u044c \u043f\u043e SMTP \u043f\u043e\u0447\u0442\u0443 \u043e\u0442 \u0432\u043d\u0435\u0448\u043d\u0438\u0445 \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u0435\u043b\u0435\u0439 (\u043f\u043e\u0447\u0442\u0430 \u043e\u0442 MAPI \u043a\u043b\u0438\u0435\u043d\u0442\u043e\u0432 \u043f\u0440\u0438 \u044d\u0442\u043e\u043c \u043e\u0431\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u0435\u0442\u0441\u044f) \\ \u041f\u043e\u0440\u043e\u0433 High (99%) \u2014 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043f\u043e\u0442\u043e\u043a\u0430 \u043f\u043e\u0447\u0442\u044b \u043f\u043e\u043b\u043d\u043e\u0441\u0442\u044c\u044e \u043f\u0440\u0435\u043a\u0440\u0430\u0449\u0430\u0435\u0442\u0441\u044f \\ \u0420\u0435\u0448\u0435\u043d\u0438\u0435: \u043e\u0447\u0438\u0441\u0442\u0438\u0442\u044c, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 \u043b\u043e\u0433\u0438 IIS (C:\\inetpub\\logs\\LogFiles\\W3SVC1), \u0443\u0432\u0435\u043b\u0438\u0447\u0438\u0442\u044c \u0440\u0430\u0437\u043c\u0435\u0440 \u0434\u0438\u0441\u043a\u0430, \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043c\u043e\u043d\u0438\u0442\u043e\u0440\u0438\u043d\u0433 Back Pressure (\u043f\u043b\u043e\u0445\u043e\u0439 \u0432\u0430\u0440\u0438\u0430\u043d\u0442) \u0438\u043b\u0438 \u043f\u0435\u0440\u0435\u043d\u0435\u0441\u0442\u0438 \u0442\u0440\u0430\u043d\u0441\u043f\u043e\u0440\u0442\u043d\u044b\u0435 \u043e\u0447\u0435\u0440\u0435\u0434\u044c \u043d\u0430 \u0434\u0440\u0443\u0433\u043e\u0439 \u0434\u0438\u0441\u043a \u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u043e\u0433\u043e \u043e\u0431\u044a\u0451\u043c\u0430. Get-Service | ? name -like \"MSExchangeTransport\" | Stop-Service \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0441\u043b\u0443\u0436\u0443 \u043e\u0447\u0435\u0440\u0435\u0434\u0438 \\ Rename-Item \"C:\\Program Files\\Microsoft\\Exchange Server\\V15\\TransportRoles\\data\\Queue\" \"C:\\Program Files\\Microsoft\\Exchange Server\\V15\\TransportRoles\\data\\Queue_old\" \u043e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u0431\u0430\u0437\u0443 \u043e\u0447\u0435\u0440\u0435\u0434\u0438 \\ C:\\Program Files\\Microsoft\\Exchange Server\\V15\\Bin\\EdgeTransport.exe.config \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0439 \u0444\u0430\u0439\u043b, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u043f\u0443\u0442\u044c \u043a \u0431\u0434 \u0441 \u043e\u0447\u0435\u0440\u0435\u0434\u044c\u044e (\u0431\u043b\u043e\u043a \u043a\u043b\u044e\u0447\u0438 \u0438 QueueDatabaseLoggingPath) \\ \u0414\u043b\u044f \u043f\u0435\u0440\u0435\u043d\u043e\u0441\u0430 \u0411\u0414, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043f\u0435\u0440\u0435\u043c\u0435\u0441\u0442\u0438\u0442\u044c \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u0444\u0430\u0439\u043b\u044b \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 Mail.que \u0438 Trn.chk (\u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044c\u043d\u044b\u0435 \u0442\u043e\u0447\u043a\u0438 \u0434\u043b\u044f \u043e\u0442\u0441\u043b\u0435\u0436\u0438\u0432\u0430\u043d\u0438\u044f \u0437\u0430\u043f\u0438\u0441\u0438 \u0432 \u043b\u043e\u0433\u0430\u0445) \u0438\u0437 \u0438\u0441\u0445\u043e\u0434\u043d\u043e\u0433\u043e \u043c\u0435\u0441\u0442\u043e\u043f\u043e\u043b\u043e\u0436\u0435\u043d\u0438\u044f \u0432 \u043d\u043e\u0432\u043e\u0435. \u041f\u0435\u0440\u0435\u043c\u0435\u0441\u0442\u0438\u0442\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u0444\u0430\u0439\u043b\u044b \u0436\u0443\u0440\u043d\u0430\u043b\u0430 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439 Trn.log, Trntmp.log, Trn nnnn.log , Trnres00001.jrs, Trnres00002.jrs \u0438 Temp.edb \u0438\u0437 \u0441\u0442\u0430\u0440\u043e\u0433\u043e \u0440\u0430\u0441\u043f\u043e\u043b\u043e\u0436\u0435\u043d\u0438\u044f \u0432 \u043d\u043e\u0432\u043e\u0435. tmp.edb \u2014 \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0439 \u0444\u0430\u0439\u043b \u0434\u043b\u044f \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u0441\u0445\u0435\u043c\u044b \u0441\u0430\u043c\u043e\u0439 \u0431\u0430\u0437\u044b, \u043f\u0435\u0440\u0435\u043d\u043e\u0441\u0442\u0438 \u043d\u0435 \u043d\u0443\u0436\u043d\u043e. \\ \u041f\u043e\u0441\u043b\u0435 \u0437\u0430\u043f\u0443\u0441\u043a\u0430 \u0441\u043b\u0443\u0436\u0431\u044b \u0442\u0440\u0430\u043d\u0441\u043f\u043e\u0440\u0442\u0430 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u0442\u0430\u0440\u0443\u044e \u0431\u0430\u0437\u0443 \u0434\u0430\u043d\u043d\u044b\u0445 \u043e\u0447\u0435\u0440\u0435\u0434\u0438 \u0438 \u0444\u0430\u0439\u043b\u044b \u0436\u0443\u0440\u043d\u0430\u043b\u0430 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439 \u0438\u0437 \u0441\u0442\u0430\u0440\u043e\u0433\u043e \u0440\u0430\u0441\u043f\u043e\u043b\u043e\u0436\u0435\u043d\u0438\u044f.","title":"Queue"},{"location":"#defrag","text":"Get-MailboxDatabase -Status | ft Name, DatabaseSize, AvailableNewMailboxSpace \\ DatabaseSize - \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u0440\u0430\u0437\u043c\u0435\u0440 \u0431\u0430\u0437\u044b \\ AvailableNewMailboxSpace - \u043e\u0431\u044a\u0451\u043c \u043f\u0443\u0441\u0442\u044b\u0445 \u0441\u0442\u0440\u0430\u043d\u0438\u0446, \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u043e, \u043a\u043e\u0442\u043e\u0440\u043e\u0435 \u043c\u043e\u0436\u043d\u043e \u043e\u0441\u0432\u043e\u0431\u043e\u0434\u0438\u0442\u044c \u043f\u0440\u0438 \u0434\u0435\u0444\u0440\u0430\u0433\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u0438 \\ (DatabaseSize \u2014 AvailableNewMailboxSpace) x 1,1 - \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0438\u043c\u0435\u0442\u044c \u0441\u0432\u043e\u0431\u043e\u0434\u043d\u043e\u0433\u043e \u043c\u0435\u0441\u0442\u0430 \u043d\u0435 \u043c\u0435\u043d\u0435\u0435 110% \u043e\u0442 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u0440\u0430\u0437\u043c\u0435\u0440\u0430 \u0431\u0430\u0437\u044b (\u0431\u0435\u0437 \u0443\u0447\u0435\u0442\u0430 \u043f\u0443\u0441\u0442\u044b\u0445 \u0441\u0442\u0440\u0430\u043d\u0438\u0446) \\ cd $path \\ Dismount-Database \"$path\\$db_name\" \u043e\u0442\u043c\u043e\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0411\u0414 \\ eseutil /d \"$path\\$db_name.edb\" \\ Mount-Database \"$path\\$db\" \u043f\u0440\u0438\u043c\u043e\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0411\u0414","title":"Defrag"},{"location":"#dag-database-availability-group","text":"Install-WindowsFeature -Name Failover-Clustering -ComputerName EXCH-MX-01 \u043e\u0441\u043d\u043e\u0432\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u043d\u0430 \u0442\u0435\u0445\u043d\u043e\u043b\u043e\u0433\u0438\u0438 Windows Server Failover Cluster \\ New-DatabaseAvailabilityGroup -Name dag-01 -WitnessServer fs-05 -WitnessDirectory C:\\witness_exchange1 \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0433\u0440\u0443\u043f\u043f\u0443 \u0441 \u0443\u043a\u0430\u0437\u0430\u043d\u0438\u0435\u043c \u0444\u0430\u0439\u043b\u043e\u0432\u043e\u0433\u043e \u0441\u0432\u0438\u0434\u0435\u0442\u0435\u043b\u044f \u0434\u043b\u044f \u043a\u0432\u043e\u0440\u0443\u043c\u0430 \\ Quorum - \u044d\u0442\u043e \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u0433\u043e\u043b\u043e\u0441\u043e\u0432\u0430\u043d\u0438\u044f, \u0432 \u043a\u043e\u0442\u043e\u0440\u043e\u043c \u0434\u043b\u044f \u043f\u0440\u0438\u043d\u044f\u0442\u0438\u044f \u0440\u0435\u0448\u0435\u043d\u0438\u044f \u043d\u0443\u0436\u043d\u043e \u0438\u043c\u0435\u0442\u044c \u0431\u043e\u043b\u044c\u0448\u0438\u043d\u0441\u0442\u0432\u043e \u0433\u043e\u043b\u043e\u0441\u043e\u0432, \u0447\u0442\u043e \u0431\u044b \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u0442\u0435\u043a\u0443\u0449\u0443\u044e \u043a\u043e\u043f\u0438\u044e \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 \u0430\u043a\u0442\u0438\u0432\u043d\u043e\u0439. \\ WitnessDirectory \u2014 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0434\u043b\u044f \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0434\u0430\u043d\u043d\u044b\u0445 \u0444\u0430\u0439\u043b\u043e\u0432\u043e\u0433\u043e \u0440\u0435\u0441\u0443\u0440\u0441\u0430-\u0441\u0432\u0438\u0434\u0435\u0442\u0435\u043b\u044f. \\ Set-DatabaseAvailabilityGroup dag-01 \u2013DatabaseAvailabilityGroupIPAdress $ip \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c ip-\u0430\u0434\u0440\u0435\u0441 \u0433\u0440\u0443\u043f\u043f\u044b \\ Get-DatabaseAvailabilityGroup \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u0433\u0440\u0443\u043f\u043f \\ Get-DatabaseAvailabilityGroup -Identity dag-01 \\ Add-DatabaseAvailabilityGroupServer -Identity dag-01 -MailboxServer EXCH-MX-01 \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043f\u0435\u0440\u0432\u044b\u0439 \u0441\u0435\u0440\u0432\u0435\u0440 (\u0432\u0441\u0435 \u0411\u0414 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430\u0445 \u0432 DAG \u0434\u043e\u043b\u0436\u043d\u044b \u0445\u0440\u0430\u043d\u0438\u0442\u044c\u0441\u044f \u043f\u043e \u043e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u043e\u043c\u0443 \u043f\u0443\u0442\u0438) \\ Add-MailboxDatabaseCopy -Identity db_name -MailboxServer EXCH-MX-04 \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043a\u043e\u043f\u0438\u044e \u0411\u0414 \\ Get-MailboxDatabaseCopyStatus -Identity db_name\\* | select Name,Status,LastInspectedLogTime \u0441\u0442\u0430\u0442\u0443\u0441 \u0438 \u0432\u0440\u0435\u043c\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0436\u0443\u0440\u043d\u0430\u043b\u0430 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0438\u0439 Status: \\ Mounted - \u0440\u0430\u0431\u043e\u0447\u0430\u044f \u0431\u0430\u0437\u0430 \\ Suspended - \u043f\u0440\u0438\u043e\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043e \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \\ Healthy - \u0440\u0430\u0431\u043e\u0447\u0430\u044f \u043f\u0430\u0441\u0441\u0438\u0432\u043d\u0430\u044f \u043a\u043e\u043f\u0438\u044f \\ ServiceDown - \u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u043d\u0430 (\u0432\u044b\u043a\u043b\u044e\u0447\u0435\u043d \u0441\u0435\u0440\u0432\u0435\u0440) \\ Dismounted - \u043e\u0442\u043c\u043e\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0430 \\ FailedAndSuspended - \u043e\u0448\u0438\u0431\u043a\u0430 \u0438 \u043f\u0440\u0438\u043e\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \\ Resynchronizing - \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u0441\u0438\u043d\u0445\u0440\u043e\u043d\u0438\u0437\u0430\u0446\u0438\u044f, \u0433\u0434\u0435 \u0431\u0443\u0434\u0435\u0442 \u043f\u043e\u0441\u0442\u0435\u043f\u0435\u043d\u043d\u043e \u0443\u043c\u0435\u043d\u044c\u0448\u0430\u0442\u044c\u0441\u044f \u0434\u043b\u0438\u043d\u0430 \u043e\u0447\u0435\u0440\u0435\u0434\u0438 \\ CopyQueue Length - \u0434\u043b\u0438\u043d\u0430 \u0440\u0435\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u043e\u043d\u043d\u043e\u0439 \u043e\u0447\u0435\u0440\u0435\u0434\u0438 \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f (0 - \u0437\u043d\u0430\u0447\u0438\u0442 \u0432\u0441\u0435 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0438\u0437 \u0430\u043a\u0442\u0438\u0432\u043d\u043e\u0439 \u0431\u0430\u0437\u044b \u0440\u0435\u043f\u043b\u0438\u0446\u0438\u0440\u043e\u0432\u0430\u043d\u044b \u0432 \u043f\u0430\u0441\u0441\u0438\u0432\u043d\u0443\u044e \u043a\u043e\u043f\u0438\u044e) Resume-MailboxDatabaseCopy -Identity db_name\\EXCH-MX-04 \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c (Resume) \u0438\u043b\u0438 \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0431\u0434 \u043d\u0430 EXCH-MX-04 (\u0438\u0437 \u0441\u0442\u0430\u0442\u0443\u0441\u0430 Suspended \u0432 Healthy) \\ Suspend-MailboxDatabaseCopy -Identity db_name\\EXCH-MX-04 \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 (\u0432 \u0441\u0442\u0430\u0442\u0443\u0441 Suspended) \\ Update-MailboxDatabaseCopy -Identity db_name\\EXCH-MX-04 -DeleteExistingFiles \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u043a\u043e\u043f\u0438\u044e \u0411\u0414 (\u0441\u0434\u0435\u043b\u0430\u0442\u044c Full Backup) \\ Set-MailboxDatabaseCopy -Identity db_name\\EXCH-MX-04 -ActivationPreference 1 \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u0440\u0438\u043e\u0440\u0438\u0442\u0435\u0442 \u0434\u043b\u044f \u0430\u043a\u0442\u0438\u0432\u0430\u0446\u0438\u0438 \u043a\u043e\u043f\u0438\u0439 \u0411\u0414 (\u043a\u0430\u043a\u0443\u044e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c, 1 \u2013 \u0441\u0430\u043c\u043e\u0435 \u0432\u044b\u0441\u043e\u043a\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435) \\ Move-ActiveMailboxDatabase db_name -ActivateOnServer EXCH-MX-04 -MountDialOverride:None -Confirm:$false \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043a\u043e\u043f\u0438\u044e \u0411\u0414 \u0432 DAG (\u043f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f \u043d\u0430 \u0430\u043a\u0442\u0438\u0432\u043d\u0443\u044e \u043a\u043e\u043f\u0438\u044e) \\ Remove-MailboxDatabaseCopy -Identity db_name\\EXCH-MX-04 -Confirm:$False \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043a\u043e\u043f\u0438\u0438 \u043f\u0430\u0441\u0441\u0438\u0432\u043d\u043e\u0439 \u0431\u0430\u0437\u044b \u0432 DAG-\u0433\u0440\u0443\u043f\u043f\u0435 (\u0443 \u0411\u0414 \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u043e\u0442\u043a\u043b\u044e\u0447\u0435\u043d\u043e \u0432\u0435\u0434\u0435\u043d\u0438\u0435 \u0446\u0438\u043a\u043b\u0438\u0447\u0435\u0441\u043a\u043e\u0433\u043e \u0436\u0443\u0440\u043d\u0430\u043b\u0430) \\ Remove-DatabaseAvailabilityGroupServer -Identity dag-01 -MailboxServer EXCH-MX-04 -ConfigurationOnly \u0443\u0434\u0430\u043b\u0438\u0442\u044c MX \u0441\u0435\u0440\u0432\u0435\u0440 \u0438\u0437 \u0433\u0440\u0443\u043f\u043f\u044b DAG \\ Import-Module FailoverClusters \\ Get-ClusterNode EXCH-MX-04 | Remove-ClusterNode -Force \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043e\u0442\u043a\u0430\u0437\u0430\u0432\u0448\u0438\u0439 \u0443\u0437\u0435\u043b \u0438\u0437 Windows Failover Cluster Get-DatabaseAvailabilityGroup | Get-DatabaseAvailabilityGroupHealth \u043c\u043e\u043d\u0438\u0442\u043e\u0440\u0438\u043d\u0433","title":"DAG (Database Availability Group)"},{"location":"#index_1","text":"Get-MailboxDatabaseCopyStatus * | select name,status,ContentIndexState,ContentIndexErrorMessage,ActiveDatabaseCopy,LatestCopyBackupTime,CopyQueueLength \u0443\u0437\u043d\u0430\u0442\u044c \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0440\u0430\u0431\u043e\u0442\u044b \u0438\u043d\u0434\u043a\u0441\u043e\u0432 \u0411\u0414 \u0438 \u0442\u0435\u043a\u0441\u0442 \u043e\u0448\u0438\u0431\u043a\u0438, \u043d\u0430 \u043a\u0430\u043a\u043e\u043c \u0441\u0435\u0440\u0432\u0435\u0440\u0435 \u0430\u043a\u0442\u0438\u0432\u043d\u0430\u044f \u043a\u043e\u043f\u0438\u044f \u0411\u0414, \u0434\u0430\u0442\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0439 \u043a\u043e\u043f\u0438\u0438 \u0438 \u0442\u0435\u043a\u0443\u0449\u0430\u044f \u043e\u0447\u0435\u0440\u0435\u0434\u044c \\ Get-MailboxDatabaseCopyStatus -Identity $db_name\\* | Format-List Name,ContentIndexState \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u043a\u043e\u043f\u0438\u0439 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0439 \u0411\u0414 \u043d\u0430 \u0432\u0441\u0435\u0445 \u0441\u0435\u0440\u0432\u0435\u0440\u0430\u0445, \u0438 \u0441\u0442\u0430\u0442\u0443\u0441 \u0438\u0445 \u0438\u043d\u0434\u0435\u043a\u0441\u043e\u0432, \u0435\u0441\u043b\u0438 \u0443 \u0432\u0442\u043e\u0440\u043e\u0433\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u0441\u0442\u0430\u0442\u0443\u0441 Healthy, \u043c\u043e\u0436\u043d\u043e \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0438\u0437 \u043d\u0435\u0433\u043e \\ Get-MailboxDatabaseCopyStatus -Identity $db_name\\EXCH-MX-04 | Update-MailboxDatabaseCopy -SourceServer EXCH-MX-01 -CatalogOnly \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0411\u0414 \u0438\u0437 \u043a\u043e\u043f\u0438\u0438 \\ cd %PROGRAMFILES%\\Microsoft\\Exchange Server\\V14\\Scripts \u0438\u043b\u0438 v15 \u0434\u043b\u044f Exchange 2016 \\ .\\ResetSearchIndex.ps1 $db_name \u0441\u043a\u0440\u0438\u043f\u0442 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0438\u043d\u0434\u0435\u043a\u0441\u0430 Get-MailboxDatabaseCopyStatus * | where {$_.ContentIndexState -eq \"Failed\" -or $_.ContentIndexState -eq \"FailedAndSuspended\"} \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0443 \u043a\u0430\u043a\u043e\u0439 \u0411\u0414 \u043f\u0440\u043e\u0438\u0437\u043e\u0448\u0435\u043b \u0441\u0431\u043e\u0439 \u0440\u0430\u0431\u043e\u0442\u044b (FailedAndSuspended) \u0438\u043b\u0438 \u0438\u043d\u0434\u0435\u043a\u0441\u0430 (ContentIndexState)","title":"Index"},{"location":"#truenas","text":"import-Module TrueNas \\ (Get-Module TrueNas).ExportedCommands \\ Connect-TrueNasServer -Server tnas-01 -SkipCertificateCheck \\ Get-TrueNasCertificate \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u0430 \\ Get-TrueNasSetting \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u044f\u0437\u044b\u043a\u0430, time zone, syslog level \u0438 server, https port \\ Get-TrueNasUser \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \\ Get-TrueNasSystemVersion \u0445\u0430\u0440\u0430\u043a\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043a\u0438 (Physical Memory, Model, Cores) \u0438 Uptime \\ Get-TrueNasSystemAlert snmp \u0434\u043b\u044f \u043e\u043f\u043e\u0432\u0435\u0449\u0435\u043d\u0438\u0439 \\ Get-TrueNasSystemNTP \u0441\u043f\u0438\u0441\u043e\u043a \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c\u044b\u0445 NTP \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u0432 \\ Get-TrueNasDisk \u0441\u043f\u0438\u0441\u043e\u043a \u0440\u0430\u0437\u0434\u0435\u043b\u043e\u0432 \u0444\u0438\u0437\u0438\u0447\u0435\u0441\u043a\u043e\u0433\u043e \u0434\u0438\u0441\u043a\u0430 \\ Get-TrueNasInterface \u0441\u0435\u0442\u0435\u0432\u044b\u0435 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u044b \\ Get-TrueNasGlobalConfig \u0441\u0435\u0442\u0435\u0432\u044b\u0435 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \\ Get-TrueNasDnsServer \u043d\u0430\u0441\u0442\u0440\u043e\u0435\u043d\u043d\u044b\u0435 DNS-\u0441\u0435\u0440\u0432\u0435\u0440\u0430 \\ Get-TrueNasIscsiTarget \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c ID \u0433\u0440\u0443\u043f\u043f\u044b \u0438\u043d\u0438\u0446\u0438\u0430\u0442\u043e\u0440\u043e\u0432 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0449\u0438\u0445 \u0442\u0430\u0440\u0433\u0435\u0442, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c\u044b\u0439 portal, authentification \u0438 authen-method \\ Get-TrueNasIscsiInitiator \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0433\u0440\u0443\u043f\u043f\u044b \u0438\u043d\u0438\u0446\u0438\u0430\u0442\u043e\u0440\u043e\u0432 \\ Get-TrueNasIscsiPortal \u0441\u043b\u0443\u0448\u0430\u0442\u0435\u043b\u044c (Listen) \u0438 \u043f\u043e\u0440\u0442 \\ Get-TrueNasIscsiExtent \u0441\u043f\u0438\u0441\u043e\u043a ISCSi Target (\u0441\u0442\u0430\u0442\u0443\u0441 \u0440\u0430\u0431\u043e\u0442\u044b, \u043f\u0443\u0442\u044c) \\ Get-TrueNasPool \u0441\u043f\u0438\u0441\u043e\u043a pool (Id, Path, Status, Healthy) \\ Get-TrueNasVolume -Type FILESYSTEM \u0441\u043f\u0438\u0441\u043e\u043a pool \u0444\u0430\u0439\u043b\u043e\u0432\u044b\u0445 \u0441\u0438\u0441\u0442\u0435\u043c \\ Get-TrueNasVolume -Type VOLUME \u0441\u043f\u0438\u0441\u043e\u043a \u0440\u0430\u0437\u0434\u0435\u043b\u043e\u0432 \u0432 pool \u0438 \u0438\u0445 \u0440\u0430\u0437\u043c\u0435\u0440 \\ Get-TrueNasService | ft \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u043b\u0443\u0436\u0431 \u0438 \u0438\u0445 \u0441\u0442\u0430\u0442\u0443\u0441 \\ Start-TrueNasService ssh \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0441\u043b\u0443\u0436\u0431\u0443 \\ Stop-TrueNasService ssh \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0441\u043b\u0443\u0436\u0431\u0443","title":"TrueNAS"},{"location":"#veeam","text":"Set-ExecutionPolicy AllSigned or Set-ExecutionPolicy Bypass -Scope Process \\ Set-ExecutionPolicy Bypass -Scope Process -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1')) \\ choco install veeam-backup-and-replication-console \\ Get-Module Veeam.Backup.PowerShell \\ Get-Command -Module Veeam.Backup.PowerShell or Get-VBRCommand \\ Connect-VBRServer -Server $srv -Credential $cred or -User and -Password - Port 9392 default \\ Get-VBRJob \\ Get-VBRCommand *get*backup* \\ Get-VBRComputerBackupJob \\ Get-VBRBackup \\ Get-VBRBackupRepository \\ Get-VBRBackupSession \\ Get-VBRBackupServerCertificate \\ Get-VBRRestorePoint \\ Get-VBRViProxy","title":"Veeam"},{"location":"#rest-api","text":"$url = \"https://habr.com/ru/rss/users/Lifailon/publications/articles/?fl=ru\" RSS \u043b\u0435\u043d\u0442\u0430 \u043f\u0443\u0431\u043b\u0438\u043a\u0430\u0446\u0438\u0439 \u043d\u0430 Habr \\ Invoke-RestMethod $url \\ $iwr = Invoke-WebRequest -Uri $url \\ $iwr | Get-Member \\ $iwr.Content \\ $iwr.StatusCode -eq 200 \\ $iwr.Headers \\ $iwr.ParsedHtml | Select lastModified \\ $iwr.Links | fl title,innerText,href \\ $iwr.Images.src","title":"REST API"},{"location":"#methods","text":"GET - Read \\ POST - Create \\ PATCH - Partial update/modify \\ PUT - Update/replace \\ DELETE - Remove","title":"Methods"},{"location":"#download-image","text":"function Download-Image { param ( [Parameter(Mandatory = $True)]$url ) $folder = $url -replace \"http.+://\" -replace \"/\",\"-\" -replace \"-$\" $path = \"$home\\Pictures\\$folder\" if (Test-Path $path) { Remove-Item $path -Recurse -Force New-Item -ItemType Directory $path > $null } else { New-Item -ItemType Directory $path > $null } $irm = Invoke-WebRequest -Uri $url foreach ($img in $irm.Images.src) { $name = $img -replace \".+/\" Start-Job { Invoke-WebRequest $using:img -OutFile \"$using:path\\$using:name\" } > $null } while ($True){ $status_job = (Get-Job).State[-1] if ($status_job -like \"Completed\"){ Get-Job | Remove-Job -Force break }} $count_all = $irm.Images.src.Count $count_down = (Get-Item $path\\*).count \"Downloaded $count_down of $count_all files to $path\" } Download-Image -url https://losst.pro/","title":"Download Image"},{"location":"#token","text":"https://veeam-11:9419/swagger/ui/index.html $Header = @{ \"x-api-version\" = \"1.0-rev2\" } $Body = @{ \"grant_type\" = \"password\" \"username\" = \"$login\" \"password\" = \"$password\" } $vpost = iwr \"https://veeam-11:9419/api/oauth2/token\" -Method POST -Headers $Header -Body $Body -SkipCertificateCheck $vtoken = (($vpost.Content) -split '\"')[3]","title":"Token"},{"location":"#get","text":"$token = $vtoken | ConvertTo-SecureString -AsPlainText \u2013Force $vjob = iwr \"https://veeam-11:9419/api/v1/jobs\" -Method GET -Headers $Header -Authentication Bearer -Token $token -SkipCertificateCheck $Header = @{ \"x-api-version\" = \"1.0-rev1\" \"Authorization\" = \"Bearer $vtoken\" } $vjob = iwr \"https://veeam-11:9419/api/v1/jobs\" -Method GET -Headers $Header -SkipCertificateCheck $vjob = $vjob.Content | ConvertFrom-Json $vjob = Invoke-RestMethod \"https://veeam-11:9419/api/v1/jobs\" -Method GET -Headers $Header -SkipCertificateCheck $vjob.data.virtualMachines.includes.inventoryObject","title":"GET"},{"location":"#pode","text":"Start-PodeServer { Add-PodeEndpoint -Address localhost -Port \"8080\" -Protocol \"HTTP\" ### Get info endpoints Add-PodeRoute -Path \"/\" -Method \"GET\" -ScriptBlock { Write-PodeJsonResponse -Value @{ \"service\"=\"/api/service\"; \"process\"=\"/api/process\" } } ### GET Add-PodeRoute -Path \"/api/service\" -Method \"GET\" -ScriptBlock { Write-PodeJsonResponse -Value $( Get-Service | Select-Object Name,@{ Name=\"Status\"; Expression={[string]$_.Status} },@{ Name=\"StartType\"; Expression={[string]$_.StartType} } | ConvertTo-Json ) } Add-PodeRoute -Path \"/api/process\" -Method \"GET\" -ScriptBlock { Write-PodeJsonResponse -Value $( Get-Process | Sort-Object -Descending CPU | Select-Object -First 15 ProcessName, @{Name=\"ProcessorTime\"; Expression={$_.TotalProcessorTime -replace \"\\.\\d+$\"}}, @{Name=\"Memory\"; Expression={[string]([int]($_.WS / 1024kb))+\"MB\"}}, @{Label=\"RunTime\"; Expression={((Get-Date) - $_.StartTime) -replace \"\\.\\d+$\"}} ) } Add-PodeRoute -Path \"/api/process-html\" -Method \"GET\" -ScriptBlock { Write-PodeHtmlResponse -Value ( Get-Process | Sort-Object -Descending CPU | Select-Object -First 15 ProcessName, @{Name=\"ProcessorTime\"; Expression={$_.TotalProcessorTime -replace \"\\.\\d+$\"}}, @{Name=\"Memory\"; Expression={[string]([int]($_.WS / 1024kb))+\"MB\"}}, @{Label=\"RunTime\"; Expression={((Get-Date) - $_.StartTime) -replace \"\\.\\d+$\"}} # Auto ConvertTo-Html ) } ### POST Add-PodeRoute -Path \"/api/service\" -Method \"POST\" -ScriptBlock { # https://pode.readthedocs.io/en/latest/Tutorials/WebEvent/ # $WebEvent | Out-Default $Value = $WebEvent.Data[\"ServiceName\"] $Status = (Get-Service -Name $Value).Status Write-PodeJsonResponse -Value @{ \"Name\"=\"$Value\"; \"Status\"=\"$Status\"; } } } irm http://localhost:8080/api/service -Method Get \\ irm http://localhost:8080/api/process -Method Get \\ http://localhost:8080/api/process-html \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0431\u0440\u0430\u0443\u0437\u0435\u0440 \\ irm http://localhost:8080/api/service -Method Post -Body @{\"ServiceName\" = \"AnyDesk\"}","title":"Pode"},{"location":"#selenium","text":"Invoke-Expression(New-Object Net.WebClient).DownloadString(\"https://raw.githubusercontent.com/Lifailon/Deploy-Selenium/rsa/Deploy-Selenium-Drivers.ps1\") \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 \u0432\u0441\u0435\u0445 \u0434\u0440\u0430\u0439\u0432\u0435\u0440\u043e\u0432 \u0438 Chromium \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0439 \u0432\u0435\u0440\u0441\u0438\u0438 \u0434\u043b\u044f \u0434\u0440\u0430\u0439\u0432\u0435\u0440\u0430 $path = \"$home\\Documents\\Selenium\\\" $log = \"$path\\ChromeDriver.log\" $ChromeDriver = \"$path\\ChromeDriver.exe\" $WebDriver = \"$path\\WebDriver.dll\" $SupportDriver = \"$path\\WebDriver.Support.dll\" $Chromium = (Get-ChildItem $path -Recurse | Where-Object Name -like chrome.exe).FullName Add-Type -Path $WebDriver Add-Type -Path $SupportDriver try { $ChromeOptions = New-Object OpenQA.Selenium.Chrome.ChromeOptions # \u0441\u043e\u0437\u0434\u0430\u0435\u043c \u043e\u0431\u044a\u0435\u043a\u0442 \u0441 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430\u043c\u0438 \u0437\u0430\u043f\u0443\u0441\u043a\u0430 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0430 $ChromeOptions.BinaryLocation = $Chromium # \u043f\u0435\u0440\u0435\u0434\u0430\u0435\u043c \u043f\u0443\u0442\u044c \u0434\u043e \u0438\u0441\u043f\u043e\u043b\u043d\u044f\u0435\u043c\u043e\u0433\u043e \u0444\u0430\u0439\u043b\u0430, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442 \u0437\u0430 \u0437\u0430\u043f\u0443\u0441\u043a \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0430 $ChromeOptions.AddArgument(\"start-maximized\") # \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0431\u0440\u0430\u0443\u0437\u0435\u0440 \u043d\u0430 \u0432\u0435\u0441\u044c \u044d\u043a\u0440\u0430\u043d #$ChromeOptions.AddArgument(\"start-minimized\") # \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u043c \u0431\u0440\u0430\u0443\u0437\u0435\u0440 \u0432 \u043e\u043a\u043d\u0435 #$ChromeOptions.AddArgument(\"window-size=400,800\") # \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u043c \u0431\u0440\u0430\u0443\u0437\u0435\u0440 \u0441 \u0437\u0430\u0434\u0430\u043d\u043d\u044b\u043c\u0438 \u0440\u0430\u0437\u043c\u0435\u0440\u0430\u043c \u043e\u043a\u043d\u0430 \u0432 \u043f\u0438\u043a\u0441\u0435\u043b\u044f\u0445 $ChromeOptions.AcceptInsecureCertificates = $True # \u0438\u0433\u043d\u043e\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u0435\u0434\u0443\u043f\u0440\u0435\u0436\u0434\u0435\u043d\u0438\u0435 \u043d\u0430 \u0441\u0430\u0439\u0442\u0430\u0445 \u0441 \u043d\u0435 \u0432\u0430\u043b\u0438\u0434\u043d\u044b\u043c \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u043c #$ChromeOptions.AddArgument(\"headless\") # \u0441\u043a\u0440\u044b\u0432\u0430\u0442\u044c \u043e\u043a\u043d\u043e \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0430 \u043f\u0440\u0438 \u0437\u0430\u043f\u0443\u0441\u043a\u0435 $ChromeDriverService = [OpenQA.Selenium.Chrome.ChromeDriverService]::CreateDefaultService($ChromeDriver) # \u0441\u043e\u0437\u0434\u0430\u0435\u043c \u043e\u0431\u044a\u0435\u043a\u0442 \u043d\u0430\u0441\u0442\u0440\u043e\u0435\u043a \u0441\u043b\u0443\u0436\u0431\u044b \u0434\u0440\u0430\u0439\u0432\u0435\u0440\u0430 $ChromeDriverService.HideCommandPromptWindow = $True # \u043e\u0442\u043a\u043b\u044e\u0447\u0430\u0435\u043c \u0432\u0435\u0441\u044c \u0432\u044b\u0432\u043e\u0434 \u043b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0434\u0440\u0430\u0439\u0432\u0435\u0440\u0430 \u0432 \u043a\u043e\u043d\u0441\u043e\u043b\u044c (\u044d\u0442\u043e\u0442 \u0432\u044b\u0432\u043e\u0434 \u043d\u0435\u043b\u044c\u0437\u044f \u043f\u0435\u0440\u0435\u043d\u0430\u043f\u0440\u0430\u0432\u0438\u0442\u044c) $ChromeDriverService.LogPath = $log # \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u043f\u0443\u0442\u044c \u0434\u043e \u0444\u0430\u0439\u043b\u0430 \u0441 \u0436\u0443\u0440\u043d\u0430\u043b\u043e\u043c $ChromeDriverService.EnableAppendLog = $True # \u043d\u0435 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0438\u0441\u044b\u0432\u0430\u0442\u044c \u0436\u0443\u0440\u043d\u0430\u043b \u043f\u0440\u0438 \u043a\u0430\u0436\u0434\u043e\u043c \u043d\u043e\u0432\u043e\u043c \u0437\u0430\u043f\u0443\u0441\u043a\u0435 #$ChromeDriverService.EnableVerboseLogging = $True # \u043a\u0440\u043e\u043c\u0435 INFO \u0438 \u043e\u0448\u0438\u0431\u043e\u043a, \u0437\u0430\u043f\u0438\u0441\u044b\u0432\u0430\u0442\u044c DEBUG \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f $Selenium = New-Object OpenQA.Selenium.Chrome.ChromeDriver($ChromeDriverService, $ChromeOptions) # \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0435\u043c \u0437\u0430\u043f\u0443\u0441\u043a \u0441 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u043c\u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430\u043c\u0438 $Selenium.Navigate().GoToUrl(\"https://google.com\") # \u043f\u0435\u0440\u0435\u0445\u043e\u0434\u0438\u043c \u043f\u043e \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0439 \u0441\u0441\u044b\u043b\u043a\u0435 \u0432 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0435 #$Selenium.Manage().Window.Minimize() # \u0441\u0432\u0435\u0440\u043d\u0443\u0442\u044c \u043e\u043a\u043d\u043e \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0430 \u043f\u043e\u0441\u043b\u0435 \u0437\u0430\u043f\u0443\u0441\u043a\u0430 \u0438 \u043f\u0435\u0440\u0435\u0445\u043e\u0434\u0430 \u043f\u043e \u043d\u0443\u0436\u043d\u043e\u043c\u0443 url (\u0447\u0442\u043e \u0431\u044b \u0441\u0447\u0438\u0442\u0430\u0442\u044c \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e) # \u0418\u0449\u0435\u043c \u043f\u043e\u043b\u0435 \u0434\u043b\u044f \u0432\u0432\u043e\u0434\u0430 \u0442\u0435\u043a\u0441\u0442\u0430: $Search = $Selenium.FindElements([OpenQA.Selenium.By]::Id('APjFqb')) $Search = $Selenium.FindElements([OpenQA.Selenium.By]::XPath('//*[@id=\"APjFqb\"]')) $Search = $Selenium.FindElements([OpenQA.Selenium.By]::Name('q')) $Search = $Selenium.FindElements([OpenQA.Selenium.By]::XPath('//*[@name=\"q\"]')) $Search = $Selenium.FindElements([OpenQA.Selenium.By]::ClassName('gLFyf')) $Search = $Selenium.FindElements([OpenQA.Selenium.By]::CssSelector('[jsname=\"yZiJbe\"]')) $Search = $Selenium.FindElements([OpenQA.Selenium.By]::TagName('textarea')) | Where-Object ComputedAccessibleRole -eq combobox $Search.SendKeys(\"calculator online\") # \u043f\u0435\u0440\u0435\u0434\u0430\u0435\u043c \u0442\u0435\u043a\u0441\u0442 \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u043e\u043c\u0443 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0443 $Search.SendKeys([OpenQA.Selenium.Keys]::Enter) # \u043d\u0430\u0436\u0438\u043c\u0430\u0435\u043c Enter \u0434\u043b\u044f \u0432\u044b\u0437\u043e\u0432\u0430 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 \u043f\u043e\u0438\u0441\u043a\u0430 Start-Sleep 1 $div = $Selenium.FindElements([OpenQA.Selenium.By]::TagName(\"div\")) $2 = $div | Where-Object {($_.ComputedAccessibleRole -eq \"button\") -and ($_.ComputedAccessibleLabel -eq \"2\")} $2.Click() $2.Click() $plus = $div | Where-Object {($_.ComputedAccessibleRole -eq \"button\") -and ($_.Text -eq \"+\")} $plus.Click() $3 = $Selenium.FindElement([OpenQA.Selenium.By]::CssSelector('[jsname=\"KN1kY\"]')) $3.Click() $3.Click() $sum = $Selenium.FindElement([OpenQA.Selenium.By]::CssSelector('[jsname=\"Pt8tGc\"]')) $sum.Click() $result = $Selenium.FindElement([OpenQA.Selenium.By]::CssSelector('[jsname=\"VssY5c\"]')).Text Write-Host \"Result: $result\" -ForegroundColor Green } finally { $Selenium.Close() $Selenium.Quit() }","title":"Selenium"},{"location":"#selenium-modules","text":"Invoke-RestMethod https://raw.githubusercontent.com/Lifailon/Selenium-Modules/rsa/Modules/Get-GPT/Get-GPT.psm1 | Out-File -FilePath \"$(New-Item -Path \"$($($Env:PSModulePath -split \";\")[0])\\Get-GPT\" -ItemType Directory -Force)\\Get-GPT.psm1\" -Force Get-GPT \"\u0418\u0441\u043f\u043e\u043b\u043d\u044f\u0439 \u0440\u043e\u043b\u044c \u043a\u0430\u043b\u044c\u043a\u0443\u043b\u044f\u0442\u043e\u0440\u0430. \u041f\u043e\u0441\u0447\u0438\u0442\u0430\u0439 \u0441\u0443\u043c\u043c\u0443 \u0447\u0438\u0441\u0435\u043b: 22+33\" Invoke-RestMethod https://raw.githubusercontent.com/Lifailon/Selenium-Modules/rsa/Modules/Get-Translation/Get-Translation.psm1 | Out-File -FilePath \"$(New-Item -Path \"$($($Env:PSModulePath -split \";\")[0])\\Get-Translation\" -ItemType Directory -Force)\\Get-Translation.psm1\" -Force Get-Translation -Provider DeepL -Text \"I translating the text\" \\ Get-Translation -Provider DeepL -Text \"\u042f \u043f\u0435\u0440\u0435\u0432\u043e\u0436\u0443 \u0442\u0435\u043a\u0441\u0442\" \\ Get-Translation -Provider Google -Text \"I translating the text\" \\ Get-Translation -Provider Google -Text \"\u042f \u043f\u0435\u0440\u0435\u0432\u043e\u0436\u0443 \u0442\u0435\u043a\u0441\u0442\" -Language en Invoke-RestMethod https://raw.githubusercontent.com/Lifailon/Selenium-Modules/rsa/Modules/Get-SpeedTest/Get-SpeedTest.psm1 | Out-File -FilePath \"$(New-Item -Path \"$($($Env:PSModulePath -split \";\")[0])\\Get-SpeedTest\" -ItemType Directory -Force)\\Get-SpeedTest.psm1\" -Force Get-SpeedTest -Provider Libre \\ Get-SpeedTest -Provider Open \\ Get-SpeedTest -Provider Ookla","title":"Selenium modules"},{"location":"#ie","text":"$ie.document.IHTMLDocument3_getElementsByTagName(\"input\") | select name \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0438\u043c\u0435\u043d\u0430 \u0432\u0441\u0435\u0445 Input Box \\ $ie.document.IHTMLDocument3_getElementsByTagName(\"button\") | select innerText \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0438\u043c\u0435\u043d\u0430 \u0432\u0441\u0435\u0445 Button \\ $ie.Document.documentElement.innerHTML \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u0442\u044c \u0441\u044b\u0440\u043e\u0439 Web Content (<input name=\"login\" tabindex=\"100\" class=\"input__control input__input\" id=\"uniq32005644019429136\" spellcheck=\"false\" placeholder=\"\u041b\u043e\u0433\u0438\u043d\") \\ $All_Elements = $ie.document.IHTMLDocument3_getElementsByTagName(\"*\") \u0437\u0430\u0431\u0440\u0430\u0442\u044c \u0432\u0441\u0435 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u044b \\ $Go_Button = $All_Elements | ? innerText -like \"go\" \u043f\u043e\u0438\u0441\u043a \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430 \u043f\u043e \u0438\u043c\u0435\u043d\u0438 \\ $Go_Button | select ie9_tagName \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c TagName (SPAN) \u0434\u043b\u044f \u0431\u044b\u0441\u0442\u0440\u043e\u0433\u043e \u0434\u0430\u043b\u044c\u043d\u0435\u0439\u0448\u0435\u0433\u043e \u043f\u043e\u0438\u0441\u043a\u0430 \\ $SPAN_Elements = $ie.document.IHTMLDocument3_getElementsByTagName(\"SPAN\") $ie = New-Object -ComObject InternetExplorer.Application $ie.navigate(\"https://yandex.ru\") $ie.visible = $true $ie.document.IHTMLDocument3_getElementByID(\"login\").value = \"Login\" $ie.document.IHTMLDocument3_getElementByID(\"passwd\").value = \"Password\" $Button_Auth = ($ie.document.IHTMLDocument3_getElementsByTagName(\"button\")) | ? innerText -match \"\u0412\u043e\u0439\u0442\u0438\" $Button_Auth.Click() $Result = $ie.Document.documentElement.innerHTML $ie.Quit()","title":"IE"},{"location":"#com","text":"$wshell = New-Object -ComObject Wscript.Shell \\ $wshell | Get-Member \\ $link = $wshell.CreateShortcut(\"$Home\\Desktop\\Yandex.lnk\") \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u044f\u0440\u043b\u044b\u043a \\ $link | Get-Member \\ $link.TargetPath = \"https://yandex.ru\" \u043a\u0443\u0434\u0430 \u0441\u0441\u044b\u043b\u0430\u0435\u0442\u0441\u044f (\u043c\u0435\u0442\u043e\u0434 TargetPath \u043e\u0431\u044a\u0435\u043a\u0442\u0430 $link \u0433\u0434\u0435 \u0445\u0440\u0430\u043d\u0438\u0442\u0441\u044f \u043e\u0431\u044a\u0435\u043a\u0442 CreateShortcut) \\ $link.Save() \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c Set-WinUserLanguageList -LanguageList en-us,ru -Force \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u044f\u0437\u044b\u043a\u043e\u0432\u0443\u044e \u0440\u0430\u0441\u043a\u043b\u0430\u0434\u043a\u0443 \u043a\u043b\u0430\u0432\u0438\u0430\u0442\u0443\u0440\u044b","title":"COM"},{"location":"#wscriptshellsendkeys","text":"(New-Object -ComObject Wscript.shell).SendKeys([char]173) \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c/\u0432\u044b\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0437\u0432\u0443\u043a \\ $wshell.Exec(\"notepad.exe\") \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \\ $wshell.AppActivate(\"\u0411\u043b\u043e\u043a\u043d\u043e\u0442\") \u0440\u0430\u0437\u0432\u0435\u0440\u043d\u0443\u0442\u044c \u0437\u0430\u043f\u0443\u0449\u0435\u043d\u043d\u043e\u0435 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435 $wshell.SendKeys(\"Login\") \u0442\u0435\u043a\u0441\u0442 \\ $wshell.SendKeys(\"{A 5}\") \u043d\u0430\u043f\u0435\u0447\u0430\u0442\u0430\u0442\u044c \u0431\u0443\u043a\u0432\u0443 5 \u0440\u0430\u0437 \u043f\u043e\u0434\u0440\u044f\u0434 \\ $wshell.SendKeys(\"%{TAB}\") ALT+TAB \\ $wshell.SendKeys(\"^\") CTRL \\ $wshell.SendKeys(\"%\") ALT \\ $wshell.SendKeys(\"+\") SHIFT \\ $wshell.SendKeys(\"{DOWN}\") \u0432\u043d\u0438\u0437 \\ $wshell.SendKeys(\"{UP}\") \u0432\u0432\u0435\u0440\u0445 \\ $wshell.SendKeys(\"{LEFT}\") \u0432\u043b\u0435\u0432\u043e \\ $wshell.SendKeys(\"{RIGHT}\") \u0432\u043f\u0440\u0430\u0432\u043e \\ $wshell.SendKeys(\"{PGUP}\") PAGE UP \\ $wshell.SendKeys(\"{PGDN}\") PAGE DOWN \\ $wshell.SendKeys(\"{BACKSPACE}\") BACKSPACE/BKSP/BS \\ $wshell.SendKeys(\"{DEL}\") DEL/DELETE \\ $wshell.SendKeys(\"{INS}\") INS/INSERT \\ $wshell.SendKeys(\"{PRTSC}\") PRINT SCREEN \\ $wshell.SendKeys(\"{ENTER}\") \\ $wshell.SendKeys(\"{ESC}\") \\ $wshell.SendKeys(\"{TAB}\") \\ $wshell.SendKeys(\"{END}\") \\ $wshell.SendKeys(\"{HOME}\") \\ $wshell.SendKeys(\"{BREAK}\") \\ $wshell.SendKeys(\"{SCROLLLOCK}\") \\ $wshell.SendKeys(\"{CAPSLOCK}\") \\ $wshell.SendKeys(\"{NUMLOCK}\") \\ $wshell.SendKeys(\"{F1}\") \\ $wshell.SendKeys(\"{F12}\") \\ $wshell.SendKeys(\"{+}{^}{%}{~}{(}{)}{[}{]}{{}{}}\") function Get-AltTab { (New-Object -ComObject wscript.shell).SendKeys(\"%{Tab}\") Start-Sleep $(Get-Random -Minimum 30 -Maximum 180) Get-AltTab } Get-AltTab","title":"Wscript.Shell.SendKeys"},{"location":"#wscriptshellpopup","text":"$wshell = New-Object -ComObject Wscript.Shell \\ $output = $wshell.Popup(\"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435?\",0,\"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a\",4) \\ if ($output -eq 6) {\"yes\"} elseif ($output -eq 7) {\"no\"} else {\"no good\"} Type: 0 \u041e\u041a 1 \u041e\u041a \u0438 \u041e\u0442\u043c\u0435\u043d\u0430 2 \u0421\u0442\u043e\u043f, \u041f\u043e\u0432\u0442\u043e\u0440, \u041f\u0440\u043e\u043f\u0443\u0441\u0442\u0438\u0442\u044c 3 \u0414\u0430, \u041d\u0435\u0442, \u041e\u0442\u043c\u0435\u043d\u0430 4 \u0414\u0430 \u0438 \u041d\u0435\u0442 5 \u041f\u043e\u0432\u0442\u043e\u0440 \u0438 \u041e\u0442\u043c\u0435\u043d\u0430 16 Stop 32 Question 48 Exclamation 64 Information Output: -1 Timeout 1 \u041e\u041a 2 \u041e\u0442\u043c\u0435\u043d\u0430 3 \u0421\u0442\u043e\u043f 4 \u041f\u043e\u0432\u0442\u043e\u0440 5 \u041f\u0440\u043e\u043f\u0443\u0441\u0442\u0438\u0442\u044c 6 \u0414\u0430 7 \u041d\u0435\u0442","title":"Wscript.Shell.Popup"},{"location":"#wscriptnetwork","text":"$wshell = New-Object -ComObject WScript.Network \\ $wshell | Get-Member \\ $wshell.UserName \\ $wshell.ComputerName \\ $wshell.UserDomain","title":"WScript.Network"},{"location":"#shellapplication","text":"$wshell = New-Object -ComObject Shell.Application \\ $wshell | Get-Member \\ $wshell.Explore(\"C:\\\") \\ $wshell.Windows() | Get-Member \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0434\u043e\u0441\u0442\u0443\u043f \u043a \u043e\u0442\u043a\u0440\u044b\u0442\u044b\u043c \u0432 \u043f\u0440\u043e\u0432\u043e\u0434\u043d\u0438\u043a\u0435 \u0438\u043b\u0438 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0435 Internet Explorer \u043e\u043a\u043e\u043d $shell = New-Object -Com Shell.Application \\ $RecycleBin = $shell.Namespace(10) \\ $RecycleBin.Items()","title":"Shell.Application"},{"location":"#outlook","text":"$Outlook = New-Object -ComObject Outlook.Application \\ $Outlook | Get-Member \\ $Outlook.Version $Outlook = New-Object -ComObject Outlook.Application $Namespace = $Outlook.GetNamespace(\"MAPI\") $Folder = $namespace.GetDefaultFolder(4)` \u0438\u0441\u0445\u043e\u0434\u044f\u0449\u0438\u0435 $Folder = $namespace.GetDefaultFolder(6)` \u0432\u0445\u043e\u0434\u044f\u0449\u0438\u0435 $Explorer = $Folder.GetExplorer() $Explorer.Display() $Outlook.Quit()","title":"Outlook"},{"location":"#microsoftupdate","text":"(New-Object -com 'Microsoft.Update.AutoUpdate').Settings \\ (New-Object -com 'Microsoft.Update.AutoUpdate').Results \\ (New-Timespan -Start ((New-Object -com 'Microsoft.Update.AutoUpdate').Results|Select -ExpandProperty LastInstallationSuccessDate) -End (Get-Date)).hours \u043a\u043e\u043b-\u0432\u043e \u0447\u0430\u0441\u043e\u0432, \u043f\u0440\u043e\u0448\u0435\u0434\u0448\u0438\u0445 \u0441 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0439 \u0434\u0430\u0442\u044b \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u0438 \u0432 Windows.","title":"Microsoft.Update"},{"location":"#dotnet","text":"[System.Diagnostics.EventLog] | select Assembly,Module \\ $EventLog = [System.Diagnostics.EventLog]::new(\"Application\") \\ $EventLog = New-Object -TypeName System.Diagnostics.EventLog -ArgumentList Application,192.168.3.100 \\ $EventLog | Get-Member -MemberType Method \\ $EventLog.MaximumKilobytes \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439 \u0440\u0430\u0437\u043c\u0435\u0440 \u0436\u0443\u0440\u043d\u0430\u043b\u0430 \\ $EventLog.Entries \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0436\u0443\u0440\u043d\u0430\u043b \\ $EventLog.Clear() \u043e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u0436\u0443\u0440\u043d\u0430\u043b Join-Path C: Install Test \\ [System.IO.Path]::Combine(\"C:\", \"Install\", \"Test\")","title":"dotNET"},{"location":"#match","text":"[System.Math] | Get-Member -Static -MemberType Methods \\ [System.Math]::Max(2,7) \\ [System.Math]::Min(2,7) \\ [System.Math]::Floor(3.9) \\ [System.Math]::Truncate(3.9)","title":"Match"},{"location":"#generatepassword","text":"Add-Type -AssemblyName System.Web \\ [System.Web.Security.Membership]::GeneratePassword(10,2)","title":"GeneratePassword"},{"location":"#soundplayer","text":"$CriticalSound = New-Object System.Media.SoundPlayer $CriticalSound.SoundLocation = \"C:\\WINDOWS\\Media\\Windows Critical Stop.wav\" $CriticalSound.Play() $GoodSound = New-Object System.Media.SoundPlayer $GoodSound.SoundLocation = \"C:\\WINDOWS\\Media\\tada.wav\" $GoodSound.Play()","title":"SoundPlayer"},{"location":"#static-class","text":"[System.Environment] | Get-Member -Static \\ [System.Environment]::OSVersion \\ [System.Environment]::Version \\ [System.Environment]::MachineName \\ [System.Environment]::UserName [System.Diagnostics.Process] | Get-Member -Static \\ [System.Diagnostics.Process]::Start('notepad.exe')","title":"Static Class"},{"location":"#clicker","text":"$cSource = @' using System; using System.Drawing; using System.Runtime.InteropServices; using System.Windows.Forms; public class Clicker { //https://msdn.microsoft.com/en-us/library/windows/desktop/ms646270(v=vs.85).aspx [StructLayout(LayoutKind.Sequential)] struct INPUT { public int type; // 0 = INPUT_MOUSE, // 1 = INPUT_KEYBOARD // 2 = INPUT_HARDWARE public MOUSEINPUT mi; } //https://msdn.microsoft.com/en-us/library/windows/desktop/ms646273(v=vs.85).aspx [StructLayout(LayoutKind.Sequential)] struct MOUSEINPUT { public int dx ; public int dy ; public int mouseData ; public int dwFlags; public int time; public IntPtr dwExtraInfo; } //This covers most use cases although complex mice may have additional buttons //There are additional constants you can use for those cases, see the msdn page const int MOUSEEVENTF_MOVED = 0x0001 ; const int MOUSEEVENTF_LEFTDOWN = 0x0002 ; const int MOUSEEVENTF_LEFTUP = 0x0004 ; const int MOUSEEVENTF_RIGHTDOWN = 0x0008 ; const int MOUSEEVENTF_RIGHTUP = 0x0010 ; const int MOUSEEVENTF_MIDDLEDOWN = 0x0020 ; const int MOUSEEVENTF_MIDDLEUP = 0x0040 ; const int MOUSEEVENTF_WHEEL = 0x0080 ; const int MOUSEEVENTF_XDOWN = 0x0100 ; const int MOUSEEVENTF_XUP = 0x0200 ; const int MOUSEEVENTF_ABSOLUTE = 0x8000 ; const int screen_length = 0x10000 ; //https://msdn.microsoft.com/en-us/library/windows/desktop/ms646310(v=vs.85).aspx [System.Runtime.InteropServices.DllImport(\"user32.dll\")] extern static uint SendInput(uint nInputs, INPUT[] pInputs, int cbSize); public static void LeftClickAtPoint(int x, int y) { //Move the mouse INPUT[] input = new INPUT[3]; input[0].mi.dx = x*(65535/System.Windows.Forms.Screen.PrimaryScreen.Bounds.Width); input[0].mi.dy = y*(65535/System.Windows.Forms.Screen.PrimaryScreen.Bounds.Height); input[0].mi.dwFlags = MOUSEEVENTF_MOVED | MOUSEEVENTF_ABSOLUTE; //Left mouse button down input[1].mi.dwFlags = MOUSEEVENTF_LEFTDOWN; //Left mouse button up input[2].mi.dwFlags = MOUSEEVENTF_LEFTUP; SendInput(3, input, Marshal.SizeOf(input[0])); } } '@ Add-Type -TypeDefinition $cSource -ReferencedAssemblies System.Windows.Forms,System.Drawing \\ [Clicker]::LeftClickAtPoint(1900,1070)","title":"[Clicker]"},{"location":"#audio","text":"Add-Type -Language CsharpVersion3 -TypeDefinition @\" using System.Runtime.InteropServices; [Guid(\"5CDF2C82-841E-4546-9722-0CF74078229A\"), InterfaceType(ComInterfaceType.InterfaceIsIUnknown)] interface IAudioEndpointVolume { // f(), g(), ... are unused COM method slots. Define these if you care int f(); int g(); int h(); int i(); int SetMasterVolumeLevelScalar(float fLevel, System.Guid pguidEventContext); int j(); int GetMasterVolumeLevelScalar(out float pfLevel); int k(); int l(); int m(); int n(); int SetMute([MarshalAs(UnmanagedType.Bool)] bool bMute, System.Guid pguidEventContext); int GetMute(out bool pbMute); } [Guid(\"D666063F-1587-4E43-81F1-B948E807363F\"), InterfaceType(ComInterfaceType.InterfaceIsIUnknown)] interface IMMDevice { int Activate(ref System.Guid id, int clsCtx, int activationParams, out IAudioEndpointVolume aev); } [Guid(\"A95664D2-9614-4F35-A746-DE8DB63617E6\"), InterfaceType(ComInterfaceType.InterfaceIsIUnknown)] interface IMMDeviceEnumerator { int f(); // Unused int GetDefaultAudioEndpoint(int dataFlow, int role, out IMMDevice endpoint); } [ComImport, Guid(\"BCDE0395-E52F-467C-8E3D-C4579291692E\")] class MMDeviceEnumeratorComObject { } public class Audio { static IAudioEndpointVolume Vol() { var enumerator = new MMDeviceEnumeratorComObject() as IMMDeviceEnumerator; IMMDevice dev = null; Marshal.ThrowExceptionForHR(enumerator.GetDefaultAudioEndpoint(/*eRender*/ 0, /*eMultimedia*/ 1, out dev)); IAudioEndpointVolume epv = null; var epvid = typeof(IAudioEndpointVolume).GUID; Marshal.ThrowExceptionForHR(dev.Activate(ref epvid, /*CLSCTX_ALL*/ 23, 0, out epv)); return epv; } public static float Volume { get {float v = -1; Marshal.ThrowExceptionForHR(Vol().GetMasterVolumeLevelScalar(out v)); return v;} set {Marshal.ThrowExceptionForHR(Vol().SetMasterVolumeLevelScalar(value, System.Guid.Empty));} } public static bool Mute { get { bool mute; Marshal.ThrowExceptionForHR(Vol().GetMute(out mute)); return mute; } set { Marshal.ThrowExceptionForHR(Vol().SetMute(value, System.Guid.Empty)); } } } \"@ [Audio]::Volume = 0.50 \\ [Audio]::Mute = $true","title":"[Audio]"},{"location":"#netsessionenum","text":"Function \\ Source function Invoke-NetSessionEnum { param ( [Parameter(Mandatory = $True)][string]$HostName ) Add-Type -TypeDefinition @\" using System; using System.Diagnostics; using System.Runtime.InteropServices; [StructLayout(LayoutKind.Sequential)] public struct SESSION_INFO_10 { [MarshalAs(UnmanagedType.LPWStr)]public string OriginatingHost; [MarshalAs(UnmanagedType.LPWStr)]public string DomainUser; public uint SessionTime; public uint IdleTime; } public static class Netapi32 { [DllImport(\"Netapi32.dll\", SetLastError=true)] public static extern int NetSessionEnum( [In,MarshalAs(UnmanagedType.LPWStr)] string ServerName, [In,MarshalAs(UnmanagedType.LPWStr)] string UncClientName, [In,MarshalAs(UnmanagedType.LPWStr)] string UserName, Int32 Level, out IntPtr bufptr, int prefmaxlen, ref Int32 entriesread, ref Int32 totalentries, ref Int32 resume_handle); [DllImport(\"Netapi32.dll\", SetLastError=true)] public static extern int NetApiBufferFree( IntPtr Buffer); } \"@ # Create SessionInfo10 Struct $SessionInfo10 = New-Object SESSION_INFO_10 $SessionInfo10StructSize = [System.Runtime.InteropServices.Marshal]::SizeOf($SessionInfo10)` Grab size to loop bufptr $SessionInfo10 = $SessionInfo10.GetType()` Hacky, but we need this ;)) # NetSessionEnum params $OutBuffPtr = [IntPtr]::Zero` Struct output buffer $EntriesRead = $TotalEntries = $ResumeHandle = 0` Counters & ResumeHandle $CallResult = [Netapi32]::NetSessionEnum($HostName, \"\", \"\", 10, [ref]$OutBuffPtr, -1, [ref]$EntriesRead, [ref]$TotalEntries, [ref]$ResumeHandle) if ($CallResult -ne 0){ echo \"Mmm something went wrong!`nError Code: $CallResult\" } else { if ([System.IntPtr]::Size -eq 4) { echo \"`nNetapi32::NetSessionEnum Buffer Offset --> 0x$(\"{0:X8}\" -f $OutBuffPtr.ToInt32())\" } else { echo \"`nNetapi32::NetSessionEnum Buffer Offset --> 0x$(\"{0:X16}\" -f $OutBuffPtr.ToInt64())\" } echo \"Result-set contains $EntriesRead session(s)!\" # Change buffer offset to int $BufferOffset = $OutBuffPtr.ToInt64() # Loop buffer entries and cast pointers as SessionInfo10 for ($Count = 0; ($Count -lt $EntriesRead); $Count++){ $NewIntPtr = New-Object System.Intptr -ArgumentList $BufferOffset $Info = [system.runtime.interopservices.marshal]::PtrToStructure($NewIntPtr,[type]$SessionInfo10) $Info $BufferOffset = $BufferOffset + $SessionInfo10StructSize } echo \"`nCalling NetApiBufferFree, no memleaks here!\" [Netapi32]::NetApiBufferFree($OutBuffPtr) |Out-Null } } Invoke-NetSessionEnum localhost","title":"NetSessionEnum"},{"location":"#copyfile","text":"Function \\ Source $MethodDefinition = @\" [DllImport(\"kernel32.dll\", CharSet = CharSet.Unicode)] public static extern bool CopyFile(string lpExistingFileName, string lpNewFileName, bool bFailIfExists); \"@ $Kernel32 = Add-Type -MemberDefinition $MethodDefinition -Name \"Kernel32\" -Namespace \"Win32\" -PassThru $Kernel32::CopyFile(\"$($Env:SystemRoot)\\System32\\calc.exe\", \"$($Env:USERPROFILE)\\Desktop\\calc.exe\", $False)","title":"CopyFile"},{"location":"#showwindowasync","text":"Function $Signature = @\" [DllImport(\"user32.dll\")]public static extern bool ShowWindowAsync(IntPtr hWnd, int nCmdShow); \"@ $ShowWindowAsync = Add-Type -MemberDefinition $Signature -Name \"Win32ShowWindowAsync\" -Namespace Win32Functions -PassThru $ShowWindowAsync | Get-Member -Static $ShowWindowAsync::ShowWindowAsync((Get-Process -Id $pid).MainWindowHandle, 2) $ShowWindowAsync::ShowWindowAsync((Get-Process -Id $Pid).MainWindowHandle, 3) $ShowWindowAsync::ShowWindowAsync((Get-Process -Id $Pid).MainWindowHandle, 4)","title":"ShowWindowAsync"},{"location":"#getasynckeystate","text":"Function Add-Type -AssemblyName System.Windows.Forms \\ [int][System.Windows.Forms.Keys]::F1 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c \u043d\u043e\u043c\u0435\u0440 [Int] \u043a\u043b\u0430\u0432\u0438\u0448\u0438 \u043f\u043e \u0435\u0435 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044e \\ 65..90 | % {\"{0} = {1}\" -f $_, [System.Windows.Forms.Keys]$_} \u043f\u043e\u0440\u044f\u0434\u043a\u043e\u0432\u044b\u0439 \u043d\u043e\u043c\u0435\u0440 \u0431\u0443\u043a\u0432 (A..Z) function Get-ControlKey { $key = 112 $Signature = @' [DllImport(\"user32.dll\", CharSet=CharSet.Auto, ExactSpelling=true)] public static extern short GetAsyncKeyState(int virtualKeyCode); '@ Add-Type -MemberDefinition $Signature -Name Keyboard -Namespace PsOneApi [bool]([PsOneApi.Keyboard]::GetAsyncKeyState($key) -eq -32767) } Write-Warning 'Press F1 to exit' while ($true) { Write-Host '.' -NoNewline if (Get-ControlKey) { break } Start-Sleep -Seconds 0.5 }","title":"GetAsyncKeyState"},{"location":"#console-api","text":"Source [Console] | Get-Member -Static \\ [Console]::BackgroundColor = \"Blue\" \\ [Console]::OutputEncoding \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c\u0430\u044f \u043a\u043e\u0434\u0438\u0440\u043e\u0432\u043a\u0430 \u0432 \u0442\u0435\u043a\u0443\u0449\u0435\u0439 \u0441\u0435\u0441\u0441\u0438\u0438 \\ [Console]::OutputEncoding = [System.Text.Encoding]::GetEncoding(\"utf-8\") \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043a\u043e\u0434\u0438\u0440\u043e\u0432\u043a\u0443 \u0434\u043b\u044f \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043a\u0438\u0440\u0438\u043b\u043b\u0438\u0446\u044b \\ [Console]::outputEncoding = [System.Text.Encoding]::GetEncoding(\"cp866\") \u0434\u043b\u044f ISE \\ [Console]::OutputEncoding = [System.Text.Encoding]::GetEncoding(\"windows-1251\") \u0434\u043b\u044f ps2exe \\ Get-Service | Out-File $home\\Desktop\\Service.txt -Encoding oem > \\ Get-Service | Out-File $home\\Desktop\\Service.txt -Append >> do { if ([Console]::KeyAvailable) { $keyInfo = [Console]::ReadKey($true) break } Write-Host \".\" -NoNewline sleep 1 } while ($true) Write-Host $keyInfo function Get-KeyPress { param ( [Parameter(Mandatory)][ConsoleKey]$Key, [System.ConsoleModifiers]$ModifierKey = 0 ) if ([Console]::KeyAvailable) { $pressedKey = [Console]::ReadKey($true) $isPressedKey = $key -eq $pressedKey.Key if ($isPressedKey) { $pressedKey.Modifiers -eq $ModifierKey } else { [Console]::Beep(1800, 200) $false }}} Write-Warning 'Press Ctrl+Shift+Q to exit' do { Write-Host \".\" -NoNewline $pressed = Get-KeyPress -Key Q -ModifierKey 'Control,Shift' if ($pressed) {break} sleep 1 } while ($true)","title":"Console API"},{"location":"#drawing","text":"API Add-Type -AssemblyName System.Drawing $Width = 800 $Height = 400 $image = New-Object System.Drawing.Bitmap($Width,$Height) $graphic = [System.Drawing.Graphics]::FromImage($image) $background_color = [System.Drawing.Brushes]::Blue # \u0437\u0430\u0434\u0430\u0442\u044c \u0446\u0432\u0435\u0442 \u0444\u043e\u043d\u0430 (\u0441\u0438\u043d\u0438\u0439) $graphic.FillRectangle($background_color, 0, 0, $image.Width, $image.Height) $text_color = [System.Drawing.Brushes]::White # \u0437\u0430\u0434\u0430\u0442\u044c \u0446\u0432\u0435\u0442 \u0442\u0435\u043a\u0441\u0442\u0430 (\u0431\u0435\u043b\u044b\u0439) $font = New-Object System.Drawing.Font(\"Arial\", 20, [System.Drawing.FontStyle]::Bold) # \u0437\u0430\u0434\u0430\u0442\u044c \u0448\u0440\u0438\u0444\u0442 $text = \"PowerShell\" # \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u0442\u0435\u043a\u0441\u0442 $text_position = New-Object System.Drawing.RectangleF(320, 180, 300, 100) # \u0437\u0430\u0434\u0430\u0442\u044c \u043f\u043e\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u0442\u0435\u043a\u0441\u0442\u0430 (x, y, width, height) $graphic.DrawString($text, $font, $text_color, $text_position) # \u043d\u0430\u043d\u0435\u0441\u0442\u0438 \u0442\u0435\u043a\u0441\u0442 \u043d\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 $image.Save(\"$home\\desktop\\powershell_image.bmp\", [System.Drawing.Imaging.ImageFormat]::Bmp) # \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 $image.Dispose() # \u043e\u0441\u0432\u043e\u0431\u043e\u0436\u0434\u0435\u043d\u0438\u0435 \u0440\u0435\u0441\u0443\u0440\u0441\u043e\u0432 $path = \"$home\\desktop\\powershell_image.bmp\" \\ Invoke-Item $path $src_image = [System.Drawing.Image]::FromFile($path) $Width = 400 $Height = 200 $dst_image = New-Object System.Drawing.Bitmap -ArgumentList $src_image, $Width, $Height # \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0440\u0430\u0437\u043c\u0435\u0440 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f $dst_image.Save(\"$home\\desktop\\powershell_image_resize.bmp\", [System.Drawing.Imaging.ImageFormat]::Bmp) $rotated_image = $src_image.Clone() # \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043a\u043e\u043f\u0438\u044e \u0438\u0441\u0445\u043e\u0434\u043d\u043e\u0433\u043e \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f $rotated_image.RotateFlip([System.Drawing.RotateFlipType]::Rotate180FlipNone) # \u043f\u0435\u0440\u0435\u0432\u0435\u0440\u043d\u0443\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u043d\u0430 180 \u0433\u0440\u0430\u0434\u0443\u0441\u043e\u0432 $rotated_image.Save(\"$home\\desktop\\powershell_image_rotated.bmp\", [System.Drawing.Imaging.ImageFormat]::Bmp) $src_image.Dispose() # \u0437\u0430\u043a\u0440\u044b\u0442\u044c (\u043e\u0442\u043f\u0443\u0441\u0442\u0438\u0442\u044c) \u0438\u0441\u0445\u043e\u0434\u043d\u044b\u0439 \u0444\u0430\u0439\u043b","title":"Drawing"},{"location":"#objectevent","text":"$Timer = New-Object System.Timers.Timer $Timer.Interval = 1000 Register-ObjectEvent -InputObject $Timer -EventName Elapsed -SourceIdentifier Timer.Output -Action { $Random = Get-Random -Min 0 -Max 100 Write-Host $Random } $Timer.Enabled = $True $Timer.Enabled = $False \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \\ $Timer | Get-Member -MemberType Event \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u0441\u043e\u0431\u044b\u0442\u0438\u0439 \u043e\u0431\u044a\u0435\u043a\u0442\u0430 \\ Get-EventSubscriber \u0441\u043f\u0438\u0441\u043e\u043a \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0445 \u043f\u043e\u0434\u043f\u0438\u0441\u043e\u043a \u043d\u0430 \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u0432 \u0442\u0435\u043a\u0443\u0449\u0435\u0439 \u0441\u0435\u0441\u0441\u0438\u0438 \\ Unregister-Event -SourceIdentifier Timer.Output \u0443\u0434\u0430\u043b\u044f\u0435\u0442 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044e \u043f\u043e\u0434\u043f\u0438\u0441\u043a\u0438 \u043d\u0430 \u0441\u043e\u0431\u044b\u0442\u0438\u0435 \u043f\u043e \u0438\u043c\u0435\u043d\u0438 \u0441\u043e\u0431\u044b\u0442\u0438\u044f (EventName) \u0438\u043b\u0438 \u0432\u0441\u0435 * \\ -Forward \u043f\u0435\u0440\u0435\u043d\u0430\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u0438\u0437 \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u043e\u0433\u043e \u0441\u0435\u0430\u043d\u0441\u0430 (New-PSSession) \u0432 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u0439 \u0441\u0435\u0430\u043d\u0441 \\ -SupportEvent \u043d\u0435 \u0432\u044b\u0432\u043e\u0434\u0438\u0442 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u043d\u0430 \u044d\u043a\u0440\u0430\u043d (\u0438 Get-EventSubscriber \u0438 Get-Job) Register-EngineEvent -SourceIdentifier PowerShell.Exiting -Action { $date = Get-Date -f hh:mm:ss (New-Object -ComObject Wscript.Shell).Popup(\"PowerShell Exit: $date\",0,\"Action\",64) }","title":"ObjectEvent"},{"location":"#sockets","text":"","title":"Sockets"},{"location":"#udp-socket","text":"Source function Start-UDPServer { param( $Port = 5201 ) $RemoteComputer = New-Object System.Net.IPEndPoint([System.Net.IPAddress]::Any, 0) do { $UdpObject = New-Object System.Net.Sockets.UdpClient($Port) $ReceiveBytes = $UdpObject.Receive([ref]$RemoteComputer) $UdpObject.Close() $ASCIIEncoding = New-Object System.Text.ASCIIEncoding [string]$ReturnString = $ASCIIEncoding.GetString($ReceiveBytes) [PSCustomObject]@{ LocalDateTime = $(Get-Date -UFormat \"%Y-%m-%d %T\") ClientIP = $RemoteComputer.address.ToString() ClientPort = $RemoteComputer.Port.ToString() Message = $ReturnString } } while (1) } Start-UDPServer -Port 5201","title":"UDP Socket"},{"location":"#test-netudpconnection","text":"function Test-NetUDPConnection { param( [string]$ComputerName = \"127.0.0.1\", [int32]$PortServer = 5201, [int32]$PortClient = 5211, $Message ) begin { $UdpObject = New-Object system.Net.Sockets.Udpclient($PortClient) $UdpObject.Connect($ComputerName, $PortServer) } process { $ASCIIEncoding = New-Object System.Text.ASCIIEncoding if (!$Message) {$Message = Get-Date -UFormat \"%Y-%m-%d %T\"} $Bytes = $ASCIIEncoding.GetBytes($Message) [void]$UdpObject.Send($Bytes, $Bytes.length) } end { $UdpObject.Close() } } Test-NetUDPConnection -ComputerName 127.0.0.1 -PortServer 5201 \\ Test-NetUDPConnection -ComputerName 127.0.0.1 -PortServer 514 -Message \"<30>May 31 00:00:00 HostName multipathd[784]: Test message\"","title":"Test-NetUDPConnection"},{"location":"#tcp-socket","text":"function Start-TCPServer { param( $Port = 5201 ) do { $TcpObject = New-Object System.Net.Sockets.TcpListener($port) $ReceiveBytes = $TcpObject.Start() $ReceiveBytes = $TcpObject.AcceptTcpClient() $TcpObject.Stop() $ReceiveBytes.Client.RemoteEndPoint | select Address,Port } while (1) } Start-TCPServer -Port 5201 \\ Test-NetConnection -ComputerName 127.0.0.1 -Port 5201","title":"TCP Socket"},{"location":"#wakeonlan","text":"Broadcast package consisting of 6 byte filled \"0xFF\" and then 96 byte where the mac address is repeated 16 times function Send-WOL { param ( [Parameter(Mandatory = $True)]$Mac, $IP, [int]$Port = 9 ) $Mac = $Mac.replace(\":\", \"-\") if (!$IP) {$IP = [System.Net.IPAddress]::Broadcast} $SynchronizationChain = [byte[]](,0xFF * 6) $ByteMac = $Mac.Split(\"-\") | %{[byte](\"0x\" + $_)} $Package = $SynchronizationChain + ($ByteMac * 16) $UdpClient = New-Object System.Net.Sockets.UdpClient $UdpClient.Connect($IP, $port) $UdpClient.Send($Package, $Package.Length) $UdpClient.Close() } Send-WOL -Mac \"D8-BB-C1-70-A3-4E\" \\ Send-WOL -Mac \"D8-BB-C1-70-A3-4E\" -IP 192.168.3.100","title":"WakeOnLan"},{"location":"#encoding","text":"$ByteText = [System.Text.Encoding]::UTF8.GetBytes(\"password\") \\ $Text = [System.Text.Encoding]::UTF8.GetString($ByteText)","title":"Encoding"},{"location":"#base64","text":"$text = \"password\" \\ $byte = [System.Text.Encoding]::Unicode.GetBytes($text) \\ $base64 = [System.Convert]::ToBase64String($byte) \\ $decode_base64 = [System.Convert]::FromBase64String($base64) \\ $decode_string = [System.Text.Encoding]::Unicode.GetString($decode_base64) $path_image = \"$home\\Documents\\1200x800.jpg\" \\ $BBase64 = [System.Convert]::ToBase64String((Get-Content $path_image -Encoding Byte)) \\ Add-Type -assembly System.Drawing \\ $Image = [System.Drawing.Bitmap]::FromStream([IO.MemoryStream][Convert]::FromBase64String($BBase64)) \\ $Image.Save(\"$home\\Desktop\\1200x800.jpg\")","title":"Base64"},{"location":"#http-listener","text":"$httpListener = New-Object System.Net.HttpListener $httpListener.Prefixes.Add(\"http://+:8888/\") $httpListener.Start() while (!([console]::KeyAvailable)) { $info = Get-Service | select name,status | ConvertTo-HTML $context = $httpListener.GetContext() $context.Response.StatusCode = 200 $context.Response.ContentType = 'text/HTML' $WebContent = $info $EncodingWebContent = [Text.Encoding]::UTF8.GetBytes($WebContent) $context.Response.OutputStream.Write($EncodingWebContent , 0, $EncodingWebContent.Length) $context.Response.Close() Get-NetTcpConnection -LocalPort 8888 (Get-Date).datetime } $httpListener.Close()","title":"HTTP Listener"},{"location":"#webclient","text":"[System.Net.WebClient] | Get-Member \\ (New-Object Net.WebClient).DownloadString(\"https://raw.githubusercontent.com/Lifailon/PowerShell-Commands/rsa/README.md\")","title":"WebClient"},{"location":"#certificate","text":"function Get-WebCertificate ($srv) { $iwr = iwr $srv $status_code = $iwr.StatusCode $status = $iwr.BaseResponse.StatusCode $info = $iwr.BaseResponse.Server $spm = [System.Net.ServicePointManager]::FindServicePoint($srv) $date_end = $spm.Certificate.GetExpirationDateString() $cert_name = ($spm.Certificate.Subject) -replace \"CN=\" $cert_owner = ((($spm.Certificate.Issuer) -split \", \") | where {$_ -match \"O=\"}) -replace \"O=\" $Collections = New-Object System.Collections.Generic.List[System.Object] $Collections.Add([PSCustomObject]@{ Host = $srv; Server = $info; Status = $status; StatusCode = $status_code; Certificate = $cert_name; Issued = $cert_owner; End = $date_end }) $Collections } Get-WebCertificate https://google.com","title":"Certificate"},{"location":"#excel","text":"$path = \"$home\\Desktop\\Services-to-Excel.xlsx\" $Excel = New-Object -ComObject Excel.Application $Excel.Visible = $false` \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043e\u0442\u043a\u0440\u044b\u0442\u0438\u0435 GUI $ExcelWorkBook = $Excel.Workbooks.Add()` \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043a\u043d\u0438\u0433\u0443 $ExcelWorkSheet = $ExcelWorkBook.Worksheets.Item(1)` \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043b\u0438\u0441\u0442 $ExcelWorkSheet.Name = \"Services\"` \u0437\u0430\u0434\u0430\u0442\u044c \u0438\u043c\u044f \u043b\u0438\u0441\u0442\u0430 $ExcelWorkSheet.Cells.Item(1,1) = \"Name service\" # \u0417\u0430\u0434\u0430\u0442\u044c \u0438\u043c\u0435\u043d\u0430 \u0441\u0442\u043e\u043b\u0431\u0446\u043e\u0432: $ExcelWorkSheet.Cells.Item(1,2) = \"Description\" $ExcelWorkSheet.Cells.Item(1,3) = \"Status\" $ExcelWorkSheet.Cells.Item(1,4) = \"Startup type\" $ExcelWorkSheet.Rows.Item(1).Font.Bold = $true` \u0432\u044b\u0434\u0435\u043b\u0438\u0442\u044c \u0436\u0438\u0440\u043d\u044b\u043c \u0448\u0440\u0438\u0444\u0442\u043e\u043c $ExcelWorkSheet.Rows.Item(1).Font.size=14 # \u0417\u0430\u0434\u0430\u0442\u044c \u0448\u0438\u0440\u0438\u043d\u0443 \u043a\u043e\u043b\u043e\u043d\u043e\u043a: $ExcelWorkSheet.Columns.Item(1).ColumnWidth=30 $ExcelWorkSheet.Columns.Item(2).ColumnWidth=80 $ExcelWorkSheet.Columns.Item(3).ColumnWidth=15 $ExcelWorkSheet.Columns.Item(4).ColumnWidth=25 $services = Get-Service $counter = 2` \u0437\u0430\u0434\u0430\u0442\u044c \u043d\u0430\u0447\u0430\u043b\u044c\u043d\u044b\u0439 \u043d\u043e\u043c\u0435\u0440 \u0441\u0442\u0440\u043e\u043a\u0438 \u0434\u043b\u044f \u0437\u0430\u043f\u0438\u0441\u0438 foreach ($service in $services) { $status = $service.Status if ($status -eq 1) { $status_type = \"Stopped\" } elseif ($status -eq 4) { $status_type = \"Running\" } $Start = $service.StartType if ($Start -eq 1) { $start_type = \"Delayed start\" } elseif ($Start -eq 2) { $start_type = \"Automatic\" } elseif ($Start -eq 3) { $start_type = \"Manually\" } elseif ($Start -eq 4) { $start_type = \"Disabled\" } $ExcelWorkSheet.Columns.Item(1).Rows.Item($counter) = $service.Name $ExcelWorkSheet.Columns.Item(2).Rows.Item($counter) = $service.DisplayName $ExcelWorkSheet.Columns.Item(3).Rows.Item($counter) = $status_type $ExcelWorkSheet.Columns.Item(4).Rows.Item($counter) = $start_type if ($status_type -eq \"Running\") { $ExcelWorkSheet.Columns.Item(3).Rows.Item($counter).Font.Bold = $true } $counter++` +1 \u0443\u0432\u0435\u043b\u0438\u0447\u0438\u0442\u044c \u0434\u043b\u044f \u0441\u0447\u0435\u0442\u0447\u0438\u043a\u0430 \u0441\u0442\u0440\u043e\u043a\u0438 Rows } $ExcelWorkBook.SaveAs($path) $ExcelWorkBook.close($true) $Excel.Quit()","title":"Excel"},{"location":"#excelapplicationopen","text":"$path = \"$home\\Desktop\\Services-to-Excel.xlsx\" $Excel = New-Object -ComObject Excel.Application $Excel.Visible = $false $ExcelWorkBook = $excel.Workbooks.Open($path)` \u043e\u0442\u043a\u0440\u044b\u0442\u044c xlsx-\u0444\u0430\u0439\u043b $ExcelWorkBook.Sheets | select Name,Index` \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043b\u0438\u0441\u0442\u044b $ExcelWorkSheet = $ExcelWorkBook.Sheets.Item(1)` \u043e\u0442\u043a\u0440\u044b\u0442\u044c \u043b\u0438\u0441\u0442 \u043f\u043e \u043d\u043e\u043c\u0435\u0440\u0443 Index 1..100 | %{$ExcelWorkSheet.Range(\"A$_\").Text}` \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0438\u0437 \u0441\u0442\u043e\u043b\u0431\u0446\u0430 \u0410 \u0441\u0442\u0440\u043e\u043a\u0438 c 1 \u043f\u043e 100 $Excel.Quit()","title":"Excel.Application.Open"},{"location":"#importexcel","text":"Install-Module -Name ImportExcel \\ $data | Export-Excel .\\Data.xlsx \\ $data = Import-Excel .\\Data.xlsx $data = ps \\ $Chart = New-ExcelChartDefinition -XRange CPU -YRange WS -Title \"Process\" -NoLegend \\ $data | Export-Excel .\\ps.xlsx -AutoNameRange -ExcelChartDefinition $Chart -Show","title":"ImportExcel"},{"location":"#csv","text":"Get-Service | Select Name,DisplayName,Status,StartType | Export-Csv -path \"$home\\Desktop\\Get-Service.csv\" -Append -Encoding Default \u044d\u043a\u0441\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 csv (-Encoding UTF8) \\ Import-Csv \"$home\\Desktop\\Get-Service.csv\" -Delimiter \",\" \u0438\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043c\u0430\u0441\u0441\u0438\u0432 $data = ConvertFrom-Csv @\" Region,State,Units,Price West,Texas,927,923.71 $null,Tennessee,466,770.67 \"@ $systeminfo = systeminfo /FO csv | ConvertFrom-Csv \u0432\u044b\u0432\u043e\u0434 \u0440\u0430\u0431\u043e\u0442\u044b \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u044b \u0432 CSV \u0438 \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0438\u044f \u0432 \u043e\u0431\u044a\u0435\u043a\u0442 \\ $systeminfo.\"\u041f\u043e\u043b\u043d\u044b\u0439 \u043e\u0431\u044a\u0435\u043c \u0444\u0438\u0437\u0438\u0447\u0435\u0441\u043a\u043e\u0439 \u043f\u0430\u043c\u044f\u0442\u0438\" \\ $systeminfo.\"\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u0430\u044f \u0444\u0438\u0437\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u043f\u0430\u043c\u044f\u0442\u044c\"","title":"CSV"},{"location":"#convertfrom-string","text":"' log = { level = 4; }; ' | ConvertFrom-String` \u0441\u043e\u0437\u0434\u0430\u0435\u0442 PSCustomObject (\u0440\u0430\u0437\u0431\u0438\u0432\u0430\u0435\u0442 \u043f\u043e \u043f\u0440\u043e\u0431\u0435\u043b\u0430\u043c, \u0443\u0434\u0430\u043b\u044f\u0435\u0442 \u0432\u0441\u0435 \u043f\u0440\u043e\u0431\u0435\u043b\u044b \u0438 \u043f\u0443\u0441\u0442\u044b\u0435 \u0441\u0442\u0440\u043e\u043a\u0438)","title":"ConvertFrom-String"},{"location":"#convertfrom-stringdata","text":"\" key1 = value1 key2 = value2 \" | ConvertFrom-StringData # \u0441\u043e\u0437\u0434\u0430\u0435\u0442 Hashtable","title":"ConvertFrom-StringData"},{"location":"#xml","text":"$xml = [xml](Get-Content $home\\desktop\\test.rdg)` \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u0442\u044c \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 XML-\u0444\u0430\u0439\u043b\u0430 $xml.load(\"$home\\desktop\\test.rdg\")` \u043e\u0442\u043a\u0440\u044b\u0442\u044c \u0444\u0430\u0439\u043b $xml.RDCMan.file.group.properties.name` \u0438\u043c\u0435\u043d\u0430 \u0433\u0440\u0443\u043f\u043f $xml.RDCMan.file.group.server.properties` \u0438\u043c\u0435\u043d\u0430 \u0432\u0441\u0435\u0445 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u0432 $xml.RDCMan.file.group[3].server.properties` \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u0432 \u0432 4-\u0439 \u0433\u0440\u0443\u043f\u043f\u0435 ($xml.RDCMan.file.group[3].server.properties | ? name -like ADIRK).Name = \"New-Name\"` \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 $xml.RDCMan.file.group[3].server[0].properties.displayName = \"New-displayName\" $xml.RDCMan.file.group[3].server[1].RemoveAll()` \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043e\u0431\u044a\u0435\u043a\u0442 (2-\u0439 \u0441\u0435\u0440\u0432\u0435\u0440 \u0432 \u0441\u043f\u0438\u0441\u043a\u0435) $xml.Save($file)` \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u0430 \u0432 \u0444\u0430\u0439\u043b\u0430 Get-Service | Export-Clixml -path $home\\desktop\\test.xml \u044d\u043a\u0441\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043e\u0431\u044a\u0435\u043a\u0442 PowerShell \u0432 XML \\ Import-Clixml -Path $home\\desktop\\test.xml \u0438\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043e\u0431\u044a\u0435\u043a\u0442 XML \u0432 PowerShell \\ ConvertTo-Xml (Get-Service)","title":"XML"},{"location":"#get-credtoxml","text":"function Get-CredToXML { param ( $CredFile = \"$home\\Documents\\cred.xml\" ) if (Test-Path $CredFile) { Import-Clixml -path $CredFile } elseif (!(Test-Path $CredFile)) { $Cred = Get-Credential -Message \"Enter credential\" if ($Cred -ne $null) { $Cred | Export-CliXml -Path $CredFile $Cred } else { return } } } $Cred = Get-CredToXML \\ $Login = $Cred.UserName \\ $PasswordText = $Cred.GetNetworkCredential().password \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \u0432 \u0442\u0435\u043a\u0441\u0442\u043e\u0432\u043e\u043c \u0432\u0438\u0434\u0435","title":"Get-CredToXML"},{"location":"#xmlwriter-extensible-markup-language","text":"$XmlWriterSettings = New-Object System.Xml.XmlWriterSettings $XmlWriterSettings.Indent = $true` \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043e\u0442\u0441\u0442\u0443\u043f\u044b $XmlWriterSettings.IndentChars = \" \"` \u0437\u0430\u0434\u0430\u0442\u044c \u043e\u0442\u0441\u0442\u0443\u043f $XmlFilePath = \"$home\\desktop\\test.xml\" $XmlObjectWriter = [System.XML.XmlWriter]::Create($XmlFilePath, $XmlWriterSettings)` \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442 $XmlObjectWriter.WriteStartDocument()` \u043d\u0430\u0447\u0430\u0442\u044c \u0437\u0430\u043f\u0438\u0441\u044c \u0432 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442 $XmlObjectWriter.WriteComment(\"Comment\") $XmlObjectWriter.WriteStartElement(\"Root\")` \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0441\u0442\u0430\u0440\u0442\u043e\u0432\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0434\u043e\u0447\u0435\u0440\u043d\u0438\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b $XmlObjectWriter.WriteStartElement(\"Configuration\")` \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u0435\u0440\u0432\u044b\u0439 \u0434\u043e\u0447\u0435\u0440\u043d\u0438\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 \u0434\u043b\u044f BaseSettings $XmlObjectWriter.WriteElementString(\"Language\",\"RU\") $XmlObjectWriter.WriteStartElement(\"Fonts\") # <Fonts> $XmlObjectWriter.WriteElementString(\"Name\",\"Arial\") $XmlObjectWriter.WriteElementString(\"Size\",\"12\") $XmlObjectWriter.WriteEndElement() # </Fonts> $XmlObjectWriter.WriteEndElement()` \u043a\u043e\u043d\u0435\u0447\u043d\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 </Configuration> $XmlObjectWriter.WriteEndElement()` \u043a\u043e\u043d\u0435\u0447\u043d\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 </Root> $XmlObjectWriter.WriteEndDocument()` \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u0437\u0430\u043f\u0438\u0441\u044c \u0432 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442 $XmlObjectWriter.Flush() $XmlObjectWriter.Close()","title":"XmlWriter (Extensible Markup Language)"},{"location":"#createelement","text":"$xml = [xml](gc $home\\desktop\\test.xml) $xml.Root.Configuration.Fonts $NewElement = $xml.CreateElement(\"Fonts\")` \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u044d\u043b\u0435\u043c\u0435\u043d\u0442 \u043a\u0443\u0434\u0430 \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c $NewElement.set_InnerXML(\"<Name>Times New Roman</Name><Size>14</Size>\")` \u0417\u0430\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f\u043c\u0438 \u0434\u043e\u0447\u0435\u0440\u043d\u0438\u0435 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u044b Fonts $xml.Root.Configuration.AppendChild($NewElement)` \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u044d\u043b\u0435\u043c\u0435\u043d\u0442 \u043d\u043e\u0432\u043e\u0439 \u0441\u0442\u0440\u043e\u043a\u043e\u0439 \u0432 Configuration (\u0440\u043e\u0434\u0438\u0442\u0435\u043b\u044c Fonts) $xml.Save(\"$home\\desktop\\test.xml\")","title":"CreateElement"},{"location":"#json","text":"$log = ' { \"log\": { \"level\": 7 } } ' | ConvertFrom-Json Get-Service | ConvertTo-Json $OOKLA = ' { \"result\" : {\"date\":1683534970,\"id\":\"14708271987\",\"connection_icon\":\"wireless\",\"download\":33418,\"upload\":35442,\"latency\":15,\"distance\":50,\"country_code\":\"RU\",\"server_id\":2707,\"server_name\":\"Bryansk\",\"sponsor_name\":\"DOM.RU\",\"sponsor_url\":null,\"connection_mode\":\"multi\",\"isp_name\":\"Resource Link\",\"isp_rating\":\"4.0\",\"test_rank\":63,\"test_grade\":\"B-\",\"test_rating\":4,\"idle_latency\":\"17\",\"download_latency\":\"116\",\"upload_latency\":\"75\",\"additional_servers\": [{\"server_id\":8191,\"server_name\":\"Bryansk\",\"sponsor_name\":\"SectorTelecom.ru\"},{\"server_id\":46278,\"server_name\":\"Fokino\",\"sponsor_name\":\"Fokks - Promyshlennaya avtomatika Ltd.\"},{\"server_id\":18218,\"server_name\":\"Bryansk\",\"sponsor_name\":\"RIA-link Ltd.\"}], \"path\":\"result\\u002F14708271987\",\"hasSecondary\":true } } ' | ConvertFrom-Json $ookla.result","title":"JSON"},{"location":"#yaml","text":"Import-Module PSYaml` \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0432 Docker/Ansible $netplan = \" network:` \u0441\u043b\u043e\u0432\u0430\u0440\u044c \u043f\u043e \u0442\u0438\u043f\u0443 - \u043a\u043b\u044e\u0447 : \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0441 \u0432\u043b\u043e\u0436\u0435\u043d\u043d\u044b\u043c\u0438 \u0441\u043b\u043e\u0432\u0430\u0440\u044f\u043c\u0438 ethernets: ens160: dhcp4: yes dhcp6: no nameservers: addresses:` [8.8.8.8, 1.1.1.1]` \u0441\u043f\u0438\u0441\u043e\u043a \u0434\u0430\u043d\u043d\u044b\u0445 (\u0441\u0442\u0440\u043e\u043a) - 8.8.8.8 - 1.1.1.1 version: 2 \" $network = ConvertFrom-Yaml $netplan $network.Values.ethernets.ens160.nameservers $DataType = \" int: !!int 10.1 flo: !!float 10.1 str: !!str string bool: !!bool` boolean \"","title":"YAML"},{"location":"#html","text":"","title":"HTML"},{"location":"#convertfrom-html","text":"function ConvertFrom-Html { param ( [Parameter(ValueFromPipeline)]$url ) $irm = Invoke-RestMethod $url $HTMLFile = New-Object -ComObject HTMLFile $Bytes = [System.Text.Encoding]::Unicode.GetBytes($irm) $HTMLFile.write($Bytes) ($HTMLFile.all | where {$_.tagname -eq \"body\"}).innerText } $apache_status = \"http://192.168.3.102/server-status\" $apache_status | ConvertFrom-Html","title":"ConvertFrom-Html"},{"location":"#convertto-html","text":"Get-Process | select Name, CPU | ConvertTo-Html -As Table > \"$home\\desktop\\proc-table.html\" \u0432\u044b\u0432\u043e\u0434 \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 List (Format-List) \u0438\u043b\u0438 Table (Format-Table) $servers = \"ya.ru\",\"ya.com\",\"google.com\" $path = \"$home\\Desktop\\Ping.html\" $header = @\" <!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\"> <html xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"en\" xml:lang=\"en\"> <head> <title>\u041e\u0442\u0447\u0435\u0442 \u043e \u0441\u0442\u0430\u0442\u0443\u0441\u0435 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u0432</title> <style type=\"text/css\"> <!-- body { background-color: #E0E0E0; font-family: sans-serif } table, th, td { background-color: white; border-collapse:collapse; border: 1px solid black; padding: 5px } --> </style> \"@ $body = @\" <h1>Ping status</h1> <p>$(get-date -Format \"dd.MM.yyyy hh:mm\").</p> \"@ $results = foreach ($server in $servers) { if (Test-Connection $server -Count 1 -ea 0 -Quiet) { $status = \"Up\" } else { $status = \"Down\" } [PSCustomObject]@{ Name = $server Status = $status } } $results | ConvertTo-Html -head $header -body $body | foreach { $_ -replace \"<td>Down</td>\",\"<td style='background-color:#FF8080'>Down</td>\" -replace \"<td>Up</td>\",\"<td style='background-color:#5BCCF3'>Up</td>\" } | Out-File $path Invoke-Item $path","title":"ConvertTo-Html"},{"location":"#pswritehtml","text":"Import-Module PSWriteHTML (Get-Module PSWriteHTML).ExportedCommands Get-Service | Out-GridHtml -FilePath ~\\Desktop\\Get-Service-Out-GridHtml.html","title":"PSWriteHTML"},{"location":"#htmlreport","text":"Import-Module HtmlReport $topVM = ps | Sort PrivateMemorySize -Descending | Select -First 10 | %{,@(($_.ProcessName + \" \" + $_.Id), $_.PrivateMemorySize)} $topCPU = ps | Sort CPU -Descending | Select -First 10 | %{,@(($_.ProcessName + \" \" + $_.Id), $_.CPU)} New-Report -Title \"Piggy Processes\" -Input { New-Chart Bar \"Top VM Users\" -input $topVm New-Chart Column \"Top CPU Overall\" -input $topCPU ps | Select ProcessName, Id, CPU, WorkingSet, *MemorySize | New-Table \"All Processes\" } > ~\\Desktop\\Get-Process-HtmlReport.html","title":"HtmlReport"},{"location":"#htmlagilitypack","text":"Source # \u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0438 C#, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u043f\u0430\u0440\u0441\u0438\u0442\u044c HTML-\u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u044b, \u0432\u044b\u0431\u0438\u0440\u0430\u0442\u044c \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u044b DOM \u0438 \u0438\u0437\u0432\u043b\u0435\u043a\u0430\u0442\u044c \u0438\u0437 \u043d\u0438\u0445 \u0434\u0430\u043d\u043d\u044b\u0435 Add-Type -Path \"C:\\Users\\Lifailon\\Downloads\\HtmlAgilityPack\\Net40\\HtmlAgilityPack.dll\" $title = \"\u043d\u043e\u0432\u043e\u0431\u0440\u0430\u043d\u0435\u0446\" $url = \"http://fasts-torrent.net\" $ep = \"engine/ajax/search_torrent.php?title=$title\" $html = Invoke-RestMethod \"$url/$ep\" # \u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u043d\u043e\u0432\u043e\u0433\u043e \u043e\u0431\u044a\u0435\u043a\u0442\u0430 HtmlDocument \u0438\u0437 HtmlAgilityPack, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0431\u0443\u0434\u0435\u0442 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u0434\u043b\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0438 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438 HTML-\u043a\u043e\u0434\u0430 $HtmlDocument = New-Object HtmlAgilityPack.HtmlDocument # \u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 HTML \u0432 \u0441\u043e\u0437\u0434\u0430\u043d\u043d\u044b\u0439 \u043e\u0431\u044a\u0435\u043a\u0442 HtmlDocument $HtmlDocument.LoadHtml($html) $torrents = @() # \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 XPath \u0434\u043b\u044f \u0432\u044b\u0431\u043e\u0440\u0430 \u0432\u0441\u0435\u0445 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432 <tr> (\u0441\u0442\u0440\u043e\u043a \u0442\u0430\u0431\u043b\u0438\u0446\u044b) \u0432 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0435 $HtmlDocument.DocumentNode.SelectNodes(\"//tr\") | ForEach-Object { # \u0414\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0439 \u0441\u0442\u0440\u043e\u043a\u0438 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u0432\u044b\u0431\u0438\u0440\u0430\u0435\u043c \u043a\u043b\u0430\u0441\u0441\u044b, \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044e \u0440\u0430\u0437\u0434\u0430\u0447\u0438, \u0440\u0430\u0437\u043c\u0435\u0440\u0443 \u0438 \u0441\u0441\u044b\u043b\u043a\u0435 \u0434\u043b\u044f \u0441\u043a\u0430\u0447\u0438\u0432\u0430\u043d\u0438\u044f. $titleNode = $_.SelectSingleNode(\".//td[@class='torrent-title']\") $sizeNode = $_.SelectSingleNode(\".//td[@class='torrent-sp']\") $downloadLinkNode = $_.SelectSingleNode(\".//td[@class='torrent-d-btn']/a\") # \u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c, \u0447\u0442\u043e \u0432\u0441\u0435 \u043a\u043b\u0430\u0441\u0441\u044b \u043d\u0430\u0439\u0434\u0435\u043d\u044b if ($titleNode -ne $null -and $sizeNode -ne $null -and $downloadLinkNode -ne $null) { # \u0418\u0437\u0432\u043b\u0435\u0447\u0435\u043d\u0438\u0435 \u0442\u0435\u043a\u0441\u0442\u0430 \u0438\u0437 \u043a\u043b\u0430\u0441\u0441\u043e\u0432 $title = $titleNode.InnerText.Trim() $size = $sizeNode.InnerText.Trim() $downloadLink = $downloadLinkNode.Attributes[\"href\"].Value $torrent = New-Object PSObject -Property @{ Title = $title Size = $size DownloadLink = \"$($url)$($downloadLink)\" } $torrents += $torrent } } $torrents Title Size DownloadLink ----- ---- ------------ \u041d\u043e\u0432\u043e\u0431\u0440\u0430\u043d\u0435\u0446 (6 \u0441\u0435\u0437\u043e\u043d: 1-3 \u0441\u0435\u0440\u0438\u0438 \u0438\u0437 13) (2024) WEBRip | RuDub 1,55 \u0413\u0411 http://fasts-torrent.net/download/449613/torrent/-6-1-3-13-2024-webrip-rudub/ \u041d\u043e\u0432\u043e\u0431\u0440\u0430\u043d\u0435\u0446 (5 \u0441\u0435\u0437\u043e\u043d: 1-22 \u0441\u0435\u0440\u0438\u0438 \u0438\u0437 22) (2023) WEBRip 1080p | RuDub 54,15 \u0413\u0411 http://fasts-torrent.net/download/433749/torrent/-5-1-22-22-2023-webrip-1080p-rudub/ \u041d\u043e\u0432\u043e\u0431\u0440\u0430\u043d\u0435\u0446 (5 \u0441\u0435\u0437\u043e\u043d: 1-22 \u0441\u0435\u0440\u0438\u0438 \u0438\u0437 22) (2023) WEBRip 720p | RuDub 30,14 \u0413\u0411 http://fasts-torrent.net/download/433750/torrent/-5-1-22-22-2023-webrip-720p-rudub/ \u041d\u043e\u0432\u043e\u0431\u0440\u0430\u043d\u0435\u0446 (5 \u0441\u0435\u0437\u043e\u043d: 1-22 \u0441\u0435\u0440\u0438\u0438 \u0438\u0437 22) (2023) WEBRip | RuDub 11,55 \u0413\u0411 http://fasts-torrent.net/download/433751/torrent/-5-1-22-22-2023-webrip-rudub/ \u041d\u043e\u0432\u043e\u0431\u0440\u0430\u043d\u0435\u0446 (4 \u0441\u0435\u0437\u043e\u043d: 1-22 \u0441\u0435\u0440\u0438\u0438 \u0438\u0437 22) (2021) WEB-DL 720p | RG.Paravozik 21.33 Gb http://fasts-torrent.net/download/418618/torrent/-4-1-22-22-2021-web-dl-720p-rgparavozik/ \u041f\u043e\u043b\u0438\u0446\u0435\u0439\u0441\u043a\u0438\u0439 \u0441 \u043f\u043e\u043b\u043e\u0432\u0438\u043d\u043e\u0439: \u041d\u043e\u0432\u043e\u0431\u0440\u0430\u043d\u0435\u0446 (2017) WEB-DLRip 720p| \u0427\u0438\u0441\u0442\u044b\u0439 \u0437\u0432\u0443\u043a 3.41 Gb http://fasts-torrent.net/download/254846/torrent/-2017-web-dlrip-720p-/ \u041f\u043e\u043b\u0438\u0446\u0435\u0439\u0441\u043a\u0438\u0439 \u0441 \u043f\u043e\u043b\u043e\u0432\u0438\u043d\u043e\u0439: \u041d\u043e\u0432\u043e\u0431\u0440\u0430\u043d\u0435\u0446 (2017) WEB-DLRip | \u0427\u0438\u0441\u0442\u044b\u0439 \u0437\u0432\u0443\u043a 1.37 Gb http://fasts-torrent.net/download/254845/torrent/-2017-web-dlrip-/ \u041d\u043e\u0432\u043e\u0431\u0440\u0430\u043d\u0435\u0446 (2 \u0441\u0435\u0437\u043e\u043d: 1-20 \u0441\u0435\u0440\u0438\u0438 \u0438\u0437 20) (2019) WEBRip | BaibaKo 11.28 Gb http://fasts-torrent.net/download/364669/torrent/-2-1-20-20-2019-webrip-baibako/ \u041d\u043e\u0432\u043e\u0431\u0440\u0430\u043d\u0435\u0446 (2 \u0441\u0435\u0437\u043e\u043d: 1-20 \u0441\u0435\u0440\u0438\u0438 \u0438\u0437 20) (2019) WEBRip 1080p | Octopus 45.97 Gb http://fasts-torrent.net/download/364161/torrent/-2-1-20-20-2019-webrip-1080p-octopus/ \u041d\u043e\u0432\u043e\u0431\u0440\u0430\u043d\u0435\u0446 (2 \u0441\u0435\u0437\u043e\u043d: 1-20 \u0441\u0435\u0440\u0438\u0438 \u0438\u0437 20) (2019) WEB-DLRip | LostFilm 11.95 Gb http://fasts-torrent.net/download/364668/torrent/-2-1-20-20-2019-web-dlrip-lostfilm/","title":"HtmlAgilityPack"},{"location":"#sqlite","text":"$path = \"$home\\Documents\\Get-Service.db\" $Module = Get-Module MySQLite if ($Module -eq $null) { Install-Module MySQLite -Repository PSGallery -Scope CurrentUser } Import-Module MySQLite New-MySQLiteDB -Path $path # \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0411\u0414 Invoke-MySQLiteQuery -Path $path -Query \"CREATE TABLE Service (Name TEXT NOT NULL, DisplayName TEXT NOT NULL, Status TEXT NOT NULL);\" # \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0442\u0430\u0431\u043b\u0438\u0446\u0443 $Service = Get-Service | select Name,DisplayName,Status foreach ($S in $Service) { $Name = $S.Name $DName = $S.DisplayName $Status = $S.Status Invoke-MySQLiteQuery -Path $path -Query \"INSERT INTO Service (Name, DisplayName, Status) VALUES ('$Name', '$DName', '$Status');\" } (Get-MySQLiteDB $path).Tables \u0441\u043f\u0438\u0441\u043e\u043a \u0442\u0430\u0431\u043b\u0438\u0446 \u0432 \u0431\u0430\u0437\u0435 \\ Invoke-MySQLiteQuery -Path $path -Query \"SELECT name FROM sqlite_master WHERE type='table';\" \u0441\u043f\u0438\u0441\u043e\u043a \u0442\u0430\u0431\u043b\u0438\u0446 \u0432 \u0431\u0430\u0437\u0435 \\ Invoke-MySQLiteQuery -Path $path -Query \"DROP TABLE Service;\" \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0442\u0430\u0431\u043b\u0438\u0446\u0443 $TableName = \"Service\" Invoke-MySQLiteQuery -Path $path -Query \"SELECT * FROM $TableName\" # \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u0442\u044c \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b (\u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u0430) Get-Service | select Name,DisplayName,Status | ConvertTo-MySQLiteDB -Path $path -TableName Service -force \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043e\u0431\u044a\u0435\u043a\u0442 \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0443","title":"SQLite"},{"location":"#database-password","text":"$Connection = New-SQLiteConnection -DataSource $path $Connection.ChangePassword(\"password\") $Connection.Close() Invoke-SqliteQuery -Query \"SELECT * FROM Service\" -DataSource \"$path;Password=password\"","title":"Database password"},{"location":"#mysql","text":"apt -y install mysql-server mysql-client \\ mysql -V \\ systemctl status mysql \\ mysqladmin -u root password \u0437\u0430\u0434\u0430\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c root nano /etc/mysql/mysql.conf.d/mysqld.cnf [mysqld] user = mysql # pid-file = /var/run/mysqld/mysqld.pid # socket = /var/run/mysqld/mysqld.sock # port = 3306 # datadir = /var/lib/mysql # tmpdir = /tmp bind-address = 0.0.0.0 mysqlx-bind-address = 0.0.0.0 log_error = /var/log/mysql/error.log systemctl restart mysql \\ ss -tulnp | grep 3306 \\ ufw allow 3306/tcp \\ nc -zv 192.168.1.253 3306 \\ tnc 192.168.1.253 -p 3306 mysql -u root -p \\ SELECT user(), now(), version(); \\ quit; mysql -u root -p -e 'SHOW TABLES FROM db_aduser;' \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0442\u0430\u0431\u043b\u0438\u0446 \u0431\u0435\u0437 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u043a \u043a\u043e\u043d\u0441\u043e\u043b\u0438 MySQL CREATE \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0411\u0414, \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f, \u0442\u0430\u0431\u043b\u0438\u0446\u0443 \\ ALTER \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0441\u0442\u043e\u043b\u0431\u0446\u0430\u043c\u0438 \u0442\u0430\u0431\u043b\u0438\u0446\u0435 \\ DROP \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0411\u0414, \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f, \u0442\u0430\u0431\u043b\u0438\u0446\u0443 \\ USE \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0411\u0414 \\ SHOW \u0432\u044b\u0432\u0435\u0441\u043b\u0438 \u0441\u043f\u0438\u0441\u043e\u043a \u0411\u0414, \u043f\u0440\u0430\u0432 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f (GRANTS), \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044f \u0441\u0442\u043e\u043b\u0431\u0446\u043e\u0432 \u0438 \u0438\u0445 \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430 \\ GRANT \u0434\u0430\u0442\u044c \u0434\u043e\u0441\u0442\u0443\u043f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044e \u043a \u0411\u0414 \\ REVOKE \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0434\u043e\u0441\u0442\u0443\u043f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u043a \u0411\u0414 \\ UPDATE \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u0440\u0430\u0432\u0430 \u0434\u043e\u0441\u0442\u0443\u043f\u0430, \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0441 \u0442\u0430\u0431\u043b\u0438\u0446\u0435 \\ FLUSH \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u043f\u0440\u0430\u0432\u0430 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \\ SELECT \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u0443\u044e \u0411\u0414, \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439, \u0432\u044b\u0431\u043e\u0440\u043a\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0435 \\ INSERT \u0432\u043d\u0435\u0441\u0442\u0438 \u0434\u0430\u043d\u043d\u044b\u0435 \\ DELETE \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 (FROM) \u0442\u0430\u0431\u043b\u0438\u0446\u0435","title":"MySQL"},{"location":"#data-type","text":"VARCHAR(N) \u0441\u0442\u0440\u043e\u043a\u0430 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u043e\u0439 \u0434\u043b\u0438\u043d\u044b, \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 ASCII, \u0433\u0434\u0435 \u043e\u0434\u0438\u043d \u0441\u0438\u043c\u0432\u043e\u043b \u0437\u0430\u043d\u0438\u043c\u0430\u0435\u0442 1 \u0431\u0430\u0439\u0442, \u0447\u0438\u0441\u043b\u043e\u043c N \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u0430\u044f \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u0430\u044f \u0434\u043b\u0438\u043d\u0430 \u0441\u0442\u0440\u043e\u043a\u0438 \\ NVARCHAR(N) \u0441\u0442\u0440\u043e\u043a\u0430 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u043e\u0439 \u0434\u043b\u0438\u043d\u044b, \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 Unicode, \u0433\u0434\u0435 \u043e\u0434\u0438\u043d \u0441\u0438\u043c\u0432\u043e\u043b \u0437\u0430\u043d\u0438\u043c\u0430\u0435\u0442 2 \u0431\u0430\u0439\u0442\u0430 \\ CHAR(N)/nchar(N) \u0441\u0442\u0440\u043e\u043a\u0430 \u0444\u0438\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0439 \u0434\u043b\u0438\u043d\u044b, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u0432\u0441\u0435\u0433\u0434\u0430 \u0434\u043e\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \u0441\u043f\u0440\u0430\u0432\u0430 \u043f\u0440\u043e\u0431\u0435\u043b\u0430\u043c\u0438 \u0434\u043e \u0434\u043b\u0438\u043d\u044b N \u0438 \u0432 \u0431\u0430\u0437\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 \u043e\u043d\u0430 \u0437\u0430\u043d\u0438\u043c\u0430\u0435\u0442 \u0440\u043e\u0432\u043d\u043e N \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432 \\ INT \u0446\u0435\u043b\u043e\u0435 \u0447\u0438\u0441\u043b\u043e, \u043e\u0442 -2147483648 \u0434\u043e 2147483647, \u0437\u0430\u043d\u0438\u043c\u0430\u0435\u0442 4 \u0431\u0430\u0439\u0442\u0430 \\ FLOAT \u0447\u0438\u0441\u043b\u043e, \u0432 \u043a\u043e\u0442\u043e\u0440\u043e\u043c \u043c\u043e\u0436\u0435\u0442 \u043f\u0440\u0438\u0441\u0443\u0442\u0441\u0442\u0432\u043e\u0432\u0430\u0442\u044c \u0434\u0435\u0441\u044f\u0442\u0438\u0447\u043d\u0430\u044f \u0442\u043e\u0447\u043a\u0430 (\u0437\u0430\u043f\u044f\u0442\u0430\u044f) \\ BIT \u0444\u043b\u0430\u0433, \u0414\u0430 - 1 \u0438\u043b\u0438 \u041d\u0435\u0442 - 0 \\ DATE \u0444\u043e\u0440\u043c\u0430\u0442 \u0434\u0430\u0442\u044b, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 25.05.2023 \\ TIME 23:30:55.1234567 \\ DATETIME 25.05.2023 23:30:55.1234567","title":"DATA TYPE"},{"location":"#database_1","text":"SHOW databases; # \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u0441\u043f\u0438\u0441\u043e\u043a \u0411\u0414 CREATE DATABASE db_aduser; # \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0411\u0414 CREATE DATABASE db_rep DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci; # \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0411\u0414 \u0441 \u043a\u043e\u0434\u0438\u0440\u043e\u0432\u043a\u043e\u0439 UTF-8 DROP DATABASE db_rep; # \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0411\u0414 USE db_aduser; # \u0432\u044b\u0431\u0440\u0430\u0442\u044c/\u043f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f \u043d\u0430 \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u0443\u044e \u0411\u0414 SELECT database(); # \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u0443\u044e \u0411\u0414","title":"DATABASE"},{"location":"#user","text":"SELECT USER,HOST FROM mysql.user; # \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u0441\u043f\u0438\u0441\u043e\u043a \u0423\u0417 CREATE USER posh@localhost IDENTIFIED BY '1qaz!QAZ'; # \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0423\u0417, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u0431\u0443\u0434\u0435\u0442 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0430\u0442\u044c\u0441\u044f \u0441 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u043e\u0433\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u0430 CREATE USER posh@localhost IDENTIFIED BY '1qaz!QAZ'; # \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0423\u0417, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u0431\u0443\u0434\u0435\u0442 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0430\u0442\u044c\u0441\u044f \u0441 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0433\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u0430 CREATE USER posh@'192.168.3.99' IDENTIFIED BY '1qaz!QAZ'; # \u0423\u0417 \u0434\u043b\u044f \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u0441 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0433\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u0430 CREATE USER 'admin'@'%' IDENTIFIED BY 'Admin12#'; # \u0423\u0417 \u0434\u043b\u044f \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u0441 \u043b\u044e\u0431\u043e\u0433\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u0430 (% - wildcard) DROP USER posh@localhost; # \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f SHOW GRANTS FOR posh@'%'; # \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043f\u0440\u0430\u0432\u0430 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f GRANT ALL PRIVILEGES ON db_aduser.* TO posh@'192.168.3.99'; # \u043f\u043e\u043b\u043d\u044b\u0439 \u0434\u043e\u0441\u0442\u0443\u043f \u0434\u043b\u044f posh \u043a \u0411\u0414 db_aduser GRANT ALL PRIVILEGES ON *.* TO posh@'%'; # \u0434\u043e\u0441\u0442\u0443\u043f \u043a \u0432\u0441\u0435\u043c \u0411\u0414 c \u043b\u044e\u0431\u043e\u0433\u043e \u043a\u043b\u0438\u0435\u043d\u0442\u0441\u043a\u043e\u0433\u043e \u0445\u043e\u0441\u0442\u0430 GRANT SELECT,DELETE ON mysql.* TO posh@'%'; # \u043f\u0440\u0430\u0432\u0430 SELECT \u0438 DELETE \u043d\u0430 \u0432\u0441\u0442\u0440\u043e\u0435\u043d\u043d\u0443\u044e \u0411\u0414 mysql REVOKE DELETE ON mysql.* FROM posh@'%'; # \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0434\u043e\u0441\u0442\u0443\u043f DELETE UPDATE mysql.user SET super_priv='Y' WHERE USER='posh' AND host='%'; # \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u0440\u0438\u0432\u0435\u043b\u0435\u0433\u0438\u0438 \u0434\u043b\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f SELECT USER,HOST,super_priv FROM mysql.user; # \u0441\u043f\u0438\u0441\u043e\u043a \u0423\u0417 \u0438 \u0442\u0430\u0431\u043b\u0438\u0446\u0430 \u0441 \u043f\u0440\u0430\u0432\u0430\u043c\u0438 SUPER privilege FLUSH PRIVILEGES; # \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u043f\u0440\u0430\u0432\u0430 \u0434\u043e\u0441\u0442\u0443\u043f\u0430","title":"USER"},{"location":"#table","text":"SHOW TABLES; # \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u0442\u0430\u0431\u043b\u0438\u0446 SHOW TABLES LIKE '%user'; # \u043f\u043e\u0438\u0441\u043a \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u043f\u043e wildcard-\u0438\u043c\u0435\u043d\u0438 CREATE TABLE table_aduser (id INT NOT NULL AUTO_INCREMENT, Name VARCHAR(100), email VARCHAR(100), PRIMARY KEY (ID)); # \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0442\u0430\u0431\u043b\u0438\u0446\u0443 DROP TABLE table_aduser; # \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0442\u0430\u0431\u043b\u0438\u0446\u0443","title":"TABLE"},{"location":"#column","text":"SHOW COLUMNS FROM table_aduser; # \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0441\u0442\u043e\u0431\u0446\u043e\u0432 \u0438 \u0438\u0445 \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430 ALTER TABLE table_aduser DROP COLUMN id; # \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u0442\u043e\u043b\u0431\u0435\u0446 id ALTER TABLE table_aduser ADD COLUMN info VARCHAR(10); # \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0441\u0442\u043e\u043b\u0431\u0435\u0446 info ALTER TABLE table_aduser CHANGE info new_info VARCHAR(100); # \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0438\u043c\u044f \u0441\u0442\u043e\u043b\u0431\u0446\u0430 info \u043d\u0430 new_info \u0438 \u0435\u0433\u043e \u0442\u0438\u043f \u0434\u0430\u043d\u043d\u044b\u0445 ALTER TABLE table_aduser ADD COLUMN (id INT NOT NULL AUTO_INCREMENT, PRIMARY KEY (ID)); # \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0441\u0442\u043e\u043b\u0431\u0435\u0446 id","title":"COLUMN"},{"location":"#insert","text":"INSERT table_aduser (Name,email) VALUES ('Alex','no-email'); INSERT table_aduser (Name,email) VALUES ('Alex','no-email'); INSERT table_aduser (Name) VALUES ('Support'); INSERT table_aduser (Name) VALUES ('Jack');","title":"INSERT"},{"location":"#select","text":"SELECT * FROM table_aduser; # \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u0432\u0441\u0435\u0445 \u0441\u0442\u043e\u0431\u0446\u043e\u0432 \u0432 \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u043e\u0439 (FROM) \u0442\u0430\u0431\u043b\u0438\u0446\u0435 SELECT Name,email FROM table_aduser; # \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u0445 \u0441\u0442\u043e\u0431\u0446\u043e\u0432 SELECT DISTINCT Name,Email FROM table_aduser; # \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0435 \u0437\u0430\u043f\u0438\u0441\u0438 (\u0431\u0435\u0437 \u043f\u043e\u0432\u0442\u043e\u0440\u0435\u043d\u0438\u0439) SELECT * FROM table_aduser ORDER BY Name; # \u043e\u0442\u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u043e Name SELECT * FROM table_aduser ORDER BY Name DESC; # \u043e\u0431\u0440\u0430\u0442\u043d\u0430\u044f \u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0430 SELECT COUNT(*) FROM table_aduser; # \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0441\u0442\u0440\u043e\u043a \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0435 SELECT COUNT(new_info) FROM table_aduser; # \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0441\u0442\u0440\u043e\u043a \u0432 \u0441\u0442\u043e\u043b\u0431\u0446\u0435","title":"SELECT"},{"location":"#where","text":"NOT; AND; OR # \u043f\u043e \u043f\u0440\u0438\u043e\u0440\u0438\u0442\u0435\u0442\u0430\u043c \u0443\u0441\u043b\u043e\u0432\u0438\u0439 SELECT * FROM table_aduser WHERE Name = 'Alex'; # \u043f\u043e\u0438\u0441\u043a \u043f\u043e \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u043c\u0443 SELECT * FROM table_aduser WHERE NOT Name != 'Alex'; # \u0443\u0441\u043b\u043e\u0432\u0438\u0435 NOT \u0433\u0434\u0435 Name \u043d\u0435 \u0440\u0430\u0432\u0435\u043d \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044e SELECT * FROM table_aduser WHERE email != ''; # \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u0441\u0442\u0440\u043e\u043a\u0438, \u0433\u0434\u0435 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 email \u043d\u0435 \u0440\u0430\u043d\u043e null SELECT * FROM table_aduser WHERE email != '' OR id > 1000; # \u0438\u043b\u0438 id \u0432\u044b\u0448\u0435 1000 SELECT * FROM table_aduser WHERE Name RLIKE \"support\"; # \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u043e\u043d\u0435\u0437\u0430\u0432\u0438\u0441\u0435\u043c\u044b\u0439 (RLIKE) \u043f\u043e\u0438\u0441\u043a SELECT * FROM table_aduser WHERE Name RLIKE \"^support\"; # \u043d\u0430\u0447\u0438\u043d\u0430\u044e\u0442\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u0441 \u044d\u0442\u043e\u0433\u043e \u0441\u043b\u043e\u0432\u043e\u0441\u043e\u0447\u0435\u0442\u0430\u043d\u0438\u044f","title":"WHERE"},{"location":"#delete","text":"SELECT * FROM table_aduser WHERE Name RLIKE \"alex\"; # \u043d\u0430\u0439\u0442\u0438 \u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u043f\u0435\u0440\u0435\u0434 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u0435\u043c DELETE FROM table_aduser WHERE Name RLIKE \"alex\"; # Query OK, 2 rows affected # \u0443\u0434\u0430\u043b\u0435\u043d\u043e \u0434\u0432\u0435 \u0441\u0442\u0440\u043e\u043a\u0438 DELETE FROM table_aduser; # \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0412\u0421\u0415 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f","title":"DELETE"},{"location":"#update","text":"SELECT * FROM table_aduser WHERE Name = 'Jack'; # \u043d\u0430\u0439\u0442\u0438 \u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u0435\u0440\u0435\u0434 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435\u043c UPDATE table_aduser SET Name = 'Alex' WHERE Name = 'Jack'; # \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 'Jack' \u043d\u0430 'Alex' UPDATE db_aduser.table_aduser SET Name='BCA' WHERE id=1; # \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0432 \u0441\u0442\u0440\u043e\u043a\u0435 \u0441 ID 1","title":"UPDATE"},{"location":"#check","text":"CHECK TABLE db_aduser.table_aduser; # \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c ANALYZE TABLE db_aduser.table_aduser; # \u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c OPTIMIZE TABLE db_aduser.table_aduser; # \u043e\u043f\u0442\u0438\u043c\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c REPAIR TABLE db_aduser.table_aduser; # \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c TRUNCATE TABLE db_aduser.table_aduser; # \u043e\u0447\u0438\u0441\u0442\u0438\u0442\u044c","title":"CHECK"},{"location":"#dump","text":"mysqldump -u root -p --databases db_aduser > /bak/db_aduser.sql mysql -u root -p db_aduser < /bak/db_aduser.sql crontab -e 00 22 * * * /usr/bin/mysqldump -uroot -p1qaz!QAZ db_zabbix | /bin/bzip2 > `date +/dump/zabbix/zabbix-\\%d-\\%m-\\%Y-\\%H:\\%M.bz2` 00 23 * * * /usr/bin/mysqldump -uroot -p1qaz!QAZ db_zabbix > `date +/dump/smb/zabbix-\\%d-\\%m-\\%Y-\\%H:\\%M.sql` 0 0 * * * find /dump/zabbix -mtime +7 -exec rm {} \\; mysqldump -u root --single-transaction db_zabbix > /dump/zabbix/db_zabbix.sql mysql -u user_zabbix -p -e 'CREATE DATABASE db_zabbix;' mysql -u user_zabbix -p db_zabbix < /root/db_zabbix.sql","title":"DUMP"},{"location":"#innodb_force_recovery","text":"sed -i '/innodb_force_recovery/d' /etc/mysql/my.cnf # \u0443\u0434\u0430\u043b\u0438\u0442\u044c mode=6; sed -i \"/^\\[mysqld\\]/{N;s/$/\\ninnodb_force_recovery=$mode/}\" /etc/mysql/my.cnf # \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c mode 6 systemctl restart mysql [mysqld] innodb_force_recovery=1 # \u0441\u0435\u0440\u0432\u0435\u0440 \u043f\u044b\u0442\u0430\u0435\u0442\u0441\u044f \u043d\u0430\u0447\u0430\u0442\u044c \u0440\u0430\u0431\u043e\u0442\u0443 \u043d\u0435\u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e \u043e\u0442 \u0442\u043e\u0433\u043e, \u0435\u0441\u0442\u044c \u043b\u0438 \u043f\u043e\u0432\u0440\u0435\u0436\u0434\u0435\u043d\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 InnoDB \u0438\u043b\u0438 \u043d\u0435\u0442 innodb_force_recovery=2 # \u0443\u0434\u0430\u0435\u0442\u0441\u044f \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0440\u0430\u0431\u043e\u0442\u0443 \u0437\u0430 \u0441\u0447\u0435\u0442 \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \u043f\u043e\u0442\u043e\u043a\u0430 \u043a\u043e\u043c\u0430\u043d\u0434, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0431\u044b\u043b\u0438 \u0447\u0430\u0441\u0442\u0438\u0447\u043d\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u044b \u0438\u043b\u0438 \u043d\u0435 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u044b (\u043d\u0435 \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u0442 \u0444\u043e\u043d\u043e\u0432\u044b\u0435 \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0438) innodb_force_recovery=3 # \u043e\u0442\u043c\u0435\u043d\u044f\u0435\u0442 \u043e\u0442\u043a\u0430\u0442 \u043f\u043e\u0441\u043b\u0435 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u043f\u043e\u0432\u0440\u0435\u0436\u0434\u0435\u043d\u043d\u044b\u0445 \u0444\u0430\u0439\u043b\u043e\u0432 (\u043d\u0435 \u043f\u044b\u0442\u0430\u0435\u0442\u0441\u044f \u043e\u0442\u043a\u0430\u0442\u0438\u0442\u044c \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438) innodb_force_recovery=6 # \u0437\u0430\u043f\u0443\u0441\u043a \u0421\u0423\u0411\u0414 \u0432 \u0440\u0435\u0436\u0438\u043c\u0435 read only","title":"innodb_force_recovery"},{"location":"#mysql-connector-net","text":"","title":"MySQL Connector NET"},{"location":"#add-aduser","text":"$ip = \"192.168.1.253\" $user = \"posh\" $pass = \"1qaz!QAZ\" $db = \"db_aduser\" Add-Type \u2013Path \"$home\\Documents\\MySQL-Connector-NET\\8.0.31-4.8\\MySql.Data.dll\" $Connection = [MySql.Data.MySqlClient.MySqlConnection]@{ ConnectionString=\"server=$ip;uid=$user;pwd=$pass;database=$db\" } $Connection.Open() $Command = New-Object MySql.Data.MySqlClient.MySqlCommand $Command.Connection = $Connection $UserList = Get-ADUser -filter * -properties name,EmailAddress foreach ($user in $UserList) { $uname=$user.Name $uemail=$user.EmailAddress $Command.CommandText = \"INSERT INTO table_aduser (Name,Email) VALUES ('$uname','$uemail')\" $Command.ExecuteNonQuery() } $Connection.Close()","title":"Add-ADUser"},{"location":"#get-aduser","text":"$ip = \"192.168.1.253\" $user = \"posh\" $pass = \"1qaz!QAZ\" $db = \"db_aduser\" Add-Type \u2013Path \"$home\\Documents\\MySQL-Connector-NET\\8.0.31-4.8\\MySql.Data.dll\" $Connection = [MySql.Data.MySqlClient.MySqlConnection]@{ ConnectionString = \"server=$ip;uid=$user;pwd=$pass;database=$db\" } $Connection.Open() $Command = New-Object MySql.Data.MySqlClient.MySqlCommand $Command.Connection = $Connection $MYSQLDataAdapter = New-Object MySql.Data.MySqlClient.MySqlDataAdapter $MYSQLDataSet = New-Object System.Data.DataSet $Command.CommandText = \"SELECT * FROM table_aduser\" $MYSQLDataAdapter.SelectCommand = $Command $NumberOfDataSets = $MYSQLDataAdapter.Fill($MYSQLDataSet, \"data\") $Collections = New-Object System.Collections.Generic.List[System.Object] foreach($DataSet in $MYSQLDataSet.tables[0]) { $Collections.Add([PSCustomObject]@{ Name = $DataSet.name; Mail = $DataSet.email }) } $Connection.Close() $Collections","title":"Get-ADUser"},{"location":"#mssql","text":"wget -qO- https://packages.microsoft.com/keys/microsoft.asc | apt-key add - \u0438\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c GPG-\u043a\u043b\u044e\u0447 \u0434\u043b\u044f \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u044f \\ https://packages.microsoft.com/config/ubuntu/ \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u0439 \u0438 \u0441\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c URL \\ add-apt-repository \"$(wget -qO- https://packages.microsoft.com/config/ubuntu/20.04/mssql-server-2019.list)\" \\ apt-get update \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u0430\u043a\u0435\u0442\u043e\u0432 \\ apt-get install mssql-server \\ /opt/mssql/bin/mssql-conf setup \u0441\u043a\u0440\u0438\u043f\u0442 \u043d\u0430\u0447\u0430\u043b\u044c\u043d\u043e\u0439 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438 (\u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0440\u0435\u0434\u0430\u043a\u0446\u0438\u044e, 3 - express \u0438 \u0440\u0443\u0441\u0441\u043a\u0438\u0439 \u044f\u0437\u044b\u043a 9 \u0438\u0437 11) \\ systemctl status mssql-server \\ curl https://packages.microsoft.com/keys/microsoft.asc | apt-key add - \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043a\u043b\u0438\u0435\u043d\u0442 \\ curl https://packages.microsoft.com/config/ubuntu/20.04/prod.list | tee /etc/apt/sources.list.d/msprod.list \\ apt-get update \\ apt-get install mssql-tools \\ echo 'export PATH=\"$PATH:/opt/mssql-tools/bin\"' >> ~/.bashrc \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u0434\u043e\u043c\u0430\u0448\u043d\u0438\u0439 \u043a\u0430\u0442\u0430\u043b\u043e\u0433 \u0444\u0430\u0439\u043b\u0430 bashrc, \u0447\u0442\u043e \u0431\u044b \u043d\u0435 \u043f\u0438\u0441\u0430\u0442\u044c \u043f\u0443\u0442\u044c \u043a \u0438\u0441\u043f\u043e\u043b\u043d\u044f\u0435\u043c\u043e\u043c\u0443 \u0444\u0430\u0439\u043b\u0443 \\ export PATH=\"$PATH:/opt/mssql-tools/bin\" \\ iptables -I INPUT 1 -p tcp --dport 1433 -j ACCEPT sqlcmd -S localhost -U SA CREATE DATABASE itinvent go SELECT name FROM master.dbo.sysdatabases go","title":"MSSQL"},{"location":"#systemdatasqlclient","text":"$user = \"itinvent\" $pass = \"itinvent\" $db = \"itinvent\" $srv = \"192.168.3.103\" $SqlConnection = New-Object System.Data.SqlClient.SqlConnection $SqlConnection.ConnectionString = \"server=$srv;database=$db;user id=$user;password=$pass;Integrated Security=false\" $SqlCommand = New-Object System.Data.SqlClient.SqlCommand` \u043a\u043b\u0430\u0441\u0441 \u0444\u043e\u0440\u043c\u0430\u0442\u0430 \u043a\u043e\u043c\u0430\u043d\u0434\u044b $SqlCommand.CommandText = \"SELECT * FROM ITINVENT.dbo.USERS\"` \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b #$SqlCommand.CommandText = \"SELECT LICENCE_DATE,DESCR,MODEL_NO,TYPE_NO FROM ITINVENT.dbo.ITEMS where LICENCE_DATE IS NOT NULL\" $SqlCommand.Connection = $SqlConnection` \u043f\u0435\u0440\u0435\u0434\u0430\u0442\u044c \u0444\u043e\u0440\u043c\u0430\u0442 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f $SqlAdapter = New-Object System.Data.SqlClient.SqlDataAdapter` \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0430\u0434\u0430\u043f\u0442\u0435\u0440 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u0434\u043b\u044f \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f SELECT \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 \u043a \u0411\u0414 $SqlAdapter.SelectCommand = $SqlCommand` \u043f\u0435\u0440\u0435\u0434\u0430\u0442\u044c \u043a\u043e\u043c\u0430\u043d\u0434\u0443 $DataSet = New-Object System.Data.DataSet` \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043e\u0431\u044a\u0435\u043a\u0442 \u043f\u0440\u0438\u0435\u043c\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 \u0444\u043e\u0440\u043c\u0430\u0442\u0430 XML $SqlAdapter.Fill($DataSet)` \u0437\u0430\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u043c\u0438 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u043d\u044b\u0435 \u043e\u0442 \u0430\u0434\u0430\u043f\u0442\u0435\u0440\u0430 (\u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u043a\u043e\u043b-\u0432\u043e \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432) $SqlConnection.Close() $Data = $DataSet.Tables $Data[0] | ft","title":"System.Data.SqlClient"},{"location":"#sqlclient-insert","text":"$user = \"itinvent\" $pass = \"itinvent\" $db = \"db_test\" $srv = \"192.168.3.103\" $sql = \"INSERT INTO table_test (column_user) VALUES ('lifailon')\"` \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0443 table_test \u0432 \u043a\u043e\u043b\u043e\u043d\u043a\u0443 column_user $SqlConnection = New-Object System.Data.SqlClient.SqlConnection $SqlConnection.ConnectionString = \"server=$srv;database=$db;user id=$user;password=$pass;Integrated Security=false\" $SqlCommand = New-Object System.Data.SqlClient.SqlCommand $SqlCommand.CommandText = $sql $SqlCommand.Connection = $SqlConnection $SqlConnection.Open() $rowsAffected = $SqlCommand.ExecuteNonQuery();` \u0434\u043b\u044f \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 INSERT/UPDATE/DELETE \u043d\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f SqlDataAdapter $SqlConnection.Close()","title":"SqlClient INSERT"},{"location":"#ssms-insert","text":"USE [db_test] GO INSERT INTO [dbo].[table_test] ([column_user]) VALUES ('lifailon') GO SELECT TOP (1000) [column_user] FROM [db_test].[dbo].[table_test]","title":"SSMS INSERT"},{"location":"#t-sql","text":"DDL (Data Definition Language / \u042f\u0437\u044b\u043a \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u044f \u0434\u0430\u043d\u043d\u044b\u0445). \u041a \u044d\u0442\u043e\u043c\u0443 \u0442\u0438\u043f\u0443 \u043e\u0442\u043d\u043e\u0441\u044f\u0442\u0441\u044f \u043a\u043e\u043c\u0430\u043d\u0434\u044b, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0441\u043e\u0437\u0434\u0430\u044e\u0442 \u0431\u0430\u0437\u0443 \u0434\u0430\u043d\u043d\u044b\u0445, \u0442\u0430\u0431\u043b\u0438\u0446\u044b, \u0438\u043d\u0434\u0435\u043a\u0441\u044b, \u0445\u0440\u0430\u043d\u0438\u043c\u044b\u0435 \u043f\u0440\u043e\u0446\u0435\u0434\u0443\u0440\u044b. \\ CREATE \u0441\u043e\u0437\u0434\u0430\u0435\u0442 \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 (\u0441\u0430\u043c\u0443 \u0431\u0430\u0437\u0443 \u0434\u0430\u043d\u044b\u0445, \u0442\u0430\u0431\u043b\u0438\u0446\u044b, \u0438\u043d\u0434\u0435\u043a\u0441\u044b \u0438 \u0442.\u0434.) \\ ALTER \u0438\u0437\u043c\u0435\u043d\u044f\u0435\u0442 \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 \\ DROP \u0443\u0434\u0430\u043b\u044f\u0435\u0442 \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 \\ TRUNCATE \u0443\u0434\u0430\u043b\u044f\u0435\u0442 \u0432\u0441\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0438\u0437 \u0442\u0430\u0431\u043b\u0438\u0446 DML (Data Manipulation Language / \u042f\u0437\u044b\u043a \u043c\u0430\u043d\u0438\u043f\u0443\u043b\u044f\u0446\u0438\u0438 \u0434\u0430\u043d\u043d\u044b\u043c\u0438). \u041a \u044d\u0442\u043e\u043c\u0443 \u0442\u0438\u043f\u0443 \u043e\u0442\u043d\u043e\u0441\u044f\u0442 \u043a\u043e\u043c\u0430\u043d\u0434\u044b \u043f\u043e \u0432\u044b\u0431\u043e\u0440\u0443, \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044e, \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u044e \u0438 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u044e \u0434\u0430\u043d\u043d\u044b\u0445. \\ SELECT \u0438\u0437\u0432\u043b\u0435\u043a\u0430\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0435 \u0438\u0437 \u0411\u0414 \\ UPDATE \u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0435 \\ INSERT \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442 \u043d\u043e\u0432\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \\ DELETE \u0443\u0434\u0430\u043b\u044f\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0435 DCL (Data Control Language / \u042f\u0437\u044b\u043a \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043a \u0434\u0430\u043d\u043d\u044b\u043c). \u041a \u044d\u0442\u043e\u043c\u0443 \u0442\u0438\u043f\u0443 \u043e\u0442\u043d\u043e\u0441\u044f\u0442 \u043a\u043e\u043c\u0430\u043d\u0434\u044b, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0442 \u043f\u0440\u0430\u0432\u0430\u043c\u0438 \u043f\u043e \u0434\u043e\u0441\u0442\u0443\u043f\u0443 \u043a \u0434\u0430\u043d\u043d\u044b\u043c. \\ GRANT \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 \u043f\u0440\u0430\u0432\u0430 \u0434\u043b\u044f \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043a \u0434\u0430\u043d\u043d\u044b\u043c \\ REVOKE \u043e\u0442\u0437\u044b\u0432\u0430\u0435\u0442 \u043f\u0440\u0430\u0432\u0430 \u043d\u0430 \u0434\u043e\u0441\u0442\u0443\u043f \u043a \u0434\u0430\u043d\u043d\u044b\u043c -- \u041f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 DECLARE @text NVARCHAR(20), @int INT; SET @text='Test'; SET @int = 21; select @text,@int -- \u0418\u043c\u0435\u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u0438 \u044d\u043a\u0437\u0435\u043c\u043f\u043b\u044f\u0440\u0430 Select @@SERVERNAME as [Server\\Instance]; -- \u0432\u0435\u0440\u0441\u0438\u044f SQL Server Select @@VERSION as SQLServerVersion; -- \u0422\u0435\u043a\u0443\u0449\u0430\u044f \u0411\u0414 (\u0411\u0414, \u0432 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u0435 \u043a\u043e\u0442\u043e\u0440\u043e\u0439 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \u0437\u0430\u043f\u0440\u043e\u0441) Select DB_NAME() AS CurrentDB_Name; -- \u0412\u0440\u0435\u043c\u044f \u0440\u0430\u0431\u043e\u0442\u044b \u0441 \u043c\u043e\u043c\u0435\u043d\u0442\u0430 \u0437\u0430\u043f\u0443\u0441\u043a\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 SELECT @@Servername AS ServerName , create_date AS ServerStarted , DATEDIFF(s, create_date, GETDATE()) / 86400.0 AS DaysRunning , DATEDIFF(s, create_date, GETDATE()) AS SecondsRunnig FROM sys.databases WHERE name = 'tempdb'; -- \u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0445 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0439 SELECT @@Servername AS Server , DB_NAME(database_id) AS DatabaseName , COUNT(database_id) AS Connections , Login_name AS LoginName , MIN(Login_Time) AS Login_Time , MIN(COALESCE(last_request_end_time, last_request_start_time)) AS Last_Batch FROM sys.dm_exec_sessions WHERE database_id > 0 AND DB_NAME(database_id) NOT IN ( 'master', 'msdb' ) GROUP BY database_id , login_name ORDER BY DatabaseName; -- \u0421\u0442\u0430\u0442\u0443\u0441 Backup SELECT @@Servername AS ServerName , d.Name AS DBName , MAX(b.backup_finish_date) AS LastBackupCompleted FROM sys.databases d LEFT OUTER JOIN msdb..backupset b ON b.database_name = d.name AND b.[type] = 'D' GROUP BY d.Name ORDER BY d.Name; -- \u041f\u0443\u0442\u044c \u043a Backup SELECT @@Servername AS ServerName , d.Name AS DBName , b.Backup_finish_date , bmf.Physical_Device_name FROM sys.databases d INNER JOIN msdb..backupset b ON b.database_name = d.name AND b.[type] = 'D' INNER JOIN msdb.dbo.backupmediafamily bmf ON b.media_set_id = bmf.media_set_id ORDER BY d.NAME , b.Backup_finish_date DESC; -- \u0412\u044b\u0432\u0435\u0441\u0442\u0438 \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u0411\u0414, \u043c\u043e\u0434\u0435\u043b\u0438 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0438 \u043f\u0443\u0442\u044c \u043a mdf/ldf EXEC sp_helpdb; SELECT @@SERVERNAME AS Server , d.name AS DBName , create_date , recovery_model_Desc AS RecoveryModel , m.physical_name AS FileName FROM sys.databases d JOIN sys.master_files m ON d.database_id = m.database_id ORDER BY d.name; -- \u0420\u0430\u0437\u043c\u0435\u0440 \u0411\u0414 with fs as ( select database_id, type, size * 8.0 / 1024 size from sys.master_files ) select name, (select sum(size) from fs where type = 0 and fs.database_id = db.database_id) DataFileSizeMB, (select sum(size) from fs where type = 1 and fs.database_id = db.database_id) LogFileSizeMB from sys.databases -- \u041f\u043e\u0438\u0441\u043a \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u043f\u043e \u043c\u0430\u0441\u043a\u0435 \u0438\u043c\u0435\u043d\u0438 (\u0432\u044b\u0432\u043e\u0434: \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044f \u0441\u0445\u0435\u043c\u044b \u0433\u0434\u0435 \u0440\u0430\u0441\u043f\u043e\u043b\u043e\u0433\u0430\u0435\u0442\u0441\u044f \u043e\u0431\u044a\u0435\u043a\u0442, \u0442\u0438\u043f \u043e\u0431\u044a\u0435\u043a\u0442\u0430, \u0434\u0430\u0442\u0430 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f \u0438 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0439 \u043c\u043e\u0434\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438): select [object_id], [schema_id], schema_name([schema_id]) as [schema_name], [name], [type], [type_desc], [create_date], [modify_date] from sys.all_objects -- where [name]='INVENT'; where [name] like '%INVENT%'; -- \u041a\u043e\u043b-\u0432\u043e \u0441\u0442\u0440\u043e\u043a \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0430\u0445 SELECT @@ServerName AS Server , DB_NAME() AS DBName , OBJECT_SCHEMA_NAME(p.object_id) AS SchemaName , OBJECT_NAME(p.object_id) AS TableName , i.Type_Desc , i.Name AS IndexUsedForCounts , SUM(p.Rows) AS Rows FROM sys.partitions p JOIN sys.indexes i ON i.object_id = p.object_id AND i.index_id = p.index_id WHERE i.type_desc IN ( 'CLUSTERED', 'HEAP' ) -- This is key (1 index per table) AND OBJECT_SCHEMA_NAME(p.object_id) <> 'sys' GROUP BY p.object_id , i.type_desc , i.Name ORDER BY SchemaName , TableName; -- \u041d\u0430\u0439\u0442\u0438 \u0441\u0442\u0440\u043e\u043a\u043e\u0432\u043e\u0435 (nvarchar) \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 2023 \u043f\u043e \u0432\u0441\u0435\u043c \u0442\u0430\u0431\u043b\u0438\u0446\u0430\u043c \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 -- \u041e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u0442\u0441\u044f \u0432 \u043a\u0430\u043a\u043e\u0439 \u0442\u0430\u0431\u043b\u0438\u0446\u0435 \u0438 \u0441\u0442\u043e\u043b\u0431\u0446\u0435 \u0445\u0440\u0430\u043d\u0438\u0442\u0441\u044f \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435, \u0430 \u0442\u0430\u043a\u0436\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043d\u0430\u0439\u0434\u0435\u043d\u043d\u044b\u0445 \u043f\u0430\u0440\u044b \u0442\u0430\u0431\u043b\u0438\u0446\u0430-\u043a\u043e\u043b\u043e\u043d\u043a\u0430 set nocount on declare @name varchar(128), @substr nvarchar(4000), @column varchar(128) set @substr = '%2023%' declare @sql nvarchar(max); create table`rslt (table_name varchar(128), field_name varchar(128), [value] nvarchar(max)) declare s cursor for select table_name as table_name from information_schema.tables where table_type = 'BASE TABLE' order by table_name open s fetch next from s into @name while @@fetch_status = 0 begin declare c cursor for select quotename(column_name) as column_name from information_schema.columns where data_type in ('text', 'ntext', 'varchar', 'char', 'nvarchar', 'char', 'sysname', 'int', 'tinyint') and table_name = @name set @name = quotename(@name) open c fetch next from c into @column while @@fetch_status = 0 begin --print 'Processing table - ' + @name + ', column - ' + @column set @sql='insert into`rslt select ''' + @name + ''' as Table_name, ''' + @column + ''', cast(' + @column + ' as nvarchar(max)) from' + @name + ' where cast(' + @column + ' as nvarchar(max)) like ''' + @substr + ''''; print @sql; exec(@sql); fetch next from c into @column; end close c deallocate c fetch next from s into @name end select table_name as [Table Name], field_name as [Field Name], count(*) as [Found Mathes] from`rslt group by table_name, field_name order by table_name, field_name drop table`rslt close s deallocate s -- \u041f\u043e\u0438\u0441\u043a \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0435 [CI_HISTORY] \u0438 \u0441\u0442\u043e\u043b\u0431\u0446\u0443 [HIST_ID]: SELECT * FROM ITINVENT.dbo.CI_HISTORY where [HIST_ID] like '%2023%'; -- \u0423\u0437\u043d\u0430\u0442\u044c \u0444\u0440\u0430\u0433\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044e \u0438\u043d\u0434\u0435\u043a\u0441\u043e\u0432 DECLARE @db_id SMALLINT; SET @db_id = DB_ID(N'itinvent'); IF @db_id IS NULL BEGIN; PRINT N'\u041d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u0435 \u0438\u043c\u044f \u0431\u0430\u0437\u044b'; END; ELSE BEGIN; SELECT object_id AS [ID \u043e\u0431\u044a\u0435\u043a\u0442\u0430], index_id AS [ID \u0438\u043d\u0434\u0435\u043a\u0441\u0430], index_type_desc AS [\u0422\u0438\u043f \u0438\u043d\u0434\u0435\u043a\u0441\u0430], avg_fragmentation_in_percent AS [\u0424\u0440\u0430\u0433\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044f \u0432 %] FROM sys.dm_db_index_physical_stats(@db_id, NULL, NULL, NULL , 'LIMITED') ORDER BY [avg_fragmentation_in_percent] DESC; END; GO -- TempDB -- Initial size - \u043d\u0430\u0447\u0430\u043b\u044c\u043d\u044b\u0439/\u043c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439 \u0440\u0430\u0437\u043c\u0435\u0440 \u0411\u0414 (1024 MB) -- Autogrowh - \u043f\u0440\u0438\u0440\u043e\u0441\u0442 (512MB) -- \u041f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e tempdb \u043d\u0430\u0441\u0442\u0440\u043e\u0435\u043d\u0430 \u043d\u0430 \u0430\u0432\u0442\u043e-\u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u0435 (Autogrow) \u0438 \u043f\u0440\u0438 \u043a\u0430\u0436\u0434\u043e\u0439 \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0435 SQL Server \u043f\u0435\u0440\u0435\u0441\u043e\u0437\u0434\u0430\u0451\u0442 \u0444\u0430\u0439\u043b\u044b \u044d\u0442\u043e\u0439 \u0411\u0414 \u0441 \u043c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u043c \u0440\u0430\u0437\u043c\u0435\u0440\u043e\u043c \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438. -- \u0423\u0432\u0435\u043b\u0438\u0447\u0438\u0432 \u0440\u0430\u0437\u043c\u0435\u0440 \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 \u0444\u0430\u0439\u043b\u043e\u0432 tempdb, \u043c\u043e\u0436\u043d\u043e \u0441\u0432\u0435\u0441\u0442\u0438 \u043a \u043c\u0438\u043d\u0438\u043c\u0443\u043c\u0443 \u0437\u0430\u0442\u0440\u0430\u0442\u044b \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u044b\u0445 \u0440\u0435\u0441\u0443\u0440\u0441\u043e\u0432 \u043d\u0430 \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0438 \u0430\u0432\u0442\u043e-\u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u044f. -- \u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u0443\u0442\u044c \u043a \u0411\u0414: USE master; GO ALTER DATABASE tempdb MODIFY FILE (NAME = tempdev, FILENAME = 'F:\\tempdb.mdf'); GO ALTER DATABASE tempdb MODIFY FILE (NAME = temp2, FILENAME = 'F:\\tempdb_mssql_2.ndf'); GO ALTER DATABASE tempdb MODIFY FILE (NAME = temp3, FILENAME = 'F:\\tempdb_mssql_3.ndf'); GO ALTER DATABASE tempdb MODIFY FILE (NAME = temp4, FILENAME = 'F:\\tempdb_mssql_4.ndf'); GO ALTER DATABASE tempdb MODIFY FILE (NAME = temp5, FILENAME = 'F:\\tempdb_mssql_5.ndf'); GO ALTER DATABASE tempdb MODIFY FILE (NAME = temp6, FILENAME = 'F:\\tempdb_mssql_6.ndf'); GO ALTER DATABASE tempdb MODIFY FILE (NAME = temp7, FILENAME = 'F:\\tempdb_mssql_7.ndf'); GO ALTER DATABASE tempdb MODIFY FILE (NAME = temp8, FILENAME = 'F:\\tempdb_mssql_8.ndf'); GO ALTER DATABASE tempdb MODIFY FILE (NAME = templog, FILENAME = 'F:\\templog.ldf'); GO -- \u0423\u043a\u0430\u0437\u0430\u0442\u044c \u0440\u0430\u0437\u043c\u0435\u0440 \u0444\u0430\u0439\u043b\u0430: MODIFY FILE (NAME = temp2, FILENAME = 'F:\\tempdb_mssql_2.ndf' , SIZE = 1048576KB , FILEGROWTH = 524288KB);","title":"T-SQL"},{"location":"#_6","text":"Full (\u041f\u043e\u043b\u043d\u0430\u044f \u043a\u043e\u043f\u0438\u044f). \u041a\u043e\u0433\u0434\u0430 \u0441\u0442\u0430\u0440\u0442\u0443\u0435\u0442 \u043f\u043e\u043b\u043d\u043e\u0435 \u0440\u0435\u0437\u0435\u0440\u0432\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435, \u0437\u0430\u043f\u0438\u0441\u044b\u0432\u0430\u0435\u0442\u0441\u044f Log Sequence Number (LSN - \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u043d\u043e\u043c\u0435\u0440 \u0436\u0443\u0440\u043d\u0430\u043b\u0430), \u0430 \u0442\u0430\u043a \u0436\u0435 LSN \u0437\u0430\u043f\u0438\u0441\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u0438 \u043f\u0440\u0438 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u0438 \u043f\u043e\u043b\u043d\u043e\u0433\u043e \u0440\u0435\u0437\u0435\u0440\u0432\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f. \u042d\u0442\u043e\u0442 LSN \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043c\u0435\u0445\u0430\u043d\u0438\u0437\u043c\u043e\u043c, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c\u044b\u043c SQL Server, \u0447\u0442\u043e\u0431\u044b \u0437\u043d\u0430\u0442\u044c, \u0432 \u043a\u0430\u043a\u043e\u043c \u043f\u043e\u0440\u044f\u0434\u043a\u0435 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u043b\u0438\u0441\u044c \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u044b INSERT, UPDATE \u0438\u043b\u0438 DELETE. \u041f\u0440\u0438 \u044d\u0442\u043e\u043c \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0437\u0430\u043f\u0438\u0441\u0430\u043d\u043d\u044b\u0445 LSN \u043d\u0430\u0447\u0430\u043b\u0430 \u0438 \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u044f, \u043a\u0430\u043a \u0447\u0430\u0441\u0442\u0438 \u043f\u043e\u043b\u043d\u043e\u0433\u043e \u0431\u044d\u043a\u0430\u043f\u0430, \u043e\u0431\u0435\u0441\u043f\u0435\u0447\u0438\u0432\u0430\u0435\u0442 \u0441\u043e\u0433\u043b\u0430\u0441\u043e\u0432\u0430\u043d\u043d\u043e\u0435 \u0441 \u0442\u043e\u0447\u043a\u0438 \u0437\u0440\u0435\u043d\u0438\u044f \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439 \u0440\u0435\u0437\u0435\u0440\u0432\u043d\u043e\u0435 \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435, \u043f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443 \u043f\u0440\u0438 \u043f\u043e\u043b\u043d\u043e\u043c \u0440\u0435\u0437\u0435\u0440\u0432\u043d\u043e\u043c \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0438 \u0443\u0447\u0438\u0442\u044b\u0432\u0430\u044e\u0442\u0441\u044f \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f, \u043f\u0440\u043e\u0438\u0437\u043e\u0448\u0435\u0434\u0448\u0438\u0435 \u0432\u043e \u0432\u0440\u0435\u043c\u044f \u0440\u0435\u0437\u0435\u0440\u0432\u043d\u043e\u0433\u043e \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f. \u042d\u0442\u043e \u043e\u0431\u0435\u0441\u043f\u0435\u0447\u0438\u0432\u0430\u0435\u0442 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0443 \u0442\u0430\u043a\u0438\u0445 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439 \u0432 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0435 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0431\u044d\u043a\u0430\u043f\u0430. Differential (\u0434\u0438\u0444\u0444\u0435\u0440\u0435\u043d\u0446\u0438\u0430\u043b\u044c\u043d\u0430\u044f/\u0440\u0430\u0437\u043d\u043e\u0441\u0442\u043d\u0430\u044f \u043a\u043e\u043f\u0438\u044f). \u0425\u0440\u0430\u043d\u0438\u0442 \u0434\u0430\u043d\u043d\u044b\u0445, \u0438\u0437\u043c\u0435\u043d\u0438\u0432\u0448\u0438\u0435\u0441\u044f \u0441 \u043c\u043e\u043c\u0435\u043d\u0442\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0439 \u041f\u043e\u043b\u043d\u043e\u0439 \u0440\u0435\u0437\u0435\u0440\u0432\u043d\u043e\u0439 \u043a\u043e\u043f\u0438\u0438. \u041f\u0440\u0438 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0438 \u043d\u0443\u0436\u043d\u043e \u0441\u043d\u0430\u0447\u0430\u043b\u0430 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u041f\u043e\u043b\u043d\u0443\u044e \u0440\u0435\u0437\u0435\u0440\u0432\u043d\u0443\u044e \u043a\u043e\u043f\u0438\u044e \u0432 \u0440\u0435\u0436\u0438\u043c\u0435 NORECOVERY, \u043f\u043e\u0442\u043e\u043c \u043c\u043e\u0436\u043d\u043e \u043f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c \u043b\u044e\u0431\u0443\u044e \u0438\u0437 \u043f\u043e\u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0445 \u0420\u0430\u0437\u043d\u043e\u0441\u0442\u043d\u044b\u0445 \u043a\u043e\u043f\u0438\u0439, \u0431\u0435\u0437 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0435\u0439 \u041f\u043e\u043b\u043d\u043e\u0439 \u0440\u0435\u0437\u0435\u0440\u0432\u043d\u043e\u0439 \u043a\u043e\u043f\u0438\u0438 \u0420\u0430\u0437\u043d\u043e\u0441\u0442\u043d\u0430\u044f \u043a\u043e\u043f\u0438\u044f \u0431\u0435\u0441\u043f\u043e\u043b\u0435\u0437\u043d\u0430. \u041a\u0430\u0436\u0434\u0430\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0430\u044f \u0420\u0430\u0437\u043d\u043e\u0441\u0442\u043d\u0430\u044f \u043a\u043e\u043f\u0438\u044f \u0431\u0443\u0434\u0435\u0442 \u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0432\u0441\u0435 \u0434\u0430\u043d\u043d\u044b\u0435, \u0432\u0445\u043e\u0434\u044f\u0449\u0438\u0435 \u0432 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0443\u044e \u0420\u0430\u0437\u043d\u043e\u0441\u0442\u043d\u0443\u044e \u0440\u0435\u0437\u0435\u0440\u0432\u043d\u0443\u044e \u043a\u043e\u043f\u0438\u044e, \u0441\u0434\u0435\u043b\u0430\u043d\u043d\u0443\u044e \u043f\u043e\u0441\u043b\u0435 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0435\u0439 \u041f\u043e\u043b\u043d\u043e\u0439 \u043a\u043e\u043f\u0438\u0438. Incremental (\u0438\u043d\u043a\u0440\u0435\u043c\u0435\u043d\u0442\u0430\u043b\u044c\u043d\u0430\u044f/\u043a\u043e\u043f\u0438\u044f \u0436\u0443\u0440\u043d\u0430\u043b\u043e\u0432 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439). \u0420\u0435\u0437\u0435\u0440\u0432\u043d\u043e\u0435 \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0436\u0443\u0440\u043d\u0430\u043b\u0430 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439 \u043a\u043e\u043f\u0438\u0440\u0443\u0435\u0442 \u0432\u0441\u0435 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0438 \u0441 \u043c\u043e\u043c\u0435\u043d\u0442\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u0440\u0435\u0437\u0435\u0440\u0432\u043d\u043e\u0433\u043e \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f, \u0430 \u0437\u0430\u0442\u0435\u043c \u0443\u0440\u0435\u0437\u0430\u0435\u0442 \u0436\u0443\u0440\u043d\u0430\u043b \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439 \u0434\u043b\u044f \u043e\u0441\u0432\u043e\u0431\u043e\u0436\u0434\u0435\u043d\u0438\u044f \u0434\u0438\u0441\u043a\u043e\u0432\u043e\u0433\u043e \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u0430. \u0422\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438 \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u044f\u0442 \u0432 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043d\u043e\u043c \u043f\u043e\u0440\u044f\u0434\u043a\u0435 (LSN), \u0431\u044d\u043a\u0430\u043f \u0436\u0443\u0440\u043d\u0430\u043b\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442 \u044d\u0442\u043e\u0442 \u043f\u043e\u0440\u044f\u0434\u043e\u043a \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439. \u0411\u044d\u043a\u0430\u043f\u044b \u0436\u0443\u0440\u043d\u0430\u043b\u043e\u0432 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439 \u0434\u043e\u043b\u0436\u043d\u044b \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0442\u044c\u0441\u044f \u043f\u043e \u043f\u043e\u0440\u044f\u0434\u043a\u0443. \u0414\u043b\u044f \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 \u043f\u043e\u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0432\u0441\u044f \u0446\u0435\u043f\u043e\u0447\u043a\u0430 \u0440\u0435\u0437\u0435\u0440\u0432\u043d\u044b\u0445 \u043a\u043e\u043f\u0438\u0439: \u043f\u043e\u043b\u043d\u0430\u044f \u0438 \u0432\u0441\u0435 \u043f\u043e\u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0435 \u0438\u043d\u043a\u0440\u0435\u043c\u0435\u043d\u0442\u0430\u043b\u044c\u043d\u044b\u0435 \u0436\u0443\u0440\u043d\u0430\u043b\u0430 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439.","title":"\u0422\u0438\u043f \u0440\u0435\u0437\u0435\u0440\u0432\u043d\u043e\u0439 \u043a\u043e\u043f\u0438\u0438"},{"location":"#_7","text":"Simple (\u041f\u0440\u043e\u0441\u0442\u0430\u044f). \u0425\u0440\u0430\u043d\u0438\u0442\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u044b\u0439 \u0434\u043b\u044f \u0436\u0438\u0437\u043d\u0438 \u043e\u0441\u0442\u0430\u0442\u043e\u043a \u0436\u0443\u0440\u043d\u0430\u043b\u0430 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439. \u0416\u0443\u0440\u043d\u0430\u043b \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439 (\u043b\u043e\u0433) \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u043e\u0447\u0438\u0449\u0430\u0435\u0442\u0441\u044f. \u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0440\u0435\u0437\u0435\u0440\u0432\u043d\u044b\u0445 \u043a\u043e\u043f\u0438\u0439 \u0436\u0443\u0440\u043d\u0430\u043b\u0430 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439 \u043d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u0430, \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u043e\u0441\u0442\u0430\u0435\u0442\u0441\u044f \u0441\u0430\u043c\u043e\u0435 \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u043d\u043e\u0435 \u0447\u0438\u0441\u043b\u043e \u043e\u043f\u0446\u0438\u0439 \u043f\u043e \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044e. \u041d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d \u0444\u0443\u043d\u043a\u0446\u0438\u043e\u043d\u0430\u043b: Always On, Point-In-Time \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435, \u0420\u0435\u0437\u0435\u0440\u0432\u043d\u044b\u0435 \u043a\u043e\u043f\u0438\u0438 \u0436\u0443\u0440\u043d\u0430\u043b\u0430 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439. Full (\u041f\u043e\u043b\u043d\u0430\u044f). \u0425\u0440\u0430\u043d\u0438\u0442\u0441\u044f \u0436\u0443\u0440\u043d\u0430\u043b \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439 \u0432\u0441\u0435\u0445 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0439 \u0432 \u0411\u0414 \u0441 \u043c\u043e\u043c\u0435\u043d\u0442\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u0440\u0435\u0437\u0435\u0440\u0432\u043d\u043e\u0433\u043e \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0436\u0443\u0440\u043d\u0430\u043b\u0430 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439. \u0416\u0443\u0440\u043d\u0430\u043b \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439 \u043d\u0435 \u0431\u0443\u0434\u0435\u0442 \u043e\u0447\u0438\u0449\u0430\u0442\u044c\u0441\u044f \u0434\u043e \u0442\u0435\u0445 \u043f\u043e\u0440, \u043f\u043e\u043a\u0430 \u043d\u0435 \u0431\u0443\u0434\u0435\u0442 \u0441\u0434\u0435\u043b\u0430\u043d\u0430 \u0440\u0435\u0437\u0435\u0440\u0432\u043d\u0430\u044f \u043a\u043e\u043f\u0438\u044f \u0436\u0443\u0440\u043d\u0430\u043b\u0430 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439. Bulk logged (\u0421 \u043d\u0435\u043f\u043e\u043b\u043d\u044b\u043c \u043f\u0440\u043e\u0442\u043e\u043a\u043e\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435\u043c). \u0418\u0434\u0435\u043d\u0442\u0438\u0447\u043d\u0430 Full, \u0437\u0430 \u0438\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435: SELECT INTO, BULK INSERT \u0438 BCP, INSERT INTO SELECT, \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0438 \u0441 \u0438\u043d\u0434\u0435\u043a\u0441\u0430\u043c\u0438 (CREATE INDEX, ALTER INDEX REBUILD, DROP INDEX)","title":"\u041c\u043e\u0434\u0435\u043b\u0438 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f"},{"location":"#_8","text":"master. \u0425\u0440\u0430\u043d\u044f\u0442\u0441\u044f \u0432\u0441\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u043e\u0433\u043e \u0443\u0440\u043e\u0432\u043d\u044f (\u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f \u0441\u0438\u0441\u0442\u0435\u043c\u044b, \u0441\u0432\u0435\u0434\u0435\u043d\u044c\u044f \u043e\u0431 \u0443\u0447\u0435\u0442\u043d\u044b\u0445 \u0437\u0430\u043f\u0438\u0441\u044f\u0445 \u0432\u0445\u043e\u0434\u0430, \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043e\u0431\u043e \u0432\u0441\u0435\u0445 \u0434\u0440\u0443\u0433\u0438\u0445 \u0431\u0430\u0437\u0430\u0445 \u0434\u0430\u043d\u043d\u044b\u0445) \u0434\u043b\u044f \u044d\u043a\u0437\u0435\u043c\u043f\u043b\u044f\u0440\u0430 SQL Server. tempdb. \u0420\u0430\u0431\u043e\u0447\u0435\u0435 \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u043e \u0434\u043b\u044f \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0445 \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432, \u0442\u0430\u043a\u0438\u0445 \u043a\u0430\u043a \u0433\u043b\u043e\u0431\u0430\u043b\u044c\u043d\u044b\u0435 \u0438\u043b\u0438 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u0435 \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b, \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \u0445\u0440\u0430\u043d\u0438\u043c\u044b\u0435 \u043f\u0440\u043e\u0446\u0435\u0434\u0443\u0440\u044b, \u0442\u0430\u0431\u043b\u0438\u0447\u043d\u044b\u0435 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \u0438 \u043a\u0443\u0440\u0441\u043e\u0440\u044b. \u041f\u0435\u0440\u0435\u0441\u043e\u0437\u0434\u0430\u0451\u0442\u0441\u044f \u043f\u0440\u0438 \u043a\u0430\u0436\u0434\u043e\u043c \u0437\u0430\u043f\u0443\u0441\u043a\u0435 SQL Server. model. \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0432 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435 \u0448\u0430\u0431\u043b\u043e\u043d\u0430 \u0434\u043b\u044f \u0432\u0441\u0435\u0445 \u0431\u0430\u0437 \u0434\u0430\u043d\u043d\u044b\u0445, \u0441\u043e\u0437\u0434\u0430\u0432\u0430\u0435\u043c\u044b\u0445 \u0432 \u044d\u043a\u0437\u0435\u043c\u043f\u043b\u044f\u0440\u0435 SQL Server, \u0432\u0441\u0435 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 model, \u0432\u043a\u043b\u044e\u0447\u0430\u044f \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445, \u043a\u043e\u043f\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u0432 \u0441\u043e\u0437\u0434\u0430\u0432\u0430\u0435\u043c\u0443\u044e \u0431\u0430\u0437\u0443 \u0434\u0430\u043d\u043d\u044b\u0445. \u0422\u0430\u043a \u043a\u0430\u043a \u0431\u0430\u0437\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 tempdb \u0441\u043e\u0437\u0434\u0430\u0435\u0442\u0441\u044f \u043a\u0430\u0436\u0434\u044b\u0439 \u0440\u0430\u0437 \u043f\u0440\u0438 \u0437\u0430\u043f\u0443\u0441\u043a\u0435 SQL Server, \u0431\u0430\u0437\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 model \u0432\u0441\u0435\u0433\u0434\u0430 \u0434\u043e\u043b\u0436\u043d\u0430 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u043e\u0432\u0430\u0442\u044c \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435 SQL Server. msdb. \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0430\u0433\u0435\u043d\u0442\u043e\u043c SQL Server \u0434\u043b\u044f \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f \u0440\u0430\u0441\u043f\u0438\u0441\u0430\u043d\u0438\u044f \u043f\u0440\u0435\u0434\u0443\u043f\u0440\u0435\u0436\u0434\u0435\u043d\u0438\u0439 (\u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440) \u0438 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u0437\u0430\u0434\u0430\u043d\u0438\u0439, \u0430 \u0442\u0430\u043a\u0436\u0435 \u0434\u0440\u0443\u0433\u0438\u043c\u0438 \u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u0430\u043c\u0438. SQL Server \u0445\u0440\u0430\u043d\u0438\u0442 \u043f\u043e\u043b\u043d\u044b\u0439 \u0436\u0443\u0440\u043d\u0430\u043b \u0440\u0435\u0437\u0435\u0440\u0432\u043d\u043e\u0433\u043e \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0438 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0432 \u0431\u0430\u0437\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 msdb. \u0414\u043b\u044f \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 \u043f\u043e\u0447\u0442\u044b \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u0443 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f: USE [msdb]. resource. \u0414\u043e\u0441\u0442\u0443\u043f\u043d\u0430\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u0434\u043b\u044f \u0447\u0442\u0435\u043d\u0438\u044f \u0431\u0430\u0437\u0430 \u0434\u0430\u043d\u043d\u044b\u0445, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0432\u0441\u0435 \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u044b\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 sys.objects, \u0444\u0438\u0437\u0438\u0447\u0435\u0441\u043a\u0438 \u0445\u0440\u0430\u043d\u044f\u0442\u0441\u044f \u0432 \u0431\u0430\u0437\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 resource, \u043d\u043e \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u0438 \u043f\u0440\u0438\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044e\u0442 \u0432 \u0441\u0445\u0435\u043c\u0435 sys \u043a\u0430\u0436\u0434\u043e\u0439 \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445.","title":"\u0421\u0438\u0441\u0442\u0435\u043c\u043d\u044b\u0435 \u0411\u0414"},{"location":"#_9","text":"\u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0446\u0435\u043b\u043e\u0441\u0442\u043d\u043e\u0441\u0442\u0438 \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 DBCC CHECKDB \u0418\u043d\u0434\u0435\u043a\u0441\u044b. \u0418\u043d\u0434\u0435\u043a\u0441\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442\u0441\u044f \u0434\u043b\u044f \u0431\u044b\u0441\u0442\u0440\u043e\u0433\u043e \u043f\u043e\u0438\u0441\u043a\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 \u0431\u0435\u0437 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e\u0441\u0442\u0438 \u043f\u043e\u0438\u0441\u043a\u0430/\u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0430 \u0432\u0441\u0435\u0445 \u0441\u0442\u0440\u043e\u043a \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0435 \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 \u043f\u0440\u0438 \u043a\u0430\u0436\u0434\u043e\u043c \u043e\u0431\u0440\u0430\u0449\u0435\u043d\u0438\u0438 \u043a \u0442\u0430\u0431\u043b\u0438\u0446\u0435 \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445. \u0418\u043d\u0434\u0435\u043a\u0441 \u0443\u0441\u043a\u043e\u0440\u044f\u0435\u0442 \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u0437\u0430\u043f\u0440\u043e\u0441\u0430, \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u044f \u0431\u044b\u0441\u0442\u0440\u044b\u0439 \u0434\u043e\u0441\u0442\u0443\u043f \u043a \u0441\u0442\u0440\u043e\u043a\u0430\u043c \u0434\u0430\u043d\u043d\u044b\u0445 \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0435, \u0430\u043d\u0430\u043b\u043e\u0433\u0438\u0447\u043d\u043e \u0442\u043e\u043c\u0443, \u043a\u0430\u043a \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c \u0432 \u043a\u043d\u0438\u0433\u0435 \u043f\u043e\u043c\u043e\u0433\u0430\u0435\u0442 \u0432\u0430\u043c \u0431\u044b\u0441\u0442\u0440\u043e \u043d\u0430\u0439\u0442\u0438 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u0443\u044e \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e. \u0418\u043d\u0434\u0435\u043a\u0441\u044b \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u044e\u0442 \u043f\u0443\u0442\u044c \u0434\u043b\u044f \u0431\u044b\u0441\u0442\u0440\u043e\u0433\u043e \u043f\u043e\u0438\u0441\u043a\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439 \u0432 \u044d\u0442\u0438\u0445 \u0441\u0442\u043e\u043b\u0431\u0446\u0430\u0445. \u0414\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0438\u043d\u0434\u0435\u043a\u0441\u0430 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u0440\u0430\u043d\u0438\u0442\u0441\u044f \u0435\u0433\u043e \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430. MS SQL Server \u0441\u0430\u043c\u043e\u0441\u0442\u043e\u044f\u0442\u0435\u043b\u044c\u043d\u043e \u0441\u043e\u0437\u0434\u0430\u0435\u0442 \u0438 \u0438\u0437\u043c\u0435\u043d\u044f\u0435\u0442 \u0438\u043d\u0434\u0435\u043a\u0441\u044b \u043f\u0440\u0438 \u0440\u0430\u0431\u043e\u0442\u0435 \u0441 \u0431\u0430\u0437\u043e\u0439. \u0421 \u0442\u0435\u0447\u0435\u043d\u0438\u0435\u043c \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u0438\u043d\u0434\u0435\u043a\u0441\u0435 \u0441\u0442\u0430\u043d\u043e\u0432\u044f\u0442\u0441\u044f \u0444\u0440\u0430\u0433\u043c\u0435\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u043c\u0438, \u0442.\u0435. \u0440\u0430\u0437\u0431\u0440\u043e\u0441\u0430\u043d\u043d\u044b\u043c\u0438 \u043f\u043e \u0431\u0430\u0437\u0435 \u0434\u0430\u043d\u043d\u044b\u0445, \u0447\u0442\u043e \u0441\u0435\u0440\u044c\u0435\u0437\u043d\u043e \u0441\u043d\u0438\u0436\u0430\u0435\u0442 \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432. \u0415\u0441\u043b\u0438 \u0444\u0440\u0430\u0433\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044f \u0441\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 \u043e\u0442 5 \u0434\u043e 30% (\u0441\u0442\u0430\u043d\u0434\u0430\u0440\u0442\u043d\u043e \u0432 \u0437\u0430\u0434\u0430\u043d\u0438\u0438 15%), \u0442\u043e \u0440\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u0435\u0442\u0441\u044f \u0435\u0435 \u0443\u0441\u0442\u0440\u0430\u043d\u0438\u0442\u044c \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0440\u0435\u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u0438, \u043f\u0440\u0438 \u0444\u0440\u0430\u0433\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u0438 \u0432\u044b\u0448\u0435 30% (\u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \u0432 \u0437\u0430\u0434\u0430\u0447\u0435 > 30% \u0444\u0440\u0430\u0433\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u0438 \u0438 \u0447\u0438\u0441\u043b\u043e \u0441\u0442\u0440\u0430\u043d\u0438\u0446 > 1000) \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043f\u043e\u043b\u043d\u043e\u0435 \u043f\u0435\u0440\u0435\u0441\u0442\u0440\u043e\u0435\u043d\u0438\u0435 \u0438\u043d\u0434\u0435\u043a\u0441\u043e\u0432. \u041f\u043e\u0441\u043b\u0435 \u043f\u0435\u0440\u0435\u0441\u0442\u0440\u043e\u0435\u043d\u0438\u044f \u043f\u043b\u0430\u043d\u043e\u0432\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u0440\u0435\u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u044f. \u0420\u0435\u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u044f (Reorganize) \u0438\u043b\u0438 \u0434\u0435\u0444\u0440\u0430\u0433\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044f \u0438\u043d\u0434\u0435\u043a\u0441\u0430 \u2014 \u044d\u0442\u043e \u0441\u0435\u0440\u0438\u044f \u043d\u0435\u0431\u043e\u043b\u044c\u0448\u0438\u0445 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u0445 \u043f\u0435\u0440\u0435\u043c\u0435\u0449\u0435\u043d\u0438\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446 \u0442\u0430\u043a, \u0447\u0442\u043e\u0431\u044b \u0438\u043d\u0434\u0435\u043a\u0441 \u043d\u0435 \u0431\u044b\u043b \u0444\u0440\u0430\u0433\u043c\u0435\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u043d. \u041f\u043e\u0441\u043b\u0435 \u0440\u0435\u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u0438 \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u043d\u0435 \u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u0442\u0441\u044f. \u0412\u043e \u0432\u0440\u0435\u043c\u044f \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u043f\u043e\u0447\u0442\u0438 \u0432\u0441\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b, \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438 \u0441\u043c\u043e\u0433\u0443\u0442 \u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c. sp_msforeachtable N'DBCC INDEXDEFRAG (<\u0438\u043c\u044f \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445>, ''?'')' \u041f\u0435\u0440\u0435\u0441\u0442\u0440\u043e\u0435\u043d\u0438\u0435 (Rebuild) \u0438\u043d\u0434\u0435\u043a\u0441\u043e\u0432 (\u0438\u043b\u0438 \u0437\u0430\u0434\u0430\u0447\u0430 \u0432 \u043c\u0430\u0441\u0442\u0435\u0440\u0435 \u043f\u043b\u0430\u043d\u043e\u0432 \u043e\u0431\u0441\u043b\u0443\u0436\u0438\u0432\u0430\u043d\u0438\u044f: \u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0438\u043d\u0434\u0435\u043a\u0441) \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u0442 \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u043f\u043e\u043b\u043d\u043e\u0433\u043e \u043f\u043e\u0441\u0442\u0440\u043e\u0435\u043d\u0438\u044f \u0438\u043d\u0434\u0435\u043a\u0441\u043e\u0432. \u0412 \u0432\u0435\u0440\u0441\u0438\u0438 MS SQL Server Standard \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442 \u043e\u0442\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u0432\u0441\u0435\u0445 \u043a\u043b\u0438\u0435\u043d\u0442\u043e\u0432 \u043e\u0442 \u0431\u0430\u0437\u044b \u043d\u0430 \u0432\u0440\u0435\u043c\u044f \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0438. \u041f\u043e\u0441\u043b\u0435 \u043f\u0435\u0440\u0435\u0441\u0442\u0440\u043e\u0435\u043d\u0438\u044f \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430. sp_msforeachtable N'DBCC DBREINDEX (''?'')' \u041e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0438. \u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u2014 \u043d\u0435\u0431\u043e\u043b\u044c\u0448\u0430\u044f \u0442\u0430\u0431\u043b\u0438\u0446\u0430 (\u043e\u0431\u044b\u0447\u043d\u043e \u0434\u043e 200 \u0441\u0442\u0440\u043e\u043a), \u0432 \u043a\u043e\u0442\u043e\u0440\u043e\u0439 \u0445\u0440\u0430\u043d\u0438\u0442\u0441\u044f \u043e\u0431\u043e\u0431\u0449\u0435\u043d\u043d\u0430\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043e \u0442\u043e\u043c, \u043a\u0430\u043a\u0438\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0438 \u043a\u0430\u043a \u0447\u0430\u0441\u0442\u043e \u0432\u0441\u0442\u0440\u0435\u0447\u0430\u044e\u0442\u0441\u044f \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0435. \u041d\u0430 \u043e\u0441\u043d\u043e\u0432\u0430\u043d\u0438\u0438 \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0438 \u0441\u0435\u0440\u0432\u0435\u0440 \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0435\u0442 \u0440\u0435\u0448\u0435\u043d\u0438\u0435, \u043a\u0430\u043a \u043b\u0443\u0447\u0448\u0435 \u043f\u043e\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0437\u0430\u043f\u0440\u043e\u0441. \u041a\u043e\u0433\u0434\u0430 \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u044f\u0442 \u0437\u0430\u043f\u0440\u043e\u0441\u044b \u043a \u0411\u0414 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, SELECT) \u0432\u044b \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442\u0435 \u0434\u0430\u043d\u043d\u044b\u0435, \u043d\u043e \u043d\u0435 \u043e\u043f\u0438\u0441\u044b\u0432\u0430\u0435\u0442\u0435 \u0442\u043e, \u043a\u0430\u043a \u044d\u0442\u0438 \u0434\u0430\u043d\u043d\u044b\u0435 \u0434\u043e\u043b\u0436\u043d\u044b \u0431\u044b\u0442\u044c \u0438\u0437\u0432\u043b\u0435\u0447\u0435\u043d\u044b. \u0412 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0438 \u0438 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 \u043f\u043e\u043c\u043e\u0433\u0430\u0435\u0442 \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430. \u0412\u043e \u0432\u0440\u0435\u043c\u044f \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u043f\u0440\u043e\u0446\u0435\u0434\u0443\u0440\u044b \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0438 \u0434\u0430\u043d\u043d\u044b\u0435 \u043d\u0435 \u0431\u043b\u043e\u043a\u0438\u0440\u0443\u044e\u0442\u0441\u044f. exec sp_msforeachtable N'UPDATE STATISTICS ? WITH FULLSCAN' \u041e\u0447\u0438\u0441\u0442\u043a\u0430 \u043f\u0440\u043e\u0446\u0435\u0434\u0443\u0440\u043d\u043e\u0433\u043e \u043a\u044d\u0448\u0430, \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \u043f\u043e\u0441\u043b\u0435 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0438. \u041e\u043f\u0442\u0438\u043c\u0438\u0437\u0430\u0442\u043e\u0440 MS SQL Server \u043a\u044d\u0448\u0438\u0440\u0443\u0435\u0442 \u043f\u043b\u0430\u043d\u044b \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 \u0434\u043b\u044f \u0438\u0445 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e\u0433\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f. \u042d\u0442\u043e \u0434\u0435\u043b\u0430\u0435\u0442\u0441\u044f \u0434\u043b\u044f \u0442\u043e\u0433\u043e, \u0447\u0442\u043e\u0431\u044b \u044d\u043a\u043e\u043d\u043e\u043c\u0438\u0442\u044c \u0432\u0440\u0435\u043c\u044f, \u0437\u0430\u0442\u0440\u0430\u0447\u0438\u0432\u0430\u0435\u043c\u043e\u0435 \u043d\u0430 \u043a\u043e\u043c\u043f\u0438\u043b\u044f\u0446\u0438\u044e \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u0432 \u0442\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435, \u0435\u0441\u043b\u0438 \u0442\u0430\u043a\u043e\u0439 \u0436\u0435 \u0437\u0430\u043f\u0440\u043e\u0441 \u0443\u0436\u0435 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u043b\u0441\u044f \u0438 \u0435\u0433\u043e \u043f\u043b\u0430\u043d \u0438\u0437\u0432\u0435\u0441\u0442\u0435\u043d. \u041f\u043e\u0441\u043b\u0435 \u043e\u0431\u043d\u043e\u0432\u0438\u044f \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0438, \u043d\u0435 \u0431\u0443\u0434\u0435\u0442 \u043e\u0447\u0438\u0449\u0435\u043d \u043f\u0440\u043e\u0446\u0435\u0434\u0443\u0440\u043d\u044b\u0439 \u043a\u044d\u0448, \u0442\u043e SQL Server \u043c\u043e\u0436\u0435\u0442 \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0441\u0442\u0430\u0440\u044b\u0439 (\u043d\u0435\u043e\u043f\u0442\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439) \u043f\u043b\u0430\u043d \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u0438\u0437 \u043a\u044d\u0448\u0430 \u0432\u043c\u0435\u0441\u0442\u043e \u0442\u043e\u0433\u043e, \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u043d\u043e\u0432\u044b\u0439 (\u0431\u043e\u043b\u0435\u0435 \u043e\u043f\u0442\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439) \u043f\u043b\u0430\u043d. DBCC FREEPROCCACHE","title":"\u0420\u0435\u0433\u043b\u0430\u043c\u0435\u043d\u0442\u043d\u044b\u0435 \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0438"},{"location":"#influxdb","text":"Download InfluxDB 1.x Open Source InfluxDB-Studio","title":"InfluxDB"},{"location":"#install-windows","text":"Invoke-RestMethod \"https://dl.influxdata.com/influxdb/releases/influxdb-1.8.10_windows_amd64.zip\" -OutFile \"$home\\Downloads\\influxdb-1.8.10_windows_amd64.zip\" Expand-Archive \"$home\\Downloads\\influxdb-1.8.10_windows_amd64.zip\" -DestinationPath \"$home\\Documents\\\" Remove-Item \"$home\\Downloads\\influxdb-1.8.10_windows_amd64.zip\" & \"$home\\Downloads\\influxdb-1.8.10-1\\influxd.exe\"","title":"Install Windows"},{"location":"#install-ubuntu","text":"wget https://dl.influxdata.com/influxdb/releases/influxdb_1.8.10_amd64.deb sudo dpkg -i influxdb_1.8.10_amd64.deb systemctl start influxdb systemctl status influxdb ps aux | grep influxdb | grep -Ev \"grep\" netstat -natpl | grep 80[8-9][3-9]","title":"Install Ubuntu"},{"location":"#api","text":"nano /etc/influxdb/influxdb.conf [http] enabled = true bind-address = \":8086\" auth-enabled = false systemctl restart influxdb","title":"API"},{"location":"#chronograf","text":"wget https://dl.influxdata.com/chronograf/releases/chronograf-1.10.2_windows_amd64.zip -UseBasicParsing -OutFile chronograf-1.10.2_windows_amd64.zip Expand-Archive .\\chronograf-1.10.2_windows_amd64.zip -DestinationPath 'C:\\Program Files\\InfluxData\\chronograf\\' wget https://dl.influxdata.com/chronograf/releases/chronograf_1.10.2_amd64.deb sudo dpkg -i chronograf_1.10.2_amd64.deb systemctl status influxdb http://192.168.3.102:8888","title":"Chronograf"},{"location":"#grafana","text":"Download invoke-RestMethod https://dl.grafana.com/enterprise/release/grafana-enterprise-10.3.1.windows-amd64.msi -OutFile \"$home\\Download\\grafana.msi\" apt-get install -y adduser libfontconfig1 musl wget https://dl.grafana.com/enterprise/release/grafana-enterprise_10.3.1_amd64.deb dpkg -i grafana-enterprise_10.3.1_amd64.deb systemctl start grafana-server systemctl status grafana-server","title":"Grafana"},{"location":"#cli-client","text":"apt install influxdb-client \\ influx \\ influx --host 192.168.3.102 --username admin --password password $influx_client_exec = \"$home\\Documents\\influxdb-1.8.10-1\\influx.exe\" & $influx_client_exec -host 192.168.3.102 -port 8086 help show databases use PowerShell SELECT * FROM \"HardwareMonitor\" WHERE time > now() - 5m","title":"CLI Client"},{"location":"#users","text":"SHOW USERS \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \u0438 \u0438\u0445 \u043f\u0440\u0430\u0432\u0430 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \\ CREATE USER admin WITH PASSWORD 'password' WITH ALL PRIVILEGES \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \\ GRANT ALL PRIVILEGES TO \"admin\" \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u043f\u0440\u0430\u0432\u0430 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \\ GRANT READ ON \"database\" TO \"admin\" \u0434\u043e\u0441\u0442\u0443\u043f \u043d\u0430 \u0447\u0442\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u0411\u0414 \u0438\u043b\u0438 \u0437\u0430\u043f\u0438\u0441\u044c (WRITE) \\ REVOKE ALL PRIVILEGES FROM \"admin\" \u043e\u0442\u043e\u0437\u0432\u0430\u0442\u044c \u043f\u0440\u0430\u0432\u0430 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \\ SHOW GRANTS FOR \"admin\" \u0411\u0414 \u0438 \u043f\u0440\u0438\u0432\u0435\u043b\u0435\u0433\u0438\u0438 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u0434\u043b\u044f \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \\ SET PASSWORD FOR \"admin\" = 'new_password' \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \\ DROP USER \"admin\" \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f","title":"USERS"},{"location":"#database_2","text":"CREATE DATABASE powershell \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0411\u0414 \\ SHOW DATABASES \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0411\u0414 \\ DROP DATABASE powershell \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0411\u0414 \\ USE powershell \\ SHOW measurements \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \\ INSERT performance,host=console,counter=CPU value=0.88 \u0437\u0430\u043f\u0438\u0441\u0430\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0443 performance","title":"DATABASE"},{"location":"#measurement","text":"SHOW TAG KEYS FROM \"HardwareMonitor\" \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u0442\u044d\u0433\u0438 \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0435 \\ SHOW TAG VALUES FROM \"HardwareMonitor\" WITH KEY = \"HardwareName\" \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0433\u043e \u0442\u044d\u0433\u0430 \\ SHOW FIELD KEYS FROM \"HardwareMonitor\" \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 Field Tags \u0438 \u0438\u0445 \u0442\u0438\u043f \u0434\u0430\u043d\u043d\u044b\u0445 \\ SHOW SERIES FROM \"HardwareMonitor\" \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0445 \u0441\u0435\u0440\u0438\u0439 \u0432 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0439 \u0442\u0430\u0431\u043b\u0438\u0446\u0435. \u0421\u0435\u0440\u0438\u044f - \u044d\u0442\u043e \u043d\u0430\u0431\u043e\u0440 \u0442\u043e\u0447\u0435\u043a \u0434\u0430\u043d\u043d\u044b\u0445, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0438\u043c\u0435\u044e\u0442 \u043e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u044b\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0434\u043b\u044f \u0432\u0441\u0435\u0445 \u0442\u0435\u0433\u043e\u0432, \u0437\u0430 \u0438\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435\u043c \u0432\u0440\u0435\u043c\u0435\u043d\u0438. \\ DROP SERIES FROM \"HardwareMonitor\" \u043e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u0432\u0441\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0435 \\ DROP MEASUREMENT \"HardwareMonitor\" \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0442\u0430\u0431\u043b\u0438\u0446\u0443","title":"MEASUREMENT"},{"location":"#selectwhere","text":"SELECT * FROM performance \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0435 \\ SELECT value FROM performance \u043e\u0442\u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u043e \u0441\u0442\u043e\u043b\u0431\u0446\u0443 value (\u0442\u043e\u043b\u044c\u043a\u043e Field Keys) \\ SELECT * FROM performance limit 10 \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c 10 \u0435\u0434\u0438\u043d\u0438\u0446 \u0434\u0430\u043d\u043d\u044b\u0445 \\ SELECT * FROM performance WHERE time > now() -2d \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0437\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0435 2 \u0434\u043d\u044f \\ SELECT * FROM performance WHERE time > now() +3h -5m \u0434\u0430\u043d\u043d\u044b\u0435 \u0437\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0435 5 \u043c\u0438\u043d\u0443\u0442 (+3 \u0447\u0430\u0441\u0430 \u043e\u0442 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u043f\u043e UTC 0 -5 \u043c\u0438\u043d\u0443\u0442) \\ SELECT * FROM performance WHERE counter = 'CPU' \u0432\u044b\u0431\u043e\u0440\u043a\u0430 \u043f\u043e \u0442\u044d\u0433\u0443 \\ SELECT upload/1000 FROM speedtest WHERE upload/1000 <= 250 \u0432\u044b\u0431\u043e\u0440\u043a\u0430 \u043f\u043e \u0441\u0442\u043e\u043b\u0431\u0446\u0443 upload \u0438 \u0440\u0430\u0437\u0434\u0435\u043b\u0438\u0442\u044c \u0432\u044b\u0432\u043e\u0434 \u043d\u0430 1000, \u0432\u044b\u0432\u0435\u0441\u0442\u0438 upload \u043c\u0435\u043d\u044c\u0448\u0435 250 \\ DELETE FROM performance WHERE time > now() -1h \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0437\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0435 1/4 \u0447\u0430\u0441\u0430 \\ DELETE FROM performance WHERE time < now() -24h \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0441\u0442\u0430\u0440\u0448\u0435 24 \u0447\u0430\u0441\u043e\u0432","title":"SELECT/WHERE"},{"location":"#regex_1","text":"SELECT * FROM \"win_pdisk\" WHERE instance =~/.*C:/ and time > now() - 5m \u0438 \\ SELECT * FROM \"win_pdisk\" WHERE instance =~/.*E:/ or instance =~ /.*F:/ \u0438\u043b\u0438 \\ SELECT * FROM \"win_pdisk\" WHERE instance !~ /.*Total/ \u043d\u0435 \u0440\u0430\u0432\u043d\u043e (\u0438\u0441\u043a\u043b\u044e\u0447\u0438\u0442\u044c) \\ SELECT * FROM \"HardwareMonitor\" WHERE time > now() - 5m and HardwareName =~ /Intel/ \u043f\u0440\u0438\u0431\u043b\u0438\u0437\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0440\u0430\u0432\u043d\u043e \\ SELECT * FROM \"HardwareMonitor\" WHERE time > now() - 5m and HardwareName =~ /Intel.+i7/ \u044d\u043a\u0432\u0438\u0432\u0430\u043b\u0435\u043d\u0442 12th_Gen_Intel_Core_i7-1260P \\ SELECT * FROM \"HardwareMonitor\" WHERE time > now() - 5m and HardwareName =~ /^Intel/ \u043d\u0430\u0447\u0438\u043d\u0430\u0435\u0442\u0441\u044f \u043d\u0430 Intel \\ SELECT * FROM \"HardwareMonitor\" WHERE time > now() - 5m and HardwareName =~ /00$/ \u0437\u0430\u043a\u0430\u043d\u0447\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u043d\u0430 00","title":"REGEX"},{"location":"#group-by-tag_key","text":"SELECT * FROM \"HardwareMonitor\" WHERE time > now() - 5m and SensorName = 'Temperature' GROUP BY HardwareName \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0435 \u0433\u0440\u0443\u043f\u043f\u044b \u043f\u043e \u0442\u044d\u0433\u0443 HardwareName \\ SELECT * FROM \"HardwareMonitor\" WHERE time > now() - 5m and SensorName = 'Temperature' GROUP BY Host,HardwareName \u0431\u043e\u043b\u044c\u0448\u0435 \u0433\u0440\u0443\u043f\u043f \u043f\u043e \u0434\u0432\u0443\u043c \u0442\u044d\u0433\u0430\u0430\u043c","title":"GROUP BY tag_key"},{"location":"#functionsfield_key","text":"Functions SELECT instance,LAST(Avg._Disk_Read_Queue_Length) FROM \"win_pdisk\" GROUP BY instance \u043e\u0442\u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u044b\u0432\u043e\u0434 \u043f\u043e \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u043c\u0443/\u0442\u0435\u043a\u0443\u0449\u0435\u043c\u0443 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044e \\ SELECT instance,FIRST(Avg._Disk_Read_Queue_Length) FROM \"win_pdisk\" GROUP BY instance \u043e\u0442\u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u044b\u0432\u043e\u0434 \u043f\u043e \u043f\u0435\u0440\u0432\u043e\u043c\u0443 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044e \u0437\u0430 \u0432\u0435\u0441\u044c \u0438\u043b\u0438 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u0439 \u043e\u0442\u0440\u0435\u0437\u043e\u043a \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \\ SELECT instance,MIN(Avg._Disk_Read_Queue_Length) FROM \"win_pdisk\" GROUP BY instance \u043e\u0442\u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u044b\u0432\u043e\u0434 \u0441 \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435\u043c \u043c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0433\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \\ SELECT instance,MAX(Avg._Disk_Read_Queue_Length) FROM \"win_pdisk\" GROUP BY instance \u043e\u0442\u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u044b\u0432\u043e\u0434 \u0441 \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435\u043c \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0433\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \\ SELECT SUM(Bytes_Received_persec) FROM \"win_net\" GROUP BY instance \u0441\u0443\u043c\u043c\u0430\u0445 \u0432\u0441\u0435\u0445 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439 \\ SELECT COUNT(Bytes_Received_persec) FROM \"win_net\" WHERE Bytes_Received_persec >= 0 GROUP BY instance \u043a\u043e\u043b-\u0432\u043e \u0434\u0430\u043d\u043d\u044b\u0445, \u0433\u0434\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0432\u044b\u0448\u0435 \u0438\u043b\u0438 \u0440\u0430\u0432\u043d\u043e 0 \\ SELECT MEAN(Bytes_Received_persec) FROM \"win_net\" WHERE Bytes_Received_persec < 1000 GROUP BY instance \u0441\u0440\u0435\u0434\u043d\u0435\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 \u0441 \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c \u043e\u0442 0 \u0434\u043e 1000 (509) SELECT *,MAX(Value) FROM \"HardwareMonitor\" WHERE time > now() -1h GROUP BY SensorName,Host \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0433\u0440\u0443\u043f\u043f\u044b \u0434\u043b\u044f \u0432\u044b\u044f\u0432\u043b\u0435\u043d\u0438\u044f \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0433\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0441\u0442\u043e\u0431\u0446\u0430 Value \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0442\u044d\u0433\u0430 SensorName \u0438 \u0445\u043e\u0441\u0442\u0430 \u0437\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0439 \u0447\u0430\u0441 \\ SELECT *,MAX(Value) FROM \"HardwareMonitor\" WHERE time > now() -1h and SensorName = 'CPU_Package' GROUP BY Host \u043c\u0430\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 CPU_Package \u0437\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0439 \u0447\u0430\u0441 \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0445\u043e\u0441\u0442\u0430 \\ SELECT MEAN(Value) FROM \"HardwareMonitor\" WHERE time > now() -1h and SensorName = 'CPU_Package' GROUP BY Host \u0441\u0440\u0435\u0434\u043d\u0435\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 CPU_Package \u0437\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0439 \u0447\u0430\u0441","title":"Functions(field_key)"},{"location":"#policy","text":"CREATE DATABASE powershell WITH DURATION 48h REPLICATION 1 NAME \"del2d\" \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0411\u0414 \u0441 \u043f\u043e\u043b\u0438\u0442\u0438\u043a\u043e\u0439 \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f 2 \u0434\u043d\u044f \\ CREATE RETENTION POLICY del2h ON powershell DURATION 2h REPLICATION 1 \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043d\u043e\u0432\u0443\u044e \u043f\u043e\u043b\u0438\u0442\u0438\u043a\u0443 \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0434\u043b\u044f \u0411\u0414 \\ CREATE RETENTION POLICY del6h ON powershell DURATION 6h REPLICATION 1 SHARD DURATION 2h \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u043f\u0435\u0440\u0438\u043e\u0434 \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f 6 \u0447\u0430\u0441\u043e\u0432 + 2 \u0447\u0430\u0441\u0430 \u0434\u043e \u043e\u0447\u0438\u0441\u0442\u043a\u0438 (\u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e 1\u0447 \u0438\u043b\u0438 \u0431\u043e\u043b\u044c\u0448\u0435) \\ ALTER RETENTION POLICY del6h ON powershell DEFAULT \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c (ALTER) \u043f\u043e\u043b\u0438\u0442\u0438\u043a\u0443 \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0434\u043b\u044f \u0411\u0414 \u043d\u0430 del6h (DEFAULT) \\ DROP RETENTION POLICY del2d ON powershell \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u043f\u043e\u043b\u0438\u0442\u0438\u043a\u0438 \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u043f\u0440\u0438\u0432\u043e\u0434\u0438\u0442 \u043a \u0431\u0435\u0437\u0432\u043e\u0437\u0432\u0440\u0430\u0442\u043d\u043e\u043c\u0443 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u044e \u0432\u0441\u0435\u0445 \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u0439 (\u0442\u0430\u0431\u043b\u0438\u0446) \u0438 \u0434\u0430\u043d\u043d\u044b\u0445, \u0445\u0440\u0430\u043d\u044f\u0449\u0438\u0445\u0441\u044f \u0432 \u043f\u043e\u043b\u0438\u0442\u0438\u043a\u0435 \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \\ SHOW RETENTION POLICIES ON PowerShell \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0434\u0435\u0439\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u043f\u043e\u043b\u0438\u0442\u0438\u043a\u0438 \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 PowerShell $data = Invoke-RestMethod http://192.168.3.102:8086/query?q=\"SHOW RETENTION POLICIES ON PowerShell\" $col = $data.results.series.columns $val = $data.results.series.values $mass = @() $mass += [string]$col foreach ($v in $val) { $mass += [string]$v } $mass = $mass -replace '^','\"' $mass = $mass -replace '$','\"' $mass = $mass -replace '\\s','\",\"' $mass | ConvertFrom-Csv","title":"POLICY"},{"location":"#api-post","text":"\u0412\u043c\u0435\u0441\u0442\u043e \u0442\u0430\u0431\u043b\u0438\u0446 \u0432 InfluxDB \u0438\u043c\u0435\u044e\u0442\u0441\u044f \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u044f. \u0412\u043c\u0435\u0441\u0442\u043e \u0441\u0442\u043e\u043b\u0431\u0446\u043e\u0432 \u0432 \u043d\u0435\u0439 \u0435\u0441\u0442\u044c \u0442\u0435\u0433\u0438 \u0438 \u043f\u043e\u043b\u044f. Table Tag (string/int) Field (double/int) TIMESTAMP measurement,Tag_Keys1=Tag_Values1,Tag_Keys2=Tag_Values2 Field_Keys1=\"Values\",Field_Keys2=\"Values\" 0000000000000000000 1 2 3 $ip = \"192.168.3.104\" $port = \"8086\" $db = \"powershell\" $table = \"speedtest\" $ipp = $ip+\":\"+$port $url = \"http://$ipp/write?db=$db\" $user = \"admin\" $pass = \"password\" | ConvertTo-SecureString -AsPlainText -Force $cred = [System.Management.Automation.PSCredential]::new($user,$pass) $unixtime = (New-TimeSpan -Start (Get-Date \"01/01/1970\") -End (Get-Date)).TotalSeconds $timestamp = ([string]$unixtime -replace \"\\..+\") + \"000000000\" Invoke-RestMethod -Method POST -Uri $url -Body \"$table,host=$(hostname) download=200000,upload=300000,ping=3 $timestamp\"","title":"API POST"},{"location":"#api-get","text":"curl http://192.168.3.104:8086/query --data-urlencode \"q=SHOW DATABASES\" pwsh7 (ConvertFrom-Json) and bash $dbs = irm \"http://192.168.3.104:8086/query?q=SHOW DATABASES\" \\ $dbs = irm \"http://192.168.3.104:8086/query?epoch=ms&u=admin&p=password&q=SHOW DATABASES\" \\ $dbs.results.series.values $ip = \"192.168.3.104\" $port = \"8086\" $db = \"powershell\" $table = \"speedtest\" $query = \"SELECT * FROM $table\" $ipp = $ip+\":\"+$port $url = \"http://$ipp/query?db=$db&q=$query\" $data = Invoke-RestMethod -Method GET -Uri $url` -Credential $cred $data.results.series.name ` \u0438\u043c\u044f \u0442\u0430\u0431\u043b\u0438\u0446\u044b $data.results.series.columns` \u0441\u0442\u043e\u043b\u0431\u0446\u044b/\u043a\u043b\u044e\u0447\u0438 $data.results.series.values ` \u0434\u0430\u043d\u043d\u044b\u0435 \u043f\u043e\u0441\u0442\u0440\u043e\u0447\u043d\u043e","title":"API GET"},{"location":"#endpoints","text":"API doc $stats = irm http://192.168.3.104:8086/debug/vars` \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 $stats.\"database:powershell\".values` \u043a\u043e\u043b-\u0432\u043e \u0442\u0430\u0431\u043b\u0438\u0446 \u043a \u0411\u0414 $stats.queryExecutor.values` \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e query-\u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 (\u043e\u0431\u0440\u0430\u0449\u0435\u043d\u0438\u0439 \u043a endpoint /query) $stats.write.values` \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e write-\u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 $stats.system.uptime http://192.168.3.104:8086/debug/requests \u043a\u043e\u043b-\u0432\u043e \u043a\u043b\u0438\u0435\u043d\u0442\u0441\u043a\u0438\u0445 HTTP-\u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 \u043a \u043a\u043e\u043d\u0435\u0447\u043d\u044b\u043c \u0442\u043e\u0447\u043a\u0430\u043c /write\u0438 /query \\ http://192.168.3.104:8086/debug/pprof \\ http://192.168.3.104:8086/ping \\ http://192.168.3.104:8086/query \\ http://192.168.3.104:8086/write http://192.168.3.99:8086/api/v2/setup \\ http://192.168.3.99:8086/api/v2/config \\ http://192.168.3.99:8086/api/v2/write","title":"Endpoints"},{"location":"#pingto-influxdb","text":"while ($true) { $tz = (Get-TimeZone).BaseUtcOffset.TotalMinutes $unixtime = (New-TimeSpan -Start (Get-Date \"01/01/1970\") -End ((Get-Date).AddMinutes(-$tz))).TotalSeconds` -3h UTC $timestamp = ([string]$unixtime -replace \"\\..+\") + \"000000000\" $tnc = tnc 8.8.8.8 $Status = $tnc.PingSucceeded $RTime = $tnc.PingReplyDetails.RoundtripTime Invoke-RestMethod -Method POST -Uri \"http://192.168.3.104:8086/write?db=powershell\" -Body \"ping,host=$(hostname) status=$status,rtime=$RTime $timestamp\" sleep 1 } SELECT * FROM ping WHERE status = false","title":"PingTo-InfluxDB"},{"location":"#performanceto-influxdb","text":"function ConvertTo-Encoding ([string]$From, [string]$To) { Begin { $encFrom = [System.Text.Encoding]::GetEncoding($from) $encTo = [System.Text.Encoding]::GetEncoding($to) } Process { $bytes = $encTo.GetBytes($_) $bytes = [System.Text.Encoding]::Convert($encFrom, $encTo, $bytes) $encTo.GetString($bytes) } } $localization = (Get-Culture).LCID` \u0442\u0435\u043a\u0443\u0449\u0430\u044f \u043b\u043e\u043a\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f if ($localization -eq 1049) { $performance = \"\\\\$(hostname)\\\u041f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u0440(_Total)\\% \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d\u043d\u043e\u0441\u0442\u0438 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u0440\u0430\" | ConvertTo-Encoding UTF-8 windows-1251` \u0434\u0435\u043a\u043e\u0434\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043a\u0438\u0440\u0438\u043b\u043b\u0438\u0446\u0443 } else { $performance = \"\\Processor(_Total)\\% Processor Time\" } $tz = (Get-TimeZone).BaseUtcOffset.TotalMinutes while ($true) { $unixtime = (New-TimeSpan -Start (Get-Date \"01/01/1970\") -End ((Get-Date).AddMinutes(-$tz))).TotalSeconds` -3h UTC $timestamp = ([string]$unixtime -replace \"\\..+\") + \"000000000\" [double]$value = (Get-Counter $performance).CounterSamples.CookedValue.ToString(\"0.00\").replace(\",\",\".\")` \u043e\u043a\u0440\u0443\u0433\u043b\u0438\u0442\u044c \u0432 \u0442\u0438\u043f \u0434\u0430\u043d\u043d\u044b\u0445 Double Invoke-RestMethod -Method POST -Uri \"http://192.168.3.104:8086/write?db=powershell\" -Body \"performance,host=$(hostname),counter=CPU value=$value $timestamp\" sleep 5 }","title":"PerformanceTo-InfluxDB"},{"location":"#service","text":"$powershell_Path = (Get-Command powershell).Source $NSSM_Path = \"C:\\NSSM\\NSSM-2.24.exe\" $Script_Path = \"C:\\NSSM\\PerformanceTo-InfluxDB.ps1\" $Service_Name = \"PerformanceTo-InfluxDB\" & $NSSM_Path install $Service_Name $powershell_Path -ExecutionPolicy Bypass -NoProfile -f $Script_Path Get-Service $Service_Name | Start-Service Get-Service $Service_Name | Set-Service -StartupType Automatic","title":"Service"},{"location":"#telegraf","text":"Plugins iwr https://dl.influxdata.com/telegraf/releases/telegraf-1.27.1_windows_amd64.zip -UseBasicParsing -OutFile telegraf-1.27.1_windows_amd64.zip \\ Expand-Archive .\\telegraf-1.27.1_windows_amd64.zip -DestinationPath \"C:\\Telegraf\" \\ rm telegraf-1.27.1_windows_amd64.zip \\ cd C:\\Telegraf \\ .\\telegraf.exe -sample-config --input-filter cpu:mem:dns_query --output-filter influxdb > telegraf_nt.conf \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044e \u0441 \u0432\u044b\u0431\u0430\u0440\u043d\u043d\u044b\u043c\u0438 \u043f\u043b\u0430\u0433\u0438\u043d\u0430\u043c\u0438 \u0434\u043b\u044f \u0441\u0431\u043e\u0440\u0430 \u043c\u0435\u0442\u0440\u0438\u043a \\ Start-Process notepad++ C:\\Telegraf\\telegraf_nt.conf [[outputs.influxdb]] urls = [\"http://192.168.3.104:8086\"] database = \"telegraf_nt\" username = \"user\" password = \"pass\" [[inputs.cpu]] percpu = false totalcpu = true [[inputs.dns_query]] servers = [\"8.8.8.8\"] network = \"udp\" domains = [\".\"] record_type = \"A\" port = 53 timeout = \"2s\" .\\telegraf.exe --test -config C:\\Telegraf\\telegraf_nt.conf \u0442\u0435\u0441\u0442 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438 (\u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u043c\u0435\u0442\u0440\u0438\u043a \u0441 \u0432\u044b\u0432\u043e\u0434\u043e\u043c \u0432 \u043a\u043e\u043d\u0441\u043e\u043b\u044c) \\ C:\\Telegraf\\telegraf.exe -config C:\\Telegraf\\telegraf_nt.conf \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c telegraf (\u0442\u0435\u0441\u0442 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 \u0434\u0430\u043d\u043d\u044b\u0445) \\ .\\telegraf.exe --config \"C:\\Telegraf\\telegraf_nt.conf\" --service install \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0441\u043b\u0443\u0436\u0431\u0443 \\ Get-Service telegraf | Start-Service \\ .\\telegraf.exe --service uninstall USE telegraf \\ SELECT usage_idle,usage_system,usage_user FROM cpu","title":"Telegraf"},{"location":"#elasticsearch","text":"Install-Module -Name Elastic.Console -AllowPrerelease github source \\ Get-Command -Module Elastic.Console \\ Get-ElasticsearchVersion \\ Set-ElasticsearchVersion 7.3.0 \\ Invoke-Elasticsearch REST API \u0437\u0430\u043f\u0440\u043e\u0441\u044b","title":"Elasticsearch"},{"location":"#cdata","text":"PowerShell Gallery CData \\ Automate Elasticsearch Integration Tasks from PowerShell Install-Module ElasticsearchCmdlets \u043f\u0430\u043a\u0435\u0442 \u0434\u0440\u0430\u0439\u0432\u0435\u0440\u0430 \u0432 psgallery \\ Import-Module ElasticsearchCmdlets \\ Get-Command -Module ElasticsearchCmdlets $elasticsearch = Connect-Elasticsearch -Server \"$Server\" -Port \"$Port\" -User \"$User\" -Password \"$Password\" $shipcity = \"New York\" $orders = Select-Elasticsearch -Connection $elasticsearch -Table \"Orders\" -Where \"ShipCity = `'$ShipCity`'\"` \u043f\u043e\u0438\u0441\u043a \u0438 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 $orders = Invoke-Elasticsearch -Connection $elasticsearch -Query 'SELECT * FROM Orders WHERE ShipCity = @ShipCity' -Params @{'@ShipCity'='New York'}` SQL \u0437\u0430\u043f\u0440\u043e\u0441\u044b","title":"CData"},{"location":"#adonet-assembly","text":"Install-Package CData.Elasticsearch \u043f\u0430\u043a\u0435\u0442 \u0434\u0440\u0430\u0439\u0432\u0435\u0440\u0430 \u0432 nuget \\ [Reflection.Assembly]::LoadFile(\"C:\\Program Files\\PackageManagement\\NuGet\\Packages\\CData.Elasticsearch.23.0.8565\\lib\\net40\\System.Data.CData.Elasticsearch.dll\") $connect = New-Object System.Data.CData.Elasticsearch.ElasticsearchConnection(\"Server=127.0.0.1;Port=9200;User=admin;Password=123456;\") $connect.Open() $sql = \"SELECT OrderName, Freight from Orders\" $da = New-Object System.Data.CData.Elasticsearch.ElasticsearchDataAdapter($sql, $conn) $dt = New-Object System.Data.DataTable $da.Fill($dt) $dt.Rows | foreach { Write-Host $_.ordername $_.freight }","title":"ADO.NET Assembly"},{"location":"#update_1","text":"Update-Elasticsearch -Connection $Elasticsearch -Columns @('OrderName','Freight') -Values @('MyOrderName', 'MyFreight') -Table Orders -Id \"MyId\" $cmd = New-Object System.Data.CData.Elasticsearch.ElasticsearchCommand(\"UPDATE Orders SET ShipCity='New York' WHERE Id = @myId\", $conn) $cmd.Parameters.Add(new System.Data.CData.Elasticsearch.ElasticsearchParameter(\"@myId\",\"10456255-0015501366\")) $cmd.ExecuteNonQuery()","title":"UPDATE"},{"location":"#insert_1","text":"Add-Elasticsearch -Connection $Elasticsearch -Table Orders -Columns @(\"OrderName\", \"Freight\") -Values @(\"MyOrderName\", \"MyFreight\") $cmd = New-Object System.Data.CData.Elasticsearch.ElasticsearchCommand(\"INSERT INTO Orders (ShipCity) VALUES (@myShipCity)\", $conn) $cmd.Parameters.Add(new System.Data.CData.Elasticsearch.ElasticsearchParameter(\"@myShipCity\",\"New York\")) $cmd.ExecuteNonQuery()","title":"INSERT"},{"location":"#delete_1","text":"Remove-Elasticsearch -Connection $Elasticsearch -Table \"Orders\" -Id \"MyId\" $cmd = New-Object System.Data.CData.Elasticsearch.ElasticsearchCommand(\"DELETE FROM Orders WHERE Id=@myId\", $conn) $cmd.Parameters.Add(new System.Data.CData.Elasticsearch.ElasticsearchParameter(\"@myId\",\"001d000000YBRseAAH\")) $cmd.ExecuteNonQuery()","title":"DELETE"},{"location":"#odbc","text":"Get-Command -Module Wdac \\ Get-OdbcDriver | ft \u0441\u043f\u0438\u0441\u043e\u043a \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044b\u0445 \u0434\u0440\u0430\u0439\u0432\u0435\u0440\u043e\u0432 Elasticsearch ODBC \u0434\u0440\u0430\u0439\u0432\u0435\u0440 \u0434\u043b\u044f \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043a \u0434\u0430\u043d\u043d\u044b\u043c Elasticsearch \u0438\u0437 Microsoft PowerShell $connectstring = \"DSN=Local Elasticsearch;\" $sql = \"SELECT * FROM library\" $conn = New-Object System.Data.Odbc.OdbcConnection($connectstring) $conn.open() $cmd = New-Object system.Data.Odbc.OdbcCommand($sql,$conn) $da = New-Object system.Data.Odbc.OdbcDataAdapter($cmd) $dt = New-Object system.Data.datatable $null = $da.fill($dt) $conn.close() $dt","title":"ODBC"},{"location":"#postgresql","text":"\u0421\u043a\u0430\u0447\u0430\u0442\u044c \u0438 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0434\u0440\u0430\u0439\u0432\u0435\u0440 $dbServer = \"192.168.3.101\" $port = \"5432\" $dbName = \"test\" $dbUser = \"admin\" $dbPass = \"admin\" $szConnect = \"Driver={PostgreSQL Unicode(x64)};Server=$dbServer;Port=$port;Database=$dbName;Uid=$dbUser;Pwd=$dbPass;\" $cnDB = New-Object System.Data.Odbc.OdbcConnection($szConnect) $dsDB = New-Object System.Data.DataSet try { $cnDB.Open() $adDB = New-Object System.Data.Odbc.OdbcDataAdapter $adDB.SelectCommand = New-Object System.Data.Odbc.OdbcCommand(\"SELECT id, name, age, login FROM public.users\" , $cnDB) $adDB.Fill($dsDB) $cnDB.Close() } catch [System.Data.Odbc.OdbcException] { $_.Exception $_.Exception.Message $_.Exception.ItemName } foreach ($row in $dsDB[0].Tables[0].Rows) { $row.login $row.age }","title":"PostgreSQL"},{"location":"#wmi","text":"","title":"WMI"},{"location":"#wmicim-windows-management-instrumentationcommon-information-model","text":"Get-WmiObjec -ComputerName localhost -Namespace root -class \"__NAMESPACE\" | select name,__namespace \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0434\u043e\u0447\u0435\u0440\u043d\u0438\u0438 Namespace (\u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0433\u0440\u0443\u043f\u043f\u044b) \\ Get-WmiObject -List \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u043a\u043b\u0430\u0441\u0441\u044b \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u0430 \u0438\u043c\u0435\u043d \"root\\cimv2\" (\u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e), \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430 (\u043e\u043f\u0438\u0441\u044b\u0432\u0430\u044e\u0442 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044e \u0438 \u0442\u0435\u043a\u0443\u0449\u0435\u0435 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u043c\u043e\u0433\u043e \u0440\u0435\u0441\u0443\u0440\u0441\u0430) \u0438 \u0438\u0445 \u043c\u0435\u0442\u043e\u0434\u044b (\u043a\u0430\u043a\u0438\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u043d\u0430\u0434 \u044d\u0442\u0438\u043c \u0440\u0435\u0441\u0443\u0440\u0441\u043e\u043c) \\ Get-WmiObject -List | Where-Object {$_.name -match \"video\"} \u043f\u043e\u0438\u0441\u043a \u043a\u043b\u0430\u0441\u0441\u0430 \u043f\u043e \u0438\u043c\u0435\u043d\u0438, \u0435\u0433\u043e \u0441\u0432\u043e\u0439\u0441\u0442\u0432 \u0438 \u043c\u0435\u0442\u043e\u0434\u043e\u0432 \\ Get-WmiObject -ComputerName localhost -Class Win32_VideoController \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u0441\u0432\u043e\u0439\u0441\u0442\u0432 \u043a\u043b\u0430\u0441\u0441\u0430 gwmi -List | where name -match \"service\" | ft -auto \u0435\u0441\u043b\u0438 \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0435 \u043f\u0440\u0438\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044e\u0442 Methods, \u0442\u043e \u043c\u043e\u0436\u043d\u043e \u0432\u0437\u0430\u0438\u043c\u043e\u0434\u0435\u0439\u0441\u0442\u0432\u043e\u0432\u0430\u0442\u044c {StartService, StopService} \\ gwmi -Class win32_service | select * \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u0441\u043b\u0443\u0436\u0431 \u0438 \u0432\u0441\u0435\u0445 \u0438\u0445 \u0441\u0432\u043e\u0439\u0441\u0442\u0432 \\ Get-CimInstance Win32_service \u043e\u0431\u0440\u0430\u0449\u0430\u0435\u0442\u0441\u044f \u043d\u0430 \u043f\u0440\u044f\u043c\u0443\u044e \u043a \"root\\cimv2\" \\ gwmi win32_service -Filter \"name='Zabbix Agent'\" \u043e\u0442\u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u044b\u0432\u043e\u0434 \u043f\u043e \u0438\u043c\u0435\u043d\u0438 \\ (gwmi win32_service -Filter \"name='Zabbix Agent'\").State \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0435 \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u043e \\ gwmi win32_service -Filter \"State = 'Running'\" \u043e\u0442\u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c \u0437\u0430\u043f\u0443\u0449\u0435\u043d\u043d\u044b\u0435 \u0441\u043b\u0443\u0436\u0431\u044b \\ gwmi win32_service -Filter \"StartMode = 'Auto'\" \u043e\u0442\u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u043b\u0443\u0436\u0431\u044b \u043f\u043e \u043c\u0435\u0442\u043e\u0434\u0443 \u0437\u0430\u043f\u0443\u0441\u043a\u0430 \\ gwmi -Query 'select * from win32_service where startmode=\"Auto\"' WQL-\u0437\u0430\u043f\u0440\u043e\u0441 (WMI Query Language) \\ gwmi win32_service | Get-Member -MemberType Method \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u043c\u0435\u0442\u043e\u0434\u044b \u0432\u0437\u0430\u0438\u043c\u043e\u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f \u0441 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u044f (Delete, StartService) \\ (gwmi win32_service -Filter 'name=\"Zabbix Agent\"').Delete() \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u043b\u0443\u0436\u0431\u0443 \\ (gwmi win32_service -Filter 'name=\"MSSQL$MSSQLE\"').StartService() \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0441\u043b\u0443\u0436\u0431\u0443 Get-CimInstance -ComputerName $srv Win32_OperatingSystem | select LastBootUpTime \u0432\u0440\u0435\u043c\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \\ gwmi -ComputerName $srv -Class Win32_OperatingSystem | select LocalDateTime,LastBootUpTime \u0442\u0435\u043a\u0443\u0449\u0435\u0435 \u0432\u0440\u0435\u043c\u044f \u0438 \u0432\u0440\u0435\u043c\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \\ gwmi Win32_OperatingSystem | Get-Member -MemberType Method \u043c\u0435\u0442\u043e\u0434\u044b reboot \u0438 shutdown \\ (gwmi Win32_OperatingSystem -EnableAllPrivileges).Reboot() \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0441 \u043a\u043b\u044e\u0447\u0435\u043c \u043f\u043e\u0432\u044b\u0448\u0435\u043d\u0438\u044f \u043f\u0440\u0438\u0432\u0435\u043b\u0435\u0433\u0438\u0439 \\ (gwmi Win32_OperatingSystem -EnableAllPrivileges).Win32Shutdown(0) \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u0435 \u0441\u0435\u0430\u043d\u0441\u0430 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f $system = Get-WmiObject -Class Win32_OperatingSystem $InstallDate = [Management.ManagementDateTimeconverter]::ToDateTime($system.installdate)` \u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u0434\u0430\u0442\u0443 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \u041e\u0421 $AfterInstallDays = ((Get-Date) \u2014 $Installdate).Days` \u0412\u044b\u0447\u0438\u0441\u043b\u044f\u0435\u043c \u0432\u0440\u0435\u043c\u044f, \u043f\u0440\u043e\u0448\u0435\u0434\u0448\u0435\u0435 \u0441 \u043c\u043e\u043c\u0435\u043d\u0442\u0430 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 $ShortInstallDate = \"{0:yyyy-MM-dd HH:MM}\" -f ($InstallDate) \"\u0421\u0438\u0441\u0442\u0435\u043c\u0430 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0430: $ShortInstallDate (\u041f\u0440\u043e\u0448\u043b\u043e $AfterInstalldays \u0434\u043d\u0435\u0439)\" (Get-WmiObject win32_battery).estimatedChargeRemaining \u0437\u0430\u0440\u044f\u0434 \u0431\u0430\u0442\u0430\u0440\u0435\u0438 \u0432 \u043f\u0440\u043e\u0446\u0435\u043d\u0442\u0430\u0445 \\ gwmi Win32_UserAccount \u0434\u043e\u043c\u0435\u043d\u043d\u044b\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438 \\ (gwmi Win32_SystemUsers).PartComponent \\ Get-CimInstance -ClassName Win32_LogonSession \\ Get-CimInstance -ClassName Win32_BIOS gwmi -list -Namespace root\\CIMV2\\Terminalservices \\ (gwmi -Class Win32_TerminalServiceSetting -Namespace root\\CIMV2\\TerminalServices).AllowTSConnections \\ (gwmi -Class Win32_TerminalServiceSetting -Namespace root\\CIMV2\\TerminalServices).SetAllowTSConnections(1) \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c RDP $srv = \"localhost\" gwmi Win32_logicalDisk -ComputerName $srv | where {$_.Size -ne $null} | select @{ Label=\"Value\"; Expression={$_.DeviceID}}, @{Label=\"AllSize\"; Expression={ [string]([int]($_.Size/1Gb))+\" GB\"}},@{Label=\"FreeSize\"; Expression={ [string]([int]($_.FreeSpace/1Gb))+\" GB\"}}, @{Label=\"Free%\"; Expression={ [string]([int]($_.FreeSpace/$_.Size*100))+\" %\"}}","title":"WMI/CIM (Windows Management Instrumentation/Common Information Model)"},{"location":"#nla-network-level-authentication","text":"(gwmi -class \"Win32_TSGeneralSetting\" -Namespace root\\cimv2\\Terminalservices -Filter \"TerminalName='RDP-tcp'\").UserAuthenticationRequired \\ (gwmi -class \"Win32_TSGeneralSetting\" -Namespace root\\cimv2\\Terminalservices -Filter \"TerminalName='RDP-tcp'\").SetUserAuthenticationRequired(1) \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c NLA \\ Get-ItemProperty -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp\" -Name SecurityLayer \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 (2) \\ Get-ItemProperty -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp\" -Name UserAuthentication \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 (1) \\ Set-ItemProperty -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp\" -Name SecurityLayer -Value 0 \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \\ Set-ItemProperty -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp\" -Name UserAuthentication -Value 0 \\ REG ADD HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\CredSSP\\Parameters /v AllowEncryptionOracle /t REG_DWORD /d 2 \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043d\u0430 \u043a\u043b\u0438\u0435\u043d\u0442\u0441\u043a\u043e\u043c \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0435 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0443 \u0432\u0435\u0440\u0441\u0438\u0438 CredSSP, \u0435\u0441\u043b\u0438 \u043d\u0430 \u0446\u0435\u043b\u0435\u0432\u043e\u043c \u043a\u043e\u043c\u044c\u044e\u0442\u0435\u0440\u0435-\u0441\u0435\u0440\u0432\u0435\u0440\u0435 \u043d\u0435 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u044b \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f KB4512509 \u043e\u0442 \u043c\u0430\u044f 2018 \u0433\u043e\u0434\u0430","title":"NLA (Network Level Authentication)"},{"location":"#regedit","text":"Get-PSDrive \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0445 \u0434\u0438\u0441\u043a\u043e\u0432/\u0440\u0430\u0437\u0434\u0435\u043b\u043e\u0432, \u0438\u0445 \u0440\u0430\u0437\u043c\u0435\u0440 \u0438 \u0432\u0435\u0442\u043e\u043a \u0440\u0435\u0435\u0441\u0442\u0440\u0430 \\ cd HKLM:\\ HKEY_LOCAL_MACHINE \\ cd HKCU:\\ HKEY_CURRENT_USER \\ Get-Item \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u043e \u0432\u0435\u0442\u043a\u0435 \u0440\u0435\u0435\u0441\u0442\u0440\u0430 \\ New-Item \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043d\u043e\u0432\u044b\u0439 \u0440\u0430\u0437\u0434\u0435\u043b \u0440\u0435\u0435\u0441\u0442\u0440\u0430 \\ Remove-Item \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u0435\u0442\u043a\u0443 \u0440\u0435\u0435\u0441\u0442\u0440\u0430 \\ Get-ItemProperty \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043a\u043b\u044e\u0447\u0435\u0439/\u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u043e\u0432 \u0440\u0435\u0435\u0441\u0442\u0440\u0430 (\u044d\u0442\u043e \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430 \u0432\u0435\u0442\u043a\u0438 \u0440\u0435\u0435\u0441\u0442\u0440\u0430, \u0430\u043d\u0430\u043b\u043e\u0433\u0438\u0447\u043d\u043e \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430\u043c \u0444\u0430\u0439\u043b\u0430) \\ Set-ItemProperty \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0438\u043b\u0438 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430 \u0440\u0435\u0435\u0441\u0442\u0440\u0430 \\ New-ItemProperty \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 \u0440\u0435\u0435\u0441\u0442\u0440\u0430 \\ Remove-ItemProperty \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 Get-ItemProperty HKLM:\\Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\* | Select DisplayName \u0441\u043f\u0438\u0441\u043e\u043a \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044b\u0445 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c \\ Get-Item HKCU:\\SOFTWARE\\Microsoft\\Office\\16.0\\Outlook\\Profiles\\Outlook\\9375CFF0413111d3B88A00104B2A6676\\00000002 \u043f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 Items \\ (Get-ItemProperty HKCU:\\SOFTWARE\\Microsoft\\Office\\16.0\\Outlook\\Profiles\\Outlook\\9375CFF0413111d3B88A00104B2A6676\\00000002).\"New Signature\" \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 (Value) \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430 (Property) Items \\ $reg_path = \"HKCU:\\SOFTWARE\\Microsoft\\Office\\16.0\\Outlook\\Profiles\\Outlook\\9375CFF0413111d3B88A00104B2A6676\\00000002\" \\ $sig_name = \"auto\" \\ Set-ItemProperty -Path $reg_path -Name \"New Signature\" -Value $sig_name \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0438\u043b\u0438 \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043a\u043e\u0440\u043d\u0435 \u0432\u0435\u0442\u043a\u0438 (Path) \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u043e (Name) \u0441\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435\u043c (Value) \\ Set-ItemProperty -Path $reg_path -Name \"Reply-Forward Signature\" -Value $sig_name Windows Registry Editor Version 5.00 [HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\taskmgr.exe] \"Debugger\"=\"\\\"C:\\\\Windows\\\\System32\\\\Taskmgr.exe\\\"\"","title":"Regedit"},{"location":"#performance","text":"lodctr /R \u043f\u0435\u0440\u0435\u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0441\u0447\u0435\u0442\u0447\u0438\u043a\u043e\u0432 \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u0438 \u0438\u0437 \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u043e\u0433\u043e \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0430 \u0430\u0440\u0445\u0438\u0432\u043e\u0432 (\u0442\u0430\u043a \u0436\u0435 \u0438\u0441\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u0441\u0447\u0435\u0442\u0447\u0438\u043a\u0438 \u0434\u043b\u044f CIM, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0434\u043b\u044f cpu Win32_PerfFormattedData_PerfOS_Processor \u0438 iops Win32_PerfFormattedData_PerfDisk_PhysicalDisk) \\ (Get-Counter -ListSet *).CounterSetName \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0445 \u0441\u0447\u0435\u0442\u0447\u0438\u043a\u043e\u0432 \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u0438 \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435 \\ (Get-Counter -ListSet *memory*).Counter \u043f\u043e\u0438\u0441\u043a \u043f\u043e wildcard-\u0438\u043c\u0435\u043d\u0438 \u0432\u043e \u0432\u0441\u0435\u0445 \u0441\u0447\u0435\u0442\u0447\u0438\u043a\u0430\u0445 (\u0432\u043a\u043b\u044e\u0447\u0430\u044f \u0434\u043e\u0447\u0435\u0440\u043d\u0438\u0438) \\ Get-Counter \"\\Memory\\Available MBytes\" \u043e\u0431\u044a\u0435\u043c \u0441\u0432\u043e\u0431\u043e\u0434\u043d\u043e\u0439 \u043e\u043f\u0435\u0440\u0430\u0442\u0438\u0432\u043d\u043e\u0439 \u043f\u0430\u043c\u044f\u0442\u0438 \\ Get-Counter -cn $srv \"\\LogicalDisk(*)\\% Free Space\" % \u0441\u0432\u043e\u0431\u043e\u0434\u043d\u043e\u0433\u043e \u043c\u0435\u0441\u0442\u0430 \u043d\u0430 \u0432\u0441\u0435\u0445 \u0440\u0430\u0437\u0434\u0435\u043b\u0430\u0445 \u0434\u0438\u0441\u043a\u043e\u0432 \\ (Get-Counter \"\\Process(*)\\ID Process\").CounterSamples \\ Get-Counter \"\\Processor(_Total)\\% Processor Time\" \u2013ComputerName $srv -MaxSamples 5 -SampleInterval 2 5 \u043f\u0440\u043e\u0432\u0435\u0440\u043e\u043a \u043a\u0430\u0436\u0434\u044b\u0435 2 \u0441\u0435\u043a\u0443\u043d\u0434\u044b \\ Get-Counter \"\\\u041f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u0440(_Total)\\% \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d\u043d\u043e\u0441\u0442\u0438 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u0440\u0430\" -Continuous \u043d\u0435\u043f\u0440\u0435\u0440\u044b\u0432\u043d\u043e \\ (Get-Counter \"\\\u041f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u0440(*)\\% \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d\u043d\u043e\u0441\u0442\u0438 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u0440\u0430\").CounterSamples (Get-Counter -ListSet *\u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441*).Counter \u043d\u0430\u0439\u0442\u0438 \u0432\u0441\u0435 \u0441\u0447\u0435\u0442\u0447\u0438\u043a\u0438 \\ Get-Counter \"\\\u0421\u0435\u0442\u0435\u0432\u043e\u0439 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441(*)\\\u0412\u0441\u0435\u0433\u043e \u0431\u0430\u0439\u0442/\u0441\" \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u0430\u0434\u0430\u043f\u0442\u0435\u0440\u044b (\u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0434\u0435\u0439\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0439 \u043f\u043e \u0442\u0440\u0430\u0444\u0438\u043a\u0443) $WARNING = 25 $CRITICAL = 50 $TransferRate = ((Get-Counter \"\\\\huawei-mb-x-pro\\\u0441\u0435\u0442\u0435\u0432\u043e\u0439 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441(intel[r] wi-fi 6e ax211 160mhz)\\\u0432\u0441\u0435\u0433\u043e \u0431\u0430\u0439\u0442/\u0441\" ).countersamples | select -ExpandProperty CookedValue)*8 $NetworkUtilisation = [math]::round($TransferRate/1000000000*100,2) if ($NetworkUtilisation -gt $CRITICAL){ Write-Output \"CRITICAL: $($NetworkUtilisation) % Network utilisation, $($TransferRate.ToString('N0')) b/s\" #exit 2 } if ($NetworkUtilisation -gt $WARNING){ Write-Output \"WARNING: $($NetworkUtilisation) % Network utilisation, $($TransferRate.ToString('N0')) b/s\" #exit 1 } Write-Output \"OK: $($NetworkUtilisation) % Network utilisation, $($TransferRate.ToString('N0')) b/s\" #exit 0","title":"Performance"},{"location":"#snmp","text":"","title":"SNMP"},{"location":"#setup-snmp-service","text":"Install-WindowsFeature SNMP-Service,SNMP-WMI-Provider -IncludeManagementTools \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0440\u043e\u043b\u044c SNMP \u0438 WMI \u043f\u0440\u043e\u0432\u0430\u0439\u0434\u0435\u0440 \u0447\u0435\u0440\u0435\u0437 Server Manager \\ Get-WindowsFeature SNMP* \\ Add-WindowsCapability -Online -Name SNMP.Client~~~~0.0.1.0 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442 Feature On Demand \u0434\u043b\u044f Windows 10/11 \\ Get-Service SNMP \\ Get-NetFirewallrule -DisplayName snmp | ft \\ Get-NetFirewallrule -DisplayName snmp* | Enable-NetFirewallRule`","title":"Setup SNMP Service"},{"location":"#setting-snmp-service-via-regedit","text":"Agent: \\ New-ItemProperty -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\services\\SNMP\\Parameters\\RFC1156Agent\" -Name \"sysContact\" -Value \"lifailon-user\" \u0441\u043e\u0437\u0434\u0430\u0442\u044c (New) \u0438\u043b\u0438 \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c (Set) \\ New-ItemProperty -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\services\\SNMP\\Parameters\\RFC1156Agent\" -Name \"sysLocation\" -Value \"plex-server\" Security: \\ New-Item -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\services\\SNMP\\Parameters\\TrapConfiguration\\public\" \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043d\u043e\u0432\u044b\u0439 community string \\ New-ItemProperty -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\Services\\SNMP\\Parameters\\ValidCommunities\" -Name \"public\" -Value 16 \u043d\u0430\u0437\u043d\u0430\u0447\u0438\u0442\u044c \u043f\u0440\u0430\u0432\u0430 \u043d\u0430 public \\ 1 \u2014 NONE \\ 2 \u2014 NOTIFY \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u044c SNMP \u043b\u043e\u0432\u0443\u0448\u043a\u0438 \\ 4 \u2014 READ ONLY \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0441 \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0430 \\ 8 \u2014 READ WRITE \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0438 \u0438\u0437\u043c\u0435\u043d\u044f\u0442\u044c \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044e \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0430 \\ 16 \u2014 READ CREATE \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0447\u0438\u0442\u0430\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435, \u0438\u0437\u043c\u0435\u043d\u044f\u0442\u044c \u0438 \u0441\u043e\u0437\u0434\u0430\u0432\u0430\u0442\u044c \u043e\u0431\u044a\u0435\u043a\u0442\u044b \\ New-ItemProperty -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\Services\\SNMP\\Parameters\\PermittedManagers\" -Name \"1\" -Value \"192.168.3.99\" \u043e\u0442 \u043a\u043e\u0433\u043e \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u043e \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0442\u044c \u0437\u0430\u043f\u0440\u043e\u0441\u044b \\ Get-Service SNMP | Restart-Service","title":"Setting SNMP Service via Regedit"},{"location":"#snmpwalk","text":"snmpwalk -v 2c -c public 192.168.3.100 \\ snmpwalk -v 2c -c public -O e 192.168.3.100","title":"snmpwalk"},{"location":"#snmp-modules","text":"Install-Module -Name SNMP \\ Get-SnmpData -IP 192.168.3.100 -OID 1.3.6.1.2.1.1.4.0 -UDPport 161 -Community public \\ (Get-SnmpData -IP 192.168.3.100 -OID 1.3.6.1.2.1.1.4.0).Data \\ Invoke-SnmpWalk -IP 192.168.3.100 -OID 1.3.6.1.2.1.1 \u043f\u0440\u043e\u0439\u0442\u0438\u0441\u044c \u043f\u043e \u0434\u0435\u0440\u0435\u0432\u0443 OID \\ Invoke-SnmpWalk -IP 192.168.3.100 -OID 1.3.6.1.2.1.25.6.3.1.2 \u0441\u043f\u0438\u0441\u043e\u043a \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u043e\u0433\u043e \u041f\u041e \\ Invoke-SnmpWalk -IP 192.168.3.100 -OID 1.3.6.1.2.1.25.2.3.1 \u0441\u043f\u0438\u0441\u043e\u043a \u0440\u0430\u0437\u0434\u0435\u043b\u043e\u0432 \u0438 \u043f\u0430\u043c\u044f\u0442\u0438 (C: D: Virtual Memory \u0438 Physical Memory) \\ Set-SnmpData \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 \u043d\u0430 \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u043e\u043c \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0435 Install-Module -Name SNMPv3 \\ Invoke-SNMPv3Get \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 \u043f\u043e \u043e\u0434\u043d\u043e\u043c\u0443 OID \\ Invoke-SNMPv3Set \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 \\ Invoke-SNMPv3Walk \u043e\u0431\u0445\u043e\u0434 \u043f\u043e \u0434\u0435\u0440\u0435\u0432\u0443 OID \\ Invoke-SNMPv3Walk -UserName lifailon -Target 192.168.3.100 -AuthSecret password -PrivSecret password -OID 1.3.6.1.2.1.1 -AuthType MD5 -PrivType AES128","title":"SNMP Modules"},{"location":"#lextmsharpsnmplib","text":"\u0421\u0438\u043d\u0442\u0430\u043a\u0441\u0438\u0441 \\ Download lib Add-Type -LiteralPath \"$home\\Desktop\\lextm.sharpsnmplib-12.5.2\\net471\\SharpSnmpLib.dll\" $port = 161 $OID = \"1.3.6.1.2.1.1.4.0\" $variableList = New-Object Collections.Generic.List[Lextm.SharpSnmpLib.Variable] $variableList.Add([Lextm.SharpSnmpLib.Variable]::new([Lextm.SharpSnmpLib.ObjectIdentifier]::new($OID))) $timeout = 3000 [Net.IPAddress]$ip = \"192.168.3.100\" $endpoint = New-Object Net.IpEndPoint $ip, $port $Community = \"public\" [Lextm.SharpSnmpLib.VersionCode]$Version = \"V2\" $message = [Lextm.SharpSnmpLib.Messaging.Messenger]::Get( $Version, $endpoint, $Community, $variableList, $TimeOut ) $message.Data.ToString()","title":"Lextm.SharpSnmpLib"},{"location":"#walk","text":"[Lextm.SharpSnmpLib.ObjectIdentifier]$OID = \"1.3.6.1.2.1.1\" # \u0434\u0435\u0440\u0435\u0432\u043e \u0438\u043b\u0438 \u043a\u043e\u043d\u0435\u0447\u043d\u044b\u0439 OID $WalkMode = [Lextm.SharpSnmpLib.Messaging.WalkMode]::WithinSubtree # \u0440\u0435\u0436\u0438\u043c \u043e\u0431\u0445\u043e\u0434\u0430 \u043f\u043e \u0434\u0435\u0440\u0435\u0432\u0443 $results = New-Object Collections.Generic.List[Lextm.SharpSnmpLib.Variable] $message = [Lextm.SharpSnmpLib.Messaging.Messenger]::Walk( $Version, $endpoint, $Community, $OID, $results, $TimeOut, $WalkMode ) $results $results2 = @() foreach ($d in $results) { $results2 +=[PSCustomObject]@{'ID'=$d.id.ToString();'Data'=$d.Data.ToString()} # \u043f\u0435\u0440\u0435\u043a\u043e\u0434\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u044b\u0432\u043e\u0434 \u043f\u043e\u0441\u0442\u0440\u043e\u0447\u043d\u043e \u0432 \u0441\u0442\u0440\u043e\u043a\u0443 } $results2","title":"Walk"},{"location":"#zabbix","text":"","title":"Zabbix"},{"location":"#zabbix-agent-deploy","text":"$url = \"https://cdn.zabbix.com/zabbix/binaries/stable/6.4/6.4.5/zabbix_agent2-6.4.5-windows-amd64-static.zip\" $path = \"$home\\Downloads\\zabbix-agent2-6.4.5.zip\" $WebClient = New-Object System.Net.WebClient $WebClient.DownloadFile($url, $path)` \u0441\u043a\u0430\u0447\u0430\u0442\u044c \u0444\u0430\u0439\u043b Expand-Archive $path -DestinationPath \"C:\\zabbix-agent2-6.4.5\\\"` \u0440\u0430\u0437\u0430\u0440\u0445\u0438\u0432\u0438\u0440\u043e\u0432\u0430\u0442\u044c Remove-Item $path` \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0430\u0440\u0445\u0438\u0432 New-NetFirewallRule -DisplayName \"Zabbix-Agent\" -Profile Any -Direction Inbound -Action Allow -Protocol TCP -LocalPort 10050,10051` \u043e\u0442\u043a\u0440\u044b\u0442\u044c \u043f\u043e\u0440\u0442\u044b \u0432 FW $Zabbix_Server = \"192.168.3.102\" $conf = \"C:\\zabbix-agent2-6.4.5\\conf\\zabbix_agent2.conf\" $cat = cat $conf $rep = $cat -replace \"Server=.+\",\"Server=$Zabbix_Server\" $rep | Select-String Server= $rep > $conf $exe = \"C:\\zabbix-agent2-6.4.5\\bin\\zabbix_agent2.exe\" .$exe --config $conf --install` \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0441\u043b\u0443\u0436\u0431\u0443 Get-Service *Zabbix*Agent* | Start-Service` \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0441\u043b\u0443\u0436\u0431\u0443 #.$exe --config $conf --uninstall` \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u043b\u0443\u0436\u0431\u0443","title":"Zabbix Agent Deploy"},{"location":"#zabbix_sender","text":"\u0421\u043e\u0437\u0434\u0430\u0442\u044c host - \u0437\u0430\u0434\u0430\u0442\u044c \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u043b\u044c\u043d\u043e\u0435 \u0438\u043c\u044f (powershell-host) \u0438 \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u0433\u0440\u0443\u043f\u043f\u0443 \\ \u0421\u043e\u0437\u0434\u0430\u0442\u044c Items: \\ Name: Service Count \\ Type: Zabbix trapper \\ Key: service.count \\ Type of Information: Numeric $path = \"C:\\zabbix-agent2-6.4.5\\bin\" $scount = (Get-Service).Count .$path\\zabbix_sender.exe -z 192.168.3.102 -s \"powershell-host\" -k service.count -o $scount","title":"zabbix_sender"},{"location":"#zabbix_get","text":"apt install zabbix-get \\ nano /etc/zabbix/zabbix_agentd.conf \\ Server=127.0.0.1,192.168.3.102,192.168.3.99 \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u0434\u043b\u044f \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u0434\u0430\u043d\u043d\u044b\u0445 zabbix_get \u0441 \u0430\u0433\u0435\u043d\u0442\u0430 (\u043a\u0430\u043a \u0438\u0445 \u0437\u0430\u043f\u0440\u0430\u0448\u0438\u0432\u0430\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\u0440) .$path\\zabbix_get -s 192.168.3.101 -p 10050 -k agent.version \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0432\u0435\u0440\u0441\u0438\u044e \u0430\u0433\u0435\u043d\u0442\u0430 \\ .$path\\zabbix_get -s 192.168.3.101 -p 10050 -k agent.ping 1 - ok \\ .$path\\zabbix_get -s 192.168.3.101 -p 10050 -k net.if.discovery \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u0435\u0442\u0435\u0432\u044b\u0445 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u043e\u0432 \\ .$path\\zabbix_get -s 192.168.3.101 -p 10050 -k net.if.in[\"ens33\"] \\ .$path\\zabbix_get -s 192.168.3.101 -p 10050 -k net.if.out[\"ens33\"]","title":"zabbix_get"},{"location":"#userparameter","text":"UserParameter=process.count,powershell -Command \"(Get-Process).Count\" \\ UserParameter=process.vm[*],powershell -Command \"(Get-Process $1).ws\" Test: \\ C:\\zabbix-agent2-6.4.5\\bin\\zabbix_get.exe -s 127.0.0.1 -p 10050 -k process.count \\ C:\\zabbix-agent2-6.4.5\\bin\\zabbix_get.exe -s 127.0.0.1 -p 10050 -k process.vm[zabbix_agent2] \\ C:\\zabbix-agent2-6.4.5\\bin\\zabbix_get.exe -s 127.0.0.1 -p 10050 -k process.vm[powershell] \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043d\u043e\u0432\u044b\u0435 Items: \\ key: process.count \\ key: process.vm[zabbix_agent2]","title":"UserParameter"},{"location":"#include","text":"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 Include \u0434\u043b\u044f \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0445 \u0444\u0430\u0439\u043b\u043e\u0432 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0430\u0435\u043c\u044b\u0445 \u043f\u043b\u0430\u0433\u0438\u043d\u043e\u0432 'Include=.\\zabbix_agent2.d\\plugins.d\\*.conf' >> C:\\zabbix-agent2-6.4.5\\conf\\zabbix_agent2.conf \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0439 \u0444\u0430\u0439\u043b \u0441 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u0441\u043a\u0438\u043c\u0438 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u043c\u0438 \u0432 \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0435, \u043f\u0443\u0442\u044c \u043a \u043a\u043e\u0442\u043e\u0440\u043e\u043c\u0443 \u0443\u043a\u0430\u0437\u0430\u043d \u0432 zabbix_agentd.conf \\ 'UserParameter=Get-Query-Param[*],powershell.exe -noprofile -executionpolicy bypass -File C:\\zabbix-agent2-6.4.5\\conf\\zabbix_agent2.d\\scripts\\User-Sessions\\Get-Query-Param.ps1 $1' > C:\\zabbix-agent2-6.4.5\\conf\\zabbix_agent2.d\\plugins.d\\User-Sessions.conf \u041f\u043e\u043c\u0435\u0441\u0442\u0438\u0442\u044c \u0441\u043a\u0440\u0438\u043f\u0442 Get-Query-Param.ps1 \u0432 \u043a\u0430\u0442\u0430\u043b\u043e\u0433, \u043f\u0443\u0442\u044c \u043a \u043a\u043e\u0442\u043e\u0440\u043e\u043c\u0443 \u0443\u043a\u0430\u0437\u0430\u043d \u0432 User-Sessions.conf. \u0421\u043a\u0440\u0438\u043f\u0442 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u0441\u043a\u0438\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043e\u043d \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0435\u0442 \u043e\u0442 Zabbix \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u0434\u043b\u044f \u043f\u0435\u0440\u0435\u0434\u0430\u0447\u0438 \u0438\u0445 \u0432 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 \u0441\u043a\u0440\u0438\u043f\u0442\u0430. Param([string]$select) if ($select -eq \"ACTIVEUSER\") { (Get-Query | where status -match \"Active\").User } if ($select -eq \"INACTIVEUSER\") { (Get-Query | where status -match \"Disconnect\").User } if ($select -eq \"ACTIVECOUNT\") { (Get-Query | where status -match \"Active\").Status.Count } if ($select -eq \"INACTIVECOUNT\") { (Get-Query | where status -match \"Disconnect\").Status.Count } \u041f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0440\u0430\u0431\u043e\u0442\u0443 \u0441\u043a\u0440\u0438\u043f\u0442\u0430: $path = \"C:\\zabbix-agent2-6.4.5\\conf\\zabbix_agent2.d\\scripts\\User-Sessions\" \\ .$path\\Get-Query-Param.ps1 ACTIVEUSER \\ .$path\\Get-Query-Param.ps1 INACTIVEUSER \\ .$path\\Get-Query-Param.ps1 ACTIVECOUNT \\ .$path\\Get-Query-Param.ps1 INACTIVECOUNT \u0421\u043e\u0437\u0434\u0430\u0442\u044c Items \u0441 \u043a\u043b\u044e\u0447\u0430\u043c\u0438: Get-Query-Param[ACTIVEUSER] Type: Text \\ Get-Query-Param[INACTIVEUSER] Type: Text \\ Get-Query-Param[ACTIVECOUNT] Type: Int \\ Get-Query-Param[INACTIVECOUNT] Type: Int \u041c\u0430\u043a\u0440\u043e\u0441\u044b: {$ACTIVEMAX} = 16 \\ {$ACTIVEMIN} = 0 \u0422\u0440\u0438\u0433\u0433\u0435\u0440\u044b: last(/Windows-User-Sessions/Get-Query-Param[ACTIVECOUNT])>{$ACTIVEMAX} \\ min(/Windows-User-Sessions/Get-Query-Param[ACTIVECOUNT],24h)={$ACTIVEMIN}","title":"Include"},{"location":"#zabbix_agent2conf","text":"# \u0410\u0433\u0435\u043d\u0442 \u043c\u043e\u0436\u0435\u0442 \u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c \u0432 \u043f\u0430\u0441\u0441\u0438\u0432\u043d\u043e\u043c (\u0441\u0435\u0440\u0432\u0435\u0440 \u0437\u0430\u0431\u0438\u0440\u0430\u0435\u0442 \u0441\u0430\u043c \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e) \u0438 \u0430\u043a\u0442\u0438\u0432\u043d\u043e\u043c \u0440\u0435\u0436\u0438\u043c\u0435 (\u0430\u0433\u0435\u043d\u0442 \u0441\u0430\u043c \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442): Server=192.168.3.102 ServerActive=192.168.3.102 # \u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0443\u043a\u0430\u0437\u0430\u0442\u044c hostname \u0434\u043b\u044f ServerActive: Hostname=huawei-book-01 # \u0415\u0441\u043b\u0438 \u043d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043e, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0434\u043b\u044f \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u0438 \u0438\u043c\u0435\u043d\u0438 \u0445\u043e\u0441\u0442\u0430 (\u0438\u0433\u043d\u043e\u0440\u0438\u0440\u0443\u0435\u0442\u0441\u044f, \u0435\u0441\u043b\u0438 \u0438\u043c\u044f \u0445\u043e\u0441\u0442\u0430 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043e): # HostnameItem=system.hostname # \u041a\u0430\u043a \u0447\u0430\u0441\u0442\u043e \u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0441\u043f\u0438\u0441\u043e\u043a \u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0445 \u043f\u0440\u043e\u0432\u0435\u0440\u043e\u043a, \u0432 \u0441\u0435\u043a\u0443\u043d\u0434\u0430\u0445 (Range: 60-3600): RefreshActiveChecks=120 # IP-\u0430\u0434\u0440\u0435\u0441 \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u0430 \u0434\u043b\u044f \u0438\u0441\u0445\u043e\u0434\u044f\u0449\u0438\u0445 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0439: # SourceIP= # \u0410\u0433\u0435\u043d\u0442 \u0431\u0443\u0434\u0435\u0442 \u0441\u043b\u0443\u0448\u0430\u0442\u044c \u043d\u0430 \u044d\u0442\u043e\u043c \u043f\u043e\u0440\u0442\u0443 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u043c (Range: 1024-32767): # ListenPort=10050 # \u0421\u043f\u0438\u0441\u043e\u043a IP-\u0430\u0434\u0440\u0435\u0441\u043e\u0432, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0430\u0433\u0435\u043d\u0442 \u0434\u043e\u043b\u0436\u0435\u043d \u043f\u0440\u043e\u0441\u043b\u0443\u0448\u0438\u0432\u0430\u0442\u044c \u0447\u0435\u0440\u0435\u0437 \u0437\u0430\u043f\u044f\u0442\u0443\u044e # ListenIP=0.0.0.0 # \u0410\u0433\u0435\u043d\u0442 \u0431\u0443\u0434\u0435\u0442 \u043f\u0440\u043e\u0441\u043b\u0443\u0448\u0438\u0432\u0430\u0442\u044c \u044d\u0442\u043e\u0442 \u043f\u043e\u0440\u0442 \u0434\u043b\u044f \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 \u0441\u0442\u0430\u0442\u0443\u0441\u0430 HTTP (Range: 1024-32767): # StatusPort= ControlSocket=\\\\.\\pipe\\agent.sock # \u041a\u0443\u0434\u0430 \u0432\u0435\u0441\u0442\u0438 \u0436\u0443\u0440\u043d\u0430\u043b (file/syslog/console): LogType=file LogFile=C:\\zabbix-agent2-6.4.5\\zabbix_agent2.log # \u0420\u0430\u0437\u043c\u0435\u0440 \u043b\u043e\u0433\u0430 \u043e\u0442 0-1024 MB (0 - \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u0440\u043e\u0442\u0430\u0446\u0438\u044e \u043b\u043e\u0433\u043e\u0432) LogFileSize=100 # \u0423\u0440\u043e\u0432\u0435\u043d\u044c \u043b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f. 4 - \u0434\u043b\u044f \u043e\u0442\u043b\u0430\u0434\u043a\u0438 (\u0432\u044b\u0434\u0430\u0435\u0442 \u043c\u043d\u043e\u0433\u043e \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438) DebugLevel=4","title":"zabbix_agent2.conf"},{"location":"#api-token","text":"Documentation $ip = \"192.168.3.102\" \\ $url = \"http://$ip/zabbix/api_jsonrpc.php\" $data = @{ \"jsonrpc\"=\"2.0\"; \"method\"=\"user.login\"; \"params\"=@{ \"username\"=\"Admin\";` \u0432 \u0432\u0435\u0440\u0441\u0438\u0438 \u0434\u043e 6.4 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 \"user\" \"password\"=\"zabbix\"; }; \"id\"=1; } $token = (Invoke-RestMethod -Method POST -Uri $url -Body ($data | ConvertTo-Json) -ContentType \"application/json\").Result $token = \"2eefd25fdf1590ebcdb7978b5bcea1fff755c65b255da8cbd723181b639bb789\" \u0441\u0433\u0435\u043d\u0435\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0442\u043e\u043a\u0435\u043d \u0432 UI (http://192.168.3.102/zabbix/zabbix.php?action=token.list)","title":"API Token"},{"location":"#userget","text":"$data = @{ \"jsonrpc\"=\"2.0\"; \"method\"=\"user.get\"; \"params\"=@{ }; \"auth\"=$token; \"id\"=1; } $users = (Invoke-RestMethod -Method POST -Uri $url -Body ($data | ConvertTo-Json) -ContentType \"application/json\").Result","title":"user.get"},{"location":"#problemget","text":"$data = @{ \"jsonrpc\"=\"2.0\"; \"method\"=\"problem.get\"; \"params\"=@{ }; \"auth\"=$token; \"id\"=1; } (Invoke-RestMethod -Method POST -Uri $url -Body ($data | ConvertTo-Json) -ContentType \"application/json\").Result","title":"problem.get"},{"location":"#hostget","text":"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u0445\u043e\u0441\u0442\u043e\u0432 (\u0438\u043c\u044f \u0438 id) Endpoint host host.create - creating new hosts \\ host.delete - deleting hosts \\ host.get - retrieving hosts \\ host.massadd - adding related objects to hosts \\ host.massremove - removing related objects from hosts \\ host.massupdate - replacing or removing related objects from hosts \\ host.update - updating hosts $data = @{ \"jsonrpc\"=\"2.0\"; \"method\"=\"host.get\"; \"params\"=@{ \"output\"=@(` \u043e\u0442\u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u044b\u0432\u043e\u0434 \"hostid\"; \"host\"; ); }; \"id\"=2; \"auth\"=$token; } $hosts = (Invoke-RestMethod -Method POST -Uri $url -Body ($data | ConvertTo-Json) -ContentType \"application/json\").Result $host_id = $hosts[3].hostid` \u0437\u0430\u0431\u0440\u0430\u0442\u044c id \u0445\u043e\u0441\u0442\u0430 \u043f\u043e \u0438\u043d\u0434\u0435\u043a\u0441\u0443","title":"host.get"},{"location":"#itemget","text":"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c id \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432 \u0434\u0430\u043d\u043d\u044b\u0445 \u043f\u043e \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u044e \u043a\u043b\u044e\u0447\u0430 \u0434\u043b\u044f \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0433\u043e \u0445\u043e\u0441\u0442\u0430 $data = @{ \"jsonrpc\"=\"2.0\"; \"method\"=\"item.get\"; \"params\"=@{ \"hostids\"=@($host_id);` \u043e\u0442\u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u043e \u0445\u043e\u0441\u0442\u0443 }; \"auth\"=$token; \"id\"=1; } $items = (Invoke-RestMethod -Method POST -Uri $url -Body ($data | ConvertTo-Json) -ContentType \"application/json\").Result $items_id = ($items | where key_ -match system.uptime).itemid` \u0437\u0430\u0431\u0440\u0430\u0442\u044c id \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430 \u0434\u0430\u043d\u043d\u044b\u0445","title":"item.get"},{"location":"#historyget","text":"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0432\u0441\u044e \u0438\u0441\u0442\u043e\u0440\u0438\u044e \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 \u043f\u043e \u0435\u0433\u043e id $data = @{ \"jsonrpc\"=\"2.0\"; \"method\"=\"history.get\"; \"params\"=@{ \"hostids\"=@($host_id); ` \u0444\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u044f \u043f\u043e \u0445\u043e\u0441\u0442\u0443 \"itemids\"=@($items_id);` \u0444\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u044f \u043f\u043e \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0443 \u0434\u0430\u043d\u043d\u044b\u0445 }; \"auth\"=$token; \"id\"=1; } $items_data_uptime = (Invoke-RestMethod -Method POST -Uri $url -Body ($data | ConvertTo-Json) -ContentType \"application/json\").Result` \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0432\u0441\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u043f\u043e \u043a\u043b\u044e\u0447\u0443 \u0443 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0433\u043e \u0445\u043e\u0441\u0442\u0430","title":"history.get"},{"location":"#convert-secconds-to-timespan-and-datetime","text":"$sec = $items_data_uptime.value function ConvertSecondsTo-TimeSpan { param ( $insec ) $TimeSpan = [TimeSpan]::fromseconds($insec) \"{0:dd' day 'hh\\:mm\\:ss}\" -f $TimeSpan } $UpTime = ConvertSecondsTo-TimeSpan $sec[-1]","title":"Convert Secconds To TimeSpan and DateTime"},{"location":"#convert-from-unix-time","text":"$time = $items_data_uptime.clock function ConvertFrom-UnixTime { param ( $intime ) $EpochTime = [DateTime]\"1/1/1970\" $TimeZone = Get-TimeZone $UTCTime = $EpochTime.AddSeconds($intime) $UTCTime.AddMinutes($TimeZone.BaseUtcOffset.TotalMinutes) } $GetDataTime = ConvertFrom-UnixTime $time[-1] ($hosts | where hostid -eq $host_id).host \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0438\u043c\u044f \u0445\u043e\u0441\u0442\u0430 \\ $UpTime \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0435 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0440\u0430\u0431\u043e\u0442\u044b \u0445\u043e\u0441\u0442\u0430 \\ $GetDataTime \u0432\u0440\u0435\u043c\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u043d\u043e\u0433\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f","title":"Convert From Unix Time"},{"location":"#pki","text":"New-SelfSignedCertificate -CertStoreLocation Cert:\\LocalMachine\\My -DnsName \"$env:computername\" -FriendlyName \"Test Certificate\" -NotAfter (Get-Date).AddYears(5) \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0441\u0430\u043c\u043e\u043f\u043e\u0434\u043f\u0438\u0441\u0430\u043d\u043d\u044b\u0439 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 (\u0432 LocalMachine\\My - \u0421\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u044b \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0430\\\u041b\u0438\u0447\u043d\u043e\u0435) \u0441 \u0441\u0440\u043e\u043a\u043e\u043c \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f 5 \u043b\u0435\u0442 Get-ChildItem -Path Cert:\\CurrentUser\\Root\\ \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044b\u0445 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432 \u0432 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435 \u0414\u043e\u0432\u0435\u0440\u0435\u043d\u043d\u044b\u0435 \u043a\u043e\u0440\u043d\u0435\u0432\u044b\u0435 \u0426\u0421 \u0422\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \\ Get-ChildItem -Path Cert:\\CurrentUser\\My\\ \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u0430\u043c\u043e\u0437\u0430\u0432\u0435\u0440\u044f\u044e\u0449\u0438\u0445 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432 \u0432 \u041b\u0438\u0447\u043d\u043e\u0435 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435 \u0422\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \\ Get-ChildItem -Path Cert:\\LocalMachine\\My\\ \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u0430\u043c\u043e\u0437\u0430\u0432\u0435\u0440\u044f\u044e\u0449\u0438\u0445 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432 \u0432 \u041b\u0438\u0447\u043d\u043e\u0435 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435 \u041b\u043e\u043a\u0430\u043b\u044c\u043d\u043e\u0433\u043e \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0430 \\ Get-ChildItem -Path Cert:\\LocalMachine\\My\\ | select NotBefore,NotAfter,Thumbprint,Subject \u0441\u0440\u043e\u043a \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u0430 \\ Get-ChildItem -Path Cert:\\LocalMachine\\My\\ | where Thumbprint -eq D9356FB774EE0E6206B7D5B59B99102CA5B17BDA \u043f\u043e\u0438\u0441\u043a \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 \u043f\u043e \u043e\u0442\u043f\u0435\u0447\u0430\u0442\u043a\u0443 Get-ChildItem -Path $env:APPDATA\\Microsoft\\SystemCertificates\\My\\Certificates\\ \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u044b \u0432 \u0444\u0430\u0439\u043b\u043e\u0432\u043e\u0439 \u0441\u0438\u0441\u0442\u0435\u043c\u0435, \u043a\u0430\u0436\u0434\u044b\u0439 \u0444\u0430\u0439\u043b \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u0443, \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u043e\u043c\u0443 \u0432 \u043b\u0438\u0447\u043d\u043e\u043c \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \\ Get-ChildItem -Path $env:APPDATA\\Microsoft\\SystemCertificates\\My\\Keys\\ \u0441\u0441\u044b\u043b\u043a\u0438 \u043d\u0430 \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u0437\u0430\u043a\u0440\u044b\u0442\u044b\u0445 \u043a\u043b\u044e\u0447\u0435\u0439, \u0441\u043e\u0437\u0434\u0430\u043d\u043d\u044b\u0445 \u043f\u043e\u0441\u0442\u0430\u0432\u0449\u0438\u043a\u043e\u043c \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0430 \u043a\u043b\u044e\u0447\u0435\u0439 (KSP) \\ Get-ChildItem -Path HKCU:\\Software\\Microsoft\\SystemCertificates\\CA\\Certificates | ft -AutoSize \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432 \u0432 \u0440\u0435\u0435\u0441\u0442\u0440\u0435 \u0432\u043e\u0448\u0435\u0434\u0448\u0435\u0433\u043e \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0443 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f $cert = (Get-ChildItem -Path Cert:\\CurrentUser\\My\\)[1] \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 \\ $cert | Remove-Item \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 Export-Certificate -FilePath $home\\Desktop\\certificate.cer -Cert $cert \u044d\u043a\u0441\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 \\ $cert.HasPrivateKey \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0437\u0430\u043a\u0440\u044b\u0442\u043e\u0433\u043e \u043a\u043b\u044e\u0447\u0430 \\ $pass = \"password\" | ConvertTo-SecureString -AsPlainText -Force \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \u0434\u043b\u044f \u0448\u0438\u0444\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0437\u0430\u043a\u0440\u044b\u0442\u043e\u0433\u043e \u043a\u043b\u044e\u0447\u0430 \\ Export-PfxCertificate -FilePath $home\\Desktop\\certificate.pfx -Password $pass -Cert $certificate \u044d\u043a\u0441\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 \u0441 \u0437\u0430\u043a\u0440\u044b\u0442\u044b\u043c \u043a\u043b\u044e\u0447\u0435\u043c Import-Certificate -FilePath $home\\Desktop\\certificate.cer -CertStoreLocation Cert:\\CurrentUser\\My \u0438\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 \\ Import-PfxCertificate -Exportable -Password $pass -CertStoreLocation Cert:\\CurrentUser\\My -FilePath $home\\Desktop\\certificate.pfx","title":"pki"},{"location":"#openssl","text":"Invoke-WebRequest -Uri https://slproweb.com/download/Win64OpenSSL_Light-3_1_1.msi -OutFile $home\\Downloads\\OpenSSL-Light-3.1.1.msi Start-Process $home\\Downloads\\OpenSSL-Light-3.1.1.msi -ArgumentList '/quiet' -Wait` \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c msi \u043f\u0430\u043a\u0435\u0442 \u0432 \u0442\u0438\u0445\u043e\u043c \u0440\u0435\u0436\u0438\u043c\u0435 (\u0437\u0430\u043f\u0443\u0441\u043a \u043e\u0442 \u0438\u043c\u0435\u043d\u0438 \u0410\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u0430) rm $home\\Downloads\\OpenSSL-Light-3.1.1.msi cd \"C:\\Program Files\\OpenSSL-Win64\\bin\" \u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \u0434\u043b\u044f PFX \\ openssl pkcs12 -in \"C:\\Cert\\domain.ru.pfx\" -out \"C:\\Cert\\domain.ru.pem\" -nodes \u044d\u043a\u0441\u043f\u043e\u0440\u0442\u0438\u0440\u0443\u0435\u043c \u0438\u043c\u0435\u044e\u0449\u0438\u0439\u0441\u044f \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 \u0438 \u0437\u0430\u043a\u0440\u044b\u0442\u044b\u0439 \u043a\u043b\u044e\u0447 \u0432 .pem-\u0444\u0430\u0439\u043b \u0431\u0435\u0437 \u043f\u0430\u0440\u043e\u043b\u044f \u0441 \u0443\u043a\u0430\u0437\u0430\u043d\u0438\u0435\u043c \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u043f\u0430\u0440\u043e\u043b\u044f \\ openssl pkcs12 -export -in \"C:\\Cert\\domain.ru.pem\" -out \"C:\\Cert\\domain.ru_password.pfx\" -nodes \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0438\u0440\u0443\u0435\u043c .pem \u043e\u0431\u0440\u0430\u0442\u043d\u043e \u0432 .pfx c \u0443\u043a\u0430\u0437\u0430\u043d\u0438\u0435\u043c \u043d\u043e\u0432\u043e\u0433\u043e \u043f\u0430\u0440\u043e\u043b\u044f \u041a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0438\u044f \u0438\u0437 \u0437\u0430\u043a\u0440\u044b\u0442\u043e\u0433\u043e \u0438 \u043e\u0442\u043a\u0440\u044b\u0442\u043e\u0433\u043e \u043a\u043b\u044e\u0447\u0430 PEM \u0432 PFX \\ openssl pkcs12 -export -in \"C:\\tmp\\vpn\\vpn.itproblog.ru-crt.pem\" -inkey \"C:\\tmp\\vpn\\vpn.itproblog.ru-key.pem\" -out \"C:\\tmp\\vpn\\vpn.iiproblog.ru.pfx\" \\ in \u2013 \u043f\u0443\u0442\u044c \u0434\u043e \u0444\u0430\u0439\u043b\u0430 \u0441 \u043e\u0442\u043a\u0440\u044b\u0442\u044b\u043c \u043a\u043b\u044e\u0447\u043e\u043c \\ inkey \u2013 \u043f\u0443\u0442\u044c \u0434\u043e \u0444\u0430\u0439\u043b\u0430 \u0441 \u0437\u0430\u043a\u0440\u044b\u0442\u044b\u043c \u043a\u043b\u044e\u0447\u043e\u043c \\ out \u2013 \u043f\u0443\u0442\u044c \u0434\u043e \u0444\u0430\u0439\u043b\u0430, \u0432 \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0431\u0443\u0434\u0435\u0442 \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u043d \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 (pfx) \u041a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0438\u044f PFX \u0432 CRT \\ openssl pkcs12 -in \"C:\\OpenSSL-Win64\\bin\\_.domain.ru.pfx\" -clcerts -out \"C:\\OpenSSL-Win64\\bin\\_.domain.ru.crt\" \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u0438 2 \u0440\u0430\u0437\u0430 \u043d\u043e\u0432\u044b\u0439 \u043f\u0430\u0440\u043e\u043b\u044c PEM pass phrase (\u0444\u0430\u0439\u043b \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 EGIN CERTIFICATE \u0438 BEGIN ENCRYPTED PRIVATE KEY) \\ openssl pkcs12 -in \"C:\\OpenSSL-Win64\\bin\\_.domain.ru.pfx\" -clcerts -nokeys -out \"C:\\OpenSSL-Win64\\bin\\_.domain.ru.crt\" \u0431\u0435\u0437 \u043a\u043b\u044e\u0447\u0430, \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043e\u0442\u043a\u0440\u044b\u0442\u0443\u044e \u0447\u0430\u0441\u0442\u044c (\u0444\u0430\u0439\u043b \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0442\u043e\u043b\u044c\u043a\u043e EGIN CERTIFICATE) \u041a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0438\u044f PFX \u0432 KEY \\ openssl pkcs12 -in \"C:\\OpenSSL-Win64\\bin\\_.domain.ru.pfx\" -nocerts -out \"C:\\OpenSSL-Win64\\bin\\_.domain.ru.key\" \u0444\u0430\u0439\u043b \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0442\u043e\u043b\u044c\u043a\u043e BEGIN ENCRYPTED PRIVATE KEY \u0421\u043d\u044f\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \u043a \u0437\u0430\u043a\u0440\u044b\u0442\u043e\u0433\u043e \u043a\u043b\u044e\u0447\u0430 .key \\ openssl rsa -in \"C:\\OpenSSL-Win64\\bin\\_.domain.ru.key\" -out \"C:\\OpenSSL-Win64\\bin\\_.domain.ru-decrypted.key\" CRT \u0438 KEY \u0432 PFX: \\ openssl pkcs12 -inkey certificate.key -in certificate.crt -export -out certificate.pfx","title":"OpenSSL"},{"location":"#openvpn","text":"Invoke-WebRequest -Uri https://swupdate.openvpn.org/community/releases/OpenVPN-2.6.5-I001-amd64.msi -OutFile $home\\Downloads\\OpenVPN-2.6.5.msi \\ Start-Process $home\\Downloads\\OpenVPN-2.6.5.msi -ArgumentList '/quiet /SELECT_OPENSSL_UTILITIES=1' -Wait \\ msiexec /i $home\\Downloads\\OpenVPN-2.6.5.msi ADDLOCAL=EasyRSA /passive /quiet # \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u044b\u0439 \u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442 EasyRSA Certificate Management Scripts \\ # msiexec /i $home\\Downloads\\OpenVPN-2.6.5.msi ADDLOCAL=OpenVPN.Service,Drivers,Drivers.Wintun,OpenVPN,OpenVPN.GUI,OpenVPN.GUI.OnLogon,EasyRSA /passive \u0432\u044b\u0431\u043e\u0440\u043e\u0447\u043d\u0430\u044f \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 \\ # Invoke-WebRequest -Uri https://github.com/OpenVPN/easy-rsa/releases/download/v3.1.5/EasyRSA-3.1.5-win64.zip -OutFile $home\\Downloads\\EasyRSA-3.1.5.zip \u0441\u043a\u0430\u0447\u0430\u0442\u044c \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u044b\u0439 \u043f\u0430\u043a\u0435\u0442 EasyRSA \\ rm $home\\Downloads\\OpenVPN-2.6.5.msi cd \"C:\\Program Files\\OpenVPN\\easy-rsa\" \\ Copy-Item vars.example vars \u0444\u0430\u0439\u043b \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438 \u0434\u043b\u044f EasyRSA set_var EASYRSA_TEMP_DIR \"$EASYRSA_PKI\" set_var EASYRSA_REQ_COUNTRY \"RU\" set_var EASYRSA_REQ_PROVINCE \"MSK\" set_var EASYRSA_REQ_CITY \"MSK\" set_var EASYRSA_REQ_ORG \"FAILON.NET\" set_var EASYRSA_REQ_EMAIL \"lifailon@domain.ru\" set_var EASYRSA_REQ_OU \"IT\" #set_var EASYRSA_KEY_SIZE 2048 #set_var EASYRSA_CA_EXPIRE 3650 #set_var EASYRSA_CERT_EXPIRE 825 .\\EasyRSA-Start.bat \u0441\u0440\u0435\u0434\u0430 EasyRSA Shell \\ easyrsa init-pki \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f PKI, \u0441\u043e\u0437\u0434\u0430\u0435\u0442 \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u044e: C:\\Program Files\\OpenVPN\\easy-rsa\\pki \u0438 \u0447\u0438\u0442\u0430\u0435\u0442 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \u0444\u0430\u0439\u043b\u0430 \\easy-rsa\\vars \\ easyrsa build-ca \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f \u043a\u043e\u0440\u043d\u0435\u0432\u043e\u0433\u043e CA \u0441 \u0443\u043a\u0430\u0437\u0430\u043d\u0438\u0435\u043c \u043f\u0430\u0440\u043e\u043b\u044f \u0438 \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u043b\u044c\u043d\u043e\u0435 \u0438\u043c\u044f \u0441\u0435\u0440\u0432\u0435\u0440\u0430 (\\pki\\ca.crt \u0438 \\pki\\private\\ca.key) \\ easyrsa gen-req server nopass \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u0430 \u0438 \u043a\u043b\u044e\u0447 \u0434\u043b\u044f \u0441\u0435\u0440\u0432\u0435\u0440\u0430 OpenVPN - yes (\\pki\\reqs\\server.req \u0438 \\pki\\private\\server.key) \\ easyrsa sign-req server server \u043f\u043e\u0434\u043f\u0438\u0441\u0430\u0442\u044c \u0437\u0430\u043f\u0440\u043e\u0441 \u043d\u0430 \u0432\u044b\u043f\u0443\u0441\u043a \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e CA - yes (\\pki\\issued\\server.crt) \\ easyrsa gen-dh \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043a\u043b\u044e\u0447 \u0414\u0438\u0444\u0444\u0438-\u0425\u0435\u043b\u043b\u043c\u0430\u043d\u0430 (\\pki\\dh.pem) \\ easyrsa gen-req client1 nopass \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u0430 \u0438 \u043a\u043b\u044e\u0447 \u0434\u043b\u044f \u043a\u043b\u0438\u0435\u043d\u0442\u0430 OpenVPN (\\pki\\reqs\\client1.req \u0438 \\pki\\private\\client1.key) \\ easyrsa sign-req client client1 \u043f\u043e\u0434\u043f\u0438\u0441\u0430\u0442\u044c \u0437\u0430\u043f\u0440\u043e\u0441 \u043d\u0430 \u0432\u044b\u043f\u0443\u0441\u043a \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u0430 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e CA - yes (\\pki\\issued\\client1.crt) \\ easyrsa revoke client1 \u043e\u0442\u043e\u0437\u0432\u0430\u0442\u044c \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \\ openssl rsa -in \"C:\\Program Files\\OpenVPN\\easy-rsa\\pki\\private\\client1.key\" -out \"C:\\Program Files\\OpenVPN\\easy-rsa\\pki\\private\\client1_nopass.key\" \u0441\u043d\u044f\u0442\u044c \u0437\u0430\u0449\u0438\u0442\u0443 \u043f\u0430\u0440\u043e\u043b\u0435\u043c \u0434\u043b\u044f \u043a\u043b\u044e\u0447\u0430 (BEGIN ENCRYPTED PRIVATE KEY -> BEGIN PRIVATE KEY) \\ exit \\ cd \"C:\\Program Files\\OpenVPN\\bin\" \\ .\\openvpn --genkey secret ta.key \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f \u043a\u043b\u044e\u0447\u0430 tls-auth (\\bin\\ta.key) \\ Move-Item \"C:\\Program Files\\OpenVPN\\bin\\ta.key\" \"C:\\Program Files\\OpenVPN\\easy-rsa\\pki\\\"","title":"OpenVPN"},{"location":"#serverovpn","text":"# Copy-Item \"C:\\Program Files\\OpenVPN\\sample-config\\server.ovpn\" \"C:\\Program Files\\OpenVPN\\config-auto\\server.ovpn\" \\ New-Item -ItemType File -Path \"C:\\Program Files\\OpenVPN\\config-auto\\server.ovpn\" port 1194 proto udp # \u0427\u0442\u043e \u0438\u043c\u0435\u043d\u043d\u043e \u0438\u043d\u043a\u0430\u043f\u0441\u0443\u043b\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u0442\u0443\u043d\u043d\u0435\u043b\u0435 (ethernet \u0444\u0440\u0435\u0439\u043c\u044b - tap \u0438\u043b\u0438 ip \u043f\u0430\u043a\u0435\u0442\u044b - tun) dev tun ca \"C:\\\\Program Files\\\\OpenVPN\\\\easy-rsa\\\\pki\\\\ca.crt\" cert \"C:\\\\Program Files\\\\OpenVPN\\\\easy-rsa\\\\pki\\\\issued\\\\server.crt\" key \"C:\\\\Program Files\\\\OpenVPN\\\\easy-rsa\\\\pki\\\\private\\\\server.key\" dh \"C:\\\\Program Files\\\\OpenVPN\\\\easy-rsa\\\\pki\\\\dh.pem\" server 192.168.4.0 255.255.255.0 # \u0425\u0440\u0430\u043d\u0438\u0442 \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u043e\u043f\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u044f ip \u0434\u043b\u044f \u043a\u043b\u0438\u0435\u043d\u0442\u043e\u0432, \u0447\u0442\u043e \u0431\u044b \u043d\u0430\u0437\u043d\u0430\u0447\u0438\u0442\u044c \u0442\u043e\u0442 \u0436\u0435 \u0430\u0434\u0440\u0435\u0441 \u043f\u0440\u0438 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a\u0435 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 # ifconfig-pool-persist \"C:\\\\Program Files\\\\OpenVPN\\\\dhcp-client-list.txt\" # \u0420\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u044c \u043a\u043b\u0438\u0435\u043d\u0442\u0430\u043c \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0430\u0442\u044c\u0441\u044f \u043f\u043e\u0434 \u043e\u0434\u043d\u0438\u043c \u043a\u043b\u044e\u0447\u043e\u043c # duplicate-cn # max-clients 30 # \u0420\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u044c \u043e\u0431\u043c\u0435\u043d \u0442\u0440\u0430\u0444\u0438\u043a\u043e\u043c \u043c\u0435\u0436\u0434\u0443 \u043a\u043b\u0438\u0435\u043d\u0442\u0430\u043c\u0438 client-to-client # compress tls-auth \"C:\\\\Program Files\\\\OpenVPN\\\\easy-rsa\\\\pki\\\\ta.key\" 0 cipher AES-256-GCM keepalive 20 60 # \u041d\u0435 \u043f\u0435\u0440\u0435\u0447\u0438\u0442\u0430\u0432\u0430\u0442\u044c \u0444\u0430\u0439\u043b\u044b \u043a\u043b\u044e\u0447\u0435\u0439 \u043f\u0440\u0438 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a\u0435 \u0442\u0443\u043d\u043d\u0435\u043b\u044f persist-key # \u041e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 \u0431\u0435\u0437 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0430 tun/tap \u043f\u0440\u0438 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a\u0435 OpenVPN persist-tun status \"C:\\\\Program Files\\\\OpenVPN\\\\log\\\\status.log\" log \"C:\\\\Program Files\\\\OpenVPN\\\\log\\\\openvpn.log\" verb 3 mute 20 windows-driver wintun # \u041e\u0442\u043a\u0440\u044b\u0442\u044c \u0434\u043e\u0441\u0442\u0443\u043f \u043a \u043f\u043e\u0434\u0441\u0435\u0442\u0438 \u0437\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u043c push \"route 192.168.3.0 255.255.255.0\" push \"route 192.168.4.0 255.255.255.0\" # \u0417\u0430\u0432\u0435\u0440\u043d\u0443\u0442\u044c \u0432\u0441\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u044b \u043a\u043b\u0438\u0435\u043d\u0442\u0430 (\u0432 \u0442\u043e\u043c \u0447\u0438\u0441\u043b\u0435 \u0418\u043d\u0442\u0435\u0440\u043d\u0435\u0442 \u0442\u0440\u0430\u0444\u0438\u043a) \u043d\u0430 OpenVPN \u0441\u0435\u0440\u0432\u0435\u0440 # push \"redirect-gateway def1\" # push \"dhcp-option DNS 192.168.3.101\" # push \"dhcp-option DOMAIN failon.net\" New-NetFirewallRule -DisplayName \"AllowOpenVPN-In\" -Direction Inbound -Protocol UDP \u2013LocalPort 1194 -Action Allow \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435 \\ New-NetFirewallRule -DisplayName \"AllowOpenVPN-Out\" -Direction Outbound -Protocol UDP \u2013LocalPort 1194 -Action Allow \u043d\u0430 \u043a\u043b\u0438\u0435\u043d\u0442\u0435 \\ Get-Service *openvpn* | Restart-Service","title":"server.ovpn"},{"location":"#clientovpn","text":"# Copy-Item \"C:\\Program Files\\OpenVPN\\sample-config\\client.ovpn\" \"C:\\Program Files\\OpenVPN\\config-auto\\client.ovpn\" \\ New-Item -ItemType File -Path \"C:\\Program Files\\OpenVPN\\config-auto\\client.ovpn\" client dev tun proto udp remote 26.115.154.67 1194 resolv-retry infinite nobind persist-key persist-tun ca ca.crt cert client1.crt key client1.key remote-cert-tls server tls-auth ta.key 1 cipher AES-256-GCM connect-retry-max 25 # \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0434\u0440\u0430\u0439\u0432\u0435\u0440 wintun \u0438 \u043f\u043e\u043b\u043d\u044b\u0439 \u043f\u0443\u0442\u044c \u0434\u043e \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432 \u043f\u0440\u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0438 openvpn gui windows-driver wintun verb 3","title":"client.ovpn"},{"location":"#client","text":"iwr -Uri https://openvpn.net/downloads/openvpn-connect-v3-windows.msi -OutFile \"$home\\downloads\\OpenVPN-Connect-3.msi\" \\ \u041f\u0435\u0440\u0435\u0434\u0430\u0442\u044c \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044e \u0438 \u043a\u043b\u044e\u0447\u0438: \\ client.ovpn \\ ca.crt \\ dh.pem \\ ta.key \\ client1.crt \\ client1.key","title":"Client"},{"location":"#route","text":"Get-Service RemoteAccess | Stop-Service \\ Set-ItemProperty -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\Services\\Tcpip\\Parameters\" -Name \"IPEnableRouter\" -Value 1 \u0432\u043a\u043b\u044e\u0447\u0430\u0435\u0442 IP \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0430\u0446\u0438\u044e \\ (Get-ItemProperty \"HKLM:\\SYSTEM\\CurrentControlSet\\Services\\Tcpip\\Parameters\").IPEnableRouter \\ Get-NetIPInterface | select ifIndex,InterfaceAlias,AddressFamily,ConnectionState,Forwarding | ft \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u0435\u0442\u0435\u0432\u044b\u0435 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u044b \\ Set-NetIPInterface -ifIndex 13 -Forwarding Enabled \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043f\u0435\u0440\u0435\u0430\u0434\u0440\u0435\u0441\u0430\u0446\u0438\u044e \u043d\u0430 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u0435 sysctl net.ipv4.ip_forward=1 \\ echo \"sysctl net.ipv4.ip_forward = 1\" >> /etc/sysctl.conf Get-NetRoute \\ New-NetRoute -DestinationPrefix \"192.168.3.0/24\" -NextHop \"192.168.4.1\" -InterfaceIndex 8 \\ route -p add 192.168.3.0 mask 255.255.255.0 192.168.4.1 metric 1 \\ route -p change 192.168.3.0 mask 255.255.255.0 192.168.4.1 metric 2 \\ route -p add 192.168.3.0 mask 255.255.255.0 192.168.4.1 metric 1 if 7 \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u043d\u043e\u043c\u0435\u0440 \u0441\u0435\u0442\u0435\u0432\u043e\u0433\u043e \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u0430 \u043d\u0430 \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043f\u043e\u0441\u044b\u043b\u0430\u0442\u044c \u043f\u0430\u043a\u0435\u0442 (Wintun Userspace Tunnel) \\ route print -4 \\ route delete 192.168.3.0 tracert 192.168.3.101 \u0441 192.168.4.6 1 17 ms * 22 ms 192.168.4.1 2 12 ms 13 ms 14 ms 192.168.3.101 route add -net 192.168.4.0 netmask 255.255.255.0 gw 192.168.3.100 \\ route -e traceroute 192.168.4.6 \u0441 192.168.3.101 1 192.168.3.100 (192.168.3.100) 0.148 ms 0.110 ms 0.106 ms 2 192.168.4.6 (192.168.4.6) 14.573 ms * * ping 192.168.3.101 -t \u0441 192.168.4.6 \\ tcpdump -n -i ens33 icmp \u043d\u0430 192.168.3.101 14:36:34.533771 IP 192.168.4.6 > 192.168.3.101: ICMP echo request, id 1, seq 2962, length 40 # \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u043b \u0437\u0430\u043f\u0440\u043e\u0441 14:36:34.533806 IP 192.168.3.101 > 192.168.4.6: ICMP echo reply, id 1, seq 2962, length 40 # \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u043b \u043e\u0442\u0432\u0435\u0442","title":"Route"},{"location":"#nat","text":"Get-Command -Module NetNat \\ New-NetNat -Name LocalNat -InternalIPInterfaceAddressPrefix \"192.168.3.0/24\" \\ Add-NetNatStaticMapping -NatName LocalNat -Protocol TCP -ExternalIPAddress 0.0.0.0 -ExternalPort 80 -InternalIPAddress 192.168.3.102 -InternalPort 80 \\ Remove-NetNatStaticMapping -StaticMappingID 0 \\ Remove-NetNat -Name LocalNat","title":"NAT"},{"location":"#wireguard","text":"Invoke-WebRequest \"https://download.wireguard.com/windows-client/wireguard-amd64-0.5.3.msi\" -OutFile \"$home\\Downloads\\WireGuard-Client-0.5.3.msi\" \\ msiexec.exe /i \"$home\\Downloads\\WireGuard-Client-0.5.3.msi\" DO_NOT_LAUNCH=1 /qn \\ Invoke-WebRequest \"http://www.wiresock.net/downloads/wiresock-vpn-gateway-x64-1.1.4.1.msi\" -OutFile \"$home\\Downloads\\WireSock-VPN-Gateway-1.1.4.1.msi\" \\ msiexec.exe /i \"http://www.wiresock.net/downloads/wiresock-vpn-gateway-x64-1.1.4.1.msi\" /qn \\ $env:Path = [System.Environment]::GetEnvironmentVariable(\"Path\",\"Machine\") + \";\" + [System.Environment]::GetEnvironmentVariable(\"Path\",\"User\") \\ wg-quick-config -add -start \\ 26.115.154.67:8181 \\ 192.168.21.4/24 \\ Successfully saved client configuration: C:\\ProgramData\\NT KERNEL\\WireSock VPN Gateway\\wsclient_1.conf \\ Successfully saved server configuration: C:\\ProgramData\\NT KERNEL\\WireSock VPN Gateway\\wiresock.conf \\ get-service *wire* \\ wg show \\ wg-quick-config -add -restart add client wiresock.conf [Interface] PrivateKey = gCHC0g2JPwr6sXPiaOL4/KTkMyjN9TculrJUA/GORV8= Address = 192.168.21.5/24 ListenPort = 8181 [Peer] PublicKey = NoSxjew2RCHiUzI6mlahjd4I+0EcLsoYom/H01z91yU= AllowedIPs = 192.168.21.6/32 wsclient_1.conf (\u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u044b \u0434\u043b\u044f \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u0432 AllowedIPs) [Interface] PrivateKey = yIpRQRmaGrrk9Y+49E8JhEpFmKzSeecvUAdeNgf1hUM= Address = 192.168.21.6/24 DNS = 8.8.8.8, 1.1.1.1 MTU = 1420 [Peer] PublicKey = Fp7674VSYeGj8CYt6RCKR7Qz1y/IKUXCw8ImOFhX3hk= AllowedIPs = 192.168.21.0/24, 192.168.3.0/24 Endpoint = 26.115.154.67:8181 PersistentKeepalive = 25","title":"WireGuard"},{"location":"#vpnclient","text":"Get-Command -Module VpnClient \\ Add-VpnConnection -Name \"vpn-failon\" -ServerAddress \"26.115.154.67\" -TunnelType L2TP -L2tpPsk \"123098\" -EncryptionLevel \"Required\" -AuthenticationMethod MSChapv2 -RememberCredential -AllUserConnection \u2013PassThru -Force \\ -TunnelType PPTP/L2TP/SSTP/IKEv2/Automatic \\ -L2tpPsk \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043e\u0431\u0449\u0438\u0439 \u043a\u043b\u044e\u0447 \u0434\u043b\u044f \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438 (\u0431\u0435\u0437 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430, \u0434\u043b\u044f L2TP \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442) \\ -AuthenticationMethod Pap/Chap/MSChapv2/Eap/MachineCertificate \\ -EncryptionLevel NoEncryption/Optional/Required/Maximum/Custom \\ -SplitTunneling \u0437\u0430\u0432\u043e\u0440\u0430\u0447\u0438\u0432\u0430\u0442\u044c \u0432\u0435\u0441\u044c \u0442\u0440\u0430\u0444\u0438\u043a \u0447\u0435\u0440\u0435\u0437 VPN-\u0442\u0443\u043d\u043d\u0435\u043b\u044c (\u0432\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 Use default gateway on remote network \u0432 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430\u0445 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430 VPN \u0430\u0434\u0430\u043f\u0442\u0435\u0440\u0430) \\ -UseWinlogonCredential \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0443\u0447\u0435\u0442\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0434\u043b\u044f \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438 \u043d\u0430 VPN \u0441\u0435\u0440\u0432\u0435\u0440\u0435 \\ -RememberCredential \u0440\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u044c \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0442\u044c \u0443\u0447\u0435\u0442\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0434\u043b\u044f VPN \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f (\u0443\u0447\u0435\u0442\u043d\u0430\u044f \u0437\u0430\u043f\u0438\u0441\u044c \u0438 \u043f\u0430\u0440\u043e\u043b\u044c \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u044e\u0442\u0441\u044f \u0432 \u0434\u0438\u0441\u043f\u0435\u0442\u0447\u0435\u0440 \u0443\u0447\u0435\u0442\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445 Windows \u043f\u043e\u0441\u043b\u0435 \u043f\u0435\u0440\u0432\u043e\u0433\u043e \u0443\u0441\u043f\u0435\u0448\u043d\u043e\u0433\u043e \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f) \\ -DnsSuffix domain.local \\ -AllUserConnection \u0440\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u044c \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c VPN \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u0432\u0441\u0435\u0445 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0430 (\u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u0442\u0441\u044f \u0432 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0439 \u0444\u0430\u0439\u043b: C:\\ProgramData\\Microsoft\\Network\\Connections\\Pbk\\rasphone.pbk) Install-Module -Name VPNCredentialsHelper \u043c\u043e\u0434\u0443\u043b\u044c \u0434\u043b\u044f \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u043b\u043e\u0433\u0438\u043d\u0430 \u0438 \u043f\u0430\u0440\u043e\u043b\u044f \u0432 Windows Credential Manager \u0434\u043b\u044f VPN \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \\ Set-VpnConnectionUsernamePassword -connectionname vpn-failon -username user1 -password password rasdial \"vpn-failon\" \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f \\ Get-VpnConnection -AllUserConnection | select * \u0441\u043f\u0438\u0441\u043e\u043a VPN \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f, \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0445 \u0434\u043b\u044f \u0432\u0441\u0435\u0445 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439, \u043d\u0430\u0439\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u0438 \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u0441\u0442\u0430\u0442\u0443\u0441 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f (ConnectionStatus) \\ Add-VpnConnectionRoute -ConnectionName vpn-failon -DestinationPrefix 192.168.3.0/24 \u2013PassThru \u0434\u0438\u043d\u0430\u043c\u0438\u0447\u0435\u0441\u043a\u0438 \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0443 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0430\u0446\u0438\u0438 \u043c\u0430\u0440\u0448\u0440\u0443\u0442, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0431\u0443\u0434\u0435\u0442 \u0430\u043a\u0442\u0438\u0432\u0435\u043d \u043f\u0440\u0438 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0438 \u043a VPN \\ Remove-VpnConnection -Name vpn-failon -AllUserConnection -Force \u0443\u0434\u0430\u043b\u0438\u0442\u044c Set-VpnConnection -Name \"vpn-failon\" -SplitTunneling $True \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0440\u0430\u0437\u0434\u0435\u043b\u044c\u043d\u043e\u0435 \u0442\u0443\u043d\u0435\u043b\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \\ Add-VpnConnectionRoute -ConnectionName \"vpn-failon\" -DestinationPrefix 172.22.22.0/24 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0430\u0446\u0438\u044e \u043a \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0439 \u043f\u043e\u0434\u0441\u0435\u0442\u0438 \u0447\u0435\u0440\u0435\u0437 VPN-\u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \\ (Get-VpnConnection -ConnectionName \"vpn-failon\").routes \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0442\u0430\u0431\u043b\u0438\u0446\u0443 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0430\u0446\u0438\u0438 \u0434\u043b\u044f \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0433\u043e \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f \\ Remove-VpnConnectionRoute -ConnectionName \"vpn-failon\" -DestinationPrefix \"172.22.23.0/24\"","title":"VpnClient"},{"location":"#proxy","text":"$user = \"lifailon\" \\ $pass = \"Proxy\" \\ $SecureString = ConvertTo-SecureString $pass -AsPlainText -Force \\ $Credential = New-Object System.Management.Automation.PSCredential($user, $SecureString) \\ [System.Net.Http.HttpClient]::DefaultProxy = New-Object System.Net.WebProxy(\"http://192.168.3.100:9090\") \\ [System.Net.Http.HttpClient]::DefaultProxy.Credentials = [System.Net.CredentialCache]::DefaultCredentials \\ [System.Net.Http.HttpClient]::DefaultProxy.Credentials = $Credential \\ Invoke-RestMethod http://ifconfig.me/ip \\ Invoke-RestMethod https://kinozal.tv/rss.xml","title":"Proxy"},{"location":"#netsh","text":"","title":"netsh"},{"location":"#proxy_1","text":"netsh interface portproxy add v4tov4 listenport=8080 listenaddress=0.0.0.0 connectport=80 connectaddress=192.168.3.108 \\ netsh interface portproxy show all \\ netsh interface portproxy delete v4tov4 listenport=8080 listenaddress=0.0.0.0","title":"Proxy"},{"location":"#wlan","text":"netsh wlan show profile \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u043d\u044b \u043f\u0440\u043e\u0444\u0438\u043b\u0435\u0439 Wi-Fi \u0438 \u043f\u0430\u0440\u043e\u043b\u0435\u0439 \\ netsh wlan show interfaces \u0445\u0430\u0440-\u043a\u0438 \u0442\u0435\u043a\u0443\u0449\u0435\u0439 \u0441\u0435\u0442\u0438 (MAC, speed) \\ netsh wlan show profile SSID-Name-Network key=clear \u043e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \\ netsh wlan show networks \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0438\u0434\u0435\u043c\u044b\u0445 \u0441\u0435\u0442\u0435\u0439 \\ netsh wlan disconnect \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f \u043e\u0442 Wi-Fi \\ netsh wlan connect name=\"SSID-Name-Network\" \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f \\ netsh wlan show drivers \u0434\u0440\u0430\u0439\u0432\u0435\u0440 Wi-Fi \\ netsh wlan set hostednetwork mode=allow ssid=\"WiFi-Test\" key=\"password\" \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0442\u043e\u0447\u043a\u0438 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 Wi-Fi (SoftAP)","title":"Wlan"},{"location":"#firewall_1","text":"netsh advfirewall set allprofiles state off \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c fw \\ netsh advfirewall reset \u0441\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \\ netsh advfirewall firewall add rule name=\"Open Remote Desktop\" protocol=TCP dir=in localport=3389 action=allow \u043e\u0442\u043a\u0440\u044b\u0442\u044c \u043f\u043e\u0440\u0442 3389 \\ netsh advfirewall firewall add rule name=\"All ICMP V4\" dir=in action=allow protocol=icmpv4 \u043e\u0442\u043a\u0440\u044b\u0442\u044c icmp","title":"Firewall"},{"location":"#openssh","text":"Get-WindowsCapability -Online | ? Name -like 'OpenSSH.Client*' \\ Add-WindowsCapability -Online -Name OpenSSH.Client* \\ dism /Online /Add-Capability /CapabilityName:OpenSSH.Client~~~~0.0.1.0 \\ iwr https://github.com/PowerShell/Win32-OpenSSH/releases/download/v9.2.2.0p1-Beta/OpenSSH-Win64-v9.2.2.0.msi -OutFile $home\\Downloads\\OpenSSH-Win64-v9.2.2.0.msi \u0441\u043a\u0430\u0447\u0430\u0442\u044c \\ msiexec /i $home\\Downloads\\OpenSSH-Win64-v9.2.2.0.msi \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c msi \u043f\u0430\u043a\u0435\u0442 \\ Set-Service sshd -StartupType Automatic \\ Get-NetTCPConnection | where LocalPort -eq 22 \\ New-NetFirewallRule -Name sshd -DisplayName 'OpenSSH Server (sshd)' -Enabled True -Direction Inbound -Protocol TCP -Action Allow -LocalPort 22 \\ Get-NetFirewallRule -Name *ssh* \\ Start-Process notepad++ C:\\Programdata\\ssh\\sshd_config \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0439 \u0444\u0430\u0439\u043b \\ GSSAPIAuthentication yes \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c Kerberos \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u044e (\u0447\u0435\u0440\u0435\u0437 AD) \\ SyslogFacility LOCAL0 \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u043e\u0435 \u0432\u0435\u0434\u0435\u043d\u0438\u0435 \u0436\u0443\u0440\u043d\u0430\u043b\u0430 \u0432 \u0444\u0430\u0439\u043b (C:\\ProgramData\\ssh\\logs\\sshd.log) \\ LogLevel INFO \\ Restart-Service sshd \\ ssh -K $srv \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c Kerberos \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u044e \\ ssh Lifailon@192.168.3.99 -p 22 \\ pwsh -command Get-Service \\ ssh -L 3101:192.168.3.101:22 -R 3101:192.168.3.101:22 lifailon@192.168.3.101 -p 22 SSH Tunnel lifailon@localhost:3101 -> 192.168.3.101:3101","title":"OpenSSH"},{"location":"#winrm","text":"Enter-PSSession -ComputerName $srv \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f \u043a PowerShell \u0441\u0435\u0441\u0441\u0438\u0438 \u0447\u0435\u0440\u0435\u0437 PSRemoting. \u041f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0442\u043e\u043b\u044c\u043a\u043e \u043f\u043e FQDN-\u0438\u043c\u0435\u043d\u0438 \\ Invoke-Command $srv -ScriptBlock {Get-ComputerInfo} \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u043a\u043e\u043c\u0430\u043d\u0434\u044b \u0447\u0435\u0440\u0435\u0437 PSRemoting \\ $session = New-PSSession $srv \u043e\u0442\u043a\u0440\u044b\u0442\u044c \u0441\u0435\u0441\u0441\u0438\u044e \\ Get-PSSession \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0435 \u0441\u0435\u0441\u0441\u0438\u0438 \\ icm -Session $session {$srv = $using:srv} \u043f\u0435\u0440\u0435\u0434\u0430\u0442\u044c \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0443\u044e \u0442\u0435\u043a\u0443\u0449\u0435\u0439 \u0441\u0435\u0441\u0441\u0438\u0438 ($using) \u0432 \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u0443\u044e \\ Disconnect-PSSession $session \u0437\u0430\u043a\u0440\u044b\u0442\u044c \u0441\u0435\u0441\u0441\u0438\u044e \\ Remove-PSSession $session \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u0435\u0441\u0441\u0438\u044e \\ Import-Module -Name ActiveDirectory -PSSession $srv \u0438\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043c\u043e\u0434\u0443\u043b\u044c \u0441 \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u043e\u0433\u043e \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0430 \u0432 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u0443\u044e \u0441\u0435\u0441\u0441\u0438\u044e","title":"WinRM"},{"location":"#windows-remote-management-configuration","text":"winrm quickconfig -quiet \u0438\u0437\u043c\u0435\u043d\u0438\u0442 \u0437\u0430\u043f\u0443\u0441\u043a \u0441\u043b\u0443\u0436\u0431\u044b WinRM \u043d\u0430 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439, \u0437\u0430\u0434\u0430\u0441\u0442 \u0441\u0442\u0430\u043d\u0434\u0430\u0440\u0442\u043d\u044b\u0435 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 WinRM \u0438 \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0438\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u0434\u043b\u044f \u043f\u043e\u0440\u0442\u043e\u0432 \u0432 fw \\ Enable-PSRemoting \u2013Force \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c PowerShell Remoting, \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u0434\u043b\u044f \u0434\u043e\u043c\u0435\u043d\u043d\u043e\u0433\u043e \u0438 \u0447\u0430\u0441\u0442\u043d\u043e\u0433\u043e \u0441\u0435\u0442\u0435\u0432\u044b\u0445 \u043f\u0440\u043e\u0444\u0438\u043b\u0435\u0439 Windows \\ Enable-PSRemoting -SkipNetworkProfileCheck -Force \u0434\u043b\u044f \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0430 \u0432 \u043e\u0431\u0449\u0435\u0439 (public) \u0441\u0435\u0442\u0438 (\u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u0441 \u0432\u0435\u0440\u0441\u0438\u0438 powershell 6) $NetProfiles = Get-NetConnectionProfile \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u0438 \u0441\u0435\u0442\u0435\u0432\u044b\u0445 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0439 \\ Set-NetConnectionProfile -InterfaceIndex $NetProfiles[1].InterfaceIndex -NetworkCategory Private \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0442\u0438\u043f \u0441\u0435\u0442\u0438 \u0434\u043b\u044f \u043f\u0440\u043e\u0444\u0438\u043b\u044f (DomainAuthenticated/Public) \\ (Get-CimInstance -ClassName Win32_ComputerSystem).PartOfDomain \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c, \u0447\u0442\u043e \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d \u0432 \u0434\u043e\u043c\u0435\u043d AD \\ Get-Service WinRM | Set-Service -StartupType AutomaticDelayedStart \u043e\u0442\u043b\u043e\u0436\u0435\u043d\u043d\u044b\u0439 \u0437\u0430\u043f\u0443\u0441\u043a \\ Get-Service -Name winrm -RequiredServices \u0441\u0442\u0430\u0442\u0443\u0441 \u0437\u0430\u0432\u0438\u0441\u0438\u043c\u044b\u0445 \u0441\u043b\u0443\u0436\u0431 \\ New-NetFirewallRule -Profile Any -DisplayName \"WinRM HTTP\" -Direction Inbound -Protocol TCP -LocalPort 5985,5986 \\ Test-NetConnection $srv -port 5895 \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u043f\u043e\u0440\u0442 \\ Test-WSMan $srv -ErrorAction Ignore \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0440\u0430\u0431\u043e\u0442\u0443 WinRM \u043d\u0430 \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u043e\u043c \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0435 (\u0438\u0433\u043d\u043e\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u044b\u0432\u043e\u0434 \u043e\u0448\u0438\u0431\u043e\u043a \u0434\u043b\u044f \u0441\u043a\u0440\u0438\u043f\u0442\u0430) \u0438\u043b\u0438 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u043e (localhost) $Cert = New-SelfSignedCertificate -CertStoreLocation Cert:\\LocalMachine\\My -DnsName \"$env:computername\" -FriendlyName \"WinRM HTTPS Certificate\" -NotAfter (Get-Date).AddYears(5) \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0441\u0430\u043c\u043e\u043f\u043e\u0434\u043f\u0438\u0441\u0430\u043d\u043d\u044b\u0439 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 \\ $Thumbprint = $Cert.Thumbprint \u0437\u0430\u0431\u0440\u0430\u0442\u044c \u043e\u0442\u043f\u0435\u0447\u0430\u0442\u043e\u043a \\ New-Item -Path WSMan:\\Localhost\\Listener -Transport HTTPS -Address * -CertificateThumbprint $Thumbprint -Name WinRM_HTTPS_Listener -Force \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u0440\u043e\u0441\u043b\u0443\u0448\u0438\u0432\u0430\u0442\u0435\u043b\u044c \\ New-NetFirewallRule -DisplayName 'WinRM HTTPS' -Profile Domain,Private -Direction Inbound -Action Allow -Protocol TCP -LocalPort 5986 \u043e\u0442\u043a\u0440\u044b\u0442\u044c \u043f\u043e\u0440\u0442 \u0432 fw $selector_set = @{ Address = \"*\" Transport = \"HTTPS\" } $value_set = @{ CertificateThumbprint = \"66ABFDA044D8C85135048186E2FDC0DBE6125163\" } New-WSManInstance -ResourceURI \"winrm/config/Listener\" -SelectorSet $selector_set -ValueSet $value_set winrm get winrm/config \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u044e \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044e (Client/Service) \\ winrm get winrm/config/service/auth \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435 \\ winrm enumerate winrm/config/listener \u0442\u0435\u043a\u0443\u0449\u0430\u044f \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f \u043f\u0440\u043e\u0441\u043b\u0443\u0448\u0438\u0432\u0430\u0442\u0435\u043b\u0435\u0439 WinRM (\u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u0442 \u043e\u0442\u043f\u0435\u0447\u0430\u0442\u043e\u043a \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u0430 \u0434\u043b\u044f HTTPS 5986) \\ Get-ChildItem -Path Cert:\\LocalMachine\\My\\ | where Thumbprint -eq D9356FB774EE0E6206B7D5B59B99102CA5B17BDA | select * \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043e \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u0435 ls WSMan:\\localhost\\Client \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044e \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \\ ls WSMan:\\localhost\\Service \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \\ ls WSMan:\\localhost\\Service\\auth \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0439 \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438 WinRM \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \\ Set-Item -path WSMan:\\localhost\\Service\\auth\\basic -value $true \u0440\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u044c \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u0443\u044e \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u044e \u043a \u0442\u0435\u043a\u0443\u0449\u0435\u043c\u0443 \u0441\u0435\u0440\u0432\u0435\u0440\u0443 \\ ls HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\WSMAN \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u0432 \u0440\u0435\u0435\u0441\u0442\u0440\u0435 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0434\u043b\u044f \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u0430\u0443\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438 \u0432 \\Service\\auth_basic = 1) \\ Set-Item WSMan:\\localhost\\Client\\TrustedHosts -Value 192.168.* -Force \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0434\u043e\u0432\u0435\u0440\u0435\u043d\u043d\u044b\u0435 \u0445\u043e\u0441\u0442\u044b \u0432 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044e \u043d\u0430 \u043a\u043b\u0438\u0435\u043d\u0442\u0435, \u0447\u0442\u043e\u0431\u044b \u0440\u0430\u0431\u043e\u0442\u0430\u043b\u0430 Negotiate \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u044f \u0447\u0435\u0440\u0435\u0437 NTLM \\ Set-Item WSMan:\\localhost\\Client\\TrustedHosts -Value 192.168.3.100 -Concatenate -Force \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432\u0442\u043e\u0440\u043e\u0439 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440 \\ ls WSMan:\\localhost\\Client\\TrustedHosts \\ Set-Item WSMan:\\localhost\\Client\\AllowUnencrypted $true \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043f\u0435\u0440\u0435\u0434\u0430\u0447\u0430 \u043d\u0435\u0437\u0430\u0448\u0438\u0444\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \\ Set-Item WSMan:\\localhost\\Service\\AllowUnencrypted $true \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043f\u0435\u0440\u0435\u0434\u0430\u0447\u0430 \u043d\u0435\u0437\u0430\u0448\u0438\u0444\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 (\u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0431\u044b\u0442\u044c \u0432 private \u0441\u0435\u0442\u0438) Get-PSSessionConfiguration \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c, \u0432\u043a\u043b\u044e\u0447\u0435\u043d \u043b\u0438 PSremoting \u0438 \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \u0438 \u0433\u0440\u0443\u043f\u043f, \u043a\u043e\u0442\u043e\u0440\u044b\u043c \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u043e \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0430\u0442\u044c\u0441\u044f \u0447\u0435\u0440\u0435\u0437 WinRM \\ Set-PSSessionConfiguration -Name Microsoft.PowerShell -ShowSecurityDescriptorUI \u043d\u0430\u0437\u043d\u0430\u0447\u0438\u0442\u044c \u043f\u0440\u0430\u0432\u0430 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u0447\u0435\u0440\u0435\u0437 \u0434\u0435\u0441\u043a\u0440\u0438\u043f\u0442\u043e\u0440 \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u0438 \u0442\u0435\u043a\u0443\u0449\u0435\u0439 \u0441\u0435\u0441\u0441\u0438\u0438 (\u0434\u043e \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u043a\u0438) \\ (Get-PSSessionConfiguration -Name \"Microsoft.PowerShell\").SecurityDescriptorSDDL \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u0434\u0435\u0441\u043a\u0440\u0438\u043f\u0442\u043e\u0440\u0430 \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 SDDL \\ Set-PSSessionConfiguration -Name Microsoft.PowerShell -SecurityDescriptorSDDL $SDDL \u043f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u0434\u0435\u0441\u043a\u0440\u0438\u043f\u0442\u043e\u0440\u0430 \u043d\u0430 \u0434\u0440\u0443\u0433\u043e\u043c \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0435 \u0431\u0435\u0437 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f GUI \\ New-LocalUser \"WinRM-Writer\" -Password (ConvertTo-SecureString -AsPlainText \"123098\") \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \\ Add-LocalGroupMember -Group \"Remote Management Users\" -Member \"WinRM-Writer\" \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f WinRM-Writer \u0432 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u0443\u044e \u0433\u0440\u0443\u043f\u043f\u0443 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438 \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u043e\u0433\u043e \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u044f\" \\ cmdkey /add:192.168.3.99 /user:WinRM-Writer /pass:123098 \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \u0432 CredentialManager cmdkey /list \\ Import-Module CredentialManager \\ Add-Type -AssemblyName System.Web \\ New-StoredCredential -Target 192.168.3.99 -UserName WinRM-Writer -Password 123098 -Comment WinRM \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \u0432 CredentialManager (\u0438\u0437 PS5) \\ Get-StoredCredential -AsCredentialObject \\ $cred = Get-StoredCredential -Target 192.168.3.99 \\ Enter-PSSession -ComputerName 192.168.3.99 -Credential $cred -Authentication Negotiate \\ Enter-PSSession -ComputerName 192.168.3.99 -Credential $cred -Authentication Basic -Port 5985 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u043f\u0440\u0438 \u043e\u0442\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0438 allowunencrypted \u043d\u0430 \u0441\u0442\u043e\u0440\u043e\u043d\u0435 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u0438 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \\ winrs -r:http://192.168.3.100:5985/wsman -u:WinRM-Writer -p:123098 ipconfig \u043f\u0435\u0440\u0435\u0434\u0430\u0442\u044c \u043a\u043e\u043c\u0430\u043d\u0434\u0443 \u0447\u0435\u0440\u0435\u0437 winrs (-?) \\ winrs -r:https://192.168.3.100:5985/wsman -u:WinRM-Writer -p:123098 -ssl ipconfig \u0447\u0435\u0440\u0435\u0437 https \\ pwsh -Command \"Install-Module -Name PSWSMan\" \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043c\u043e\u0434\u0443\u043b\u044c \u0434\u043b\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f \u0432 Linux \u0441\u0438\u0441\u0442\u0435\u043c\u0435","title":"Windows Remote Management Configuration"},{"location":"#kerberos","text":".\\CheckMaxTokenSize.ps1 -Principals login -OSEmulation $true -Details $true \u0443\u0437\u043d\u0430\u0442\u044c \u0440\u0430\u0437\u043c\u0435\u0440 \u0442\u043e\u043a\u0435\u043d\u0430 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0432 \u0434\u043e\u043c\u0435\u043d\u0435 \\ Get-ItemProperty -Path HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\Kerberos\\Parameters | select maxtokensize \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439 \u0440\u0430\u0437\u043c\u0435\u0440 \u0442\u043e\u043a\u0435\u043d\u0430 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435 \\ HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\services\\HTTP\\Parameters \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0440\u0430\u0437\u043c\u0435\u0440\u0430, \u0435\u0441\u043b\u0438 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a \u043f\u0430\u043a\u0435\u0442\u0430 \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438 \u043f\u0440\u0435\u0432\u044b\u0448\u0430\u0435\u0442 16 \u041a\u0431 (\u0438\u0437 \u0437\u0430 \u0431\u043e\u043b\u044c\u0448\u043e\u0433\u043e \u043a\u043e\u043b-\u0432\u0430 \u0433\u0440\u0443\u043f\u043f) \\ MaxFieldLength \u0443\u0432\u0435\u043b\u0438\u0447\u0438\u0442\u044c \u0434\u043e 0000ffff (65535) \\ MaxRequestBytes \u0443\u0432\u0435\u043b\u0438\u0447\u0438\u0442\u044c \u0434\u043e 0000ffff (65535)","title":"Kerberos"},{"location":"#packagemanagement","text":"Import-Module PackageManagement \u0438\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043c\u043e\u0434\u0443\u043b\u044c \\ Get-Module PackageManagement \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043e \u043c\u043e\u0434\u0443\u043b\u0435 \\ Get-Command -Module PackageManagement \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u043a\u043e\u043c\u0430\u043d\u0434\u043b\u0435\u0442\u044b \u043c\u043e\u0434\u0443\u043b\u044f \\ Get-Package \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044b\u0435 \u043f\u0430\u043a\u0435\u0442\u044b PowerShellGallery \\ Get-Package -ProviderName msi,Programs \u0441\u043f\u0438\u0441\u043e\u043a \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044b\u0445 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12 \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u043f\u0440\u043e\u0442\u043e\u043a\u043e\u043b TLS 1.2 (\u0435\u0441\u043b\u0438 \u043d\u0435 \u043e\u0442\u043a\u043b\u044e\u0447\u0435\u043d\u044b \u043f\u0440\u043e\u0442\u043e\u043a\u043e\u043b\u044b TLS 1.0 \u0438 1.1) \\ Find-PackageProvider \u043f\u043e\u0438\u0441\u043a \u043f\u0440\u043e\u0432\u0430\u0439\u0434\u0435\u0440\u043e\u0432 \\ Install-PackageProvider PSGallery -force \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a \\ Install-PackageProvider NuGet -force \\ Install-PackageProvider Chocolatey -force \\ Get-PackageSource \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u0438 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \u043f\u0430\u043a\u0435\u0442\u043e\u0432 \\ Set-PackageSource -Name PSGallery -Trusted \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \\ Find-Package -Name *Veeam* -Source PSGallery \u043f\u043e\u0438\u0441\u043a \u043f\u0430\u043a\u0435\u0442\u043e\u0432 \u0441 \u0443\u043a\u0430\u0437\u0430\u043d\u0438\u0435\u043c \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u0430 \\ Install-Package -Name VeeamLogParser -ProviderName PSGallery -scope CurrentUser \\ Get-Command *Veeam* \\ Import-Module -Name VeeamLogParser \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u043c\u043e\u0434\u0443\u043b\u044c \\ Get-Module VeeamLogParser | select -ExpandProperty ExportedCommands \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0444\u0443\u043d\u043a\u0446\u0438\u0439","title":"PackageManagement"},{"location":"#winget","text":"Source Web winget list \u0441\u043f\u0438\u0441\u043e\u043a \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044b\u0445 \u043f\u0430\u043a\u0435\u0442\u043e\u0432 \\ winget search VLC \u043d\u0430\u0439\u0442\u0438 \u043f\u0430\u043a\u0435\u0442 \\ winget show VideoLAN.VLC \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043e \u043f\u0430\u043a\u0435\u0442\u0435 \\ winget show VideoLAN.VLC --versions \u0441\u043f\u0438\u0441\u043e\u043a \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0445 \u0432\u0435\u0440\u0441\u0438\u0439 \u0432 \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u0438 \\ winget install VideoLAN.VLC \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043f\u0430\u043a\u0435\u0442 \\ winget uninstall VideoLAN.VLC \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043f\u0430\u043a\u0435\u0442 \\ winget download jqlang.jq \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438\u0442\u044c \u043f\u0430\u043a\u0435\u0442 (https://github.com/jqlang/jq/releases/download/jq-1.7/jq-windows-amd64.exe) \\ winget install jqlang.jq \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442 \u0432 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0443\u044e \u0441\u0440\u0435\u0434\u0443 \u0438 \u043f\u0441\u0435\u0432\u0434\u043e\u043d\u0438\u043c \u043a\u043e\u043c\u0430\u043d\u0434\u043d\u043e\u0439 \u0441\u0442\u0440\u043e\u043a\u0438 jq \\ winget uninstall jqlang.jq","title":"winget"},{"location":"#jqlang-install","text":"[uri]$url = $($(irm https://api.github.com/repos/jqlang/jq/releases/latest).assets.browser_download_url -match \"windows-amd64\").ToString() # \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0432\u0435\u0440\u0441\u0438\u044e latest \u043d\u0430 GitHub irm $url -OutFile \"C:\\Windows\\System32\\jq.exe\" # \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c jq.exe","title":"jqlang-install"},{"location":"#scoop","text":"Set-ExecutionPolicy RemoteSigned -Scope CurrentUser \\ irm get.scoop.sh | iex \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 \\ scoop help \\ scoop search jq \\ scoop info jq \\ (scoop info jq).version \\ scoop cat jq \\ scoop download jq C:\\Users\\lifailon\\scoop\\cache \\ scoop install jq C:\\Users\\lifailon\\scoop\\apps\\jq\\1.7 \\ scoop list \\ (scoop list).version \\ scoop uninstall jq","title":"Scoop"},{"location":"#chocolatey","text":"Set-ExecutionPolicy Bypass -Scope Process -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1')) choco -v \\ choco -help \\ choco list \\ choco install adobereader","title":"Chocolatey"},{"location":"#nuget","text":"Invoke-RestMethod https://dist.nuget.org/win-x86-commandline/latest/nuget.exe -OutFile \"$home\\Documents\\nuget.exe\" \\ Invoke-Expression \"$home\\Documents\\nuget.exe search Selenium.WebDriver\" \\ Invoke-Expression \"$home\\Documents\\nuget.exe install Selenium.WebDriver\" \\ Get-Item $home\\Documents\\*Selenium* & \"$home\\Documents\\nuget.exe\" list console-translate \\ $nuget_api_key = \"<API-KEY>\" \\ $source = \"https://api.nuget.org/v3/index.json\" \\ $Name = \"Console-Translate\" \\ $path = \"$home\\Documents\\$Name\" \\ New-Item -Type Directory $path \\ Copy-Item \"$home\\Documents\\Git\\$Name\\$Name\\0.2\\*\" \"$path\\\" \\ Copy-Item \"$home\\Documents\\Git\\$Name\\LICENSE\" \"$path\\\" \\ Copy-Item \"$home\\Documents\\Git\\$Name\\README.md\" \"$path\\\" '<?xml version=\"1.0\"?> <package > <metadata> <id>Console-Translate</id> <version>0.2.2</version> <authors>Lifailon</authors> <owners>Lifailon</owners> <description>Cross-platform client for translating text in the console, uses API Google (edded public free token), MyMemory and DeepLX (no token required)</description> <tags>PowerShell, Module, Translate, api</tags> <projectUrl>https://github.com/Lifailon/Console-Translate</projectUrl> <contentFiles> <files include=\"Console-Translate.psm1\" buildAction=\"Content\" /> <files include=\"Console-Translate.psd1\" buildAction=\"Content\" /> <files include=\"lang-iso-639-1.csv\" buildAction=\"Content\" /> <files include=\"README.md\" buildAction=\"Content\" /> <files include=\"LICENSE\" buildAction=\"Content\" /> </contentFiles> </metadata> </package>' > \"$path\\$Name.nuspec\" Set-Location $path \\ & \"$home\\Documents\\nuget.exe\" pack \"$path\\$Name.nuspec\" \\ & \"$home\\Documents\\nuget.exe\" push \"$path\\$Name.0.2.2.nupkg\" -ApiKey $nuget_api_key -Source $source \\ & \"$home\\Documents\\nuget.exe\" push \"$path\\$Name.0.2.2.nupkg\" -ApiKey $nuget_api_key -Source $source -SkipDuplicate Install-Package Console-Translate -Source nuget.org \\ Get-Package Console-Translate | select * Register-PSRepository -Name \"NuGet\" -SourceLocation \"https://www.nuget.org/api/v2\" -InstallationPolicy Trusted \\ Get-PSRepository \\ Find-Module -Name Console-Translate \\ Install-Module Console-Translate -Repository NuGet & \"$home\\Documents\\nuget.exe\" delete Console-Translate 0.2.0 -Source https://api.nuget.org/v3/index.json -ApiKey $nuget_api_key -NoPrompt","title":"NuGet"},{"location":"#git","text":"git --version \\ git config --global user.name \"Lifailon\" \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0438\u043c\u044f \u0434\u043b\u044f \u043a\u043e\u043c\u043c\u0438\u0442\u043e\u0432 \\ git config --global user.email \"lifailon@yandex.ru\" \\ git config --global --edit \\ ssh-keygen -t rsa -b 4096 \\ Get-Service | where name -match \"ssh-agent\" | Set-Service -StartupType Automatic \\ Get-Service | where name -match \"ssh-agent\" | Start-Service \\ Get-Service | where name -match \"ssh-agent\" | select Name,Status,StartType \\ ssh-agent \\ ssh-add C:\\Users\\Lifailon\\.ssh\\id_rsa \\ cat ~\\.ssh\\id_rsa.pub | Set-Clipboard copy to settings keys \\ cd $home\\Documents\\Git \\ git clone git@github.com:Lifailon/lifailon.github.io \\ cd lifailon.github.io \\ git grep \"ping ya.ru\" \u043f\u043e\u0438\u0441\u043a \u0442\u0435\u043a\u0441\u0442\u0430 \u0432 \u0444\u0430\u0439\u043b\u0430\u0445 \\ git fetch \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0438\u0437 \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u043e\u0433\u043e \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0430 \u0434\u043b\u044f \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0432\u0441\u0435\u0445 \u0432\u0435\u0442\u043e\u043a \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u043e\u0433\u043e \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u044f, \u043d\u0435 \u0437\u0430\u0442\u0440\u0430\u0433\u0438\u0432\u0430\u044f \u0442\u0435\u043a\u0443\u0449\u0443\u044e \u0440\u0430\u0431\u043e\u0447\u0443\u044e \u0432\u0435\u0442\u043a\u0443 (\u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u0442 \u0432\u0441\u0435 \u043a\u043e\u043c\u043c\u0438\u0442\u044b, \u0432\u0435\u0442\u043a\u0438 \u0438 \u0442.\u0434. \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043d\u0435 \u043f\u0440\u0438\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044e\u0442 \u0432 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u043e\u043c \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u0438) \\ git pull \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0438\u0437 \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u043e\u0433\u043e \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0430 \u0434\u043b\u044f \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u043e\u0433\u043e \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u044f (\u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442 git fetch \u0434\u043b\u044f \u0441\u0438\u043d\u0445\u0440\u043e\u043d\u0438\u0437\u0430\u0446\u0438\u0438 \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u043e\u0433\u043e \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u044f \u0441 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u043c \u0438 git merge \u0434\u043b\u044f \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0442\u0435\u043a\u0443\u0449\u0435\u0439 \u0440\u0430\u0431\u043e\u0447\u0435\u0439 \u0432\u0435\u0442\u043a\u0438) \\ git status \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0441\u0442\u0430\u0442\u0443\u0441 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0439 \u043f\u043e \u0444\u0430\u0439\u043b\u0430\u043c \\ git diff \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0438\u0441\u0442\u043e\u0440\u0438\u044e \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0439 \u043f\u043e\u0441\u0442\u0440\u043e\u0447\u043d\u043e \\ git diff pandoc \u0441\u0440\u0430\u0432\u043d\u0438\u0432\u0430\u0435\u0442 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0432 \u0442\u0435\u043a\u0443\u0449\u0435\u0439 \u0440\u0430\u0431\u043e\u0447\u0435\u0439 \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u0438 \u0441 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u043c \u043a\u043e\u043c\u043c\u0438\u0442\u043e\u043c \u0432 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0439 \u0432\u0435\u0442\u043a\u0435 \\ git add . \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c (\u043f\u0440\u043e\u0438\u043d\u0434\u0435\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u0442\u044c) \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0432\u043e \u0432\u0441\u0435\u0445 \u0444\u0430\u0439\u043b\u0430\u0445 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0430 \\ git commit -m \"update powershell commands\" \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0441 \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0435\u043c \\ git push \u0441\u0438\u043d\u0445\u0440\u043e\u043d\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u0435 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0441 \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u0435\u043c \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435 \\ git branch hugo \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043d\u043e\u0432\u0443\u044e \u0432\u0435\u0442\u043a\u0443 \\ git branch -m hugo-public \u043f\u0435\u0440\u0435\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u0442\u044c \u0442\u0435\u043a\u0443\u0449\u0443\u044e \u0432\u0435\u0442\u043a\u0443 \\ git branch -d hugo-public \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u0435\u0442\u043a\u0443 \\ git switch hugo \u043f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f \u043d\u0430 \u0434\u0440\u0443\u0433\u0443\u044e \u0432\u0435\u0442\u043a\u0443 \\ git push origin hugo \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0432 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u0443\u044e \u0432\u0435\u0442\u043a\u0443 \\ git push --set-upstream origin hugo \u043e\u0442\u0441\u043b\u0435\u0436\u0438\u0432\u0430\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0432 \u0432\u0435\u0442\u043a\u0435 (\u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0434\u0435\u043b\u0430\u0442\u044c push \u0431\u0435\u0437 \u0443\u043a\u0430\u0437\u0430\u043d\u0438\u044f \u0432\u0435\u0442\u043a\u0438) \\ git merge hugo \u0441\u043b\u0438\u044f\u043d\u0438\u0435 \u0442\u0435\u043a\u0443\u0449\u0435\u0439 \u0432\u0435\u0442\u043a\u0438 (pandoc) \u0441 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0439 (hugo) \\ git log --oneline --all \u043b\u043e\u0433 \u043a\u043e\u043c\u043c\u0438\u0442\u043e\u0432 \\ git log --graph \u043a\u043e\u043c\u043c\u0438\u0442\u044b \u0438 \u0441\u043b\u0435\u0434\u043e\u0432\u0430\u043d\u0438\u0435 \u0432\u0435\u0442\u043e\u043a \\ git log --author=\"Lifailon\" \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442 \u0438\u0441\u0442\u043e\u0440\u0438\u044e \u043a\u043e\u043c\u043c\u0438\u0442\u043e\u0432 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \\ git blame index.html \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442, \u043a\u0442\u043e \u0438 \u043a\u043e\u0433\u0434\u0430 \u0432\u043d\u0435\u0441 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0432 \u043a\u0430\u0436\u0434\u0443\u044e \u0441\u0442\u0440\u043e\u043a\u0443 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0433\u043e \u0444\u0430\u0439\u043b\u0430 \\ git show d01f09dead3a6a8d75dda848162831c58ca0ee13 \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u043f\u043e\u0434\u0440\u043e\u0431\u043d\u044b\u0439 \u043b\u043e\u0433 \u043f\u043e \u043d\u043e\u043c\u0435\u0440\u0443 \u043a\u043e\u043c\u043c\u0438\u0442\u0430 \\ git restore filename \u043e\u0442\u043c\u0435\u043d\u0438\u0442\u044c \u0432\u0441\u0435 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u0435 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0432 \u0440\u0430\u0431\u043e\u0447\u0435\u0439 \u043a\u043e\u043f\u0438\u0438 \u043d\u0435\u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e \u043e\u0442 \u0442\u043e\u0433\u043e, \u0431\u044b\u043b\u0438 \u043e\u043d\u0438 \u043f\u0440\u043e\u0438\u043d\u0434\u0435\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u044b \u0438\u043b\u0438 \u043d\u0435\u0442 (\u0435\u0441\u043b\u0438 \u0431\u044b\u043b\u0430 \u0438\u043d\u0434\u0435\u043a\u0441\u0430\u0446\u0438\u044f \u0447\u0435\u0440\u0435\u0437 add), \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u044f \u0435\u0433\u043e \u043a \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044e \u043d\u0430 \u043c\u043e\u043c\u0435\u043d\u0442 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u043a\u043e\u043c\u043c\u0438\u0442\u0430 \\ git restore --source d01f09dead3a6a8d75dda848162831c58ca0ee13 filename \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0444\u0430\u0439\u043b \u043d\u0430 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u0443\u044e \u0432\u0435\u0440\u0441\u0438\u044e \u043f\u043e \u0445\u044d\u0448\u0443 \u0438\u043d\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440\u0430 \u043a\u043e\u043c\u043c\u0438\u0442\u0430 \\ git checkout filename \u043e\u0442\u043a\u0430\u0442\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u043d\u0435 \u043f\u0440\u043e\u0438\u043d\u0434\u0435\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0435 \u0434\u043b\u044f \u043a\u043e\u043c\u043c\u0438\u0442\u0430, \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u044f \u0435\u0433\u043e \u043a \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044e, \u043a\u0430\u043a\u0438\u043c \u043e\u043d\u043e \u0431\u044b\u043b\u043e \u043d\u0430 \u043c\u043e\u043c\u0435\u043d\u0442 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u043a\u043e\u043c\u043c\u0438\u0442\u0430 (\u0435\u0441\u043b\u0438 \u043d\u0435 \u0431\u044b\u043b\u043e \u0438\u043d\u0434\u0435\u043a\u0441\u0430\u0446\u0438\u0438 \u0447\u0435\u0440\u0435\u0437 add) \\ git checkout d01f09dead3a6a8d75dda848162831c58ca0ee13 \u043f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u0435 \u0444\u0430\u0439\u043b\u044b \u0440\u0430\u0431\u043e\u0447\u0435\u0439 \u043a\u043e\u043f\u0438\u0438 \u043d\u0430 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u0439 \u043a\u043e\u043c\u043c\u0438\u0442 (\u043f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0430\u0435\u0442 HEAD \u043d\u0430 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u0439 \u043a\u043e\u043c\u043c\u0438\u0442) \\ git reset HEAD filename \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u0439 \u0444\u0430\u0439\u043b \u0438\u0437 \u0438\u043d\u0434\u0435\u043a\u0441\u0430 \u0431\u0435\u0437 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u044f \u0441\u0430\u043c\u0438\u0445 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0439 \u0432 \u0444\u0430\u0439\u043b\u0435 \u0434\u043b\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u0439 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e\u0439 \u0438\u043d\u0434\u0435\u043a\u0441\u0430\u0446\u0438\u0438 (\u0435\u0441\u043b\u0438 \u0431\u044b\u043b add \u043d\u043e \u043d\u0435 \u0431\u044b\u043b\u043e commit, \u043f\u043e\u0442\u043e\u043c \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c checkout) \\ git reset --soft HEAD^ \u043e\u0442\u043c\u0435\u043d\u044f\u0435\u0442 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0439 (^) \u043a\u043e\u043c\u043c\u0438\u0442, \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u044f \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0438\u0437 \u044d\u0442\u043e\u0433\u043e \u043a\u043e\u043c\u043c\u0438\u0442\u0430 \u0432 \u0440\u0430\u0431\u043e\u0447\u0435\u043c \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0435 \u0438 \u0438\u043d\u0434\u0435\u043a\u0441\u0435 (\u043f\u043e\u0434\u0433\u043e\u0442\u043e\u0432\u043b\u0435\u043d\u043d\u043e\u0439 \u043e\u0431\u043b\u0430\u0441\u0442\u0438), \u043c\u043e\u0436\u043d\u043e \u0432\u043d\u0435\u0441\u0442\u0438 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0432 \u0444\u0430\u0439\u043b\u044b \u0438 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e \u0438\u0445 \u0437\u0430\u0444\u0438\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u0442\u044c \\ git reset --hard HEAD^ \u043f\u043e\u043b\u043d\u043e\u0441\u0442\u044c\u044e \u043e\u0442\u043c\u0435\u043d\u044f\u0435\u0442 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0439 \u043a\u043e\u043c\u043c\u0438\u0442, \u0443\u0434\u0430\u043b\u044f\u044f \u0432\u0441\u0435 \u0435\u0433\u043e \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0438\u0437 \u0440\u0430\u0431\u043e\u0447\u0435\u0433\u043e \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0430 \u0438 \u0438\u043d\u0434\u0435\u043a\u0441\u0430 \u0434\u043e \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u043a\u043e\u043c\u043c\u0438\u0442\u0430 \\ git reset --hard d01f09dead3a6a8d75dda848162831c58ca0ee13 \u043e\u0442\u043a\u0430\u0442\u044b\u0432\u0430\u0435\u0442 HEAD \u043a \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u043c\u0443 \u043a\u043e\u043c\u043c\u0438\u0442\u0443 \u0438 \u0443\u0434\u0430\u043b\u044f\u0435\u0442 \u0432\u0441\u0435 \u043a\u043e\u043c\u043c\u0438\u0442\u044b, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0431\u044b\u043b\u0438 \u0441\u0434\u0435\u043b\u0430\u043d\u044b \u043f\u043e\u0441\u043b\u0435 \u043d\u0435\u0433\u043e (\u0431\u0443\u0434\u0443\u0442 \u043f\u043e\u0442\u0435\u0440\u044f\u043d\u044b \u0432\u0441\u0435 \u043d\u0435\u0437\u0430\u043a\u043e\u043c\u043c\u0438\u0447\u0435\u043d\u043d\u044b\u0435 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0438 \u0438\u0441\u0442\u043e\u0440\u0438\u044e \u043a\u043e\u043c\u043c\u0438\u0442\u043e\u0432 \u043f\u043e\u0441\u043b\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0433\u043e) \\ git revert HEAD --no-edit \u0441\u043e\u0437\u0434\u0430\u0435\u0442 \u043d\u043e\u0432\u044b\u0439 \u043a\u043e\u043c\u043c\u0438\u0442, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043e\u0442\u043c\u0435\u043d\u044f\u0435\u0442 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0439 \u043a\u043e\u043c\u043c\u0438\u0442 (HEAD) \u0438 \u043d\u043e\u0432\u044b\u0439 \u043a\u043e\u043c\u043c\u0438\u0442 \u0431\u0443\u0434\u0435\u0442 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d \u043f\u043e\u0432\u0435\u0440\u0445 \u043d\u0435\u0433\u043e (\u0441\u043e\u0431\u044b\u0442\u0438\u044f \u0437\u0430\u043f\u0438\u0441\u044b\u0432\u0430\u044e\u0442\u0441\u044f \u0432 git log) \\ git revert d01f09dead3a6a8d75dda848162831c58ca0ee13 \u0441\u043e\u0437\u0434\u0430\u0435\u0442 \u043d\u043e\u0432\u044b\u0439 \u043a\u043e\u043c\u043c\u0438\u0442, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043e\u0442\u043c\u0435\u043d\u044f\u0435\u0442 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f, \u0432\u043d\u0435\u0441\u0435\u043d\u043d\u044b\u0435 \u0432 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u0439 \u043a\u043e\u043c\u043c\u0438\u0442 \u0441 \u0445\u0435\u0448\u0435\u043c (\u043d\u0435 \u0438\u0437\u043c\u0435\u043d\u044f\u0435\u0442 \u0438\u0441\u0442\u043e\u0440\u0438\u044e \u043a\u043e\u043c\u043c\u0438\u0442\u043e\u0432, \u0430 \u0441\u043e\u0437\u0434\u0430\u0435\u0442 \u043d\u043e\u0432\u044b\u0439 \u043a\u043e\u043c\u043c\u0438\u0442 \u0441 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f\u043c\u0438 \u043e\u0442\u043c\u0435\u043d\u044b) \\ git stash \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u0442 \u0442\u0435\u043a\u0443\u0449\u0438\u0435 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0432 \u0441\u0442\u044d\u0448 (\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e\u0435 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435) \u0438 \u043e\u0447\u0438\u0449\u0430\u0435\u0442 \u0440\u0430\u0431\u043e\u0447\u0443\u044e \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u044e \\ git stash pop \u043f\u0440\u0438\u043c\u0435\u043d\u044f\u0435\u0442 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0435 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0438\u0437 \u0441\u0442\u044d\u0448\u0430 \u043a \u0442\u0435\u043a\u0443\u0449\u0435\u0439 \u0432\u0435\u0442\u043a\u0435","title":"Git"},{"location":"#github","text":"$user = \"Lifailon\" \\ $repository = \"ReverseProxyNET\" \\ Invoke-RestMethod https://api.github.com/users/$($user) \\ Invoke-RestMethod https://api.github.com/users/$($user)/repos \\ Invoke-RestMethod https://api.github.com/repos/$($user)/$($repository)/contents \\ Invoke-RestMethod https://api.github.com/repos/$($user)/$($repository)/contents/source/rpnet.cs \\ Invoke-RestMethod https://api.github.com/repos/$($user)/$($repository)/commits \\ $sha = $(Invoke-RestMethod https://api.github.com/repos/$($user)/$($repository)/commits).sha \\ Invoke-RestMethod https://api.github.com/repos/$($user)/$($repository)/commits/$($sha[-1]) \\ Invoke-RestMethod \"https://api.github.com/repos/$($user)/$($repository)/releases/latest\" \\ $(Invoke-RestMethod \"https://api.github.com/repos/$($user)/$($repository)/releases/latest\").assets.name \\ $issues = Invoke-RestMethod https://api.github.com/repos/LibreHardwareMonitor/LibreHardwareMonitor/issues \\ $issue_number = $($issues | Where-Object title -match \"PowerShell\").number \\ Invoke-RestMethod https://api.github.com/repos/LibreHardwareMonitor/LibreHardwareMonitor/issues/$($issue_number)/comments \\ Invoke-RestMethod https://api.github.com/repos/LibreHardwareMonitor/LibreHardwareMonitor/pulls \\ Invoke-RestMethod https://api.github.com/repos/LibreHardwareMonitor/LibreHardwareMonitor/languages \\ Invoke-RestMethod https://api.github.com/repos/LibreHardwareMonitor/LibreHardwareMonitor/stargazers \\ Invoke-RestMethod https://api.github.com/repos/LibreHardwareMonitor/LibreHardwareMonitor/forks \\ Invoke-RestMethod https://api.github.com/repos/LibreHardwareMonitor/LibreHardwareMonitor/subscribers","title":"GitHub"},{"location":"#dsc","text":"Import-Module PSDesiredStateConfiguration \\ Get-Command -Module PSDesiredStateConfiguration \\ (Get-Module PSDesiredStateConfiguration).ExportedCommands \\ Get-DscLocalConfigurationManager Get-DscResource \\ Get-DscResource -Name File -Syntax \u0441\u0438\u043d\u0442\u0430\u043a\u0441\u0438\u0441 Ensure = Present \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430 \u0434\u043e\u043b\u0436\u043d\u0430 \u0431\u044b\u0442\u044c \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u0430 (\u043a\u0430\u0442\u0430\u043b\u043e\u0433 \u0434\u043e\u043b\u0436\u0435\u043d \u043f\u0440\u0438\u0441\u0443\u0442\u0441\u0442\u0432\u043e\u0432\u0430\u0442\u044c, \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u0437\u0430\u043f\u0443\u0449\u0435\u043d, \u0435\u0441\u043b\u0438 \u043d\u0435\u0442 \u2013 \u0441\u043e\u0437\u0434\u0430\u0442\u044c, \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c) \\ Ensure = Absent \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430 \u0434\u043e\u043b\u0436\u043d\u0430 \u0431\u044b\u0442\u044c \u0432\u044b\u043a\u043b\u044e\u0447\u0435\u043d\u0430 (\u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0430 \u0431\u044b\u0442\u044c \u043d\u0435 \u0434\u043e\u043b\u0436\u043d\u043e, \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u043d\u0435 \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u0437\u0430\u043f\u0443\u0449\u0435\u043d, \u0435\u0441\u043b\u0438 \u043d\u0435\u0442 \u2013 \u0443\u0434\u0430\u043b\u0438\u0442\u044c, \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c) Configuration TestConfiguraion { Ctrl+Space } Configuration DSConfigurationProxy { Node vproxy-01 { File CreateDir { Ensure = \"Present\" Type = \"Directory\" DestinationPath = \"C:\\Temp\" } Service StopW32time { Name = \"w32time\" State = \"Stopped\"` Running } WindowsProcess RunCalc { Ensure = \"Present\" Path = \"C:\\WINDOWS\\system32\\calc.exe\" Arguments = \"\" } Registry RegSettings { Ensure = \"Present\" Key = \"HKEY_LOCAL_MACHINE\\SOFTWARE\\MySoft\" ValueName = \"TestName\" ValueData = \"TestValue\" ValueType = \"String\" } # WindowsFeature IIS # { # Ensure = \"Present\" # Name = \"Web-Server\" # } } } $Path = (DSConfigurationProxy).DirectoryName \\ Test-DscConfiguration -Path $Path | select * ResourcesInDesiredState - \u0443\u0436\u0435 \u043d\u0430\u0441\u0442\u0440\u043e\u0435\u043d\u043e, ResourcesNotInDesiredState - \u043d\u0435 \u043d\u0430\u0441\u0442\u0440\u043e\u0435\u043d\u043e (\u043d\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442) \\ Start-DscConfiguration -Path $Path \\ Get-Job \\ $srv = \"vproxy-01\" \\ Get-Service -ComputerName $srv | ? name -match w32time # Start-Service \\ icm $srv {Get-Process | ? ProcessName -match calc} | ft # Stop-Process -Force \\ icm $srv {ls C:\\ | ? name -match Temp} | ft rm` Configuration InstallPowerShellCore { Import-DscResource -ModuleName PSDesiredStateConfiguration Node localhost { Script InstallPowerShellCore { GetScript = { return @{ GetScript = $GetScript } } SetScript = { [string]$url = $(Invoke-RestMethod https://api.github.com/repos/PowerShell/PowerShell/releases/latest).assets.browser_download_url -match \"win-x64.zip\" $downloadPath = \"$home\\Downloads\\PowerShell.zip\" $installPath = \"$env:ProgramFiles\\PowerShell\\7\" Invoke-WebRequest -Uri $url -OutFile $downloadPath Expand-Archive -Path $downloadPath -DestinationPath $installPath -Force } TestScript = { return Test-Path \"$env:ProgramFiles\\PowerShell\\7\\pwsh.exe\" } } } } $Path = (InstallPowerShellCore).DirectoryName \\ Test-DscConfiguration -Path $Path \\ Start-DscConfiguration -Path $path -Wait -Verbose \\ Get-Job","title":"DSC"},{"location":"#ansible","text":"apt -y update && apt -y upgrade \\ apt -y install ansible v2.10.8 \\ apt -y install ansible-core v2.12.0 \\ apt -y install sshpass ansible-galaxy collection install ansible.windows \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043a\u043e\u043b\u043b\u0435\u043a\u0446\u0438\u044e \u043c\u043e\u0434\u0443\u043b\u0435\u0439 \\ ansible-galaxy collection install community.windows \\ ansible-galaxy collection list | grep windows \\ ansible-config dump | grep DEFAULT_MODULE_PATH \u043f\u0443\u0442\u044c \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u043c\u043e\u0434\u0443\u043b\u0435\u0439 apt-get -y install python-dev libkrb5-dev krb5-user \u043f\u0430\u043a\u0435\u0442\u044b \u0434\u043b\u044f Kerberos \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438 \\ apt install python3-pip \\ pip3 install requests-kerberos \\ nano /etc/krb5.conf \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c [realms] \u0438 [domain_realm] \\ kinit -C support4@domail.local \\ klist ansible --version \\ config file = None \\ nano /etc/ansible/ansible.cfg \u0444\u0430\u0439\u043b \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438 [defaults] inventory = /etc/ansible/hosts # uncomment this to disable SSH key host checking # \u041e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0443 \u043a\u043b\u044e\u0447\u0430 ssh (\u0434\u043b\u044f \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044f \u043f\u0430\u0440\u043e\u043b\u044c) host_key_checking = False","title":"Ansible"},{"location":"#hosts","text":"nano /etc/ansible/hosts [us] pi-hole-01 ansible_host=192.168.3.101 zabbix-01 ansible_host=192.168.3.102 grafana-01 ansible_host=192.168.3.103 netbox-01 ansible_host=192.168.3.104 [all:vars] ansible_ssh_port=2121 ansible_user=lifailon ansible_password=123098 path_user=/home/lifailon ansible_python_interpreter=/usr/bin/python3 [ws] huawei-book-01 ansible_host=192.168.3.99 plex-01 ansible_host=192.168.3.100 [ws:vars] ansible_port=5985 #ansible_port=5986 ansible_user=Lifailon #ansible_user=support4@DOMAIN.LOCAL ansible_password=123098 ansible_connection=winrm ansible_winrm_scheme=http ansible_winrm_transport=basic #ansible_winrm_transport=kerberos ansible_winrm_server_cert_validation=ignore validate_certs=false [win_ssh] huawei-book-01 ansible_host=192.168.3.99 plex-01 ansible_host=192.168.3.100 [win_ssh:vars] ansible_python_interpreter=C:\\Users\\Lifailon\\AppData\\Local\\Programs\\Python\\Python311\\` \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0443\u044e \u0441\u0440\u0435\u0434\u044b \u0438\u043d\u0442\u0435\u0440\u043f\u0440\u0438\u0442\u0430\u0442\u043e\u0440\u0430 Python \u0432 Windows ansible_connection=ssh #ansible_shell_type=cmd ansible_shell_type=powershell ansible-inventory --list \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044e (\u0447\u0438\u0442\u0430\u0435\u0442 \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 JSON) \u0438\u043b\u0438 YAML (-y) \u0441 \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u043e\u043c \u0432\u0441\u0435 \u043f\u0440\u0438\u043c\u0435\u043d\u044f\u0435\u043c\u044b\u0445 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0445","title":"Hosts"},{"location":"#win_modules","text":"ansible us -m ping \\ ansible win_ssh -m ping \\ ansible us -m shell -a \"uptime && df -h | grep lv\" \\ ansible us -m setup | grep -iP \"mem|proc\" \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043e \u0436\u0435\u043b\u0435\u0437\u0435 \\ ansible us -m apt -a \"name=mc\" -b \u043f\u043e\u0432\u044b\u0441\u0438\u0442\u044c \u043f\u0440\u0438\u0432\u0438\u043b\u0435\u0433\u0438\u0438 sudo (-b) \\ ansible us -m service -a \"name=ssh state=restarted enabled=yes\" -b \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0441\u043b\u0443\u0436\u0431\u0443 \\ echo \"echo test\" > test.sh \\ ansible us -m copy -a \"src=test.sh dest=/root mode=777\" -b \\ ansible us -a \"ls /root\" -b \\ ansible us -a \"cat /root/test.sh\" -b ansible-doc -l | grep win_ \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u043c\u043e\u0434\u0443\u043b\u0435\u0439 Windows \\ ansible ws -m win_ping windows \u043c\u043e\u0434\u0443\u043b\u044c \\ ansible ws -m win_ping -u WinRM-Writer \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u043b\u043e\u0433\u0438\u043d \\ ansible ws -m setup \u0441\u043e\u0431\u0440\u0430\u0442\u044c \u043f\u043e\u0434\u0440\u043e\u0431\u043d\u0443\u044e \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u043e \u0441\u0438\u0441\u0442\u0435\u043c\u0435 \\ ansible ws -m win_whoami \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043e \u043f\u0440\u0430\u0432\u0430\u0445 \u0434\u043e\u0441\u0442\u0443\u043f\u0430\u0445, \u0433\u0440\u0443\u043f\u043f\u0430\u0445 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \\ ansible ws -m win_shell -a '$PSVersionTable' \\ ansible ws -m win_shell -a 'Get-Service | where name -match \"ssh|winrm\"' \\ ansible ws -m win_service -a \"name=sshd state=stopped\" \\ ansible ws -m win_service -a \"name=sshd state=started\"","title":"Win_Modules"},{"location":"#win_shell-varsdebug","text":"nano /etc/ansible/PowerShell-Vars.yml - hosts: ws ` \u0423\u043a\u0430\u0437\u0430\u0442\u044c \u043a\u043e\u043b\u043b\u0435\u043a\u0446\u0438\u044e \u043c\u043e\u0434\u0443\u043b\u0435\u0439 collections: - ansible.windows ` \u0417\u0430\u0434\u0430\u0442\u044c \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 vars: SearchName: PermitRoot tasks: - name: Get port ssh win_shell: | Get-Content \"C:\\Programdata\\ssh\\sshd_config\" | Select-String \"{{SearchName}}\" ` \u041f\u0435\u0440\u0435\u0434\u0430\u0442\u044c \u0432\u044b\u0432\u043e\u0434 \u0432 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0443\u044e register: command_output - name: Output port ssh ` \u0412\u044b\u0432\u0435\u0441\u0442\u0438 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0443\u044e \u043d\u0430 \u044d\u043a\u0440\u0430\u043d debug: var: command_output.stdout_lines ansible-playbook /etc/ansible/PowerShell-Vars.yml \\ ansible-playbook /etc/ansible/PowerShell-Vars.yml --extra-vars \"SearchName='LogLevel|Syslog'\" \u043f\u0435\u0440\u0435\u0434\u0430\u0442\u044c \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0443\u044e","title":"win_shell (vars/debug)"},{"location":"#win_powershell","text":"nano /etc/ansible/powershell-param.yml - hosts: ws tasks: - name: Run PowerShell script with parameters ansible.windows.win_powershell: parameters: Path: C:\\Temp Force: true script: | [CmdletBinding()] param ( [String]$Path, [Switch]$Force ) New-Item -Path $Path -ItemType Directory -Force:$Force ansible-playbook /etc/ansible/powershell-param.yml","title":"win_powershell"},{"location":"#win_chocolatey","text":"nano /etc/ansible/setup-adobe-acrobat.yml - hosts: ws tasks: - name: Install Acrobat Reader win_chocolatey: name: adobereader state: present ansible-playbook /etc/ansible/setup-adobe-acrobat.yml nano /etc/ansible/setup-openssh.yml - hosts: ws tasks: - name: install the Win32-OpenSSH service win_chocolatey: name: openssh package_params: /SSHServerFeature state: present ansible-playbook /etc/ansible/setup-openssh.yml","title":"win_chocolatey"},{"location":"#win_regedit","text":"nano /etc/ansible/win-set-shell-ssh-ps7.yml - hosts: ws tasks: - name: Set the default shell to PowerShell 7 for Windows OpenSSH win_regedit: path: HKLM:\\SOFTWARE\\OpenSSH name: DefaultShell ` data: C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe data: 'C:\\Program Files\\PowerShell\\7\\pwsh.exe' type: string state: present ansible-playbook /etc/ansible/win-set-shell-ssh-ps7.yml","title":"win_regedit"},{"location":"#win_service","text":"nano /etc/ansible/win-service.yml - hosts: ws tasks: - name: Start service win_service: name: sshd state: started # state: stopped # state: restarted # start_mode: auto ansible-playbook /etc/ansible/win-service.yml","title":"win_service"},{"location":"#win_service_info","text":"nano /etc/ansible/get-service.yml - hosts: ws tasks: - name: Get info for a single service win_service_info: name: sshd register: service_info - name: Print returned information ansible.builtin.debug: var: service_info.services ansible-playbook /etc/ansible/get-service.yml","title":"win_service_info"},{"location":"#fetchslurp","text":"nano /etc/ansible/copy-from-win-to-local.yml - hosts: ws tasks: - name: Retrieve remote file on a Windows host # \u0421\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0444\u0430\u0439\u043b \u0438\u0437 Windows-\u0441\u0438\u0441\u0442\u0435\u043c\u044b ansible.builtin.fetch: # \u041f\u0440\u043e\u0447\u0438\u0442\u0430\u0442\u044c \u0444\u0430\u0439\u043b (\u043f\u0435\u0440\u0435\u0434\u0430\u0442\u044c \u0432 \u043f\u0430\u043c\u044f\u0442\u044c \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 Base64) # ansible.builtin.slurp: src: C:\\Telegraf\\telegraf.conf dest: /root/telegraf.conf flat: yes register: telegraf_conf - name: Print returned information ansible.builtin.debug: msg: \"{{ telegraf_conf['content'] | b64decode }}\" ansible-playbook /etc/ansible/copy-from-win-to-local.yml","title":"fetch/slurp"},{"location":"#win_copy","text":"echo \"Get-Service | where name -eq vss | Start-Service\" > /home/lifailon/Start-Service-VSS.ps1 \\ nano /etc/ansible/copy-file-to-win.yml - hosts: ws tasks: - name: Copy file to win hosts win_copy: src: /home/lifailon/Start-Service-VSS.ps1 dest: C:\\Users\\Lifailon\\Desktop\\Start-Service-VSS.ps1 ansible-playbook /etc/ansible/copy-file-to-win.yml curl -OL https://github.com/PowerShell/PowerShell/releases/download/v7.3.6/PowerShell-7.3.6-win-x64.msi \\ nano /etc/ansible/copy-file-to-win.yml - hosts: ws tasks: - name: Copy file to win hosts win_copy: src: /home/lifailon/PowerShell-7.3.6-win-x64.msi dest: C:\\Install\\PowerShell-7.3.6.msi ansible-playbook /etc/ansible/copy-file-to-win.yml","title":"win_copy"},{"location":"#win_command","text":"nano /etc/ansible/run-script-ps1.yml - hosts: ws tasks: - name: Run PowerShell Script win_command: powershell -ExecutionPolicy ByPass -File C:\\Users\\Lifailon\\Desktop\\Start-Service-VSS.ps1 ansible-playbook /etc/ansible/run-script-ps1.yml","title":"win_command"},{"location":"#win_package","text":"nano /etc/ansible/setup-msi-package.yml - hosts: ws tasks: - name: Install MSI Package win_package: # path: C:\\Install\\7z-23.01.msi path: C:\\Install\\PowerShell-7.3.6.msi arguments: - /quiet - /passive - /norestart ansible-playbook /etc/ansible/setup-msi-package.yml","title":"win_package"},{"location":"#win_firewall_rule","text":"nano /etc/ansible/win-fw-open.yml - hosts: ws tasks: - name: Open RDP port win_firewall_rule: name: Open RDP port localport: 3389 action: allow direction: in protocol: tcp state: present enabled: yes ansible-playbook /etc/ansible/win-fw-open.yml","title":"win_firewall_rule"},{"location":"#win_group","text":"nano /etc/ansible/win-creat-group.yml - hosts: ws tasks: - name: Create a new group win_group: name: deploy description: Deploy Group state: present ansible-playbook /etc/ansible/win-creat-group.yml","title":"win_group"},{"location":"#win_group_membership","text":"nano /etc/ansible/add-user-to-group.yml - hosts: ws tasks: - name: Add a local and domain user to a local group win_group_membership: name: deploy members: - WinRM-Writer state: present ansible-playbook /etc/ansible/add-user-to-group.yml","title":"win_group_membership"},{"location":"#win_user","text":"nano /etc/ansible/creat-win-user.yml - hosts: ws tasks: - name: Creat user win_user: name: test password: 123098 state: present groups: - deploy ansible-playbook /etc/ansible/creat-win-user.yml nano /etc/ansible/delete-win-user.yml - hosts: ws tasks: - name: Delete user ansible.windows.win_user: name: test state: absent ansible-playbook /etc/ansible/delete-win-user.yml","title":"win_user"},{"location":"#win_feature","text":"nano /etc/ansible/install-feature.yml - hosts: ws tasks: - name: Install Windows Feature win_feature: name: SNMP-Service state: present ansible-playbook /etc/ansible/install-feature.yml","title":"win_feature"},{"location":"#win_reboot","text":"nano /etc/ansible/win-reboot.yml - hosts: ws tasks: - name: Reboot a slow machine that might have lots of updates to apply win_reboot: reboot_timeout: 3600 ansible-playbook /etc/ansible/win-reboot.yml","title":"win_reboot"},{"location":"#win_find","text":"nano /etc/ansible/win-ls.yml - hosts: ws tasks: - name: Find files in multiple paths ansible.windows.win_find: paths: - D:\\Install\\OpenSource patterns: ['*.rar','*.zip','*.msi'] ` \u0424\u0430\u0439\u043b \u0441\u043e\u0437\u0434\u0430\u043d\u043d\u044b\u0439 \u043c\u0435\u043d\u0435\u0435 7 \u0434\u043d\u0435\u0439 \u043d\u0430\u0437\u0430\u0434 age: -7d ` \u0420\u0430\u0437\u043c\u0435\u0440 \u0444\u0430\u0439\u043b\u0430 \u0431\u043e\u043b\u044c\u0448\u0435 10MB size: 10485760 ` \u0420\u0435\u043a\u0443\u0440\u0441\u0438\u0432\u043d\u044b\u0439 \u043f\u043e\u0438\u0441\u043a (\u0432 \u0434\u043e\u0447\u0435\u0440\u043d\u0438\u0445 \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u044f\u0445) recurse: true register: command_output - name: Output debug: var: command_output ansible-playbook /etc/ansible/win-ls.yml","title":"win_find"},{"location":"#win_uri","text":"nano /etc/ansible/rest-get.yml - hosts: ws tasks: - name: REST GET request to endpoint github ansible.windows.win_uri: url: https://api.github.com/repos/Lifailon/pSyslog/releases/latest register: http_output - name: Output debug: var: http_output ansible-playbook /etc/ansible/rest-get.yml","title":"win_uri"},{"location":"#win_updates","text":"nano /etc/ansible/win-update.yml - hosts: ws tasks: - name: Install only particular updates based on the KB numbers ansible.windows.win_updates: category_names: - SecurityUpdates - CriticalUpdates - UpdateRollups - Drivers ` \u0424\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u044f ` accept_list: ` - KB2267602 ` \u041f\u043e\u0438\u0441\u043a \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0439 ` state: searched ` \u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f ` state: downloaded ` \u0423\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f state: installed log_path: C:\\Ansible-Windows-Upadte-Log.txt reboot: false register: wu_output - name: Output debug: var: wu_output ansible-playbook /etc/ansible/win-update.yml","title":"win_updates"},{"location":"#win_chocolatey_1","text":"Install \\ API \\ Deployment - name: Ensure Chocolatey installed from internal repo win_chocolatey: name: chocolatey state: present # source: URL-\u0430\u0434\u0440\u0435\u0441 \u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u0435\u0433\u043e \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u044f source: https://community.chocolatey.org/api/v2/ChocolateyInstall.ps1","title":"win_chocolatey"},{"location":"#gigachat","text":"Developers chat","title":"GigaChat"},{"location":"#1","text":"Invoke-WebRequest \"https://gu-st.ru/content/lending/russian_trusted_root_ca_pem.crt\" -OutFile \"$home\\Downloads\\russian_trusted_root_ca.cer\" \u0441\u043a\u0430\u0447\u0430\u0442\u044c \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 \u043c\u0438\u043d\u0446\u0438\u0444\u0440\u044b \\ Invoke-WebRequest \"https://gu-st.ru/content/lending/russian_trusted_sub_ca_pem.crt\" -OutFile \"$home\\Downloads\\russian_trusted_sub_ca.cer\" \\ Import-Certificate -FilePath \"$home\\Downloads\\russian_trusted_root_ca.cer\" -CertStoreLocation \"Cert:\\CurrentUser\\Root\" \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 \u043c\u0438\u043d\u0446\u0438\u0444\u0440\u044b \\ Import-Certificate -FilePath \"$home\\Downloads\\russian_trusted_sub_ca.cer\" -CertStoreLocation \"Cert:\\CurrentUser\\CA\"","title":"1. \u0423\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432:"},{"location":"#2-sber-id-developers-30","text":"","title":"2. \u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f \u043f\u043e Sber ID \u0438 \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f \u043d\u043e\u0432\u044b\u0445 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445 \u0434\u043b\u044f \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u0442\u043e\u043a\u0435\u043d\u0430: Developers (\u0432\u0440\u0435\u043c\u044f \u0436\u0438\u0437\u043d\u0438 30 \u043c\u0438\u043d\u0443\u0442)"},{"location":"#3-base64-client-id-client-secret","text":"$Client_ID = \"7e6d2f9f-825e-49b7-98f4-62fbb7506427\" # [System.Guid]::Parse(\"7e6d2f9f-825e-49b7-98f4-62fbb7506427\") $Client_Secret = \"c35113ee-6757-47ba-9853-ea1d0d9db1ef\" # [System.Guid]::Parse(\"c35113ee-6757-47ba-9853-ea1d0d9db1ef\") $Client_Join = $Client_ID+\":\"+$Client_Secret # \u043e\u0431\u044a\u0435\u0434\u0438\u043d\u044f\u0435\u043c \u0434\u0432\u0430 UUID \u0432 \u043e\u0434\u043d\u0443 \u0441\u0442\u0440\u043e\u043a\u0443, \u0440\u0430\u0437\u0434\u0435\u043b\u044f\u044f \u0438\u0445 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u043c ':' $Bytes = [System.Text.Encoding]::UTF8.GetBytes($Client_Join) # \u043f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u0443\u0435\u043c \u0441\u0442\u0440\u043e\u043a\u0443 \u0432 \u043c\u0430\u0441\u0441\u0438\u0432 \u0431\u0430\u0439\u0442 $Cred_Base64 = [Convert]::ToBase64String($Bytes) # \u043a\u043e\u0434\u0438\u0440\u0443\u0435\u043c \u0431\u0430\u0439\u0442\u044b \u0432 \u0441\u0442\u0440\u043e\u043a\u0443 Base64","title":"3. \u0424\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445 \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 Base64 \u0438\u0437 Client ID \u0438 Client Secret:"},{"location":"#4","text":"$Cred_Base64 = \"N2U2ZDJmOWYtODI1ZS00OWI3LTk4ZjQtNjJmYmI3NTA2NDI3OmIyYzgwZmZmLTEzOGUtNDg1Mi05MjgwLWE2MGI4NTc0YTM2MQ==\" \\ $UUID = [System.Guid]::NewGuid() \u0433\u0435\u043d\u0435\u0440\u0438\u0440\u0443\u0435\u043c UUID \u0434\u043b\u044f \u0436\u0443\u0440\u043d\u0430\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0432\u0445\u043e\u0434\u044f\u0449\u0438\u0445 \u0432\u044b\u0437\u043e\u0432\u043e\u0432 \u0438 \u0440\u0430\u0437\u0431\u043e\u0440\u0430 \u0438\u043d\u0446\u0438\u0434\u0435\u043d\u0442\u043e\u0432 $url = \"https://ngw.devices.sberbank.ru:9443/api/v2/oauth\" $headers = @{ \"Authorization\" = \"Basic $Cred_Base64\" \"RqUID\" = \"$UUID\" \"Content-Type\" = \"application/x-www-form-urlencoded\" } $body = @{ scope = \"GIGACHAT_API_PERS\" } $GIGA_TOKEN = $(Invoke-RestMethod -Uri $url -Method POST -Headers $headers -Body $body).access_token","title":"4. \u041f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 \u0442\u043e\u043a\u0435\u043d\u0430:"},{"location":"#5","text":"[string]$content = \"\u041f\u043e\u0441\u0447\u0438\u0442\u0430\u0439 \u0441\u0443\u043c\u043c\u0443 \u0447\u0438\u0441\u0435\u043b: 22+33\" [string]$role = \"user\" # \u0440\u043e\u043b\u044c \u0430\u0432\u0442\u043e\u0440\u0430 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f (user/assistant/system) [float]$temperature = 0.7 # \u0442\u0435\u043c\u043f\u0435\u0440\u0430\u0442\u0443\u0440\u0430 \u0432\u044b\u0431\u043e\u0440\u043a\u0438 \u0432 \u0434\u0438\u0430\u043f\u0430\u0437\u043e\u043d\u0435 \u043e\u0442 0 \u0434\u043e 2. \u0427\u0435\u043c \u0432\u044b\u0448\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435, \u0442\u0435\u043c \u0431\u043e\u043b\u0435\u0435 \u0441\u043b\u0443\u0447\u0430\u0439\u043d\u044b\u043c \u0431\u0443\u0434\u0435\u0442 \u043e\u0442\u0432\u0435\u0442 \u043c\u043e\u0434\u0435\u043b\u0438. [float]$top_p = 0.1 # \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u043a\u0430\u043a \u0430\u043b\u044c\u0442\u0435\u0440\u043d\u0430\u0442\u0438\u0432\u0430 temperature \u0438 \u0438\u0437\u043c\u0435\u043d\u044f\u0435\u0442\u0441\u044f \u0432 \u0434\u0438\u0430\u043f\u0430\u0437\u043e\u043d\u0435 \u043e\u0442 0 \u0434\u043e 1. \u0417\u0430\u0434\u0430\u0435\u0442 \u0432\u0435\u0440\u043e\u044f\u0442\u043d\u043e\u0441\u0442\u043d\u0443\u044e \u043c\u0430\u0441\u0441\u0443 \u0442\u043e\u043a\u0435\u043d\u043e\u0432, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0434\u043e\u043b\u0436\u043d\u0430 \u0443\u0447\u0438\u0442\u044b\u0432\u0430\u0442\u044c \u043c\u043e\u0434\u0435\u043b\u044c. \u0422\u0430\u043a, \u0435\u0441\u043b\u0438 \u043f\u0435\u0440\u0435\u0434\u0430\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 0.1, \u043c\u043e\u0434\u0435\u043b\u044c \u0431\u0443\u0434\u0435\u0442 \u0443\u0447\u0438\u0442\u044b\u0432\u0430\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0442\u043e\u043a\u0435\u043d\u044b, \u0447\u044c\u044f \u0432\u0435\u0440\u043e\u044f\u0442\u043d\u043e\u0441\u0442\u043d\u0430\u044f \u043c\u0430\u0441\u0441\u0430 \u0432\u0445\u043e\u0434\u0438\u0442 \u0432 \u0432\u0435\u0440\u0445\u043d\u0438\u0435 10%. [int64]$n = 1 # \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u043e\u0432 \u043e\u0442\u0432\u0435\u0442\u043e\u0432 (1..4), \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043d\u0443\u0436\u043d\u043e \u0441\u0433\u0435\u043d\u0435\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0432\u0445\u043e\u0434\u043d\u043e\u0433\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f [int64]$max_tokens = 512 # \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0442\u043e\u043a\u0435\u043d\u043e\u0432, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0431\u0443\u0434\u0443\u0442 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u044b \u0434\u043b\u044f \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f \u043e\u0442\u0432\u0435\u0442\u043e\u0432 [boolean]$stream = $false # \u043f\u0435\u0440\u0435\u0434\u0430\u0432\u0430\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u043f\u043e \u0447\u0430\u0441\u0442\u044f\u043c \u0432 \u043f\u043e\u0442\u043e\u043a\u0435","title":"5. \u041f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b:"},{"location":"#6","text":"$url = \"https://gigachat.devices.sberbank.ru/api/v1/chat/completions\" $headers = @{ \"Authorization\" = \"Bearer $GIGA_TOKEN\" \"Content-Type\" = \"application/json\" } $(Invoke-RestMethod -Uri \"https://gigachat.devices.sberbank.ru/api/v1/models\" -Headers $headers).data # \u0441\u043f\u0438\u0441\u043e\u043a \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0445 \u043c\u043e\u0434\u0435\u043b\u0435\u0439 $body = @{ model = \"GigaChat:latest\" messages = @( @{ role = $role content = $content } ) temperature = $temperature n = $n max_tokens = $max_tokens stream = $stream } | ConvertTo-Json $Request = Invoke-RestMethod -Method POST -Uri $url -Headers $headers -Body $body $Request.choices.message.content","title":"6. \u0421\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432:"},{"location":"#curl","text":"","title":"Curl"},{"location":"#ubuntu","text":"wget https://gu-st.ru/content/lending/russian_trusted_root_ca_pem.crt \\ wget https://gu-st.ru/content/lending/russian_trusted_sub_ca_pem.crt \\ mkdir /usr/local/share/ca-certificates/russian_trusted \\ cp russian_trusted_root_ca_pem.crt russian_trusted_sub_ca_pem.crt /usr/local/share/ca-certificates/russian_trusted \\ update-ca-certificates -v \\ wget -qS --spider --max-redirect=0 https://www.sberbank.ru","title":"\u0423\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432 \u0432 Ubuntu:"},{"location":"#_10","text":"Cred_Base64=\"N2U2ZDJmOWYtODI1ZS00OWI3LTk4ZjQtNjJmYmI3NTA2NDI3OmIyYzgwZmZmLTEzOGUtNDg1Mi05MjgwLWE2MGI4NTc0YTM2MQ==\" UUID=$(uuidgen) GIGA_TOKEN=$(curl -s --location --request POST \"https://ngw.devices.sberbank.ru:9443/api/v2/oauth\" \\ --header \"Authorization: Basic $Cred_Base64\" \\ --header \"RqUID: $UUID\" \\ --header \"Content-Type: application/x-www-form-urlencoded\" \\ --data-urlencode 'scope=GIGACHAT_API_PERS' | jq -r .access_token) curl -s --location \"https://gigachat.devices.sberbank.ru/api/v1/models\" --header \"Authorization: Bearer $GIGA_TOKEN\" | jq . \u0434\u043b\u044f \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438","title":"\u041f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 \u0442\u043e\u043a\u0435\u043d\u0430:"},{"location":"#_11","text":"request=$(curl -s https://gigachat.devices.sberbank.ru/api/v1/chat/completions \\ -H \"Content-Type: application/json\" \\ -H \"Authorization: Bearer $GIGA_TOKEN\" \\ -d '{ \"model\": \"GigaChat:latest\", \"messages\": [ { \"role\": \"user\", \"content\": \"\u041a\u043e\u0433\u0434\u0430 \u0443\u0436\u0435 \u0418\u0418 \u0437\u0430\u0445\u0432\u0430\u0442\u0438\u0442 \u044d\u0442\u043e\u0442 \u043c\u0438\u0440?\" } ], \"temperature\": 0.7 }') echo $request | jq -r .choices[].message.content","title":"\u0421\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u0430:"},{"location":"#yandexgpt","text":"","title":"YandexGPT"},{"location":"#oauth-token","text":"Create AIM Token \u0432\u0440\u0435\u043c\u044f \u0436\u0438\u0437\u043d\u0438 IAM-\u0442\u043e\u043a\u0435\u043d\u0430 \u043d\u0435 \u0431\u043e\u043b\u044c\u0448\u0435 12 \u0447\u0430\u0441\u043e\u0432 \\ yandexPassportOauthToken=\"y0_AgAAAAAGaLFLAATuwQAAAAD3xtRLQE4hvlazQ5euKO43XXXXXXXXXXX\" \u0434\u043b\u044f bash \\ $yandexPassportOauthToken = \"y0_AgAAAAAGaLFLAATuwQAAAAD3xtRLQE4hvlazQ5euKO43XXXXXXXXXXX\" \u0434\u043b\u044f PowerShell","title":"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c OAuth-Token:"},{"location":"#oauth-token-iam-token","text":"IAM_TOKEN=$(curl -s -d \"{\\\"yandexPassportOauthToken\\\":\\\"$yandexPassportOauthToken\\\"}\" \"https://iam.api.cloud.yandex.net/iam/v1/tokens\" | jq -r .iamToken) \\ $IAM_TOKEN = $(Invoke-RestMethod -Method POST -Uri \"https://iam.api.cloud.yandex.net/iam/v1/tokens\" -Body $(@{yandexPassportOauthToken = \"$yandexPassportOauthToken\"} | ConvertTo-Json -Compress)).iamToken","title":"\u041e\u0431\u043c\u0435\u043d\u044f\u0442\u044c OAuth-Token \u043d\u0430 IAM-Token:"},{"location":"#folder_id","text":"CLOUD_ID=$(curl -s -H \"Authorization: Bearer $IAM_TOKEN\" https://resource-manager.api.cloud.yandex.net/resource-manager/v1/clouds | jq -r .clouds[].id) # \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c cloud id curl -s --request GET -H \"Authorization: Bearer $IAM_TOKEN\" https://resource-manager.api.cloud.yandex.net/resource-manager/v1/folders -d \"{\\\"cloudId\\\": \\\"$CLOUD_ID\\\"}\" # \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u0439 \u0432 \u043e\u0431\u043b\u0430\u043a\u0435 curl -s --request POST -H \"Authorization: Bearer $IAM_TOKEN\" https://resource-manager.api.cloud.yandex.net/resource-manager/v1/folders -d \"{\\\"cloudId\\\": \\\"$CLOUD_ID\\\", \\\"name\\\": \\\"test\\\"}\" # \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u044e \u0432 \u043e\u0431\u043b\u0430\u043a\u0435 FOLDER_ID=$(curl -s --request GET -H \"Authorization: Bearer $IAM_TOKEN\" https://resource-manager.api.cloud.yandex.net/resource-manager/v1/folders -d '{\"cloudId\": \"b1gf9n6heihqj0pt5piu\"}' | jq -r '.folders[] | select(.name == \"test\") | .id') # \u0437\u0430\u0431\u0440\u0430\u0442\u044c id \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u0438 $CLOUD_ID = $(Invoke-RestMethod -Method Get -Uri \"https://resource-manager.api.cloud.yandex.net/resource-manager/v1/clouds\" -Headers @{\"Authorization\"=\"Bearer $IAM_TOKEN\"; \"Content-Type\"=\"application/json\"}).clouds.id $FOLDER_ID = $(Invoke-RestMethod -Method Get -Uri \"https://resource-manager.api.cloud.yandex.net/resource-manager/v1/folders\" -Headers @{\"Authorization\"=\"Bearer $IAM_TOKEN\"; \"Content-Type\"=\"application/json\"} -Body (@{\"cloudId\"= $CLOUD_ID} | ConvertTo-Json)).folders | Where-Object name -eq test | Select-Object -ExpandProperty id","title":"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c FOLDER_ID:"},{"location":"#_12","text":"model=\"gpt://$FOLDER_ID/yandexgpt/latest\" # https://cloud.yandex.ru/ru/docs/yandexgpt/concepts/models body=$(cat <<EOF { \"modelUri\": \"$model\", \"completionOptions\": { \"stream\": false, \"temperature\": 0.6, \"maxTokens\": 2000 }, \"messages\": [ { \"role\": \"user\", \"text\": \"\u041f\u043e\u0441\u0447\u0438\u0442\u0430\u0439 \u0441\u0443\u043c\u043c\u0443 22+33\" } ] } EOF) curl --request POST \\ -H \"Content-Type: application/json\" \\ -H \"Authorization: Bearer $IAM_TOKEN\" \\ -H \"x-folder-id: $FOLDER_ID\" \\ -d \"$body\" \\ \"https://llm.api.cloud.yandex.net/foundationModels/v1/completion\" $model = \"gpt://$FOLDER_ID/yandexgpt/latest\" $body = @\" { \"modelUri\": \"$model\", \"completionOptions\": { \"stream\": false, \"temperature\": 0.6, \"maxTokens\": 2000 }, \"messages\": [ { \"role\": \"user\", \"text\": \"\u041f\u043e\u0441\u0447\u0438\u0442\u0430\u0439 \u0441\u0443\u043c\u043c\u0443 22+33\" } ] } \"@ Invoke-RestMethod -Method POST -Uri \"https://llm.api.cloud.yandex.net/foundationModels/v1/completion\" -Headers @{\"Content-Type\"=\"application/json\"; \"Authorization\"=\"Bearer $IAM_TOKEN\"; \"x-folder-id\"=\"$FOLDER_ID\"} -Body $body","title":"\u0421\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u0430:"},{"location":"#superagi","text":"Source \\ Playground generate \\ API Doc (exaples) SUPERAGI_API_KEY=\"31f72164129XXXXX\" prompt=\"\u043f\u043e\u0441\u0447\u0438\u0442\u0430\u0439 \u0441\u0443\u043c\u043c\u0443 22+33, \u0434\u0430\u0439 \u0442\u043e\u043b\u044c\u043a\u043e \u043e\u0442\u0432\u0435\u0442 \u0431\u0435\u0437 \u043b\u0438\u0448\u043d\u0435\u0433\u043e \u0442\u0435\u043a\u0441\u0442\u0430\" request=$(curl -s -X POST 'https://api.superagi.com/v1/generate/65437cbf227a4018516ad1ce' \\ -H 'Content-Type: application/json' \\ -H \"Authorization: Bearer $SUPERAGI_API_KEY\" \\ -d '{ \"prompt\": [\"$prompt\"], \"max_tokens\": 500, \"temperature\": 0.9, \"top_p\": 0.15, \"repetition_penalty\": 0, \"best_of\": 1.05, \"top_k\": 50, \"stream\": false }') echo $request | sed \"s/data: //\" | jq -r .choices[].text $SUPERAGI_API_KEY = \"31f72164129XXXXX\" $prompt = \"\u043f\u043e\u0441\u0447\u0438\u0442\u0430\u0439 \u0441\u0443\u043c\u043c\u0443 22+33, \u0434\u0430\u0439 \u0442\u043e\u043b\u044c\u043a\u043e \u043e\u0442\u0432\u0435\u0442 \u0431\u0435\u0437 \u043b\u0438\u0448\u043d\u0435\u0433\u043e \u0442\u0435\u043a\u0441\u0442\u0430\" $request = Invoke-RestMethod -Method Post -Uri 'https://api.superagi.com/v1/generate/65437cbf227a4018516ad1ce' -Headers @{ 'Content-Type' = 'application/json' 'Authorization' = \"Bearer $SUPERAGI_API_KEY\" } -Body (@{ prompt = @($prompt) max_tokens = 500 temperature = 0.9 top_p = 0.15 repetition_penalty = 0 best_of = 1.05 top_k = 50 stream = $false } | ConvertTo-Json) $($request -replace \"^data: \" | ConvertFrom-Json).choices.text","title":"SuperAGI"},{"location":"#replicate","text":"API curl examples REPLICATE_API_TOKEN=\"r8_STyeUNXiGonkLfxE1FSKaqll26lXXXXXXXXXX\" prompt=\"\u0416\u0438\u0440\u0430\u0444 \u0432 \u043f\u043e\u043b\u043e\u0441\u043a\u0443 \u0437\u0435\u0431\u0440\u044b\" request=$(curl -s -X POST \\ -H \"Authorization: Token $REPLICATE_API_TOKEN\" \\ -H \"Content-Type: application/json\" \\ -d $'{ \"version\": \"ac732df83cea7fff18b8472768c88ad041fa750ff7682a21affe81863cbe77e4\", \"input\": { \"prompt\": \"$prompt\" } }' \\ https://api.replicate.com/v1/predictions) request_url=$(echo $request | jq -r .urls.get) response_status=$(curl -s -H \"Authorization: Token $REPLICATE_API_TOKEN\" $request_url | jq -r .status) while [[ $response_status != succeeded ]]; do response_status=$(curl -s -H \"Authorization: Token $REPLICATE_API_TOKEN\" $request_url | jq -r .status) done curl -s -H \"Authorization: Token $REPLICATE_API_TOKEN\" $request_url | jq -r .output[] $REPLICATE_API_TOKEN = \"r8_STyeUNXiGonkLfxE1FSKaqll26lXXXXXXXXXX\" $prompt = \"\u0416\u0438\u0440\u0430\u0444 \u0432 \u043f\u043e\u043b\u043e\u0441\u043a\u0443 \u0437\u0435\u0431\u0440\u044b\" $body = @{ version = \"ac732df83cea7fff18b8472768c88ad041fa750ff7682a21affe81863cbe77e4\" input = @{ prompt = $prompt } } | ConvertTo-Json $headers = @{ \"Authorization\" = \"Token $REPLICATE_API_TOKEN\" \"Content-Type\" = \"application/json\" } $request = Invoke-RestMethod -Uri \"https://api.replicate.com/v1/predictions\" -Method POST -Body $body -Headers $headers $response = Invoke-RestMethod $($request.urls.get) -Headers @{\"Authorization\" = \"Token $REPLICATE_API_TOKEN\"} while ($response.status -ne \"succeeded\") { $response = Invoke-RestMethod $($request.urls.get) -Headers @{\"Authorization\" = \"Token $REPLICATE_API_TOKEN\"} } $response.output","title":"Replicate"},{"location":"#google-filter","text":"https://www.google.com/search?q=the+rookie+2018+imdb \u0444\u043e\u0440\u043c\u0430\u0442 url-\u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u043f\u043e\u0438\u0441\u043a\u0430 \u0441 \u043f\u0440\u043e\u0431\u0435\u043b\u0430\u043c\u0438 \\ https://www.google.com/search?q=the+rookie+2018+site:imdb.com \u043f\u043e\u0438\u0441\u043a \u043f\u043e \u0441\u0430\u0439\u0442\u0443 \\ https://www.google.com/search?q=the+rookie+intitle:index.of+\"last modified\"+(mkv|avi) \u0438\u0441\u043a\u0430\u0442\u044c \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b, \u043d\u0430 \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u0443\u043a\u0430\u0437\u0430\u043d\u043e \"last modified\" (\u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0435 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f), \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b \u0447\u0435\u0440\u0435\u0437 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u043d\u044b\u0439 \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440 \u043f\u043e\u0438\u0441\u043a\u0430 (\u0432\u0441\u0435 \u043f\u0435\u0440\u0435\u0447\u0438\u0441\u043b\u0435\u043d\u043d\u044b\u0435 \u0441\u043b\u043e\u0432\u0430 \u0434\u043e\u043b\u0436\u043d\u044b \u0432\u0441\u0442\u0440\u0435\u0447\u0430\u0442\u044c\u0441\u044f \u0432 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0435) \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0441\u043b\u043e\u0432\u043e \"index.of\" (\u0443\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442 \u043d\u0430 \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u044e \u043d\u0430 \u0432\u0435\u0431-\u0441\u0435\u0440\u0432\u0435\u0440\u0435, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0441\u043f\u0438\u0441\u043e\u043a \u0444\u0430\u0439\u043b\u043e\u0432) \u0438 \u0438\u0441\u043a\u0430\u0442\u044c \u0444\u0430\u0439\u043b\u044b \u0441 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u044f\u043c\u0438 .mkv \u0438\u043b\u0438 (|) .avi \\ https://www.google.com/search?q=the+rookie+2018+filetype:torrent \\ \u0438\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u044f gopro hero 11 filetype:pdf \u0438\u0441\u043a\u0430\u0442\u044c \u0441\u0440\u0430\u0437\u0443 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442 (\u043d\u0430 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435 .pdf \u0438\u043b\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430) \\ \"\u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f/\u0433\u043b\u0430\u0433\u043e\u043b\u044b, \u0443\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u043d\u044b\u0435 \u0434\u043b\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f \u0432 \u043a\u043e\u043c\u0430\u043d\u0434\u043b\u0435\u0442\u0430\u0445\" \u0438\u0441\u043a\u0430\u0442\u044c \u043f\u043e \u0444\u0440\u0430\u0437\u0435 \u0446\u0435\u043b\u0438\u043a\u043e\u043c, \u0431\u0435\u0437 \u0440\u0430\u0437\u0431\u0438\u0435\u043d\u0438\u044f \u043d\u0430 \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u044b\u0435 \u0441\u043b\u043e\u0432\u0430 \\ \"\u044f\u0433\u0443\u0430\u0440 \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u044c -\u0436\u0438\u0432\u043e\u0442\u043d\u043e\u0435 -xe -xj\" \u0443\u0437\u043d\u0430\u0435\u043c \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u044c \u042f\u0433\u0443\u0430\u0440\u0430, \u0438\u0441\u043a\u043b\u044e\u0447\u0430\u0435\u043c \u0436\u0438\u0432\u043e\u0442\u043d\u043e\u0435 \u0438 \u043c\u043e\u0434\u0435\u043b\u0438 \u0430\u0432\u0442\u043e\u043c\u043e\u0431\u0438\u043b\u044f \\ \"intitle:\u043b\u0443\u0447\u0448\u0438\u0435 \u0444\u0438\u043b\u044c\u043c\u044b 2023\" \u0437\u0430\u043f\u0440\u043e\u0441 \u0438\u0449\u0435\u0442 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b, \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0438 (title HTML \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430) \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442 \u0441\u043b\u043e\u0432\u0430 \"\u043b\u0443\u0447\u0448\u0438\u0435\", \"\u0444\u0438\u043b\u044c\u043c\u044b\" \u0438 \"2023\" (\u0432\u0441\u0435 \u0441\u043b\u043e\u0432\u0430 \u0434\u043e\u043b\u0436\u043d\u044b \u0431\u044b\u0442\u044c \u0432 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0435) \\ \"allintitle:\u043b\u0443\u0447\u0448\u0438\u0435 \u0444\u0438\u043b\u044c\u043c\u044b 2023\" \u0437\u0430\u043f\u0440\u043e\u0441 \u0438\u0449\u0435\u0442 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b, \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0438 (title HTML \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430) \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442 \u0441\u043b\u043e\u0432\u0430 \"\u043b\u0443\u0447\u0448\u0438\u0435\", \"\u0444\u0438\u043b\u044c\u043c\u044b\" \u0438\u043b\u0438 \"2023\" (\u043e\u0434\u043d\u043e \u0438\u0437) \\ \"intext:telegram \u0431\u043e\u0442 powershell\" \u043f\u043e\u0438\u0441\u043a \u0441\u0442\u0440\u0430\u043d\u0438\u0446, \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0449\u0438\u0445 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0435 \u043a\u043b\u044e\u0447\u0435\u0432\u043e\u0435 \u0441\u043b\u043e\u0432\u043e \u0432 \u0442\u0435\u043a\u0441\u0442\u0435 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b (\u0430 \u043d\u0435 \u0442\u043e\u043b\u044c\u043a\u043e \u0432 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0435) \\ \"inurl:lifailon\" \u043f\u043e\u0438\u0441\u043a \u0441\u0442\u0440\u0430\u043d\u0438\u0446, \u0432 URL \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442\u0441\u044f \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0435 \u043a\u043b\u044e\u0447\u0435\u0432\u043e\u0435 \u0441\u043b\u043e\u0432\u043e \\ intitle:index.of \"game of thrones\" mkv daterange:2010..2015 \u0444\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u044f \u043f\u043e \u0434\u0430\u0442\u0435 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f, \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440 \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0437\u0430\u0434\u0430\u0442\u044c \u0434\u0438\u0430\u043f\u0430\u0437\u043e\u043d \u0434\u0430\u0442 \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 YYYYMMDD..YYYYMMDD \\ intitle:index.of \"game of thrones\" mkv after:2015 \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0438\u0442\u044c \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b \u043f\u043e\u0438\u0441\u043a\u0430 \u0444\u0430\u0439\u043b\u043e\u0432, \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u043d\u044b\u0445 \u0434\u043e (before) \u0438\u043b\u0438 \u043f\u043e\u0441\u043b\u0435 (after) \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0439 \u0434\u0430\u0442\u044b \\ intitle:index.of \"game of thrones\" mkv from:2010 to:2015 \u0444\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u044f \u043f\u043e \u0434\u0438\u0430\u043f\u0430\u0437\u043e\u043d\u0443 \u0434\u0430\u0442 \\ https://www.google.com/search?q=the-rookie-2018+site:imdb.com&btnI \u0440\u0435\u0434\u0438\u0440\u0435\u043a\u0442 \u043d\u0430 \u043f\u0435\u0440\u0432\u044b\u0439 url","title":"Google-Filter"},{"location":"#google-api","text":"","title":"Google-API"},{"location":"#google-translate","text":"$Key = \"<TOKEN_API>\" # \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0442\u043e\u043a\u0435\u043d: https://console.cloud.google.com/apis/credentials $Text = \"You can see in the right corner how long each translation request takes (this does not depend on the amount of text being transferred).\" $LanguageTarget = \"RU\" $LanguageSource = \"EN\" $url = \"https://translation.googleapis.com/language/translate/v2?key=$key\" $Header = @{ \"Content-Type\" = \"application/json\" } $Body = @{ \"q\" = \"$Text\" \"target\" = \"$LanguageTarget\" \"source\" = \"$LanguageSource\" } | ConvertTo-Json $WebClient = New-Object System.Net.WebClient foreach ($key in $Header.Keys) { $WebClient.Headers.Add($key, $Header[$key]) } $Response = $WebClient.UploadString($url, \"POST\", $Body) | ConvertFrom-Json $Response.data.translations.translatedText","title":"Google-Translate"},{"location":"#google-search","text":"$Key = \"<TOKEN_API>\" # \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0442\u043e\u043a\u0435\u043d: https://developers.google.com/custom-search/v1/overview?hl=ru (\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u0441\u043a\u0438\u0439 \u043f\u043e\u0438\u0441\u043a JSON API \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 100 \u043f\u043e\u0438\u0441\u043a\u043e\u0432\u044b\u0445 \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 \u0432 \u0434\u0435\u043d\u044c \u0431\u0435\u0441\u043f\u043b\u0430\u0442\u043d\u043e) $cx = \"35c78340f49eb474a\" # \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u043e\u0438\u0441\u043a\u043e\u0432\u0443\u044e \u0441\u0438\u0441\u0442\u0435\u043c\u0443 https://programmablesearchengine.google.com/controlpanel/all $Query = \"\u043a\u0430\u043a \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0431\u043e\u0442\u0430 discord\" $Lang = \"ru\" $Num = 10 $Start = 0 $response = Invoke-RestMethod \"https://www.googleapis.com/customsearch/v1?q=$Query&key=$Key&cx=$cx&lr=lang_$Lang&num=$Num&$start=$Start\" $response.items | Select-Object title,snippet,displayLink,link | Format-List","title":"Google-Search"},{"location":"#rapidapi","text":"Google-Search72 $Key = \"<TOKEN_API>\" $headers=@{} $headers.Add(\"X-RapidAPI-Key\", \"$Key\") $headers.Add(\"X-RapidAPI-Host\", \"google-search72.p.rapidapi.com\") $query = \"\u043a\u0430\u043a \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0431\u043e\u0442\u0430 discord\" $response = Invoke-RestMethod \"https://google-search72.p.rapidapi.com/search?q=$query%20gitgub&gl=us&lr=lang_ru&num=20&start=0\" -Method GET -Headers $headers $response.items | Select-Object title,snippet,displayLink,link | Format-List","title":"RapidAPI"},{"location":"#imdb","text":"IMDb8 $key = \"<TOKEN_API>\" # 500 \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 \u0432 \u043c\u0435\u0441\u044f\u0446 $query=\"Break\" $headers=@{} $headers.Add(\"X-RapidAPI-Key\", \"$key\") $headers.Add(\"X-RapidAPI-Host\", \"imdb8.p.rapidapi.com\") $response = Invoke-RestMethod \"https://imdb8.p.rapidapi.com/title/find?q=$query\" -Method GET -Headers $headers $response.results | select title,titletype,year,runningTimeInMinutes,id | Format-Table \"https://www.imdb.com$($response.results.id[0])\" $response.results.principals # \u0430\u043a\u0442\u0435\u0440\u044b $response.results.image","title":"IMDb"},{"location":"#moviesdatabase","text":"MoviesDatabase $key = \"<TOKEN_API>\" $imdb_id = \"tt0455275\" $headers=@{} $headers.Add(\"X-RapidAPI-Key\", \"$key\") $headers.Add(\"X-RapidAPI-Host\", \"moviesdatabase.p.rapidapi.com\") $response = Invoke-RestMethod \"https://moviesdatabase.p.rapidapi.com/titles/$imdb_id\" -Method GET -Headers $headers $response.results","title":"MoviesDatabase"},{"location":"#tmdb","text":"Developer TMDB $TOKEN = \"548e444e7812575caa0a7eXXXXXXXXXX\" $Endpoint = \"search/tv\" # \u043f\u043e\u0438\u0441\u043a \u0441\u0435\u0440\u0438\u0430\u043b\u0430 (tv) \u0438 \u0444\u0438\u043b\u044c\u043c\u0430 (movie) \u043f\u043e \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044e $Query = \"\u0437\u0438\u043c\u043e\u0440\u043e\u0434\u043e\u043a\" $url = $(\"https://api.themoviedb.org/3/$Endpoint\"+\"?api_key=$TOKEN&query=$Query\") $(Invoke-RestMethod -Uri $url -Method Get).results $id = $(Invoke-RestMethod -Uri $url -Method Get).results.id # \u0437\u0430\u0431\u0440\u0430\u0442\u044c id \u0441\u0435\u0440\u0438\u0430\u043b\u0430 (210865) https://www.themoviedb.org/tv/210865 $Endpoint = \"tv/$id\" # \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438 \u043e \u0441\u0435\u0440\u0438\u0430\u043b\u0435 \u043f\u043e \u0435\u0433\u043e ID $url = $(\"https://api.themoviedb.org/3/$Endpoint\"+\"?api_key=$TOKEN\") $(Invoke-RestMethod -Uri $url -Method Get) # \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u0435\u0437\u043e\u043d\u043e\u0432 (.seasons), \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u044d\u043f\u0438\u0437\u043e\u0434\u043e\u0432 (.seasons.episode_count) (Invoke-RestMethod -Uri \"https://api.themoviedb.org/3/tv/$id/season/2?api_key=$Token\" -Method Get).episodes # \u0432\u044b\u0432\u0435\u0441\u0442\u0438 2 \u0441\u0435\u0437\u043e\u043d Invoke-RestMethod -Uri \"https://api.themoviedb.org/3/tv/$id/season/2/episode/8?api_key=$Token\" -Method Get # \u0432\u044b\u0432\u0435\u0441\u0442\u0438 8 \u044d\u043f\u0438\u0437\u043e\u0434","title":"TMDB"},{"location":"#omdb","text":"\u041f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 API \u043a\u043b\u044e\u0447\u0430 \u043f\u043e email $API_KEY = \"XXXXXXXX\" \\ $IMDb_ID = \"tt7587890\" \\ curl -s \"https://omdbapi.com/?apikey=$($API_KEY)&i=$($IMDb_ID)\" | jq . \\ curl -s \"https://omdbapi.com/?apikey=$($API_KEY)&i=$($IMDb_ID)\" | ConvertFrom-Json \\ Invoke-RestMethod \"https://omdbapi.com/?apikey=$($API_KEY)&s=The Rookie\" \\ Invoke-RestMethod \"https://omdbapi.com/?apikey=$($API_KEY)&t=The Rookie\" \u043f\u043e\u0438\u0441\u043a \u043f\u043e Title \\ Invoke-RestMethod \"https://omdbapi.com/?apikey=$($API_KEY)&t=The Rookie&y=1990\" \u043f\u043e\u0438\u0441\u043a \u043f\u043e Title \u0438 \u0433\u043e\u0434\u0443 \u0432\u044b\u0445\u043e\u0434\u0430 \\ Invoke-RestMethod \"https://omdbapi.com/?apikey=$($API_KEY)&t=The Rookie&type=movie\" \u043f\u043e\u0438\u0441\u043a \u0442\u043e\u043b\u044c\u043a\u043e \u0444\u0438\u043b\u044c\u043c\u0430 (movie) \u0438\u043b\u0438 \u0441\u0435\u0440\u0438\u0430\u043b\u0430 (series) \\ $(Invoke-RestMethod \"https://omdbapi.com/?apikey=$($API_KEY)&s=The Rookie\").Search \u043f\u043e\u0438\u0441\u043a \u0432\u0441\u0435\u0445 \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439 (\u0444\u0438\u043b\u044c\u043c\u044b \u0438 \u0441\u0435\u0440\u0438\u0430\u043b\u044b)","title":"OMDb"},{"location":"#ivi","text":"ivi api doc Invoke-RestMethod https://api.ivi.ru/mobileapi/categories \u0441\u043f\u0438\u0441\u043e\u043a \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0439 \u0438 \u0436\u0430\u043d\u0440\u043e\u0432 (genres/meta_genres) \\ Invoke-RestMethod https://api.ivi.ru/mobileapi/collections \u043f\u043e\u0434\u0431\u043e\u0440\u043a\u0438 (Invoke-RestMethod \"https://api.ivi.ru/mobileapi/search/v7/?query=zimorodok\").result.seasons.number \u043a\u043e\u043b-\u0432\u043e \u0441\u0435\u0437\u043e\u043d\u043e\u0432 \\ (Invoke-RestMethod \"https://api.ivi.ru/mobileapi/search/v7/?query=zimorodok\").result.seasons[1].episode_count \u043a\u043e\u043b-\u0432\u043e \u0441\u0435\u0440\u0438\u0439 \u0432\u043e \u0432\u0442\u043e\u0440\u043e\u043c \u0441\u0435\u0437\u043e\u043d\u0435 \\ (Invoke-RestMethod \"https://api.ivi.ru/mobileapi/search/v7/?query=zimorodok\").result.seasons[1].ivi_release_info.date_interval_min \u0434\u0430\u0442\u0430 \u0432\u044b\u0445\u043e\u0434\u0430 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u0439 \u0441\u0435\u0440\u0438\u0438 \\ (Invoke-RestMethod \"https://api.ivi.ru/mobileapi/search/v7/?query=zimorodok\").result.kp_rating \u0440\u0435\u0439\u0442\u0438\u043d\u0433 \u0432 \u041a\u0438\u043d\u043e\u043f\u043e\u0438\u0441\u043a (8.04) $id = (Invoke-RestMethod \"https://api.ivi.ru/mobileapi/search/v7/?query=zimorodok\").result.kp_id \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c id \u0432 \u041a\u0438\u043d\u043e\u043f\u043e\u0438\u0441\u043a (5106881) \\ id=$(curl -s https://api.ivi.ru/mobileapi/search/v7/?query=zimorodok | jq .result[].kp_id) \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c id \u0432 \u041a\u0438\u043d\u043e\u043f\u043e\u0438\u0441\u043a","title":"ivi"},{"location":"#kinopoisk","text":"id=5106881 get=$(curl -s https://www.kinopoisk.ru/film/$id/episodes/) printf \"%s\\n\" \"${get[@]}\" | grep -A 1 \"\u0421\u0435\u0437\u043e\u043d 2\" | grep \"\u044d\u043f\u0438\u0437\u043e\u0434\u043e\u0432\" | sed -r \"s/^.+\\: //\" # \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u044d\u043f\u0438\u0437\u0434\u043e\u0432\u043e\u0434 \u0432\u043e \u0432\u0442\u043e\u0440\u043e\u043c \u0441\u0435\u0437\u043e\u043d\u0435","title":"Kinopoisk"},{"location":"#kinopoiskdev","text":"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0442\u043e\u043a\u0435\u043d \\ \u0414\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044f \u043f\u043e API \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 OpenAPI GET /v1.4/movie/{id} \u043f\u043e\u0438\u0441\u043a \u043f\u043e id $id = 5106881 $API_KEY = \"ZYMNJJA-0J8MNPN-PB4N7R7-XXXXXXX\" $Header = @{ \"accept\" = \"application/json\" \"X-API-KEY\" = \"$API_KEY\" } $irm = Invoke-RestMethod \"https://api.kinopoisk.dev/v1.4/movie/$id\" -Method GET -Headers $Header $irm.rating.kp # \u0440\u0435\u0439\u0442\u0438\u043d\u0433 \u0432 \u041a\u0438\u043d\u043e\u043f\u043e\u0438\u0441\u043a (8,079) $irm.seasonsInfo # \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0441\u0435\u0437\u043e\u043d\u043e\u0432 \u0438 \u044d\u043f\u0438\u0437\u043e\u0434\u043e\u0432 \u0432 \u043d\u0438\u0445 id=5106881 API_KEY=\"ZYMNJJA-0J8MNPN-PB4N7R7-XXXXXXX\" get=$(curl -s -X GET \\ \"https://api.kinopoisk.dev/v1.4/movie/$id\" \\ -H \"accept: application/json\" \\ -H \"X-API-KEY: $API_KEY\") echo $get | jq .rating.kp # \u0440\u0435\u0439\u0442\u0438\u043d\u0433 \u0432 \u041a\u0438\u043d\u043e\u043f\u043e\u0438\u0441\u043a (8,079) echo $get | jq .seasonsInfo[1].episodesCount # \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u044d\u043f\u0438\u0437\u043e\u0434\u043e\u0432 \u0432\u043e \u0432\u0442\u043e\u0440\u043e\u043c [1] \u0441\u0435\u0437\u043e\u043d\u0435 (6) GET /v1.4/movie/search query=\"zimorodok\" page=1 # \u043a\u043e\u043b-\u0432\u043e \u0441\u0442\u0440\u0430\u043d\u0438\u0446 \u0434\u043b\u044f \u0432\u044b\u0431\u043e\u0440\u043a\u0438 limit=1 # \u043a\u043e\u043b-\u0432\u043e \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432 \u043d\u0430 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435 curl -s -X GET \\ \"https://api.kinopoisk.dev/v1.4/movie/search?page=$page&limit=$limit&query=$query\" \\ -H \"accept: application/json\" \\ -H \"X-API-KEY: $API_KEY\" | jq . limit=5 request=$(curl -s -X GET \\ \"https://api.kinopoisk.dev/v1.4/movie/search?page=$page&limit=$limit&query=%D0%B7%D0%B8%D0%BC%D0%BE%D1%80%D0%BE%D0%B4%D0%BE%D0%BA\" \\ -H \"accept: application/json\" \\ -H \"X-API-KEY: $API_KEY\" | jq .) echo $request | jq '.docs[] | select(.year == 2022)' # \u043e\u0442\u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u044b\u0432\u043e\u0434 \u043f\u043e \u0433\u043e\u0434\u0443 \u0432\u044b\u0445\u043e\u0434\u0430 $API_KEY = \"ZYMNJJA-0J8MNPN-PB4N7R7-XXXXXXX\" $page = 1 $limit = 5 $query = \"%D0%B7%D0%B8%D0%BC%D0%BE%D1%80%D0%BE%D0%B4%D0%BE%D0%BA\" $request = Invoke-RestMethod -Uri \"https://api.kinopoisk.dev/v1.4/movie/search?page=$page&limit=$limit&query=$query\" -Headers @{\"accept\"=\"application/json\"; \"X-API-KEY\"=\"$API_KEY\"} $request.docs | Where-Object year -eq 2022","title":"kinopoisk.dev"},{"location":"#urlcode","text":"function Get-PercentEncode ($str) { $bytes = [System.Text.Encoding]::UTF8.GetBytes($str) ($bytes | ForEach-Object { \"{0:X2}\" -f $_ }) -join '%' -replace \"^\",\"%\" } Get-PercentEncode \"\u0437\u0438\u043c\u043e\u0440\u043e\u0434\u043e\u043a\" function Get-UrlEncode($str) { [System.Web.HttpUtility]::UrlEncode($str) } UrlEncode \"\u0437\u0438\u043c\u043e\u0440\u043e\u0434\u043e\u043a\" percent-encode() { str=$1 echo -n \"$1\" | iconv -t utf8 | od -An -tx1 | tr ' ' % | tr -d '\\n' } percent-encode \"\u0437\u0438\u043c\u043e\u0440\u043e\u0434\u043e\u043a\" function Get-UrlDecode($encoded) { [System.Uri]::UnescapeDataString($encoded) } Get-UrlDecode \"%D0%B7%D0%B8%D0%BC%D0%BE%D1%80%D0%BE%D0%B4%D0%BE%D0%BA\" percent-decode() { encoded=$1 local url_encoded=\"${1//+/ }\" printf '%b' \"${url_encoded//%/\\\\x}\" } percent-decode \"%D0%B7%D0%B8%D0%BC%D0%BE%D1%80%D0%BE%D0%B4%D0%BE%D0%BA\"","title":"UrlCode"},{"location":"#kinopoiskapiunofficial","text":"\u0411\u0435\u0441\u043f\u043b\u0430\u0442\u043d\u043e 500 \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 \u0432 \u0441\u0443\u0442\u043a\u0438. Swagger documentation API_KEY=\"828ec96a-f45d-4e3d-84b1-XXXXXXXXXXXX\" $headers = @{ \"accept\" = \"application/json\" \"X-API-KEY\" = \"$API_KEY\" } Invoke-RestMethod -Uri 'https://kinopoiskapiunofficial.tech/api/v2.2/films/1142153' -Headers $headers curl -s \"https://kinopoiskapiunofficial.tech/api/v2.2/films/1142153\" -H \"accept: application/json\" -H \"X-API-KEY: $API_KEY\" | jq .","title":"KinopoiskApiUnofficial"},{"location":"#kinobox","text":"$url = \"https://www.kinopoisk.ru/film/694051\" \\ $kp_id = $url -replace \".+/\" \\ https://kinomix.web.app/#694051 \\ curl -s -X GET \"https://kinobox.tv/api/players/main?kinopoisk=$kp_id\" -H \"accept: application/json\" \u043f\u043e\u0438\u0441\u043a \u043f\u043e id \u041a\u0438\u043d\u043e\u043f\u043e\u0438\u0441\u043a \\ curl -s -X GET \"https://kinobox.tv/api/players/main?imdb=tt2293640\" -H \"accept: application/json\" \u043f\u043e\u0438\u0441\u043a \u043f\u043e id IMDb \\ curl -s -X GET \"https://kinobox.tv/api/players/main?title=minions\" -H \"accept: application/json\" \u043f\u043e\u0438\u0441\u043a \u043e\u0441\u043d\u043e\u0432\u043d\u044b\u0445 \u043f\u043b\u0435\u0435\u0440\u043e\u0432 \u043f\u043e \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044e \\ curl -s -X GET \"https://kinobox.tv/api/players/all?title=minions\" -H \"accept: application/json\" \u043f\u043e\u0438\u0441\u043a \u0432\u0441\u0435\u0445 \u043f\u043b\u0435\u0435\u0440\u043e\u0432 \\ curl -s -X GET \"https://kinobox.tv/api/popular/films\" -H \"accept: application/json\" \u043f\u043e\u043f\u0443\u043b\u044f\u0440\u043d\u044b\u0435 \u0444\u0438\u043b\u044c\u043c\u044b \\ curl -s -X GET \"https://kinobox.tv/api/popular/series\" -H \"accept: application/json\" \u043f\u043e\u043f\u0443\u043b\u044f\u0440\u043d\u044b\u0435 \u0441\u0435\u0440\u0438\u0430\u043b\u044b","title":"Kinobox"},{"location":"#videocdn","text":"API \\ Source \\ API JSON $kp_id = 5106881 $token = \"YfTWH2p3Mai7ziqDoGjS3yXXXXXXXXXX\" $ep = \"tv-series\" $(Invoke-RestMethod $(\"https://videocdn.tv/api/$ep\"+\"?api_token=$token&field=kinopoisk_id&query=$kp_id\")).data.episodes | Where-Object season_num -eq 2 | Select-Object @{Name=\"Episode\"; Expression={$_.num}}, @{Name=\"Voice\"; Expression={$_.media.translation.title}} # \u043e\u0442\u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u0435\u0440\u0438\u0438 \u043f\u043e \u0432\u0442\u043e\u0440\u043e\u043c\u0443 \u0441\u0435\u0437\u043e\u043d\u0443 \u0438 \u043e\u0442\u043e\u0431\u0440\u0430\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u043e\u0437\u0432\u0443\u0447\u043a\u0438 \u043a \u0441\u0435\u0440\u0438\u044f\u043c kp_id=5106881 token=\"YfTWH2p3Mai7ziqDoGjS3yXXXXXXXXXX\" ep=\"tv-series\" curl -s \"https://videocdn.tv/api/$ep?api_token=$token&field=kinopoisk_id&query=$kp_id\" | jq \".data[].episodes | length\" # \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0441\u0435\u0440\u0438\u0439 curl -s \"https://videocdn.tv/api/$ep?api_token=$token&field=kinopoisk_id&query=$kp_id\" | jq \".data[].episodes[] | select(.season_num == 2) | {episode: .ru_title, voice: .media[].translation.title}\" # \u043e\u0442\u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u0432\u044b\u0432\u043e\u0434\u0430","title":"VideoCDN"},{"location":"#telegram","text":"@BotFather (https://t.me/BotFather) /newbot Format: https://api.telegram.org/bot<token>/<endpoint> getupdates function Get-FromTelegram { param ( $Token = \"687...:AAF...\", [switch]$Date, [switch]$Last, [switch]$ChatID ) $endpoint = \"getUpdates\" $url = \"https://api.telegram.org/bot$Token/$endpoint\" $result = Invoke-RestMethod -Uri $url if ($Date) { $Collections = New-Object System.Collections.Generic.List[System.Object] foreach ($r in $($result.result)) { $EpochTime = [DateTime]\"1/1/1970\" $TimeZone = Get-TimeZone $UTCTime = $EpochTime.AddSeconds($r.message.date) $d = $UTCTime.AddMinutes($TimeZone.BaseUtcOffset.TotalMinutes) $Collections.Add([PSCustomObject]@{ Message = $r.message.text; Date = $d }) } $Collections } else { if ($Last) { $result.result.message.text[-1] } elseif ($ChatID) { $Collections = New-Object System.Collections.Generic.List[System.Object] foreach ($r in $($result.result)) { $Collections.Add([PSCustomObject]@{ Message = $r.message.text; UserName = $r.message.chat.username; ChatID = $r.message.chat.id; ChatType = $r.message.chat.type }) } $Collections } else { $result.result.message.text } } } Get-FromTelegram \\ Get-FromTelegram -Last \\ Get-FromTelegram -Date \\ Get-FromTelegram -ChatID sendmessage function Send-ToTelegram { param ( [Parameter(Mandatory = $True)]$Text, $Token = \"687...:AAF...\", $Chat = \"125468108\", $Keyboard ) $endpoint = \"sendMessage\" $url = \"https://api.telegram.org/bot$Token/$endpoint\" $Body = @{ chat_id = $Chat text = $Text } if ($keyboard -ne $null) { $Body += @{reply_markup = $keyboard} } Invoke-RestMethod -Uri $url -Body $Body } Send-ToTelegram -Text \"Send test from powershell\" $LastDate = (Get-FromTelegram -date)[-1].Date while ($true) { $LastMessage = (Get-FromTelegram -date)[-1] Start-Sleep 1 $LastDateTest = $LastMessage.Date if (($LastMessage.Message -match \"/Service\") -and ($LastDate -ne $LastDateTest)) { $ServiceName = $($LastMessage.Message -split \" \")[-1] $Result = $(Get-Service $ServiceName -ErrorAction Ignore).Status if ($Result) { Send-ToTelegram -Text $Result } else { Send-ToTelegram -Text \"Service not found\" } $LastDate = $LastDateTest } } /Service vpnagent \\ /Service WinRM \\ /Service test","title":"Telegram"},{"location":"#button","text":"$keyboard = '{ \"inline_keyboard\":[[ {\"text\":\"Uptime\",\"callback_data\":\"/Uptime\"}, {\"text\":\"Test\",\"callback_data\":\"/Test\"} ]] }' Send-ToTelegram -Text \"Test buttons\" -Keyboard $keyboard $request = (Invoke-RestMethod -Uri \"https://api.telegram.org/bot$Token/getUpdates\").result.callback_query $request.data # \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u0442\u044c callback_data \u043d\u0430\u0436\u0430\u0442\u043e\u0439 \u043a\u043d\u043e\u043f\u043a\u0438 $request.message.date","title":"Button"},{"location":"#discord","text":"Developers \u0421\u043e\u0437\u0434\u0430\u0435\u043c Applications (General Information). \u0412 Bot \u043f\u0440\u0438\u0432\u044f\u0437\u044b\u0432\u0430\u0435\u043c \u043a Application \u0438 \u043a\u043e\u043f\u0438\u0440\u0443\u0435\u043c \u0442\u043e\u043a\u0435\u043d \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438. \u0412 OAuth2 - URL Generator \u0432\u044b\u0431\u0438\u0440\u0430\u0435\u043c bot \u0438 \u043f\u0440\u0430\u0432\u0430 Administrator \u0438 \u043a\u043e\u043f\u0438\u0440\u0443\u0435\u043c \u0441\u043e\u0437\u0434\u0430\u043d\u043d\u044b\u0439 URL \u0434\u043b\u044f \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u043d\u0430 \u043a\u0430\u043d\u0430\u043b. \u041f\u0435\u0440\u0435\u0445\u043e\u0434\u0438\u043c \u043f\u043e url \u0438 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c \u0431\u043e\u0442\u0430 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440. \u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c ID \u043a\u0430\u043d\u0430\u043b\u0430 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435 (\u0442\u0435\u043a\u0441\u0442\u043e\u0432\u044b\u0435 \u043a\u0430\u043d\u0430\u043b\u044b, \u043f\u0440\u0430\u0432\u043e\u0439 \u043a\u043d\u043e\u043f\u043a\u043e\u0439 \u043c\u044b\u0448\u0438 \u043a\u043e\u043f\u0438\u0440\u0443\u0435\u043c \u0441\u0441\u044b\u043b\u043a\u0443 \u0438 \u0437\u0430\u0431\u0438\u0440\u0430\u0435\u043c \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0439 id \u0432 url).","title":"Discord"},{"location":"#send-to-discord","text":"DISCORD_TOKEN=\"MTE5NzE1NjM0NTM3NjQxMTcyOQ.XXXXXX.EzBF6RA9Kx_MSuhLW5elH1U-XXXXXXXXXXXXXX\" DISCORD_CHANNEL_ID=\"119403124XXXXXXXXXX\" TEXT=\"test from bash\" URL=\"https://discordapp.com/api/channels/$DISCORD_CHANNEL_ID/messages\" curl -s -X POST $URL \\ -H \"Authorization: Bot $DISCORD_TOKEN\" \\ -H \"Content-Type: application/json\" \\ -d \"{\\\"content\\\": \\\"$TEXT\\\"}\" $DISCORD_TOKEN = \"MTE5NzE1NjM0NTM3NjQxMTcyOQ.XXXXXX.EzBF6RA9Kx_MSuhLW5elH1U-XXXXXXXXXXXXXX\" $DISCORD_CHANNEL_ID = \"119403124XXXXXXXXXX\" $TEXT = \"test from PowerShell\" $URL = \"https://discordapp.com/api/channels/$DISCORD_CHANNEL_ID/messages\" $Body = @{ content = $TEXT } | ConvertTo-Json curl -s $URL -X POST -H \"Authorization: Bot $DISCORD_TOKEN\" -H \"Content-Type: application/json\" -d $Body","title":"Send to Discord"},{"location":"#read-from-discord","text":"curl -s -X GET $URL \\ -H \"Authorization: Bot $DISCORD_TOKEN\" \\ -H \"Content-Type: application/json\" | jq -r .[0].content $messages = (curl -s -X GET $URL -H \"Authorization: Bot $DISCORD_TOKEN\" -H \"Content-Type: application/json\" | ConvertFrom-Json) $messages | Select-Object content,timestamp,{$_.author.username}","title":"Read from Discord"},{"location":"#httpclient","text":"$DISCORD_TOKEN = \"MTE5NzE1NjM0NTM3NjQxMTcyOQ.XXXXXX.EzBF6RA9Kx_MSuhLW5elH1U-XXXXXXXXXXXXXX\" $DISCORD_CHANNEL_ID = \"119403124XXXXXXXXXX\" $URL = \"https://discordapp.com/api/channels/$DISCORD_CHANNEL_ID/messages\" $HttpClient = New-Object System.Net.Http.HttpClient $HttpClient.DefaultRequestHeaders.Authorization = \"Bot $DISCORD_TOKEN\" $response = $HttpClient.GetAsync($URL).Result $messages = $response.Content.ReadAsStringAsync().Result ($messages | ConvertFrom-Json).content","title":"HttpClient"},{"location":"#button_1","text":"curl -X POST $URL \\ -H \"Content-Type: application/json\" \\ -H \"Authorization: Bot $DISCORD_TOKEN\" \\ -d ' { \"content\": \"Test text for button\", \"components\": [ { \"type\": 1, \"components\": [ { \"type\": 2, \"label\": \"Button\", \"style\": 1, \"custom_id\": \"button_click\" } ] } ] }'","title":"Button"},{"location":"#discordnetwebhook","text":"Add-Type -Path $(ls \"$home\\Documents\\Discord.NET\\*.dll\").FullName # https://discordapp.com/api/webhooks/<webhook_id>/<webhook_token> (\u041d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u043a\u0430\u043d\u0430\u043b - \u0418\u043d\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u044f) $webhookId = 1197577280000000000 $webhookToken = \"rs8AA-XXXXXXXXXXX_Vk5RUI4A6HuSGhpCCTepq25duwCwLXasfv6u23a7XXXXXXXXXX\" $messageContent = \"Test dotNET\" $client = New-Object Discord.Webhook.DiscordWebhookClient($webhookId, $webhookToken) $client.SendMessageAsync($messageContent).Wait()","title":"Discord.Net.Webhook"},{"location":"#discordnetwebsocket","text":"$DiscordAssemblies = $(ls \"$home\\Documents\\Discord.NET\\*.dll\").FullName foreach ($assembly in $DiscordAssemblies) { Add-Type -Path $assembly } $DISCORD_TOKEN = \"MTE5NzE1NjM0NTM3NjQxMTcyOQ.XXXXXX.EzBF6RA9Kx_MSuhLW5elH1U-XXXXXXXXXXXXXX\" $Client = New-Object Discord.WebSocket.DiscordSocketClient $Client.Add_MessageReceived({ param($message) if ($message.Author.Id -ne $Client.CurrentUser.Id) { Write-Host (\"Received message from \" + $message.Author.Username + \": \" + $message.Content) if ($message.Content.Contains(\"ping\")) { $message.Channel.SendMessageAsync(\"pong\").GetAwaiter().GetResult() } } }) $Client.LoginAsync([Discord.TokenType]::Bot, $DISCORD_TOKEN).GetAwaiter().GetResult() #$Client.StartAsync().Wait() $Client.StartAsync().GetAwaiter().GetResult() $Client.ConnectionState [console]::ReadKey($true) $Client.LogoutAsync().GetAwaiter().GetResult() $Client.Dispose()","title":"Discord.Net.WebSocket"},{"location":"#oh-my-posh","text":"Install winget install JanDeDobbeleer.OhMyPosh -s winget \\ choco install oh-my-posh -y \\ scoop install https://github.com/JanDeDobbeleer/oh-my-posh/releases/latest/download/oh-my-posh.json \\ Set-ExecutionPolicy Bypass -Scope Process -Force; Invoke-Expression ((New-Object System.Net.WebClient).DownloadString('https://ohmyposh.dev/install.ps1')) Themes Get-PoshThemes \\ oh-my-posh init pwsh --config \"$env:POSH_THEMES_PATH/di4am0nd.omp.json\" | Invoke-Expression \\ oh-my-posh init pwsh --config \"https://raw.githubusercontent.com/JanDeDobbeleer/oh-my-posh/main/themes/cert.omp.json\" | Invoke-Expression New-Item -Path $PROFILE -Type File -Force \\ notepad $PROFILE \\ oh-my-posh init pwsh --config \"$env:POSH_THEMES_PATH/di4am0nd.omp.json\" | Invoke-Expression","title":"oh-my-posh"},{"location":"#themes-performance","text":"Install-Module themes-performance -Repository NuGet Import-Module themes-performance Set-PoshTheme -Theme System-Sensors # -Save Set-PoshTheme -Theme System-Performance # -Save Set-PoshTheme -Theme Pwsh-Process-Performance # -Save","title":"themes-performance"},{"location":"#terminal-icons","text":"Install-Module -Name Terminal-Icons -Repository PSGallery \\ scoop bucket add extras \\ scoop install terminal-icons notepad $PROFILE \\ Import-Module -Name Terminal-Icons \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442 \u0448\u0440\u0438\u0444\u0442\u044b, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u0445 \u043f\u0440\u043e\u0444\u0438\u043b\u044f PowerShell: Nerd Fonts \\ \u0421\u043f\u0438\u0441\u043e\u043a \u0448\u0440\u0438\u0444\u0442\u043e\u0432 \\ \u0421\u043a\u0430\u0447\u0430\u0442\u044c \u0438 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0448\u0440\u0438\u0444\u0442 \u043f\u043e\u0445\u043e\u0436\u0438\u0439 \u043d\u0430 Cascadia Code - CaskaydiaCove","title":"Terminal-Icons"},{"location":"#pester","text":"Source Install-Module -Name Pester -Repository PSGallery -Force -AllowClobber \\ Import-Module Pester \\ $(Get-Module Pester -ListAvailable).Version .Tests.ps1 function Add-Numbers { param ( [int]$a, [int]$b ) $a + $b } Describe \"Add-Numbers\" { Context \"\u041f\u0440\u0438 \u0441\u043b\u043e\u0436\u0435\u043d\u0438\u0438 \u0434\u0432\u0443\u0445 \u0447\u0438\u0441\u0435\u043b\" { It \"\u0414\u043e\u043b\u0436\u043d\u0430 \u0432\u0435\u0440\u043d\u0443\u0442\u044c\u0441\u044f \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u0430\u044f \u0441\u0443\u043c\u043c\u0430\" { $result = Add-Numbers -a 3 -b 4 $result | Should -Be 7 } } Context \"\u041f\u0440\u0438 \u0441\u043b\u043e\u0436\u0435\u043d\u0438\u0438 \u0434\u0432\u0443\u0445 \u0447\u0438\u0441\u0435\u043b\" { It \"\u0414\u043e\u043b\u0436\u043d\u0430 \u0432\u0435\u0440\u043d\u0443\u0442\u044c\u0441\u044f \u043e\u0448\u0438\u0431\u043a\u0430 (5+0 -ne 4)\" { $result = Add-Numbers -a 5 -b 0 $result | Should -Be 4 } } } function Get-RunningProcess { return Get-Process | Select-Object -ExpandProperty Name } Describe \"Get-RunningProcess\" { Context \"\u041f\u0440\u0438 \u043d\u0430\u043b\u0438\u0447\u0438\u0438 \u0437\u0430\u043f\u0443\u0449\u0435\u043d\u043d\u044b\u0445 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u0432\" { It \"\u0414\u043e\u043b\u0436\u0435\u043d \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0438\u043c\u0435\u043d \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u0432\" { $result = Get-RunningProcess $result | Should -Contain \"svchost\" $result | Should -Contain \"explorer\" } } Context \"\u041a\u043e\u0433\u0434\u0430 \u043d\u0435\u0442 \u0437\u0430\u043f\u0443\u0449\u0435\u043d\u043d\u044b\u0445 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u0432\" { It \"\u0414\u043e\u043b\u0436\u0435\u043d \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0442\u044c \u043f\u0443\u0441\u0442\u043e\u0439 \u0441\u043f\u0438\u0441\u043e\u043a\" { # \u0417\u0430\u043c\u043e\u043a\u0430\u0442\u044c \u0444\u0443\u043d\u043a\u0446\u0438\u044e Get-Process, \u0447\u0442\u043e\u0431\u044b \u043e\u043d\u0430 \u0432\u0441\u0435\u0433\u0434\u0430 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u043b\u0430 \u043f\u0443\u0441\u0442\u043e\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u0432 Mock Get-Process { return @() } $result = Get-RunningProcess $result | Should -BeEmpty } } }","title":"Pester"},{"location":"#pandoc","text":"$release_latest = Invoke-RestMethod \"https://api.github.com/repos/jgm/pandoc/releases/latest\" $url = $($release_latest.assets | Where-Object name -match \"windows-x86_64.zip\").browser_download_url Invoke-RestMethod $url -OutFile $home\\Downloads\\pandoc.zip Expand-Archive -Path \"$home\\Downloads\\pandoc.zip\" -DestinationPath \"$home\\Downloads\\\" $path = $(Get-ChildItem \"$home\\Downloads\\pandoc-*\\*.exe\").FullName Copy-Item -Path $path -Destination \"C:\\Windows\\System32\\pandoc.exe\" Remove-Item \"$home\\Downloads\\pandoc*\" -Force -Recurse pandoc -s README.md -o index.html \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0438\u044f \u0438\u0437 Markdown \u0432 HTML \\ pandoc README.md -o index.html --css=styles.css \u043f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c \u0441\u0442\u0438\u043b\u0438 \u0438\u0437 css \\ pandoc -s index.html -o README.md \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0438\u044f \u0438\u0437 HTML \u0432 Markdown \\ pandoc -s README.md -o README.docx \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0438\u044f \u0432 Word \\ pandoc -s README.md -o README.epub \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0438\u044f \u0432 \u043e\u0442\u043a\u0440\u044b\u0442\u044b\u0439 \u0444\u043e\u0440\u043c\u0430\u0442 \u044d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u044b\u0445 \u0432\u0435\u0440\u0441\u0438\u0439 \u043a\u043d\u0438\u0433 \\ pandoc -s README.md -o README.pdf \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0438\u044f \u0432 PDF (\u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f rsvg-convert) Import-Module ImportExcel Import-Excel -Path srv.xlsx | Export-Csv -Path $csvFilePath -NoTypeInformation -Encoding UTF8 # \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0438\u044f Excel \u0432 csv pandoc -s -f csv -t markdown input.csv -o output.md # \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0438\u044f \u0442\u0430\u0431\u043b\u0438\u0446\u0443 csv \u0432 markdown","title":"Pandoc"},{"location":"#ffmpeg","text":"$release_latest = Invoke-RestMethod \"https://api.github.com/repos/BtbN/FFmpeg-Builds/releases/latest\" $url = $($release_latest.assets | Where-Object name -match \"ffmpeg-master-latest-win64-gpl.zip\").browser_download_url Invoke-RestMethod $url -OutFile $home\\Downloads\\ffmpeg-master-latest-win64-gpl.zip Expand-Archive -Path \"$home\\Downloads\\ffmpeg-master-latest-win64-gpl.zip\" -DestinationPath \"$home\\Downloads\\\" Copy-Item -Path \"$home\\Downloads\\ffmpeg-master-latest-win64-gpl\\bin\\ffmpeg.exe\" -Destination \"C:\\Windows\\System32\\ffmpeg.exe\" Remove-Item \"$home\\Downloads\\ffmpeg-*\" -Force -Recurse ffmpeg -i input.mp4 output.gif \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c mp4 \u0432 gif \\ ffmpeg -i input.mp4 -filter_complex \"scale=1440:-1:flags=lanczos\" output.gif \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u0435 \u043d\u0430 \u0432\u044b\u0445\u043e\u0434\u0435 \\ ffmpeg -i input.mp4 -filter_complex \"scale=1440:-1:flags=lanczos\" -r 10 output.gif \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043a\u0430\u0434\u0440\u043e\u0432 \u0432 \u0441\u0435\u043a\u0443\u043d\u0434\u0443 \u043d\u0430 \u0432\u044b\u0445\u043e\u0434\u0435 \\ ffmpeg -i input.mp4 -filter_complex \"fps=5,scale=960:-1:flags=lanczos,split[s0][s1];[s0]palettegen=max_colors=32[p];[s1][p]paletteuse=dither=bayer\" output.gif \u0441\u0436\u0430\u0442\u0438\u0435 \u0437\u0430 \u0441\u0447\u0435\u0442 \u0446\u0432\u0435\u0442\u043e\u0432\u043e\u0439 \u043f\u043e\u043b\u0438\u0442\u0440\u044b \\ ffmpeg -i input.mp4 -ss 00:00:10 -frames:v 1 -q:v 1 output.jpg \u0432\u044b\u0442\u0430\u0449\u0438\u0442\u044c \u0441\u043a\u0440\u0438\u043d\u0448\u043e\u0442 \u0438\u0437 \u0432\u0438\u0434\u0435\u043e \u043d\u0430 10 \u0441\u0435\u043a\u0443\u043d\u0434\u0435 \\ ffmpeg -i input.mp4 -ss 00:00:05 -to 00:00:10 -c copy output.mp4 \u0432\u044b\u0442\u0430\u0449\u0438\u0442\u044c \u043a\u0443\u0441\u043e\u043a \u0432\u0438\u0434\u0435\u043e \\ ffmpeg -i \"%d.jpeg\" -framerate 2 -c:v libx264 -r 30 -pix_fmt yuv420p output.mp4 \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0432\u0438\u0434\u0435\u043e \u0438\u0437 \u0444\u043e\u0442\u043e (1.jpeg, 2.jpeg \u0438 \u0442.\u0434.) \u0441 framerate (\u0447\u0430\u0441\u0442\u043e\u0442\u043e\u0439 \u043a\u0430\u0434\u0440\u043e\u0432) \u0432 \u0441\u043e\u0437\u0434\u0430\u0432\u0430\u0435\u043c\u043e\u043c \u0432\u0438\u0434\u0435\u043e 2 \u043a\u0430\u0434\u0440\u0430 \u0432 \u0441\u0435\u043a\u0443\u043d\u0434\u0443 \\ ffmpeg -i \"rtsp://admin:password@192.168.3.201:554\" -rtsp_transport tcp -c:v copy -c:a aac -strict experimental output.mp4 \u0437\u0430\u043f\u0438\u0441\u044c \u0431\u0435\u0437 \u043f\u0435\u0440\u0435\u043a\u043e\u0434\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f (copy) RTSP-\u043f\u043e\u0442\u043e\u043a\u0430 \u0441 \u043a\u0430\u043c\u0435\u0440\u044b \u0432\u0438\u0434\u0435\u043e\u043d\u0430\u0431\u043b\u044e\u0434\u0435\u043d\u0438\u044f (+ \u0430\u0443\u0434\u0438\u043e \u0432 \u043a\u043e\u0434\u0435\u043a\u0435 AAC) \u0432 \u0444\u0430\u0439\u043b \\ ffmpeg -i \"rtsp://admin:password@192.168.3.201:554\" -rtsp_transport tcp -c:v copy -c:a aac -strict experimental -movflags +faststart+frag_keyframe+empty_moov output.mp4 \u043f\u0435\u0440\u0435\u043c\u0435\u0441\u0442\u0438\u0442\u044c \u043c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u043d\u0430\u0447\u0430\u043b\u043e \u0444\u0430\u0439\u043b\u0430, \u0447\u0442\u043e \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u043d\u0430\u0447\u0430\u0442\u044c \u0432\u043e\u0441\u043f\u0440\u043e\u0438\u0437\u0432\u0435\u0434\u0435\u043d\u0438\u0435 \u0444\u0430\u0439\u043b\u0430 \u0432 \u0432\u0438\u0434\u0435\u043e\u043f\u043b\u0435\u0435\u0440\u0435 \u0434\u043e \u0435\u0433\u043e \u043f\u043e\u043b\u043d\u043e\u0439 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \\ ffmpeg -i \"rtsp://admin:password@192.168.3.201:554\" -rtsp_transport tcp -frames:v 1 -c:v mjpeg output.jpg \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u0441\u043a\u0440\u0438\u043d\u0448\u043e\u0442","title":"FFmpeg"},{"location":"#imagemagick","text":"Source: ImageMagick magick identify -verbose PowerShell-Commands.png \u0438\u0437\u0432\u043b\u0435\u0447\u044c \u043c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \\ magick PowerShell-Commands.png output.jpg \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0438\u044f \u0444\u043e\u0440\u043c\u0430\u0442\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \\ magick PowerShell-Commands.png -resize 800x600 output.jpg \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0440\u0430\u0437\u043c\u0435\u0440 (\u0443\u0432\u0435\u043b\u0438\u0447\u0438\u0442\u044c \u0438\u043b\u0438 \u0443\u043c\u0435\u043d\u044c\u0448\u0438\u0442\u044c) \\ magick PowerShell-Commands.png -crop 400x300+100+50 output.jpg \u043e\u0431\u0440\u0435\u0437\u0430\u0442\u044c \\ magick PowerShell-Commands.png -rotate 90 output.jpg \u043f\u043e\u0432\u0435\u0440\u043d\u0443\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \\ magick PowerShell-Commands.png -fill white -pointsize 24 -gravity center -annotate +0+0 \"PowerShell\" output.jpg \u043d\u0430\u043b\u043e\u0436\u0438\u0442\u044c \u0442\u0435\u043a\u0441\u0442 \u043d\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \\ magick PowerShell-Commands.png -brightness-contrast +20x+10 output.jpg \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u044f\u0440\u043a\u043e\u0441\u0442\u044c \u0438 \u043a\u043e\u043d\u0442\u0440\u0430\u0441\u0442\u043d\u043e\u0441\u0442\u044c \\ magick convert -delay 100 1.png 2.png 3.png output.gif \u0441\u043e\u0437\u0434\u0430\u0442\u044c gif \u0438\u0437 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0439 \\ magick convert image1.jpg image2.jpg -append output.jpg \u0432\u0435\u0440\u0442\u0438\u043a\u0430\u043b\u044c\u043d\u043e \u043e\u0431\u044a\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f","title":"ImageMagick"},{"location":"#hugo","text":"Source winget install Hugo.Hugo.Extended \\ scoop install hugo-extended \\ choco install hugo-extended $user = \"gohugoio\" $repository = \"hugo\" $release_latest = Invoke-RestMethod \"https://api.github.com/repos/$($user)/$($repository)/releases/latest\" $url = $($release_latest.assets | Where-Object name -match \"hugo_extended_[\\d.]+_windows-amd64\\.zip\").browser_download_url Invoke-RestMethod $url -OutFile $home\\Downloads\\hugo.zip Expand-Archive -Path \"$home\\Downloads\\hugo.zip\" -DestinationPath \"$home\\Downloads\\hugo\\\" Copy-Item -Path \"$home\\Downloads\\hugo\\hugo.exe\" -Destination \"C:\\Windows\\System32\\hugo.exe\" Remove-Item \"$home\\Downloads\\hugo*\" -Force -Recurse \u0421\u043f\u0438\u0441\u043e\u043a \u0442\u0435\u043c \\ \u0421\u043f\u0438\u0441\u043e\u043a \u043a\u043e\u043c\u0430\u043d\u0434 \\ hugo completion powershell | Out-String | Invoke-Expression \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0443 \u0430\u0432\u0442\u043e\u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044f \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u043e\u0432 \\ hugo version hugo new site lifailon.github.io.hugo # \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0438 \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043d\u043e\u0432\u044b\u0439 \u0441\u0430\u0439\u0442 cd lifailon.github.io.hugo git init # \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439\u0442\u0435 \u043f\u0443\u0441\u0442\u043e\u0439 \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u0439 Git \u0432 \u0442\u0435\u043a\u0443\u0449\u0435\u043c \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0435 \u0434\u043b\u044f \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 \u0442\u0435\u043c\u044b \u043a\u0430\u0442\u0430\u043b\u043e\u0433 themes, \u0434\u043e\u0431\u0430\u0432\u0438\u0432 \u0435\u0435 \u0432 \u0441\u0432\u043e\u0439 \u043f\u0440\u043e\u0435\u043a\u0442 \u043a\u0430\u043a \u043f\u043e\u0434\u043c\u043e\u0434\u0443\u043b\u044c Git (\u0435\u0441\u043b\u0438 \u043d\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u043a\u043b\u043e\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435) git submodule add -f https://github.com/JingWangTW/dark-theme-editor.git themes/dark-theme-editor echo 'theme = \"dark-theme-editor\"' >> hugo.toml #git submodule add https://github.com/rhazdon/hugo-theme-hello-friend-ng.git themes/hello-friend-ng #echo 'theme = \"hello-friend-ng\"' >> hugo.toml mkdir \"$home\\Downloads\\lifailon.github.io.hugo\\content\\powershell\\\" cp \"$home\\Downloads\\README.md\" \"$home\\Downloads\\lifailon.github.io.hugo\\content\\powershell\\index.md\" # \u0441\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c markdown \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442 \u0432 \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u044e \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430 hugo server # \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u0439 \u0432\u0435\u0431-\u0441\u0435\u0440\u0432\u0435\u0440 \u0441 \u043f\u0440\u043e\u0435\u043a\u0442\u043e\u043c (http://localhost:1313) Dark-Theme-Editor code hugo.toml baseURL = 'https://lifailon.github.io' languageCode = 'en-us' title = 'PS-Commands' theme = \"dark-theme-editor\" [taxonomies] autor = \"Lifailon\" tag = \"Code\" category = \"PowerShell\" [params] [params.site] faviconUrl = \"\" [params.header] title = \"Lifailon.GitHub.io\" subtitle = \"\u0411\u043e\u043b\u044c\u0448\u0430\u044f \u0431\u0430\u0437\u0430 \u0437\u0430\u043c\u0435\u0442\u043e\u043a PowerShell \u043d\u0430 \u0440\u0443\u0441\u0441\u043a\u043e\u043c \u044f\u0437\u044b\u043a\u0435.\" [params.header.logo] imgUrl = \"\" logoLink = \"\" [params.footer] copyrightStr = \"GitHub\" counter = false language = false hugoVersion = true theme = true modifiedTime = true dateFormat = \"Jan 02 2006\" gitHash = false [params.footer.socialLink] github = \"https://github.com/Lifailon\" [params.globalFrontmatter] author = \"Lifailon\" description = \"Large base of PowerShell notes in Russian language\" keywords = \"PowerShell\" [params.homePage] siteLongDescriptionTitle = \"PowerShell Commands\" siteLongDescription = \"\u0421\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430 \u044f\u0437\u044b\u043a\u0430, \u0441\u0438\u043d\u0442\u0430\u043a\u0441\u0438\u0441 \u043a\u043e\u043c\u0430\u043d\u0434\u043b\u0435\u0442\u043e\u0432 \u0438 \u043c\u043e\u0434\u0443\u043b\u0435\u0439, \u0440\u0430\u0431\u043e\u0442\u0430 \u0441 \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u044b\u043c\u0438 \u0438 \u0432\u043d\u0435\u0448\u043d\u0438\u043c\u0438 \u0443\u0442\u0438\u043b\u0438\u0442\u0430\u043c\u0438, \u043f\u043b\u0430\u0442\u0444\u043e\u0440\u043c\u043e\u0439 .NET, \u0440\u0430\u0437\u043b\u0438\u0447\u043d\u044b\u043c\u0438 \u0441\u0435\u0440\u0432\u0438\u0441\u0430\u043c\u0438 \u0447\u0435\u0440\u0435\u0437 REST API, \u0430 \u0442\u0430\u043a \u0436\u0435 \u0441\u0438\u0441\u0442\u0435\u043c\u0430\u043c\u0438 AD, Exchange, Hyper-V, VMWare, \u0431\u0430\u0437\u0430\u043c\u0438 \u0434\u0430\u043d\u043d\u044b\u0445 \u0438 \u0442.\u0434.\" showRecentPostsBlock = false numOfRecentPosts = 5 recentPostShowUrl = false [params.page] includeToc = false showAuthor = true showDate = true dateFormat = \"Jan 02 2006\" showTimeToRead = true showBreadcrumb = true codeBlockCopible = true code \"content\\powershell\\index.md\" --- title: \"PowerShell Commands\" author: \"Lifailon\" date: \"2024-03-14T03:00:00+03:00\" categories: [\"PowerShell\"] tags: [\"dotNET\", \"REST API\", \"Active Dirtctory\", \"EMShell\", \"PowerCLI\", \"Database\"] --- Hugo-Theme-Hello-Friend-ng baseURL = 'https://lifailon.github.io' title = \"Shell Commands\" languageCode = \"en-us\" theme = \"hello-friend-ng\" contentDir = \"content\" [taxonomies] autor = \"Lifailon\" tag = \"PowerShell\" category = \"Code\" [params.author] name = \"Lifailon\" [params.footer] trademark = \"2022-2024\" bottomText = [\"GitHub \u25b6\ufe0f <a href=\\\"https://github.com/Lifailon\\\">Lifailon</a>\"] [params.logo] logoMark = \">\" logoText = \"$ /home/lifailon/\" logoHomeLink = \"/\" logoCursorColor = \"#67a2c9\" logoCursorAnimate = \"2s\" logoCursorPathname = true logoCursorDisabled = false #[params.portrait] #path = \"/img/image.jpg\" #alt = \"Portrait\" #maxWidth = \"1500px\" [[params.social]] name = \"github\" url = \"https://github.com/Lifailon\" [menu] [[menu.main]] identifier = \"ps\" name = \"PowerShell Commands\" url = \"/powershell/\" hugo \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f \u0441\u0430\u0439\u0442\u0430 (\u0441\u043e\u0437\u0434\u0430\u0441\u0442 \u043f\u0430\u043f\u043a\u0443 public \u0441 \u0433\u043e\u0442\u043e\u0432\u044b\u043c\u0438 \u0444\u0430\u0439\u043b\u0430\u043c\u0438 \u0441\u0430\u0439\u0442\u0430 \u0434\u043b\u044f \u0440\u0430\u0437\u0432\u0435\u0440\u0442\u044b\u0432\u0430\u043d\u0438\u044f)","title":"Hugo"}]}